import{a as ae}from"./chunk-QK3GCJX4.js";import{A as X,B,C as ee,E as te,F as $,o as h,p as w,r as M,s as W,t as j,u as C,v as R,w as P,x as k,y as N,z}from"./chunk-VUJUH7MP.js";import{G as he,H as de,I as pe,J as fe,d as ne,e as se,h as q,i as ie,j as oe,l as le,m as ue,t as ce}from"./chunk-6LUFMGKP.js";import{a as _,b as m,c as g,d as y,e as G,f as T}from"./chunk-EGGOXN6S.js";import{a as V,c as U,h as A}from"./chunk-LX3TXNPU.js";import{a as re}from"./chunk-MMZZL453.js";import{d as K}from"./chunk-BENVXA3L.js";import{b as J}from"./chunk-UE2YGKE7.js";import{w as O}from"./chunk-WKT5W7KT.js";import{h as c}from"./chunk-EAH6BNBL.js";var E=(()=>{class a{constructor(){this._databaseTypeMetaData={},this._layerInfo={}}clearDatabaseType(e){this._databaseTypeMetaData[e]===void 0&&delete this._databaseTypeMetaData[e]}getDatabaseType(e){return e==="MUSTBESET"||this._databaseTypeMetaData[e]===void 0?null:this._databaseTypeMetaData[e]}setDatabaseType(e,t){this._databaseTypeMetaData[e]=t}getLayerInfo(e){return this._layerInfo[e]===void 0?null:this._layerInfo[e]}setLayerInfo(e,t){this._layerInfo[e]=t}clearLayerInfo(e){this._layerInfo[e]!==void 0&&delete this._layerInfo[e]}}return a.applicationCache=null,a})();function _e(a,r){return p(a?.parseTree,r,a?.parameters)}function Ze(a,r,e){return p(a,r,e)}function Qe(a,r,e,t){return T.create(p(a.parseTree,h.Standardised,a.parameters,r,e),t,a.timeZone)}function Ke(a,r,e="AND"){return T.create("(("+_e(a,h.Standardised)+")"+e+"("+_e(r,h.Standardised)+"))",a.fieldsIndex,a.timeZone)}function p(a,r,e,t=null,n=null){let s,i,o,l;switch(a.type){case"interval":return xe(p(a.value,r,e,t,n),a.qualifier,a.op);case"case-expression":{let u=" CASE ";a.format==="simple"&&(u+=p(a.operand,r,e,t,n));for(let d=0;d<a.clauses.length;d++)u+=" WHEN "+p(a.clauses[d].operand,r,e,t,n)+" THEN "+p(a.clauses[d].value,r,e,t,n);return a.else!==null&&(u+=" ELSE "+p(a.else,r,e,t,n)),u+=" END ",u}case"parameter":{let u=e[a.value.toLowerCase()];if(typeof u=="string")return"'"+e[a.value.toLowerCase()].toString().replaceAll("'","''")+"'";if(C(u)||R(u))return H(u,r);if(N(u))return ge(u,r);if(P(u))return Q(u,r);if(k(u))return me(u,r);if(u instanceof Array){let d=[];for(let f=0;f<u.length;f++)typeof u[f]=="string"?d.push("'"+u[f].toString().replaceAll("'","''")+"'"):C(u[f])||R(u[f])?d.push(H(u[f],r)):N(u[f])?d.push(ge(u[f],r)):P(u[f])?d.push(Q(u[f],r)):k(u[f])?d.push(me(u[f],r)):d.push(u[f].toString());return d}return u.toString()}case"expression-list":i=[];for(let u of a.value)i.push(p(u,r,e,t,n));return i;case"unary-expression":return" ( NOT "+p(a.expr,r,e,t,n)+" ) ";case"binary-expression":switch(a.operator){case"AND":return" ("+p(a.left,r,e,t,n)+" AND "+p(a.right,r,e,t,n)+") ";case"OR":return" ("+p(a.left,r,e,t,n)+" OR "+p(a.right,r,e,t,n)+") ";case"IS":if(a.right.type!=="null")throw new m(_.UnsupportedIsRhs);return" ("+p(a.left,r,e,t,n)+" IS NULL )";case"ISNOT":if(a.right.type!=="null")throw new m(_.UnsupportedIsRhs);return" ("+p(a.left,r,e,t,n)+" IS NOT NULL )";case"IN":return s=[],a.right.type==="expression-list"?(s=p(a.right,r,e,t,n)," ("+p(a.left,r,e,t,n)+" IN ("+s.join(",")+")) "):(l=p(a.right,r,e,t,n),l instanceof Array?" ("+p(a.left,r,e,t,n)+" IN ("+l.join(",")+")) ":" ("+p(a.left,r,e,t,n)+" IN ("+l+")) ");case"NOT IN":return s=[],a.right.type==="expression-list"?(s=p(a.right,r,e,t,n)," ("+p(a.left,r,e,t,n)+" NOT IN ("+s.join(",")+")) "):(l=p(a.right,r,e,t,n),l instanceof Array?" ("+p(a.left,r,e,t,n)+" NOT IN ("+l.join(",")+")) ":" ("+p(a.left,r,e,t,n)+" NOT IN ("+l+")) ");case"BETWEEN":return o=p(a.right,r,e,t,n)," ("+p(a.left,r,e,t,n)+" BETWEEN "+o[0]+" AND "+o[1]+" ) ";case"NOTBETWEEN":return o=p(a.right,r,e,t,n)," ("+p(a.left,r,e,t,n)+" NOT BETWEEN "+o[0]+" AND "+o[1]+" ) ";case"LIKE":return a.escape!==""?" ("+p(a.left,r,e,t,n)+" LIKE "+p(a.right,r,e,t,n)+" ESCAPE '"+a.escape+"') ":" ("+p(a.left,r,e,t,n)+" LIKE "+p(a.right,r,e,t,n)+") ";case"NOT LIKE":return a.escape!==""?" ("+p(a.left,r,e,t,n)+" NOT LIKE "+p(a.right,r,e,t,n)+" ESCAPE '"+a.escape+"') ":" ("+p(a.left,r,e,t,n)+" NOT LIKE "+p(a.right,r,e,t,n)+") ";case"<>":case"<":case">":case">=":case"<=":case"=":case"*":case"-":case"+":case"/":return" ("+p(a.left,r,e,t,n)+" "+a.operator+" "+p(a.right,r,e,t,n)+") ";case"||":return" ("+p(a.left,r,e,t,n)+" "+(r===h.SqlServer?"+":a.operator)+" "+p(a.right,r,e,t,n)+") "}throw new m(_.UnsupportedOperator,{operator:a.operator});case"null":return"null";case"boolean":return a.value===!0?"1":"0";case"string":return"'"+a.value.toString().replaceAll("'","''")+"'";case"timestamp":return`timestamp '${a.value}'`;case"date":return`date '${a.value}'`;case"time":return`time '${a.value}'`;case"number":return a.value.toString();case"current-time":return Le(a.mode==="date",r);case"column-reference":return t?t.toLowerCase()===a.column.toLowerCase()?"("+n+")":a.delimited===!0?`"${a.column.split('"').join('""')}"`:a.column:a.column;case"data-type":return a.value;case"function":{let u=p(a.args,r,e,t,n);return Ne(a.name,u,r)}}throw new m(_.UnsupportedSyntax,{node:a.type})}function Ne(a,r,e){switch(a.toLowerCase().trim()){case"cos":case"sin":case"tan":case"cosh":case"tanh":case"sinh":case"acos":case"asin":case"atan":case"floor":case"log10":case"log":case"abs":if(r.length!==1)throw new m(_.InvalidFunctionParameters,{function:a.toLowerCase().trim()});return`${a.toUpperCase().trim()}(${r[0]})`;case"ceiling":case"ceil":if(r.length!==1)throw new m(_.InvalidFunctionParameters,{function:"ceiling"});switch(e){case h.Standardised:case h.StandardisedNoInterval:}return"CEILING("+r[0]+")";case"mod":case"power":case"nullif":if(r.length!==2)throw new m(_.InvalidFunctionParameters,{function:a.toLowerCase().trim()});return`${a.toUpperCase().trim()}(${r[0]},${r[1]})`;case"round":if(r.length===2)return"ROUND("+r[0]+","+r[1]+")";if(r.length===1)return"ROUND("+r[0]+")";throw new m(_.InvalidFunctionParameters,{function:"round"});case"truncate":if(r.length<1||r.length>2)throw new m(_.InvalidFunctionParameters,{function:"truncate"});return e===h.SqlServer?"ROUND("+r[0]+(r.length===1?"0":","+r[1])+",1)":"TRUNCATE("+r[0]+(r.length===1?")":","+r[1]+")");case"char_length":case"len":if(r.length!==1)throw new m(_.InvalidFunctionParameters,{function:"char_length"});switch(e){case h.SqlServer:return"LEN("+r[0]+")";case h.Oracle:return"LENGTH("+r[0]+")";default:return"CHAR_LENGTH("+r[0]+")"}case"coalesce":case"concat":{if(r.length<1)throw new m(_.InvalidFunctionParameters,{function:a.toLowerCase()});let t=a.toUpperCase().trim()+"(";for(let n=0;n<r.length;n++)n!==0&&(t+=","),t+=r[n];return t+=")",t}case"lower":case"lcase":if(r.length!==1)throw new m(_.InvalidFunctionParameters,{function:"lower"});return"LOWER("+r[0]+")";case"upper":case"ucase":if(r.length!==1)throw new m(_.InvalidFunctionParameters,{function:"upper"});return"UPPER("+r[0]+")";case"substring":{let t="";switch(e){case h.Oracle:return t="SUBSTR("+r[0]+","+r[1],r.length===3&&(t+=","+r[2]),t+=")",t;case h.SqlServer:return t=r.length===3?"SUBSTRING("+r[0]+","+r[1]+","+r[2]+")":"SUBSTRING("+r[0]+",  "+r[1]+", LEN("+r[0]+") - "+r[1]+")",t;default:return t="SUBSTRING("+r[0]+" FROM "+r[1],r.length===3&&(t+=" FOR "+r[2]),t+=")",t}}case"extract":return"EXTRACT("+r[0].replaceAll("'","")+" FROM "+r[1]+")";case"cast":{let t="";switch(e){case h.Oracle:switch(r[1].type){case"date":t="DATE";break;case"float":t="DOUBLE";break;case"integer":t="INTEGER";break;case"real":t="REAL";break;case"smallint":t="SMALLINT";break;case"timestamp":t="TIMESTAMP";break;case"varchar":t="VARCHAR("+r[1].size.toString()+")"}return`CAST(${r[0]} AS ${t})`;case h.Postgres:switch(r[1].type){case"date":t="DATE";break;case"float":t="DOUBLE PRECISION";break;case"integer":t="INT";break;case"real":t="REAL";break;case"smallint":t="SMALLINT";break;case"timestamp":t="TIMESTAMP";break;case"varchar":t="VARCHAR("+r[1].size.toString()+")"}return`CAST(${r[0]} AS ${t})`;case h.SqlServer:switch(r[1].type){case"date":t="DATE";break;case"float":t="FLOAT";break;case"integer":t="INT";break;case"real":t="REAL";break;case"smallint":t="SMALLINT";break;case"timestamp":t="DATETIME";break;case"varchar":t="VARCHAR("+r[1].size.toString()+")"}return`CAST(${r[0]} AS ${t})`;default:switch(r[1].type){case"date":t="DATE";break;case"float":t="FLOAT";break;case"integer":t="INTEGER";break;case"real":t="REAL";break;case"smallint":t="SMALLINT";break;case"timestamp":t="TIMESTAMP";break;case"varchar":t="VARCHAR("+r[1].size.toString()+")"}return`CAST(${r[0]} AS ${t})`}}}throw new m(_.InvalidFunctionParameters,{function:a})}function Q(a,r){let e=a.toDateTime(),t=e.hour===0&&e.minute===0&&e.second===0&&e.millisecond===0;switch(r){case h.FILEGDB:case h.Standardised:case h.StandardisedNoInterval:return t?`date '${e.toFormat("yyyy-LL-dd")}'`:`timestamp '${e.toFormat("yyyy-LL-dd HH:mm:ss")}'`;case h.Oracle:return t?`TO_DATE('${e.toFormat("yyyy-LL-dd")}','YYYY-MM-DD')`:`TO_DATE('${e.toFormat("yyyy-LL-dd HH:mm:ss")}','YYYY-MM-DD HH24:MI:SS')`;case h.SqlServer:return`'${e.toFormat(t?"yyyy-LL-dd":"yyyy-LL-dd HH:mm:ss")}'`;case h.PGDB:return`#${e.toFormat(t?"LL-dd-yyyy":"LL-dd-yyyy HH:mm:ss")}#`;case h.Postgres:return`TIMESTAMP '${e.toFormat(t?"yyyy-LL-dd":"yyyy-LL-dd HH:mm:ss")}'`;default:return`timestamp '${e.toFormat("yyyy-LL-dd HH:mm:ss")}'`}}function me(a,r){switch(r){case h.FILEGDB:case h.Standardised:case h.StandardisedNoInterval:return a.toSQLWithKeyword();case h.Oracle:return`TO_DATE('${a.toFormat("Y-MM-DD")}'`;case h.SqlServer:return`'${a.toFormat("Y-MM-DD")}'`;case h.PGDB:return`#${a.toFormat("Y-MM-DD")}#`;case h.Postgres:return`TIMESTAMP '${a.toFormat("Y-MM-DD")}'`;default:return a.toSQLWithKeyword()}}function ge(a,r){switch(a instanceof A&&(a=a.toStorageString()),r){case h.Oracle:return`TO_DATE('${a}', 'HH24:MI:SS')`;case h.SqlServer:return`'${a}'`;case h.FILEGDB:case h.Standardised:case h.StandardisedNoInterval:case h.Postgres:default:return`time '${a}'`}}function H(a,r){return Q(V.dateTimeToArcadeDate(R(a)?a:K.fromJSDate(a)),r)}function Le(a,r){switch(r){case h.FILEGDB:case h.Standardised:case h.StandardisedNoInterval:case h.Oracle:return a?"CURRENT_DATE":"CURRENT_TIMESTAMP";case h.SqlServer:return a?"CAST(GETDATE() AS DATE)":"GETDATE()";case h.PGDB:case h.Postgres:default:return a?"CURRENT_DATE":"CURRENT_TIMESTAMP"}}function Se(a,r,e={}){let t={},n={},s={esriFieldTypeSmallInteger:"integer",esriFieldTypeInteger:"integer",esriFieldTypeBigInteger:"integer",esriFieldTypeSingle:"double",esriFieldTypeDouble:"double",esriFieldTypeString:"string",esriFieldTypeTimeOnly:"time-only",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimestampOffset:"timestamp-offset",esriFieldTypeDate:"date",esriFieldTypeOID:"integer",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"guid",oid:"integer",long:"integer","small-integer":"integer",integer:"integer","big-integer":"integer",single:"double","time-only":"time-only","date-only":"date-only","timestamp-offset":"timestemp-offset",double:"double",date:"date",guid:"guid","global-id":"guid",string:"string"};for(let i of r){let o=i.type?s[i.type]:void 0;t[i.name.toLowerCase()]=o===void 0?"":o}for(let i in e){let o=s[e[i]];n[i.toLowerCase()]=o===void 0?"":o}switch(F(t,a.parseTree,a.parameters,n)){case"double":return"double";case"integer":return"integer";case"date":return"date";case"date-only":return"date-only";case"time-only":return"time-only";case"timestamp-offset":return"timestamp-offset";case"string":return"string";case"global-id":case"guid":return"guid"}return""}function F(a,r,e,t){let n;switch(r.type){case"interval":return"integer";case"case-expression":{let s=[];if(r.format==="simple"){for(let i=0;i<r.clauses.length;i++)s.push(F(a,r.clauses[i].value,e,t));r.else!==null&&s.push(F(a,r.else,e,t))}else{for(let i=0;i<r.clauses.length;i++)s.push(F(a,r.else,e,t));r.else!==null&&s.push(F(a,r.else,e,t))}return Y(s)}case"parameter":{let s=t[r.value.toLowerCase()];if(s===void 0&&e){let i=e[r.value.toLowerCase()];if(i===void 0||i===null)return"";if(typeof i=="string"||i instanceof String)return"string";if(typeof i=="boolean")return"boolean";if(C(i)||P(i))return"date";if(k(i))return"date-only";if(N(i))return"time-only";if(typeof i=="number")return i%1==0?"integer":"double"}return s===void 0?"":s}case"expression-list":{let s=[];for(let i of r.value)s.push(F(a,i,e,t));return s}case"unary-expression":return"boolean";case"binary-expression":switch(r.operator){case"AND":case"OR":case"IN":case"NOT IN":case"BETWEEN":case"NOTBETWEEN":case"LIKE":case"NOT LIKE":case"<>":case"<":case">":case">=":case"<=":case"=":return"boolean";case"IS":case"ISNOT":if(r.right.type!=="null")throw new m(_.UnsupportedIsRhs);return"boolean";case"*":case"-":case"+":case"/":return Y([F(a,r.left,e,t),F(a,r.right,e,t)]);case"||":return"string";default:throw new m(_.UnsupportedOperator,{operator:r.operator})}case"null":return"";case"boolean":return"boolean";case"string":return"string";case"number":return r.value===null?"":r.value%1==0?"integer":"double";case"date":return"date";case"timestamp":return r.withtimezone?"timestamp-offset":"date";case"time":return"time-only";case"current-time":return"date";case"column-reference":{let s=a[r.column.toLowerCase()];return s===void 0?"":s}case"function":switch(r.name.toLowerCase()){case"cast":switch(r.args?.value[1]?.value.type??""){case"integer":case"smallint":return"integer";case"real":case"float":return"double";case"date":case"timestamp":return r.args?.value[1]?.value?.withtimezone===!0?"timestamp-offset":"date";case"time":return"time-only";case"varchar":return"string";default:return""}case"position":case"extract":case"char_length":case"mod":return"integer";case"round":if(n=F(a,r.args,e,t),n instanceof Array){if(n.length<=0)return"double";n=n[0]}return n;case"sign":return"integer";case"ceiling":case"floor":case"abs":return n=F(a,r.args,e,t),n instanceof Array&&(n=Y(n)),n==="integer"||n==="double"?n:"double";case"area":case"length":case"log":case"log10":case"sin":case"cos":case"tan":case"asin":case"acos":case"atan":case"cosh":case"sinh":case"tanh":case"power":return"double";case"substring":case"trim":case"concat":case"lower":case"upper":return"string";case"truncate":return"double";case"nullif":case"coalesce":return n=F(a,r.args,e,t),n instanceof Array?n.length>0?n[0]:"":n}return""}throw new m(_.UnsupportedSyntax,{node:r.type})}var ye={boolean:1,string:2,integer:3,double:4,date:5};function Y(a){if(a){let r="";for(let e of a)e!==""&&(r=r===""||ye[r]<ye[e]?e:r);return r}return""}function Je(a,r){return b(a.parseTree,r)}function Te(a){return a?.parseTree.type==="column-reference"}function b(a,r){if(a==null)return!1;switch(a.type){case"when-clause":return b(a.operand,r)||b(a.value,r);case"case-expression":for(let e of a.clauses)if(b(e,r))return!0;return!(a.format!=="simple"||!b(a.operand,r))||!(a.else===null||!b(a.else,r));case"parameter":case"null":case"boolean":case"date":case"timestamp":case"time":case"string":case"number":return!1;case"expression-list":for(let e of a.value)if(b(e,r))return!0;return!1;case"unary-expression":return b(a.expr,r);case"binary-expression":return b(a.left,r)||b(a.right,r);case"column-reference":return r.toLowerCase()===a.column.toLowerCase();case"function":return b(a.args,r)}return!1}function Z(a){let r="";return r+=a.period.toUpperCase(),r}function xe(a,r,e){let t="";return t=r.type==="interval-period"?Z(r):Z(r.start)+" TO "+Z(r.end),"INTERVAL "+e+" "+a+" "+t}var L=class{constructor(r,e){this._lastId=-1,this._progress=e,this._parent=r}reset(){this._lastId=-1}nextBatchAsArcadeFeatures(r,e){return c(this,null,function*(){let t=yield this.nextBatch(r);return t===null?t:t.map(n=>ae.createFromGraphicLikeObject(n.geometry,n.attributes,this._parent,e))})}nextBatch(r){if(this._parent._mainSetInUse!==null)return this._parent._mainSetInUse.then(n=>this.nextBatch(r),n=>this.nextBatch(r));let e={returnpromise:null,hasset:!1},t=[];return e.returnpromise=new Promise((n,s)=>{this._parent._getSet(this._progress).then(i=>{let o=i._known,l=o.length-1;if(o[o.length-1]==="GETPAGES"&&(l-=1),this._lastId+r>l&&o.length>0&&o[o.length-1]==="GETPAGES")return void this._parent._expandPagedSet(i,this._parent._maxQueryRate(),0,0,this._progress).then(d=>{e.hasset=!0,this._parent._mainSetInUse=null,this.nextBatch(r).then(n,s)},d=>{e.hasset=!0,this._parent._mainSetInUse=null,s(d)});let u=i._candidates;if(l>=this._lastId+r||u.length===0){for(let d=0;d<r;d++){let f=d+this._lastId+1;if(f>=o.length)break;t[d]=o[f]}return this._lastId+=t.length,t.length===0&&(e.hasset=!0,this._parent._mainSetInUse=null,n([])),void this._parent._getFeatureBatch(t,this._progress).then(d=>{e.hasset=!0,this._parent._mainSetInUse=null,n(d)},d=>{e.hasset=!0,this._parent._mainSetInUse=null,s(d)})}this._parent._refineSetBlock(i,this._parent._maxProcessingRate(),this._progress).then(()=>{e.hasset=!0,this._parent._mainSetInUse=null,this.nextBatch(r).then(n,s)},d=>{e.hasset=!0,this._parent._mainSetInUse=null,s(d)})},i=>{e.hasset=!0,this._parent._mainSetInUse=null,s(i)})}),e.hasset===!1&&(this._parent._mainSetInUse=e.returnpromise,e.hasset=!0),e.returnpromise}next(){if(this._parent._mainSetInUse!==null)return this._parent._mainSetInUse.then(e=>this.next(),e=>this.next());let r={returnpromise:null,hasset:!1};return r.returnpromise=new Promise((e,t)=>{this._parent._getSet(this._progress).then(n=>{let s=n._known;this._lastId<s.length-1?s[this._lastId+1]==="GETPAGES"?this._parent._expandPagedSet(n,this._parent._maxQueryRate(),0,0,this._progress).then(i=>(r.hasset=!0,this._parent._mainSetInUse=null,this.next())).then(e,t):(this._lastId+=1,this._parent._getFeature(n,s[this._lastId],this._progress).then(i=>{r.hasset=!0,this._parent._mainSetInUse=null,e(i)},i=>{r.hasset=!0,this._parent._mainSetInUse=null,t(i)})):n._candidates.length>0?this._parent._refineSetBlock(n,this._parent._maxProcessingRate(),this._progress).then(()=>{r.hasset=!0,this._parent._mainSetInUse=null,this.next().then(e,t)},i=>{r.hasset=!0,this._parent._mainSetInUse=null,t(i)}):(r.hasset=!0,this._parent._mainSetInUse=null,e(null))},n=>{r.hasset=!0,this._parent._mainSetInUse=null,t(n)})}),r.hasset===!1&&(this._parent._mainSetInUse=r.returnpromise,r.hasset=!0),r.returnpromise}count(){return c(this,null,function*(){if(this._parent._totalCount!==-1)return this._parent._totalCount;let r=yield this._parent._getSet(this._progress),e=yield this._refineAllSets(r);return this._parent._totalCount=e._known.length,this._parent._totalCount})}_refineAllSets(r){return c(this,null,function*(){if(r._known.length>0&&r._known[r._known.length-1]==="GETPAGES")return yield this._parent._expandPagedSet(r,this._parent._maxQueryRate(),0,1,this._progress),this._refineAllSets(r);if(r._candidates.length>0){if(r._known[r._candidates.length-1]==="GETPAGES")return yield this._parent._expandPagedSet(r,this._parent._maxQueryRate(),0,2,this._progress),this._refineAllSets(r);let e=yield this._parent._refineSetBlock(r,this._parent._maxProcessingRate(),this._progress);return e._candidates.length>0?this._refineAllSets(e):e}return r})}};var S=class{constructor(r,e,t,n){this._lastFetchedIndex=0,this._ordered=!1,this.pagesDefinition=null,this._candidates=r,this._known=e,this._ordered=t,this.pagesDefinition=n}};function Oe(a){return a=+a,isFinite(a)?a-a%1||(a<0?-0:a===0?a:0):a}function x(a){let r=0;for(let e=0;e<a.length;e++)r+=a[e];return r/a.length}function we(a){let r=x(a),e=0;for(let t=0;t<a.length;t++)e+=(r-a[t])**2;return e/a.length}function Ie(a){let r=x(a),e=0;for(let t=0;t<a.length;t++)e+=(r-a[t])**2;return e/(a.length-1)}function Fe(a){let r=0;for(let e=0;e<a.length;e++)r+=a[e];return r}function Ue(a,r){let e=[],t={},n=[];for(let s=0;s<a.length;s++){if(a[s]!==void 0&&a[s]!==null){let i=a[s];if(j(i)||W(i))t[i]===void 0&&(e.push(i),t[i]=1);else{let o=!1;for(let l=0;l<n.length;l++)z(n[l],i)===!0&&(o=!0);o===!1&&(n.push(i),e.push(i))}}if(e.length>=r&&r!==-1)return e}return e}function it(a){switch(a.toLowerCase()){case"distinct":return"distinct";case"avg":case"mean":return"avg";case"min":return"min";case"sum":return"sum";case"max":return"max";case"stdev":case"stddev":return"stddev";case"var":case"variance":return"var";case"count":return"count"}return""}function ot(a,r,e=1e3){switch(a.toLowerCase()){case"distinct":return Ue(r,e);case"avg":case"mean":return x(r);case"min":return Math.min.apply(Math,r);case"sum":return Fe(r);case"max":return Math.max.apply(Math,r);case"stdev":case"stddev":return Math.sqrt(we(r));case"var":case"variance":return we(r);case"count":return r.length}return 0}function be(a,r,e){return c(this,null,function*(){let t=yield v(a,r,e,!0);return t.length===0?null:Math.min.apply(Math,t)})}function De(a,r,e){return c(this,null,function*(){let t=yield v(a,r,e,!0);return t.length===0?null:Math.max.apply(Math,t)})}function Ee(a,r,e){return c(this,null,function*(){let t="";r&&!Te(r)&&(t=Se(r,a.fields));let n=yield v(a,r,e,!0);if(n.length===0)return null;let s=x(n);return s===null?s:t==="integer"?Oe(s):s})}function ve(a,r,e){return c(this,null,function*(){let t=yield v(a,r,e,!0);return t.length===0?null:Ie(t)})}function Ae(a,r,e){return c(this,null,function*(){let t=yield v(a,r,e,!0);return t.length===0?null:Math.sqrt(Ie(t))})}function Ce(a,r,e){return c(this,null,function*(){let t=yield v(a,r,e,!0);return t.length===0?null:Fe(t)})}function Re(a,r){return c(this,null,function*(){return a.iterator(r).count()})}function v(a,r,e,t=!1){return c(this,null,function*(){let n=a.iterator(e),s=[],i={ticker:0},o=yield n.next();for(;o!==null;){if(i.ticker++,e.aborted)throw new y(g.Cancelled);i.ticker%100==0&&(i.ticker=0,yield new Promise(u=>{setTimeout(u,0)}));let l=r?.calculateValue(o);l===null?t===!1&&(s[s.length]=l):s[s.length]=l instanceof U||l instanceof A?l.toNumber():l instanceof G?l.toMilliseconds():l,o=yield n.next()}return s})}function Pe(a,r,e=1e3,t=null){return c(this,null,function*(){let n=a.iterator(t),s=[],i={},o={ticker:0},l=yield n.next();for(;l!==null;){if(o.ticker++,t&&t.aborted)throw new y(g.Cancelled);o.ticker%100==0&&(o.ticker=0,yield new Promise(f=>{setTimeout(f,0)}));let u=r?.calculateValue(l),d=u;if(u instanceof U?d="!!DATEONLY!!-"+u.toString():u instanceof G?d="!!TSOFFSETONLY!!-"+u.toString():u instanceof A?d="!!TIMEONLY!!-"+u.toString():u instanceof Date&&(d="!!DATE!!-"+u.toString()),u!=null&&i[d]===void 0&&(s.push(u),i[d]=1),s.length>=e&&e!==-1)return s;l=yield n.next()}return s})}var I=(()=>{class a{constructor(e){this.recentlyUsedQueries=null,this.featureSetQueryInterceptor=null,this._idstates=[],this._parent=null,this._wset=null,this._mainSetInUse=null,this._maxProcessing=200,this._maxQuery=500,this._totalCount=-1,this._databaseType=h.NotEvaluated,this._databaseTypeProbed=null,this.declaredRootClass="esri.arcade.featureset.support.FeatureSet",this._featureCache=[],this.typeIdField=null,this.types=null,this.subtypeField=null,this.subtypes=null,this.fields=null,this.geometryType="",this.objectIdField="",this.globalIdField="",this.spatialReference=null,this.hasM=!1,this.hasZ=!1,this._transparent=!1,this.loaded=!1,this._loadPromise=null,this._fieldsIndex=null,this.fsetInfo=null,e?.lrucache&&(this.recentlyUsedQueries=e.lrucache),e?.interceptor&&(this.featureSetQueryInterceptor=e.interceptor)}optimisePagingFeatureQueries(e){this._parent&&this._parent.optimisePagingFeatureQueries(e)}_hasMemorySource(){return!0}prop(e,t){return t===void 0?this[e]:(this[e]!==void 0&&(this[e]=t),this)}end(){return this._parent!==null&&this._parent._transparent===!0?this._parent.end():this._parent}_ensureLoaded(){return this.load()}load(){return this._loadPromise===null&&(this._loadPromise=this.loadImpl()),this._loadPromise}loadImpl(){return c(this,null,function*(){return this._parent?.loaded===!0?(this._initialiseFeatureSet(),this):(yield this._parent?.load(),this._initialiseFeatureSet(),this)})}_initialiseFeatureSet(){this._parent!==null?(this.fields=this._parent.fields.slice(0),this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types,this.subtypeField=this._parent.subtypeField,this.subtypes=this._parent.subtypes):(this.fields=[],this.typeIdField="",this.subtypeField="",this.objectIdField="",this.globalIdField="",this.spatialReference=new J({wkid:4326}),this.geometryType=te.point)}getField(e,t){let n;return(t=t||this.fields)&&(e=e.toLowerCase(),t.some(s=>(s&&s.name.toLowerCase()===e&&(n=s),!!n))),n}getFieldsIndex(){return this._fieldsIndex===null&&(this._fieldsIndex=re.fromLayer({timeInfo:this.timeInfo,editFieldsInfo:this.editFieldsInfo,dateFieldsTimeZone:this.dateFieldsTimeZone,datesInUnknownTimezone:this.datesInUnknownTimezone,fields:this.fields})),this._fieldsIndex}_maxProcessingRate(){return this._parent!==null?Math.min(this._maxProcessing,this._parent._maxProcessingRate()):Math.min(this._maxProcessing,this._maxQueryRate())}_maxQueryRate(){return this._parent!==null?Math.max(this._maxQuery,this._parent._maxQueryRate()):this._maxQuery}_checkCancelled(e){if(e!=null&&e.aborted)throw new y(g.Cancelled)}nativeCapabilities(){return this._parent.nativeCapabilities()}_canDoAggregates(e,t,n,s,i){return c(this,null,function*(){return this._parent!==null&&this._parent._canDoAggregates(e,t,n,s,i)})}_getAggregatePagesDataSourceDefinition(e,t,n,s,i,o,l){return c(this,null,function*(){if(this._parent===null)throw new y(g.NeverReach);return this._parent._getAggregatePagesDataSourceDefinition(e,t,n,s,i,o,l)})}_getAgregagtePhysicalPage(e,t,n){return c(this,null,function*(){if(this._parent===null)throw new y(g.NeverReach);return this._parent._getAgregagtePhysicalPage(e,t,n)})}databaseType(){return c(this,null,function*(){if(this._databaseType===h.NotEvaluated){if(E.applicationCache!==null){let e=E.applicationCache.getDatabaseType(this._cacheableFeatureSetSourceKey());if(e!==null)return e}if(this._databaseTypeProbed!==null)return this._databaseTypeProbed;try{this._databaseTypeProbed=this._getDatabaseTypeImpl(),E.applicationCache!==null&&E.applicationCache.setDatabaseType(this._cacheableFeatureSetSourceKey(),this._databaseTypeProbed)}catch(e){throw E.applicationCache!==null&&E.applicationCache.clearDatabaseType(this._cacheableFeatureSetSourceKey()),e}return this._databaseTypeProbed}return this._databaseType})}_getDatabaseTypeImpl(){return c(this,null,function*(){let e=[{thetype:h.SqlServer,testwhere:"(CAST( '2015-01-01' as DATETIME) = CAST( '2015-01-01' as DATETIME)) AND OBJECTID<0"},{thetype:h.Oracle,testwhere:"(TO_DATE('2003-11-18','YYYY-MM-DD') = TO_DATE('2003-11-18','YYYY-MM-DD')) AND OBJECTID<0"},{thetype:h.StandardisedNoInterval,testwhere:"(date '2015-01-01 10:10:10' = date '2015-01-01 10:10:10') AND OBJECTID<0"}];for(let t of e)if((yield this._runDatabaseProbe(t.testwhere))===!0)return t.thetype;return h.StandardisedNoInterval})}_cacheableFeatureSetSourceKey(){return"MUSTBESET"}_runDatabaseProbe(e){return c(this,null,function*(){if(this._parent!==null)return this._parent._runDatabaseProbe(e);throw new y(g.NotImplemented)})}isTable(){return this._parent?.isTable()??!1}_featureFromCache(e){if(this._featureCache[e]!==void 0)return this._featureCache[e]}_isInFeatureSet(e){return w.Unknown}_getSet(e){throw new y(g.NotImplemented)}_getFeature(e,t,n){return c(this,null,function*(){if(this._checkCancelled(n),this._featureFromCache(t)!==void 0)return this._featureFromCache(t);if(yield this._getFeatures(e,t,this._maxProcessingRate(),n),this._checkCancelled(n),this._featureFromCache(t)!==void 0)return this._featureFromCache(t);throw new y(g.MissingFeatures)})}_getFeatureBatch(e,t){return c(this,null,function*(){this._checkCancelled(t);let n=new S([],e,!1,null),s=[];yield this._getFeatures(n,-1,e.length,t),this._checkCancelled(t);for(let i of e)this._featureFromCache(i)!==void 0&&s.push(this._featureFromCache(i));return s})}_getFeatures(e,t,n,s){return c(this,null,function*(){return"success"})}_getFilteredSet(e,t,n,s,i){throw new y(g.NotImplemented)}_refineSetBlock(e,t,n){return c(this,null,function*(){if(this._checkIfNeedToExpandCandidatePage(e,this._maxQueryRate())===!0)return yield this._expandPagedSet(e,this._maxQueryRate(),0,0,n),this._refineSetBlock(e,t,n);this._checkCancelled(n);let s=e._candidates.length;this._refineKnowns(e,t);let i=s-e._candidates.length;if(e._candidates.length===0||i>=t)return e;if(yield this._refineIfParentKnown(e,t-i,n),this._checkCancelled(n),this._refineKnowns(e,t-i),i=s-e._candidates.length,i<t&&e._candidates.length>0){let o=t-i,l=this._prepareFetchAndRefineSet(e._candidates);return yield this._fetchAndRefineFeatures(l,l.length>o?o:e._candidates.length,n),this._checkCancelled(n),this._refineKnowns(e,t-i),e}return e})}_fetchAndRefineFeatures(e,t,n){return null}_prepareFetchAndRefineSet(e){let t=[];for(let n=0;n<e.length;n++)this._isPhysicalFeature(e[n])&&t.push(e[n]);return t}_isPhysicalFeature(e){return this._parent===null||this._parent._isPhysicalFeature(e)}_refineKnowns(e,t){let n=0,s=null,i=[];t=this._maxQueryRate();for(let o=0;o<e._candidates.length&&e._candidates[o]!=="GETPAGES";o++){let l=!1,u=this._candidateIdTransform(e._candidates[o]);u!==e._candidates[o]&&(l=!0);let d=this._isInFeatureSet(u);if(d===w.InFeatureSet)l===!0?e._known.includes(u)||(e._known.push(u),n+=1):(e._known.push(e._candidates[o]),n+=1),s===null?s={start:o,end:o}:s.end===o-1?s.end=o:(i.push(s),s={start:o,end:o});else if(d===w.NotInFeatureSet)s===null?s={start:o,end:o}:s.end===o-1?s.end=o:(i.push(s),s={start:o,end:o}),n+=1;else if(d===w.Unknown&&(n+=1,e._ordered===!0))break;if(n>=t)break}s!==null&&i.push(s);for(let o=i.length-1;o>=0;o--)e._candidates.splice(i[o].start,i[o].end-i[o].start+1)}_refineIfParentKnown(e,t,n){let s=new S([],[],e._ordered,null);return s._candidates=e._candidates.slice(0),this._parent._refineSetBlock(s,t,n)}_candidateIdTransform(e){return this._parent._candidateIdTransform(e)}_checkIfNeedToExpandKnownPage(e,t){if(e.pagesDefinition===null)return!1;let n=0;for(let s=e._lastFetchedIndex;s<e._known.length;s++){if(e._known[s]==="GETPAGES")return!0;if(this._featureCache[e._known[s]]===void 0&&(n+=1,n>=t))break}return!1}_checkIfNeedToExpandCandidatePage(e,t){if(e.pagesDefinition===null)return!1;let n=0;for(let s=0;s<e._candidates.length;s++){if(e._candidates[s]==="GETPAGES")return!0;if(n+=1,n>=t)break}return!1}_expandPagedSet(e,t,n,s,i){return c(this,null,function*(){if(this._parent===null)throw new y(g.NotImplemented);return this._parent._expandPagedSet(e,t,n,s,i)})}_expandPagedSetFeatureSet(e,t,n,s,i){return c(this,null,function*(){if(e._known.length>0&&e._known[e._known.length-1]==="GETPAGES"&&(s=1),s===0&&e._candidates.length>0&&e._candidates[e._candidates.length-1]==="GETPAGES"&&(s=2),s===0)return"finished";let o=yield this._getPage(e,s,i);return n+o<t?this._expandPagedSet(e,t,n+o,0,i):"success"})}_getPage(e,t,n){return c(this,null,function*(){let s=t===1?e._known:e._candidates;if(e.pagesDefinition.internal.set.length>e.pagesDefinition.resultOffset||e.pagesDefinition.internal.fullyResolved===!0){s.length=s.length-1;let i=0;for(let l=0;l<e.pagesDefinition.resultRecordCount&&!(e.pagesDefinition.resultOffset+l>=e.pagesDefinition.internal.set.length);l++)s[s.length]=e.pagesDefinition.internal.set[e.pagesDefinition.resultOffset+l],i++;e.pagesDefinition.resultOffset+=i;let o=!1;return e.pagesDefinition.internal.fullyResolved===!0&&e.pagesDefinition.internal.set.length<=e.pagesDefinition.resultOffset&&(o=!0),o===!1&&s.push("GETPAGES"),i}return yield this._getPhysicalPage(e,t,n),this._getPage(e,t,n)})}_getPhysicalPage(e,t,n){return null}_clonePageDefinition(e){return this._parent===null?null:this._parent._clonePageDefinition(e)}_first(e){return this.iterator(e).next()}first(e){return this._first(e)}calculateStatistic(e,t,n,s){return c(this,null,function*(){yield this._ensureLoaded();let i=yield this._stat(e,t,"",null,null,n,s);return i.calculated===!1&&(i=yield this._manualStat(e,t,n,s)),i.result})}_manualStat(e,t,n,s){return c(this,null,function*(){let i=null;switch(e.toLowerCase()){case"count":return i=yield Re(this,s),{calculated:!0,result:i};case"distinct":return i=yield Pe(this,t,n,s),{calculated:!0,result:i};case"avg":case"mean":return i=yield Ee(this,t,s),{calculated:!0,result:i};case"stdev":return i=yield Ae(this,t,s),{calculated:!0,result:i};case"variance":return i=yield ve(this,t,s),{calculated:!0,result:i};case"sum":return i=yield Ce(this,t,s),{calculated:!0,result:i};case"min":return i=yield be(this,t,s),{calculated:!0,result:i};case"max":return i=yield De(this,t,s),{calculated:!0,result:i};default:return{calculated:!0,result:0}}})}_stat(e,t,n,s,i,o,l){return c(this,null,function*(){let u=yield this._parent._stat(e,t,n,s,i,o,l);return u.calculated===!1?i===null&&n===""&&s===null?this._manualStat(e,t,o,l):{calculated:!1}:u})}_unionAllGeomSelf(e){let t=this.iterator(this._defaultTracker(e)),n=[];return new Promise((s,i)=>{this._unionShapeInBatches(n,t,s,i)})}_unionAllGeom(e){return new Promise((t,n)=>{let s=this.iterator(this._defaultTracker(e)),i=[];this._unionShapeInBatches(i,s,t,n)})}_unionShapeInBatches(e,t,n,s){t.next().then(i=>{try{i!==null&&i.geometry!==null&&e.push(i.geometry),e.length>30||i===null&&e.length>1?ce(e).then(o=>{try{i===null?n(o):(e=[o],this._unionShapeInBatches(e,t,n,s))}catch(l){s(l)}},s):i===null?e.length===1?n(e[0]):n(null):this._unionShapeInBatches(e,t,n,s)}catch(o){s(o)}},s)}iterator(e){return new L(this,e)}intersection(e,t=!1){return a._featuresetFunctions.intersection.bind(this)(e,t)}difference(e,t=!1,n=!0){return a._featuresetFunctions.difference.bind(this)(e,t,n)}symmetricDifference(e,t=!1,n=!0){return a._featuresetFunctions.symmetricDifference.bind(this)(e,t,n)}morphShape(e,t,n="unknown",s=null){return a._featuresetFunctions.morphShape.bind(this)(e,t,n,s)}morphShapeAndAttributes(e,t,n="unknown"){return a._featuresetFunctions.morphShapeAndAttributes.bind(this)(e,t,n)}union(e,t=!1){return a._featuresetFunctions.union.bind(this)(e,t)}intersects(e){return a._featuresetFunctions.intersects.bind(this)(e)}envelopeIntersects(e){return a._featuresetFunctions.envelopeIntersects.bind(this)(e)}contains(e){return a._featuresetFunctions.contains.bind(this)(e)}overlaps(e){return a._featuresetFunctions.overlaps.bind(this)(e)}relate(e,t){return a._featuresetFunctions.relate.bind(this)(e,t)}within(e){return a._featuresetFunctions.within.bind(this)(e)}touches(e){return a._featuresetFunctions.touches.bind(this)(e)}top(e){return a._featuresetFunctions.top.bind(this)(e)}crosses(e){return a._featuresetFunctions.crosses.bind(this)(e)}buffer(e,t,n,s=!0){return a._featuresetFunctions.buffer.bind(this)(e,t,n,s)}filter(e,t=null){return a._featuresetFunctions.filter.bind(this)(e,t)}orderBy(e){return a._featuresetFunctions.orderBy.bind(this)(e)}dissolve(e,t){return a._featuresetFunctions.dissolve.bind(this)(e,t)}groupby(e,t){return a._featuresetFunctions.groupby.bind(this)(e,t)}reduce(e,t=null,n){return new Promise((s,i)=>{this._reduceImpl(this.iterator(this._defaultTracker(n)),e,t,0,s,i,0)})}_reduceImpl(e,t,n,s,i,o,l){try{if(++l>1e3)return void setTimeout(()=>{l=0,this._reduceImpl(e,t,n,s,i,o,l)});e.next().then(u=>{try{if(u===null)i(n);else{let d=t(n,u,s,this);O(d)?d.then(f=>{this._reduceImpl(e,t,f,s+1,i,o,l)},o):this._reduceImpl(e,t,d,s+1,i,o,l)}}catch(d){o(d)}},o)}catch(u){o(u)}}removeField(e){return a._featuresetFunctions.removeField.bind(this)(e)}addField(e,t,n=null){return a._featuresetFunctions.addField.bind(this)(e,t,n)}sumArea(e,t=!1,n){let s=X(e);return this.reduce((i,o)=>o.geometry===null?0:t?pe(o.geometry,s).then(l=>i+l):he(o.geometry,s).then(l=>i+l),0,n)}sumLength(e,t=!1,n){let s=ee(e);return this.reduce((i,o)=>o.geometry===null?0:t?fe(o.geometry,s).then(l=>i+l):de(o.geometry,s).then(l=>i+l),0,n)}_substituteVars(e,t){if(t!==null){let n={};for(let s in t)n[s.toLowerCase()]=t[s];e.parameters=n}}distinct(e,t=1e3,n=null,s){return c(this,null,function*(){yield this.load();let i=T.create(e,this.getFieldsIndex(),this.dateFieldsTimeZoneDefaultUTC);return this._substituteVars(i,n),this.calculateStatistic("distinct",i,t,this._defaultTracker(s))})}min(e,t=null,n){return c(this,null,function*(){yield this.load();let s=T.create(e,this.getFieldsIndex(),this.dateFieldsTimeZoneDefaultUTC);return this._substituteVars(s,t),this.calculateStatistic("min",s,-1,this._defaultTracker(n))})}max(e,t=null,n){return c(this,null,function*(){yield this.load();let s=T.create(e,this.getFieldsIndex(),this.dateFieldsTimeZoneDefaultUTC);return this._substituteVars(s,t),this.calculateStatistic("max",s,-1,this._defaultTracker(n))})}avg(e,t=null,n){return c(this,null,function*(){yield this.load();let s=T.create(e,this.getFieldsIndex(),this.dateFieldsTimeZoneDefaultUTC);return this._substituteVars(s,t),this.calculateStatistic("avg",s,-1,this._defaultTracker(n))})}sum(e,t=null,n){return c(this,null,function*(){yield this.load();let s=T.create(e,this.getFieldsIndex(),this.dateFieldsTimeZoneDefaultUTC);return this._substituteVars(s,t),this.calculateStatistic("sum",s,-1,this._defaultTracker(n))})}stdev(e,t=null,n){return c(this,null,function*(){yield this.load();let s=T.create(e,this.getFieldsIndex(),this.dateFieldsTimeZoneDefaultUTC);return this._substituteVars(s,t),this.calculateStatistic("stdev",s,-1,this._defaultTracker(n))})}variance(e,t=null,n){return c(this,null,function*(){yield this.load();let s=T.create(e,this.getFieldsIndex(),this.dateFieldsTimeZoneDefaultUTC);return this._substituteVars(s,t),this.calculateStatistic("variance",s,-1,this._defaultTracker(n))})}count(e){return c(this,null,function*(){return yield this.load(),this.calculateStatistic("count",T.create("1",this.getFieldsIndex(),this.dateFieldsTimeZoneDefaultUTC),-1,this._defaultTracker(e))})}_defaultTracker(e){return e??{aborted:!1}}forEach(e,t){return new Promise((n,s)=>{this._forEachImpl(this.iterator(this._defaultTracker(t)),e,this,n,s,0)})}_forEachImpl(e,t,n,s,i,o){try{if(++o>1e3)return void setTimeout(()=>{o=0,this._forEachImpl(e,t,n,s,i,o)},0);e.next().then(l=>{try{if(l===null)s(n);else{let u=t(l);u==null?this._forEachImpl(e,t,n,s,i,o):O(u)?u.then(()=>{try{this._forEachImpl(e,t,n,s,i,o)}catch(d){i(d)}},i):this._forEachImpl(e,t,n,s,i,o)}}catch(u){i(u)}},i)}catch(l){i(l)}}convertToJSON(e){let t={layerDefinition:{geometryType:this.geometryType,fields:[]},featureSet:{features:[],geometryType:this.geometryType}};for(let n=0;n<this.fields.length;n++)t.layerDefinition.fields.push(M(this.fields[n]));return this.reduce((n,s)=>{let i={geometry:s.geometry?.toJSON(),attributes:{}};for(let o in s.attributes)i.attributes[o]=s.attributes[o];return t.featureSet.features.push(i),1},0,e).then(()=>t)}castToText(e=!1){return"object, FeatureSet"}queryAttachments(e,t,n,s,i){return this._parent.queryAttachments(e,t,n,s,i)}serviceUrl(){return this._parent.serviceUrl()}subtypeMetaData(){return this.subtypeField&&this.subtypes?{subtypeField:this.subtypeField,subtypes:this.subtypes?this.subtypes.map(e=>({name:e.name,code:e.code})):[]}:this.typeIdField?{subtypeField:this.typeIdField,subtypes:this.types?this.types.map(e=>({name:e.name,code:e.id})):[]}:null}relationshipMetaData(){return this._parent.relationshipMetaData()}get gdbVersion(){return this._parent?this._parent.gdbVersion:""}schema(){let e=[];for(let t of this.fields)e.push(M(t));return{objectIdField:this.objectIdField,globalIdField:this.globalIdField,geometryType:$[this.geometryType]===void 0?"esriGeometryNull":$[this.geometryType],fields:e}}convertToText(e,t){return c(this,null,function*(){if(e==="schema")return yield this._ensureLoaded(),JSON.stringify(this.schema());if(e==="featureset"){yield this._ensureLoaded();let n=[];yield this.reduce((i,o)=>{let l={geometry:o.geometry?o.geometry.toJSON():null,attributes:o.attributes};return l.geometry!==null&&l.geometry.spatialReference&&delete l.geometry.spatialReference,n.push(l),1},0,t);let s=this.schema();return s.features=n,s.spatialReference=this.spatialReference.toJSON(),JSON.stringify(s)}return this.castToText()})}getFeatureByObjectId(e,t){return this._parent.getFeatureByObjectId(e,t)}getOwningSystemUrl(){return this._parent.getOwningSystemUrl()}getIdentityUser(){return this._parent.getIdentityUser()}getRootFeatureSet(){return this._parent!==null?this._parent.getRootFeatureSet():this}getDataSourceFeatureSet(){return this._parent!==null?this._parent.getDataSourceFeatureSet():this}castAsJson(e=null){return e?.featureset==="keeptype"?this:e?.featureset==="none"?null:{type:"FeatureSet"}}castAsJsonAsync(e=null,t=null){return c(this,null,function*(){if(t?.featureset==="keeptype")return this;if(t?.featureset==="schema")return yield this._ensureLoaded(),JSON.parse(JSON.stringify(this.schema()));if(t?.featureset==="none")return null;yield this._ensureLoaded();let n=[];yield this.reduce((i,o)=>{let l={geometry:o.geometry?t?.keepGeometryType===!0?o.geometry:o.geometry.toJSON():null,attributes:o.attributes};return l.geometry!==null&&l.geometry.spatialReference&&t?.keepGeometryType!==!0&&delete l.geometry.spatialReference,n.push(l),1},0,e);let s=this.schema();return s.features=n,s.spatialReference=t?.keepGeometryType===!0?this.spatialReference:this.spatialReference?.toJSON(),s})}fieldTimeZone(e){return this.getFieldsIndex().getTimeZone(e)}get preferredTimeZone(){return this._parent?.preferredTimeZone??null}get dateFieldsTimeZone(){return this._parent?.dateFieldsTimeZone??null}get dateFieldsTimeZoneDefaultUTC(){if(this.datesInUnknownTimezone)return"unknown";let e=this.dateFieldsTimeZone??"UTC";return e===""?"UTC":e}get datesInUnknownTimezone(){return this._parent.datesInUnknownTimezone}get editFieldsInfo(){return this._parent?.editFieldsInfo??null}get timeInfo(){return this._parent?.timeInfo??null}set featureSetInfo(e){this.fsetInfo=e}getFeatureSetInfo(){return c(this,null,function*(){return this.fsetInfo??(yield this._parent?.getFeatureSetInfo())??null})}}return a._featuresetFunctions={},a})();var D=class extends I{constructor(r){super(r),this.declaredClass="esri.layers.featureset.sources.Empty",this._maxProcessing=1e3,this._wset=new S([],[],!1,null),this._parent=r.parentfeatureset,this._databaseType=h.Standardised}_getSet(){return c(this,null,function*(){return this._wset})}optimisePagingFeatureQueries(){}_isInFeatureSet(){return w.NotInFeatureSet}_getFeature(){return c(this,null,function*(){throw new y(g.NeverReach)})}queryAttachments(){return c(this,null,function*(){return[]})}_getFeatures(){return c(this,null,function*(){return"success"})}_featureFromCache(){return null}_fetchAndRefineFeatures(){return c(this,null,function*(){throw new y(g.NeverReach)})}_getFilteredSet(){return c(this,null,function*(){return new S([],[],!1,null)})}_stat(r,e,t,n,s,i,o){return this._manualStat(r,e,i,o)}_canDoAggregates(){return c(this,null,function*(){return!1})}};var ke=class a extends I{constructor(r){super(r),this._relation="",this._relationGeom=null,this._relationString="",this.declaredClass="esri.arcade.featureset.actions.SpatialFilter",this._relationString=r.relationString,this._parent=r.parentfeatureset,this._maxProcessing=40,this._relation=r.relation,this._relationGeom=r.relationGeom}_getSet(r){return c(this,null,function*(){if(this._wset===null){yield this._ensureLoaded();let e=yield this._parent._getFilteredSet(this._relation!=="esriSpatialRelRelation"?this._relation:this._relation+":"+this._relationString,this._relationGeom,null,null,r);return this._checkCancelled(r),this._wset=new S(e._candidates.slice(0),e._known.slice(0),e._ordered,this._clonePageDefinition(e.pagesDefinition)),this._wset}return this._wset})}_isInFeatureSet(r){let e=this._parent._isInFeatureSet(r);return e===w.NotInFeatureSet?e:(e=this._idstates[r],e===void 0?w.Unknown:e)}_getFeature(r,e,t){return this._parent._getFeature(r,e,t)}_getFeatures(r,e,t,n){return this._parent._getFeatures(r,e,t,n)}_featureFromCache(r){return this._parent._featureFromCache(r)}executeSpatialRelationTest(r){return c(this,null,function*(){if(r.geometry===null)return!1;switch(this._relation){case"esriSpatialRelEnvelopeIntersects":return q(B(this._relationGeom),B(r.geometry));case"esriSpatialRelIntersects":return q(this._relationGeom,r.geometry);case"esriSpatialRelContains":return ne(this._relationGeom,r.geometry);case"esriSpatialRelOverlaps":return le(this._relationGeom,r.geometry);case"esriSpatialRelWithin":return oe(this._relationGeom,r.geometry);case"esriSpatialRelTouches":return ie(this._relationGeom,r.geometry);case"esriSpatialRelCrosses":return se(this._relationGeom,r.geometry);case"esriSpatialRelRelation":return ue(this._relationGeom,r.geometry,this._relationString??"")}})}_fetchAndRefineFeatures(r,e,t){return c(this,null,function*(){let n=new S([],r,!1,null),s=Math.min(e,r.length);yield this._parent?._getFeatures(n,-1,s,t),this._checkCancelled(t);let i=[];for(let o=0;o<s;o++){let l=this._parent._featureFromCache(r[o]);i.push(yield this.executeSpatialRelationTest(l))}for(let o=0;o<e;o++)i[o]===!0?this._idstates[r[o]]=w.InFeatureSet:this._idstates[r[o]]=w.NotInFeatureSet;return"success"})}_getFilteredSet(r,e,t,n,s){return c(this,null,function*(){yield this._ensureLoaded();let i=yield this._parent._getFilteredSet(this._relation!=="esriSpatialRelRelation"?this._relation:this._relation+":"+this._relationString,this._relationGeom,t,n,s),o;return this._checkCancelled(s),o=e!==null?new S(i._candidates.slice(0).concat(i._known.slice(0)),[],i._ordered,this._clonePageDefinition(i.pagesDefinition)):new S(i._candidates.slice(0),i._known.slice(0),i._ordered,this._clonePageDefinition(i.pagesDefinition)),o})}_stat(r,e,t,n,s,i,o){return c(this,null,function*(){if(t!=="")return{calculated:!1};let l=yield this._parent._stat(r,e,this._relation!=="esriSpatialRelRelation"?this._relation:this._relation+":"+this._relationString,this._relationGeom,s,i,o);return l.calculated===!1?s===null&&t===""&&n===null?this._manualStat(r,e,i,o):{calculated:!1}:l})}_canDoAggregates(r,e,t,n,s){return c(this,null,function*(){return t===""&&n===null&&this._parent!==null&&this._parent._canDoAggregates(r,e,this._relation!=="esriSpatialRelRelation"?this._relation:this._relation+":"+this._relationString,this._relationGeom,s)})}_getAggregatePagesDataSourceDefinition(r,e,t,n,s,i,o){return c(this,null,function*(){if(this._parent===null)throw new y(g.NeverReach);return this._parent._getAggregatePagesDataSourceDefinition(r,e,this._relation!=="esriSpatialRelRelation"?this._relation:this._relation+":"+this._relationString,this._relationGeom,s,i,o)})}static registerAction(){I._featuresetFunctions.intersects=function(r){return r==null?new D({parentfeatureset:this}):new a({parentfeatureset:this,relation:"esriSpatialRelIntersects",relationGeom:r})},I._featuresetFunctions.envelopeIntersects=function(r){return r==null?new D({parentfeatureset:this}):new a({parentfeatureset:this,relation:"esriSpatialRelEnvelopeIntersects",relationGeom:r})},I._featuresetFunctions.contains=function(r){return r==null?new D({parentfeatureset:this}):new a({parentfeatureset:this,relation:"esriSpatialRelContains",relationGeom:r})},I._featuresetFunctions.overlaps=function(r){return r==null?new D({parentfeatureset:this}):new a({parentfeatureset:this,relation:"esriSpatialRelOverlaps",relationGeom:r})},I._featuresetFunctions.within=function(r){return r==null?new D({parentfeatureset:this}):new a({parentfeatureset:this,relation:"esriSpatialRelWithin",relationGeom:r})},I._featuresetFunctions.touches=function(r){return r==null?new D({parentfeatureset:this}):new a({parentfeatureset:this,relation:"esriSpatialRelTouches",relationGeom:r})},I._featuresetFunctions.crosses=function(r){return r==null?new D({parentfeatureset:this}):new a({parentfeatureset:this,relation:"esriSpatialRelCrosses",relationGeom:r})},I._featuresetFunctions.relate=function(r,e){return r==null?new D({parentfeatureset:this}):new a({parentfeatureset:this,relation:"esriSpatialRelRelation",relationGeom:r,relationString:e})}}getFieldsIndex(){return this._parent.getFieldsIndex()}};export{E as a,S as b,_e as c,Ze as d,Qe as e,Ke as f,Ne as g,Q as h,me as i,ge as j,H as k,Le as l,Se as m,Je as n,Te as o,xe as p,it as q,ot as r,I as s,D as t,ke as u};
