import{a as P,b as k}from"./chunk-TICXV5QZ.js";import{a as u}from"./chunk-RXMXYODQ.js";import{b as F}from"./chunk-A3KX3DLS.js";import{a as L,h as N}from"./chunk-VOLKMATP.js";import{l as w}from"./chunk-KNDM5UGY.js";import{a as b}from"./chunk-EKKBMKVP.js";import{c as E}from"./chunk-XAHD7XBV.js";import{b as I,c as v,h as x,r as y}from"./chunk-XSMN6VN6.js";import{a as B}from"./chunk-FOPE5Y6E.js";import{b as T}from"./chunk-37H4LYIE.js";import{e as A}from"./chunk-XDMNA7OV.js";import{c as O,g as D,h as V,i as z,j as C}from"./chunk-V5AJXD2Y.js";import{b as S,c as R}from"./chunk-MLSR6YE6.js";var Y=0;function h(d,e,t){return new k(Y++,d,d.meshWriter.name,e,t)}var m={geometry:{visualVariableColor:null,visualVariableOpacity:null,visualVariableSizeMinMaxValue:null,visualVariableSizeScaleStops:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null,visualVariableRotation:null}},p=class{constructor(){this.instances={fill:h(u.fill,m,{zoomRange:!0}),marker:h(u.marker,m,{zoomRange:!0}),line:h(u.line,m,{zoomRange:!0}),text:h(u.text,m,{zoomRange:!0,referenceSymbol:!1,clipAngle:!1}),complexFill:h(u.complexFill,m,{zoomRange:!0}),texturedLine:h(u.texturedLine,m,{zoomRange:!0})},this._instancesById=Object.values(this.instances).reduce((e,t)=>(e.set(t.instanceId,t),e),new Map)}getInstance(e){return this._instancesById.get(e)}};var X=Math.PI/180,J=4,_=class extends L{constructor(e){super(),this._program=null,this._vao=null,this._vertexBuffer=null,this._indexBuffer=null,this._dvsMat3=B(),this._localOrigin={x:0,y:0},this._getBounds=e}destroy(){this._vao&&(this._vao.dispose(),this._vao=null,this._vertexBuffer=null,this._indexBuffer=null),this._program=R(this._program)}doRender(e){let{context:t}=e,i=this._getBounds();if(i.length<1)return;this._createShaderProgram(t),this._updateMatricesAndLocalOrigin(e),this._updateBufferData(t,i),t.setBlendingEnabled(!0),t.setDepthTestEnabled(!1),t.setStencilWriteMask(0),t.setStencilTestEnabled(!1),t.setBlendFunction(v.ONE,v.ONE_MINUS_SRC_ALPHA),t.setColorMask(!0,!0,!0,!0);let n=this._program;t.bindVAO(this._vao),t.useProgram(n),n.setUniformMatrix3fv("u_dvsMat3",this._dvsMat3),t.gl.lineWidth(1),t.drawElements(I.LINES,8*i.length,x.UNSIGNED_INT,0),t.bindVAO()}_createTransforms(){return{displayViewScreenMat3:B()}}_createShaderProgram(e){if(this._program)return;let t=`precision highp float;
        uniform mat3 u_dvsMat3;

        attribute vec2 a_position;

        void main() {
          mediump vec3 pos = u_dvsMat3 * vec3(a_position, 1.0);
          gl_Position = vec4(pos.xy, 0.0, 1.0);
        }`,i=`precision mediump float;
      void main() {
        gl_FragColor = vec4(0.75, 0.0, 0.0, 0.75);
      }`;this._program=e.programCache.acquire(t,i,U().attributes)}_updateMatricesAndLocalOrigin(e){let{state:t}=e,{displayMat3:i,size:n,resolution:f,pixelRatio:a,rotation:o,viewpoint:r}=t,l=X*o,{x:s,y:q}=r.targetGeometry,G=A(s,t.spatialReference);this._localOrigin.x=G,this._localOrigin.y=q;let M=a*n[0],g=a*n[1],W=f*M,H=f*g,c=O(this._dvsMat3);D(c,c,i),V(c,c,T(M/2,g/2)),C(c,c,E(n[0]/W,-g/H,1)),z(c,c,-l)}_updateBufferData(e,t){let{x:i,y:n}=this._localOrigin,f=2*J*t.length,a=new Float32Array(f),o=new Uint32Array(8*t.length),r=0,l=0;for(let s of t)s&&(a[2*r]=s[0]-i,a[2*r+1]=s[1]-n,a[2*r+2]=s[0]-i,a[2*r+3]=s[3]-n,a[2*r+4]=s[2]-i,a[2*r+5]=s[3]-n,a[2*r+6]=s[2]-i,a[2*r+7]=s[1]-n,o[l]=r+0,o[l+1]=r+3,o[l+2]=r+3,o[l+3]=r+2,o[l+4]=r+2,o[l+5]=r+1,o[l+6]=r+1,o[l+7]=r+0,r+=4,l+=8);if(this._vertexBuffer?this._vertexBuffer.setData(a.buffer):this._vertexBuffer=b.createVertex(e,y.DYNAMIC_DRAW,a.buffer),this._indexBuffer?this._indexBuffer.setData(o):this._indexBuffer=b.createIndex(e,y.DYNAMIC_DRAW,o),!this._vao){let s=U();this._vao=new F(e,s.attributes,s.bufferLayouts,{geometry:this._vertexBuffer},this._indexBuffer)}}},U=()=>w("bounds",{geometry:[{location:0,name:"a_position",count:2,type:x.FLOAT}]});var j=class extends P{constructor(e){super(e),this._instanceStore=new p,this.checkHighlight=()=>!0}destroy(){super.destroy(),this._boundsRenderer=S(this._boundsRenderer)}get instanceStore(){return this._instanceStore}enableRenderingBounds(e){this._boundsRenderer=new _(e),this.requestRender()}get hasHighlight(){return this.checkHighlight()}onTileData(e,t){e.onMessage(t),this.contains(e)||this.addChild(e),this.requestRender()}_renderChildren(e,t){e.selection=t;for(let i of this.children){if(!i.visible)continue;i.getDisplayList(e.drawPhase,this._instanceStore,N.STRICT_ORDER)?.render(e)}}};export{j as a};
