import{a as Re}from"./chunk-2MVYKHX3.js";import{b as Q}from"./chunk-7DPBVZFZ.js";import{H as je,J as Pe}from"./chunk-JIFV566L.js";import{a as W}from"./chunk-MT7CYQIO.js";import{a as De,b as P,g as L,l as X}from"./chunk-C64FPBS5.js";import{a as Ee}from"./chunk-2F3ICBUH.js";import{a as Ie}from"./chunk-TALIOOAA.js";import{i as A,k as J,m as z}from"./chunk-DHY7QZ2H.js";import{a as c}from"./chunk-MFP2OFDR.js";import{c as _e}from"./chunk-YC7IXNOA.js";import{a as we}from"./chunk-MMZZL453.js";import{a as V}from"./chunk-WXS2B4FF.js";import{a as xe,b as ve,c as Se}from"./chunk-RMOIVYM4.js";import{c as Ve,e as Ne,k as Ce,n as N}from"./chunk-Q3WN5PJ6.js";import{c as B}from"./chunk-AQ74ANSJ.js";import{a as M}from"./chunk-XKXYUJUA.js";import{a as Z}from"./chunk-UE2YGKE7.js";import{a as be}from"./chunk-D2ITYHSM.js";import{_ as K}from"./chunk-CTGIUUCS.js";import{F as i,Q as v,b as ue,q as ce}from"./chunk-VWEBO6QK.js";import{I as he,M as fe,N as ge,S as u,b as me,w as ye}from"./chunk-KAAR5ZJN.js";import{a as r}from"./chunk-W3WDPWBE.js";import{p as de}from"./chunk-WKT5W7KT.js";import{b as n,p as j,r as pe}from"./chunk-X3IDZTNG.js";import{p as ae}from"./chunk-IQJU4QT3.js";import{a as $,b as ne,d as le,h}from"./chunk-EAH6BNBL.js";var Oe="esri.renderers.support.DictionaryLoader",ke={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}},F=class{constructor(t,o,s){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new _e(100),this._dictionaryVersion=null,this._fieldIndex=null,this._dictionaryPromise=null,this.url=t,this.config=o,this.fieldMap=s}getSymbolFields(){return this._symbolFields}getSymbolAsync(t,o){return h(this,null,function*(){let s;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(o));try{s=yield this._dictionaryPromise}catch(d){if(de(d))return this._dictionaryPromise=null,null}let l=this._dictionaryVersion&&this._dictionaryVersion.since(4,0),m={};if(this.fieldMap)for(let d of this._symbolFields){let f=Pe(this.fieldMap[d],this._fieldIndex);if(f){let p=t.attributes[f];m[d]=l?p:p!=null?""+t.attributes[f]:""}else m[d]=""}let a=null;try{a=s?.(m,o)}catch{return null}if(!a||typeof a!="string"||a==="invalid")return null;let D=a.split(";"),E=[],b=[];for(let d of D)if(d)if(d.includes("po:")){let f=d.substr(3).split("|");if(f.length===3){let p=f[0],S=f[1],w=f[2];if(S==="DashTemplate")w=w.split(" ").map(_=>Number(_));else if(S==="Color"){let _=new c(w).toRgba();w=[_[0],_[1],_[2],255*_[3]]}else w=Number(w);b.push({primitiveName:p,propertyName:S,value:w,defaultValue:null})}}else if(d.includes("|")){for(let f of d.split("|"))if(this._itemNames.has(f)){E.push(f);break}}else this._itemNames.has(d)&&E.push(d);let T=t.geometry==null||!t.geometry.hasZ&&t.geometry.type==="point";return this._cimPartsToCIMSymbol(t,E,b,T,o)})}fetchResources(t){return h(this,null,function*(){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void j.getLogger(Oe).error("no valid URL!");let o=K(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:t!=null?t.signal:null}),[{data:s}]=yield Promise.all([o,Ve()]);if(!s)throw this._dictionaryPromise=null,new pe("esri.renderers.DictionaryRenderer","Bad dictionary data!");let{authoringInfo:l,dictionary_version:m,expression:a,itemsNames:D}=s,E=a,b=!1;m&&(this._dictionaryVersion=Ee.parse(m),b=this._dictionaryVersion.since(4,0)),this._refSymbolUrlTemplate=this.url+"/"+s.cimRefTemplateUrl,this._itemNames=new Set(D),this._symbolFields=l.symbol;let T={};if(this.config){let p=this.config;for(let S in p)T[S]=p[S]}if(l.configuration)for(let p of l.configuration)T.hasOwnProperty(p.name)||(T[p.name]=p.value);let d=[];if(t?.fields&&this.fieldMap)for(let p in this.fieldMap){let S=this.fieldMap[p],w=t.fields.filter(_=>_.name.toLowerCase()===S?.toLowerCase());w.length>0&&d.push(ne($({},w[0]),{type:b?w[0].type:"esriFieldTypeString"}))}d.length>0&&(this._fieldIndex=new we(d));let f=Ne(E,t!=null?t.spatialReference:null,d,T).then(p=>{let S={scale:0};return(w,_)=>{if(p==null)return null;let He=p.repurposeFeature({geometry:null,attributes:w});return S.scale=_!=null?_.scale??void 0:void 0,p.evaluate({$feature:He,$view:S},p.services)}}).catch(p=>(j.getLogger(Oe).error("Creating dictinoary expression failed:",p),null));return this._dictionaryPromise=f,f})}_cimPartsToCIMSymbol(t,o,s,l,m){return h(this,null,function*(){let a=new Array(o.length);for(let b=0;b<o.length;b++)a[b]=this._getSymbolPart(o[b],m);let D=yield Promise.all(a),E=this.fieldMap;if(E){D=n(D);for(let b of D)Re.applyDictionaryTextOverrides(b,t,E,this._fieldIndex,je(b))}return new Ie({data:this._combineSymbolParts(D,s,l)})})}_getSymbolPart(t,o){return h(this,null,function*(){let s=this._symbolCache.get(t);if(s)return s;if(this._ongoingRequests.has(t))return this._ongoingRequests.get(t).then(a=>a.data);let l=this._refSymbolUrlTemplate.replaceAll(/\{itemName\}/gi,t),m=K(l,$({responseType:"json",query:{f:"json"}},o));this._ongoingRequests.set(t,m),m.finally(()=>this._ongoingRequests.delete(t));try{let a=yield m;return this._symbolCache.put(t,a.data),a.data}catch(a){throw a}})}_combineSymbolParts(t,o,s){if(!t||t.length===0)return null;let l=$({},t[0]);if(t.length>1){l.symbolLayers=[];for(let m of t){let a=m;l.symbolLayers.unshift(...a.symbolLayers)}}return s&&(l.callout=ke),{type:"CIMSymbolReference",symbol:l,primitiveOverrides:o}}};var Y,I=Y=class extends L(P){constructor(e){super(e),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new F(this.url,this.config,this.fieldMap)}writeData(e,t){e&&(t.scalingExpressionInfo={expression:e,returnType:"number"})}writeVisualVariables(e,t,o,s){s?.origin||super.writeVisualVariables(e,t,o,s)}clone(){return new Y({config:n(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:n(this.fieldMap),url:n(this.url),visualVariables:n(this.visualVariables)})}getSymbolAsync(e,t){return h(this,null,function*(){return this._loader.getSymbolAsync(e,t)})}collectRequiredFields(e,t){return h(this,null,function*(){yield this.collectVVRequiredFields(e,t),this.scaleExpression&&(yield N(e,t,this.scaleExpression));for(let o in this.fieldMap){let s=this.fieldMap[o];t.has(s)&&e.add(s)}})}get arcadeRequired(){return!0}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};r([i({type:F})],I.prototype,"_loader",null),r([i({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],I.prototype,"config",void 0),r([i({type:Object,json:{write:!0}})],I.prototype,"fieldMap",void 0),r([i({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],I.prototype,"scaleExpression",void 0),r([Z("scaleExpression")],I.prototype,"writeData",null),r([i({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(e){return{enabled:!!e&&!!this.scaleExpression}}}}})],I.prototype,"scaleExpressionTitle",void 0),r([i({type:String,json:{write:!0}})],I.prototype,"url",void 0),r([Z("visualVariables")],I.prototype,"writeVisualVariables",null),I=Y=r([u("esri.renderers.DictionaryRenderer")],I);var Te=I;var ee,R=ee=class extends v{constructor(e){super(e),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(e){return e==null?e:typeof e=="function"?(j.getLogger(this).error(".field: field must be a string value"),null):ye(e)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new ee({color:this.color?.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};r([i({type:c,json:{type:[Number],write:!0}})],R.prototype,"color",void 0),r([i({type:String,json:{write:!0}})],R.prototype,"field",void 0),r([be("field")],R.prototype,"castField",null),r([i({type:String,json:{write:!0}})],R.prototype,"label",void 0),r([i({type:String,json:{write:!0}})],R.prototype,"valueExpression",void 0),r([i({type:String,json:{write:!0}})],R.prototype,"valueExpressionTitle",void 0),R=ee=r([u("esri.renderers.support.AttributeColorInfo")],R);var U=R;var te,G=te=class extends v{constructor(){super(...arguments),this.unit=null}clone(){return new te({unit:this.unit})}};r([i({type:String,json:{write:!0}})],G.prototype,"unit",void 0),G=te=r([u("esri.renderers.support.DotDensityLegendOptions")],G);var Me=G;var re,g=re=class extends L(P){constructor(e){super(e),this.attributes=null,this.backgroundColor=new c([0,0,0,0]),this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new A,this.dotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(e){if(this.referenceScale==null)return this.dotValue;let t=e/this.referenceScale*this.dotValue;return t<1?1:t}getSymbol(){return new J({outline:this.outline})}getSymbolAsync(){return h(this,null,function*(){return this.getSymbol()})}getSymbols(){return[this.getSymbol()]}getAttributeHash(){return this.attributes?.reduce((e,t)=>e+t.getAttributeHash(),"")??""}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new re({attributes:n(this.attributes),backgroundColor:n(this.backgroundColor),dotBlendingEnabled:n(this.dotBlendingEnabled),dotShape:n(this.dotShape),dotSize:n(this.dotSize),dotValue:n(this.dotValue),legendOptions:n(this.legendOptions),outline:n(this.outline),referenceScale:n(this.referenceScale),seed:n(this.seed),visualVariables:n(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}getControllerHash(){return`${this.attributes?.map(t=>t.field||t.valueExpression||"")}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}collectRequiredFields(e,t){return h(this,null,function*(){yield this.collectVVRequiredFields(e,t);for(let o of this.attributes??[])o.valueExpression&&(yield N(e,t,o.valueExpression)),o.field&&e.add(o.field)})}};r([i({type:[U],json:{write:!0}})],g.prototype,"attributes",void 0),r([i({type:c,json:{write:!0}})],g.prototype,"backgroundColor",void 0),r([i({type:Boolean,json:{write:!0}})],g.prototype,"dotBlendingEnabled",void 0),r([i({type:String,json:{write:!1}})],g.prototype,"dotShape",void 0),r([i({type:Number,json:{write:!0}})],g.prototype,"dotSize",void 0),r([i({type:Me,json:{write:!0}})],g.prototype,"legendOptions",void 0),r([i({type:A,json:{default:null,write:!0}})],g.prototype,"outline",void 0),r([i({type:Number,json:{write:!0}})],g.prototype,"dotValue",void 0),r([i({type:Number,json:{write:!0}})],g.prototype,"referenceScale",void 0),r([i({type:Number,json:{write:!0}})],g.prototype,"seed",void 0),r([M({dotDensity:"dot-density"})],g.prototype,"type",void 0),g=re=r([u("esri.renderers.DotDensityRenderer")],g);var Le=g;var ie,q=ie=class extends v{constructor(e){super(e),this.color=null,this.ratio=null}clone(){return new ie({color:this.color&&this.color.clone(),ratio:this.ratio})}};r([i({type:c,json:{type:[he],default:null,write:!0}})],q.prototype,"color",void 0),r([i({type:Number,json:{write:!0}})],q.prototype,"ratio",void 0),q=ie=r([u("esri.renderers.support.HeatmapColorStop")],q);var H=q;var O=class extends V(v){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};r([i({type:String,json:{write:!0}})],O.prototype,"minLabel",void 0),r([i({type:String,json:{write:!0}})],O.prototype,"maxLabel",void 0),r([i({type:String,json:{write:!0}})],O.prototype,"title",void 0),O=r([u("esri.renderers.support.HeatmapLegendOptions")],O);var oe;function Ae(e){if(e!=null){let{maxDensity:o,minDensity:s,radius:l}=e;if(o!=null||s!=null||l!=null){let t=e,{blurRadius:m,maxPixelIntensity:a,minPixelIntensity:D}=t;return le(t,["blurRadius","maxPixelIntensity","minPixelIntensity"])}}return e}var y=oe=class extends P{constructor(e){super(e),this.authoringInfo=null,this.colorStops=[new H({ratio:0,color:new c("rgba(255, 140, 0, 0)")}),new H({ratio:.75,color:new c("rgba(255, 140, 0, 1)")}),new H({ratio:.9,color:new c("rgba(255, 0,   0, 1)")})],this.field=null,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null,this._warnedProps={blurRadius:!1,maxPixelIntensity:!1,minPixelIntensity:!1}}normalizeCtorArgs(e){return Ae(e)}get blurRadius(){return Se(this.radius)}set blurRadius(e){let t=this.maxPixelIntensity,o=this.minPixelIntensity;this._set("radius",ve(e)),this._warnAboutDeprecatedGaussianBlurProp("blurRadius","radius"),this._set("maxDensity",t*this._pixelIntensityToDensity),this._set("minDensity",o*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(e){this._set("maxDensity",e*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("maxPixelIntensity","maxDensity")}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(e){this._set("minDensity",e*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("minPixelIntensity","minDensity")}get _pixelIntensityToDensity(){return 24/(xe**2*this.blurRadius**4)}_warnAboutDeprecatedGaussianBlurProp(e,t){this._warnedProps[e]||me(this).getDefaultOrigin()==="user"&&(this._warnedProps[e]=!0,ce(()=>{ue(j.getLogger(this),e,{replacement:`${String(t)} (suggested value: ${this._get(t)})`,version:"4.24"})}))}read(e,t){e=Ae(e),super.read(e,t)}getSymbol(){return new z}getSymbolAsync(){return h(this,null,function*(){return this.getSymbol()})}getSymbols(){return[this.getSymbol()]}collectRequiredFields(e,t){return h(this,null,function*(){let o=this.field,s=this.valueExpression;o&&typeof o=="string"&&Ce(e,t,o),s&&typeof s=="string"&&(yield N(e,t,s))})}getAttributeHash(){return null}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new oe({authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),colorStops:n(this.colorStops),field:this.field,legendOptions:n(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};r([i({type:De,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],y.prototype,"authoringInfo",void 0),r([i({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],y.prototype,"blurRadius",null),r([i({type:[H],json:{write:!0}})],y.prototype,"colorStops",void 0),r([i({type:String,json:{write:!0}})],y.prototype,"field",void 0),r([i({type:O,json:{write:!0}})],y.prototype,"legendOptions",void 0),r([i({type:Number,json:{write:!0}})],y.prototype,"maxDensity",void 0),r([i({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],y.prototype,"maxPixelIntensity",null),r([i({type:Number,json:{write:!0}})],y.prototype,"minDensity",void 0),r([i({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],y.prototype,"minPixelIntensity",null),r([i({type:Number,cast:B,json:{write:!0}})],y.prototype,"radius",void 0),r([i({type:Number,range:{min:0},json:{default:0,write:!0}})],y.prototype,"referenceScale",void 0),r([M({heatmap:"heatmap"})],y.prototype,"type",void 0),r([i({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],y.prototype,"valueExpression",void 0),r([i({type:String})],y.prototype,"valueExpressionTitle",void 0),r([i({readOnly:!0})],y.prototype,"_pixelIntensityToDensity",null),y=oe=r([u("esri.renderers.HeatmapRenderer")],y);var se=y;var C=class extends V(v){constructor(){super(...arguments),this.color=new c([0,0,0,0]),this.label=null,this.threshold=0}};r([i({type:c,json:{write:!0}})],C.prototype,"color",void 0),r([i({type:String,json:{write:!0}})],C.prototype,"label",void 0),r([i({type:Number,range:{min:0,max:1},json:{write:!0}})],C.prototype,"threshold",void 0),C=r([u("esri.renderers.support.OthersCategory")],C);var k=class extends V(v){constructor(){super(...arguments),this.title=null}};r([i({type:String,json:{write:!0}})],k.prototype,"title",void 0),k=r([u("esri.renderers.support.PieChartLegendOptions")],k);var x=class extends L(V(P)){constructor(e){super(e),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new c([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new C,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart"}getSymbol(){return new z({size:this.size?this.size/2+(this.outline?.width||0):0})}getSymbolAsync(){return h(this,null,function*(){return this.getSymbol()})}getSymbols(){return[this.getSymbol(),this.backgroundFillSymbol].filter(ae)}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((e,t)=>e+JSON.stringify(t),"")}collectRequiredFields(e,t){return h(this,null,function*(){yield this.collectVVRequiredFields(e,t);for(let o of this.attributes)o.valueExpression&&(yield N(e,t,o.valueExpression)),o.field&&e.add(o.field)})}};r([i({type:[U],json:{write:!0}})],x.prototype,"attributes",void 0),r([i({type:J,json:{default:null,write:!0}})],x.prototype,"backgroundFillSymbol",void 0),r([i({type:c,json:{write:!0}})],x.prototype,"defaultColor",void 0),r([i({type:String,json:{write:!0}})],x.prototype,"defaultLabel",void 0),r([i({type:Number,range:{min:0,max:1},json:{write:!0}})],x.prototype,"holePercentage",void 0),r([i({type:C,json:{write:!0}})],x.prototype,"othersCategory",void 0),r([i({type:k,json:{write:!0}})],x.prototype,"legendOptions",void 0),r([i({type:A,json:{default:null,write:!0}})],x.prototype,"outline",void 0),r([i({type:Number,cast:B,json:{write:!0}})],x.prototype,"size",void 0),r([M({pieChart:"pie-chart"})],x.prototype,"type",void 0),x=r([u("esri.renderers.PieChartRenderer")],x);var Fe=x;var qe={key:"type",base:P,typeMap:{heatmap:se,simple:W,"unique-value":X,"class-breaks":Q,"dot-density":Le,dictionary:Te,"pie-chart":Fe},errorContext:"renderer"},Wi={key:"type",base:P,typeMap:{simple:W,"unique-value":X,"class-breaks":Q,heatmap:se},errorContext:"renderer",validate:$e};function $e(e){switch(e.type){case"simple":return Be(e);case"unique-value":return Je(e);case"class-breaks":return ze(e);case"heatmap":return e}}function Be(e){if(e.symbol)return e;j.getLogger("esri.renderers.support.types").error("Removed invalid 'simple' renderer without a symbol from web scene.")}function Je(e){let t=e.uniqueValueInfos,o=t?.filter(({symbol:s,label:l},m)=>(s||j.getLogger("esri.renderers.support.types").error(`Removed invalid unique value info ([${m}] ${l}) without a symbol from web scene.`),!!s));return o?.length!==t?.length&&(e.uniqueValueInfos=o),e}function ze(e){let t=e.classBreakInfos,o=t?.filter(({symbol:s,label:l},m)=>(s||j.getLogger("esri.renderers.support.types").error(`Removed invalid class break info ([${m}] ${l}) without a symbol from web scene.`),!!s));return o?.length!==t?.length&&(e.classBreakInfos=o),e}function ro(e,t){return Ge(e,null,t)}var Ue=ge({types:qe});function Ge(e,t,o){return e?e&&(e.styleName||e.styleUrl)&&e.type!=="uniqueValue"?(o?.messages&&o.messages.push(new fe("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+e.type+"'",{definition:e,context:o})),null):Ue(e,t,o):null}export{H as a,qe as b,Wi as c,ro as d,Ge as e};
