import{d as rn,f as Fr,g as gn,h as bn,o as _n,q as Ke}from"./chunk-KNDM5UGY.js";import{e as wn}from"./chunk-EKKBMKVP.js";import{c as Br}from"./chunk-TEXQFKMJ.js";import{a as H,b as Ls,d as Rs,e as on,h as un,i as pn,k as hn,l as dn,m as fn,r as Ws}from"./chunk-V2ACH6PW.js";import{a as mn}from"./chunk-NOUYXRP4.js";import{a as Xe}from"./chunk-RHABF3KL.js";import{a as sn,b as nn,c as vn}from"./chunk-2MJIH6TV.js";import{a as zs,c as Bs,k as xn}from"./chunk-OGOKP66I.js";import{a as kr,b as Vr,c as Cr,q as Er,s as Dr}from"./chunk-BZEC7TCW.js";import{D as Nt,E as en,G as At,a as qe,b as Ze,e as Qi,f as Ji,y as tn}from"./chunk-WD4CT5CX.js";import{a as Zi}from"./chunk-Z33JZO3Q.js";import{h as y}from"./chunk-XSMN6VN6.js";import{a as Xi}from"./chunk-I46GU3Q4.js";import{a as an,e as cn,g as ln,h as Or,k as zr}from"./chunk-AC7AQWXQ.js";import{a as ji}from"./chunk-X4LAWCTR.js";import{D as Nr}from"./chunk-JIFV566L.js";import{a as yn}from"./chunk-MFP2OFDR.js";import{a as Ki}from"./chunk-ADXKVFX6.js";import{n as Ye}from"./chunk-J57HR4DB.js";import{a as Yi}from"./chunk-GNCG2SQP.js";import{a as T}from"./chunk-AQ74ANSJ.js";import{b as qi}from"./chunk-F7PIPM6E.js";import{b as Os}from"./chunk-6FWNINU2.js";import{F as Ns,I as Hi}from"./chunk-VWEBO6QK.js";import{S as $i,v as Ui}from"./chunk-KAAR5ZJN.js";import{a as p,b as k}from"./chunk-W3WDPWBE.js";import{h as Gi,m as Ai,p as Gt,r as me}from"./chunk-X3IDZTNG.js";import{a as de,c as Pr}from"./chunk-IQJU4QT3.js";import{a as _,b as A,g as Wt,h as ct}from"./chunk-EAH6BNBL.js";var Lr=class extends Hi{constructor(r){super(r),this.debugName="",this._updatingHandles=new Ki,this._idToUpdatingState=new ji}get updating(){let r=this._updatingHandles.updating||Array.from(this._idToUpdatingState.values()).some(t=>t);if(de("esri-2d-log-updating")){let t=Array.from(this._idToUpdatingState.entries()).map(([e,s])=>`-> ${e}: ${s}`).join(`
`);console.log(`${this.debugName}: Updating: ${r}
-> Handles: ${this._updatingHandles.updating}
${t}`)}return r}addUpdateTracking(r,t){let e=Yi(()=>t.updating,s=>this._idToUpdatingState.set(r,s),{sync:!0});this.addHandles(e)}addPromise(r){return this._updatingHandles.addPromise(r)}};p([Ns({constructOnly:!0})],Lr.prototype,"debugName",void 0),p([Ns({readOnly:!0})],Lr.prototype,"updating",null),Lr=p([$i("esri.view.2d.layers.support.UpdateTracking2D")],Lr);var Mo=96/72,Rr=class{static executeEffects(t,e,s,i){let n=Mo,o=Ws(t),a=new Ls(e);for(let c of t){let l=Rs(c);l&&(a=l.execute(a,c,n,s,i,o))}return a}static applyEffects(t,e,s){if(!t)return e;let i=Ws(t),n,o=new Ls(H.fromJSONCIM(e));for(let l of t){let u=Rs(l);u&&(o=u.execute(o,l,1,null,s,i))}let a=[],c=null;for(;n=o.next();)a.push(...qi(n)),c=n.geometryType;return a.length===0||c===null?null:c==="esriGeometryPolygon"?{rings:a}:{paths:a}}};var Sn;(function(r){r[r.Geographic=0]="Geographic",r[r.Arithmatic=1]="Arithmatic"})(Sn||(Sn={}));var mc=3.14159265359/180,In=3.14159265359/128,fc=180/3.141592654,yc=1/8;var xc=1,Tn=1.1,Mn=1,gc=1/4,bc=1/8;var vc=24,wc=8;var Pn=1e-5,Gs=.05;var Fn=1e-30;var fe=4;var ye=0,Wr=2,Gr=5,Ar=6,kn=2,Vn=3,Cn=0,En=3,Dn=16777216;var Nn=()=>Gt.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder"),Ur=class{constructor(){this._includedModules=new Map}include(t,e){if(this._includedModules.has(t)){let s=this._includedModules.get(t);if(s!==e){Nn().error("Trying to include shader module multiple times with different sets of options.");let i=new Set;for(let n of Object.keys(s))s[n]!==t[n]&&i.add(n);for(let n of Object.keys(t))s[n]!==t[n]&&i.add(n);i.forEach(n=>console.error(`  ${n}: current ${s[n]} new ${t[n]}`))}}else this._includedModules.set(t,e),t(this.builder,e)}},$r=class extends Ur{constructor(){super(...arguments),this.vertex=new Hr,this.fragment=new Hr,this.attributes=new $s,this.varyings=new Hs,this.extensions=new je,this.constants=new Yr}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(t,e=!0){let s=this.extensions.generateSource(t),i=this.attributes.generateSource(t),n=this.varyings.generateSource(t),o=t==="vertex"?this.vertex:this.fragment,a=o.uniforms.generateSource(),c=o.code.generateSource(),l=t==="vertex"?Fo:Po(e),u=this.constants.generateSource().concat(o.constants.generateSource());return`${e?"#version 300 es":""}
${s.join(`
`)}
${l}
${u.join(`
`)}
${a.join(`
`)}
${i.join(`
`)}
${n.join(`
`)}
${c.join(`
`)}`}generateBindPass(t){let e=new Map;this.vertex.uniforms.entries.forEach(n=>{let o=n.bind[Xe.Pass];o&&e.set(n.name,o)}),this.fragment.uniforms.entries.forEach(n=>{let o=n.bind[Xe.Pass];o&&e.set(n.name,o)});let s=Array.from(e.values()),i=s.length;return(n,o)=>{for(let a=0;a<i;++a)s[a](t,n,o)}}generateBindDraw(t){let e=new Map;this.vertex.uniforms.entries.forEach(n=>{let o=n.bind[Xe.Draw];o&&e.set(n.name,o)}),this.fragment.uniforms.entries.forEach(n=>{let o=n.bind[Xe.Draw];o&&e.set(n.name,o)});let s=Array.from(e.values()),i=s.length;return(n,o,a)=>{for(let c=0;c<i;++c)s[c](t,n,o,a)}}},As=class{constructor(){this._entries=new Map}add(...t){for(let e of t)this._add(e)}get(t){return this._entries.get(t)}_add(t){if(t!=null){if(this._entries.has(t.name)&&!this._entries.get(t.name).equals(t))throw new me(`Duplicate uniform name ${t.name} for different uniform type`);this._entries.set(t.name,t)}else Nn().error(`Trying to add null Uniform from ${new Error().stack}.`)}generateSource(){return Array.from(this._entries.values()).map(t=>t.arraySize!=null?`uniform ${t.type} ${t.name}[${t.arraySize}];`:`uniform ${t.type} ${t.name};`)}get entries(){return Array.from(this._entries.values())}},Us=class{constructor(){this._entries=new Array}add(t){this._entries.push(t)}generateSource(){return this._entries}},Hr=class extends Ur{constructor(){super(...arguments),this.uniforms=new As,this.code=new Us,this.constants=new Yr}get builder(){return this}},$s=class{constructor(){this._entries=new Array}add(t,e){this._entries.push([t,e])}generateSource(t){return t==="fragment"?[]:this._entries.map(e=>`in ${e[1]} ${e[0]};`)}},Hs=class{constructor(){this._entries=new Map}add(t,e){this._entries.has(t)&&Xi(this._entries.get(t)===e),this._entries.set(t,e)}generateSource(t){let e=new Array;return this._entries.forEach((s,i)=>e.push(t==="vertex"?`out ${s} ${i};`:`in ${s} ${i};`)),e}},je=class r{constructor(){this._entries=new Set}add(t){this._entries.add(t)}generateSource(t){let e=t==="vertex"?r.ALLOWLIST_VERTEX:r.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(s=>e.includes(s)).map(s=>`#extension ${s} : enable`)}};je.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],je.ALLOWLIST_VERTEX=[];var Yr=class r{constructor(){this._entries=new Set}add(t,e,s){let i="ERROR_CONSTRUCTOR_STRING";switch(e){case"float":i=r._numberToFloatStr(s);break;case"int":i=r._numberToIntStr(s);break;case"bool":i=s.toString();break;case"vec2":i=`vec2(${r._numberToFloatStr(s[0])},                            ${r._numberToFloatStr(s[1])})`;break;case"vec3":i=`vec3(${r._numberToFloatStr(s[0])},                            ${r._numberToFloatStr(s[1])},                            ${r._numberToFloatStr(s[2])})`;break;case"vec4":i=`vec4(${r._numberToFloatStr(s[0])},                            ${r._numberToFloatStr(s[1])},                            ${r._numberToFloatStr(s[2])},                            ${r._numberToFloatStr(s[3])})`;break;case"ivec2":i=`ivec2(${r._numberToIntStr(s[0])},                             ${r._numberToIntStr(s[1])})`;break;case"ivec3":i=`ivec3(${r._numberToIntStr(s[0])},                             ${r._numberToIntStr(s[1])},                             ${r._numberToIntStr(s[2])})`;break;case"ivec4":i=`ivec4(${r._numberToIntStr(s[0])},                             ${r._numberToIntStr(s[1])},                             ${r._numberToIntStr(s[2])},                             ${r._numberToIntStr(s[3])})`;break;case"mat2":case"mat3":case"mat4":i=`${e}(${Array.prototype.map.call(s,n=>r._numberToFloatStr(n)).join(", ")})`}return this._entries.add(`const ${e} ${t} = ${i};`),this}static _numberToIntStr(t){return t.toFixed(0)}static _numberToFloatStr(t){return Number.isInteger(t)?t.toFixed(1):t.toString()}generateSource(){return Array.from(this._entries)}};function Po(r=!0){return`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump sampler2D;
#endif
${r?"out vec4 fragColor;":""}
`}var Fo=`precision highp float;
precision highp sampler2D;`;function ko(r){return r.split(" ").map((t,e)=>e>0?t.charAt(0).toUpperCase()+t.slice(1):t).join("")}function On(r,t){let e=[];for(e.push(t);e.length;){let s=e.pop();if(typeof s=="object"&&!r.has(s.uid)){r.add(s.uid);for(let i of s.children)e.push(i)}}}var Ot=class r{constructor(){this.uid=r.NodeCount++,this._debugName=null,this._isMutable=!1,this.isImplicit=!1}get isMutable(){return this._isMutable}setMutable(){return this._isMutable=!0,this}setDebugName(t){return t=ko(t),this._debugName=t,this.isImplicit&&this.children[0]instanceof r&&this.children[0].setDebugName(t),this}get debugInfo(){return{name:this._debugName??""}}cloneInto(t){t._debugName=this._debugName,t._isMutable=this._isMutable,t.isImplicit=this.isImplicit,t.uid=this.uid}};function g(r){return typeof r=="object"?r.clone():r}Ot.NodeCount=0;var G=class extends Ot{constructor(){super(...arguments),this.shaderType="primitive-node"}},qr=class r extends Ot{constructor(t){super(),this.child=t,this.shaderType="scope-node"}get children(){return[this.child]}clone(){let t=new r(g(this.child));return this.cloneInto(t),t}};var Zr=class r extends Ot{constructor(t,e,s){super(),this.property=t,this.target=e,this.returnType=s,this.shaderType="property-access-node"}get children(){let t=[this.target];return typeof this.property!="string"&&t.push(this.property),t}clone(){let t=new r(this.property,g(this.target),this.returnType);return this.cloneInto(t),t}},Xr=class r extends Ot{constructor(t,e,s){super(),this.condition=t,this.ifTrue=e,this.ifFalse=s,this.shaderType="condition-node"}get children(){return[this.condition,this.ifTrue,this.ifFalse]}clone(){let t=g(this.ifTrue),e=this.ifFalse?g(this.ifFalse):null,s=new r(this.condition,t,e);return this.cloneInto(s),s}},Kr=class r extends Ot{constructor(t,e,s,i){super(),this.captureList=t,this.returnType=e,this.generator=i,this.shaderType="block-node",s&&(this.subgraph=new qr(s))}get children(){return Object.keys(this.captureList).map(t=>this.captureList[t]).concat(this.subgraph??[])}clone(){let t={};for(let s in this.captureList)t[s]=g(this.captureList[s]);let e=new r(t,this.returnType,this.subgraph?g(this.subgraph.child):this.subgraph,this.generator);return this.cloneInto(e),e}},It=class r extends Ot{constructor(t,e,s,i,n,o=!1){super(),this.token=t,this._children=e,this.isInfix=s,this.isPropertyAccess=i,this.returnType=n,this.isTernary=o,this.shaderType="function-node"}get children(){return this._children}clone(){let t=new r(this.token,this._children.map(g),this.isInfix,this.isPropertyAccess,this.returnType,this.isTernary);return this.cloneInto(t),t}};var Qe,Ys,qs,Zs,Xs,Ks,js,Qs,Js,ti,ei,ri,si,ii;function Vo(r){let t=[["float","vec2","vec3","vec4"],["int","ivec2","ivec3","ivec4"],["uint","uvec2","uvec3","uvec4"],["bool","bvec2","bvec3","bvec4"]];for(let e of t)if(e.includes(r))return e.map(s=>Do[s]);throw new Error("Unable to find type family")}function zn(r){return new Proxy(r,{get(t,e){if(e==="constructor")return new Proxy(t.constructor,{construct:(s,i,n)=>zn(new s(...i))});if(e in t)return t[e];if(typeof e=="string"){let s=Vo(r.type);return J(r,e,s[e.length-1])}}})}function tt(r){return new Proxy(r,{construct:(t,e,s)=>zn(new t(...e))})}function Co(r){return new Proxy(r,{get(t,e){if(e in t)return t[e];if(typeof e=="string"){let s=parseInt(e,10);if(!isNaN(s))return J(r,`[${s}]`,r.elementType.constructor)}}})}function Eo(r){return new Proxy(r,{construct:(t,e,s)=>Co(new t(...e))})}var Je=class extends Error{},K=Qe=class extends G{constructor(r,t){super(),this.elementType=r,this.size=t,this.children=[],this.type="array"}clone(){let r=new Qe(this.elementType,this.size);return super.cloneInto(r),r}get(r){if(typeof r=="number"){let t=new Ut(r);return t.isImplicit=!0,J(this,t,this.elementType.constructor)}return J(this,r,this.elementType.constructor)}last(){return this.get(this.size-1)}first(){return this.get(0)}findIndex(r,t,e){return No(this,r,t,e)}glslFindIndex(r,t,e){return Oo(this,r,t,e)}static ofType(r,t){let e={construct:(s,i)=>new Qe(new r,t)};return new Proxy(Qe,e)}};K.type="array",K=Qe=p([Eo],K);var Tt=(()=>{class r extends G{constructor(){super(...arguments),this.type="sampler2D",this.children=[]}clone(){let e=new r;return e.children=this.children.map(g),super.cloneInto(e),e}}return r.type="sampler2D",r})(),d=(()=>{class r extends G{constructor(e){super(),this.type="float",this.children=[e]}clone(){let e=new r(g(this.children[0]));return super.cloneInto(e),e}multiply(e){return $t(this,typeof e=="number"?U(e,r):e)}divide(e){return ge(this,typeof e=="number"?U(e,r):e)}add(e){return be(this,typeof e=="number"?U(e,r):e)}subtract(e){return er(this,typeof e=="number"?U(e,r):e)}}return r.type="float",r})(),I=Ys=class extends G{constructor(r,t){super(),this.type="vec2",this.children=[r,t].filter(e=>e!=null)}clone(){let r=new Ys(g(this.children[0]),g(this.children[1]));return super.cloneInto(r),r}get 0(){return J(this,"[0]",d)}get 1(){return J(this,"[1]",d)}get 2(){throw new Je}get 3(){throw new Je}multiply(r){return $t(this,typeof r=="number"?U(r,d):r)}divide(r){return ge(this,typeof r=="number"?U(r,d):r)}add(r){return be(this,typeof r=="number"?U(r,d):r)}subtract(r){return er(this,typeof r=="number"?U(r,d):r)}};I.type="vec2",I=Ys=p([tt],I);var N=qs=class extends G{constructor(r,t,e){super(),this.type="vec3",this.children=[r,t,e].filter(s=>s!=null)}get 0(){return J(this,"[0]",d)}get 1(){return J(this,"[1]",d)}get 2(){return J(this,"[2]",d)}get 3(){throw new Je}clone(){let r=new qs(g(this.children[0]),g(this.children[1]),g(this.children[2]));return super.cloneInto(r),r}multiply(r){return $t(this,typeof r=="number"?U(r,d):r)}divide(r){return ge(this,typeof r=="number"?U(r,d):r)}add(r){return be(this,typeof r=="number"?U(r,d):r)}subtract(r){return er(this,typeof r=="number"?U(r,d):r)}};N.type="vec3",N=qs=p([tt],N);var F=Zs=class extends G{constructor(r,t,e,s){super(),this.type="vec4",this.children=[r,t,e,s].filter(i=>i!=null)}clone(){let r=new Zs(g(this.children[0]),g(this.children[1]),g(this.children[2]),g(this.children[3]));return super.cloneInto(r),r}get 0(){return J(this,"[0]",d)}get 1(){return J(this,"[1]",d)}get 2(){return J(this,"[2]",d)}get 3(){return J(this,"[3]",d)}multiply(r){return $t(this,typeof r=="number"?U(r,d):r)}divide(r){return ge(this,typeof r=="number"?U(r,d):r)}add(r){return be(this,typeof r=="number"?U(r,d):r)}subtract(r){return er(this,typeof r=="number"?U(r,d):r)}};F.type="vec4",F=Zs=p([tt],F);var jr=Xs=class extends G{constructor(r){super(),this.type="uint",this.children=[r]}clone(){let r=new Xs(g(this.children[0]));return super.cloneInto(r),r}};jr.type="uint",jr=Xs=p([tt],jr);var Qr=Ks=class extends G{constructor(r,t){super(),this.type="uvec2",this.children=[r,t].filter(e=>e!=null)}clone(){let r=new Ks(g(this.children[0]),g(this.children[1]));return super.cloneInto(r),r}};Qr.type="uvec2",Qr=Ks=p([tt],Qr);var Jr=js=class extends G{constructor(r,t,e){super(),this.type="uvec3",this.children=[r,t,e].filter(s=>s!=null)}clone(){let r=new js(g(this.children[0]),g(this.children[1]),g(this.children[2]));return super.cloneInto(r),r}};Jr.type="uvec3",Jr=js=p([tt],Jr);var ts=Qs=class extends G{constructor(r,t,e,s){super(),this.type="uvec4",this.children=[r,t,e,s].filter(i=>i!=null)}clone(){let r=new Qs(g(this.children[0]),g(this.children[1]),g(this.children[2]),g(this.children[3]));return super.cloneInto(r),r}};ts.type="uvec4",ts=Qs=p([tt],ts);var ut=(()=>{class r extends G{constructor(e){super(),this.type="bool",this.children=[e]}and(e){return as(this,e)}or(e){return ai(this,e)}clone(){let e=new r(g(this.children[0]));return super.cloneInto(e),e}}return r.type="bool",r})(),es=Js=class extends G{constructor(r,t){super(),this.type="bvec2",this.children=[r,t].filter(e=>e!=null)}all(){return ci(this)}any(){return li(this)}clone(){let r=new Js(g(this.children[0]),g(this.children[1]));return super.cloneInto(r),r}};es.type="bvec2",es=Js=p([tt],es);var rs=ti=class extends G{constructor(r,t,e){super(),this.type="bvec3",this.children=[r,t,e].filter(s=>s!=null)}all(){return ci(this)}any(){return li(this)}clone(){let r=new ti(g(this.children[0]),g(this.children[1]),g(this.children[2]));return super.cloneInto(r),r}};function U(r,t){return typeof r=="number"?new t(r):r}rs.type="bvec3",rs=ti=p([tt],rs);var ss=ei=class extends G{constructor(r,t,e,s){super(),this.type="bvec4",this.children=[r,t,e,s].filter(i=>i!=null)}all(){return ci(this)}any(){return li(this)}clone(){let r=new ei(g(this.children[0]),g(this.children[1]),g(this.children[2]),g(this.children[3]));return super.cloneInto(r),r}};ss.type="bvec4",ss=ei=p([tt],ss);var Ut=(()=>{class r extends G{constructor(e){super(),this.type="int",this.children=[e]}multiply(e){return $t(this,U(e,r))}add(e){return be(this,U(e,r))}subtract(e){return er(this,U(e,r))}divide(e){return ge(this,U(e,r))}clone(){let e=new r(g(this.children[0]));return super.cloneInto(e),e}}return r.type="int",r})(),is=ri=class extends G{constructor(r,t){super(),this.type="ivec2",this.children=[r,t].filter(e=>e!=null)}clone(){let r=new ri(g(this.children[0]),g(this.children[1]));return super.cloneInto(r),r}};is.type="ivec2",is=ri=p([tt],is);var ns=si=class extends G{constructor(r,t,e){super(),this.type="ivec3",this.children=[r,t,e].filter(s=>s!=null)}clone(){let r=new si(g(this.children[0]),g(this.children[1]),g(this.children[2]));return super.cloneInto(r),r}};ns.type="ivec3",ns=si=p([tt],ns);var os=ii=class extends G{constructor(r,t,e,s){super(),this.type="ivec4",this.children=[r,t,e,s].filter(i=>i!=null)}clone(){let r=new ii(g(this.children[0]),g(this.children[1]),g(this.children[2]),g(this.children[3]));return super.cloneInto(r),r}};os.type="ivec4",os=ii=p([tt],os);var et=(()=>{class r extends G{static identity(){return new r(1,0,0,0,1,0,0,0,1)}static fromRotation(e){let s=ir(e),i=ui(e);return new r(i,s,0,xe(s),i,0,0,0,1)}constructor(e,s,i,n,o,a,c,l,u){super(),this.type="mat3",this.children=[e,s,i,n,o,a,c,l,u]}add(e){return be(this,e)}multiply(e){return $t(this,e)}clone(){let e=new r(g(this.children[0]),g(this.children[1]),g(this.children[2]),g(this.children[3]),g(this.children[4]),g(this.children[5]),g(this.children[6]),g(this.children[7]),g(this.children[8]));return super.cloneInto(e),e}}return r.type="mat3",r})(),Cc=(()=>{class r extends G{static identity(){return new r(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}constructor(e,s,i,n,o,a,c,l,u,h,m,f,x,v,w,S){super(),this.type="mat4",this.children=[e,s,i,n,o,a,c,l,u,h,m,f,x,v,w,S]}static fromColumns(e,s,i,n){return new r(e.x,e.y,e.z,e.w,s.x,s.y,s.z,s.w,i.x,i.y,i.z,i.w,n.x,n.y,n.z,n.w)}multiply(e){return $t(this,e)}clone(){let e=new r(g(this.children[0]),g(this.children[1]),g(this.children[2]),g(this.children[3]),g(this.children[4]),g(this.children[5]),g(this.children[6]),g(this.children[7]),g(this.children[8]),g(this.children[9]),g(this.children[10]),g(this.children[11]),g(this.children[12]),g(this.children[13]),g(this.children[14]),g(this.children[15]));return super.cloneInto(e),e}}return r.type="mat4",r})(),Do={float:d,vec2:I,vec3:N,vec4:F,int:Ut,ivec2:is,ivec3:ns,ivec4:os,uint:jr,uvec2:Qr,uvec3:Jr,uvec4:ts,bool:ut,bvec2:es,bvec3:rs,bvec4:ss},se=(...r)=>new Ut(...r),O=(...r)=>new d(...r),tr=(...r)=>new I(...r),Bn=(...r)=>new N(...r),Ln=(...r)=>new F(...r);var ni=(...r)=>new et(...r);function J(r,t,e){let s=new e(new Zr(t,r,e));return s.isImplicit=!0,s}function rt(r,t,e,s=null){if(s){let n=new s,o=new s(new It(r,[t,e],!0,!1,n));return o.isImplicit=!0,o}if(t.type==="float"||t.type==="int"){let n=new e.constructor(new It(r,[t,e],!0,!1,e.constructor));return n.isImplicit=!0,n}if((t.type==="mat2"||t.type==="mat3"||t.type==="mat4")&&e.type!=="float"){let n=new e.constructor(new It(r,[t,e],!0,!1,e.constructor));return n.isImplicit=!0,n}let i=new t.constructor(new It(r,[t,e],!0,!1,t.constructor));return i.isImplicit=!0,i}function lt(r,t,e=t.constructor){let s=new e(new It(r,[t],!1,!1,e));return s.isImplicit=!0,s}function ie(r,t,e,s=t.constructor){let i=new s(new It(r,[t,e],!1,!1,s));return i.isImplicit=!0,i}function oi(r,t,e,s,i=t.constructor){let n=new i(new It(r,[t,e,s],!1,!1,i));return n.isImplicit=!0,n}function xe(r){return $t(r,O(-1))}function Rn(r,t,e,s){return new t(new Kr(r,t,e,s))}function No(r,t,e=0,s=r.size){let i=new Ut(e).setMutable().setDebugName("FindIndexIterator"),n=t(r.get(i)).setDebugName("FindIndexPredicate");return Rn({iter:i},Ut,n,({out:a,iter:c,subgraph:l})=>`
${a} = -1;

for (; ${c} < ${s}; ${c}++) {

${l.body}

  if (${l.varName}) {
    ${a} = ${c};
    break;
  }

}
`).setDebugName("FindIndexBlock")}function Oo(r,t,e=0,s=r.size){return Rn({array:r},Ut,null,({out:n,array:o})=>`
${n} = -1;
for (int i = ${e}; i < ${s}; i++) {
  bool condition;
  ${t({array:o,i:"i",out:"condition"})}
  if (condition) {
    ${n} = i;
    break;
  }
}
`).setDebugName("GlslFindIndexBlock")}function D(r,t,e){let s=typeof t=="function"?t():t,i=typeof e=="function"?e():e,n=new s.constructor(new Xr(r,s,i));return n.isImplicit=!0,n}function Mt(...r){let t=r.map(([a,c])=>typeof c=="function"?[a,c()]:[a,c]),e=t[0][1].constructor,s=t.findIndex(a=>a[0]===!0);if(s===-1)throw new Error("A cond must have a fallthrough case with `true`/; ");let i=t.slice(0,s),n=t[s][1],o=new e(i.reduceRight((a,c)=>D(c[0],c[1],a),n));return o.isImplicit=!0,o}function $t(r,t){return rt("*",r,t)}function ge(r,t){return rt("/",r,t)}function be(r,t){return rt("+",r,t)}function er(r,t){return rt("-",r,t)}function Ec(r,t){return rt(">>",r,t)}function Dc(r,t){return rt("&",r,t)}function ve(r,t){return rt("==",r,t,ut)}function Wn(r,t){return rt("<",r,t,ut)}function Ht(r,t){return rt("<=",r,t,ut)}function L(r,t){return rt(">",r,t,ut)}function Yt(r,t){return rt(">=",r,t,ut)}function ai(...r){return r.length<=1?r[0]:r.slice(1).reduce((t,e)=>zo(t,e),r[0])}function zo(r,t){return rt("||",r,t,ut)}function as(...r){return r.length<=1?r[0]:r.slice(1).reduce((t,e)=>Bo(t,e),r[0])}function Bo(r,t){return rt("&&",r,t,ut)}function Gn(r){return lt("abs",r)}function ci(r){return lt("all",r,ut)}function li(r){return lt("any",r,ut)}function An(r){return lt("ceil",r)}function we(r,t,e){return oi("clamp",r,t,e,r.constructor)}function ui(r){return lt("cos",r)}function pi(r,t){return ie("distance",r,t,d)}function rr(r,t){return ie("dot",r,t,d)}function Un(r){return lt("floor",r)}function cs(r){return lt("fract",r)}function ls(r){return lt("length",r,d)}function qt(r,t){return ie("max",r,t)}function sr(r,t){return ie("min",r,t)}function st(r,t,e){return oi("mix",r,t,e)}function gt(r,t){return ie("mod",r,t)}function $n(r){return lt("normalize",r)}function Hn(r){return r.type==="bool"?lt("!",r):lt("not",r)}function ir(r){return lt("sin",r)}function Nc(r,t,e){return oi("smoothstep",r,t,e)}function bt(r,t){return ie("step",r,t,t.constructor)}function pt(r,t){return ie("texture2D",r,t,F)}function q(r,t,e){let s=t.split(`
`);for(let i of s)if(i.trim().length){{let n="";e!=null&&(n+=`/*id:${e??"000"}*/   `),r.body+=n.padEnd(14)}r.body+=" ".repeat(r.indent)+i+`
`}}var nr=class{write(t){for(let e of t.rootOutputNodes())t.shouldPruneOutputNode(e)||(e.variableName=this._write(t,e.node));return t}_createVarName(t,e){let s="";return typeof e!="boolean"&&typeof e!="number"&&e.debugInfo.name&&(s=`${e.debugInfo.name}_`),`${s}v${t.varCount++}`}_write(t,e,s=!1){if(typeof e=="number"||typeof e=="boolean")return e.toString();let i=t.getEmit(e);if(i)return i;switch(e.shaderType){case"scope-node":i=this._writeScopeNode(t,e);break;case"primitive-node":i=this._writePrimitveNode(t,e,s);break;case"function-node":i=this._writeFunctionNode(t,e);break;case"property-access-node":i=this._writePropertyAccessNode(t,e);break;case"text-node":i=e.text;break;case"block-node":i=this._writeBlockNode(t,e);break;case"condition-node":i=this._writeConditionNode(t,e)}return t.setEmit(e,i),i}_writeScopeNode(t,e){let s=new e.child.constructor;s.setDebugName(e.debugInfo.name);let i=this._write(t,s,!0);return q(t,`{ /*ScopeStart: ${e.uid} ${e.debugInfo.name}*/`),t.indent+=2,q(t,`${i} = ${this._write(t,e.child)};`),t.indent-=2,q(t,`} /*ScopeEnd: ${e.uid} ${e.debugInfo.name}*/`),i}_writeConditionNode(t,e){let s=new e.ifTrue.constructor,i=this._write(t,s,!0);q(t,`if (${this._write(t,e.condition)}) {`),t.indent+=2;let n=t.createSubgraphContext(),o=this._write(n,e.ifTrue);if(t.body+=n.body,o&&q(t,`${i} = ${o};`),t.indent-=2,q(t,"}"),e.ifFalse){q(t,"else {"),t.indent+=2;let a=t.createSubgraphContext(),c=this._write(a,e.ifFalse);t.body+=a.body,c&&q(t,`${i} = ${c};`),t.indent-=2,q(t,"}")}return i}_writeBlockNode(t,e){let{captureList:s,generator:i,returnType:n}=e,o={};for(let u in s){if(!s[u])continue;let h=this._write(t,s[u]);o[u]=h}let a=new n,c=this._write(t,a,!0);if(o.out=c,e.subgraph){let u=t.createSubgraphContext(),h=this._write(u,e.subgraph.child),m=u.body;o.subgraph={varName:h,body:m}}let l=i(o);return q(t,`{
`),t.indent+=2,q(t,l),t.indent-=2,q(t,`}
`),c}_writePropertyAccessNode(t,e){let s=this._write(t,e.target);return typeof e.property=="string"&&e.property.includes("[")?`${s}${e.property}`:typeof e.property!="string"?`${s}[${this._write(t,e.property)}]`:`${s}.${e.property}`}_writeFunctionNode(t,e){let s=e.returnType.type;if(e.isInfix){let[o,a]=e.children.map(l=>this._write(t,l)),c=this._createVarName(t,e);return q(t,`${s.padEnd(5)} ${c} = ${o} ${e.token} ${a};`,e.uid),c}let i=e.children.map(o=>this._write(t,o)).join(", "),n=this._createVarName(t,e);return q(t,`${s.padEnd(5)} ${n} = ${e.token}(${i});`,e.uid),n}_writePrimitveNode(t,e,s=!1){let i=t.getInput(e);if(i)return i.isUsed=!0,i.variableName;let n=e.children.length===1&&e.children[0]?.type===e.type;if(e.isImplicit||n)return this._write(t,e.children[0]);let o=this._createVarName(t,e);if(s)return q(t,`${e.type.padEnd(5)} ${o};`,e.uid),o;let a=!e.debugInfo.name&&!e.isMutable;if(a&&e.type==="float"&&typeof e.children[0]=="number")return Number.isInteger(e.children[0])?e.children[0].toFixed(1):e.children[0].toString();if(a&&e.type==="int"&&typeof e.children[0]=="number"&&Number.isInteger(e.children[0]))return e.children[0].toString();let c=e.children.map(l=>this._write(t,l)).join(", ");return e.type==="array"?(q(t,`${e.type.padEnd(5)} ${o} = [${c}];`,e.uid),o):a?`${e.type}(${c})`:(q(t,`${e.type.padEnd(5)} ${o} = ${e.type}(${c});`,e.uid),o)}};var Zt=class r{constructor(t,e,s){this.variableName=t,this.variableInputType=e,this.node=s,this.type="shader-input",this.isUsed=!1}clone(){return new r(this.variableName,this.variableInputType,g(this.node))}},ne=class r{constructor(t,e,s){this.outVariableName=t,this.outVariableType=e,this.node=s,this.type="shader-output"}clone(){let t=new r(this.outVariableName,this.outVariableType,g(this.node));return t.variableName=this.variableName,t}},or=class r{static createVertex(t,e,s,i,n,o){let a=[];for(let l in t){let u=t[l],h=s.get(l);h?a.push(new Zt(h,"builtin",u)):a.push(new Zt("a_"+l,"attribute",u))}for(let l of i){let u=l.uniformHydrated;a.push(new Zt(l.uniformName,"uniform",u))}let c=[];for(let l in e){let u=e[l];l==="glPosition"?c.push(new ne("gl_Position","builtin",u)):l==="glPointSize"?c.push(new ne("gl_PointSize","builtin",u)):c.push(new ne("v_"+l,"varying",u))}return new r(a,c,n,o)}static createFragment(t,e,s,i,n,o){let a=[],c=Array.from(n.rootOutputNodes());for(let u in t){let h=t[u],m=s.get(u);if(m){a.push(new Zt(m,"builtin",h));continue}let f=c.find(x=>x.node===h);f&&a.push(new Zt(f.outVariableName,f.outVariableType,h))}for(let u of i){let h=u.uniformHydrated;a.push(new Zt(u.uniformName,"uniform",h))}let l=[];for(let u in e){let h=e[u],m=s.get(u);if(u==="discard")l.push(new ne(null,"discard",h));else{if(!m)throw new Error(`Member ${u} in shader fragment output shoule be tagged as builtin`);l.push(new ne(m,"builtin",h))}}return new r(a,l,o)}constructor(t,e,s,i){this.type="shader-graph-context",this.indent=0,this.body="",this.varCount=0,this._inputShaderTypesByNodeUid=new Map,this._nodeEmitMap=new Map;for(let n of t)this._inputShaderTypesByNodeUid.set(n.node.uid,n);this._outputShaderTypes=e,this._transformFeedbackBindings=s,this._transformFeedbackNames=new Set(s.map(n=>"v_"+n.propertyKey)),this._usedInFragmentShader=i}shouldPruneOutputNode(t){return!!this._usedInFragmentShader&&t.outVariableType!=="builtin"&&!this._transformFeedbackNames.has(t.outVariableName)&&!this._usedInFragmentShader.has(t.node.uid)}setEmit(t,e){this._nodeEmitMap.set(t.uid,e)}getEmit(t){return this._nodeEmitMap.get(t.uid)}inputs(){return this._inputShaderTypesByNodeUid.values()}getInput(t){return this._inputShaderTypesByNodeUid.get(t.uid)}*rootOutputNodes(){for(let t of this._outputShaderTypes)yield t}*nodes(){let t=[];for(let e of this._outputShaderTypes.values())t.push(e.node);for(;t.length;){let e=t.pop();typeof e!="number"&&typeof e!="boolean"&&t.push(...e.children.filter(Boolean)),yield e}}*nodesOfTypeOrFunction(){for(let t of this.nodes())typeof t!="number"&&typeof t!="boolean"&&(yield t)}createSubgraphContext(){let t=this.clone();return t.body="",t.indent=this.indent+2,t._nodeEmitMap=new Map(this._nodeEmitMap),t}clone(){let t=new r([],this._outputShaderTypes,this._transformFeedbackBindings,this._usedInFragmentShader);return t._inputShaderTypesByNodeUid=this._inputShaderTypesByNodeUid,t.indent=this.indent,t.body=this.body,t.varCount=this.varCount,t._nodeEmitMap=this._nodeEmitMap,t}insertVertexShader(t){t.vertex.code.add(""),this._insertInputs(t,"vertex"),t.vertex.code.add(""),t.vertex.code.add("// OUTPUTS: "),t.vertex.code.add("// --------------------------------------------------------- ");for(let e of this.rootOutputNodes()){let s=e.outVariableType==="builtin";this.shouldPruneOutputNode(e)||(s?t.vertex.code.add(`// ${e.outVariableType.padEnd(7)} ${e.node.type.padEnd(9)} ${e.outVariableName};`):t.vertex.code.add(`${e.outVariableType.padEnd(10)} ${e.node.type.padEnd(9)} ${e.outVariableName};`))}t.vertex.code.add(""),t.vertex.code.add("void main() {"),t.vertex.code.add("  "+this.body.split(`
`).join(`
  `));for(let e of this.rootOutputNodes())this.shouldPruneOutputNode(e)||t.vertex.code.add(`  ${e.outVariableName} = ${e.variableName};`);t.vertex.code.add("}")}insertFragmentShader(t){this._insertInputs(t,"fragment"),t.fragment.code.add(""),t.fragment.code.add("void main() {"),t.fragment.code.add("  "+this.body.split(`
`).join(`
  `));for(let e of this.rootOutputNodes())e.outVariableType==="discard"?(t.fragment.code.add("  // TODO: Should ensure codegen for discard appears first in fragment shader"),t.fragment.code.add(`  if (${e.variableName}) {`),t.fragment.code.add("    discard;"),t.fragment.code.add("  }"),t.fragment.code.add("  ")):t.fragment.code.add(`  ${e.outVariableName} = ${e.variableName};`);t.fragment.code.add("}")}_insertInputs(t,e){t[e].code.add("// INPUTS: "),t[e].code.add("// --------------------------------------------------------- ");for(let s of this.inputs())s.isUsed&&s.variableInputType!=="builtin"&&(s.node.type==="array"?t[e].code.add(`${s.variableInputType.padEnd(10)} ${s.node.elementType.type.padEnd(9)} ${s.variableName}[${s.node.size}];`):t[e].code.add(`${s.variableInputType.padEnd(10)} ${s.node.type.padEnd(9)} ${s.variableName};`))}};var Lo=()=>Gt.getLogger("esri.views.2d.engine.webgl.shaderGraph.typed.TypedShaderProgram");function ar(r,t,e){let s=t.length;if(s!==e){let i=new me("Invalid Uniform",`Invalid length, expected ${e} but got ${s}`,{uniformName:r,values:t});Lo().errorOnce(i)}}var cr=class{constructor(t,e,s,i,n,o){this._program=null,this._vao=null,this._temporaryTextures=[],this.vertexShader=t,this.fragmentShader=e,this._locations=s,this._locationInfo=i,this._uniformBindings=n,this._transformFeedbackBindings=o}destroy(){this._program&&this._program.dispose(),this.cleanupTemporaryTextures()}get locations(){return this._locations}get locationInfo(){return this._locationInfo}setUniforms(t){this._uniforms=t}cleanupTemporaryTextures(){for(let t of this._temporaryTextures)t.dispose();this._temporaryTextures=[]}bind(t){let e=this._uniforms;if(!this._program){let i=new Map;for(let[o,a]of this._locations)i.set(o,a);let n=[];for(let o of this._transformFeedbackBindings??[]){let{index:a,propertyKey:c}=o;n[a]=`v_${c}`}this._program=new wn(t,this.vertexShader,this.fragmentShader,i,new Map,n)}let s=this._program;t.useProgram(s);for(let i of this._uniformBindings){let{shaderModulePath:n,uniformName:o,uniformType:a,uniformArrayLength:c}=i,l=Gi(n,e);if(l==null){if(a==="sampler2D")continue;throw new Error(`Failed to find uniform value for ${n}`)}switch(a==="array"?i.uniformArrayElementType:a){case"sampler2D":{let{unit:u,texture:h}=l;if(s.setUniform1i(o,u),"type"in h)t.bindTexture(h,u);else{let m=_n(t,h.descriptor,h.data);t.bindTexture(m,u)}break}case"int":if(!c){s.setUniform1i(o,l);break}ar(i.uniformName,l,c),s.setUniform1iv(o,l);break;case"float":if(!c){s.setUniform1f(o,l);break}ar(i.uniformName,l,c),s.setUniform1fv(o,l);break;case"vec2":if(!c){s.setUniform2f(o,l[0],l[1]);break}ar(i.uniformName,l,c),s.setUniform2fv(o,l.flat());break;case"vec3":if(!c){s.setUniform3f(o,l[0],l[1],l[2]);break}ar(i.uniformName,l,c),s.setUniform3fv(o,l.flat());break;case"vec4":if(!c){s.setUniform4f(o,l[0],l[1],l[2],l[3]);break}ar(i.uniformName,l,c),s.setUniform4fv(o,l.flat());break;case"mat3":s.setUniformMatrix3fv(o,l.flat());break;case"mat4":s.setUniformMatrix4fv(o,l.flat());break;default:throw new Error(`Unable to set uniform for type ${a}`)}}}};function lr(r){return new r}function Se(r,t,e){let s=r.constructor[t]??[];r.constructor.hasOwnProperty(t)||Object.defineProperty(r.constructor,t,{value:s.slice()}),r.constructor[t].push(e)}function M(r,t){return(e,s)=>{Se(e,"locations",{typeCtor:t,propertyKey:s,parameterIndex:null,index:r})}}var Ro=r=>(t,e)=>{Se(t,"builtins",{builtin:r,propertyKey:e})},C=r=>(t,e,s)=>{Se(t,"inputs",{inputCtor:r,propertyKey:e,parameterIndex:s})},b=r=>(t,e)=>{Se(t,"uniforms",{typeCtor:r,propertyKey:e})},$=r=>(t,e)=>{Se(t,"options",{typeCtor:r,propertyKey:e})},di=(r,t)=>{Se(r,"defines",{propertyKey:t})};var hi=(r,t)=>(e,s)=>{e.constructor.builtins.push({builtin:r,propertyKey:s,typeCtor:t})},_e=class{};_e.builtins=[],p([hi("gl_VertexID",Ut)],_e.prototype,"glVertexID",void 0);var us=class{},Xt=class{};Xt.builtins=[],p([hi("gl_FragCoord",F)],Xt.prototype,"glFragCoord",void 0),p([hi("gl_PointCoord",I)],Xt.prototype,"glPointCoord",void 0);var ur=class{};p([Ro("gl_FragColor")],ur.prototype,"glFragColor",void 0);var V=class{constructor(){this.type="uniform-group"}get _uniforms(){return this.constructor.uniforms??[]}},ps=class{constructor(){this.logShader=!1,this.computeAttributes={}}get vertexInput(){let t=Pr(this._shaderModuleClass.inputs,e=>e.propertyKey==="vertex"&&e.parameterIndex===0);if(!t)throw new Error("Unable to find vertex input parameter");return t}get computeInput(){return Pr(this._shaderModuleClass.inputs,t=>t.propertyKey==="vertex"&&t.parameterIndex===1)}get fragmentInput(){let t=Pr(this._shaderModuleClass.inputs,e=>e.propertyKey==="fragment");if(!t)throw new Error("Unable to find fragment input parameter");return t}get transformFeedbackBindings(){return this.fragmentInput.inputCtor.transformFeedbackBindings??[]}get locations(){return[...this.vertexInput.inputCtor.locations,...this.computeInput?.inputCtor.locations??[]]}get locationsMap(){let t=new Map,e=new Set;for(let s of this.locations)e.has(s.index)?Gt.getLogger("esri.views.2d.engine.webgl.shaderGraph.GraphShaderModule").warnOnce("mapview-rendering",`Unable to assigned attribute ${s.propertyKey} to ${s.index}. Index already in use`,{locationsMap:t}):(t.set(s.propertyKey,s.index),e.add(s.index));return t}get locationInfo(){if(!this._locationInfo){let t=this.locationsMap,e=Array.from(t.entries()).map(([i,n])=>`${i}.${n}`).join("."),s=Ai(e);this._locationInfo={hash:s,locations:t}}return this._locationInfo}get renamedLocationsMap(){let t=new Map;for(let e of this.locations)t.set("a_"+e.propertyKey,e.index);return t}get optionPropertyKeys(){if(!this._optionPropertyKeys){let t=new Set;for(let e of this._options)t.add(e.propertyKey);this._optionPropertyKeys=t}return this._optionPropertyKeys}get _shaderModuleClass(){return this.constructor}get _defines(){return this._shaderModuleClass.defines??[]}get _options(){return this._shaderModuleClass.options??[]}get _uniforms(){return this._shaderModuleClass.uniforms??[]}getProgram(t,e,s,i){try{let{vertex:n,fragment:o,uniformBindings:a}=this._generateShaders(t,e,s,i);return new cr(n,o,this.renamedLocationsMap,this.locationInfo,a,this.transformFeedbackBindings)}catch(n){return console.error("Failed to create program",{error:n}),new cr("","",this.renamedLocationsMap,this.locationInfo,[],this.transformFeedbackBindings)}}getDebugUniformClassInfo(t){let e=this._options.find(i=>i.propertyKey===t);if(e)return{type:"option",className:e.typeCtor};let s=this._uniforms.find(i=>i.propertyKey===t);if(!s)throw new Error(`Unable to find uniform class type for property: ${t}`);return{type:"required",className:s.typeCtor}}getShaderKey(t,e,s,i){let n=Object.keys(s).map(c=>`${c}.${s[c]}`).join("."),o=Object.keys(i).map(c=>`${c}.${i[c]}`).join("."),a=Object.keys(e).filter(c=>this.optionPropertyKeys.has(c)&&e[c]).join(".");return`${this.constructor.name}.${t.hash}.${n}.${o}.${a}`}_generateShaders(t,e,s,i){let n=[];this._setDefines(s),this._setOptionalUniforms(n,e),this._setRequiredUniforms(n);let o=this._hydrateVertexInput(i),a=this._injectPackPrecisionFactor(o,t),c=this._hydrateComputeInput(),l=c&&this._injectPackPrecisionFactor(c,t),u=this.vertex(a,l),h=this._hydrateFragmentInput(u),m=this.fragment(h),f=new Set;for(let E in m){let W=m[E];On(f,W)}let x=this._getVertexInputBuiltins(),v=or.createVertex(_(_({},o),c),u,x,n,this.transformFeedbackBindings,f);new nr().write(v);let w=this._getFragmentInputBuiltins(m);w.set("glPointCoord","gl_PointCoord");let S=or.createFragment(h,m,w,n,v,this.transformFeedbackBindings);new nr().write(S);let P=this._createShaderBuilder(v,S),z=P.generate("vertex",!1),B=P.generate("fragment",!1);return this.logShader&&(console.log(z),console.log(B)),{vertex:z,fragment:B,uniformBindings:n}}_setDefines(t){for(let e in t)this[e]=t[e]}_setOptionalUniforms(t,e){for(let s of this._options)e[s.propertyKey]?this[s.propertyKey]=this._hydrateUniformGroup(t,s):this[s.propertyKey]=null}_setRequiredUniforms(t){for(let e of this._uniforms)this[e.propertyKey]=this._hydrateUniformGroup(t,e)}_hydrateUniformGroup(t,e){let s=new e.typeCtor;for(let i of s._uniforms??[]){let n=lr(i.typeCtor),o=`u_${e.propertyKey}_${i.propertyKey}`,a=n.type,c=[e.propertyKey,i.propertyKey].join(".");if("type"in i.typeCtor&&i.typeCtor.type==="array"){let l=n;t.push({shaderModulePath:c,uniformName:o,uniformType:a,uniformArrayLength:l.size,uniformArrayElementType:l.elementType.type,uniformHydrated:n})}else t.push({shaderModulePath:c,uniformName:o,uniformType:a,uniformHydrated:n});s[i.propertyKey]=n}return s}_hydrateVertexInput(t){let e=this.vertexInput.inputCtor,s=e.locations.reduce((i,n)=>t[n.propertyKey]===!1?i:A(_({},i),{[n.propertyKey]:lr(n.typeCtor)}),{});for(let{propertyKey:i,typeCtor:n}of e.builtins){let o=lr(n);s[i]=o}return s}_hydrateComputeInput(){return this.computeInput==null?null:this.computeInput.inputCtor.locations.reduce((t,e)=>A(_({},t),{[e.propertyKey]:lr(e.typeCtor)}),{})}_injectPackPrecisionFactor(t,e){let s={};for(let i in t){let n=t[i],o=e.attributes.find(a=>a.name===i);if(o?.packPrecisionFactor){if(n.type!=="float"&&n.type!=="vec2"&&n.type!=="vec3"&&n.type!=="vec4")throw new Error(`InternalError: packPrecisionFactor requires GenType, but found ${n.type}`);s[i]=n.divide(new d(o.packPrecisionFactor))}else s[i]=n}return s}_hydrateFragmentInput(t){let e={};for(let s in t)e[s]=t[s];for(let{propertyKey:s,typeCtor:i}of Xt.builtins){let n=lr(i);e[s]=n}return e}_getVertexInputBuiltins(){let t=this.vertexInput.inputCtor,e=new Map;for(let{builtin:s,propertyKey:i}of t.builtins)e.set(i,s);return e}_getFragmentInputBuiltins(t){let e=t.constructor,s=new Map;for(let i of e.builtins??[])s.set(i.propertyKey,i.builtin);return s}_createShaderBuilder(t,e){let s=new $r;return this._insertDebugInfo(s),t.insertVertexShader(s),e.insertFragmentShader(s),s}_insertDebugInfo(t){t.vertex.code.add("// DEFINES: "),t.vertex.code.add("// --------------------------------------------------------- ");for(let e of this._defines)this[e.propertyKey]?t.vertex.code.add(`//   ${e.propertyKey}: true`):t.vertex.code.add(`//   ${e.propertyKey}: false`);t.vertex.code.add(""),t.vertex.code.add("// OPTIONS: "),t.vertex.code.add("// --------------------------------------------------------- ");for(let e of this._options)this[e.propertyKey]?t.vertex.code.add(`//   ${e.propertyKey}: true`):t.vertex.code.add(`//   ${e.propertyKey}: false`)}};function mi(r){let t=O(12.9898),e=O(78.233),s=O(43758.5453),i=rr(r,tr(t,e)),n=gt(i,O(3.14));return cs(ir(n).multiply(s))}function it(r){return ve(r,O(Fn))}function Yn(r,t){return r.x.multiply(t.y).subtract(t.x.multiply(r.y))}function qn(r){return r.multiply(2).subtract(1)}function nt(r,t){let e=O(2**t);return gt(Un(r.divide(e)),O(2))}function Pl(r,t){return L(nt(r,t),O(.5))}function hs(r,t){return nt(r,t+Br.length)}function Zn(r,t){return nt(r,t)}function Xn(r){let t=nt(r.z,7),e=O(1).subtract(t),s=r.xyz.subtract(Bn(0,0,O(128)));return e.multiply(r).add(t.multiply(s))}function Kn(r){let t=Ln(.99609375,.0038909912109375,1519918441772461e-20,59371814131736755e-24);return rr(r,t)}function Fl(r){return qt(qt(qt(r.x,r.y),r.z),r.w)}var ht=class extends V{getVisualVariableData(t){if(!this._vvData){let e=this.getAttributeDataCoords(t);this._vvData=pt(this.visualVariableData,e).setDebugName("storage2")}return this._vvData}getAttributeDataCoords(t){if(!this._uv){let e=Xn(t),s=this.size,i=se(e.x),n=se(e.y).multiply(se(256)),o=se(e.z).multiply(se(256)).multiply(se(256)),a=O(i.add(n).add(o)),c=gt(a,s),l=a.subtract(c).divide(s);this._uv=new I(c,l).add(.5).divide(s)}return this._uv}getFilterData(t){let e=this.getAttributeDataCoords(t);return pt(this.filterFlags,e).setDebugName("storage0")}getAnimationData(t){let e=this.getAttributeDataCoords(t);return pt(this.animation,e).setDebugName("storage1")}getVVData(t){return this.getVisualVariableData(t)}getDataDrivenData0(t){let e=this.getAttributeDataCoords(t);return pt(this.dataDriven0,e).setDebugName("storage30")}getDataDrivenData1(t){let e=this.getAttributeDataCoords(t);return pt(this.dataDriven1,e).setDebugName("storage31")}getDataDrivenData2(t){let e=this.getAttributeDataCoords(t);return pt(this.dataDriven2,e).setDebugName("storage32")}getGPGPUData(t){let e=this.getAttributeDataCoords(t);return pt(this.gpgpu,e).setDebugName("storage4")}getFilterFlags(t){return de("webgl-ignores-sampler-precision")?An(this.getFilterData(t).x.multiply(O(255))):this.getFilterData(t).x.multiply(O(255))}getAnimationValue(t){return this.getAnimationData(t).x}getSizeValue(t){return this.getVisualVariableData(t).x}getColorValue(t){return this.getVisualVariableData(t).y}getOpacityValue(t){return this.getVisualVariableData(t).z}getRotationValue(t){return this.getVisualVariableData(t).w}};p([b(Tt)],ht.prototype,"filterFlags",void 0),p([b(Tt)],ht.prototype,"animation",void 0),p([b(Tt)],ht.prototype,"gpgpu",void 0),p([b(Tt)],ht.prototype,"visualVariableData",void 0),p([b(Tt)],ht.prototype,"dataDriven0",void 0),p([b(Tt)],ht.prototype,"dataDriven1",void 0),p([b(Tt)],ht.prototype,"dataDriven2",void 0),p([b(d)],ht.prototype,"size",void 0);var Ie=class extends V{};p([b(d)],Ie.prototype,"activeReasons",void 0),p([b(d)],Ie.prototype,"highlightAll",void 0);var Kt=class extends V{};p([b(I)],Kt.prototype,"position",void 0),p([b(d)],Kt.prototype,"distance",void 0),p([b(d)],Kt.prototype,"smallSymbolDistance",void 0),p([b(d)],Kt.prototype,"smallSymbolSizeThreshold",void 0);var Z=class extends V{};p([b(et)],Z.prototype,"displayViewScreenMat3",void 0),p([b(et)],Z.prototype,"displayViewMat3",void 0),p([b(et)],Z.prototype,"displayMat3",void 0),p([b(et)],Z.prototype,"viewMat3",void 0),p([b(et)],Z.prototype,"tileMat3",void 0),p([b(d)],Z.prototype,"displayZoomFactor",void 0),p([b(d)],Z.prototype,"requiredZoomFactor",void 0),p([b(I)],Z.prototype,"tileOffset",void 0),p([b(d)],Z.prototype,"currentScale",void 0),p([b(d)],Z.prototype,"currentZoom",void 0),p([b(d)],Z.prototype,"metersPerSRUnit",void 0),p([b(d)],Z.prototype,"rotation",void 0),p([b(d)],Z.prototype,"pixelRatio",void 0);var ot=class extends _e{};p([M(0,N)],ot.prototype,"id",void 0),p([M(1,d)],ot.prototype,"bitset",void 0),p([M(2,I)],ot.prototype,"pos",void 0);var Y=class extends us{};p([M(14,I)],Y.prototype,"nextPos1",void 0),p([M(15,I)],Y.prototype,"nextPos2",void 0);var Pt=class extends Xt{},j=class extends ps{clip(t,e){let s=new d(0),i=this.storage.getFilterFlags(t);if(s=s.add(O(2).multiply(O(1).subtract(hs(i,0)))),this.inside?s=s.add(O(2).multiply(O(1).subtract(hs(i,1)))):this.outside?s=s.add(O(2).multiply(hs(i,1))):this.highlight&&(s=s.add(O(2).multiply(O(1).subtract(this._checkHighlight(i))))),e!=null){let n=new d(1).subtract(bt(e.x,this.view.currentZoom)),o=bt(e.y,this.view.currentZoom);s=s.add(new d(2).multiply(n.add(o)))}return s}getFragmentOutput(t,e,s=new d(1/255)){let i=new ur;return i.glFragColor=this._maybeWriteHittest(e)??this._maybeHighlight(t,s)??t,i}_maybeHighlight(t,e){return this.highlight?new F(t.rgb,bt(e,t.a)):null}_checkHighlight(t){let e=this._checkHighlightBit(t,0);for(let s=1;s<Br.length;s++)e=e.add(this._checkHighlightBit(t,s));return bt(new d(.1),e.add(this.highlight.highlightAll))}_checkHighlightBit(t,e){return Zn(t,e).multiply(nt(this.highlight.activeReasons,e))}maybeRunHittest(t,e,s){if(this.hittestRequest==null)return null;let i=this.hittest(t,e,s),n=D(L(i,this.hittestRequest.distance),new d(2),new d(0)),o=this.storage.getAttributeDataCoords(t.id),a=qn(o);n=n.add(this.clip(t.id,t.zoomRange));let c=new F(new d(1/255),0,0,0);return{glPointSize:new d(1),glPosition:new F(a,n,1),color:c}}_maybeWriteHittest(t){return this.hittestRequest!=null?t.color:null}};p([di],j.prototype,"inside",void 0),p([di],j.prototype,"outside",void 0),p([$(Ie)],j.prototype,"highlight",void 0),p([b(ht)],j.prototype,"storage",void 0),p([b(Z)],j.prototype,"view",void 0),p([$(Kt)],j.prototype,"hittestRequest",void 0);function Wo(r,t){return rr(r,$n(t))}function Te(r,t,e){let s=e.subtract(t),i=Wo(r.subtract(t),s),n=we(i.divide(ls(s)),new d(0),new d(1));return pi(r,t.add(n.multiply(e.subtract(t))))}function Go(r){let t=Gn(r);return bt(t.x.add(t.y).add(t.z),new d(1.05))}function Ao(r,t,e,s){let i=new et(e.x.multiply(s.y).subtract(s.x.multiply(e.y)),s.x.multiply(t.y).subtract(t.x.multiply(s.y)),t.x.multiply(e.y).subtract(e.x.multiply(t.y)),e.y.subtract(s.y),s.y.subtract(t.y),t.y.subtract(e.y),s.x.subtract(e.x),t.x.subtract(s.x),e.x.subtract(t.x)),n=t.x.multiply(e.y.subtract(s.y)),o=e.x.multiply(s.y.subtract(t.y)),a=s.x.multiply(t.y.subtract(e.y)),c=n.add(o).add(a);return new d(1).divide(c).multiply(i.multiply(new N(1,r)))}function Uo(r,t,e,s){return ve(Go(Ao(r,t,e,s)),new d(1))}function $o(r,t,e,s){let i=e.subtract(t),n=s.subtract(t),o=Yn(i,n),a=as(Wn(o,new d(Gs)),L(o,new d(-Gs)));return Mt([as(Hn(a),Uo(r.xy,t,e,s)),new d(-1)],[!0,()=>{let c=Te(r,t,e),l=Te(r,e,s),u=Te(r,s,t);return sr(sr(c,l),u)}])}function ds(r){return r.distance.add(1)}function Me(r,t,e){let{viewMat3:s,tileMat3:i}=r.view,n=s.multiply(i),o=n.multiply(new N(t.pos,1)),a=n.multiply(new N(e.nextPos1,1)),c=n.multiply(new N(e.nextPos2,1));return $o(r.hittestRequest.position,o.xy,a.xy,c.xy)}function au(r,t,e){return pi(r,e).subtract(t)}var Ft=class extends V{getColor(t,e,s){return Mt([ai(it(t),s),e],[Ht(t,this.values.first()),this.colors.first()],[Yt(t,this.values.last()),this.colors.last()],[!0,()=>{let i=this.values.findIndex(l=>L(l,t)),n=this.values.get(i),o=i.subtract(1),a=this.values.get(o),c=t.subtract(a).divide(n.subtract(a));return st(this.colors.get(o),this.colors.get(i),c)}])}};p([b(K.ofType(F,8))],Ft.prototype,"colors",void 0),p([b(K.ofType(d,8))],Ft.prototype,"values",void 0);var kt=class extends V{getOpacity(t){return Mt([it(t),new d(1)],[Ht(t,this.opacityValues.first()),this.opacities.first()],[Yt(t,this.opacityValues.last()),this.opacities.last()],[!0,()=>{let e=this.opacityValues.findIndex(a=>L(a,t)),s=this.opacityValues.get(e),i=e.subtract(1),n=this.opacityValues.get(i),o=t.subtract(n).divide(s.subtract(n));return st(this.opacities.get(i),this.opacities.get(e),o)}])}};p([b(K.ofType(d,8))],kt.prototype,"opacities",void 0),p([b(K.ofType(d,8))],kt.prototype,"opacityValues",void 0);function fi(r){return r.visualVariableSizeMinMaxValue!=null||r.visualVariableSizeScaleStops!=null||r.visualVariableSizeStops!=null||r.visualVariableSizeUnitValue!=null}function jn(r,t,e){if(fi(r)){let s=r.storage.getSizeValue(t);return r.visualVariableSizeMinMaxValue?.getSize(s,e)??r.visualVariableSizeScaleStops?.getSizeForViewScale(r.view.currentScale)??r.visualVariableSizeStops?.getSize(s,e)??r.visualVariableSizeUnitValue?.getSize(s,e)}return e}function Pe(r,t,e,s=new ut(!1)){if(r.visualVariableColor==null)return e;let i=r.storage.getColorValue(t);return r.visualVariableColor.getColor(i,e,s)}function Fe(r,t){if(r.visualVariableOpacity==null)return new d(1);let e=r.storage.getOpacityValue(t);return r.visualVariableOpacity.getOpacity(e)}function vu(r,t){if(r.visualVariableRotation==null)return et.identity();let e=r.storage.getRotationValue(t);return r.visualVariableRotation.getVVRotationMat3(e)}var zt=class extends ot{};p([M(3,F)],zt.prototype,"color",void 0),p([M(4,I)],zt.prototype,"zoomRange",void 0);var Vt=class extends j{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(t,e){let s=Fe(this,t.id),i=Pe(this,t.id,t.color).multiply(s),n=this.view.displayViewScreenMat3.multiply(new N(t.pos.xy,1)),o=this.clip(t.id,t.zoomRange);return _({glPosition:new F(n.xy,o,1),color:i},this.maybeRunHittest(t,e,null))}fragment(t){return this.getFragmentOutput(t.color,t,new d(0))}hittest(t,e){return Me(this,t,e)}};p([$(Ft)],Vt.prototype,"visualVariableColor",void 0),p([$(kt)],Vt.prototype,"visualVariableOpacity",void 0),p([k(0,C(zt)),k(1,C(Y))],Vt.prototype,"vertex",null),p([k(0,C(Pt))],Vt.prototype,"fragment",null);var dt=class extends V{getPatternOffsetAtTileOrigin(t,e=new d(0),s=new d(1)){let i=new I(Dn).divide(t),n=t.multiply(cs(this.maxIntsToLocalOrigin.multiply(i))).add(this.tileOffsetFromLocalOrigin).subtract(new d(.5).multiply(t));return n=new I(n.x.multiply(s).subtract(n.y.multiply(e)),n.x.multiply(e).add(n.y.multiply(s))),gt(n,t)}};p([b(I)],dt.prototype,"tileOffsetFromLocalOrigin",void 0),p([b(I)],dt.prototype,"maxIntsToLocalOrigin",void 0);var mt=class extends V{};p([b(I)],mt.prototype,"size",void 0),p([b(Tt)],mt.prototype,"texture",void 0);var Bt=class extends zt{};p([M(5,F)],Bt.prototype,"tlbr",void 0),p([M(6,d)],Bt.prototype,"width",void 0),p([M(7,d)],Bt.prototype,"height",void 0),p([M(8,I)],Bt.prototype,"offset",void 0),p([M(9,I)],Bt.prototype,"scale",void 0),p([M(10,d)],Bt.prototype,"angle",void 0);var yi=class extends Pt{};function Ho(r,t,e,s,i){let n=ve(nt(i,Wr),O(1)),o=Kn(new F(r,0));return D(n,ni(s.divide(t.x),e.divide(t.y),0,xe(e.divide(t.x)),s.divide(t.y),0,mi(tr(o,0)),mi(tr(0,o)),1),ni(s.divide(t.x),e.divide(t.y),0,xe(e.divide(t.x)),s.divide(t.y),0,0,0,1))}function xi(r,t){let e=st(new I(1),new I(1/qe),new I(nt(t.bitset,Ar),nt(t.bitset,Gr))),s=r.view.requiredZoomFactor,i=new I(t.width,t.height).multiply(e),n=i.multiply(t.scale).multiply(s),o=t.angle.multiply(In),a=ir(o),c=ui(o),l=Ho(t.id,n,a,c,t.bitset),u=r.localTileOffset.getPatternOffsetAtTileOrigin(i,a,c),h=s.multiply(t.scale).multiply(t.offset.subtract(u)).divide(n),m=new N(t.pos,1),f=l.multiply(m).xy.subtract(h),x=t.tlbr.divide(r.mosaicInfo.size.xyxy),v=nt(t.bitset,fe);return r.visualVariableColor!=null&&(v=D(it(r.storage.getColorValue(t.id)),new d(0),v)),{tileTextureCoord:f,tlbr:x,sampleAlphaOnly:v}}function gi(r,t){let e=gt(t.tileTextureCoord,new d(1)),s=st(t.tlbr.xy,t.tlbr.zw,e),i=pt(r.mosaicInfo.texture,s);return i=D(L(t.sampleAlphaOnly,new d(.5)),i.aaaa,i),t.color.multiply(i)}var ke=class extends Vt{vertex(t,e){return _(_({},super.vertex(t,e)),xi(this,t))}fragment(t){let e=gi(this,t);return this.getFragmentOutput(e,t,new d(0))}};p([b(mt)],ke.prototype,"mosaicInfo",void 0),p([b(dt)],ke.prototype,"localTileOffset",void 0),p([k(0,C(Bt)),k(1,C(Y))],ke.prototype,"vertex",null),p([k(0,C(yi))],ke.prototype,"fragment",null);var oe=class extends V{getSize(t,e){let s=this.minMaxValueAndSize.xy,i=this.minMaxValueAndSize.zw;return D(it(t),e,()=>{let n=t.subtract(s.x).divide(s.y.subtract(s.x)),o=we(n,new d(0),new d(1));return i.x.add(o.multiply(i.y.subtract(i.x)))})}};p([b(F)],oe.prototype,"minMaxValueAndSize",void 0);var jt=class extends V{getSizeForViewScale(t){return Mt([Ht(t,this.values.first()),this.sizes.first()],[Yt(t,this.values.last()),this.sizes.last()],[!0,()=>{let e=this.values.findIndex(a=>L(a,t)),s=this.values.get(e),i=e.subtract(1),n=this.values.get(i),o=t.subtract(n).divide(s.subtract(n));return st(this.sizes.get(i),this.sizes.get(e),o)}])}};p([b(K.ofType(d,8))],jt.prototype,"sizes",void 0),p([b(K.ofType(d,8))],jt.prototype,"values",void 0);var Qt=class extends V{getSize(t,e){let s=Mt([it(t),e],[Ht(t,this.values.first()),this.sizes.first()],[Yt(t,this.values.last()),this.sizes.last()],[!0,()=>{let i=this.values.findIndex(l=>L(l,t)),n=this.values.get(i),o=i.subtract(1),a=this.values.get(o),c=t.subtract(a).divide(n.subtract(a));return st(this.sizes.get(o),this.sizes.get(i),c)}]);return D(it(s),e,s)}};p([b(K.ofType(d,8))],Qt.prototype,"sizes",void 0),p([b(K.ofType(d,8))],Qt.prototype,"values",void 0);var ae=class extends V{getSize(t,e){return D(it(t),e,t.multiply(this.unitValueToPixelsRatio))}};p([b(d)],ae.prototype,"unitValueToPixelsRatio",void 0);var Lt=class extends ot{};p([M(3,F)],Lt.prototype,"color",void 0),p([M(4,I)],Lt.prototype,"offset",void 0),p([M(5,I)],Lt.prototype,"normal",void 0),p([M(6,d)],Lt.prototype,"halfWidth",void 0),p([M(7,d)],Lt.prototype,"referenceHalfWidth",void 0),p([M(8,I)],Lt.prototype,"zoomRange",void 0);var pr=class extends Pt{},ce=class extends V{};function Qn(r){return qt(new d(Tn).multiply(bt(r,new d(Mn))),new d(1))}function Yo(r,t){let{halfWidth:e,normal:s}=r,i=Qn(e),n=ls(s).multiply(e);return we(i.multiply(e.subtract(n)).divide(t.add(i).subtract(new d(1))),new d(0),new d(1))}function qo(r,t){let{id:e,halfWidth:s,referenceHalfWidth:i}=t;if(fi(r)){let n=new d(2).multiply(i),o=jn(r,e,n);return new d(.5).multiply(s.divide(qt(i,new d(Pn)))).multiply(o)}return s}function bi(r,t){let{id:e,offset:s,pos:i,normal:n,zoomRange:o}=t,{displayViewScreenMat3:a,displayViewMat3:c}=r.view,l=Pe(r,e,t.color),u=Fe(r,e),h=qo(r,t),m=new d(.5).multiply(r.antialiasingControls.antialiasing),f=qt(h.add(m),new d(.45)).add(new d(.1).multiply(m)),x=Qn(f).multiply(f).multiply(s),v=c.multiply(new N(x,new d(0))),w=a.multiply(new N(i,new d(1))).add(v),S=new d(2).multiply(bt(h,new d(0))).add(r.clip(e,o)),P=new F(w.xy,S,1);return{color:l,opacity:u,halfWidth:f,normal:n,scaledOffset:x,scaledHalfWidth:h,glPosition:new F(P.xy,S,1)}}function le(r,t){let{opacity:e,color:s}=r,i=Yo(r,t);return e.multiply(s).multiply(i)}p([b(d)],ce.prototype,"antialiasing",void 0),p([b(d)],ce.prototype,"blur",void 0);var vt=class extends j{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(t,e){let s=bi(this,t);return _(_({},s),this.maybeRunHittest(t,e,s.halfWidth))}fragment(t){let e=le(t,this.antialiasingControls.blur);return this.getFragmentOutput(e,t)}hittest(t,e,s){let{viewMat3:i,tileMat3:n}=this.view,o=i.multiply(n),a=o.multiply(new N(t.pos,1)),c=o.multiply(new N(e.nextPos1,1)),l=o.multiply(new N(e.nextPos2,1)),{distance:u,smallSymbolDistance:h,smallSymbolSizeThreshold:m}=this.hittestRequest,f=bt(s,m.multiply(.5)).multiply(u.subtract(h)),x=this.hittestRequest.position;return sr(Te(x,a.xy,c.xy),Te(x,a.xy,l.xy)).subtract(s).add(f)}};p([b(ce)],vt.prototype,"antialiasingControls",void 0),p([$(Ft)],vt.prototype,"visualVariableColor",void 0),p([$(kt)],vt.prototype,"visualVariableOpacity",void 0),p([$(oe)],vt.prototype,"visualVariableSizeMinMaxValue",void 0),p([$(jt)],vt.prototype,"visualVariableSizeScaleStops",void 0),p([$(Qt)],vt.prototype,"visualVariableSizeStops",void 0),p([$(ae)],vt.prototype,"visualVariableSizeUnitValue",void 0),p([k(0,C(Lt)),k(1,C(Y))],vt.prototype,"vertex",null),p([k(0,C(pr))],vt.prototype,"fragment",null);var wt=class extends ot{};p([M(3,I)],wt.prototype,"offset",void 0),p([M(4,F)],wt.prototype,"color",void 0),p([M(5,I)],wt.prototype,"normal",void 0),p([M(6,d)],wt.prototype,"halfWidth",void 0),p([M(7,d)],wt.prototype,"referenceHalfWidth",void 0),p([M(8,I)],wt.prototype,"zoomRange",void 0);var hr=class extends pr{};function dr(r,t,e){let{id:s,bitset:i}=t,n=nt(i,ye),o=L(n,new d(.5)),a=bi(r,t),c=D(o,a.halfWidth,new d(0)),l=Fe(r,s),u=Pe(r,s,t.color),h=D(o,t.color,u.multiply(l)),m=r.view.displayViewScreenMat3.multiply(new N(t.pos.xy,1)),f=r.clip(t.id),x=new F(m.xy,f,1),v=D(o,a.glPosition,x),w=e&&r.maybeRunHittest(t,e,o);return _({isOutline:n,color:h,opacity:new d(1),halfWidth:c,normal:a.normal,glPosition:v},w)}var ft=class extends j{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}};p([b(ce)],ft.prototype,"antialiasingControls",void 0),p([$(Ft)],ft.prototype,"visualVariableColor",void 0),p([$(kt)],ft.prototype,"visualVariableOpacity",void 0),p([$(oe)],ft.prototype,"visualVariableSizeMinMaxValue",void 0),p([$(jt)],ft.prototype,"visualVariableSizeScaleStops",void 0),p([$(Qt)],ft.prototype,"visualVariableSizeStops",void 0),p([$(ae)],ft.prototype,"visualVariableSizeUnitValue",void 0);var Ve=class extends ft{vertex(t,e){return dr(this,t,e)}fragment(t){let{color:e,isOutline:s}=t,i=L(s,new d(.5)),n=le(t,this.antialiasingControls.blur),o=D(i,n,e),a=D(i,new d(1/255),new d(0));return this.getFragmentOutput(o,t,a)}hittest(t,e,s){return D(s,ds(this.hittestRequest),Me(this,t,e))}};p([k(0,C(wt)),k(1,C(Y))],Ve.prototype,"vertex",null),p([k(0,C(hr))],Ve.prototype,"fragment",null);var mr=class extends zt{};p([M(5,F)],mr.prototype,"tlbr",void 0),p([M(6,d)],mr.prototype,"inverseRasterizationScale",void 0);var vi=class extends Pt{};function Zo(r){let t=new d(1),e=new d(0);return new et(t.divide(r.x),e.divide(r.y),0,xe(e.divide(r.x)),t.divide(r.y),0,0,0,1)}function wi(r,t){let e=t.tlbr.xy,s=t.tlbr.zw,i=s.x.subtract(e.x),n=e.y.subtract(s.y),o=new I(i,n).multiply(t.inverseRasterizationScale),a=o.multiply(r.view.requiredZoomFactor),c=Zo(a),l=r.localTileOffset.getPatternOffsetAtTileOrigin(o).divide(a),u=new N(t.pos,1);return{tileTextureCoord:c.multiply(u).xy.subtract(l),tlbr:t.tlbr.divide(r.mosaicInfo.size.xyxy)}}function _i(r,t){let e=gt(r.tileTextureCoord,new d(1)),s=st(r.tlbr.xy,r.tlbr.zw,e),i=pt(t.texture,s);return r.color.multiply(i)}var Ce=class extends Vt{vertex(t,e){return _(_({},super.vertex(t,e)),wi(this,t))}fragment(t){let e=_i(t,this.mosaicInfo);return this.getFragmentOutput(e,t,new d(0))}};p([b(mt)],Ce.prototype,"mosaicInfo",void 0),p([b(dt)],Ce.prototype,"localTileOffset",void 0),p([k(0,C(mr)),k(1,C(Y))],Ce.prototype,"vertex",null),p([k(0,C(vi))],Ce.prototype,"fragment",null);var fr=class extends wt{};p([M(9,F)],fr.prototype,"tlbr",void 0),p([M(10,d)],fr.prototype,"inverseRasterizationScale",void 0);var yr=class extends hr{},Ee=class extends Ve{vertex(t,e){return _(_({},dr(this,t,e)),wi(this,t))}fragment(t){let{isOutline:e}=t,s=L(e,new d(.5)),i=le(t,this.antialiasingControls.blur),n=_i(t,this.mosaicInfo),o=D(s,i,n),a=D(s,new d(1/255),new d(0));return this.getFragmentOutput(o,t,a)}};p([b(mt)],Ee.prototype,"mosaicInfo",void 0),p([b(dt)],Ee.prototype,"localTileOffset",void 0),p([k(0,C(fr)),k(1,C(Y))],Ee.prototype,"vertex",null),p([k(0,C(yr))],Ee.prototype,"fragment",null);var Ct=16,xr=1/Ct,ms=128,_t=class extends ot{};p([M(3,F)],_t.prototype,"color",void 0),p([M(4,F)],_t.prototype,"tlbr",void 0),p([M(5,d)],_t.prototype,"angle",void 0),p([M(6,d)],_t.prototype,"aux1",void 0),p([M(7,d)],_t.prototype,"aux2",void 0),p([M(8,I)],_t.prototype,"aux3",void 0),p([M(9,I)],_t.prototype,"aux4",void 0),p([M(10,I)],_t.prototype,"zoomRange",void 0);var Si=class extends yr{},De=class extends ft{vertex(t,e){let{aux1:s,aux2:i,aux3:n,aux4:o}=t,a=A(_({},t),{width:s,height:i,offset:n,scale:o.multiply(xr)}),c=A(_({},t),{halfWidth:s.multiply(xr),referenceHalfWidth:i.multiply(xr),offset:n.multiply(xr),normal:o.subtract(ms).multiply(xr)}),l=dr(this,c),u=xi(this,a),h=L(l.isOutline,new d(.5));return _(_(_({},l),u),this.maybeRunHittest(t,e,h))}fragment(t){let{isOutline:e}=t,s=L(e,new d(.5)),i=le(t,this.antialiasingControls.blur),n=gi(this,t),o=D(s,i,n),a=D(s,new d(1/255),new d(0));return this.getFragmentOutput(o,t,a)}hittest(t,e,s){return D(s,ds(this.hittestRequest),Me(this,t,e))}};p([b(mt)],De.prototype,"mosaicInfo",void 0),p([b(dt)],De.prototype,"localTileOffset",void 0),p([k(0,C(_t)),k(1,C(Y))],De.prototype,"vertex",null),p([k(0,C(Si))],De.prototype,"fragment",null);var gr=r=>r&8388607;function kh(r,t){return((t?8388608:0)|r)>>>0}function to(r,t,e,s,i,n,o){Mi=0;let a=(s-e)*n,c=i&&i.length,l=c?(i[0]-e)*n:a,u,h,m,f,x,v=eo(t,e,s,0,l,n,!0);if(v&&v.next!==v.prev){if(c&&(v=Qo(t,e,s,i,v,n)),a>80*n){u=m=t[0+e*n],h=f=t[1+e*n];for(let w=n;w<l;w+=n){let S=t[w+e*n],P=t[w+1+e*n];u=Math.min(u,S),h=Math.min(h,P),m=Math.max(m,S),f=Math.max(f,P)}x=Math.max(m-u,f-h),x=x!==0?1/x:0}vr(v,r,n,u,h,x,o,0)}}function eo(r,t,e,s,i,n,o){let a;if(o===sa(r,t,e,s,i,n)>0)for(let c=s;c<i;c+=n)a=Jn(c+t*n,r[c+t*n],r[c+1+t*n],a);else for(let c=i-n;c>=s;c-=n)a=Jn(c+t*n,r[c+t*n],r[c+1+t*n],a);return a&&ue(a,a.next)&&(wr(a),a=a.next),a}function br(r,t=r){if(!r)return r;let e,s=r;do if(e=!1,s.steiner||!ue(s,s.next)&&X(s.prev,s,s.next)!==0)s=s.next;else{if(wr(s),s=t=s.prev,s===s.next)break;e=!0}while(e||s!==t);return t}function vr(r,t,e,s,i,n,o,a){if(!r)return;!a&&n&&(r=ro(r,s,i,n));let c=r;for(;r.prev!==r.next;){let l=r.prev,u=r.next;if(n?Ko(r,s,i,n):Xo(r))t.push(l.index/e+o),t.push(r.index/e+o),t.push(u.index/e+o),wr(r),r=u.next,c=u.next;else if((r=u)===c){a?a===1?vr(r=na(r,t,e,o),t,e,s,i,n,o,2):a===2&&oa(r,t,e,s,i,n,o):vr(br(r),t,e,s,i,n,o,1);break}}}function Xo(r){let t=r.prev,e=r,s=r.next;if(X(t,e,s)>=0)return!1;let i=r.next.next,n=i,o=0;for(;i!==r.prev&&(o===0||i!==n);){if(o++,Ne(t.x,t.y,e.x,e.y,s.x,s.y,i.x,i.y)&&X(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function Ko(r,t,e,s){let i=r.prev,n=r,o=r.next;if(X(i,n,o)>=0)return!1;let a=i.x<n.x?i.x<o.x?i.x:o.x:n.x<o.x?n.x:o.x,c=i.y<n.y?i.y<o.y?i.y:o.y:n.y<o.y?n.y:o.y,l=i.x>n.x?i.x>o.x?i.x:o.x:n.x>o.x?n.x:o.x,u=i.y>n.y?i.y>o.y?i.y:o.y:n.y>o.y?n.y:o.y,h=Ii(a,c,t,e,s),m=Ii(l,u,t,e,s),f=r.prevZ,x=r.nextZ;for(;f&&f.z>=h&&x&&x.z<=m;){if(f!==r.prev&&f!==r.next&&Ne(i.x,i.y,n.x,n.y,o.x,o.y,f.x,f.y)&&X(f.prev,f,f.next)>=0||(f=f.prevZ,x!==r.prev&&x!==r.next&&Ne(i.x,i.y,n.x,n.y,o.x,o.y,x.x,x.y)&&X(x.prev,x,x.next)>=0))return!1;x=x.nextZ}for(;f&&f.z>=h;){if(f!==r.prev&&f!==r.next&&Ne(i.x,i.y,n.x,n.y,o.x,o.y,f.x,f.y)&&X(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;x&&x.z<=m;){if(x!==r.prev&&x!==r.next&&Ne(i.x,i.y,n.x,n.y,o.x,o.y,x.x,x.y)&&X(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function Jn(r,t,e,s){let i=Oe.create(r,t,e);return s?(i.next=s.next,i.prev=s,s.next.prev=i,s.next=i):(i.prev=i,i.next=i),i}function wr(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function jo(r){let t=r,e=r;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==r);return e}function Qo(r,t,e,s,i,n){let o=new Array;for(let a=0,c=s.length;a<c;a++){let l=eo(r,t,e,s[a]*n,a<c-1?s[a+1]*n:e*n,n,!1);l===l.next&&(l.steiner=!0),o.push(jo(l))}o.sort(ia);for(let a of o)i=Jo(a,i);return i}function Jo(r,t){let e=ta(r,t);if(!e)return t;let s=io(e,r);return br(s,s.next),br(e,e.next)}function ta(r,t){let e=t,s=r.x,i=r.y,n,o=-1/0;do{if(i<=e.y&&i>=e.next.y&&e.next.y!==e.y){let m=e.x+(i-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(m<=s&&m>o){if(o=m,m===s){if(i===e.y)return e;if(i===e.next.y)return e.next}n=e.x<e.next.x?e:e.next}}e=e.next}while(e!==t);if(!n)return null;if(s===o)return n.prev;let a=n,c=n.x,l=n.y,u,h=1/0;for(e=n.next;e!==a;)s>=e.x&&e.x>=c&&s!==e.x&&Ne(i<l?s:o,i,c,l,i<l?o:s,i,e.x,e.y)&&(u=Math.abs(i-e.y)/(s-e.x),(u<h||u===h&&e.x>n.x)&&_r(e,r)&&(n=e,h=u)),e=e.next;return n}function ro(r,t,e,s){let i;for(;i!==r;i=i.next){if(i=i||r,i.z===null&&(i.z=Ii(i.x,i.y,t,e,s)),i.prev.next!==i||i.next.prev!==i)return i.prev.next=i,i.next.prev=i,ro(r,t,e,s);i.prevZ=i.prev,i.nextZ=i.next}return r.prevZ.nextZ=null,r.prevZ=null,ea(r)}function ea(r){let t,e=1;for(;;){let s,i=r;r=null,t=null;let n=0;for(;i;){n++,s=i;let o=0;for(;o<e&&s;o++)s=s.nextZ;let a=e;for(;o>0||a>0&&s;){let c;o===0?(c=s,s=s.nextZ,a--):a!==0&&s?i.z<=s.z?(c=i,i=i.nextZ,o--):(c=s,s=s.nextZ,a--):(c=i,i=i.nextZ,o--),t?t.nextZ=c:r=c,c.prevZ=t,t=c}i=s}if(t.nextZ=null,e*=2,n<2)return r}}function X(r,t,e){return(t.y-r.y)*(e.x-t.x)-(t.x-r.x)*(e.y-t.y)}function so(r,t,e,s){return!!(ue(r,t)&&ue(e,s)||ue(r,s)&&ue(e,t))||X(r,t,e)>0!=X(r,t,s)>0&&X(e,s,r)>0!=X(e,s,t)>0}function ra(r,t){let e=r;do{if(e.index!==r.index&&e.next.index!==r.index&&e.index!==t.index&&e.next.index!==t.index&&so(e,e.next,r,t))return!0;e=e.next}while(e!==r);return!1}function sa(r,t,e,s,i,n){let o=0;for(let a=s,c=i-n;a<i;a+=n)o+=(r[c+t*n]-r[a+t*n])*(r[a+1+t*n]+r[c+1+t*n]),c=a;return o}function Ne(r,t,e,s,i,n,o,a){return(i-o)*(t-a)-(r-o)*(n-a)>=0&&(r-o)*(s-a)-(e-o)*(t-a)>=0&&(e-o)*(n-a)-(i-o)*(s-a)>=0}function _r(r,t){return X(r.prev,r,r.next)<0?X(r,t,r.next)>=0&&X(r,r.prev,t)>=0:X(r,t,r.prev)<0||X(r,r.next,t)<0}function Ii(r,t,e,s,i){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=32767*(r-e)*i)|r<<8))|r<<4))|r<<2))|r<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-s)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function ue(r,t){return r.x===t.x&&r.y===t.y}function ia(r,t){return r.x-t.x}function na(r,t,e,s){let i=r;do{let n=i.prev,o=i.next.next;!ue(n,o)&&so(n,i,i.next,o)&&_r(n,o)&&_r(o,n)&&(t.push(n.index/e+s),t.push(i.index/e+s),t.push(o.index/e+s),wr(i),wr(i.next),i=r=o),i=i.next}while(i!==r);return i}function oa(r,t,e,s,i,n,o){let a=r;do{let c=a.next.next;for(;c!==a.prev;){if(a.index!==c.index&&aa(a,c)){let l=io(a,c);return a=br(a,a.next),l=br(l,l.next),vr(a,t,e,s,i,n,o,0),void vr(l,t,e,s,i,n,o,0)}c=c.next}a=a.next}while(a!==r)}function aa(r,t){return r.next.index!==t.index&&r.prev.index!==t.index&&!ra(r,t)&&_r(r,t)&&_r(t,r)&&ca(r,t)}function ca(r,t){let e=r,s=!1,i=(r.x+t.x)/2,n=(r.y+t.y)/2;do e.y>n!=e.next.y>n&&e.next.y!==e.y&&i<(e.next.x-e.x)*(n-e.y)/(e.next.y-e.y)+e.x&&(s=!s),e=e.next;while(e!==r);return s}function io(r,t){let e=Oe.create(r.index,r.x,r.y),s=Oe.create(t.index,t.x,t.y),i=r.next,n=t.prev;return r.next=t,t.prev=r,e.next=i,i.prev=e,s.next=e,e.prev=s,n.next=s,s.prev=n,s}var Oe=class r{constructor(){this.index=0,this.x=0,this.y=0,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}static create(t,e,s){let i=Mi<Ti.length?Ti[Mi++]:new r;return i.index=t,i.x=e,i.y=s,i.prev=null,i.next=null,i.z=null,i.prevZ=null,i.nextZ=null,i.steiner=!1,i}},Ti=[],la=8096,Mi=0;for(let r=0;r<la;r++)Ti.push(new Oe);var ua=1e-5,pe=new Bs(0,0,0,1,0),Pi=new Bs(0,0,0,1,0);function no(r,t,e){let s=0;for(let i=1;i<e;i++){let n=r[2*(t+i-1)],o=r[2*(t+i-1)+1];s+=(r[2*(t+i)]-n)*(r[2*(t+i)+1]+o)}return s}function pa(r,t,e,s,i){let n=0,o=2;for(let a=e;a<s;a+=3){let c=(r[a]-i)*o,l=(r[a+1]-i)*o,u=(r[a+2]-i)*o;n+=Math.abs((t[c]-t[u])*(t[l+1]-t[c+1])-(t[c]-t[l])*(t[u+1]-t[c+1]))}return n}function oo(r,t){let{coords:e,lengths:s,hasIndeterminateRingOrder:i}=t,n=0,o=r;if(i)return!1;let a=0;for(let c=0;c<s.length;){let l=c,u=s[c],h=no(e,a,u),m=[];for(;++l<s.length;){let w=s[l],S=no(e,a+u,w);if(!(S>0))break;h+=S,m.push(a+u),u+=w}let f=o.length;to(o,e,a,a+u,m,2,n);let x=pa(o,e,f,o.length,n),v=Math.abs(h);if(Math.abs((x-v)/Math.max(1e-7,v))>ua)return o.length=0,!1;c=l,a+=u}return!0}function ao(r){let{coords:t,lengths:e}=r,{buffer:s}=nn(t,e);return s}function ha(r,t,e){let s=0;for(let i=0;i<r.lengths.length;i++){let n=r.lengths[i];for(let o=0;o<n;o++){let a=r.coords[2*(o+s)],c=r.coords[2*(o+s)+1];if(a<t||a>e||c<t||c>e)return!0}s+=n}return!1}function ys(r,t){if(r==null)return null;if(!ha(r,-128,640))return r;pe.setPixelMargin(t),pe.reset(zs.Polygon);let e=0;for(let o=0;o<r.lengths.length;o++){let a=r.lengths[o],c=r.coords[2*(0+e)],l=r.coords[2*(0+e)+1];pe.moveTo(c,l);for(let u=1;u<a;u++)c=r.coords[2*(u+e)],l=r.coords[2*(u+e)+1],pe.lineTo(c,l);pe.close(),e+=a}let s=pe.result(!1);if(!s)return null;let i=[],n=[];for(let o of s){let a=0;for(let c of o)n.push(c.x),n.push(c.y),a++;i.push(a)}return new Zi(i,n)}function co(r,t){Pi.setPixelMargin(t);let e=Pi,s=-t,i=512+t,n=[],o=!1;if(!r.nextPath())return null;let a=!0;for(;a;){r.seekPathStart();let c=[];if(!r.pathSize)return null;e.reset(zs.LineString),r.nextPoint();let l=r.x,u=r.y;if(o)e.moveTo(l,u);else{if(l<s||l>i||u<s||u>i){o=!0;continue}c.push({x:l,y:u})}let h=!1;for(;r.nextPoint();)if(l=r.x,u=r.y,o)e.lineTo(l,u);else{if(l<s||l>i||u<s||u>i){h=!0;break}c.push({x:l,y:u})}if(h)o=!0;else{if(o){let m=e.resultWithStarts();if(m)for(let f of m)n.push(f)}else n.push({line:c,start:0});a=r.nextPath(),o=!1}}return n=n.filter(c=>c.line.length>1),n.length===0?null:n}pe.setExtent(512),Pi.setExtent(512);var lo=null;function ze(){return lo}function uo(){return ct(this,null,function*(){lo=yield import("./chunk-572WNC4N.js")})}function po(r){switch(r){case y.BYTE:case y.UNSIGNED_BYTE:return 1;case y.SHORT:case y.UNSIGNED_SHORT:return 2;case y.FLOAT:case y.INT:case y.UNSIGNED_INT:return 4}}function da(r){let t=[],e=[],s=[];for(let i of r){let n=po(i.type)*i.count;switch(n%2||n%4||4){case 4:t.push(i);continue;case 2:e.push(i);continue;case 1:s.push(i);continue;default:throw new Error("Found unexpected dataType byte count")}}return t.push(...e),t.push(...s),t}var xs=class r{static fromVertexSpec({attributes:t},e){let s,i,n,o=[];for(let f in t){let x=t[f];e?.[f]!==!1&&(x.pack==="position"?s=A(_({},x),{name:f,offset:0}):x.pack==="id"?i=A(_({},x),{name:f,offset:4}):f==="bitset"?n=A(_({},x),{name:f,offset:7}):o.push(A(_({},x),{name:f})))}let a=da(o),c=[],l=8,u=1;for(let f of a)c.push(A(_({},f),{offset:l})),l+=po(f.type)*f.count,f.packAlternating&&(u=Math.max(f.packAlternating.count,u));let h=Uint32Array.BYTES_PER_ELEMENT,m=l%h;return new r(s,i,n,c,l+(m?h-m:0),u)}constructor(t,e,s,i,n,o){this.position=t,this.id=e,this.bitset=s,this.standardAttributes=i,this.stride=n,this.packVertexCount=o,i.push(s),this._attributes=[t,e,s,...i]}get attributeLayout(){if(!this._attributeLayout){let t=rn(this._attributes),e=this._attributes.map(s=>({name:s.name,count:s.count,offset:s.offset,type:s.type,packPrecisionFactor:s.packPrecisionFactor,normalized:s.normalized??!1}));this._attributeLayout={attributes:e,hash:t,stride:this.stride}}return this._attributeLayout}};var gs=class r{static fromVertexSpec(t,e){let s=xs.fromVertexSpec(t,e);return new r(s)}constructor(t){this._spec=t,this._packed=new Uint8Array(this._spec.stride*this._spec.packVertexCount),this._packedU32View=new Uint32Array(this._packed.buffer),this._dataView=new DataView(this._packed.buffer)}get attributeLayout(){return this._spec.attributeLayout}get stride(){return this._spec.stride}writeVertex(t,e,s,i,n,o){for(let a=0;a<this._spec.packVertexCount;a++){let c=a*this._spec.stride;this._packPosition(s,i,c),this._packId(e,c);let l=this._spec.bitset;if(o){if(l.packTessellation){let u=l.packTessellation(o,n);this._pack(u,l,c)}for(let u of this._spec.standardAttributes)if(u.packTessellation!=null){let h=u.packTessellation(o,n);this._pack(h,u,c)}else if(u.packAlternating?.packTessellation){let h=u.packAlternating.packTessellation(o,n);for(let m=0;m<this._spec.packVertexCount;m++){let f=h[m];this._pack(f,u,m*this._spec.stride)}}}}t.vertexWriteRegion(this._packedU32View)}pack(t,e){for(let s of this._spec.standardAttributes)if(s.pack&&typeof s.pack!="string"){let i=s.pack(t,e);for(let n=0;n<this._spec.packVertexCount;n++)this._pack(i,s,n*this._spec.stride)}else if(s.packAlternating?.pack){let i=s.packAlternating.pack(t,e);for(let n=0;n<this._spec.packVertexCount;n++){let o=i[n];this._pack(o,s,n*this._spec.stride)}}}_packPosition(t,e,s){let{offset:i}=this._spec.position,n=this._spec.position.packPrecisionFactor??1,o=gn(t*n,e*n);this._dataView.setUint32(s+i,o,!0)}_packId(t,e){let s=t*(this._spec.id.packPrecisionFactor??1),i=4278190080&this._dataView.getUint32(e+this._spec.id.offset,!0);this._dataView.setUint32(e+this._spec.id.offset,s|i,!0)}_pack(t,e,s){bn(this._dataView,t,e,s)}};function ma(r){if(!r)return!1;for(let t of r)switch(t.effect.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1}var Q=class{constructor(t,e,s,i){this._instanceId=t,this._evaluator=e,this._viewParams=s,this._optionalAttributes=i,this._evaluator.evaluator=n=>this.vertexSpec.createComputedParams(n)}get _vertexPack(){if(!this._cachedVertexPack){let t=gs.fromVertexSpec(this.vertexSpec,this._optionalAttributes);this._evaluator.hasDynamicProperties||t.pack(this._evaluator.evaluatedMeshParams,this._viewParams),this._cachedVertexPack=t}return this._cachedVertexPack}get evaluatedMeshParams(){return this._evaluator.evaluatedMeshParams}get hasEffects(){return!!this.evaluatedMeshParams.effects}get instanceId(){return this._instanceId}get attributeLayout(){return this._vertexPack.attributeLayout}setReferences(t){this._references=t}getBoundsInfo(){return null}getTileInfo(){return this._viewParams.tileInfo}loadDependencies(){return ct(this,null,function*(){ma(this._evaluator.inputMeshParams.params.effects?.effectInfos)&&(yield uo())})}enqueueRequest(t,e,s){this._evaluator.hasDynamicProperties&&this._evaluator.enqueueRequest(t,e,s)}write(t,e,s,i,n){this.ensurePacked(e,s,i);let o=this.evaluatedMeshParams.effects;if(!o||o.length===0)return void this._write(t,s,void 0,n);let a=s.readGeometryForDisplay()?.clone();if(!a)return;let c=H.fromOptimizedCIM(a,s.geometryType),l=ze();c.invertY();let u=t.id||"",h=Rr.executeEffects(o,c,u,l),m;for(;m=h.next();)m.invertY(),this._write(t,s,m,n)}ensurePacked(t,e,s){if(!this._evaluator.hasDynamicProperties)return;let i=this._evaluator.evaluateMeshParams(t,e,s);this._vertexPack.pack(i,this._viewParams)}_writeVertex(t,e,s,i,n){let o=this.evaluatedMeshParams;this._vertexPack.writeVertex(t,e,s,i,o,n)}};var fa=100,ya=de("featurelayer-fast-triangulation-enabled"),Be=class r extends Q{loadDependencies(){return ct(this,null,function*(){yield Promise.all([Wt(r.prototype,this,"loadDependencies").call(this),sn()])})}_write(t,e,s){let i=s?.asOptimized()??e.readGeometryForDisplay(),n=this._clip(i);n&&(t.recordStart(this.instanceId,this.attributeLayout),this._writeGeometry(t,e,n),t.recordEnd())}_clip(t){if(!t)return null;let e=this.hasEffects;return ys(t,e?256:8)}_writeGeometry(t,e,s){let i=s.maxLength>fa,n=[],o=this.createTesselationParams(e);if(!i&&ya&&oo(n,s))return void(n.length&&this._writeVertices(t,e,s.coords,o,n));let a=ao(s);this._writeVertices(t,e,a,o)}_writeVertices(t,e,s,i,n){let o=e.getDisplayId(),a=t.vertexCount(),c=this.hasEffects,l=0;if(n)for(let u of n){let h=s[2*u],m=s[2*u+1];c&&t.recordBounds(h,m,0,0),this._writeVertex(t,o,h,m,i),l++}else for(let u=0;u<s.length;u+=2){let h=Math.round(s[u]),m=Math.round(s[u+1]);c&&t.recordBounds(h,m,0,0),this._writeVertex(t,o,h,m,i),l++}t.indexEnsureSize(l);for(let u=0;u<l;u++)t.indexWrite(u+a)}};var xa={createComputedParams:r=>r,attributes:{id:{type:y.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:y.UNSIGNED_BYTE,count:1},pos:{type:y.SHORT,count:2,pack:"position",packPrecisionFactor:10},inverseArea:{type:y.FLOAT,count:1,packTessellation:({inverseArea:r})=>r}}},bs=class extends Be{constructor(){super(...arguments),this.vertexSpec=xa}createTesselationParams(t){return{inverseArea:1/t.readGeometryArea()}}};var ga=()=>Gt.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.meshWriterUtils"),ba=0,va=100;function yt(r,t){return[!!r?.minScale&&t.scaleToZoom(r.minScale)||ba,!!r?.maxScale&&t.scaleToZoom(r.maxScale)||va]}function Le(r){return 1<<r}function Et(r){let t=0;for(let[e,s]of r)s&&(t|=1<<e);return t}function R(r){let t;if(!r)return[0,0,0,0];if(typeof r=="string"){let o=yn.fromString(r);if(!o)return ga().errorOnce(new me("mapview:mesh-processing","Unable to parse string into color",{color:r})),[0,0,0,0];t=o.toArray()}else t=r;let[e,s,i,n]=t;return[e*(n/255),s*(n/255),i*(n/255),n]}function ho(r){switch(r){case"butt":case Er.Butt:return kr.BUTT;case"round":case Er.Round:return kr.ROUND;case"square":case Er.Square:return kr.SQUARE}}function mo(r){switch(r){case"bevel":case Dr.Bevel:return Vr.BEVEL;case"miter":case Dr.Miter:return Vr.MITER;case"round":case Dr.Round:return Vr.ROUND}}function vs(r,t){return Math.round(Math.min(Math.sqrt(r*t),255))}function Sr(r,t){return Math.round(r*t)/t}function Fi(r,t){return Math.ceil(r*t)/t}var ki={createComputedParams:r=>r,attributes:{id:{type:y.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:y.UNSIGNED_BYTE,count:1},pos:{type:y.SHORT,count:2,pack:"position",packPrecisionFactor:10},zoomRange:{type:y.SHORT,count:2,packPrecisionFactor:At,pack:({scaleInfo:r},{tileInfo:t})=>yt(r,t)},color:{type:y.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:r})=>R(r)}}},Jt=class extends Be{constructor(){super(...arguments),this.vertexSpec=ki}createTesselationParams(t){return null}};var We={createComputedParams:r=>r,attributes:A(_({},ki.attributes),{tlbr:{count:4,type:y.UNSIGNED_SHORT,pack:({sprite:r})=>{let{rect:t,width:e,height:s}=r,i=t.x+Nt,n=t.y+Nt;return[i,n,i+e,n+s]}},inverseRasterizationScale:{count:1,type:y.BYTE,packPrecisionFactor:16,pack:({sprite:r})=>1/r.rasterizationScale}})},Re=class extends Jt{constructor(){super(...arguments),this.vertexSpec=We}_write(t,e,s){let i=s?.asOptimized()??e.readGeometryForDisplay(),n=this._clip(i);if(!n)return;let o=this.evaluatedMeshParams.sprite?.textureBinding;t.recordStart(this.instanceId,this.attributeLayout,o),this._writeGeometry(t,e,n),t.recordEnd()}};function Vi(r){let{sprite:t,aspectRatio:e,scaleProportionally:s}=r,i=T(r.height),n=i>0?i:t.height,o=i*e;return o<=0?o=t.width:s&&(o*=t.width/t.height),{width:o,height:n}}function Ci(r){let{applyRandomOffset:t,sampleAlphaOnly:e}=r,{width:s,height:i}=Vi(r);return Et([[Wr,t],[fe,e],[Ar,s<Ze],[Gr,i<Ze]])}function Ei(r){let{width:t}=Vi(r);return Math.round(t<Ze?t*qe:t)}function Di(r){let{height:t}=Vi(r);return Math.round(t<Ze?t*qe:t)}var Ni={createComputedParams:r=>r,attributes:A(_({},We.attributes),{bitset:{count:1,type:y.UNSIGNED_BYTE,pack:Ci},width:{count:1,type:y.UNSIGNED_SHORT,pack:Ei},height:{count:1,type:y.UNSIGNED_SHORT,pack:Di},offset:{count:2,type:y.SHORT,pack:({offsetX:r,offsetY:t})=>[T(r),-T(t)]},scale:{count:2,type:y.UNSIGNED_BYTE,packPrecisionFactor:16,pack:({scaleX:r,scaleY:t})=>[r,t]},angle:{count:1,type:y.UNSIGNED_BYTE,pack:({angle:r})=>xn(r)}})},ws=class extends Re{constructor(){super(...arguments),this.vertexSpec=Ni}};var Oi=class{constructor(){this.extrusionOffsetX=0,this.extrusionOffsetY=0,this.normalX=0,this.normalY=0,this.directionX=0,this.directionY=0,this.distance=0}},Ge={createComputedParams:r=>r,attributes:{id:{type:y.UNSIGNED_BYTE,count:3,pack:"id"},pos:{type:y.SHORT,count:2,pack:"position",packPrecisionFactor:10},bitset:{type:y.UNSIGNED_BYTE,count:1},zoomRange:{type:y.SHORT,count:2,packPrecisionFactor:At,pack:({scaleInfo:r},{tileInfo:t})=>yt(r,t)},color:{type:y.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:r})=>R(r)},offset:{type:y.BYTE,count:2,packPrecisionFactor:16,packTessellation:({extrusionOffsetX:r,extrusionOffsetY:t})=>[Sr(r,16),Sr(t,16)]},normal:{type:y.BYTE,count:2,packPrecisionFactor:16,packTessellation:({normalX:r,normalY:t})=>[Sr(r,16),Sr(t,16)]},halfWidth:{type:y.UNSIGNED_SHORT,count:1,packPrecisionFactor:16,pack:({width:r})=>Fi(T(.5*r),16)},referenceHalfWidth:{type:y.UNSIGNED_SHORT,count:1,packPrecisionFactor:16,pack:({referenceWidth:r})=>Fi(T(.5*r),16)}}},zi=class{constructor(){this.id=0,this.bitset=0,this.indexCount=0,this.vertexCount=0,this.vertexFrom=0,this.vertexBounds=0}},fo=65535,te=class extends Q{constructor(t,e,s,i){super(t,e,s,i),this.vertexSpec=Ge,this._currentWrite=new zi,this._tessellationOptions={halfWidth:0,pixelCoordRatio:1,offset:0,wrapDistance:fo,textured:!1},this._tessParams=new Oi,this._initializeTessellator()}writeLineVertices(t,e,s){let i=this._getLines(e);i!=null&&this._writeVertices(t,s,i)}_initializeTessellator(){this._lineTessellator=new vn(this._writeTesselatedVertex.bind(this),this._writeTriangle.bind(this),!0)}_write(t,e,s){let i=s??H.fromFeatureSetReaderCIM(e);i&&this._writeGeometry(t,e,i)}_writeGeometry(t,e,s,i){t.recordStart(this.instanceId,this.attributeLayout,i),this.writeLineVertices(t,s,e),t.recordEnd()}_getLines(t){return co(t,Fr(this.evaluatedMeshParams))}_writeVertices(t,e,s){let{_currentWrite:i,_tessellationOptions:n,evaluatedMeshParams:o}=this,{width:a,capType:c,joinType:l,miterLimit:u,hasSizeVV:h}=o,m=T(.5*a);n.halfWidth=m,n.capType=ho(c),n.joinType=mo(l),n.miterLimit=u;let f=!h;i.out=t,i.id=e.getDisplayId(),i.vertexCount=0,i.indexCount=0,i.vertexFrom=t.vertexCount(),i.vertexBounds=f&&m<tn?0:1;for(let{line:x,start:v}of s)n.initialDistance=v%fo,this._lineTessellator.tessellate(x,n,f)}_writeTesselatedVertex(t,e,s,i,n,o,a,c,l,u,h){let{out:m,id:f,vertexBounds:x}=this._currentWrite;return this.hasEffects&&m.recordBounds(t,e,x,x),this._tessParams.extrusionOffsetX=a,this._tessParams.extrusionOffsetY=c,this._tessParams.normalX=l,this._tessParams.normalY=u,this._tessParams.directionX=n,this._tessParams.directionY=o,this._tessParams.distance=h,this._writeVertex(m,f,t,e,this._tessParams),this._currentWrite.vertexFrom+this._currentWrite.vertexCount++}_writeTriangle(t,e,s){let{out:i}=this._currentWrite;i.indexEnsureSize(3),i.indexWrite(t),i.indexWrite(e),i.indexWrite(s),this._currentWrite.indexCount+=3}};var Bi={createComputedParams:r=>r,attributes:A(_({},Ge.attributes),{bitset:{type:y.UNSIGNED_BYTE,count:1,pack:r=>0},color:{type:y.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:r})=>R(r)}})},Ir={createComputedParams:r=>r,attributes:A(_({},Ge.attributes),{bitset:{type:y.UNSIGNED_BYTE,count:1,pack:r=>Et([[ye,!0]])},color:{type:y.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:r})=>R(r)}})},he=class extends te{constructor(){super(...arguments),this.vertexSpec=Ir}},ee=class r extends Jt{constructor(t,e,s,i){super(t,e,s,i),this.vertexSpec=Bi,this._lineMeshWriter=this._createOutlineWriter(t,e,s,i)}_createOutlineWriter(t,e,s,i){return new he(t,e,s,i)}_write(t,e,s){let i=s?.asOptimized()??e.readGeometryForDisplay(),n=this._clip(i);n&&(t.recordStart(this.instanceId,this.attributeLayout),this._writeGeometry(t,e,n),this._lineMeshWriter.writeLineVertices(t,H.fromOptimizedCIM(n,"esriGeometryPolyline"),e),t.recordEnd())}_clip(t){return t?ys(t,Fr(this.evaluatedMeshParams)):null}ensurePacked(t,e,s){super.ensurePacked(t,e,s),this._lineMeshWriter.ensurePacked(t,e,s)}enqueueRequest(t,e,s){super.enqueueRequest(t,e,s),this._lineMeshWriter.enqueueRequest(t,e,s)}loadDependencies(){return ct(this,null,function*(){yield Promise.all([Wt(r.prototype,this,"loadDependencies").call(this),this._lineMeshWriter.loadDependencies()])})}};var St=Ni.attributes,wa=Ir.attributes,_a={createComputedParams:r=>r,attributes:{id:St.id,pos:St.pos,zoomRange:St.zoomRange,tlbr:St.tlbr,angle:St.angle,color:St.color,bitset:{type:y.UNSIGNED_BYTE,count:1,pack:r=>Ci(r)},aux1:{count:1,type:y.UNSIGNED_SHORT,pack:r=>Ei(r)},aux2:{count:1,type:y.UNSIGNED_SHORT,pack:r=>Di(r)},aux3:{count:2,type:y.SHORT,pack:({offsetX:r,offsetY:t})=>[T(r),T(t)]},aux4:{count:2,type:y.UNSIGNED_BYTE,pack:({scaleX:r,scaleY:t})=>[r*Ct,t*Ct]}}},Sa={createComputedParams:r=>r,attributes:{id:St.id,pos:St.pos,zoomRange:St.zoomRange,tlbr:St.tlbr,angle:St.angle,color:wa.color,bitset:{type:y.UNSIGNED_BYTE,count:1,pack:r=>Et([[ye,!0]])},aux1:{count:1,type:y.UNSIGNED_SHORT,pack:r=>T(.5*r.width)*Ct},aux2:{count:1,type:y.UNSIGNED_SHORT,pack:r=>T(.5*r.referenceWidth)*Ct},aux3:{count:2,type:y.SHORT,packTessellation:({extrusionOffsetX:r,extrusionOffsetY:t})=>[r*Ct,t*Ct]},aux4:{count:2,type:y.UNSIGNED_BYTE,packTessellation:({normalX:r,normalY:t})=>[r*Ct+ms,t*Ct+ms]}}},Li=class extends he{constructor(){super(...arguments),this.vertexSpec=Sa}},_s=class r extends ee{constructor(){super(...arguments),this.vertexSpec=_a}_createOutlineWriter(t,e,s,i){return new Li(t,e,s,i)}_write(t,e,s){let i=s?.asOptimized()??e.readGeometryForDisplay(),n=this._clip(i);if(!n)return;let o=this.evaluatedMeshParams.sprite?.textureBinding;t.recordStart(this.instanceId,this.attributeLayout,o),this._writeGeometry(t,e,n),this._lineMeshWriter.writeLineVertices(t,H.fromOptimizedCIM(n,"esriGeometryPolyline"),e),t.recordEnd()}ensurePacked(t,e,s){super.ensurePacked(t,e,s),this._lineMeshWriter.ensurePacked(t,e,s)}enqueueRequest(t,e,s){super.enqueueRequest(t,e,s),this._lineMeshWriter.enqueueRequest(t,e,s)}loadDependencies(){return ct(this,null,function*(){yield Promise.all([Wt(r.prototype,this,"loadDependencies").call(this),this._lineMeshWriter.loadDependencies()])})}};var Ia={createComputedParams:r=>r,attributes:_(_({},We.attributes),Bi.attributes)},Ta={createComputedParams:r=>r,attributes:_(_({},We.attributes),Ir.attributes)},Ri=class extends he{constructor(){super(...arguments),this.vertexSpec=Ta}},Ss=class r extends ee{constructor(){super(...arguments),this.vertexSpec=Ia}_createOutlineWriter(t,e,s,i){return new Ri(t,e,s,i)}_write(t,e,s){let i=s?.asOptimized()??e.readGeometryForDisplay(),n=this._clip(i);if(!n)return;let o=this.evaluatedMeshParams.sprite?.textureBinding;t.recordStart(this.instanceId,this.attributeLayout,o),this._writeGeometry(t,e,n),this._lineMeshWriter.writeLineVertices(t,H.fromOptimizedCIM(n,"esriGeometryPolyline"),e),t.recordEnd()}ensurePacked(t,e,s){super.ensurePacked(t,e,s),this._lineMeshWriter.ensurePacked(t,e,s)}enqueueRequest(t,e,s){super.enqueueRequest(t,e,s),this._lineMeshWriter.enqueueRequest(t,e,s)}loadDependencies(){return ct(this,null,function*(){yield Promise.all([Wt(r.prototype,this,"loadDependencies").call(this),this._lineMeshWriter.loadDependencies()])})}};var Ma={createComputedParams:r=>r,attributes:{pos:{type:y.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:y.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:y.UNSIGNED_BYTE,count:1},offset:{type:y.BYTE,count:2,packAlternating:{count:4,pack:()=>[[-1,-1],[1,-1],[-1,1],[1,1]]}}}},Is=class extends Q{constructor(){super(...arguments),this.vertexSpec=Ma}_write(t,e){t.recordStart(this.instanceId,this.attributeLayout);let s=e.getDisplayId();if(e.geometryType==="esriGeometryPoint"){let i=e.readXForDisplay(),n=e.readYForDisplay();this._writeQuad(t,s,i,n)}else e.geometryType==="esriGeometryMultipoint"&&e.readGeometryForDisplay()?.forEachVertex((n,o)=>{n>=0&&n<=512&&o>=0&&o<=512&&this._writeQuad(t,s,n,o)});t.recordEnd()}_writeQuad(t,e,s,i){let n=t.vertexCount();this._writeVertex(t,e,s,i),t.indexWrite(n+0),t.indexWrite(n+1),t.indexWrite(n+2),t.indexWrite(n+1),t.indexWrite(n+3),t.indexWrite(n+2)}};function yo(r,t,e){return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r}function go(r,t){return Math.sqrt(r*r+t*t)}function xo(r){let t=go(r[0],r[1]);r[0]/=t,r[1]/=t}function Pa(r,t){return go(r[0]-t[0],r[1]-t[1])}function Fa(r,t){return r[t+1]}function bo(r){return r.length-1}function ka(r){let t=0;for(let e=0;e<bo(r);e++)t+=Va(r,e);return t}function Va(r,t,e=1){let[s,i]=Fa(r,t);return[s,i]=[Math.round(s),Math.round(i)],Math.sqrt(s*s+i*i)*e}var Wi=class r{constructor(t,e,s,i,n){this._segments=t,this._index=e,this._distance=s,this._xStart=i,this._yStart=n,this._done=!1}static create(t){return new r(t,0,0,t[0][0],t[0][1])}clone(){return new r(this._segments,this._index,this._distance,this.xStart,this.yStart)}equals(t){return this._index===t._index||t._index===this._index-1&&(this._distance===0||t._distance===1)||t._index===this._index+1&&(this._distance===1||t._distance===0)}leq(t){return this._index<t._index||this._index===t._index&&this._distance<=t._distance}geq(t){return this._index>t._index||this._index===t._index&&this._distance>=t._distance}get _segment(){return this._segments[this._index+1]}get angle(){let t=this.dy,e=(0*t+-1*-this.dx)/(1*this.length),s=Math.acos(e);return t>0&&(s=2*Math.PI-s),s}get xStart(){return this._xStart}get yStart(){return this._yStart}get x(){return this.xStart+this.distance*this.dx}get y(){return this.yStart+this.distance*this.dy}get dx(){return this._segment[0]}get dy(){return this._segment[1]}get xMidpoint(){return this.xStart+.5*this.dx}get yMidpoint(){return this.yStart+.5*this.dy}get xEnd(){return this.xStart+this.dx}get yEnd(){return this.yStart+this.dy}get length(){let{dx:t,dy:e}=this;return Math.sqrt(t*t+e*e)}get remainingLength(){return this.length*(1-this._distance)}get backwardLength(){return this.length*this._distance}get distance(){return this._distance}get done(){return this._done}hasPrev(){return this._index-1>=0}hasNext(){return this._index+1<bo(this._segments)}next(){return this.hasNext()?(this._xStart+=this.dx,this._yStart+=this.dy,this._distance=0,this._index+=1,this):null}prev(){return this.hasPrev()?(this._index-=1,this._xStart-=this.dx,this._yStart-=this.dy,this._distance=1,this):(this._done=!0,null)}_seekBackwards(t,e){let s=this.backwardLength;if(t<=s)return this._distance=(s-t)/this.length,this;let i=this.backwardLength;for(;this.prev();){if(i+this.length>t)return this._seekBackwards(t-i);i+=this.length}return this._distance=0,e?this:null}seek(t,e=!1){if(t<0)return this._seekBackwards(Math.abs(t),e);if(t<=this.remainingLength)return this._distance=(this.backwardLength+t)/this.length,this;let s=this.remainingLength;for(;this.next();){if(s+this.length>t)return this.seek(t-s,e);s+=this.length}return this._distance=1,e?this:null}};function vo(r,t,e,s=!0){let i=ka(r),n=Wi.create(r),o=i/2;if(!s)return n.seek(o),void(Math.abs(n.x)<1024&&Math.abs(n.y)<1024&&e(n.clone(),0,o+0*t,i));let a=Math.max((i-t)/2,0),c=Math.floor(a/t),l=o-c*t;n.seek(l);for(let u=-c;u<=c;u++)Math.abs(n.x)<1024&&Math.abs(n.y)<1024&&e(n.clone(),u,o+u*t,i),n.seek(t)}function wo(r,t){let e=t;for(let s=0;s<r.length;s++){let i=r[s];Ca(i,e);let n=[];n.push(i[0]);for(let o=1;o<i.length;o++){let[a,c]=i[o-1],[l,u]=i[o],h=l-a,m=u-c;n.push([h,m])}r[s]=n,i=n}return r}function Ca(r,t){if(t<=0)return;let s=r.length;if(s<3)return;let i=[],n=0;i.push(0);for(let h=1;h<s;h++)n+=Pa(r[h],r[h-1]),i.push(n);t=Math.min(t,.2*n);let o=[];o.push(r[0][0]),o.push(r[0][1]);let a=r[s-1][0],c=r[s-1][1],l=yo([0,0],r[0],r[1]);xo(l),r[0][0]+=t*l[0],r[0][1]+=t*l[1],yo(l,r[s-1],r[s-2]),xo(l),r[s-1][0]+=t*l[0],r[s-1][1]+=t*l[1];for(let h=1;h<s;h++)i[h]+=t;i[s-1]+=t;let u=.5*t;for(let h=1;h<s-1;h++){let m=0,f=0,x=0;for(let v=h-1;v>=0&&!(i[v+1]<i[h]-u);v--){let w=u+i[v+1]-i[h],S=i[v+1]-i[v],P=i[h]-i[v]<u?1:w/S;if(Math.abs(P)<1e-6)break;let z=P*P,B=P*w-.5*z*S,E=P*S/t,W=r[v+1],at=r[v][0]-W[0],Dt=r[v][1]-W[1];m+=E/B*(W[0]*P*w+.5*z*(w*at-S*W[0])-z*P*S*at/3),f+=E/B*(W[1]*P*w+.5*z*(w*Dt-S*W[1])-z*P*S*Dt/3),x+=E}for(let v=h+1;v<s&&!(i[v-1]>i[h]+u);v++){let w=u-i[v-1]+i[h],S=i[v]-i[v-1],P=i[v]-i[h]<u?1:w/S;if(Math.abs(P)<1e-6)break;let z=P*P,B=P*w-.5*z*S,E=P*S/t,W=r[v-1],at=r[v][0]-W[0],Dt=r[v][1]-W[1];m+=E/B*(W[0]*P*w+.5*z*(w*at-S*W[0])-z*P*S*at/3),f+=E/B*(W[1]*P*w+.5*z*(w*Dt-S*W[1])-z*P*S*Dt/3),x+=E}o.push(m/x),o.push(f/x)}o.push(a),o.push(c);for(let h=0,m=0;h<s;h++)r[h][0]=o[m++],r[h][1]=o[m++]}var Ae=class{static getPlacement(t,e,s,i,n,o){let a=on(s);return a?(e===-1&&t.invertY(),a.execute(t,s,i,n,o)):null}};var _o=96,Ts=class{constructor(t){let{offsetX:e,offsetY:s,postAngle:i,fontSize:n,scaleFactor:o,transforms:a}=t;if(this.offsetX=e,this.offsetY=s,this.postAngle=i,this.fontSize=Math.min(n,_o),this.transforms=a,a&&a.infos.length>1){let c=Nr(n,i,!1,e,s,a);this.fontSize=Math.min(c.size,_o),this.postAngle=c.rotation,this.offsetX=c.offsetX,this.offsetY=c.offsetY}o&&(this.fontSize*=o,this.offsetX*=o,this.offsetY*=o)}};var Tr=28,re=[4,4],Ms=[16,4],Ea={topLeft:Ms,topRight:Ms,bottomLeft:Ms,bottomRight:Ms},Ps=[4,2],xt=[4,6],So={topLeft:Ps,topRight:Ps,bottomLeft:xt,bottomRight:xt},Io={topLeft:Ps,topRight:xt,bottomLeft:Ps,bottomRight:xt},Da={topLeft:xt,topRight:xt,bottomLeft:re,bottomRight:re},Na={topLeft:re,topRight:re,bottomLeft:xt,bottomRight:xt},Oa={topLeft:xt,topRight:re,bottomLeft:xt,bottomRight:re},za={topLeft:re,topRight:xt,bottomLeft:re,bottomRight:xt},Ba={createComputedParams:r=>r,attributes:{pos:{type:y.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:y.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:y.UNSIGNED_BYTE,count:1,packTessellation:({isBackground:r,mapAligned:t})=>Et([[Cn,r],[En,!!t]])},zoomRange:{type:y.UNSIGNED_SHORT,count:2,packPrecisionFactor:At,packTessellation:({minZoom:r,maxZoom:t})=>[r||0,t||Tr]},offset:{type:y.SHORT,count:2,packPrecisionFactor:8,packAlternating:{count:4,packTessellation:({offsets:r})=>{let{bottomLeft:t,bottomRight:e,topLeft:s,topRight:i}=r;return[s,i,t,e]}}},textureUV:{type:y.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,packTessellation:({texcoords:r})=>{let{bottomLeft:t,bottomRight:e,topLeft:s,topRight:i}=r;return[s,i,t,e]}}},color:{type:y.UNSIGNED_BYTE,count:4,normalized:!0,packTessellation:({color:r})=>r},fontSize:{type:y.UNSIGNED_SHORT,count:1,packPrecisionFactor:4,packTessellation:({fontSize:r})=>T(r)},referenceSize:{type:y.UNSIGNED_BYTE,count:1,packPrecisionFactor:4,packTessellation:({fontSize:r},{referenceSize:t})=>T(t??r)},haloColor:{type:y.UNSIGNED_BYTE,count:4,normalized:!0,pack:({haloColor:r})=>R(r)},haloFontSize:{type:y.UNSIGNED_SHORT,count:1,packPrecisionFactor:4,pack:({haloFontSize:r})=>T(r)},clipAngle:{type:y.UNSIGNED_BYTE,count:1,packTessellation:({clipAngle:r})=>La(r||0)},referenceSymbol:{type:y.BYTE,count:4,packPrecisionFactor:1,packTessellation:(r,t)=>{if(!r.referenceBounds)return[0,0,0,0];let e=hn(t.horizontalAlignment),s=dn(t.verticalAlignment),{offsetX:i,offsetY:n,size:o}=r.referenceBounds;return[T(i),-T(n),T(o),e+1<<2|s+1]}}}},Ue=class extends Q{constructor(){super(...arguments),this.vertexSpec=Ba,this._textMeshParamsPropsInitialized=!1}ensurePacked(t,e,s){super.ensurePacked(t,e,s),this._textMeshParamsPropsInitialized&&!this._evaluator.hasDynamicProperties||(this._textMeshTransformProps=new Ts(this.evaluatedMeshParams),this._textMeshParamsPropsInitialized=!0)}_write(t,e,s){let i=this._getShaping();if(!i)return;let n=e.getDisplayId();if(this.evaluatedMeshParams.placement!=null)return this._writePlacedTextMarkers(t,e,i,s);if(s&&s.nextPath())return s.nextPoint(),this._writeGlyphs(t,n,s.x,s.y,i,0);if(e.geometryType==="esriGeometryPolygon"){let c=e.readCentroidForDisplay();if(!c)return;let[l,u]=c.coords;return this._writeGlyphs(t,n,l,u,i,0)}if(e.geometryType==="esriGeometryMultipoint")return void e.readGeometryForDisplay()?.forEachVertex((l,u)=>this._writeGlyphs(t,n,l,u,i,0));let o=e.readXForDisplay(),a=e.readYForDisplay();return this._writeGlyphs(t,n,o,a,i,0)}_writePlacedTextMarkers(t,e,s,i){let n=i??H.fromFeatureSetReaderCIM(e);if(!n)return;let o=-1,a=Ae.getPlacement(n,o,this.evaluatedMeshParams.placement,T(1),t.id,ze());if(!a)return;let c=e.getDisplayId(),l=a.next();for(;l!=null;){let u=l.tx,h=-l.ty,m=-l.getAngle();this._writeGlyphs(t,c,u,h,s,m),l=a.next()}}_getShaping(){let t=this._textMeshTransformProps,e=this.evaluatedMeshParams;if(!e.glyphs?.glyphs.length)return null;let s=Math.round(T(t.fontSize)),i=T(t.offsetX),n=T(t.offsetY),o=Os(T(e.lineWidth),32,512),a=Qi*Os(e.lineHeightRatio,.25,4);return fn(e.glyphs,{scale:s/Ji,angle:t.postAngle,xOffset:i,yOffset:n,horizontalAlignment:e.horizontalAlignment,verticalAlignment:e.verticalAlignment,maxLineWidth:o,lineHeight:a,decoration:e.decoration,borderLineSizePx:T(e.boxBorderLineSize),hasBackground:!!e.boxBackgroundColor,useCIMAngleBehavior:e.useCIMAngleBehavior})}_writeGlyphs(t,e,s,i,n,o,a,c){let l=this.evaluatedMeshParams,u=this._textMeshTransformProps,h=u.fontSize,m=T(u.offsetX),f=T(u.offsetY),[x,v]=yt(l.scaleInfo,this.getTileInfo());o!==0&&n.setRotation(o);let w=n.bounds,S=s+w.x+m,P=i+w.y-f,z=2*(l.minPixelBuffer?l.minPixelBuffer/h:1),B=Math.max(w.width,w.height)*z;n.textBox&&(t.recordStart(this.instanceId,this.attributeLayout,n.glyphs[0].textureBinding),t.recordBounds(S,P,B,B),this._writeTextBox(t,e,s,i,n.textBox,a,c),t.recordEnd());for(let E of n.glyphs){t.recordStart(this.instanceId,this.attributeLayout,E.textureBinding),t.recordBounds(S,P,B,B);let{texcoords:W,offsets:at}=E;this._writeQuad(t,e,s,i,_({texcoords:W,offsets:at,fontSize:h,color:R(l.color),isBackground:!1,referenceBounds:a,minZoom:x,maxZoom:v},c)),t.recordEnd()}o!==0&&n.setRotation(-o)}_writeTextBox(t,e,s,i,n,o,a){let c=this.evaluatedMeshParams,{fontSize:l}=this._textMeshTransformProps,{boxBackgroundColor:u,boxBorderLineColor:h}=c,m=_({isBackground:!0,fontSize:l,referenceBounds:o},a);u&&(this._writeQuad(t,e,s,i,_({texcoords:Ea,offsets:n.main,color:R(u)},m)),h||(this._writeQuad(t,e,s,i,_({texcoords:Da,offsets:n.top,color:R(u)},m)),this._writeQuad(t,e,s,i,_({texcoords:Na,offsets:n.bot,color:R(u)},m)),this._writeQuad(t,e,s,i,_({texcoords:Oa,offsets:n.left,color:R(u)},m)),this._writeQuad(t,e,s,i,_({texcoords:za,offsets:n.right,color:R(u)},m)))),h&&(this._writeQuad(t,e,s,i,_({texcoords:So,offsets:n.top,color:R(h)},m)),this._writeQuad(t,e,s,i,_({texcoords:So,offsets:n.bot,color:R(h)},m)),this._writeQuad(t,e,s,i,_({texcoords:Io,offsets:n.left,color:R(h)},m)),this._writeQuad(t,e,s,i,_({texcoords:Io,offsets:n.right,color:R(h)},m)))}_writeQuad(t,e,s,i,n){let o=t.vertexCount();this._writeVertex(t,e,s,i,n),t.indexWrite(o+0),t.indexWrite(o+1),t.indexWrite(o+2),t.indexWrite(o+1),t.indexWrite(o+3),t.indexWrite(o+2)}},La=r=>Math.round(r*(254/360));var Fs=1,$e=0,Ra=128,Wa=Ui(r=>{let t=0;if(r===0)return 1/0;for(;!(r%2);)t++,r/=2;return t}),ks=class extends Ue{constructor(){super(...arguments),this._zoomLevel=0}_write(t,e,s,i){if(this._zoomLevel=i||0,s!=null)throw new Error("InternalError: EffectGeometry not support for LabelMeshWriter");switch(e.geometryType){case"esriGeometryPoint":{let n=e.readXForDisplay(),o=e.readYForDisplay();return this._writePoint(t,n,o,e)}case"esriGeometryEnvelope":case"esriGeometryPolygon":case"esriGeometryMultipoint":{let n=e.readCentroidForDisplay();if(!n)return;let[o,a]=n.coords;return this._writePoint(t,o,a,e)}case"esriGeometryPolyline":{let n=e.readLegacyGeometryForDisplay();this._writeLines(t,e,n)}}}_writePoint(t,e,s,i){let n=this._getShaping();if(!n)return;let o=this._getPointReferenceBounds();o||(o={offsetX:0,offsetY:0,size:0});let a=n.boundsT,c=un(this.evaluatedMeshParams.horizontalAlignment),l=pn(this.evaluatedMeshParams.verticalAlignment),u=this.evaluatedMeshParams.scaleInfo?.maxScale??0,h=this.evaluatedMeshParams.scaleInfo?.minScale??0,m=gr(i.getDisplayId());t.metricStart(new Ke(m,e,s,c,l,u,h,o)),t.metricBoxWrite(a),this._writeGlyphs(t,i.getDisplayId(),e,s,n,0,o),t.metricEnd()}_getPointReferenceBounds(){if(!this._references)return null;for(let t of this._references){let e=t.getBoundsInfo();if(e)return e}return null}_writeLines(t,e,s){let{repeatLabel:i,scaleInfo:n}=this.evaluatedMeshParams,o=this.evaluatedMeshParams.repeatLabelDistance||128,a=this._getShaping();if(!a)return;this._current={out:t,id:e.getDisplayId(),shaping:a,zoomRange:yt(n,this.getTileInfo()),referenceBounds:this._getPointReferenceBounds()||{offsetX:0,offsetY:0,size:0}};let c=wo(s.paths,a.bounds.width),l=this._placeSubdivGlyphs.bind(this),u=(a.bounds.width+o)/(1<<Fs);for(let h of c)vo(h,u,l,!!i)}_placeSubdivGlyphs(t,e,s,i){let{allowOverrun:n,labelPosition:o,repeatLabelDistance:a}=this.evaluatedMeshParams,c=this._current.zoomRange[0],l=Wa(e),u=this._current.shaping.bounds.width/(1<<Fs),h=Math.sqrt(a||Ra)/(1<<Fs),m=Math.min(s,i-s),f=this._current.shaping.isMultiline?Tr:Math.log2(m/(h+u/2)),x=e===0?f:Math.min(l,f),v=Math.max(c,this._zoomLevel+Fs-x),w=this._zoomLevel-v,S=this._current.shaping.bounds.width/2*2**w;this._current.shaping.isMultiline?e===0&&this._placeStraight(t,v):n&&w<0?this._placeStraightAlong(t,c):o==="parallel"?this._placeStraightAlong(t,v):o==="curved"&&this._placeCurved(t,v,S)}_placeStraight(t,e){let{out:s,id:i,shaping:n,referenceBounds:o}=this._current,{x:a,y:c}=t,l=gr(i),u=this.evaluatedMeshParams.scaleInfo?.maxScale??0,h=this.evaluatedMeshParams.scaleInfo?.minScale??0;s.metricStart(new Ke(l,t.x,t.y,0,0,u,h,null)),s.metricBoxWrite(n.boundsT);let m=t.angle*(180/Math.PI)%360,f=(t.angle*(180/Math.PI)+180)%360;this._writeGlyphs(s,i,a,c,n,0,o,{clipAngle:m,mapAligned:!0,isLineLabel:!0,minZoom:e}),this._writeGlyphs(s,i,a,c,n,0,o,{clipAngle:f,mapAligned:!0,isLineLabel:!0,minZoom:e}),s.metricEnd()}_placeCurved(t,e,s){let{out:i,id:n}=this._current,o=t.clone(),a=t.angle*(180/Math.PI)%360,c=(t.angle*(180/Math.PI)+180)%360,l=gr(n),u=this.evaluatedMeshParams.scaleInfo?.maxScale??0,h=this.evaluatedMeshParams.scaleInfo?.minScale??0;i.metricStart(new Ke(l,t.x,t.y,0,0,u,h,null)),this._placeFirst(o,e,1,a),this._placeBack(t,o,e,s,1,a),this._placeForward(t,o,e,s,1,a),this._placeFirst(o,e,0,c),this._placeBack(t,o,e,s,0,c),this._placeForward(t,o,e,s,0,c),i.metricEnd()}_placeStraightAlong(t,e){let{out:s,id:i,shaping:n,zoomRange:o,referenceBounds:a}=this._current,{boxBorderLineColor:c,boxBackgroundColor:l}=this.evaluatedMeshParams,u=t.clone(),h=t.angle*(180/Math.PI)%360,m=(t.angle*(180/Math.PI)+180)%360;if(n.glyphs.length>0&&(c||l)){let w=Math.max(e,o[0],0),S=Math.min(Tr,o[1]),P=Or(zr(),-t.angle),[z,B]=n.shapeBackground(P),E={minZoom:w,maxZoom:S,clipAngle:h,mapAligned:!0,isLineLabel:!0};s.recordStart(this.instanceId,this.attributeLayout,n.glyphs[0].textureBinding),this._writeTextBox(s,i,t.x,t.y,B,a,E),s.recordEnd(),E.clipAngle=m,s.recordStart(this.instanceId,this.attributeLayout,n.glyphs[0].textureBinding),this._writeTextBox(s,i,t.x,t.y,B,a,E),s.recordEnd()}let f=gr(i),x=this.evaluatedMeshParams.scaleInfo?.maxScale??0,v=this.evaluatedMeshParams.scaleInfo?.minScale??0;s.metricStart(new Ke(f,t.x,t.y,0,0,x,v,null)),this._placeFirst(u,e,1,h,!0),this._placeFirst(u,e,0,m,!0),s.metricEnd()}_placeBack(t,e,s,i,n,o){let a=t.clone(),c=t.backwardLength+$e;for(;a.prev()&&!(c>=i);)this._placeOnSegment(a,e,c,s,-1,n,o),c+=a.length+$e}_placeForward(t,e,s,i,n,o){let a=t.clone(),c=t.remainingLength+$e;for(;a.next()&&!(c>=i);)this._placeOnSegment(a,e,c,s,1,n,o),c+=a.length+$e}_placeFirst(t,e,s,i,n=!1){let o=t,{out:a,id:c,shaping:l,zoomRange:u,referenceBounds:h}=this._current,m=l.glyphs;for(let f of m){let x=f.x>l.bounds.x?s:1-s,v=x*t.remainingLength+(1-x)*t.backwardLength,w=Math.abs(f.x+f.width/2-l.bounds.x),S=Math.max(0,this._zoomLevel+Math.log2(w/(v+$e))),P=Math.max(e,n?0:S);f.maxZoom=Math.min(u[1],Tr),f.angle=t.angle+(1-s)*Math.PI,f.minZoom=Math.max(u[0],P),this._writeLineGlyph(a,c,o.x,o.y,l.bounds,f,i,h,!0),s&&this._isVisible(f.minZoom,f.maxZoom)&&a.metricBoxWrite(f.bounds)}}_placeOnSegment(t,e,s,i,n,o,a){let{out:c,id:l,shaping:u,referenceBounds:h}=this._current,m=u.glyphs,f=t.dx/t.length,x=t.dy/t.length,v={x:t.x+s*-n*f,y:t.y+s*-n*x};for(let w of m){let S=w.x>u.bounds.x?o:1-o;if(!(S&&n===1||!S&&n===-1))continue;let P=Math.abs(w.x+w.width/2-u.bounds.x),z=Math.max(0,this._zoomLevel+Math.log2(P/s)-.1),B=Math.max(i,this._zoomLevel+Math.log2(P/(s+t.length+$e)));if(z!==0&&(w.angle=t.angle+(1-o)*Math.PI,w.minZoom=B,w.maxZoom=z,this._writeLineGlyph(c,l,v.x,v.y,u.bounds,w,a,h,!0),o&&this._isVisible(w.minZoom,w.maxZoom))){let E=w.bounds,W=t.x-e.x,at=t.y-e.y,Dt=new mn(E.center[0]+W,E.center[1]+at,E.width,E.height);c.metricBoxWrite(Dt)}}}_writeLineGlyph(t,e,s,i,n,o,a,c,l){let u=s+n.x,h=i+n.y,m=2*(this.evaluatedMeshParams.minPixelBuffer?this.evaluatedMeshParams.minPixelBuffer/this._textMeshTransformProps.fontSize:1),f=Math.max(n.width,n.height)*m;t.recordStart(this.instanceId,this.attributeLayout,o.textureBinding),t.recordBounds(u,h,f,f);let{texcoords:x,offsets:v}=o,w=this._textMeshTransformProps.fontSize;this._writeQuad(t,e,s,i,{texcoords:x,offsets:v,fontSize:w,color:R(this.evaluatedMeshParams.color),isBackground:!1,referenceBounds:c,minZoom:Math.max(this._current.zoomRange[0],o.minZoom),maxZoom:Math.min(this._current.zoomRange[1],o.maxZoom),clipAngle:a,mapAligned:l,isLineLabel:!0}),t.recordEnd()}_isVisible(t,e){let s=this._zoomLevel;return t<=s&&s<=e}};var Ga={createComputedParams:r=>r,attributes:A(_({},Ge.attributes),{bitset:{type:y.UNSIGNED_BYTE,count:1,pack:({shouldSampleAlphaOnly:r,shouldScaleDash:t,isSDF:e})=>Et([[fe,r],[kn,t],[Vn,e]])},tlbr:{type:y.UNSIGNED_SHORT,count:4,pack:({sprite:r})=>{let{rect:t,width:e,height:s}=r,i=t.x+Nt,n=t.y+Nt;return[i,n,i+e,n+s]}},accumulatedDistance:{type:y.UNSIGNED_SHORT,count:1,packTessellation:({distance:r})=>r},segmentDirection:{type:y.BYTE,count:2,packPrecisionFactor:16,packTessellation:({directionX:r,directionY:t})=>[r,t]}})},Vs=class extends te{constructor(t,e,s,i){super(t,e,s,i),this.vertexSpec=Ga,this._tessellationOptions.textured=!0}_write(t,e,s){let i=s??H.fromFeatureSetReaderCIM(e);if(!i)return;let{sprite:n}=this.evaluatedMeshParams;this._writeGeometry(t,e,i,n?.textureBinding)}};var Cs=class r{static from(t){return"width"in t?this.fromSimpleMeshParams(t):this.fromComplexMeshParams(t)}static fromSimpleMeshParams(t){let e=new r(t.sprite,t.color,t.outlineColor,t.minPixelBuffer,t.placement,t.scaleInfo,t.effects),{type:s,width:i,height:n,angle:o,alignment:a,outlineSize:c,referenceSize:l,sprite:u,overrideOutlineColor:h}=t;e.rawWidth=T(i),e.rawHeight=T(n),e.angle=o,e.alignment=a,e.outlineSize=T(c),e.referenceSize=T(l),e.overrideOutlineColor=h,e.offsetX=T(t.offsetX),e.offsetY=T(t.offsetY),s!=="simple"||u.sdf||(e.rawWidth=u.width,e.rawHeight=u.height);let m=2;return e.sizeRatio=u.sdf?m:1,e._computeSize(t,!1),e}static fromComplexMeshParams(t){let e=new r(t.sprite,t.color,t.outlineColor,t.minPixelBuffer,t.placement,t.scaleInfo,t.effects),{alignment:s,transforms:i,size:n,scaleX:o,anchorX:a,anchorY:c,angle:l,colorLocked:u,frameHeight:h,widthRatio:m,offsetX:f,offsetY:x,outlineSize:v,referenceSize:w,scaleFactor:S,sizeRatio:P,isAbsoluteAnchorPoint:z,rotateClockwise:B,scaleSymbolsProportionally:E,sprite:W}=t;if(i&&i.infos.length>0){let Mr=Nr(n,l,B,f,x,i);n=Mr.size,l=Mr.rotation,f=Mr.offsetX,x=Mr.offsetY,B=!1}S&&(n*=S,f*=S,x*=S);let at=o*(W.width/W.height);e.alignment=s,e.rawHeight=T(n),e.rawWidth=e.rawHeight*at,e.referenceSize=T(w),e.sizeRatio=P,e.angle=l,e.rotateClockwise=B,e.anchorX=a,e.anchorY=c,e.offsetX=T(f),e.offsetY=T(x),z&&n&&(W.sdf?e.anchorX=a/(n*m):e.anchorX=a/(n*at),e.anchorY=c/n);let Dt=E&&h?n/h:1;return e.outlineSize=v===0||isNaN(v)?0:T(v)*Dt,e.scaleSymbolsProportionally=E,e.colorLocked=u,e._computeSize(t,!0),e}constructor(t,e,s,i,n,o,a){this.sprite=t,this.color=e,this.outlineColor=s,this.minPixelBuffer=i,this.placement=n,this.scaleInfo=o,this.effects=a,this.rawWidth=0,this.rawHeight=0,this.angle=0,this.outlineSize=0,this.referenceSize=0,this.sizeRatio=1,this.alignment=Cr.SCREEN,this.scaleSymbolsProportionally=!1,this.overrideOutlineColor=!1,this.colorLocked=!1,this.anchorX=0,this.anchorY=0,this.computedWidth=0,this.computedHeight=0,this.texXmin=0,this.texYmin=0,this.texXmax=0,this.texYmax=0,this.offsetX=0,this.offsetY=0,this.rotateClockwise=!0}get boundsInfo(){return{size:Math.max(this.computedHeight,this.computedWidth),offsetX:this.offsetX,offsetY:this.offsetY}}_computeSize(t,e){let{sprite:s,hasSizeVV:i}=t,n=!!s.sdf,{rawWidth:o,rawHeight:a,sizeRatio:c,outlineSize:l}=this,u=o*c,h=a*c;if(n&&!i){let z=e&&o>a?u:o,B=a,E=l+2*1;this.computedWidth=Math.min(z+E,u),this.computedHeight=Math.min(B+E,h)}else this.computedWidth=u,this.computedHeight=h;let m=n?en/Math.max(u,h):1,f=.5*(u-this.computedWidth)*m,x=.5*(h-this.computedHeight)*m,v=s.rect.x+Nt+f,w=s.rect.y+Nt+x,S=v+s.width-2*f,P=w+s.height-2*x;this.texXmin=Math.floor(v),this.texYmin=Math.floor(w),this.texXmax=Math.ceil(S),this.texYmax=Math.ceil(P),this.computedWidth*=(this.texXmax-this.texXmin)/(S-v),this.computedHeight*=(this.texYmax-this.texYmin)/(P-w),this.anchorX*=u/this.computedWidth,this.anchorY*=h/this.computedHeight}};var He={bitset:{isSDF:0,isMapAligned:1,scaleSymbolsProportionally:2,overrideOutlineColor:3,colorLocked:4}};var To=3.14159265359/180,Aa=128/Math.PI;function Ua(r,t){return r%=t,Math.abs(r>=0?r:r+t)}function $a(r){return Ua(r*Aa,256)}function Ha(r,t,e,s,i=!1){let n=zr(),o=i?1:-1;return r?Or(n,o*To*r):an(n),(t||e)&&ln(n,n,[t,-e]),s&&cn(n,n,o*To*-s),n}var Ya={createComputedParams:r=>Cs.from(r),attributes:{pos:{type:y.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:y.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:y.UNSIGNED_BYTE,count:1,pack:({sprite:r,alignment:t,scaleSymbolsProportionally:e,overrideOutlineColor:s,colorLocked:i})=>{let n=0;return r.sdf&&(n|=Le(He.bitset.isSDF)),t===Cr.MAP&&(n|=Le(He.bitset.isMapAligned)),e&&(n|=Le(He.bitset.scaleSymbolsProportionally)),s&&(n|=Le(He.bitset.overrideOutlineColor)),i&&(n|=Le(He.bitset.colorLocked)),n}},zoomRange:{type:y.SHORT,count:2,packPrecisionFactor:At,pack:({scaleInfo:r},{tileInfo:t})=>yt(r,t)},offset:{type:y.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:({angle:r,computedWidth:t,computedHeight:e,anchorX:s,anchorY:i,offsetX:n,offsetY:o,rotateClockwise:a})=>{let c=Ha(0,n,o,-r,a),l=-(.5+s)*t,u=-(.5-i)*e,h=[l,u],m=[l+t,u],f=[l,u+e],x=[l+t,u+e];return Ye(h,h,c),Ye(m,m,c),Ye(f,f,c),Ye(x,x,c),[h,m,f,x]}}},textureUV:{type:y.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:({texXmax:r,texXmin:t,texYmax:e,texYmin:s})=>[[t,s],[r,s],[t,e],[r,e]]}},color:{type:y.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:r})=>R(r)},outlineColor:{type:y.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:r})=>R(r)},sizing:{type:y.UNSIGNED_BYTE,count:4,pack:({rawWidth:r,rawHeight:t,outlineSize:e,referenceSize:s})=>{let i=Math.max(r,t);return[vs(i,128),vs(e,128),vs(s,128),0]}},placementAngle:{type:y.UNSIGNED_BYTE,count:1,packTessellation:({placementAngle:r})=>$a(r)},sizeRatio:{type:y.UNSIGNED_SHORT,count:1,packPrecisionFactor:64,pack:({sizeRatio:r})=>r}}},Es=class extends Q{constructor(){super(...arguments),this.vertexSpec=Ya}getBoundsInfo(){return this.evaluatedMeshParams.boundsInfo}_write(t,e,s){let i=this.evaluatedMeshParams.sprite?.textureBinding,n=e.getDisplayId();t.recordStart(this.instanceId,this.attributeLayout,i);let o=this.evaluatedMeshParams.minPixelBuffer,a=Math.max(this.evaluatedMeshParams.computedWidth,o),c=Math.max(this.evaluatedMeshParams.computedHeight,o),l=this.evaluatedMeshParams.offsetX,u=-this.evaluatedMeshParams.offsetY;if(this.evaluatedMeshParams.placement!=null)this._writePlacedMarkers(t,e,s,a,c);else if(s&&s.nextPath()){s.nextPoint();let h=s.x,m=s.y;t.recordBounds(h+l,m+u,a,c),this._writeQuad(t,n,h,m)}else if(e.geometryType==="esriGeometryPolygon"){let h=e.readCentroidForDisplay();if(!h)return;let[m,f]=h.coords;t.recordBounds(m+l,f+u,a,c),this._writeQuad(t,n,m,f)}else if(e.geometryType==="esriGeometryPoint"){let h=e.readXForDisplay(),m=e.readYForDisplay();t.recordBounds(h+l,m+u,a,c),this._writeQuad(t,n,h,m)}else e.readGeometryForDisplay()?.forEachVertex((m,f)=>{t.recordBounds(m+l,f+u,a,c),Math.abs(m)>1024||Math.abs(f)>1024||this._writeQuad(t,n,m,f)});t.recordEnd()}_writePlacedMarkers(t,e,s,i,n){let o=s??H.fromFeatureSetReaderCIM(e)?.clone();if(!o)return;let a=-1,c=Ae.getPlacement(o,a,this.evaluatedMeshParams.placement,T(1),t.id,ze());if(!c)return;let l=e.getDisplayId(),u=c.next(),h=this.evaluatedMeshParams.offsetX,m=-this.evaluatedMeshParams.offsetY;for(;u!=null;){let f=u.tx,x=-u.ty;if(Math.abs(f)>1024||Math.abs(x)>1024){u=c.next();continue}let v=-u.getAngle();t.recordBounds(f+h,x+m,i,n),this._writeQuad(t,l,f,x,v),u=c.next()}}_writeQuad(t,e,s,i,n){let o=t.vertexCount(),a=n==null?null:{placementAngle:n};this._writeVertex(t,e,s,i,a),t.indexWrite(o+0),t.indexWrite(o+1),t.indexWrite(o+2),t.indexWrite(o+1),t.indexWrite(o+3),t.indexWrite(o+2)}};var qa={createComputedParams:r=>r,attributes:{pos:{type:y.SHORT,count:2,packPrecisionFactor:10,pack:"position"},id:{type:y.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:y.UNSIGNED_BYTE,count:1,pack:r=>0},offset:{type:y.SHORT,count:2,packPrecisionFactor:16,packAlternating:{count:4,pack:({size:r})=>{let t=T(r),e=-t/2,s=-t/2;return[[e,s],[e+t,s],[e,s+t],[e+t,s+t]]}}},texCoords:{type:y.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:()=>[[0,1],[1,1],[0,0],[1,0]]}},size:{type:y.UNSIGNED_BYTE,count:2,pack:({size:r})=>[r,r]},referenceSize:{type:y.UNSIGNED_BYTE,count:1,pack:({size:r})=>T(r)},zoomRange:{type:y.UNSIGNED_BYTE,count:2,pack:({scaleInfo:r},{tileInfo:t})=>yt(r,t)}}},Ds=class extends Q{constructor(){super(...arguments),this.vertexSpec=qa}_write(t,e){let s=e.getDisplayId(),i=this.evaluatedMeshParams.minPixelBuffer,n=Math.max(T(this.evaluatedMeshParams.size),i),o,a;if(e.geometryType==="esriGeometryPoint")o=e.readXForDisplay(),a=e.readYForDisplay();else{let l=e.readCentroidForDisplay();if(!l)return;o=l?.coords[0],a=l?.coords[1]}t.recordStart(this.instanceId,this.attributeLayout),t.recordBounds(o,a,n,n);let c=t.vertexCount();this._writeVertex(t,s,o,a),t.indexWrite(c+0),t.indexWrite(c+1),t.indexWrite(c+2),t.indexWrite(c+1),t.indexWrite(c+3),t.indexWrite(c+2),t.recordEnd()}};var Zf=Za({FillMeshWriter:Jt,DotDensityMeshWriter:bs,ComplexFillMeshWriter:ws,PatternFillMeshWriter:Re,OutlineFillMeshWriter:ee,PatternOutlineFillMeshWriter:Ss,ComplexOutlineFillMeshWriter:_s,MarkerMeshWriter:Es,PieChartMeshWriter:Ds,TextMeshWriter:Ue,LineMeshWriter:te,TexturedLineMeshWriter:Vs,HeatmapMeshWriter:Is,LabelMeshWriter:ks});function Za(r){let t={};for(let e in r){let s={name:e,constructor:r[e]};t[e]=s}return t}export{Rr as a,Sn as b,mc as c,In as d,xc as e,vc as f,wc as g,Fn as h,fe as i,kn as j,Vn as k,Cn as l,En as m,K as n,Tt as o,d as p,I as q,N as r,F as s,ut as t,Ut as u,et as v,Cc as w,xe as x,D as y,Ec as z,Dc as A,ve as B,Wn as C,L as D,Gn as E,we as F,ui as G,pi as H,rr as I,Un as J,cs as K,ls as L,qt as M,sr as N,st as O,ir as P,Nc as Q,bt as R,pt as S,cr as T,M as U,C as V,b as W,$ as X,di as Y,_e as Z,us as _,Xt as $,ur as aa,V as ba,ps as ca,it as da,nt as ea,Pl as fa,Kn as ga,Fl as ha,Z as ia,ot as ja,Y as ka,Pt as la,j as ma,Go as na,Ao as oa,$o as pa,ds as qa,au as ra,Ft as sa,kt as ta,jn as ua,Pe as va,Fe as wa,vu as xa,Vt as ya,mt as za,ke as Aa,oe as Ba,jt as Ca,Qt as Da,ae as Ea,Lt as Fa,Yo as Ga,bi as Ha,vt as Ia,Ve as Ja,Ce as Ka,Ee as La,De as Ma,gr as Na,kh as Oa,He as Pa,Zf as Qa,Lr as Ra};
