import{g as _}from"./chunk-GJBALZEB.js";import{v as o}from"./chunk-ZAQLF7TN.js";import{c as a}from"./chunk-MLSR6YE6.js";import{r as h}from"./chunk-HQMV3KQV.js";import{H as f}from"./chunk-CRMMDK2Z.js";var n=()=>h.getLogger("esri.views.webgl.VertexArrayObject"),g=class{constructor(e,t,i,r,s=null){this._context=e,this._locations=t,this._layout=i,this._buffers=r,this._indexBuffer=s,this._glName=null,this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Object.keys(this._buffers).reduce((e,t)=>e+this._buffers[t].usedMemory,this._indexBuffer!=null?this._indexBuffer.usedMemory:0)}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return this.byteSize+(Object.keys(this._buffers).length+(this._indexBuffer?1:0))*f}dispose(){if(this._context){this._context.getBoundVAO()===this&&this._context.bindVAO(null);for(let e in this._buffers)this._buffers[e]?.dispose(),delete this._buffers[e];this._indexBuffer=a(this._indexBuffer),this.disposeVAOOnly()}else(this._glName||Object.getOwnPropertyNames(this._buffers).length>0)&&n().warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&(this._context.gl.deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(o.VertexArrayObject,this)),this._context=null}initialize(){if(this._initialized)return;let{gl:e}=this._context,t=e.createVertexArray();e.bindVertexArray(t),this._bindLayout(),e.bindVertexArray(null),this._glName=t,this._context.instanceCounter.increment(o.VertexArrayObject,this),this._initialized=!0}bind(){this.initialize(),this._context.gl.bindVertexArray(this.glName)}_bindLayout(){let{_buffers:e,_layout:t,_indexBuffer:i}=this;e||n().error("Vertex buffer dictionary is empty!");let r=this._context.gl;for(let s in e){let u=e[s];u||n().error("Vertex buffer is uninitialized!");let l=t[s];l||n().error("Vertex element descriptor is empty!"),_(this._context,this._locations,u,l)}i!=null&&r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,i.glName)}unbind(){this.initialize(),this._context.gl.bindVertexArray(null)}};export{g as a};
