import{a as K,b as Oe,c as Pe,d as J}from"./chunk-7KEDAKSE.js";import{a as H,o as D,p as A}from"./chunk-F7PIPM6E.js";import{b as k,j as V}from"./chunk-UI76XBLJ.js";import{b as P}from"./chunk-UE2YGKE7.js";import{a as ye}from"./chunk-VSVNPPHQ.js";import{U as xe,_ as j}from"./chunk-CTGIUUCS.js";import{F as a,I as S,Q as E}from"./chunk-VWEBO6QK.js";import{S as y}from"./chunk-KAAR5ZJN.js";import{a as n}from"./chunk-W3WDPWBE.js";import{p as B,r as d}from"./chunk-X3IDZTNG.js";import{a as Se}from"./chunk-IQJU4QT3.js";import{a as Y,h as u}from"./chunk-EAH6BNBL.js";var Z=class extends S{constructor(e){super(e),this.resultRows=[]}};n([a()],Z.prototype,"resultRows",void 0),Z=n([y("esri.rest.knowledgeGraph.GraphQueryResult")],Z);var me=Z;var $=class extends S{constructor(e){super(e),this.resultRowsStream=new ReadableStream}};n([a()],$.prototype,"resultRowsStream",void 0),$=n([y("esri.rest.knowledgeGraph.GraphQueryResult")],$);var fe=$;var x=class extends E{constructor(e){super(e),this.name=null,this.unique=null,this.ascending=null,this.description=null,this.fieldNames=null}};n([a({type:String,json:{write:!0}})],x.prototype,"name",void 0),n([a({type:Boolean,json:{write:!0}})],x.prototype,"unique",void 0),n([a({type:Boolean,json:{write:!0}})],x.prototype,"ascending",void 0),n([a({type:String,json:{write:!0}})],x.prototype,"description",void 0),n([a({type:[String],json:{write:!0}})],x.prototype,"fieldNames",void 0),x=n([y("esri.rest.knowledgeGraph.FieldIndex")],x);var X=x;var w=class extends E{constructor(e){super(e),this.name=null,this.alias=null,this.fieldType=null,this.geometryType=null,this.hasM=null,this.hasZ=null,this.nullable=null,this.editable=null,this.required=null,this.defaultVisibility=null,this.systemMaintained=null,this.role=null,this.defaultValue=null}};n([a({type:String,json:{write:!0}})],w.prototype,"name",void 0),n([a({type:String,json:{write:!0}})],w.prototype,"alias",void 0),n([a({type:String,json:{write:!0}})],w.prototype,"fieldType",void 0),n([a({type:String,json:{write:!0}})],w.prototype,"geometryType",void 0),n([a({type:Boolean,json:{write:!0}})],w.prototype,"hasM",void 0),n([a({type:Boolean,json:{write:!0}})],w.prototype,"hasZ",void 0),n([a({type:Boolean,json:{write:!0}})],w.prototype,"nullable",void 0),n([a({type:Boolean,json:{write:!0}})],w.prototype,"editable",void 0),n([a({type:Boolean,json:{write:!0}})],w.prototype,"required",void 0),n([a({type:Boolean,json:{write:!0}})],w.prototype,"defaultVisibility",void 0),n([a({type:Boolean,json:{write:!0}})],w.prototype,"systemMaintained",void 0),n([a()],w.prototype,"role",void 0),n([a({type:Object,json:{type:String,write:{writer:(e,r)=>{r.defaultValue=e!=null?e.toString():null}}}})],w.prototype,"defaultValue",void 0),w=n([y("esri.rest.knowledgeGraph.GraphProperty")],w);var ee=w;var b=class extends E{constructor(e){super(e),this.name=null,this.alias=null,this.role=null,this.strict=null,this.properties=null,this.fieldIndexes=null}};n([a({type:String,json:{write:!0}})],b.prototype,"name",void 0),n([a({type:String,json:{write:!0}})],b.prototype,"alias",void 0),n([a({type:String,json:{write:!0}})],b.prototype,"role",void 0),n([a({type:Boolean,json:{write:!0}})],b.prototype,"strict",void 0),n([a({type:[ee],json:{write:!0}})],b.prototype,"properties",void 0),n([a({type:[X],json:{write:!0}})],b.prototype,"fieldIndexes",void 0),b=n([y("esri.rest.knowledgeGraph.GraphObjectType")],b);var z=b;var he=class extends z{constructor(e){super(e)}};he=n([y("esri.rest.knowledgeGraph.EntityType")],he);var te=he;var re=class extends z{constructor(e){super(e),this.endPoints=[]}};n([a()],re.prototype,"endPoints",void 0),re=n([y("esri.rest.knowledgeGraph.RelationshipType")],re);var oe=re;var T=class extends E{constructor(e){super(e),this.timestamp=null,this.spatialReference=null,this.strict=null,this.objectIdField=null,this.globalIdField=null,this.arcgisManaged=null,this.identifierInfo=null,this.searchIndexes=null,this.entityTypes=null,this.relationshipTypes=null}};n([a({type:Date,json:{type:Number,write:{writer:(e,r)=>{r.timestamp=e?.getTime()}}}})],T.prototype,"timestamp",void 0),n([a({type:P,json:{write:!0}})],T.prototype,"spatialReference",void 0),n([a({type:Boolean,json:{write:!0}})],T.prototype,"strict",void 0),n([a({type:String,json:{write:!0}})],T.prototype,"objectIdField",void 0),n([a({type:String,json:{write:!0}})],T.prototype,"globalIdField",void 0),n([a()],T.prototype,"arcgisManaged",void 0),n([a()],T.prototype,"identifierInfo",void 0),n([a()],T.prototype,"searchIndexes",void 0),n([a({type:[te],json:{write:!0}})],T.prototype,"entityTypes",void 0),n([a({type:[oe],json:{write:!0}})],T.prototype,"relationshipTypes",void 0),T=n([y("esri.rest.knowledgeGraph.DataModel")],T);var ie=T;var h=class extends E{constructor(e){super(e),this.capabilities=[],this.supportsSearch=!1,this.supportedQueryFormats=[],this.allowGeometryUpdates=!1,this.searchMaxRecordCount=null,this.serviceCapabilities=null,this.maxRecordCount=null,this.description="",this.copyrightText="",this.units="",this.spatialReference=null,this.currentVersion=null,this.dateFieldsTimeReference=null,this.serviceItemId="",this.supportsDocuments=!1,this.dataEditingNotSupported=!1,this.schemaEditingNotSupported=!1}};n([a({type:[String],json:{write:!0}})],h.prototype,"capabilities",void 0),n([a({type:Boolean,json:{write:!0}})],h.prototype,"supportsSearch",void 0),n([a({type:[String],json:{write:!0}})],h.prototype,"supportedQueryFormats",void 0),n([a({type:Boolean,json:{write:!0}})],h.prototype,"allowGeometryUpdates",void 0),n([a({type:Number,json:{write:!0}})],h.prototype,"searchMaxRecordCount",void 0),n([a({type:Object,json:{write:!0}})],h.prototype,"serviceCapabilities",void 0),n([a({type:Number,json:{write:!0}})],h.prototype,"maxRecordCount",void 0),n([a({type:String,json:{write:!0}})],h.prototype,"description",void 0),n([a({type:String,json:{write:!0}})],h.prototype,"copyrightText",void 0),n([a({type:String,json:{write:!0}})],h.prototype,"units",void 0),n([a({type:Object,json:{write:!0}})],h.prototype,"spatialReference",void 0),n([a({type:Number,json:{write:!0}})],h.prototype,"currentVersion",void 0),n([a({type:Object,json:{write:!0}})],h.prototype,"dateFieldsTimeReference",void 0),n([a({type:String,json:{write:!0}})],h.prototype,"serviceItemId",void 0),n([a({type:Boolean,json:{write:!0}})],h.prototype,"supportsDocuments",void 0),n([a({type:Boolean,json:{write:!0}})],h.prototype,"dataEditingNotSupported",void 0),n([a({type:Boolean,json:{write:!0}})],h.prototype,"schemaEditingNotSupported",void 0),h=n([y("esri.rest.knowledgeGraph.ServiceDefinition")],h);var ne=h;var F=class extends E{constructor(e){super(e),this.dataModel=null,this.serviceDefinition=null}};n([a({type:String,json:{write:!0}})],F.prototype,"url",void 0),n([a({type:ie,json:{write:!0}})],F.prototype,"dataModel",void 0),n([a({type:ne,json:{write:!0}})],F.prototype,"serviceDefinition",void 0),F=n([y("esri.rest.knowledgeGraph.KnowledgeGraph")],F);var Me=F;var je="esri/rest/knowledgeGraph/wasmInterface/",ge,$e=null;function I(){return u(this,null,function*(){let e=$e??ge;if(e)return e;let r=Se("wasm-simd");return ge=Xe(r),ge})}function Xe(e){return u(this,null,function*(){if(e){let{default:t}=yield import("./chunk-SGOVF6FD.js").then(o=>o.a);return t({locateFile:o=>ye(je+o)})}let{default:r}=yield import("./chunk-WJFFJO4D.js").then(t=>t.a);return r({locateFile:t=>ye(je+t)})})}function we(e,r){let t=new r.ArrayValue;return t.deleteLater(),e.forEach(o=>{t.add_value(Te(o,r))}),t}function _e(e,r){let t=new r.ObjectValue;t.deleteLater();for(let[o,i]of Object.entries(e))t.set_key_value(o,Te(i,r));return t}function C(e,r){if(e instanceof H)return tt(e,r);if(e instanceof V)return rt(e,r);if(e instanceof A||e instanceof D)return et(e,r);throw new d("knowledge-graph:unsupported-geometry","Only Point, Multipoint, Polyline, and Polygon geometry are supported by ArcGIS Knowledge",{geometry:e})}function ke(e,r){r.input_quantization_parameters={xy_resolution:e.xyResolution,x_false_origin:e.xFalseOrigin,y_false_origin:e.yFalseOrigin,z_resolution:e.zResolution,z_false_origin:e.zFalseOrigin,m_resolution:e.mResolution,m_false_origin:e.mFalseOrigin}}function Fe(e,r,t){if(!e.extent)throw new d("knowledge-graph:illegal-output-quantization","The Output quantization provided to the encoder had an illegal value as part of its extent",e.extent);if(!e.quantizeMode)throw new d("knowledge-graph:illegal-output-quantization","The Output quantization contained an illegal mode setting",e.quantizeMode);if(!e.tolerance)throw new d("knowledge-graph:illegal-output-quantization","The Output quantization contained an illegal tolerance setting",e.quantizeMode);r.output_quantization_parameters={extent:{xmax:e.extent.xmax,ymax:e.extent.ymax,xmin:e.extent.xmin,ymin:e.extent.ymin},quantize_mode:t.esriQuantizeMode[e.quantizeMode],tolerance:e.tolerance}}function Te(e,r){if(e==null)return"";if(typeof e!="object"||e instanceof Date)return e;if(e instanceof k)return C(e,r);if(Array.isArray(e)){let t=new r.ArrayValue;return t.deleteLater(),e.forEach(o=>{t.add_value(Te(o,r))}),t}return _e(e,r)}function et(e,r){let t=new r.GeometryValue;t.deleteLater(),t.has_z=e.hasZ,t.has_m=e.hasM;let o=[],i=[],s=[];e instanceof A?(t.geometry_type=r.esriGeometryType.esriGeometryPolyline,s=e.paths):e instanceof D&&(t.geometry_type=r.esriGeometryType.esriGeometryPolygon,s=e.rings);let l=0,p=0;return s.forEach(c=>{let m=0;c.forEach(g=>{m++,g.forEach(G=>{o[p]=G,p++})}),i[l]=m,l++}),t.coords=new Float64Array(o),t.lengths=new Uint32Array(i),t}function tt(e,r){let t=new r.GeometryValue;t.deleteLater(),t.geometry_type=t.geometry_type=r.esriGeometryType.esriGeometryMultipoint,t.has_z=e.hasZ,t.has_m=e.hasM;let o=[],i=[];i[0]=e.points.length;let s=0;return e.points.forEach(l=>{l.forEach(p=>{o[s]=p,s++})}),t.coords=new Float64Array(o),t.lengths=new Uint32Array(i),t}function rt(e,r){let t=new r.GeometryValue;t.deleteLater(),t.geometry_type=r.esriGeometryType.esriGeometryPoint,t.has_z=e.hasZ,t.has_m=e.hasM;let o=[],i=[];i[0]=1,o[0]=e.x,o[1]=e.y;let s=2;return e.hasZ&&(o[s]=e.z,s++),e.hasM&&(o[s]=e.m,s++),t.coords=new Float64Array(o),t.lengths=new Uint32Array(i),t}function L(e,r){if(!e.typeName)throw new d("knowledge-graph:no-type-name","You must indicate the entity/relationship named object type to apply edits");if(e instanceof K){let t=new r.EntityValue;t.deleteLater(),t.type_name=e.typeName;for(let[o,i]of Object.entries(e.properties))t.set_key_value(o,Ne(i,r));return e.id&&t.set_id(e.id),t}if(e instanceof J){let t=new r.RelationshipValue;t.deleteLater(),t.type_name=e.typeName;for(let[o,i]of Object.entries(e.properties))t.set_key_value(o,Ne(i,r));return e.id&&t.set_id(e.id),e.originId&&e.destinationId&&t.set_related_entity_ids(e.originId,e.destinationId),t}throw new d("knowledge-graph:applyEdits-encoding-failure","Could not determine the type of a named graph object passed to the encoder")}function De(e){return{xy_resolution:e.xyResolution,x_false_origin:e.xFalseOrigin,y_false_origin:e.yFalseOrigin,z_resolution:e.zResolution,z_false_origin:e.zFalseOrigin,m_resolution:e.mResolution,m_false_origin:e.mFalseOrigin}}function Ne(e,r){return e==null?"":typeof e!="object"||e instanceof Date?e:e instanceof k?C(e,r):""}var M=class extends S{constructor(e){super(e),this.name=null,this.supportedCategory=null,this.analyzers=[],this.searchProperties=new Map}};n([a()],M.prototype,"name",void 0),n([a()],M.prototype,"supportedCategory",void 0),n([a()],M.prototype,"analyzers",void 0),n([a()],M.prototype,"searchProperties",void 0),M=n([y("esri.rest.knowledgeGraph.SearchIndex")],M);var Ae=M;var U,q,Q,ae,se,pe,le;(function(e){e[e.Regular=0]="Regular",e[e.Provenance=1]="Provenance",e[e.Document=2]="Document"})(U||(U={})),function(e){e[e.esriFieldTypeSmallInteger=0]="esriFieldTypeSmallInteger",e[e.esriFieldTypeInteger=1]="esriFieldTypeInteger",e[e.esriFieldTypeSingle=2]="esriFieldTypeSingle",e[e.esriFieldTypeDouble=3]="esriFieldTypeDouble",e[e.esriFieldTypeString=4]="esriFieldTypeString",e[e.esriFieldTypeDate=5]="esriFieldTypeDate",e[e.esriFieldTypeOID=6]="esriFieldTypeOID",e[e.esriFieldTypeGeometry=7]="esriFieldTypeGeometry",e[e.esriFieldTypeBlob=8]="esriFieldTypeBlob",e[e.esriFieldTypeRaster=9]="esriFieldTypeRaster",e[e.esriFieldTypeGUID=10]="esriFieldTypeGUID",e[e.esriFieldTypeGlobalID=11]="esriFieldTypeGlobalID",e[e.esriFieldTypeXML=12]="esriFieldTypeXML",e[e.esriFieldTypeBigInteger=13]="esriFieldTypeBigInteger",e[e.esriFieldTypeDateOnly=14]="esriFieldTypeDateOnly",e[e.esriFieldTypeTimeOnly=15]="esriFieldTypeTimeOnly",e[e.esriFieldTypeTimestampOffset=16]="esriFieldTypeTimestampOffset"}(q||(q={})),function(e){e[e.esriGeometryNull=0]="esriGeometryNull",e[e.esriGeometryPoint=1]="esriGeometryPoint",e[e.esriGeometryMultipoint=2]="esriGeometryMultipoint",e[e.esriGeometryPolyline=3]="esriGeometryPolyline",e[e.esriGeometryPolygon=4]="esriGeometryPolygon",e[e.esriGeometryEnvelope=5]="esriGeometryEnvelope",e[e.esriGeometryAny=6]="esriGeometryAny",e[e.esriGeometryMultiPatch=7]="esriGeometryMultiPatch"}(Q||(Q={})),function(e){e[e.esriMethodHintUNSPECIFIED=0]="esriMethodHintUNSPECIFIED",e[e.esriUUIDESRI=1]="esriUUIDESRI",e[e.esriUUIDRFC4122=2]="esriUUIDRFC4122"}(ae||(ae={})),function(e){e[e.esriTypeUNSPECIFIED=0]="esriTypeUNSPECIFIED",e[e.esriTypeEntity=1]="esriTypeEntity",e[e.esriTypeRelationship=2]="esriTypeRelationship",e[e.esriTypeBoth=4]="esriTypeBoth"}(se||(se={})),function(e){e[e.esriGraphPropertyUNSPECIFIED=0]="esriGraphPropertyUNSPECIFIED",e[e.esriGraphPropertyRegular=1]="esriGraphPropertyRegular",e[e.esriGraphPropertyDocumentName=2]="esriGraphPropertyDocumentName",e[e.esriGraphPropertyDocumentTitle=3]="esriGraphPropertyDocumentTitle",e[e.esriGraphPropertyDocumentUrl=4]="esriGraphPropertyDocumentUrl",e[e.esriGraphPropertyDocumentText=5]="esriGraphPropertyDocumentText",e[e.esriGraphPropertyDocumentKeywords=6]="esriGraphPropertyDocumentKeywords",e[e.esriGraphPropertyDocumentContentType=7]="esriGraphPropertyDocumentContentType",e[e.esriGraphPropertyDocumentMetadata=8]="esriGraphPropertyDocumentMetadata",e[e.esriGraphPropertyDocumentFileExtension=9]="esriGraphPropertyDocumentFileExtension"}(pe||(pe={})),function(e){e[e.esriIdentifierInfoTypeUNSPECIFIED=0]="esriIdentifierInfoTypeUNSPECIFIED",e[e.esriIdentifierInfoTypeDatabaseNative=1]="esriIdentifierInfoTypeDatabaseNative",e[e.esriIdentifierInfoTypeUniformProperty=2]="esriIdentifierInfoTypeUniformProperty"}(le||(le={}));function ze(e){return e.deleteLater(),new ie({timestamp:e.timestamp,spatialReference:new P(e.spatial_reference),strict:e.strict,objectIdField:e.objectid_property,globalIdField:e.globalid_property,arcgisManaged:e.arcgis_managed,identifierInfo:{identifierMappingInfo:{identifierInfoType:le[e.identifier_info?.identifier_mapping_info?.identifier_info_type?.value],databaseNativeIdentifier:e.identifier_info?.identifier_mapping_info?.database_native_identifier,uniformPropertyIdentifier:{identifierPropertyName:e.identifier_info?.identifier_mapping_info?.uniform_property_identifier?.identifier_property_name}},identifierGenerationInfo:{uuidMethodHint:ae[e.identifier_info?.identifier_generation_info?.uuid_method_hint?.value]}},searchIndexes:ct(e.search_indexes),entityTypes:st(e.entity_types),relationshipTypes:ut(e.relationship_types)})}function ot(e){return e.deleteLater(),new te(Ce(e))}function it(e){return e.deleteLater(),new X({name:e.name,unique:e.unique,ascending:e.ascending,description:e.description,fieldNames:pt(e.fields)})}function Ce(e){return{name:e.name,alias:e.alias,role:U[e.role.value]?U[e.role.value]:null,strict:e.strict,properties:lt(e.properties),fieldIndexes:dt(e.field_indexes)}}function nt(e){return e.deleteLater(),new ee({alias:e.alias,name:e.name,fieldType:q[e.field_type.value]?q[e.field_type.value]:null,geometryType:Q[e.geometry_type.value]?Q[e.geometry_type.value]:null,hasM:e.has_m,hasZ:e.has_z,nullable:e.nullable,editable:e.editable,required:e.required,defaultVisibility:e.default_visibility,systemMaintained:e.system_maintained,role:pe[e.role.value],defaultValue:e.default_value})}function at(e){e.deleteLater();let r=Ce(e),t=[];for(let o=0;o<e.end_points.size();o++){let i=e.end_points.get(o);t.push({originEntityType:i.origin_entity_type,destinationEntityType:i.dest_entity_type})}return e.end_points.delete(),new oe(Object.assign({endPoints:t},r))}function st(e){let r=[];for(let t=0;t<e.size();t++)r.push(ot(e.get(t)));return e.delete(),r}function pt(e){let r=[];for(let t=0;t<e.size();t++)r.push(e.get(t));return e.delete(),r}function lt(e){let r=[];for(let t=0;t<e.size();t++)r.push(nt(e.get(t)));return e.delete(),r}function dt(e){let r=[];for(let t=0;t<e.size();t++)r.push(it(e.get(t)));return e.delete(),r}function ut(e){let r=[];for(let t=0;t<e.size();t++)r.push(at(e.get(t)));return e.delete(),r}function ct(e){let r=[];for(let t=0;t<e.size();t++){let o=new Ae,i=e.get(0);o.name=i.name,o.supportedCategory=se[i.supported_category.value];let s=i.analyzers.size();for(let l=0;l<s;l++)o.analyzers.push({name:i.analyzers.get(l).name});i.analyzers.delete();for(let l=0;l<i.search_properties.keys().size();l++){let p=i.search_properties.keys().get(l),c=i.search_properties.get(p),m=[];for(let g=0;g<c.property_names.size();g++)m.push(c.property_names.get(g));o.searchProperties.set(p,{propertyNames:m})}r.push(o)}return e.delete(),r}var _;(function(e){e[e.ESRI_GEOMETRY_NULL=0]="ESRI_GEOMETRY_NULL",e[e.ESRI_GEOMETRY_POINT=1]="ESRI_GEOMETRY_POINT",e[e.ESRI_GEOMETRY_MULTIPOINT=2]="ESRI_GEOMETRY_MULTIPOINT",e[e.ESRI_GEOMETRY_POLYLINE=3]="ESRI_GEOMETRY_POLYLINE",e[e.ESRI_GEOMETRY_POLYGON=4]="ESRI_GEOMETRY_POLYGON",e[e.ESRI_GEOMETRY_ENVELOPE=5]="ESRI_GEOMETRY_ENVELOPE",e[e.ESRI_GEOMETRY_ANY=6]="ESRI_GEOMETRY_ANY",e[e.ESRI_GEOMETRY_MULTI_PATCH=7]="ESRI_GEOMETRY_MULTI_PATCH"})(_||(_={}));var O,Le;(function(e){e[e.OBJECT=0]="OBJECT",e[e.ENTITY=1]="ENTITY",e[e.RELATIONSHIP=2]="RELATIONSHIP",e[e.PATH=3]="PATH",e[e.ARRAY=4]="ARRAY"})(O||(O={})),function(e){e[e.view=0]="view",e[e.edit=1]="edit"}(Le||(Le={}));function Ue(e,r){let t={spatialReference:r},o=Ee(e,t),i=e.lengths,s=e.coords,l=i[0];t.points=[];let p=0;for(let c=0;c<l;c++){let m=[];for(let g=0;g<o;g++)m[g]=s[p],p++;t.points.push(m)}return new H(t)}function qe(e,r){let t={spatialReference:r},o=2;Ee(e,t);let i=e.coords;return t.x=i[0],t.y=i[1],e.has_z&&(t.z=i[o],o++),e.has_m&&(t.m=i[o]),new V(t)}function Qe(e,r){return new A(Ye(e,r))}function We(e,r){return new D(Ye(e,r))}function Ye(e,r){let t={spatialReference:r},o=Ee(e,t),i=e.lengths,s=e.coords,l="";if(e.geometry_type.value===_.ESRI_GEOMETRY_POLYGON)l="rings";else{if(e.geometry_type.value!==_.ESRI_GEOMETRY_POLYLINE)throw new d("KnowledgeGraph:illegal-geometry-type","Illegal Geometry type for multipath conversion");l="paths"}t[l]=[];let p=0;return i.forEach(c=>{let m=[];for(let g=0;g<c;g++){let G=[];for(let f=0;f<o;f++)G[f]=s[p],p++;m.push(G)}t[l].push(m)}),t}function Ee(e,r){let t=2;return e.has_z?(r.hasZ=e.has_z,t++):r.hasZ=!1,e.has_m?(r.hasM=e.has_m,t++):r.hasM=!1,t}var de=()=>B.getLogger("esri.rest.knowledgeGraph.WasmToQueryResponseObjConstructors"),yt={decodedWasmObjToQueryResponseObj:(e,r,t)=>{if(e==null)return null;if(typeof e!="object"||"getDate"in e)return e;if("geometry_type"in e)switch(e.geometry_type.value){case null:return null;case _.ESRI_GEOMETRY_POINT:return qe(e,t);case _.ESRI_GEOMETRY_MULTIPOINT:return Ue(e,t);case _.ESRI_GEOMETRY_POLYLINE:return Qe(e,t);case _.ESRI_GEOMETRY_POLYGON:return We(e,t);case _.ESRI_GEOMETRY_ENVELOPE:case _.ESRI_GEOMETRY_MULTI_PATCH:return de().warnOnce("Envelope and Multipatch are not supported on knowledge entities, but one of those geometry types was detected. Result interpreted as null"),null;case _.ESRI_GEOMETRY_NULL:case _.ESRI_GEOMETRY_ANY:default:return de().warnOnce("Unknown or blank geometry type returned - Result interpreted as null"),null}else{if(!("object_value_type"in e))return de().warnOnce("A decoded value came back of a type that is not supported. Result interpreted as null"),null;switch(e.object_value_type.value){case O.OBJECT:return ft(e,r,t);case O.ENTITY:return Be(e,r,t);case O.RELATIONSHIP:return Ve(e,r,t);case O.PATH:return ht(e,r,t);case O.ARRAY:return mt(e,r,t);default:return de().warnOnce("Unknown graph object type detected!  Result interpreted as null"),null}}}};function mt(e,r,t){let o=[],i=e.count();for(let s=0;s<i;s++){let l=e.get_value_at(s);o.push(ue(l,r,t))}return o}function ue(e,r,t){return yt.decodedWasmObjToQueryResponseObj(e,r,t)}function Be(e,r,t){let o=e.type_name,i=ve(e,r,t),s=e.get_id();return new K(Object.assign({typeName:o,id:s},i))}function ve(e,r,t){let o={},i=e.key_count();for(let s=0;s<i;s++)o[e.get_key_at(s)]=ue(e.get_value_at(s),r,t);return{properties:o}}function ft(e,r,t){return new Oe(ve(e,r,t))}function ht(e,r,t){let o=e.entity_count(),i=e.relationship_count(),s=[];for(let l=0;l<o;l++)s.push(Be(e.get_entity_at(l),r,t)),l<i&&s.push(Ve(e.get_relationship_at(l),r,t));return new Pe({path:s})}function Ve(e,r,t){let o=e.type_name,i=ve(e,r,t);return new J(Object.assign({typeName:o,id:e.get_id(),originId:e.get_origin_entity_id(),destinationId:e.get_destination_entity_id()},i))}var N=class extends S{constructor(e){super(e),this.hasError=null,this.error=null,this.editResults=[]}};n([a()],N.prototype,"hasError",void 0),n([a()],N.prototype,"error",void 0),n([a()],N.prototype,"editResults",void 0),N=n([y("esri.rest.knowledgeGraph.GraphApplyEdits")],N);var He=N;function Ke(e){let r=new He;r.hasError=e.has_error(),r.hasError&&(r.error={errorCode:e.error.error_code,errorMessage:e.error.error_message});let t=e.get_edit_results_count();for(let o=0;o<t;o++){let i=e.get_edit_results_at(o),s=e.get_edit_results_type_name_at(o),l=[],p=[],c=[],m=i.get_add_results_count(),g=i.get_update_results_count(),G=i.get_delete_results_count();for(let f=0;f<m;f++){let v=i.get_add_result_at(f);l.push({id:v.id,error:{errorCode:v.error.error_code,errorMessage:v.error.error_message}})}for(let f=0;f<g;f++){let v=i.get_update_result_at(f);p.push({id:v.id,error:{errorCode:v.error.error_code,errorMessage:v.error.error_message}})}for(let f=0;f<G;f++){let v=i.get_delete_result_at(f);c.push({id:v.id,error:{errorCode:v.error.error_code,errorMessage:v.error.error_message}})}r.editResults.push({typeName:s,adds:l,updates:p,deletes:c})}return r}var R={fetchKnowledgeGraph:e=>u(void 0,null,function*(){let r=new Me({url:e}),t=[];return t.push(ce(r)),t.push(gt(r)),yield Promise.all(t),r}),refreshDataModel:e=>u(void 0,null,function*(){e.dataModel=yield Ze(e)}),refreshServiceDefinition:e=>u(void 0,null,function*(){let r=(yield j(e.url,{query:{f:"json"}})).data;return r.capabilities=r?.capabilities?.split(","),r.supportedQueryFormats=r?.supportedQueryFormats?.split(","),e.serviceDefinition=new ne(r),e.serviceDefinition}),executeQueryStreaming:(e,r,t)=>u(void 0,null,function*(){let o=`${e.url}/graph/query`;yield be(e);let i=yield Ie(o,t);i.data.body=yield Tt(r,e);let s=yield Ge(i.data.url,i.data);if(e.dataModel)return new fe({resultRowsStream:yield Je(s,e.dataModel,r.outputSpatialReference??void 0)});throw new d("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")}),executeApplyEdits:(e,r,t)=>u(void 0,null,function*(){if(e.serviceDefinition?.dataEditingNotSupported)throw new d("knowledge-graph:data-editing-not-supported","The Knowledge Graph Service definition indicated that data editing is not supported");let o=`${e.url}/graph/applyEdits`;yield be(e);let i=yield Ie(o,t);return i.data.body=yield _t(r,e),vt(yield Ge(i.data.url,i.data))}),executeQuery:(e,r,t)=>u(void 0,null,function*(){let o=`${e.url}/graph/query`,i=yield j(o,{responseType:"array-buffer",query:Y({f:"pbf",openCypherQuery:r.openCypherQuery},t?.query),signal:t?.signal,timeout:t?.timeout}),s=i.getHeader?.("content-type"),l=i.data;if(s?.includes("application/x-protobuf")){let p=new(yield I()).GraphQueryDecoder;if(p.deleteLater(),e.dataModel)return new me({resultRows:Re(p,l,e.dataModel)});throw new d("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")}throw new d("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:s,data:i.data})}),executeSearch:(e,r,t)=>u(void 0,null,function*(){let o=r.typeCategoryFilter,i=`${e.url}/graph/search`,s=yield j(i,{responseType:"array-buffer",query:Y({f:"pbf",searchQuery:`"${r.searchQuery}"`,typeCategoryFilter:o},t?.query),signal:t?.signal,timeout:t?.timeout}),l=s.getHeader?.("content-type"),p=s.data;if(l?.includes("application/x-protobuf")){let c=new(yield I()).GraphQueryDecoder;if(c.deleteLater(),e.dataModel)return new me({resultRows:Re(c,p,e.dataModel)});throw new d("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")}throw new d("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:l,data:s.data})}),executeSearchStreaming:(e,r,t)=>u(void 0,null,function*(){let o=`${e.url}/graph/search`;yield be(e);let i=yield Ie(o,t);i.data.body=yield Et(r);let s=yield Ge(i.data.url,i.data);if(e.dataModel)return new fe({resultRowsStream:yield Je(s,e.dataModel)});throw new d("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")}),_fetchWrapper:(e,r)=>u(void 0,null,function*(){return fetch(e,r)})};function Bi(e,r,t){return u(this,null,function*(){return R.executeApplyEdits(e,r,t)})}function Vi(e,r,t){return u(this,null,function*(){return R.executeQuery(e,r,t)})}function Hi(e,r,t){return u(this,null,function*(){return R.executeQueryStreaming(e,r,t)})}function Ki(e,r,t){return u(this,null,function*(){return R.executeSearch(e,r,t)})}function Ji(e,r,t){return u(this,null,function*(){return R.executeSearchStreaming(e,r,t)})}function Zi(e){return u(this,null,function*(){return R.fetchKnowledgeGraph(e)})}function ce(e){return u(this,null,function*(){return R.refreshDataModel(e)})}function gt(e){return u(this,null,function*(){return R.refreshServiceDefinition(e)})}function Ge(e,r){return u(this,null,function*(){return R._fetchWrapper(e,r)})}function be(e){return u(this,null,function*(){xe?.findCredential(e.url)||(e.dataModel?yield Ze(e):yield ce(e))})}function W(e,r,t){if(e.error_code!==0)throw new d(r,t,{errorCode:e.error_code,errorMessage:e.error_message})}function wt(e,r,t,o){r==null?t.set_param_key_value(e,""):typeof r!="object"||r instanceof Date?t.set_param_key_value(e,r):r instanceof k?t.set_param_key_value(e,C(r,o)):r instanceof Array?t.set_param_key_value(e,we(r,o)):t.set_param_key_value(e,_e(r,o))}function _t(e,r){return u(this,null,function*(){if(r.dataModel||(yield ce(r)),!r.dataModel)throw new d("knowledge-graph:data-model-undefined","Encoding could not proceed because a data model was not provided and it could not be determined from the service");let t=yield I(),o=!!e.options?.cascadeDelete,i=new t.GraphApplyEditsEncoder(t.SpatialReferenceUtil.WGS84(),e.options?.inputQuantizationParameters?De(e.options?.inputQuantizationParameters):t.InputQuantizationUtil.WGS84_lossless());i.deleteLater(),i.cascade_delete=o;try{let l;e.entityAdds?.forEach(p=>{l=i.add_entity(L(p,t)),W(l,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - an entity failed to be added to the encoder")}),e.relationshipAdds?.forEach(p=>{if(!p.originId||!p.destinationId)throw new d("knowledge-graph:relationship-origin-destination-missing","When adding a new relationship, you must provide both an origin and destination id on the appropriate class property");l=i.add_relationship(L(p,t)),W(l,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - a relationship failed to be added to the encoder")}),e.entityUpdates?.forEach(p=>{if(!p.id)throw new d("knowledge-graph:entity-id-missing","When updating an entity or relationship, you must specify the id on the class level property");l=i.update_entity(L(p,t)),W(l,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - an entity failed to be added to the encoder")}),e.relationshipUpdates?.forEach(p=>{if(!p.id)throw new d("knowledge-graph:relationship-id-missing","When updating an entity or relationship, you must specify the id on the class level property");l=i.update_relationship(L(p,t)),W(l,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - a relationship failed to be added to the encoder")}),e.entityDeletes?.forEach(p=>{if(!p.typeName)throw new d("knowledge-graph:no-type-name","You must indicate the entity/relationship named object type to apply edits - delete");let c=i.make_delete_helper(p.typeName,!0);c.deleteLater(),p.ids?.forEach(m=>{c.delete_by_id(m)})}),e.relationshipDeletes?.forEach(p=>{if(!p.typeName)throw new d("knowledge-graph:no-type-name","You must indicate the entity/relationship named object type to apply edits - delete");let c=i.make_delete_helper(p.typeName,!1);p.ids?.forEach(m=>{c.delete_by_id(m)})}),i.encode()}catch(l){throw new d("knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits failed",{error:l})}let s=i.get_encoding_result();return W(s.error,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits failed"),structuredClone(s.get_byte_buffer())})}function Tt(e,r){return u(this,null,function*(){let t=yield I(),o=new t.GraphQueryRequestEncoder;if(o.deleteLater(),e.outputSpatialReference?o.output_spatial_reference={wkid:e.outputSpatialReference.wkid,latestWkid:e.outputSpatialReference.latestWkid,vcsWkid:e.outputSpatialReference.vcsWkid,latestVcsWkid:e.outputSpatialReference.latestVcsWkid,wkt:e.outputSpatialReference.wkt??""}:o.output_spatial_reference=t.SpatialReferenceUtil.WGS84(),o.open_cypher_query=e.openCypherQuery,e.bindParameters)for(let[s,l]of Object.entries(e.bindParameters))wt(s,l,o,t);if(e.bindGeometryQuantizationParameters)ke(e.bindGeometryQuantizationParameters,o);else{if(r.dataModel||(yield ce(r)),r.dataModel?.spatialReference?.wkid!==4326)throw new d("knowledge-graph:SR-quantization-mismatch","If the DataModel indicates a coordinate system other than WGS84, inputQuantizationParameters must be provided to the query encoder");o.input_quantization_parameters=t.InputQuantizationUtil.WGS84_lossless()}e.outputQuantizationParameters&&Fe(e.outputQuantizationParameters,o,t);try{o.encode()}catch(s){throw new d("knowledge-graph:query-encoding-failed","Attempting to encode the query failed",{error:s})}let i=o.get_encoding_result();if(i.error.error_code!==0)throw new d("knowledge-graph:query-encoding-failed","Attempting to encode the query failed",{errorCode:i.error.error_code,errorMessage:i.error.error_message});return structuredClone(i.get_byte_buffer())})}function Et(e){return u(this,null,function*(){let r=yield I(),t=new r.GraphSearchRequestEncoder;if(t.deleteLater(),t.search_query=e.searchQuery,t.type_category_filter=r.esriNamedTypeCategory[e.typeCategoryFilter],e.returnSearchContext===!0&&(t.return_search_context=e.returnSearchContext),e.start!=null&&e.start>0&&(t.start_index=e.start),e.num!=null&&(t.max_num_results=e.num),e.idsFilter!=null&&Array.isArray(e.idsFilter)&&e.idsFilter.length>0)try{t.set_ids_filter(we(e.idsFilter,r))}catch(i){throw new d("knowledge-graph:ids-format-error","Attempting to set ids filter failed.  This is usually caused by an incorrectly formatted UUID string",{error:i})}e.namedTypesFilter?.forEach(i=>{t.add_named_type_filter(i)});try{t.encode()}catch(i){throw new d("knowledge-graph:search-encoding-failed","Attempting to encode the search failed",{error:i})}let o=t.get_encoding_result();if(o.error.error_code!==0)throw new d("knowledge-graph:search-encoding-failed","Attempting to get encoding result from the query failed",{errorCode:o.error.error_code,errorMessage:o.error.error_message});return structuredClone(o.get_byte_buffer())})}function Ie(e,r){return u(this,null,function*(){return j(e,{responseType:"native-request-init",method:"post",query:Y({f:"pbf"},r?.query),body:"x",headers:{"Content-Type":"application/octet-stream"},signal:r?.signal,timeout:r?.timeout})})}function vt(e){return u(this,null,function*(){let r=e.headers.get("content-type");if(r?.includes("application/x-protobuf")){let t=yield e.arrayBuffer(),o=new(yield I()).GraphApplyEditsDecoder;return o.deleteLater(),o.decode(new Uint8Array(t)),Ke(o)}throw new d("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:r,data:e.text()})})}function Re(e,r,t,o=new P({wkid:P.WGS84.wkid})){e.push_buffer(new Uint8Array(r));let i=[],s=0;for(;e.next_row();){s||(s=e.get_header_keys().size());let l=new Array(s);for(let p=0;p<s;p++){let c=e.get_value(p);l[p]=ue(c,t,o)}i.push(l)}if(e.has_error())throw new d("knowledge-graph:stream-decoding-error","One or more result rows were not successfully decoded",{errorCode:e.error.error_code,errorMessage:e.error.error_message});return i}function Je(e,r,t){return u(this,null,function*(){let o=e.headers.get("content-type");if(e.headers.get("content-length")&&B.getLogger("esri.rest.knowledgeGraph.knowledgeGraphService").warnOnce("Found `Content-Length` header when expecting a streaming HTTP response! Please investigate whether all intermediate HTTP proxies and/or load balancers are configured such that they don't forcefully buffer the entire response before returning it to the client. A valid HTTP streaming response should use Chunked Transfer Encoding and not have a Content Length defined."),o?.includes("application/x-protobuf")){let l,i=e.body?.getReader(),s=new(yield I()).GraphQueryDecoder;return s.deleteLater(),new ReadableStream({start(p){return u(this,null,function*(){try{return c()}catch(m){i?.releaseLock(),p.error(new d("knowledge-graph:stream-decoding-error","The server returned a valid response, but there was an error decoding the response stream",{error:m})),p.close()}function c(){return i?.read().then(({done:m,value:g})=>{if(m){let f;if(s.has_error()&&(f=new d("knowledge-graph:stream-decoding-error","One or more result rows were not successfully decoded",{errorCode:s.error.error_code,errorMessage:s.error.error_message})),i.releaseLock(),f)throw p.error(f),f;return void p.close()}let G=Re(s,g,r,t);return G.length>0&&p.enqueue(G),c()})}})}})}throw new d("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:o,data:e.text()})})}function Ze(e){return u(this,null,function*(){let r=`${e.url}/dataModel/queryDataModel`,t=yield j(r,{responseType:"array-buffer",query:{f:"pbf"}}),o=t.getHeader?.("content-type"),i=t.data;if(o?.includes("application/x-protobuf")){let s=(yield I()).decode_data_model_from_protocol_buffer(new Uint8Array(i));if(!s)throw new d("knowledge-graph:data-model-decode-failure","The server responded to the data model query, but the response failed to be decoded.  This typically occurs when the Knowledge JS API (4.26 or later) is used with an unsupported backend (11.0 or earlier)");return ze(s)}throw new d("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:o,data:t.data})})}export{te as a,oe as b,R as c,Bi as d,Vi as e,Hi as f,Ki as g,Ji as h,Zi as i,ce as j,gt as k,Ge as l};
