import{a as oi}from"./chunk-LK45ZNWD.js";import{a as et}from"./chunk-QAJCY744.js";import{a as ce,b as Nt,c as Pt,d as Jt,f as ze,g as Xt,h as Yt,i as ri,j as ai,k as G,l as li}from"./chunk-JNONQQQT.js";import{a as _e}from"./chunk-FHBFWDFD.js";import{a as ni}from"./chunk-2774JW3N.js";import{h as Zt,i as Kt}from"./chunk-DXCDSOAV.js";import{a as Qt}from"./chunk-4XUK6P2F.js";import{a as ei,b as ti,c as ii,d as si}from"./chunk-46I2RIMB.js";import{a as Ye,b as qt,c as Gt,d as jt}from"./chunk-3SBNJPR7.js";import{d as Bt,e as Ht,g as Ot,h as Ze,i as Ut,j as Ke,k as Wt,l as Xe}from"./chunk-WRIQADAP.js";import{a as kt}from"./chunk-5UE35WME.js";import{h as Mt,n as Qe}from"./chunk-HHIR5BNR.js";import{c as Dt}from"./chunk-B6VNGUER.js";import{a as Je}from"./chunk-YUIUJIOR.js";import{d as Tt}from"./chunk-XSGDUFLB.js";import{c as Ft}from"./chunk-BRJSO7CG.js";import{d as At,e as Le}from"./chunk-6NTJ4HVA.js";import{k as je,m as oe}from"./chunk-NC2NFLV7.js";import{a as xe}from"./chunk-UJ6V7JUK.js";import{f as ne,g as X}from"./chunk-AUSMAEKP.js";import{b as Vt,g as c}from"./chunk-WVCJLLRA.js";import{f as qe}from"./chunk-OVOWBDBP.js";import{a as x,b as We,c as le,d as Rt,g as U}from"./chunk-4XUOIGFO.js";import{a as $t}from"./chunk-ALQ3STGG.js";import{a as W,b as zt}from"./chunk-AM3VOA32.js";import{a as xt}from"./chunk-7HZKOXPR.js";import{b as Ve,d as K}from"./chunk-HMKFQDR7.js";import{b as It}from"./chunk-2OT2C2UU.js";import{b as ve}from"./chunk-SF6Z2K5H.js";import{c as Ct}from"./chunk-HOJTYTYD.js";import{a as Et}from"./chunk-XNEAL2YW.js";import{a as St}from"./chunk-J7M5V2SQ.js";import{O as _t,Y as wt,aa as Ge}from"./chunk-XPCG2OJX.js";import{L as g,O as Ee,i as vt,k as ae}from"./chunk-AUTL5LCV.js";import{S as O}from"./chunk-KUJG22IX.js";import{a as p}from"./chunk-W3WDPWBE.js";import{B as Lt}from"./chunk-GISCFF3Z.js";import{o as bt,r as H}from"./chunk-HQMV3KQV.js";import{q as re}from"./chunk-CRMMDK2Z.js";import{a as N,h as R}from"./chunk-EAH6BNBL.js";function ci(e,t,i){let s=e.effectiveClusterRenderer;if(!s||!("visualVariables"in s)||!s.visualVariables)return null;let r=s.visualVariables.find(h=>h.type==="size");if(!("stops"in r)||!r.stops)return null;let a=r.stops.find(h=>h.useMinValue),l=r.stops.find(h=>h.useMaxValue);if(a==null||l==null)return null;let o=i.featuresTilingScheme.getClosestInfoForScale(i.scale).level,n=r.field,d=t.getDisplayStatistics(o,n);return d?new Le({field:r.field,minSize:e.clusterMinSize,minDataValue:d.minValue,maxSize:e.clusterMaxSize,maxDataValue:d.maxValue}):null}function di(e){let i=Math.floor(Math.log10(Math.abs(e)))+1,s=i<4||i>6?4:i,r=1e6,a=Math.abs(e)>=r?"compact":"standard";return Ve(e,{notation:a,minimumSignificantDigits:2,maximumSignificantDigits:s})}var yi=16,xi="https://utility.arcgis.com/sharing/tools/legend",zi="esri.layers.ImageryLayer",Fi="esri.layers.ImageryTileLayer",$i="esri.layers.WCSLayer",Fe=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,Ai=new St({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),$e=new oe({size:6,outline:{color:[128,128,128,.5],width:.5}}),Ti=new je({style:"solid"});function st(e){return e.type==="flow"}function pi(e){return e.type==="vector-field"}function mi(e){return e.type==="raster-colormap"}function fi(e){return e.type==="raster-stretch"}function gi(e){return e.type==="raster-shaded-relief"}function he(e){return e.declaredClass==="esri.renderers.SimpleRenderer"}function Y(e){return e.declaredClass==="esri.renderers.ClassBreaksRenderer"}function we(e){return e.declaredClass==="esri.renderers.UniqueValueRenderer"}function bi(e){return e.declaredClass==="esri.renderers.HeatmapRenderer"}function Di(e){return rt(e)||at(e)||lt(e)||Mi(e)}function Mi(e){return e.declaredClass==="esri.renderers.PointCloudRGBRenderer"}function rt(e){return e.declaredClass==="esri.renderers.PointCloudClassBreaksRenderer"}function at(e){return e.declaredClass==="esri.renderers.PointCloudStretchRenderer"}function lt(e){return e.declaredClass==="esri.renderers.PointCloudUniqueValueRenderer"}function vi(e){return e.declaredClass==="esri.renderers.DotDensityRenderer"}function Li(e){return e.declaredClass==="esri.renderers.PieChartRenderer"}function ki(e,t){return he(e)||Y(e)||we(e)||bi(e)||vi(e)||Li(e)?t.type==="2d"||oi(e):fi(e)||mi(e)||gi(e)||rt(e)||at(e)||lt(e)||pi(e)||st(e)}function Ni(e){return e.declaredClass==="esri.layers.BuildingSceneLayer"}function tt(e){return e.declaredClass==="esri.layers.SubtypeGroupLayer"}function Pi(e){return e.declaredClass==="esri.layers.VoxelLayer"}function Bi(e){return e.declaredClass==="esri.layers.WMSLayer"}function Hi(e){return e.declaredClass==="esri.layers.WMTSLayer"}function it(e){return e.declaredClass==="esri.layers.MapImageLayer"}function hi(e){return e.declaredClass==="esri.layers.TileLayer"}function de(e){return e.declaredClass===zi}function Ae(e){return e.declaredClass===Fi}function Oi(e){return e.declaredClass===$i}function Ui(e){return e.type==="stretch-ramp"}function Wi(e){return("authoringInfo"in e?e?.authoringInfo:null)?.type==="univariate-color-size"}function qi(e){let t="authoringInfo"in e?e?.authoringInfo:null;return t?.type==="univariate-color-size"&&t?.univariateTheme==="above-and-below"}function ui(e){return"sublayers"in e}function j(e,t){return R(this,null,function*(){let i=yield It("esri/widgets/Legend/t9n/Legend");return e!=="previewTemplateAriaLabel"||t||(e="previewAriaLabel"),K(i[e],{label:t})})}var Gi=new oe({style:"path",path:"M10,5 L5,0 0,5 M5,0 L5,15",size:15,outline:{width:1,color:[85,85,85,1]}}),ye={},A=class extends Ee{constructor(e){super(e),this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._webStyleSymbolCache=new Map,this._dotDensityUrlCache=new Map,this._scaleDrivenSizeVariable=null,this._hasClusterSizeVariable=!1,this._layerDefinitionExpressionClause=null,this.children=new ve,this.layerView=null,this.layer=null,this.legendElements=[],this.parent=null,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerDefinitionExpression=!1,this.respectLayerVisibility=!0,this.sublayerIds=[],this.title=null,this.view=null}initialize(){let e=()=>this.notifyChange("ready");this.addHandles([le(()=>this.children,"change",t=>{let{added:i,removed:s}=t;i.forEach(r=>{let a=`activeLayerInfo-ready-watcher-${r.layer.uid}`;this.addHandles(x(()=>r.ready,e,U),a)}),s.forEach(r=>this.removeHandles(r.layer.uid)),e()})]),this.keepCacheOnDestroy||(ye={})}destroy(){this._webStyleSymbolCache=null,this._dotDensityUrlCache=null,this._scaleDrivenSizeVariable=null,this.keepCacheOnDestroy||(ye=null),this._layerDefinitionExpressionClause=null}get effectList(){let e=this.layer,t=null;return"effect"in e&&e.effect&&(t=new ni,t.effect=e.effect,t.endTransitions(),t.scale=this.scale),t}get opacity(){let e=this.layer.opacity,t=this.parent?.opacity,i=this.layer.parent,s=i&&"uid"in i?this._getParentLayerOpacity(i):null;return t!=null?t*e:s!=null?s*e:e}get ready(){return this.layer===null||(this.children.length>0?this._isGroupActive():this.legendElements.length>0)}get scale(){return this.view?.scale??0}get isScaleDriven(){let e=this.layer;if(e===null)return!1;if("effect"in e&&e.effect&&Array.isArray(e.effect))return!0;if("featureReduction"in e&&e.featureReduction){if(e.featureReduction.type==="cluster")return!0;if(e.featureReduction.type==="binning"&&"renderer"in e.featureReduction&&e.featureReduction.renderer)return this._isRendererScaleDriven(e.featureReduction.renderer)}return"renderer"in e&&e.renderer?this._isRendererScaleDriven(e.renderer):this._isLayerScaleDriven(this.layer)}get version(){return this._get("version")+1}buildLegendElementsForFeatureCollections(e){return R(this,null,function*(){if(!(!this.hideLayersNotInCurrentView||(yield this._isLayerInCurrentView())))return this.legendElements=[],void this.notifyChange("ready");let t=Array.from(e,i=>{if(xt(i))return this._getRendererLegendElements(i.renderer,{title:i.title});if(i.featureSet?.features.length){let s=i.layerDefinition,r=s?.drawingInfo,a=r&&Tt(r.renderer),l=Ai.read(s.geometryType);return a?this._getRendererLegendElements(a,{title:i.name,geometryType:l}):(H.getLogger(this).warn("drawingInfo not available!"),null)}return null});try{let i=[],s=yield Promise.allSettled(t);for(let r of s)if(r.status==="fulfilled")for(let a of r.value??[])i.push(a);this.legendElements=i,this.notifyChange("ready")}catch(i){H.getLogger(this).warn("error while building legend for layer!",i)}})}buildLegendElementsForRenderer(e){return R(this,null,function*(){try{let t=!this.hideLayersNotInCurrentView||(yield this._isLayerInCurrentView());this.legendElements=t?yield this._getRendererLegendElements(e):[],this.notifyChange("ready")}catch(t){H.getLogger(this).warn("error while building legend for layer!",t)}})}buildLegendElementsForFeatureReduction(e){return R(this,null,function*(){try{let t=!this.hideLayersNotInCurrentView||(yield this._isLayerInCurrentView());this.legendElements=t?yield this._getLegendElementsForFeatureReduction(e):[],this.notifyChange("ready")}catch(t){H.getLogger(this).warn("error while building legend for layer!",t)}})}buildLegendElementsForTools(){return R(this,null,function*(){let e=this.layer;if(Pi(e))this._constructLegendElementsForVoxelLayer();else if(Hi(e))this._constructLegendElementsForWMTSlayer();else if(Bi(e))yield this._constructLegendElementsForWMSSublayers();else if(Ni(e))yield this._constructLegendElementsForBuildingSceneLayer();else if(it(e)||hi(e)||tt(e))yield this._constructLegendElementsForSublayers();else{this.removeHandles("imageryLayers-watcher");let t="default";if(de(e)&&(t=(e?.rasterFunction?.functionName||"default")+"_"+(e.bandIds?.length?e.bandIds.join(""):"###")),Ae(e))return;yield this._getLegendLayers(`${e.uid}-${t}`).then(i=>R(this,null,function*(){this.legendElements=[],this.notifyChange("ready");let s=i.map(r=>R(this,null,function*(){if(de(e)){let l=x(()=>["renderingRule"in e&&e.rasterFunction,e.bandIds],()=>Lt(()=>R(this,null,function*(){ye.default=null,e.renderer?yield this.buildLegendElementsForRenderer(e.renderer):yield this.buildLegendElementsForTools()}))());this.addHandles(l,"imageryLayers-watcher")}let a=this._generateSymbolTableElementForLegendLayer(r);a?.infos.length&&(de(e)&&(a.title=e.title),this.legendElements.push(a)),this.notifyChange("ready")}));yield Promise.allSettled(s)})).catch(i=>{H.getLogger(this).warn("Request to server for legend has failed!",i)})}})}_isLayerInCurrentView(){return R(this,null,function*(){let e=this.layer,t=this.layerView,i=t&&"createQuery"in t&&"queryFeatureCount"in t;if(!i&&!(t&&"createQuery"in e&&"queryFeatureCount"in e))return!0;yield Rt(()=>!t.updating);let s=i?"createQuery"in t&&t.createQuery():"createQuery"in e&&e.createQuery();return s?(s.geometry=this.view.extent,(i?"queryFeatureCount"in t&&(yield t.queryFeatureCount(s)):"queryFeatureCount"in e&&(yield e.queryFeatureCount(s)))!==0):!0})}_getParentLayerOpacity(e){let t=1,i=e.parent;return i&&"uid"in i&&(t=this._getParentLayerOpacity(i)),e.opacity*t}_isGroupActive(){return this.children.some(e=>e.ready)}_isRendererScaleDriven(e){if(e.type==="dot-density")return!0;let t="valueExpression"in e?e.valueExpression:null;return Fe.test(t)?!0:!!("visualVariables"in e?e.visualVariables:null)?.some(s=>this._isScaleDrivenSizeVariable(s))||this._hasScaleDrivenSymbols(e)}_hasScaleDrivenSymbols(e){switch(e.type){case"simple":return this._isScaleDrivenSymbol(e.symbol);case"class-breaks":return this._isScaleDrivenSymbol(e.defaultSymbol)||e.classBreakInfos.some(t=>this._isScaleDrivenSymbol(t.symbol));case"unique-value":return this._isScaleDrivenSymbol(e.defaultSymbol)||!!e.uniqueValueInfos?.some(t=>this._isScaleDrivenSymbol(t.symbol))}return!1}_isScaleDrivenSymbol(e){if(e?.type==="cim"){let{primitiveOverrides:t,minScale:i,maxScale:s}=e.data,r=t?.some(a=>/\$view\.scale/.test(a.valueExpressionInfo?.expression||""))??!1;return i!=null||s!=null||r}return!1}_isScaleDrivenSizeVariable(e){if(e&&e.type!=="size")return!1;let t=e,i=t.minSize,s=t.maxSize;return!(typeof i!="object"||!i||!this._isScaleDrivenSizeVariable(i))||!(typeof s!="object"||!s||!this._isScaleDrivenSizeVariable(s))||Fe.test(t.valueExpression)}_isLayerScaleDriven(e){if("minScale"in e&&e.minScale>0||"maxScale"in e&&e.maxScale>0)return!0;if("sublayers"in e&&e.sublayers)return e.sublayers.some(i=>this._isLayerScaleDriven(i));let t=e.parent;if(e.loaded===!1&&t&&it(t)&&"source"in e&&e.source&&e.source.type==="map-layer"){for(let i of t.sourceJSON.layers??[])if(i.id===e.source.mapLayerId&&(i.minScale>0||i.maxScale>0))return!0}return!1}_constructLegendElementsForVoxelLayer(){return R(this,null,function*(){this.legendElements=[],this.removeHandles("voxel-style-watcher"),this.removeHandles("voxel-current-variable");let e=this.layer;this.addHandles(x(()=>e.currentVariableId,()=>this._constructLegendElementsForVoxelLayer()),"voxel-current-variable"),this.addHandles(x(()=>e.getVariableStyles(),()=>this._constructLegendElementsForVoxelLayer()),"voxel-style-watcher");let t=e.getVariableStyle(null),i=[];if(t){if(t.uniqueValues?.length){let a=[];t.uniqueValues.forEach(l=>{l.enabled&&a.push({label:l.label||`${l.value}`,value:l.value,symbol:new je({color:l.color,outline:null})})}),a.length&&i.push({type:"symbol-table",title:t.label,infos:a})}else if(t.transferFunction){let{colorStops:a,stretchRange:l}=t.transferFunction,o=a.toArray().reverse(),n=l.map((h,y)=>`${y===0?Bt:Ht} ${di(h)}`).reverse(),d=o.map(h=>({color:h.color,value:null,label:null}));d[0].label=n[0],d[d.length-1].label=n[1],i.push({type:"color-ramp",title:t.label,infos:d,preview:G(o.map(h=>h.color),{ariaLabel:yield j("previewColorRampAriaLabel")})})}}let s=e.opacity,r=i.reduce((a,l)=>[...a,...this._getAllInfos(l)],[]).filter(a=>!!a?.symbol).map(a=>this._getSymbolPreview(a,s));yield Promise.allSettled(r),this.legendElements=i,this.notifyChange("ready")})}_constructLegendElementsForWMTSlayer(){this.legendElements=[],this.removeHandles("wmts-activeLayer-watcher");let e=this.layer.activeLayer;this.addHandles(x(()=>{let{layer:i}=this;return i&&"activeLayer"in i&&i.activeLayer},()=>this._constructLegendElementsForWMTSlayer()),"wmts-activeLayer-watcher");let t=e.styleId?e.styles?.find(({id:i})=>i===e.styleId)?.legendUrl:void 0;t&&(this.legendElements=[{type:"symbol-table",title:e.title,infos:[{src:t,opacity:this.opacity}]}]),this.notifyChange("ready")}_constructLegendElementsForWMSSublayers(){return R(this,null,function*(){this.legendElements=[],this.removeHandles("wms-sublayers-watcher");let e=this.layer,t=null;(e.customParameters||e.customLayerParameters)&&(t=N(N({},e.customParameters),e.customLayerParameters)),this.addHandles(x(()=>{let{layer:i}=this;return i&&"sublayers"in i&&i.sublayers},()=>this._constructLegendElementsForWMSSublayers()),"wms-sublayers-watcher"),this.legendElements=yield this._generateLegendElementsForWMSSublayers(e.sublayers,t),this.notifyChange("ready")})}_generateLegendElementsForWMSSublayers(e,t){return R(this,null,function*(){let i=this.layer,s=[];this.addHandles(e.on("change",()=>this._constructLegendElementsForWMSSublayers()),"wms-sublayers-watcher");let r=this.sublayerIds?.map(l=>i.findSublayerById(l))?.filter(re)??[],a=r.length?r:e.toArray();for(let l of a){let o=x(()=>[l.title,l.visible,l.legendEnabled],()=>this._constructLegendElementsForWMSSublayers());if(this.addHandles(o,"wms-sublayers-watcher"),!this.respectLayerVisibility||l.visible&&l.legendEnabled){let n=yield this._generateSymbolTableElementForWMSSublayer(l,t);n?.infos.length&&s.unshift(n)}}return s})}_generateSymbolTableElementForWMSSublayer(e,t){return R(this,null,function*(){if(!e.legendUrl&&e.sublayers){let i=(yield this._generateLegendElementsForWMSSublayers(e.sublayers,t)).filter(s=>s);return{type:"symbol-table",title:e.title,infos:i}}return this._generateSymbolTableElementForLegendUrl(e,t)})}_generateSymbolTableElementForLegendUrl(e,t){return R(this,null,function*(){let i=e.legendUrl;if(!i)return;let s={type:"symbol-table",title:e.title||e.name||String(e.id??""),infos:[]};t&&(i=_t(i,t));let r=null,a=e.layer?.opacity;try{r=(yield Ge(i,{responseType:"image"})).data,r&&(r.style.opacity=a)}catch{}return s.infos.push({src:i,preview:r,opacity:a}),s})}_getLegendLayers(e,t){let i=ye&&ye[e];return i?Promise.resolve(i):this._legendRequest(t).then(s=>{let r=s.layers;return ye[e]=r,r})}_legendRequest(e){let t=this.layer,i={f:"json",dynamicLayers:e};if(de(t)){let r=t.exportImageServiceParameters.rasterFunction;if(r&&(i.renderingRule=JSON.stringify(r.functionDefinition?.toJSON()||r.toJSON())),t.bandIds&&(i.bandIds=t.bandIds.join()),t.raster||t.viewId||t.customParameters){let{raster:a,viewId:l,customParameters:o}=t;i=N(N({raster:a,viewId:l},i),o)}}let s=t.url.replace(/(\/)+$/,"");if("version"in t&&+t.version>=10.01){let r=s.indexOf("?");r>-1?s=s.substring(0,r)+"/legend"+s.substring(r):s+="/legend"}else{let r=s.toLowerCase().indexOf("/rest/"),a=s.substring(0,r)+s.substring(r+5,s.length);s=xi+"?soapUrl="+encodeURI(a)+"&returnbytes=true"}return Ge(s,{query:i}).then(r=>r.data)}_constructLegendElementsForBuildingSceneLayer(){return R(this,null,function*(){this.legendElements=[],this.removeHandles("sublayers-watcher");let e=this.layer;this.addHandles(x(()=>e.sublayers,()=>this._constructLegendElementsForBuildingSceneLayer()),"sublayers-watcher");try{this.legendElements=yield this._generateLegendElementsForBuildingSublayers(e.sublayers,this.opacity),this.notifyChange("ready")}catch(t){H.getLogger(this).warn("Request to server for legend has failed!",t)}})}_generateLegendElementsForBuildingSublayers(e,t){return R(this,null,function*(){let i=[];this.addHandles(e.on("change",()=>this._constructLegendElementsForBuildingSceneLayer()),"sublayers-watcher");let s=e.toArray();for(let r of s){let a=x(()=>["renderer"in r&&r.renderer,r.opacity,r.title,r.visible],()=>this._constructLegendElementsForBuildingSceneLayer());if(this.addHandles(a,"sublayers-watcher"),!this.respectLayerVisibility||r.visible){let l=r?.opacity!=null?r.opacity:null,o=l!=null?l*t:t;if(r.type==="building-group"){let n={type:"symbol-table",title:r.title,infos:[]},d=yield this._generateLegendElementsForBuildingSublayers(r.sublayers,o);n.infos.push(...d),i=[n,...i]}else r.renderer&&(i=[...yield this._getRendererLegendElements(r.renderer,{title:r.title,opacity:o,sublayer:r}),...i])}}return i.filter(r=>!!r&&(!("infos"in r)||!r.infos||r.infos.length>0))})}_constructLegendElementsForSublayers(){return R(this,null,function*(){this.legendElements=[],this.removeHandles("sublayers-watcher");let e=this.layer;if(it(e)||hi(e)||tt(e)){this.addHandles(x(()=>e.sublayers,()=>this._constructLegendElementsForSublayers),"sublayers-watcher");try{this.legendElements=yield this._generateLegendElementsForSublayers(e.sublayers,this.opacity),this.notifyChange("ready")}catch(t){H.getLogger(this).warn("Request to server for legend has failed!",t)}}})}_generateLegendElementsForSublayers(e,t,i){return R(this,null,function*(){let s=this.layer,r=[];this.addHandles(e.on("change",()=>this._constructLegendElementsForSublayers()),"sublayers-watcher");let a=e.toArray();!i&&this.sublayerIds&&this.sublayerIds.length&&(a=tt(s)?this.sublayerIds.map(l=>s.findSublayerForSubtypeCode(l)).filter(re):this.sublayerIds.map(l=>s.findSublayerById(l)).filter(re));for(let l of a){let o=x(()=>[l.renderer,l.opacity,l.title,l.visible,l.legendEnabled],()=>this._constructLegendElementsForSublayers());if(this.addHandles(o,"sublayers-watcher"),!this.respectLayerVisibility||l.visible&&l.legendEnabled&&this._isSublayerInScale(l)){let n=l?.opacity!=null?l.opacity:null,d=n!=null?n*t:t,h=!ui(l)||l.originIdOf("renderer")>ae.SERVICE&&!l.sublayers;if(l.renderer&&h)yield l.load(),r=[...yield this._getRendererLegendElements(l.renderer,{title:l.title,opacity:d,sublayer:l}),...r];else if(ui(l)){let y=yield this._generateSymbolTableElementForSublayer(l,d,i);y&&r.unshift(y)}}}return r.filter(l=>!!l&&(!("infos"in l)||!l.infos||l.infos.length>0))})}_generateSymbolTableElementForSublayer(e,t,i){return R(this,null,function*(){if(!i){i=new Map;let r=this.layer,a=e.source,l=null;if(!(!a||a.type==="map-layer"&&a.mapLayerId===e.id&&(!a.gdbVersion||a.gdbVersion===("gdbVersion"in r&&r.gdbVersion)))||e.originIdOf("renderer")>ae.SERVICE||e.originIdOf("labelingInfo")>ae.SERVICE||e.originIdOf("labelsVisible")>ae.SERVICE){let n=new kt({layer:this.layer});l=n.hasDynamicLayers?n.dynamicLayers:null,n.destroy()}let o=l||`${r.uid}-default`;(yield this._getLegendLayers(o,l)).forEach(n=>i.set(n.layerId,n))}let s=i.get(e.id);if((!s||s?.subLayerIds&&s.defaultVisibility)&&e.sublayers){let r=yield this._generateLegendElementsForSublayers(e.sublayers,t,i);return{type:"symbol-table",title:e.title,infos:r}}return this._generateSymbolTableElementForLegendLayer(s,e,t)})}_generateSymbolTableElementForLegendLayer(e,t,i){if(!e?.legend||this.respectLayerVisibility&&!this._isLegendLayerInScale(e,t))return null;let s=t?.renderer,r=t?.title||e.layerName;if(s&&(!t||t?.originIdOf("renderer")>ae.SERVICE)){let o=t?.title||this._getRendererTitle(s,t);o&&(r&&typeof o!="string"&&"title"in o&&(o.title=r),r=o)}let a={type:"symbol-table",title:r,legendType:e.legendType||null,infos:[]},l=t?this._sanitizeLegendForSublayer(e.legend.slice(),t):e.legend;return e.legendGroups&&e.legendGroups.length>0?e.legendGroups.forEach(o=>{let n={type:"symbol-table",title:o.heading,legendType:e.legendType||null,infos:this._generateSymbolTableElementInfosForLegendLayer(l.filter(d=>d.groupId===o.id),e.layerId,i)};n.infos?.length>0&&a.infos.push(n)}):a.infos=this._generateSymbolTableElementInfosForLegendLayer(l,e.layerId,i),a.infos.length>0?a:null}_generateSymbolTableElementInfosForLegendLayer(e,t,i){return e.map(s=>{let r=s.url;if(s.imageData&&s.imageData.length>0)r=`data:image/png;base64,${s.imageData}`;else{if(r.indexOf("http")===0)return null;r=wt(`${this.layer.url}/${t}/images/${r}`)}return{label:s.label,src:r,opacity:i??this.opacity,width:s.width,height:s.height}}).filter(re)}_isSublayerInScale(e){let t=e.minScale||0,i=e.maxScale||0;return!(t>0&&t<this.scale||i>this.scale)}_isLegendLayerInScale(e,t){let i=t||this.layer,s=null,r=null,a=!0;return!i.minScale&&i.minScale!==0||!i.maxScale&&i.maxScale!==0?(e.minScale===0&&i.tileInfo&&(s=i.tileInfo.lods[0].scale),e.maxScale===0&&i.tileInfo&&(r=i.tileInfo.lods[i.tileInfo.lods.length-1].scale)):(s=Math.min(i.minScale,e.minScale)||i.minScale||e.minScale,r=Math.max(i.maxScale,e.maxScale)),(s>0&&s<this.scale||r>this.scale)&&(a=!1),a}_sanitizeLegendForSublayer(e,t){if("version"in this.layer&&+this.layer.version<10.1||e.length===0)return e;let i=t.renderer,s=e.some(l=>l.values),r=0,a=null;return s&&e.some((l,o)=>(l.values||(r=o,a=l,a.label||(a.label="others")),a!=null)),i?i.type==="unique-value"?a&&(e.splice(r,1),e.push(a)):i.type==="class-breaks"&&(a&&e.splice(r,1),e.reverse(),a&&e.push(a)):a&&(e.splice(r,1),e.push(a)),e}_getRendererLegendElements(i){return R(this,arguments,function*(e,t={}){if(!ki(e,this.view))return H.getLogger(this).warn(`Renderer of type '${e.type}' not supported!`),[];if(Di(e))return this._constructPointCloudRendererLegendElements(e,t);if(vi(e))return this._constructDotDensityRendererLegendElements(e);let s=yield this._loadRenderer(e);return Li(s)?this._constructPieChartRendererLegendElements(s):this._constructRendererLegendElements(s,t)})}_getLegendElementsForFeatureReduction(e){return R(this,null,function*(){let t=null;return e.type==="binning"?t=e.renderer:e.type==="cluster"&&(t=this._getClusterRenderer(e)),t?this._getRendererLegendElements(t):[]})}_getPointCloudRendererTitle(e){return(e.legendOptions?.title||e.field)??""}_constructPointCloudRendererLegendElements(i){return R(this,arguments,function*(e,t={}){let s=t.title,r=[],a=null,l=null;if(rt(e))a={type:"symbol-table",title:s||this._getPointCloudRendererTitle(e),infos:[]},e.colorClassBreakInfos.forEach(n=>{a.infos.unshift({label:n.label||n.minValue+" - "+n.maxValue,value:[n.minValue,n.maxValue],symbol:this._getAppliedCloneSymbol($e,n.color)})});else if(at(e)){let n=e.stops,d=null;if(n?.length&&(n.length===1&&(d=n[0].color),!d)){let y=n[0].value,b=n[n.length-1].value;y!=null&&b!=null&&(d=Gt(y+(b-y)/2,n))}a={type:"symbol-table",title:null,infos:[{label:null,value:null,symbol:this._getAppliedCloneSymbol($e,d||$e.color)}]};let h=qt(e.stops??[])??[];l={type:"color-ramp",title:s||this._getPointCloudRendererTitle(e),infos:h,preview:G(h.map(y=>y.color),{ariaLabel:yield j("previewColorRampAriaLabel")})}}else lt(e)&&(a={type:"symbol-table",title:s||this._getPointCloudRendererTitle(e),infos:[]},e.colorUniqueValueInfos?.forEach(n=>{a.infos.push({label:n.label||n.values.join(", "),value:n.values.join(", "),symbol:this._getAppliedCloneSymbol($e,n.color)})}));a?.infos.length&&r.push(a),l?.infos.length&&r.push(l);let o=r.reduce((n,d)=>[...n,...d.infos??[]],[]).filter(n=>!!n.symbol).map(n=>this._getSymbolPreview(n,this.opacity,{symbolConfig:{applyColorModulation:!!e.colorModulation}}));return yield Promise.allSettled(o),r})}_getElementInfoForDotDensity(e,t){return R(this,null,function*(){let{color:i,label:s,valueExpressionTitle:r}=t,{backgroundColor:a,outline:l,dotSize:o}=e,n=this.effectList,d=n?.effects.map(u=>u.toJSON()),h=Ft(d),y=yield j("previewTemplateAriaLabel",s||r),b=o+"-"+i+"-"+a+"-"+(l&&JSON.stringify(l.toJSON()))+"-"+h,v=this._dotDensityUrlCache,_=v.has(b)?v.get(b):ri(e,i,{ariaLabel:y});v.set(b,_);let I={shape:{type:"image",x:0,y:0,width:_.width,height:_.height,src:_.src},fill:null,stroke:null,offset:[0,0]},z=Kt([[I]],[_.width,_.height],{effectView:this.effectList,ariaLabel:y});return{opacity:1,src:_.src,preview:z,width:_.width,height:_.height}})}_constructDotDensityRendererLegendElements(e){return R(this,null,function*(){let t=e.calculateDotValue(this.view.scale),i=e.legendOptions?.unit,s={type:"symbol-table",title:{value:t&&Math.round(t),unit:i||""},infos:[]};for(let r of e.attributes){let a=yield this._getElementInfoForDotDensity(e,r);a.label=r.label||r.valueExpressionTitle||r.field,s.infos.push(a)}return[s]})}_constructPieChartRendererLegendElements(e){return R(this,null,function*(){let t=this.layer.opacity,i=[],s=null,r=e.outline;e.attributes.forEach(n=>{let d=new oe({color:n.color,outline:r}),h=n.label||n.valueExpressionTitle||n.field;i.push({label:h,symbol:d})});let a=i.length?[...i]:[];if(e.othersCategory?.color&&e.othersCategory?.threshold!==0){let n=new oe({color:e.othersCategory.color,outline:r});s=e.othersCategory.label||"Other",i.push({label:s,symbol:n})}if(e.defaultColor?.a){let n=new oe({color:e.defaultColor,outline:r});i.push({label:e.defaultLabel,symbol:n})}let l=(yield this._getVisualVariableLegendElements(e,this.layer))||[];if(i.length){l.unshift({type:"symbol-table",title:null,infos:i});let n=a.filter(h=>h.label!==s).map(h=>h.symbol.color).filter(Boolean),d=ai(n,{holePercentage:e.holePercentage,backgroundColor:e.backgroundFillSymbol?.color,effectList:this.effectList,outline:r,ariaLabel:yield j("previewPieChartAriaLabel")});l.unshift({type:"pie-chart-ramp",title:this._getRendererTitle(e,this.layer),infos:i,preview:d})}let o=l.reduce((n,d)=>[...n,...this._getAllInfos(d)],[]).filter(n=>!!n?.symbol&&!n?.preview).map(n=>this._getSymbolPreview(n,t,{effectList:this.effectList}));return yield Promise.allSettled(o),l})}_constructRendererLegendElements(i){return R(this,arguments,function*(e,t={}){let{title:s,sublayer:r}=t,a=r||this.layer,l=Xe(e);"definitionExpression"in a&&a.definitionExpression&&!this._layerDefinitionExpressionClause&&this.respectLayerDefinitionExpression&&(this._layerDefinitionExpressionClause=yield $t(a.definitionExpression,a.fieldsIndex)),this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._scaleDrivenSizeVariable=null;let o=(yield this._getVisualVariableLegendElements(e,a))||[],n={type:"symbol-table",title:s||this._getRendererTitle(e,a),infos:[]},d=null,h=!1,y=new Set;if(st(e)&&!this._hasSizeRamp){let u=yield Ut(e);n.infos.push({label:null,symbol:u})}else if(Wi(e)){let u=s,f=qi(e)?"univariate-above-and-below-ramp":"univariate-color-size-ramp",w=o.findIndex(B=>B.type==="color-ramp"),C=w!==-1?o.splice(w,1)[0]:null,S=o.findIndex(B=>B.type==="size-ramp"),F=S!==-1?o.splice(S,1)[0]:null,$=[];C&&(u=C.title,$.push(C)),F&&(u=F.title,$.push(F)),$.length>0&&o.push({type:f,title:u,infos:$})}else if(bi(e)){let u=Jt(e);o.push({type:"heatmap-ramp",title:s||this._getRendererTitle(e,a),infos:u,preview:G(u.map(f=>f.color),{effectList:this.effectList,ariaLabel:yield j("previewColorRampAriaLabel")})})}else if(we(e)){let u=e&&e.authoringInfo;if(u&&u.type==="relationship"){let{numClasses:f,field1:w,field2:C}=u,S=u.focus;if(f&&w&&C){let F=[w,C],$=Yt(S)||0;for(let k of F){let{field:J,normalizationField:se,label:Se}=k,Ce=Se||{field:this._getFieldAlias(J,a),normField:se&&this._getFieldAlias(se,a)},ge=Gi.clone();ge.angle=$,n.infos.push({label:Ce,symbol:ge}),y.add(ge),$+=90}let B=Xt({focus:S,numClasses:f,infos:e.uniqueValueInfos??[]});o.unshift(B)}}else if(de(this.layer)||Ae(this.layer)){let{field:f,field2:w}=e;e.uniqueValueInfos?.forEach(C=>{C.symbol&&(f&&this._checkDefinitionExpression(f,C.value)||w)&&n.infos.push({label:C.label||C.value,value:C.value,symbol:C.symbol})})}else{let{field:f,field2:w,field3:C,fieldDelimiter:S,valueExpression:F,defaultSymbol:$}=e,B=!(!f&&!F||!w&&!C),k=[];if(e.uniqueValueGroups?.forEach(J=>{let se={type:"symbol-table",title:J.heading,infos:[]};J.classes?.forEach(Se=>{let{symbol:Ce,values:ge}=Se;if(Ce){let ut=[],pt=[];for(let Ie of ge??[]){let{value:mt,value2:ft,value3:gt}=Ie,be=[],Re=[];(f||F)&&(be.push(mt),Re.push(this._getDomainName(f,mt,a))),w&&(be.push(ft),Re.push(this._getDomainName(w,ft,a))),C&&(be.push(gt),Re.push(this._getDomainName(C,gt,a))),ut.push(B?be.join(S||""):be[0]),pt.push(Re.join(" - "))}let He=ut.join(", "),Oe=Se.label;if(!Oe){let Ie=pt.filter(Boolean);Oe=Ie.length?Ie.join(", "):He}let Ue=Ce.clone();Ue.type==="cim"&&l&&ei(Ue,{innerDotSize:.5*yi,outerRingSize:yi}),(this._checkDefinitionExpression(f,He)||w)&&se.infos.push({label:Oe,value:He,symbol:Ue})}}),se.infos.length&&k.push(se)}),k.length){let J=k[0];k.length===1&&"title"in J&&!J.title?n.infos.push(...J.infos??[]):($&&(k.push({type:"symbol-table",infos:[{label:e.defaultLabel||"others",symbol:$}]}),h=!0),n.infos.push(...k)),s||e.legendOptions?.title||e.valueExpressionTitle||(n.title=null)}}e.defaultSymbol&&!h&&(n.infos.push({label:e.defaultLabel||"others",symbol:e.defaultSymbol}),h=!0)}else if(Y(e)){if(!l){if(d=this._isUnclassedRenderer(e),!d||!this._hasSizeRamp){let u=e.classBreakInfos.filter(({symbol:f})=>f);for(let{label:f,minValue:w,maxValue:C,symbol:S}of u)n.infos.unshift({label:f||(d?null:`${w} - ${C}`),value:[w,C],symbol:S});d&&(n.title=null),this._updateInfosForClassedSizeRenderer(e,n.infos)}e.defaultSymbol&&!d&&(n.infos.push({label:e.defaultLabel||"others",symbol:e.defaultSymbol}),h=!0)}}else if(fi(e))if(Ae(this.layer)||Oi(this.layer)){let u=yield this._constructTileImageryStretchRendererElements(e);Ui(u)?o.push(u):n.infos=u}else{let u=this.layer,f,w;if(e.statistics?.length){let $=e.statistics[0];Ke($)?(f=$.min,w=$.max):[f,w]=$}let C=[],S=u.serviceRasterInfo;if(u.rasterFunction)try{S=yield u.generateRasterInfo(u.rasterFunction)}catch{}let F=Je(S.pixelType);if(S.bandCount===1){let $=u.bandIds?.[0]||0;f=f??(S.statistics?S.statistics[$].min:F[0]),w=w??(S.statistics?S.statistics[$].max:F[1]),f||w?o.push(yield this._getStretchLegendElements(e,{min:f,max:w})):this._getServerSideLegend()}else if(u.bandIds&&u.bandIds.length===1)f=f??(S.statistics?S.statistics[u.bandIds[0]].min:F[0]),w=w??(S.statistics?S.statistics[u.bandIds[0]].max:F[1]),f||w?o.push(yield this._getStretchLegendElements(e,{min:f,max:w})):this._getServerSideLegend();else if(S.bandCount>=3){let{bandInfos:$}=S,{bandIds:B}=u;$.length>=S.bandCount?B?.length===3?(C=B.map(k=>$[k].name),n.infos=this._createSymbolTableElementMultiBand(C)):u.format==="lerc"?(C=[0,1,2].map(k=>$[k].name),n.infos=this._createSymbolTableElementMultiBand(C)):this._getServerSideLegend():u.format==="lerc"?(C=["band1","band2","band3"],n.infos=this._createSymbolTableElementMultiBand(C)):this._getServerSideLegend()}else this._getServerSideLegend()}else if(mi(e))e.colormapInfos.forEach(u=>{n.infos.push({label:u.label,value:u.value,symbol:this._getAppliedCloneSymbol(Ti,u.color)})});else if(he(e)){let u=e.symbol;switch(t.geometryType){case"point":u="pointSymbol"in a?a.pointSymbol:null;break;case"polyline":u="lineSymbol"in a?a.lineSymbol:null;break;case"polygon":u="polygonSymbol"in a?a.polygonSymbol:null}let f=this._hasClusterSizeVariable&&this._getClusterSymbol()||!this._hasSizeRamp;e.symbol&&f&&n.infos.push({label:e.label,symbol:u})}else if(pi(e)){e.outputUnit&&(this.title="("+e.toJSON().outputUnit+")"),n.title=e.attributeField;let u=e.getClassBreakInfos();u?.length?u.forEach(f=>{n.infos.push({label:f.minValue+" - "+f.maxValue,symbol:f.symbol})}):n.infos.push({label:e.attributeField,symbol:e.getDefaultSymbol()})}else gi(e)&&o.push(yield this._getStretchLegendElements(e,{min:0,max:255}));let b=e.defaultSymbol;!b||h||he(e)||d&&!this._hasColorRamp&&!this._hasSizeRamp&&!this._hasOpacityRamp||o.push({type:"symbol-table",infos:[{label:e.defaultLabel||"others",symbol:b}]}),n.infos.length&&o.unshift(n);let v=t.opacity==null?this.opacity:t.opacity,_=this._isTallSymbol("visualVariables"in e?e.visualVariables:null),I=de(this.layer)||Ae(this.layer),z=o.reduce((u,f)=>[...u,...this._getAllInfos(f)],[]).filter(u=>!!u?.symbol).filter(u=>{if(u.symbol.type==="cim"){let{minScale:f,maxScale:w}=u.symbol.data;if(f&&f<this.scale||w&&w>this.scale)return!1}return!0}).map(u=>this._getSymbolPreview(u,v,{isDefault:u.symbol===b,applyScaleDrivenSize:!y.has(u.symbol),symbolConfig:{isTall:_,isSquareFill:I},effectList:y.has(u.symbol)?null:this.effectList}));return e=null,yield Promise.allSettled(z),o})}_checkDefinitionExpression(e,t){return!e||typeof e!="string"||!this._layerDefinitionExpressionClause||this._layerDefinitionExpressionClause.testFeature({[e]:t})}_getServerSideLegend(){setTimeout(()=>this.buildLegendElementsForTools(),0)}_getAllInfos(e){let t=e?.infos;return t?t.reduce((i,s)=>i.concat(this._getAllInfos(s)),[]):[e]}_constructTileImageryStretchRendererElements(e){return R(this,null,function*(){let t=this.layer,i=t.symbolizer.rasterInfo??t.raster.rasterInfo,s,r,a=e?.statistics?.length?e.statistics:i?.statistics;if(a){let o=a[0];Ke(o)?(s=o.min,r=o.max):[s,r]=o}else{let o=Je(i.pixelType);s=o[0],r=o[1]}if(t.hasStandardTime()&&(s=t.getStandardTimeValue(s),r=t.getStandardTimeValue(r)),i.bandCount===1||t.bandIds?.length===1)return this._getStretchLegendElements(e,{min:s,max:r});let l=(t?.bandIds?.length?t.bandIds:Array.from(Array(Math.min(i.bandCount,3)).keys())).map(o=>i.bandInfos[o].name);return l.length<3?l.push(l[1]):l.length>3&&l.splice(3),this._createSymbolTableElementMultiBand(l)})}_getStretchLegendElements(e,t){return R(this,null,function*(){let i=e.colorRamp,s=jt(i,t);return{type:"stretch-ramp",title:"",infos:s,preview:G(s.map(r=>r.color),{ariaLabel:yield j("previewColorRampAriaLabel")})}})}_getClusterSymbol(){let e=this.layer,t="featureReduction"in e&&e.featureReduction,i=t&&"symbol"in t&&t.renderer;return i&&i?.authoringInfo?.isAutoGenerated!==!0?null:t&&"symbol"in t?t.symbol:null}_getSizeLegendElement(e,t,i,s){return R(this,null,function*(){return{type:"size-ramp",title:this._hasClusterSizeVariable?this._getClusterTitle(t):e,infos:yield si(i,t,yield Ze(i),this.scale,this.view,s,this._hasClusterSizeVariable?this._getClusterSymbol():null)}})}_createSymbolTableElementMultiBand(e){let t=[],i=["red","green","blue"];return e.forEach((s,r)=>{t.push({label:{colorName:i[r],bandName:s},src:Ot[r],opacity:this.opacity??1})}),t}_updateInfosForClassedSizeRenderer(e,t){let i=e.authoringInfo&&e.authoringInfo.type==="class-breaks-size",s=e.classBreakInfos.some(r=>Mt(r.symbol));if(i&&s){let r=ti,a=ii,l=e.classBreakInfos.length,o=(r-a)/(l>1?l-1:l);t.forEach((n,d)=>{n.size=r-o*d})}}_isTallSymbol(e){let t=!1,i=!1;if(e)for(let s=0;s<e.length&&(!t||!i);s++){let r=e[s];r.type==="size"&&(r.axis==="height"&&(t=!0),r.axis==="width-and-depth"&&(i=!0))}return t&&i}_getSymbolPreview(e,t,i){return R(this,null,function*(){let s=!i?.isDefault&&e.size==null&&this._hasSizeRamp?zt(Qt.size):e.size;if(this._scaleDrivenSizeVariable&&i?.applyScaleDrivenSize){let{getSize:a}=yield import("./chunk-FULTBZNO.js");s=a(this._scaleDrivenSizeVariable,null,{view:this.view.type,scale:this.scale,shape:e.symbol.type==="simple-marker"?e.symbol.style:null})}let r=!i?.isDefault&&this._hasSizeRamp||!(!this._scaleDrivenSizeVariable||!i?.applyScaleDrivenSize);return li(e.symbol,{size:s,opacity:t,scale:!1,symbolConfig:i?.symbolConfig,effectView:i?.effectList,style:"legend",cimOptions:{allowScalingUp:r,viewParams:this.isScaleDriven?{viewingMode:this.view?.type==="2d"?"map":this.view?.viewingMode,scale:this.view?.scale}:null},ariaLabel:e.label&&typeof e.label!="string"?null:yield j("previewTemplateAriaLabel",e.label)}).then(a=>(e.preview=a,e)).catch(()=>(e.preview=null,e))})}_getClusterRenderer(e){this._hasClusterSizeVariable=!1;let t="renderer"in this.layer?this.layer.renderer:null,i=e.renderer?.clone()||t?.clone(),s=ci(e,this.layerView,this.view);if(s&&i!=null&&"visualVariables"in i&&!i.visualVariables?.some(a=>a.type==="size"&&a.target!=="outline"&&!Fe.test(a.valueExpression))){if("clusterMinSize"in e&&"clusterMaxSize"in e){let{clusterMinSize:l,clusterMaxSize:o}=e;s.legendOptions=new At({showLegend:l!==o})}let a=i.visualVariables||[];i.visualVariables=a.concat([s]),this._hasClusterSizeVariable=!0}return i}_loadRenderer(e){return R(this,null,function*(){let t=[],i=e.clone(),s=yield Ze(i);if(Y(i)||we(i)){let r=(i.classBreakInfos||i.uniqueValueInfos).map(a=>this._fetchSymbol(a.symbol,s).then(l=>{a.symbol=l}).catch(()=>{a.symbol=null}));Array.prototype.push.apply(t,r)}return t.push(this._fetchSymbol(i.symbol||i.defaultSymbol,i.defaultSymbol?null:s).then(r=>{this._applySymbolToRenderer(i,r,he(i))}).catch(()=>{this._applySymbolToRenderer(i,null,he(i))})),yield Promise.allSettled(t),i})}_applySymbolToRenderer(e,t,i){i?e.symbol=t:e.defaultSymbol=t}_fetchSymbol(e,t){return R(this,null,function*(){if(!e)throw new Error;if(e.type==="web-style"){let i=this._webStyleSymbolCache;try{let s=yield this.view.type==="2d"?e.fetchCIMSymbol({cache:i}):e.fetchSymbol({cache:i});return this._getAppliedCloneSymbol(s,t)}catch{throw H.getLogger(this).warn("Fetching web-style failed!"),new Error}}return this._getAppliedCloneSymbol(e,t)})}_getAppliedCloneSymbol(e,t){if(!e||!t)return e;let i=e.clone(),s=t&&t.toRgba();return i.type.includes("3d")?this._applyColorTo3dSymbol(i,s):i.type==="cim"?Dt(i,t):i.color&&(i.color=new xe(s||i.color)),i}_applyColorTo3dSymbol(e,t){t&&e.symbolLayers.forEach(i=>{i&&(i.material||(i.material={}),i.material.color=new xe(t))})}_getVisualVariableLegendElements(e,t){return R(this,null,function*(){if(!("visualVariables"in e)||e.type==="vector-field")return null;let i=e.visualVariables??[],s=[],r=[],a=[],l=Xe(e);if(l?.sizeStops?.length===2&&(Y(e)||we(e))){let[y,b]=l.sizeStops;r.push(new Le({field:l.field??void 0,normalizationField:l.normalizationField,minSize:y.size,maxSize:b.size,minDataValue:y.value,maxDataValue:b.value}))}for(let y of i)y.type==="color"?s.push(y):y.type==="size"?r.push(y):y.type==="opacity"&&a.push(y);let o=[...s,...r,...a],n,d;if(s.length===0&&Y(e)&&e.classBreakInfos&&e.classBreakInfos.length===1){let y=e.classBreakInfos[0];n=y&&y.symbol}if(s.length===0&&he(e)&&(n=e.symbol),n)if(n.type.includes("3d")){let y=n.symbolLayers.at(0);y.type==="water"?y.color!=null&&(d=y.color):y.material?.color!=null&&(d=y.material.color)}else n.url||(d=n.color);let h=this.effectList;return(yield Promise.all(o.map(y=>R(this,null,function*(){if(!y.legendOptions||y.legendOptions.showLegend!==!1){let b=st(e)?y.field:this._getRampTitle(y,t),v=null,_=Wt(t,y,this.view.timeZone);if(y.type==="color"){let I=(yield Ye(y,null,_))??[];v={type:"color-ramp",title:b,infos:I,preview:G(I.map(z=>z.color),{effectList:h,ariaLabel:yield j("previewColorRampAriaLabel")})},this._hasColorRamp||(this._hasColorRamp=I.length>0)}else if(y.type==="size"&&y.target!=="outline")Fe.test(y.valueExpression)?this._hasClusterSizeVariable||(this._scaleDrivenSizeVariable=y):(v=yield this._getSizeLegendElement(b,y,e,_),this._hasSizeRamp||(this._hasSizeRamp=!(v.infos==null||!v.infos.length)));else if(y.type==="opacity"){let I=(yield Ye(y,d,_))??[];v={type:"opacity-ramp",title:b,infos:I,preview:G(I.map(z=>z.color),{effectList:h,ariaLabel:yield j("previewColorRampAriaLabel")})},this._hasOpacityRamp||(this._hasOpacityRamp=I.length>0)}return v?.infos?v:null}})))).filter(re)})}_getDomainName(e,t,i){if(e&&typeof e!="function"){let s="getField"in i&&i.getField?.(e),r=s&&"getFieldDomain"in i&&i.getFieldDomain?i.getFieldDomain(s.name):null;return r?.type==="coded-value"?r.getName(t):null}return null}_getClusterTitle(e){let t=this.layer,i=e.field;if("featureReduction"in t&&t.featureReduction&&t.featureReduction.type==="cluster"){let s=t.featureReduction,r="popupTemplate"in s&&s.popupTemplate,a=r&&r.fieldInfos;if(a){for(let l of a)if(l.fieldName===i)return i==="cluster_count"?l.label||{showCount:!0}:l.label}}return{showCount:!0}}_getRampTitle(e,t){let i=e.field,s=e.normalizationField,r=!1,a=!1,l=!1,o=null;i=typeof i=="function"?null:i,s=typeof s=="function"?null:s;let n=e.legendOptions?.title;if(n!=null)o=n;else if(e.valueExpressionTitle)o=e.valueExpressionTitle;else{if("renderer"in t&&t.renderer&&"authoringInfo"in t.renderer&&t.renderer.authoringInfo?.visualVariables){let d=t.renderer.authoringInfo.visualVariables;for(let h=0;h<d.length;h++){let y=d[h];if(y.type==="color"){if(y.style==="ratio"){r=!0;break}if(y.style==="percent"){a=!0;break}if(y.style==="percent-of-total"){l=!0;break}}}}o={field:i&&this._getFieldAlias(i,t),normField:s&&this._getFieldAlias(s,t),ratio:r,ratioPercent:a,ratioPercentTotal:l}}return o}_getRendererTitle(e,t){let i=e;if(i.legendOptions?.title)return i.legendOptions.title;if(i.valueExpressionTitle)return i.valueExpressionTitle;let s=i.field,r=null,a=null;if(Y(i)&&(r=i.normalizationField,a=i.normalizationType==="percent-of-total"),s=typeof s=="function"?null:s,r=typeof r=="function"?null:r,we(i)){let{field2:o,field3:n,fieldDelimiter:d}=i,h=s&&this._getFieldAlias(s,t);return o&&(h=`<${h}>${d}<${this._getFieldAlias(o,t)}>`,n&&(h=`${h}${d}<${this._getFieldAlias(n,t)}>`)),h}let l=null;return(s||r)&&(l={field:s&&this._getFieldAlias(s,t),normField:r&&this._getFieldAlias(r,t),normByPct:a}),l}_getFieldAlias(e,t){let r=("popupTemplate"in t?t.popupTemplate:null)?.fieldInfos?.find(h=>e===h.fieldName),a=null;"getField"in t&&t.getField?a=t.getField(e):"fieldsIndex"in t&&t.fieldsIndex&&(a=t.fieldsIndex.get(e));let l=null,o="featureReduction"in t&&t.featureReduction;o&&(r??="popupTemplate"in o?o.popupTemplate?.fieldInfos?.find(h=>e?.toLowerCase()===h.fieldName?.toLowerCase()):void 0,"fields"in o&&o.fields&&(l=o.fields.find(h=>h.name?.toLowerCase()===e?.toLowerCase())));let n=r||a||l,d=null;return n&&(d=r?.label||a?.alias||l?.alias||"name"in n&&n.name||"fieldName"in n&&n.fieldName||null),d}_isUnclassedRenderer(e){let t=e.visualVariables,i=!1;return Y(e)&&e.classBreakInfos&&e.classBreakInfos.length===1&&t&&(i=e.field?t.some(s=>!(!s||e.field!==s.field||(e.normalizationField||s.normalizationField)&&e.normalizationField!==s.normalizationField)):!!t.length),i}};p([g()],A.prototype,"children",void 0),p([g({readOnly:!0})],A.prototype,"effectList",null),p([g()],A.prototype,"layerView",void 0),p([g()],A.prototype,"layer",void 0),p([g()],A.prototype,"legendElements",void 0),p([g({readOnly:!0})],A.prototype,"opacity",null),p([g()],A.prototype,"parent",void 0),p([g({readOnly:!0,dependsOn:[]})],A.prototype,"ready",null),p([g()],A.prototype,"hideLayersNotInCurrentView",void 0),p([g()],A.prototype,"keepCacheOnDestroy",void 0),p([g()],A.prototype,"respectLayerDefinitionExpression",void 0),p([g()],A.prototype,"respectLayerVisibility",void 0),p([g({readOnly:!0})],A.prototype,"scale",null),p([g()],A.prototype,"sublayerIds",void 0),p([g({readOnly:!0})],A.prototype,"isScaleDriven",null),p([g()],A.prototype,"title",void 0),p([g({readOnly:!0,dependsOn:["ready"],value:0})],A.prototype,"version",null),p([g()],A.prototype,"view",void 0),A=p([O("esri.widgets.Legend.support.ActiveLayerInfo")],A);var nt=A;var ee={state:"state",view:"view",allLayerViews:"all-layer-views",legendProperties:"legend-properties"},_i=ve.ofType(nt),ji=new Set(["esri.layers.BuildingSceneLayer","esri.layers.CatalogLayer","esri.layers.CSVLayer","esri.layers.FeatureLayer","esri.layers.GeoJSONLayer","esri.layers.GeoRSSLayer","esri.layers.GroupLayer","esri.layers.HeatmapLayer","esri.layers.ImageryLayer","esri.layers.ImageryTileLayer","esri.layers.MapImageLayer","esri.layers.OGCFeatureLayer","esri.layers.OrientedImageryLayer","esri.layers.PointCloudLayer","esri.layers.StreamLayer","esri.layers.SceneLayer","esri.layers.SubtypeGroupLayer","esri.layers.TileLayer","esri.layers.VoxelLayer","esri.layers.WFSLayer","esri.layers.WMSLayer","esri.layers.WMTSLayer","esri.layers.WCSLayer","esri.layers.LinkChartLayer","esri.layers.catalog.CatalogFootprintLayer","esri.layers.catalog.CatalogDynamicGroupLayer","esri.layers.knowledgeGraph.KnowledgeGraphSublayer"]),wi="view.basemapView.baseLayerViews",Si="view.groundView.layerViews",Ci="view.basemapView.referenceLayerViews",Ji=[wi,Si,"view.layerViews",Ci],M=class extends Ee{constructor(e){super(e),this._layerViewByLayerId={},this._layerInfosByLayerViewId={},this._activeLayerInfosByLayerViewId={},this._activeLayerInfosWithNoParent=new ve,this.activeLayerInfos=new _i,this.basemapLegendVisible=!1,this.groundLegendVisible=!1,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerDefinitionExpression=!1,this.respectLayerVisibility=!0,this.layerInfos=[],this.view=null}initialize(){this.addHandles(x(()=>this.view,()=>this._viewHandles(),U),ee.view),this.addHandles(Ct(()=>this._refresh()))}destroy(){this._destroyViewActiveLayerInfos(),this.view=null}get state(){return this.view?.ready?"ready":"disabled"}_viewHandles(){this.removeHandles(ee.state),this.view&&this.addHandles(x(()=>this.state,()=>this._stateHandles(),U),ee.state)}_stateHandles(){this._resetAll(),this.state==="ready"&&this._watchPropertiesAndAllLayerViews()}_resetAll(){this.removeHandles([ee.allLayerViews,ee.legendProperties]),this._destroyViewActiveLayerInfos(),this.activeLayerInfos.removeAll()}_destroyViewActiveLayerInfos(){Object.keys(this._activeLayerInfosByLayerViewId).forEach(this._destroyViewActiveLayerInfo,this)}_destroyViewActiveLayerInfo(e){this.removeHandles(e);let t=this._activeLayerInfosByLayerViewId[e];delete this._activeLayerInfosByLayerViewId[e],t?.parent&&t.parent.children.remove(t)}_watchPropertiesAndAllLayerViews(){let{view:e}=this;if(!e)return;let{allLayerViews:t}=e;t.length&&this._refresh(),this.addHandles(t.on("change",i=>this._propertiesChangeHandle()),ee.allLayerViews),this.addHandles(x(()=>[this.layerInfos,this.basemapLegendVisible,this.groundLegendVisible],()=>this._propertiesChangeHandle()),ee.legendProperties)}_propertiesChangeHandle(){this._destroyViewActiveLayerInfos(),this._refresh()}_refresh(){this._layerInfosByLayerViewId={},this.activeLayerInfos.removeAll(),this._generateLayerViews().filter(this._filterLayerViewsByLayerInfos,this).filter(this._isLayerViewSupported,this).forEach(this._generateActiveLayerInfo,this),this._sortActiveLayerInfos(this.activeLayerInfos)}_sortActiveLayerInfos(e){let t=this.view;if(e.length<2||!t)return;let i=[];e.forEach(r=>{if(!r.parent){let a=r.layer.parent,l=a&&"uid"in a&&this._layerViewByLayerId[a.uid],o=l&&this._activeLayerInfosByLayerViewId[l.uid];o&&e.includes(o)&&(i.push(r),r.parent=o,o.children.add(r),this._sortActiveLayerInfos(o.children))}}),e.removeMany(i);let s={};t.allLayerViews.forEach((r,a)=>s[r.layer.uid]=a),e.sort((r,a)=>{let l=s[r.layer.uid]||0;return(s[a.layer.uid]||0)-l})}_generateLayerViews(){let e=[];return Ji.filter(this._filterLayerViews,this).map(t=>vt(this,t)).filter(t=>t!=null).forEach(this._collectLayerViews("layerViews",e)),e}_filterLayerViews(e){let t=!this.basemapLegendVisible&&(e===wi||e===Ci),i=!this.groundLegendVisible&&e===Si;return!t&&!i}_collectLayerViews(e,t){let i=s=>(s&&s.forEach(r=>{t.push(r),i(r[e])}),t);return i}_filterLayerViewsByLayerInfos(e){let t=this.layerInfos;return!t||!t.length||t.some(i=>this._hasLayerInfo(i,e))}_hasLayerInfo(e,t){let i=this._isLayerUIDMatching(e.layer,t.layer.uid);return i&&(this._layerInfosByLayerViewId[t.uid]=e),i}_isLayerUIDMatching(e,t){return e&&(e.uid===t||this._hasLayerUID(e.layers,t))}_hasLayerUID(e,t){return e&&e.some(i=>this._isLayerUIDMatching(i,t))}_isLayerViewSupported(e){return!!ji.has(e.layer.declaredClass)&&(this._layerViewByLayerId[e.layer.uid]=e,!0)}_generateActiveLayerInfo(e){this._isLayerActive(e)?this._buildActiveLayerInfo(e):(this.removeHandles(e.uid),this.addHandles(x(()=>[e.legendEnabled,e.layer?.legendEnabled],()=>this._layerActiveHandle(e)),e.uid))}_layerActiveHandle(e){this._isLayerActive(e)&&(this.removeHandles(e.uid),this._buildActiveLayerInfo(e))}_isLayerActive(e){return!this.respectLayerVisibility||e.legendEnabled&&e.layer?.legendEnabled}_buildActiveLayerInfo(e){let t=e.layer,i=e.uid,s=this._layerInfosByLayerViewId[i],r=this._activeLayerInfosByLayerViewId[i];if(!r){let l=s?.title!==void 0&&s.layer.uid===t.uid;r=new nt({layer:t,layerView:e,title:l?s.title:t.title,view:this.view??void 0,respectLayerDefinitionExpression:this.respectLayerDefinitionExpression,respectLayerVisibility:this.respectLayerVisibility,hideLayersNotInCurrentView:this.hideLayersNotInCurrentView,keepCacheOnDestroy:this.keepCacheOnDestroy,sublayerIds:s?.sublayerIds||[]}),this._activeLayerInfosByLayerViewId[i]=r}let a=t.parent&&"uid"in t.parent?this._layerViewByLayerId[t.parent?.uid]:null;if(r.parent=this._activeLayerInfosByLayerViewId[a?.uid],!this.hasHandles(i)){let l=[x(()=>t.title,o=>this._titleHandle(o,r)),x(()=>[t.opacity,"renderer"in t&&t.renderer,"pointSymbol"in t&&t.pointSymbol,"lineSymbol"in t&&t.lineSymbol,"polygonSymbol"in t&&t.polygonSymbol],()=>this._constructLegendElements(r)),We(()=>this.view?.stationary===!0,()=>this._scaleHandle(r),U),x(()=>e.layer?et(e.layer,e.view):null,()=>this._constructLegendElements(r)),x(()=>e.updating,()=>{e.layer!=null&&et(e.layer,e.view)!=null&&this._constructLegendElements(r)}),x(()=>"effect"in t&&t.effect,()=>this._constructLegendElements(r)),We(()=>this.view?.timeZone,()=>this._constructLegendElements(r),U)];if(this.respectLayerVisibility){let o=x(()=>e.legendEnabled,d=>this._legendEnabledHandle(d,r)),n=x(()=>t.legendEnabled,d=>this._legendEnabledHandle(d,r));l.push(o,n)}this.addHandles(l,i)}r.isScaleDriven||this._constructLegendElements(r),this._addActiveLayerInfo(r)}_titleHandle(e,t){t.title=e,this._constructLegendElements(t)}_legendEnabledHandle(e,t){e?this._addActiveLayerInfo(t):this._removeActiveLayerInfo(t)}_scaleHandle(e){(e.isScaleDriven||e.hideLayersNotInCurrentView)&&this._constructLegendElements(e)}_addActiveLayerInfo(e){let{layerView:t,layer:i}=e;if(this._isLayerActive(t)&&!this.activeLayerInfos.includes(e)){let s=e.parent;if(s)s.children.includes(e)||s.children.push(e),this._sortActiveLayerInfos(s.children);else{let r=this.layerInfos?.some(a=>a.layer.uid===i.uid);i.parent&&"uid"in i.parent&&!r?this._activeLayerInfosWithNoParent.add(e):(this.activeLayerInfos.add(e),this._sortActiveLayerInfos(this.activeLayerInfos))}if(this._activeLayerInfosWithNoParent.length){let r=[];this._activeLayerInfosWithNoParent.forEach(a=>{let l=a.layer.parent,o=l&&"uid"in l?this._layerViewByLayerId[l?.uid]:null,n=this._activeLayerInfosByLayerViewId[o?.uid];n&&(r.push(a),a.parent=n)}),r.length&&(this._activeLayerInfosWithNoParent.removeMany(r),r.forEach(a=>this._addActiveLayerInfo(a)))}}}_removeActiveLayerInfo(e){let t=e.parent;t?t.children.remove(e):this.activeLayerInfos.remove(e)}_constructLegendElements(e){let t=e.layer;"featureCollections"in t&&t.featureCollections?e.buildLegendElementsForFeatureCollections(t.featureCollections):"featureReduction"in t&&t.featureReduction&&"renderer"in t.featureReduction&&(t.featureReduction.type==="binning"||t.featureReduction.type==="cluster")&&(!this.view||t.featureReduction.maxScale<=this.view.scale)?e.buildLegendElementsForFeatureReduction(t.featureReduction):"renderer"in t&&t.renderer&&!("sublayers"in t)?e.buildLegendElementsForRenderer(t.renderer):"url"in t&&t.url&&t.type!=="catalog"?e.buildLegendElementsForTools():e.children.forEach(i=>this._constructLegendElements(i))}};p([g({type:_i})],M.prototype,"activeLayerInfos",void 0),p([g()],M.prototype,"basemapLegendVisible",void 0),p([g()],M.prototype,"groundLegendVisible",void 0),p([g()],M.prototype,"hideLayersNotInCurrentView",void 0),p([g()],M.prototype,"keepCacheOnDestroy",void 0),p([g()],M.prototype,"respectLayerDefinitionExpression",void 0),p([g()],M.prototype,"respectLayerVisibility",void 0),p([g()],M.prototype,"layerInfos",void 0),p([g({readOnly:!0})],M.prototype,"state",null),p([g()],M.prototype,"view",void 0),M=p([O("esri.widgets.Legend.LegendViewModel")],M);var Ii=M;var E="esri-legend--card",ue="esri-legend",m={activated:`${E}__carousel-indicator--activated`,base:E,stacked:`${ue}--stacked`,carouselTitle:`${E}__carousel-title`,indicator:`${E}__carousel-indicator`,intervalSeparator:`${E}__interval-separator`,imageryLayerStretchedImage:`${E}__imagery-layer-image--stretched`,imageLabel:`${E}__image-label`,layerCaption:`${E}__layer-caption`,labelElement:`${E}__label-element`,layerRow:`${E}__layer-row`,labelCell:`${E}__label-cell`,message:`${E}__message`,rampLabel:`${E}__ramp-label`,section:`${E}__section`,relationshipSection:`${E}__relationship-section`,serviceCaptionText:`${E}__service-caption-text`,serviceContent:`${E}__service-content`,service:`${E}__service`,groupLayer:`${E}__group-layer`,groupLayerChild:`${E}__group-layer-child`,symbol:`${E}__symbol`,sizeRampRow:`${E}__size-ramp-row`,symbolRow:`${E}__symbol-row`,symbolCell:`${E}__symbol-cell`,indicatorContainer:`${E}__carousel-indicator-container`,intervalSeparatorsContainer:`${E}__interval-separators-container`,relationshipLabelContainer:`${E}__relationship-label-container`,labelContainer:`${E}__label-container`,serviceCaptionContainer:`${E}__service-caption-container`,symbolContainer:`${E}__symbol-container`,sizeRampContainer:`${E}__size-ramp-container`,sizeRampPreview:`${E}__size-ramp-preview`,pieChartRampPreview:`${E}__pie-chart-ramp-preview`,rampContainer:`${ue}__ramps`,sizeRampHorizontal:`${ue}__size-ramp--horizontal`,rampLabelsContainer:`${ue}__ramp-labels`,layerInfo:`${ue}__layer-cell ${ue}__layer-cell--info`,univariateAboveAndBelowColorRamp:"esri-univariate-above-and-below-ramp__color--card"};var Qi=Vt(),Ri=10,ot=20,Te=10,ct=20,dt={univariateAboveAndBelowSymbol:"esri-univariate-above-and-below-ramp__symbol",colorRamp:"esri-legend__color-ramp"};function Zi(e="vertical"){let t="stroke:rgb(200, 200, 200);stroke-width:1";return e==="vertical"?c("svg",{height:"4",width:"10"},c("line",{style:t,x1:"0",x2:"10",y1:"2",y2:"2"})):c("svg",{height:"10",width:"10"},c("line",{style:t,x1:"5",x2:"5",y1:"0",y2:"10"}))}function Ki(e,t="vertical"){let i=document.createElement("div");return i.style.height=`${ot}px`,i.className=dt.univariateAboveAndBelowSymbol,e!=null&&(i.style.opacity=e.toString()),Qi.append(i,Zi.bind(null,t)),i}function Ei(e,t,i="vertical",s){e.infos.forEach((r,a)=>{if(s&&a===2)r.preview=Ki(t,i);else{let l=W(r.size)+(i==="horizontal"?ct:Te),o=r.preview,n=o?.tagName.toLowerCase()==="div",d=n?o:document.createElement("div");d.className=dt.univariateAboveAndBelowSymbol,i==="horizontal"?d.style.width=`${l}px`:d.style.height=`${l}px`,!n&&o&&d.appendChild(o),r.preview=d}})}function pe(e,t="classic"){let i=e.infos;return t==="classic"?(W(i[0].size)+Te)/2:(W(i[0].size)-W(i[i.length-1].size))/2}function Q(e,t){if(!e)return null;let i=e.infos.map(r=>r.color),s=G(t.type==="full"?i:t.type==="above"?i.slice(0,3):i.slice(2,5),{width:t.width,height:t.height,align:t.rampAlignment,effectList:t.effectList,ariaLabel:t.ariaLabel});return s.className=dt.colorRamp,t.opacity!=null&&(s.style.opacity=t.opacity.toString()),s}function De(e,t,i,s="vertical"){let r=0,a=e.infos,l=Math.floor(a.length/2),o=t==="full"||t==="above"?0:l,n=t==="full"||t==="below"?a.length-1:l;for(let d=o;d<=n;d++)i&&d===l?r+=s==="horizontal"?Ri:ot:r+=W(a[d].size)+(s==="horizontal"?ct:Te);return Math.round(r)}function Z(e,t,i,s="vertical"){let r=De(e,t,i,s),a=e.infos,l=Math.floor(a.length/2),o=t==="full"||t==="above"?0:l,n=t==="full"||t==="below"?a.length-1:l,d=t==="full"?a[o].size+a[n].size:t==="above"?a[o].size:a[n].size,h=i?s==="vertical"?ot:Ri:0,y=s==="vertical"?Te*(t==="full"?2:1):ct*(t==="full"?2:1);return Math.round(r-(W(d)/2+h/2+y/2))}function Me(e,t,i="vertical"){let s=e.infos,r=s.find(({type:l})=>l==="size-ramp"),a=s.find(({type:l})=>l==="color-ramp");return r&&(r=N({},r),r.infos=[...r.infos],Ei(r,t,i,!0)),a&&(a=N({},a),a.infos=[...a.infos]),i==="horizontal"&&(r?.infos.reverse(),a?.infos.reverse()),{sizeRampElement:r,colorRampElement:a}}function ke(e,t="vertical"){let i=e.infos,s=i.find(({type:a})=>a==="size-ramp"),r=i.find(({type:a})=>a==="color-ramp");return s&&(s=N({},s),s.infos=[...s.infos],Ei(s,null,t,!1)),r&&(r=N({},r),r.infos=[...r.infos]),t==="horizontal"&&(s?.infos.reverse(),r?.infos.reverse()),{sizeRampElement:s,colorRampElement:r}}function Xi(e,t){return t}function T(e){let t=this;e.appendChild(t)}function q(e,t,i){if(!t)return;if(typeof t=="number")return t;if(typeof t=="string")return bt(t);if("value"in t||"unit"in t)return K(e.dotValue,t);if("colorName"in t&&"bandName"in t)return e[t.colorName]+": "+(e[t.bandName]||t.bandName);if("showCount"in t)return t.showCount?e.clusterCountTitle:void 0;let s=null;return Xi(t,i)?s=t.ratioPercentTotal?"showRatioPercentTotal":t.ratioPercent?"showRatioPercent":t.ratio?"showRatio":t.normField?"showNormField":t.field?"showField":null:yt(t,i)&&(s=t.normField?"showNormField":t.normByPct?"showNormPct":t.field?"showField":null),s?K(s==="showField"?"{field}":e[s],{field:t.field,normField:t.normField}):void 0}function yt(e,t){return!t}function Ne(e,t){return!!(t&&t==="Stretched"&&e.version>=10.3&&e.declaredClass==="esri.layers.ImageryLayer")}function Pe(e,t){return e.label?t[e.label]+": "+(typeof e.value=="string"?e.value:Ve(e.value??0,{style:"decimal",notation:e.value?.toString().toLowerCase().includes("e")?"scientific":"standard"})):""}var Yi=25,es=25,ts=768,is=100,ss="#ddd",me=window.devicePixelRatio;function rs(e){if(e){if(e.type.includes("3d")){let t=e.symbolLayers?.length;if(!t)return;let i=e.symbolLayers.at(t-1),s=i.resource?.primitive;return s==="circle"||s==="cross"||s==="kite"||s==="sphere"||s==="cube"||s==="diamond"}{let t=e.style;return t==="circle"||t==="diamond"||t==="cross"}}}function as(e){if(e){if(e.type.includes("3d")){let t=e.symbolLayers?.length;if(!t)return;let i=e.symbolLayers.at(t-1).get("resource.primitive");return i==="triangle"||i==="cone"||i==="tetrahedron"}return e.style==="triangle"}}var P=class extends ne{constructor(e,t){super(e,t),this._hasIndicators=!1,this._selectedSectionName=null,this._sectionNames=[],this._sectionMap=new Map,this.activeLayerInfos=null,this.headingLevel=3,this.layout="stack",this.messages=null,this.messagesCommon=null,this.type="card",this.view=null}initialize(){this.addHandles(x(()=>this.activeLayerInfos,e=>{this.removeAllHandles(),this._watchForSectionChanges(e)}))}render(){let{view:e}=this;this._hasIndicators=this.layout==="auto"&&e&&e.container.clientWidth<=ts||this.layout==="stack";let t=this.activeLayerInfos,i=t?.toArray().map(n=>this._renderLegendForLayer(n)).filter(n=>!!n);this._hasIndicators?this._selectedSectionName&&this._sectionNames.includes(this._selectedSectionName)||(this._selectedSectionName=this._sectionNames&&this._sectionNames[0]):this._selectedSectionName=null;let s=this._sectionNames.length,r=this._sectionNames.map((n,d)=>{let h=K(this.messagesCommon.pagination.pageText,{index:d+1,total:s});return c("div",{"aria-controls":`${n}-panel`,"aria-label":h,"aria-selected":(this._selectedSectionName===n).toString(),bind:this,class:this.classes(m.indicator,{[m.activated]:this._selectedSectionName===n}),"data-section-name":n,id:n,key:n,onclick:this._selectSection,onkeydown:this._focusSection,role:"tab",tabIndex:this._selectedSectionName===n?0:-1,title:h})}),a=this._hasIndicators&&s>1?c("div",{class:m.indicatorContainer,key:"carousel-navigation",role:"tablist"},r):null,l=this._hasIndicators?this._sectionMap.get(this._selectedSectionName):i?.length?i:null,o={[m.stacked]:this._hasIndicators};return c("div",{class:this.classes(m.base,o)},l||c("div",{class:m.message},this.messages.noLegend),a)}_selectSection(e){let t=e.target.getAttribute("data-section-name");t&&(this._selectedSectionName=t)}_focusSection(e){switch(e.key){case"ArrowLeft":case"ArrowRight":this._switchSectionOnArrowPress(e);break;case"Enter":case" ":this._selectSection(e)}}_switchSectionOnArrowPress(e){let t=e.key,i=t==="ArrowLeft"?-1:1,s=e.target.getAttribute("data-section-name"),r=this._sectionNames.indexOf(s),a=this._sectionNames,l=null;r!==-1&&(a[r+i]?l=document.getElementById(a[r+i]):t==="ArrowLeft"?l=document.getElementById(a[a.length-1]):t==="ArrowRight"&&(l=document.getElementById(a[0])),l?.focus())}_watchForSectionChanges(e){if(this._generateSectionNames(),e){e.forEach(i=>{let s=`activeLayerInfo-${i.layer.uid}-version-change`;this.removeHandles(s),this._watchForSectionChanges(i.children),this.addHandles(x(()=>i.version,()=>this._generateSectionNames()),s)});let t="activeLayerInfos-collection-change";this.removeHandles(t),this.addHandles(e.on("change",()=>this._watchForSectionChanges(e)),t)}}_generateSectionNames(){this._sectionNames.length=0,this._selectedSectionName=null,this.activeLayerInfos&&this.activeLayerInfos.forEach(this._generateSectionNamesForActiveLayerInfo,this)}_getSectionName(e,t,i){return`${this.id}${e.uid}-type-${t.type}-${i}`}_generateSectionNamesForActiveLayerInfo(e){e.children.forEach(this._generateSectionNamesForActiveLayerInfo,this),e.legendElements&&e.legendElements.forEach((t,i)=>{this._sectionNames.push(this._getSectionName(e.layer,t,i))})}_renderLegendForLayer(e){if(!e.ready)return null;if(e.children.length){let t=e.children.map(i=>this._renderLegendForLayer(i)).toArray();return c("div",{class:this.classes(m.service,m.groupLayer),key:e.layer.uid},c("div",{class:m.serviceCaptionContainer},e.title),t)}{let t=e.legendElements;if(t&&!t.length)return null;let i=t.some(a=>a.type==="relationship-ramp"),s=t.map((a,l)=>this._renderLegendForElement(a,e,l,i)).filter(a=>!!a);if(!s.length)return null;let r={[m.groupLayerChild]:!!e.parent};return c("div",{class:this.classes(m.service,r),key:e.layer.uid},c("div",{class:m.serviceCaptionContainer},c("div",{class:m.serviceCaptionText},e.title)),c("div",{class:m.serviceContent},s))}}_renderLegendForElement(e,t,i,s=!1,r=!1){let a=e.type==="color-ramp",l=e.type==="opacity-ramp",o=t.layer,n=null;if(typeof e.title=="string")n=e.title;else if(e.title){let _=e.title,I=q(this.messages,_,a||l);n=_.title?`${_.title} (${I})`:I}let d=this._getSectionName(o,e,i),h=this._hasIndicators&&!r?c("div",null,c(ce,{class:m.carouselTitle,level:this.headingLevel},t.title),c(ce,{class:m.layerCaption,level:Nt(this.headingLevel)},n)):n?c(ce,{class:m.layerCaption,level:this.headingLevel},n):null,y=t.effectList,b=null;switch(e.type){case"symbol-table":{let _=e.infos.map((I,z)=>this._renderLegendForElementInfo(I,t,e.legendType,z)).filter(I=>!!I);if(_.length){let I=_[0].properties.classes?.[m.symbolRow],z={[m.labelContainer]:!I&&!s,[m.relationshipLabelContainer]:s};b=c("div",{class:this.classes(z)},_)}break}case"color-ramp":case"opacity-ramp":case"heatmap-ramp":case"stretch-ramp":b=this._renderLegendForRamp(e,o.opacity,y);break;case"size-ramp":b=this._renderSizeRamp(e,o.opacity);break;case"pie-chart-ramp":b=this._renderPieChartRamp(e);break;case"relationship-ramp":b=ze(e,this.id,{opacity:o.opacity,effectList:y,ariaLabel:this.messages.previewRelationshipRampAriaLabel});break;case"univariate-above-and-below-ramp":b=this._renderUnivariateAboveAndBelowRamp(e,o.opacity,y);break;case"univariate-color-size-ramp":b=this._renderUnivariateColorSizeRamp(e,o.opacity,y)}if(!b)return null;let v=c("div",{"aria-labelledby":d,class:m.section,id:`${d}-panel`,key:d,role:"tabpanel",tabIndex:0},[h,b]);return r||this._sectionMap.set(d,v),v}_renderPieChartRamp(e){return c("div",{afterCreate:T,bind:e.preview,class:m.pieChartRampPreview})}_renderUnivariateAboveAndBelowRamp(e,t,i){let{sizeRampElement:s,colorRampElement:r}=Me(e,t,"horizontal");if(!s)return null;let a=De(s,"full",!0,"horizontal"),l=Z(s,"above",!0,"horizontal"),o=Z(s,"below",!0,"horizontal"),n=12,d=this.messages?.previewColorRampAriaLabel,h=Q(r,{width:l,height:n,rampAlignment:"horizontal",opacity:t,type:"above",effectList:i,ariaLabel:d}),y=Q(r,{width:o,height:n,rampAlignment:"horizontal",opacity:t,type:"below",effectList:i,ariaLabel:d}),b=pe(s,"card"),v=s.infos.map(C=>C.label),_=v.length-1,I=v.map((C,S)=>S===0||S===_?c("div",{key:S},C):null),z={display:"flex",flexDirection:"column"},u={display:"flex",flexDirection:"row"},f={marginTop:"3px",display:"flex"};qe(this.container)?f.marginRight=`${b}px`:f.marginLeft=`${b}px`;let w={width:`${a}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return c("div",{class:m.layerRow,key:"size-ramp-preview",styles:z},c("div",{class:this.classes(m.symbolContainer,m.sizeRampHorizontal),styles:u},s.infos.map((C,S)=>c("div",{afterCreate:T,bind:C.preview,class:m.symbol,key:S}))),h?c("div",{class:m.univariateAboveAndBelowColorRamp,key:"color-ramp-preview",styles:f},c("div",{afterCreate:T,bind:h}),c("div",{afterCreate:T,bind:y})):null,c("div",{class:m.layerInfo},c("div",{class:m.rampLabelsContainer,styles:w},I)))}_renderUnivariateColorSizeRamp(e,t,i){let{sizeRampElement:s,colorRampElement:r}=ke(e,"horizontal");if(!s)return null;let a=De(s,"full",!1,"horizontal"),l=Z(s,"full",!1,"horizontal"),o=Q(r,{width:l,height:12,rampAlignment:"horizontal",opacity:t,type:"full",effectList:i,ariaLabel:this.messages?.previewColorRampAriaLabel}),n=pe(s,"card"),d=s.infos.length-1,h=s.infos.map((I,z)=>z===0||z===d?c("div",{key:z},I.label):null),y={display:"flex",flexDirection:"column"},b={display:"flex",flexDirection:"row"},v={marginTop:"3px",display:"flex"};qe(this.container)?v.marginRight=`${n}px`:v.marginLeft=`${n}px`;let _={width:`${a}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return c("div",{class:m.layerRow,key:"size-ramp-preview",styles:y},c("div",{class:this.classes(m.symbolContainer,m.sizeRampHorizontal),styles:b},s.infos.map((I,z)=>c("div",{afterCreate:T,bind:I.preview,class:m.symbol,key:z}))),c("div",{class:m.univariateAboveAndBelowColorRamp,key:"color-ramp-preview",styles:v},c("div",{afterCreate:T,bind:o})),c("div",{class:m.layerInfo},c("div",{class:m.rampLabelsContainer,styles:_},h)))}_renderLegendForElementInfo(e,t,i,s){let r=t.layer;if(e.type)return this._renderLegendForElement(e,t,s,!1,!0);let a=Ne(r,i),l=q(this.messages,e.label,!1)??"";if(e.preview){if(!e.symbol?.type.includes("simple-fill")){if(!e.label)return c("div",{afterCreate:T,bind:e.preview,key:s});let C={[m.symbolCell]:this._hasIndicators};return c("div",{class:this.classes(m.layerRow,{[m.symbolRow]:this._hasIndicators}),key:s},c("div",{afterCreate:T,bind:e.preview,class:this.classes(C)}),c("div",{class:this.classes(m.imageLabel,{[m.labelCell]:this._hasIndicators})},l))}let o=255,n=255,d=255,h=0,y=255,b=255,v=255,_=0,I=e.symbol.color?.a,z=e.symbol.outline?.color?.a;I&&(o=e.symbol.color.r,n=e.symbol.color.g,d=e.symbol.color.b,h=e.symbol.color.a*r.opacity),z&&(y=e.symbol.outline.color.r,b=e.symbol.outline.color.g,v=e.symbol.outline.color.b,_=e.symbol.outline.color.a*r.opacity);let u=e.symbol.color?.isBright??!0,f=u?"rgba(255, 255, 255, .6)":"rgba(0, 0, 0, .6)",w={background:I?`rgba(${o}, ${n}, ${d}, ${h})`:"none",color:u?"black":"white",textShadow:`-1px -1px 0 ${f},
                                              1px -1px 0 ${f},
                                              -1px 1px 0 ${f},
                                              1px 1px 0 ${f}`,border:z?`1px solid rgba(${y}, ${b}, ${v}, ${_})`:"none",filter:Qe(t.effectList)??void 0};return c("div",{class:m.layerRow,key:s},c("div",{class:m.labelElement,styles:w},l))}if(e.src){let o=this._renderImage(e,r,a);return c("div",{class:m.layerRow,key:s},o,c("div",{class:m.imageLabel},l))}}_renderImage(e,t,i){let{label:s,src:r,opacity:a}=e,l={[m.imageryLayerStretchedImage]:i,[m.symbol]:!i},o={opacity:`${a??t.opacity}`};return c("img",{alt:q(this.messages,s,!1),"aria-label":q(this.messages,s,!1),border:0,class:this.classes(l),height:e.height,src:r,styles:o,width:e.width})}_renderSizeRampLines(e){let t=e.infos,i=t[0],s=t[t.length-1],r=i.symbol,a=this._hasIndicators,l=W(i.size+i.outlineSize)*me,o=W(s.size+s.outlineSize)*me,n=a?l:l+50*me,d=a?l/2+50*me:l,h=as(r),y=rs(r),b=document.createElement("canvas");b.width=n,b.height=d,b.style.width=b.width/me+"px",b.style.height=b.height/me+"px";let v=b.getContext("2d");if(a){v.beginPath();let _=0,I=0,z=n/2-o/2,u=d;v.moveTo(_,I),v.lineTo(z,u);let f=n,w=0,C=n/2+o/2,S=d;v.moveTo(f,w),v.lineTo(C,S)}else{v.beginPath();let _=0,I=d/2-o/2,z=n;v.moveTo(_,I),v.lineTo(z,0);let f=0,w=d/2+o/2,C=n,S=d;v.moveTo(f,w),v.lineTo(C,S)}return v.strokeStyle=ss,v.stroke(),c("div",{afterCreate:T,bind:b,styles:a?{display:"flex",marginTop:`-${h?0:y?l/2:0}px`,marginBottom:`-${h?o:y?o/2:0}px`}:{display:"flex",marginRight:`-${h?0:y?l/2:0}px`,marginLeft:`-${h?0:y?o/2:0}px`}})}_renderSizeRamp(e,t){let i=e.infos,s=i[0].label,r=i[i.length-1].label,a=i[0].preview,l=i[i.length-1].preview,o=this._hasIndicators,n={"flex-direction":o?"column":"row-reverse"};a&&(a=a.cloneNode(!0),a.style.display="flex"),l&&(l=l.cloneNode(!0),l.style.display="flex");let d={opacity:t!=null?`${t}`:""};return c("div",{class:this.classes(m.layerRow,{[m.sizeRampRow]:o})},c("div",{class:m.rampLabel},o?s:r),c("div",{class:m.sizeRampContainer,styles:n},c("div",{afterCreate:T,bind:a,class:m.sizeRampPreview,styles:d}),this._renderSizeRampLines(e),c("div",{afterCreate:T,bind:l,class:m.sizeRampContainer,styles:d})),c("div",{class:m.rampLabel},o?r:s))}_getRampStopLabel(e,t){switch(t){case"heatmap-ramp":return this.messages[e.label];case"stretch-ramp":return Pe(e,this.messages);default:return e.label}}_renderLegendForRamp(e,t,i){let s=e.infos,r=e.type,a=r==="heatmap-ramp",l=s.length-1,o=es,n=l>2&&!a?Yi*l:is,d=n+20,h=10,y=s.slice(0).reverse(),b=y.length-1,v=y.length%2!=0?y[y.length/2|0]:null,_=v&&c("div",{class:m.intervalSeparatorsContainer},c("div",{class:m.intervalSeparator},"|"),c("div",{class:m.rampLabel},this._getRampStopLabel(v,r))),I=[[{shape:{type:"path",path:`M0 ${o/2} L${h} 0 L${h} ${o} Z`},fill:y[0].color,stroke:{width:0}},{shape:{type:"rect",x:h,y:0,width:n,height:o},fill:{type:"linear",x1:h,y1:0,x2:n+h,y2:0,colors:y.map((w,C)=>({color:w.color,offset:a&&"ratio"in w?w.ratio:C/l}))},stroke:{width:0}},{shape:{type:"path",path:`M${n+h} 0 L${d} ${o/2} L${n+h} ${o} Z`},fill:y[b].color,stroke:{width:0}}]],z=Zt(I,d,o),u={filter:Qe(i)??void 0,opacity:t==null?void 0:`${t}`},f={justifyContent:"center"};return c("div",{class:m.layerRow,styles:f},c("div",{class:m.rampLabel},this._getRampStopLabel(y[0],r)),c("div",{class:m.symbolContainer},c("div",{styles:u},z),_),c("div",{class:m.rampLabel},this._getRampStopLabel(y[b],r)))}};p([g()],P.prototype,"activeLayerInfos",void 0),p([g()],P.prototype,"headingLevel",void 0),p([g()],P.prototype,"layout",void 0),p([g(),X("esri/widgets/Legend/t9n/Legend")],P.prototype,"messages",void 0),p([g(),X("esri/t9n/common")],P.prototype,"messagesCommon",void 0),p([g({readOnly:!0})],P.prototype,"type",void 0),p([g()],P.prototype,"view",void 0),p([Pt()],P.prototype,"_selectSection",null),P=p([O("esri.widgets.Legend.styles.Card")],P);var Be=P;var V="esri-legend",L={service:`${V}__service`,label:`${V}__service-label`,layer:`${V}__layer`,groupLayer:`${V}__group-layer`,groupLayerChild:`${V}__group-layer-child`,layerTable:`${V}__layer-table`,layerTableSizeRamp:`${V}__layer-table--size-ramp`,layerChildTable:`${V}__layer-child-table`,layerCaption:`${V}__layer-caption`,layerBody:`${V}__layer-body`,layerRow:`${V}__layer-row`,layerCell:`${V}__layer-cell`,layerInfo:`${V}__layer-cell ${V}__layer-cell--info`,imageryLayerStretchedImage:`${V}__imagery-layer-image--stretched`,imageryLayerCellStretched:`${V}__imagery-layer-cell--stretched`,imageryLayerInfoStretched:`${V}__imagery-layer-info--stretched`,symbolContainer:`${V}__layer-cell ${V}__layer-cell--symbols`,symbol:`${V}__symbol`,rampContainer:`${V}__ramps`,sizeRamp:`${V}__size-ramp`,colorRamp:`${V}__color-ramp`,opacityRamp:`${V}__opacity-ramp`,borderlessRamp:`${V}__borderless-ramp`,rampTick:`${V}__ramp-tick`,rampFirstTick:`${V}__ramp-tick-first`,rampLastTick:`${V}__ramp-tick-last`,rampLabelsContainer:`${V}__ramp-labels`,rampLabel:`${V}__ramp-label`,message:`${V}__message`,univariateAboveAndBelowLabel:"esri-univariate-above-and-below-ramp__label"};var ls=`${V}__`,ns=24,Vi={display:"flex",alignItems:"flex-start"},ht={marginLeft:"3px"},fe={display:"table-cell",verticalAlign:"middle"},te=class extends ne{constructor(e,t){super(e,t),this.activeLayerInfos=null,this.headingLevel=3,this.messages=null,this.type="classic"}render(){let e=this.activeLayerInfos,t=e?.toArray().map(i=>this._renderLegendForLayer(i)).filter(i=>!!i);return c("div",null,t?.length?t:c("div",{class:L.message},this.messages.noLegend))}_renderLegendForLayer(e){if(!e.ready)return null;let t=!!e.children.length,i=`${ls}${e.layer.uid}-version-${e.version}`,s=e.title?ce({level:this.headingLevel,class:this.classes(_e.heading,L.label)},e.title):null;if(t){let r=e.children.map(a=>this._renderLegendForLayer(a)).toArray();return c("div",{class:this.classes(L.service,L.groupLayer),key:i},s,r)}{let r=e.legendElements;if(r&&!r.length)return null;let a=r.map(o=>this._renderLegendForElement(o,e.layer,e.effectList)).filter(o=>!!o);if(!a.length)return null;let l={[L.groupLayerChild]:!!e.parent};return c("div",{class:this.classes(L.service,l),key:i},s,c("div",{class:L.layer},a))}}_renderLegendForElement(e,t,i,s){let r=e.type==="color-ramp",a=e.type==="opacity-ramp",l=e.type==="size-ramp",o=null;if(e.type==="symbol-table"||l){let v=e.infos.map(_=>this._renderLegendForElementInfo(_,t,i,l,e.legendType)).filter(_=>!!_);v.length&&(o=c("div",{class:L.layerBody},v))}else e.type==="color-ramp"||e.type==="opacity-ramp"||e.type==="heatmap-ramp"||e.type==="stretch-ramp"?o=this._renderLegendForRamp(e,t.opacity):e.type==="relationship-ramp"?o=ze(e,this.id,{opacity:t.opacity,effectList:i,ariaLabel:this.messages.previewRelationshipRampAriaLabel}):e.type==="pie-chart-ramp"?o=this._renderPieChartRamp(e):e.type==="univariate-above-and-below-ramp"?o=this._renderUnivariateAboveAndBelowRamp(e,t.opacity,i):e.type==="univariate-color-size-ramp"&&(o=this._renderUnivariateColorSizeRamp(e,t.opacity,i));if(!o)return null;let n=e.title,d=null;if(typeof n=="string")d=n;else if(n){let v=q(this.messages,n,r||a);d=yt(n,r||a)&&n.title?`${n.title} (${v})`:v}let h=s?L.layerChildTable:L.layerTable,y=d?c("div",{class:L.layerCaption},d):null,b={[L.layerTableSizeRamp]:l||!s};return c("div",{class:this.classes(h,b)},y,o)}_renderPieChartRamp(e){return c("div",{afterCreate:T,bind:e.preview})}_renderUnivariateAboveAndBelowRamp(e,t,i){let{sizeRampElement:s,colorRampElement:r}=Me(e,t);if(!s)return null;let a=this.messages?.previewColorRampAriaLabel,l=Z(s,"above",!0),o=Z(s,"below",!0),n=12,d=Q(r,{width:n,height:l,rampAlignment:"vertical",opacity:t,type:"above",effectList:i,ariaLabel:a}),h=Q(r,{width:n,height:o,rampAlignment:"vertical",opacity:t,type:"below",effectList:i,ariaLabel:a}),y=pe(s),b=s.infos.map(S=>S.label),v=b.map((S,F)=>F===0?c("div",{class:S?d?L.univariateAboveAndBelowLabel:L.rampLabel:void 0,key:F},S):F===2?c("div",null):null),_=b.length-1,I=Math.floor(b.length/2),z=b.map((S,F)=>F===I||F===_?c("div",{class:S?d?L.univariateAboveAndBelowLabel:L.rampLabel:void 0,key:F},S):null),u={display:"table-cell",verticalAlign:"middle"},f={marginTop:`${y}px`},w={height:`${l}px`},C={height:`${o}px`};return c("div",{key:"univariate-above-and-below-ramp-preview",styles:Vi},c("div",{class:L.layerBody},s.infos.map((S,F)=>c("div",{class:this.classes(L.layerRow,L.sizeRamp)},c("div",{afterCreate:T,bind:S.preview,class:L.symbol,styles:u}),d||F%2!=0?null:c("div",{class:L.layerInfo},b[F])))),d?c("div",{key:"color-ramp-preview",styles:f},c("div",{styles:ht},c("div",{styles:fe},c("div",{afterCreate:T,bind:d,class:L.rampContainer})),c("div",{styles:fe},c("div",{class:L.rampLabelsContainer,styles:w},v))),c("div",{styles:ht},c("div",{styles:fe},c("div",{afterCreate:T,bind:h,class:L.rampContainer})),c("div",{styles:fe},c("div",{class:L.rampLabelsContainer,styles:C},z)))):null)}_renderUnivariateColorSizeRamp(e,t,i){let{sizeRampElement:s,colorRampElement:r}=ke(e);if(!s)return null;let a=pe(s),l=12,o=Z(s,"full",!1),n=Q(r,{width:l,height:o,rampAlignment:"vertical",opacity:t,type:"full",effectList:i,ariaLabel:this.messages?.previewColorRampAriaLabel}),d=s.infos.length-1,h=s.infos.map((_,I)=>I===0||I===d?c("div",{class:_.label?r?L.univariateAboveAndBelowLabel:L.rampLabel:void 0,key:I},_.label):null),y={display:"table-cell",verticalAlign:"middle"},b={marginTop:`${a}px`},v={height:`${o}px`};return c("div",{key:"univariate-above-and-below-ramp-preview",styles:Vi},c("div",{class:L.layerBody},s.infos.map(_=>c("div",{class:this.classes(L.layerRow,L.sizeRamp)},c("div",{afterCreate:T,bind:_.preview,class:L.symbol,styles:y})))),c("div",{key:"color-ramp-preview",styles:b},c("div",{styles:ht},c("div",{styles:fe},c("div",{afterCreate:T,bind:n,class:L.rampContainer})),c("div",{styles:fe},c("div",{class:L.rampLabelsContainer,styles:v},h)))))}_renderLegendForRamp(e,t){let i=e.infos,s=e.type==="opacity-ramp",r=e.type==="heatmap-ramp",a=e.type==="stretch-ramp",l=e.preview,o=s?L.opacityRamp:"";l.className=`${L.colorRamp} ${o}`,t!=null&&(l.style.opacity=t.toString());let n=i.map(y=>c("div",{class:y.label?L.rampLabel:void 0},r?this.messages[y.label]||y.label:a?Pe(y,this.messages):y.label)),d={width:`${ns}px`},h={height:l.style.height};return c("div",{class:L.layerRow},c("div",{class:L.symbolContainer,styles:d},c("div",{afterCreate:T,bind:l,class:L.rampContainer})),c("div",{class:L.layerInfo},c("div",{class:L.rampLabelsContainer,styles:h},n)))}_renderLegendForElementInfo(e,t,i,s,r){if(e.type)return this._renderLegendForElement(e,t,i,!0);let a=null,l=Ne(t,r);if(e.preview?a=c("div",{afterCreate:T,bind:e.preview,class:L.symbol}):e.src&&(a=this._renderImage(e,t,l)),!a)return null;let o={[L.imageryLayerInfoStretched]:l},n={[L.imageryLayerInfoStretched]:l,[L.sizeRamp]:!l&&s};return c("div",{class:L.layerRow},c("div",{class:this.classes(L.symbolContainer,n)},a),c("div",{class:this.classes(L.layerInfo,o)},q(this.messages,e.label,!1)||""))}_renderImage(e,t,i){let{label:s,src:r,opacity:a}=e,l={[L.imageryLayerStretchedImage]:i,[L.symbol]:!i},o={opacity:`${a??t.opacity}`};return c("img",{alt:q(this.messages,s,!1),"aria-label":q(this.messages,s,!1),border:0,class:this.classes(l),height:e.height,src:r,styles:o,width:e.width})}};p([g()],te.prototype,"activeLayerInfos",void 0),p([g()],te.prototype,"headingLevel",void 0),p([g(),X("esri/widgets/Legend/t9n/Legend")],te.prototype,"messages",void 0),p([g({readOnly:!0})],te.prototype,"type",void 0),te=p([O("esri.widgets.Legend.styles.Classic")],te);var ie=te;var os={base:"esri-legend"},D=class extends ne{constructor(e,t){super(e,t),this.headingLevel=3,this.messages=null,this.style=new ie,this.viewModel=new Ii}initialize(){this.addHandles([le(()=>this.view,"resize",()=>this.scheduleRender()),le(()=>this.activeLayerInfos,"change",()=>this._refreshActiveLayerInfos(this.activeLayerInfos)),x(()=>this.headingLevel,e=>{let{style:t}=this;t&&(t.headingLevel=e)}),x(()=>this.style,(e,t)=>{t&&e!==t&&t.destroy(),e&&(e.activeLayerInfos=this.activeLayerInfos,e.type==="card"&&(e.view=this.view),e.headingLevel=this.headingLevel)},U)])}get activeLayerInfos(){return this.viewModel.activeLayerInfos}set activeLayerInfos(e){this.viewModel.activeLayerInfos=e}get basemapLegendVisible(){return this.viewModel.basemapLegendVisible}set basemapLegendVisible(e){this.viewModel.basemapLegendVisible=e}get groundLegendVisible(){return this.viewModel.groundLegendVisible}set groundLegendVisible(e){this.viewModel.groundLegendVisible=e}get hideLayersNotInCurrentView(){return this.viewModel.hideLayersNotInCurrentView}set hideLayersNotInCurrentView(e){this.viewModel.hideLayersNotInCurrentView=e}get keepCacheOnDestroy(){return this.viewModel.keepCacheOnDestroy}set keepCacheOnDestroy(e){this.viewModel.keepCacheOnDestroy=e}get respectLayerDefinitionExpression(){return this.viewModel.respectLayerDefinitionExpression}set respectLayerDefinitionExpression(e){this.viewModel.respectLayerDefinitionExpression=e}get respectLayerVisibility(){return this.viewModel.respectLayerVisibility}set respectLayerVisibility(e){this.viewModel.respectLayerVisibility=e}get icon(){return"legend"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get layerInfos(){return this.viewModel.layerInfos}set layerInfos(e){this.viewModel.layerInfos=e}castStyle(e){if(e instanceof Be||e instanceof ie)return e;if(typeof e=="string")return e==="card"?new Be:new ie;if(e&&typeof e.type=="string"){let t=N({},e);return delete t.type,new(e.type==="card"?Be:ie)(t)}return new ie}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){return c("div",{class:this.classes(os.base,_e.widget,this.style instanceof ie?_e.panel:null)},this.style.render())}_refreshActiveLayerInfos(e){e.forEach(t=>{this.removeHandles(`version_${t.layer.uid}`),this._renderOnActiveLayerInfoChange(t)}),this.scheduleRender()}_renderOnActiveLayerInfoChange(e){let t=x(()=>e.version,()=>this.scheduleRender());this.addHandles(t,`version_${e.layer.uid}`);let i=le(()=>e.children,"change",()=>e.children.forEach(s=>this._renderOnActiveLayerInfoChange(s)),U);this.addHandles(i,`version_${e.layer.uid}`),e.children.forEach(s=>this._renderOnActiveLayerInfoChange(s))}};p([g()],D.prototype,"activeLayerInfos",null),p([g()],D.prototype,"basemapLegendVisible",null),p([g()],D.prototype,"groundLegendVisible",null),p([g()],D.prototype,"headingLevel",void 0),p([g()],D.prototype,"hideLayersNotInCurrentView",null),p([g()],D.prototype,"keepCacheOnDestroy",null),p([g()],D.prototype,"respectLayerDefinitionExpression",null),p([g()],D.prototype,"respectLayerVisibility",null),p([g()],D.prototype,"icon",null),p([g()],D.prototype,"label",null),p([g()],D.prototype,"layerInfos",null),p([g(),X("esri/widgets/Legend/t9n/Legend")],D.prototype,"messages",void 0),p([g()],D.prototype,"style",void 0),p([Et("style")],D.prototype,"castStyle",null),p([g()],D.prototype,"view",null),p([g()],D.prototype,"viewModel",void 0),D=p([O("esri.widgets.Legend")],D);var Ja=D;export{Ja as a};
