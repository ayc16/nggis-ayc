import{a as se,b as B,c as q,d as V,e as Ne,f as M,g as v,h as Le,i as Ce,j as $e,k as Pe,m as Ze,n as ee,o as Re,p as Ue,s as Me,t as oe}from"./chunk-WAAM66OS.js";import"./chunk-TOO2WDAC.js";import{o as le,t as ve}from"./chunk-CUJYBG3P.js";import"./chunk-S64LE5CT.js";import{a as Ae}from"./chunk-QK3GCJX4.js";import{a as Y}from"./chunk-WXYOVYVR.js";import{a as xe}from"./chunk-GRKVI6KL.js";import{a as Se}from"./chunk-6CZVQOI6.js";import{c as P}from"./chunk-C4KJ5QFP.js";import{Ca as be,Na as re,O as K,P as Ie,R as L,T as $,W as De,Y as S,Z as _,_ as N,b as c,c as m,ca as U,da as ie,ea as J,fa as Te,ha as E,na as b,q as Q,qa as O,ra as Ee,sa as z}from"./chunk-VUJUH7MP.js";import{a as ge}from"./chunk-JDLVIKS3.js";import"./chunk-6LUFMGKP.js";import"./chunk-ZOL2XRTU.js";import"./chunk-ZISGARXA.js";import"./chunk-7IBFEZ3C.js";import"./chunk-T3JI2ZRA.js";import"./chunk-7EQBH2NW.js";import"./chunk-CPR27CS2.js";import"./chunk-DDZ3KR2Q.js";import"./chunk-YYR2JD3H.js";import"./chunk-GFEKSNS7.js";import"./chunk-YTDHENVR.js";import"./chunk-UDAVCKBV.js";import"./chunk-7QY3BMVN.js";import"./chunk-BGI2WQLI.js";import"./chunk-Z33JZO3Q.js";import{f as D}from"./chunk-EGGOXN6S.js";import{a as Fe}from"./chunk-LX3TXNPU.js";import{a as X}from"./chunk-TQABLJ2O.js";import"./chunk-DJ47AFVJ.js";import"./chunk-JIEAXAQO.js";import"./chunk-BBBNACDZ.js";import"./chunk-RZU6EEB3.js";import"./chunk-P3DBVG4K.js";import"./chunk-A3QOQ5KT.js";import"./chunk-YUUJN5G2.js";import"./chunk-3SDF35T4.js";import"./chunk-U525MQUY.js";import"./chunk-6EWOYGD5.js";import"./chunk-WDTJILD4.js";import"./chunk-M3FWYH54.js";import"./chunk-SGQDWWIB.js";import"./chunk-WERKLYA3.js";import"./chunk-FDMAP7C3.js";import"./chunk-XPKJ6EMR.js";import"./chunk-NSTNSNXJ.js";import"./chunk-FEVELSXH.js";import"./chunk-SFRQ4PHZ.js";import"./chunk-NSRU3MRX.js";import"./chunk-NJFASAXZ.js";import"./chunk-NHAXDXHR.js";import"./chunk-MP434LRL.js";import"./chunk-KXDUJJUF.js";import"./chunk-FTVSSLGC.js";import"./chunk-QPOMWSFR.js";import"./chunk-2MVYKHX3.js";import"./chunk-7DPBVZFZ.js";import"./chunk-F4H7OIJK.js";import"./chunk-IM3BGYEV.js";import"./chunk-6QEGDZGH.js";import"./chunk-ZNEMFYSX.js";import"./chunk-ZB2MLS4M.js";import"./chunk-BF4ZL3U3.js";import"./chunk-U3EFYVM2.js";import"./chunk-NEL2DIHD.js";import"./chunk-6MKTTYAV.js";import"./chunk-LCWKR6WR.js";import"./chunk-PPALSVK5.js";import"./chunk-MAVOHF7Q.js";import"./chunk-JIO2NKRP.js";import"./chunk-JIFV566L.js";import"./chunk-YBNLKD57.js";import"./chunk-A2WF4NJX.js";import"./chunk-VAIXCJGK.js";import"./chunk-P4G27PQQ.js";import"./chunk-V36WZPMJ.js";import"./chunk-KE4KELLY.js";import"./chunk-KKBJ5AEP.js";import"./chunk-MT7CYQIO.js";import"./chunk-C64FPBS5.js";import"./chunk-STCMK6X3.js";import"./chunk-2XAYS5PW.js";import"./chunk-2O2C5MZC.js";import"./chunk-2F3ICBUH.js";import"./chunk-C4OC7UNL.js";import"./chunk-WBNQAM3K.js";import"./chunk-KH5B55IZ.js";import"./chunk-NPQPIZAK.js";import"./chunk-LOEAA5XF.js";import"./chunk-KBOF5WGE.js";import"./chunk-RNDCFWL7.js";import"./chunk-LX5FIKVZ.js";import"./chunk-576BZULE.js";import"./chunk-N7KNO35F.js";import"./chunk-TALIOOAA.js";import"./chunk-6UOVQ25A.js";import"./chunk-BNSYK2BT.js";import"./chunk-DHY7QZ2H.js";import"./chunk-MFP2OFDR.js";import"./chunk-LCEQXLDI.js";import"./chunk-TUJ6FPE6.js";import"./chunk-B7SBOPIK.js";import"./chunk-PDWLAUMH.js";import"./chunk-UVZRJ2I3.js";import"./chunk-SZLPDMBI.js";import"./chunk-65QIQYGA.js";import"./chunk-TLLESPR2.js";import"./chunk-NFADXGWT.js";import"./chunk-FI6XC3PH.js";import"./chunk-I3S324BU.js";import{c as H}from"./chunk-YTC2EJDQ.js";import"./chunk-2UDQ3IWX.js";import"./chunk-YC7IXNOA.js";import"./chunk-MMZZL453.js";import"./chunk-XDMNA7OV.js";import"./chunk-NKZ7R6T6.js";import"./chunk-VHAPMMA5.js";import"./chunk-DR5D3NPO.js";import"./chunk-ERH7ZNSC.js";import"./chunk-GUOR3BIM.js";import"./chunk-WXS2B4FF.js";import"./chunk-XFK3CDZ5.js";import"./chunk-4XBATNKX.js";import"./chunk-3IJY37BG.js";import"./chunk-V2KSICSA.js";import"./chunk-GNCG2SQP.js";import"./chunk-5HCLBNUR.js";import"./chunk-JEEYT3GD.js";import"./chunk-RMOIVYM4.js";import"./chunk-5JXPUH2D.js";import"./chunk-F4I5LECK.js";import"./chunk-J4PQZSQE.js";import"./chunk-Q3WN5PJ6.js";import"./chunk-UMB6LRQI.js";import"./chunk-AQ74ANSJ.js";import"./chunk-SAOUSUZE.js";import"./chunk-IFPBW5UQ.js";import"./chunk-ZV7ILGPO.js";import"./chunk-6ZT4EXDX.js";import"./chunk-RHHHYJSZ.js";import"./chunk-QBQKFGOZ.js";import"./chunk-K5NHJTKR.js";import"./chunk-XKXYUJUA.js";import"./chunk-F7PIPM6E.js";import"./chunk-FR6Q4MSQ.js";import"./chunk-C6JT6KYF.js";import"./chunk-BCREO4Q5.js";import"./chunk-Z5Q76SB7.js";import"./chunk-E5R4OI7X.js";import"./chunk-6FWNINU2.js";import"./chunk-ES7AH7WX.js";import"./chunk-RSDQHAJX.js";import"./chunk-NYONONNN.js";import"./chunk-MZFPLWMN.js";import"./chunk-DS2JVXBM.js";import"./chunk-G3LLBABP.js";import"./chunk-T4B3RN6B.js";import"./chunk-MXADXAOS.js";import"./chunk-RJHITHLB.js";import"./chunk-5TVEQGKJ.js";import{c as fe}from"./chunk-U4U366GW.js";import"./chunk-JTJ3UVF7.js";import"./chunk-R4TNLPIN.js";import"./chunk-5HLV7XP5.js";import"./chunk-BENVXA3L.js";import"./chunk-UI76XBLJ.js";import"./chunk-UE2YGKE7.js";import"./chunk-BE76S5KT.js";import"./chunk-3RDV3O6N.js";import"./chunk-D2ITYHSM.js";import"./chunk-FIITBHDP.js";import"./chunk-VSVNPPHQ.js";import"./chunk-CTGIUUCS.js";import"./chunk-VWEBO6QK.js";import"./chunk-KAAR5ZJN.js";import"./chunk-W3WDPWBE.js";import{w as he}from"./chunk-WKT5W7KT.js";import"./chunk-MLSR6YE6.js";import"./chunk-JPDAKIWT.js";import"./chunk-VU5W7W6Y.js";import"./chunk-X3IDZTNG.js";import"./chunk-IQJU4QT3.js";import{h as x}from"./chunk-EAH6BNBL.js";function We(s,n,i,p){if(p.length===1){if(S(p[0]))return Y(s,p[0],-1);if(U(p[0]))return Y(s,p[0].toArray(),-1)}return Y(s,p,-1)}function ue(s,n,i){return x(this,null,function*(){let p=s.getVariables();if(p.length>0){let F=[];for(let t=0;t<p.length;t++){let r={name:p[t]};F.push(yield n.evaluateIdentifier(i,r))}let e={};for(let t=0;t<p.length;t++)e[p[t]]=F[t];return s.parameters=e,s}return s})}function d(s,n,i=null){for(let p in s)if(p.toLowerCase()===n.toLowerCase())return s[p];return i}function ke(s){if(s===null)return null;let n={type:d(s,"type",""),name:d(s,"name","")};if(n.type==="range")n.range=d(s,"range",[]);else{n.codedValues=[];for(let i of d(s,"codedValues",[]))n.codedValues.push({name:d(i,"name",""),code:d(i,"code",null)})}return n}function de(s){if(s===null)return null;let n={},i=d(s,"wkt",null);i!==null&&(n.wkt=i);let p=d(s,"wkid",null);return p!==null&&(n.wkid=p),n}function Oe(s){if(s===null)return null;let n={hasZ:d(s,"hasz",!1),hasM:d(s,"hasm",!1)},i=d(s,"spatialreference",null);i&&(n.spatialReference=de(i));let p=d(s,"x",null);if(p!==null)return n.x=p,n.y=d(s,"y",null),n.hasZ&&(n.z=d(s,"z",null)),n.hasM&&(n.m=d(s,"m",null)),n;let F=d(s,"rings",null);if(F!==null)return n.rings=F,n;let e=d(s,"paths",null);if(e!==null)return n.paths=e,n;let t=d(s,"points",null);if(t!==null)return n.points=t,n;for(let r of["xmin","xmax","ymin","ymax","zmin","zmax","mmin","mmax"]){let u=d(s,r,null);u!==null&&(n[r]=u)}return n}function je(s,n){for(let i of n)if(i===s)return!0;return!1}function Ge(s){return!!s.layerDefinition&&!!s.featureSet&&je(s.layerDefinition.geometryType,["",null,"esriGeometryNull","esriGeometryPoint","esriGeometryPolyline","esriGeometryPolygon","esriGeometryMultipoint","esriGeometryEnvelope"])!==!1&&S(s.layerDefinition.fields)!==!1&&S(s.featureSet.features)!==!1}function W(s){return s?.toLowerCase()==="utc"?"UTC":s?.toLowerCase()==="unknown"?"Unknown":s}function hn(s){s.mode==="async"&&(s.functions.timezone=function(n,i){return s.standardFunctionAsync(n,i,(p,F,e)=>x(this,null,function*(){if(E(e,1,2,n,i),Te(e[0])||J(e[0]))return"Unknown";if(N(e[0])){if(yield e[0].load(),e.length===1||e[1]===null)return e[0].datesInUnknownTimezone?W("unknown"):W(e[0].dateFieldsTimeZone);if(!(e[1]instanceof P)||e[1].hasField("type")===!1)throw new m(n,c.InvalidParameter,i);let u=e[1].field("type");if($(u)===!1)throw new m(n,c.InvalidParameter,i);switch(b(u).toLowerCase()){case"preferredtimezone":return W(e[0].preferredTimeZone);case"editfieldsinfo":return W(e[0].editFieldsInfo?.timeZone??null);case"timeinfo":return W(e[0].timeInfo?.timeZone??null);case"field":if(e[1].hasField("fieldname")&&$(e[1].field("fieldname")))return W(e[0].fieldTimeZone(b(e[1].field("fieldname"))))}throw new m(n,c.InvalidParameter,i)}let t=Ee(e[0],re(n));if(t===null)return null;let r=t.timeZone;return r==="system"?Fe.systemTimeZoneCanonicalName:r.toLowerCase()==="utc"?"UTC":r.toLowerCase()==="unknown"?"Unknown":r}))},s.functions.sqltimestamp=function(n,i){return s.standardFunctionAsync(n,i,(p,F,e)=>x(this,null,function*(){E(e,1,3,n,i);let t=e[0];if(ie(t)){if(e.length===1)return t.toSQLWithKeyword();if(e.length===2)return t.changeTimeZone(b(e[1])).toSQLWithKeyword();throw new m(n,c.InvalidParameter,i)}if(J(t))return t.toSQLWithKeyword();if(N(t)){if(e.length!==3)throw new m(n,c.InvalidParameter,i);yield t.load();let r=b(e[1]);if(J(e[2]))return e[2].toSQLWithKeyword();if(ie(e[2])===!1)throw new m(n,c.InvalidParameter,i);let u=t.fieldTimeZone(r);return u===null?e[2].toSQLWithKeyword():e[2].changeTimeZone(u).toSQLWithKeyword()}throw new m(n,c.InvalidParameter,i)}))},s.signatures.push({name:"sqltimestamp",min:2,max:4}),s.functions.featuresetbyid=function(n,i){return s.standardFunctionAsync(n,i,(p,F,e)=>{if(E(e,2,4,n,i),e[0]instanceof se){let t=b(e[1]),r=L(e[2],null),u=z(L(e[3],!0));if(r===null&&(r=["*"]),S(r)===!1)throw new m(n,c.InvalidParameter,i);return e[0].featureSetById(t,u,r)}throw new m(n,c.InvalidParameter,i)})},s.signatures.push({name:"featuresetbyid",min:2,max:4}),s.functions.getfeatureset=function(n,i){return s.standardFunctionAsync(n,i,(p,F,e)=>{if(E(e,1,2,n,i),_(e[0])){let t=L(e[1],"datasource");return t===null&&(t="datasource"),t=b(t).toLowerCase(),Me(e[0].fullSchema(),t,n.lrucache,n.interceptor,n.spatialReference)}throw new m(n,c.InvalidParameter,i)})},s.signatures.push({name:"getfeatureset",min:1,max:2}),s.functions.featuresetbyportalitem=function(n,i){return s.standardFunctionAsync(n,i,(p,F,e)=>{if(E(e,2,5,n,i),e[0]===null)throw new m(n,c.PortalRequired,i);if(e[0]instanceof Se){let o=b(e[1]),a=b(e[2]),l=L(e[3],null),f=z(L(e[4],!0));if(l===null&&(l=["*"]),S(l)===!1)throw new m(n,c.InvalidParameter,i);let g=null;return g=n.services?.portal?n.services.portal:fe.getDefault(),g=xe(e[0],g),oe(o,a,n.spatialReference,l,f,g,n.lrucache,n.interceptor)}if($(e[0])===!1)throw new m(n,c.PortalRequired,i);let t=b(e[0]),r=b(e[1]),u=L(e[2],null),y=z(L(e[3],!0));if(u===null&&(u=["*"]),S(u)===!1)throw new m(n,c.InvalidParameter,i);return oe(t,r,n.spatialReference,u,y,n.services?.portal??fe.getDefault(),n.lrucache,n.interceptor)})},s.signatures.push({name:"featuresetbyportalitem",min:2,max:5}),s.functions.featuresetbyname=function(n,i){return s.standardFunctionAsync(n,i,(p,F,e)=>{if(E(e,2,4,n,i),e[0]instanceof se){let t=b(e[1]),r=L(e[2],null),u=z(L(e[3],!0));if(r===null&&(r=["*"]),S(r)===!1)throw new m(n,c.InvalidParameter,i);return e[0].featureSetByName(t,u,r)}throw new m(n,c.InvalidParameter,i)})},s.signatures.push({name:"featuresetbyname",min:2,max:4}),s.functions.featureset=function(n,i){return s.standardFunction(n,i,(p,F,e)=>{E(e,1,1,n,i);let t=e[0],r={layerDefinition:{geometryType:"",objectIdField:"",hasM:!1,hasZ:!1,globalIdField:"",typeIdField:"",fields:[]},featureSet:{geometryType:"",features:[]}};if($(t))t=JSON.parse(t),t.layerDefinition!==void 0?(r.layerDefinition=t.layerDefinition,r.featureSet=t.featureSet,t.layerDefinition.spatialReference&&(r.layerDefinition.spatialReference=t.layerDefinition.spatialReference)):(r.featureSet.features=t.features,r.featureSet.geometryType=t.geometryType,r.layerDefinition.geometryType=r.featureSet.geometryType,r.layerDefinition.objectIdField=t.objectIdFieldName??"",r.layerDefinition.typeIdField=t.typeIdFieldName,r.layerDefinition.globalIdField=t.globalIdFieldName,r.layerDefinition.fields=t.fields,t.spatialReference&&(r.layerDefinition.spatialReference=t.spatialReference));else{if(!(e[0]instanceof P))throw new m(n,c.InvalidParameter,i);{t=JSON.parse(e[0].castToText(!0));let u=d(t,"layerdefinition");if(u!==null){r.layerDefinition.geometryType=d(u,"geometrytype",""),r.featureSet.geometryType=r.layerDefinition.geometryType,r.layerDefinition.globalIdField=d(u,"globalidfield",""),r.layerDefinition.objectIdField=d(u,"objectidfield",""),r.layerDefinition.typeIdField=d(u,"typeidfield",""),r.layerDefinition.hasZ=d(u,"hasz",!1)===!0,r.layerDefinition.hasM=d(u,"hasm",!1)===!0;let y=d(u,"spatialreference",null);y&&(r.layerDefinition.spatialReference=de(y));for(let a of d(u,"fields",[])){let l={name:d(a,"name",""),alias:d(a,"alias",""),type:d(a,"type",""),nullable:d(a,"nullable",!0),editable:d(a,"editable",!0),length:d(a,"length",null),domain:ke(d(a,"domain"))};r.layerDefinition.fields.push(l)}let o=d(t,"featureset",null);if(o){let a={};for(let l of r.layerDefinition.fields)a[l.name.toLowerCase()]=l.name;for(let l of d(o,"features",[])){let f={},g=d(l,"attributes",{});for(let T in g)f[a[T.toLowerCase()]]=g[T];r.featureSet.features.push({attributes:f,geometry:Oe(d(l,"geometry",null))})}}}else{r.layerDefinition.hasZ=d(t,"hasz",!1)===!0,r.layerDefinition.hasM=d(t,"hasm",!1)===!0,r.layerDefinition.geometryType=d(t,"geometrytype",""),r.featureSet.geometryType=r.layerDefinition.geometryType,r.layerDefinition.objectIdField=d(t,"objectidfieldname",""),r.layerDefinition.typeIdField=d(t,"typeidfieldname","");let y=d(t,"spatialreference",null);y&&(r.layerDefinition.spatialReference=de(y));let o=d(t,"fields",null);if(S(o))for(let f of o){let g={name:d(f,"name",""),alias:d(f,"alias",""),type:d(f,"type",""),nullable:d(f,"nullable",!0),editable:d(f,"editable",!0),length:d(f,"length",null),domain:ke(d(f,"domain"))};r.layerDefinition.fields.push(g)}else o=null,r.layerDefinition.fields=o;let a={};for(let f of r.layerDefinition.fields)a[f.name.toLowerCase()]=f.name;let l=d(t,"features",null);if(S(l))for(let f of l){let g={},T=d(f,"attributes",{});for(let I in T)g[a[I.toLowerCase()]]=T[I];r.featureSet.features.push({attributes:g,geometry:Oe(d(f,"geometry",null))})}else l=null,r.featureSet.features=l}}}if(Ge(r)===!1)throw new m(n,c.InvalidParameter,i);return r.layerDefinition.geometryType||(r.layerDefinition.geometryType="esriGeometryNull"),Pe.create(r,n.spatialReference)})},s.signatures.push({name:"featureset",min:1,max:1}),s.functions.filter=function(n,i){return s.standardFunctionAsync(n,i,(p,F,e)=>x(this,null,function*(){if(E(e,2,2,n,i),S(e[0])||U(e[0])){let t=[],r=e[0];r instanceof ge&&(r=r.toArray());let u=null;if(!Ie(e[1]))throw new m(n,c.InvalidParameter,i);u=e[1].createFunction(n);for(let y of r){let o=u(y);he(o)?(yield o)===!0&&t.push(y):o===!0&&t.push(y)}return t}if(N(e[0])){let t=yield e[0].load(),r=D.create(e[1],t.getFieldsIndex(),t.dateFieldsTimeZoneDefaultUTC),u=r.getVariables();if(u.length>0){let y=[];for(let a=0;a<u.length;a++){let l={name:u[a]};y.push(yield s.evaluateIdentifier(n,l))}let o={};for(let a=0;a<u.length;a++)o[u[a]]=y[a];return r.parameters=o,new B({parentfeatureset:e[0],whereclause:r})}return new B({parentfeatureset:e[0],whereclause:r})}throw new m(n,c.InvalidParameter,i)}))},s.signatures.push({name:"filter",min:2,max:2}),s.functions.orderby=function(n,i){return s.standardFunctionAsync(n,i,(p,F,e)=>x(this,null,function*(){if(E(e,2,2,n,i),N(e[0])){let t=new Le(e[1]);return new Ce({parentfeatureset:e[0],orderbyclause:t})}throw new m(n,c.InvalidParameter,i)}))},s.signatures.push({name:"orderby",min:2,max:2}),s.functions.top=function(n,i){return s.standardFunctionAsync(n,i,(p,F,e)=>x(this,null,function*(){if(E(e,2,2,n,i),N(e[0]))return new $e({parentfeatureset:e[0],topnum:e[1]});if(S(e[0]))return O(e[1])>=e[0].length?e[0].slice(0):e[0].slice(0,O(e[1]));if(U(e[0]))return O(e[1])>=e[0].length()?e[0].slice(0):e[0].slice(0,O(e[1]));throw new m(n,c.InvalidParameter,i)}))},s.signatures.push({name:"top",min:2,max:2}),s.functions.first=function(n,i){return s.standardFunctionAsync(n,i,(p,F,e)=>x(this,null,function*(){if(E(e,1,1,n,i),N(e[0])){let t=yield e[0].first(p.abortSignal);if(t!==null){let r=Ae.createFromGraphicLikeObject(t.geometry,t.attributes,e[0],n.timeZone);return r._underlyingGraphic=t,r}return t}return S(e[0])?e[0].length===0?null:e[0][0]:U(e[0])?e[0].length()===0?null:e[0].get(0):null}))},s.signatures.push({name:"first",min:1,max:1}),s.functions.attachments=function(n,i){return s.standardFunctionAsync(n,i,(p,F,e)=>x(this,null,function*(){E(e,1,2,n,i);let t={minsize:-1,maxsize:-1,types:null,returnMetadata:!1};if(e.length>1){if(e[1]instanceof P){if(e[1].hasField("minsize")&&(t.minsize=O(e[1].field("minsize"))),e[1].hasField("metadata")&&(t.returnMetadata=z(e[1].field("metadata"))),e[1].hasField("maxsize")&&(t.maxsize=O(e[1].field("maxsize"))),e[1].hasField("types")){let r=be(e[1].field("types"),!1);r.length>0&&(t.types=r)}}else if(e[1]!==null)throw new m(n,c.InvalidParameter,i)}if(_(e[0])){let r=e[0]._layer;return r instanceof X&&(r=ee(r,n.spatialReference,["*"],!0,n.lrucache,n.interceptor)),r===null?[]:N(r)===!1?[]:(yield r.load(),r.queryAttachments(e[0].field(r.objectIdField),t.minsize,t.maxsize,t.types,t.returnMetadata))}if(e[0]===null)return[];throw new m(n,c.InvalidParameter,i)}))},s.signatures.push({name:"attachments",min:1,max:2}),s.functions.featuresetbyrelationshipname=function(n,i){return s.standardFunctionAsync(n,i,(p,F,e)=>x(this,null,function*(){E(e,2,4,n,i);let t=e[0],r=b(e[1]),u=L(e[2],null),y=z(L(e[3],!0));if(u===null&&(u=["*"]),S(u)===!1)throw new m(n,c.InvalidParameter,i);if(e[0]===null)return null;if(!_(e[0]))throw new m(n,c.InvalidParameter,i);let o=t._layer;if(o instanceof X&&(o=ee(o,n.spatialReference,["*"],!0,n.lrucache,n.interceptor)),o===null||N(o)===!1)return null;o=yield o.load();let a=o.relationshipMetaData().filter(I=>I.name===r);if(a.length===0)return null;if(a[0].relationshipTableId!==void 0&&a[0].relationshipTableId!==null&&a[0].relationshipTableId>-1)return Ue(o,a[0],t.field(o.objectIdField),o.spatialReference,u,y,n.lrucache,n.interceptor);let l=o.serviceUrl();if(!l)return null;l=l.charAt(l.length-1)==="/"?l+a[0].relatedTableId.toString():l+"/"+a[0].relatedTableId.toString();let f=yield Ze(l,o.spatialReference,u,y,n.lrucache,n.interceptor);yield f.load();let g=f.relationshipMetaData();if(g=g.filter(I=>I.id===a[0].id),t.hasField(a[0].keyField)===!1||t.field(a[0].keyField)===null){let I=yield o.getFeatureByObjectId(t.field(o.objectIdField),[a[0].keyField]);if(I){let A=D.create(g[0].keyField+"= @id",f.getFieldsIndex(),f.dateFieldsTimeZoneDefaultUTC);return A.parameters={id:I.attributes[a[0].keyField]},f.filter(A)}return new ve({parentfeatureset:f})}let T=D.create(g[0].keyField+"= @id",f.getFieldsIndex(),f.dateFieldsTimeZoneDefaultUTC);return T.parameters={id:t.field(a[0].keyField)},f.filter(T)}))},s.signatures.push({name:"featuresetbyrelationshipname",min:2,max:4}),s.functions.featuresetbyassociation=function(n,i){return s.standardFunctionAsync(n,i,(p,F,e)=>x(this,null,function*(){E(e,2,3,n,i);let t=e[0],r=b(L(e[1],"")).toLowerCase(),u=$(e[2])?b(e[2]):null;if(e[0]===null)return null;if(!_(e[0]))throw new m(n,c.InvalidParameter,i);let y=t._layer;if(y instanceof X&&(y=ee(y,n.spatialReference,["*"],!0,n.lrucache,n.interceptor)),y===null||N(y)===!1)return null;yield y.load();let o=y.serviceUrl(),a=yield Re(o,n.spatialReference),l=null,f=null,g=!1;if(u!==null&&u!==""&&u!==void 0){for(let h of a.terminals)h.terminalName===u&&(f=h.terminalId);f===null&&(g=!0)}let T=a.associations.getFieldsIndex(),I=T.get("TOGLOBALID").name,A=T.get("FROMGLOBALID").name,ne=T.get("TOTERMINALID").name,te=T.get("FROMTERMINALID").name,j=T.get("FROMNETWORKSOURCEID").name,G=T.get("TONETWORKSOURCEID").name,k=T.get("ASSOCIATIONTYPE").name,ze=T.get("ISCONTENTVISIBLE").name,He=T.get("OBJECTID").name;for(let h of y.fields)if(h.type==="global-id"){l=t.field(h.name);break}let Z=null,ce=new M(new H({name:"percentalong",alias:"percentalong",type:"double"}),D.create("0",a.associations.getFieldsIndex(),a.associations.dateFieldsTimeZoneDefaultUTC)),me=new M(new H({name:"side",alias:"side",type:"string"}),D.create("''",a.associations.getFieldsIndex(),a.associations.dateFieldsTimeZoneDefaultUTC)),C="globalid",pe="globalId",ye={};for(let h in a.lkp)ye[h]=a.lkp[h].sourceId;let R=new Ne(new H({name:"classname",alias:"classname",type:"string"}),null,ye),w="";switch(r){case"midspan":{w=`((${I}='${l}') OR ( ${A}='${l}')) AND (${k} IN (5))`,R.codefield=D.create(`CASE WHEN (${I}='${l}') THEN ${j} ELSE ${G} END`,a.associations.getFieldsIndex(),a.associations.dateFieldsTimeZoneDefaultUTC);let h=Q(v.findField(a.associations.fields,A));h.name=C,h.alias=C,Z=new M(h,D.create(`CASE WHEN (${A}='${l}') THEN ${I} ELSE ${A} END`,a.associations.getFieldsIndex(),a.associations.dateFieldsTimeZoneDefaultUTC)),ce=a.unVersion>=4?new q(v.findField(a.associations.fields,T.get("PERCENTALONG").name)):new M(new H({name:"percentalong",alias:"percentalong",type:"double"}),D.create("0",a.associations.getFieldsIndex(),a.associations.dateFieldsTimeZoneDefaultUTC));break}case"junctionedge":{w=`((${I}='${l}') OR ( ${A}='${l}')) AND (${k} IN (4,6))`,R.codefield=D.create(`CASE WHEN (${I}='${l}') THEN ${j} ELSE ${G} END`,a.associations.getFieldsIndex(),a.associations.dateFieldsTimeZoneDefaultUTC);let h=Q(v.findField(a.associations.fields,A));h.name=C,h.alias=C,Z=new M(h,D.create(`CASE WHEN (${A}='${l}') THEN ${I} ELSE ${A} END`,a.associations.getFieldsIndex(),a.associations.dateFieldsTimeZoneDefaultUTC)),me=new M(new H({name:"side",alias:"side",type:"string"}),D.create(`CASE WHEN (${k}=4) THEN 'from' ELSE 'to' END`,a.associations.getFieldsIndex(),a.associations.dateFieldsTimeZoneDefaultUTC));break}case"connected":{let h=`${I}='@T'`,we=`${A}='@T'`;f!==null&&(h+=` AND ${ne}=@A`,we+=` AND ${te}=@A`),w="(("+h+") OR ("+we+"))",w=K(w,"@T",l??""),h=K(h,"@T",l??""),f!==null&&(h=K(h,"@A",f.toString()),w=K(w,"@A",f.toString())),R.codefield=D.create("CASE WHEN "+h+` THEN ${j} ELSE ${G} END`,a.associations.getFieldsIndex(),a.associations.dateFieldsTimeZoneDefaultUTC);let ae=Q(v.findField(a.associations.fields,A));ae.name=C,ae.alias=C,Z=new M(ae,D.create("CASE WHEN "+h+` THEN ${A} ELSE ${I} END`,a.associations.getFieldsIndex(),a.associations.dateFieldsTimeZoneDefaultUTC));break}case"container":w=`${I}='${l}' AND ${k} = 2`,f!==null&&(w+=` AND ${ne} = `+f.toString()),R.codefield=j,w="( "+w+" )",Z=new V(v.findField(a.associations.fields,A),C,C);break;case"content":w=`(${A}='${l}' AND ${k} = 2)`,f!==null&&(w+=` AND ${te} = `+f.toString()),R.codefield=G,w="( "+w+" )",Z=new V(v.findField(a.associations.fields,I),C,C);break;case"structure":w=`(${I}='${l}' AND ${k} = 3)`,f!==null&&(w+=` AND ${ne} = `+f.toString()),R.codefield=j,w="( "+w+" )",Z=new V(v.findField(a.associations.fields,A),C,pe);break;case"attached":w=`(${A}='${l}' AND ${k} = 3)`,f!==null&&(w+=` AND ${te} = `+f.toString()),R.codefield=G,w="( "+w+" )",Z=new V(v.findField(a.associations.fields,I),C,pe);break;default:throw new m(n,c.InvalidParameter,i)}return g&&(w="1 <> 1"),new v({parentfeatureset:a.associations,adaptedFields:[new q(v.findField(a.associations.fields,He)),new q(v.findField(a.associations.fields,ze)),Z,me,R,ce],extraFilter:w?D.create(w,a.associations.getFieldsIndex(),a.associations.dateFieldsTimeZoneDefaultUTC):null})}))},s.signatures.push({name:"featuresetbyassociation",min:2,max:6}),s.functions.groupby=function(n,i){return s.standardFunctionAsync(n,i,(p,F,e)=>x(this,null,function*(){if(E(e,3,3,n,i),!N(e[0]))throw new m(n,c.InvalidParameter,i);let t=yield e[0].load(),r=[],u=[],y=!1,o=[];if($(e[1]))o.push(e[1]);else if(e[1]instanceof P)o.push(e[1]);else if(S(e[1]))o=e[1];else{if(!U(e[1]))throw new m(n,c.InvalidParameter,i);o=e[1].toArray()}for(let a of o)if($(a)){let l=D.create(b(a),t.getFieldsIndex(),t.dateFieldsTimeZoneDefaultUTC),f=le(l)===!0?b(a):"%%%%FIELDNAME";r.push({name:f,expression:l}),f==="%%%%FIELDNAME"&&(y=!0)}else{if(!(a instanceof P))throw new m(n,c.InvalidParameter,i);{let l=a.hasField("name")?a.field("name"):"%%%%FIELDNAME",f=a.hasField("expression")?a.field("expression"):"";if(l==="%%%%FIELDNAME"&&(y=!0),!l)throw new m(n,c.InvalidParameter,i);r.push({name:l,expression:D.create(f||l,t.getFieldsIndex(),t.dateFieldsTimeZoneDefaultUTC)})}}if(o=[],$(e[2]))o.push(e[2]);else if(S(e[2]))o=e[2];else if(U(e[2]))o=e[2].toArray();else{if(!(e[2]instanceof P))throw new m(n,c.InvalidParameter,i);o.push(e[2])}for(let a of o){if(!(a instanceof P))throw new m(n,c.InvalidParameter,i);{let l=a.hasField("name")?a.field("name"):"",f=a.hasField("statistic")?a.field("statistic"):"",g=a.hasField("expression")?a.field("expression"):"";if(!l||!f||!g)throw new m(n,c.InvalidParameter,i);u.push({name:l,statistic:f.toLowerCase(),expression:D.create(g,t.getFieldsIndex(),t.dateFieldsTimeZoneDefaultUTC)})}}if(y){let a={};for(let f of t.fields)a[f.name.toLowerCase()]=1;for(let f of r)f.name!=="%%%%FIELDNAME"&&(a[f.name.toLowerCase()]=1);for(let f of u)f.name!=="%%%%FIELDNAME"&&(a[f.name.toLowerCase()]=1);let l=0;for(let f of r)if(f.name==="%%%%FIELDNAME"){for(;a["field_"+l.toString()]===1;)l++;a["field_"+l.toString()]=1,f.name="FIELD_"+l.toString()}}for(let a of r)yield ue(a.expression,s,n);for(let a of u)yield ue(a.expression,s,n);return e[0].groupby(r,u)}))},s.signatures.push({name:"groupby",min:3,max:3}),s.functions.distinct=function(n,i){return s.standardFunctionAsync(n,i,(p,F,e)=>x(this,null,function*(){if(N(e[0])){E(e,2,2,n,i);let t=yield e[0].load(),r=[],u=[];if($(e[1]))u.push(e[1]);else if(e[1]instanceof P)u.push(e[1]);else if(S(e[1]))u=e[1];else{if(!U(e[1]))throw new m(n,c.InvalidParameter,i);u=e[1].toArray()}let y=!1;for(let o of u)if($(o)){let a=D.create(b(o),t.getFieldsIndex(),t.dateFieldsTimeZoneDefaultUTC),l=le(a)===!0?b(o):"%%%%FIELDNAME";r.push({name:l,expression:a}),l==="%%%%FIELDNAME"&&(y=!0)}else{if(!(o instanceof P))throw new m(n,c.InvalidParameter,i);{let a=o.hasField("name")?o.field("name"):"%%%%FIELDNAME",l=o.hasField("expression")?o.field("expression"):"";if(a==="%%%%FIELDNAME"&&(y=!0),!a)throw new m(n,c.InvalidParameter,i);r.push({name:a,expression:D.create(l||a,t.getFieldsIndex(),t.dateFieldsTimeZoneDefaultUTC)})}}if(y){let o={};for(let l of t.fields)o[l.name.toLowerCase()]=1;for(let l of r)l.name!=="%%%%FIELDNAME"&&(o[l.name.toLowerCase()]=1);let a=0;for(let l of r)if(l.name==="%%%%FIELDNAME"){for(;o["field_"+a.toString()]===1;)a++;o["field_"+a.toString()]=1,l.name="FIELD_"+a.toString()}}for(let o of r)yield ue(o.expression,s,n);return e[0].groupby(r,[])}return We("distinct",p,F,e)}))}),s.functions.getfeaturesetinfo=function(n,i){return s.standardFunctionAsync(n,i,(p,F,e)=>x(this,null,function*(){if(E(e,1,1,n,i),!N(e[0]))return null;let t=yield e[0].getFeatureSetInfo();return t?P.convertObjectToArcadeDictionary({layerId:t.layerId,layerName:t.layerName,itemId:t.itemId,serviceLayerUrl:t.serviceLayerUrl,webMapLayerId:t.webMapLayerId??null,webMapLayerTitle:t.webMapLayerTitle??null,className:null,objectClassId:null},re(n),!1,!1):null}))},s.signatures.push({name:"getfeaturesetinfo",min:1,max:1}),s.functions.filterbysubtypecode=function(n,i){return s.standardFunctionAsync(n,i,(p,F,e)=>x(this,null,function*(){if(E(e,2,2,n,i),N(e[0])){let t=yield e[0].load(),r=e[1];if(!De(r))throw new m(n,c.InvalidParameter,i);if(t.subtypeField){let y=D.create(`${t.subtypeField}= ${e[1]}`,t.getFieldsIndex(),t.dateFieldsTimeZoneDefaultUTC);return new B({parentfeatureset:e[0],whereclause:y})}if(t.typeIdField===null||t.typeIdField==="")throw new m(n,c.FeatureSetDoesNotHaveSubtypes,i);let u=D.create(`${t.typeIdField}= ${e[1]}`,t.getFieldsIndex(),t.dateFieldsTimeZoneDefaultUTC);return new B({parentfeatureset:e[0],whereclause:u})}throw new m(n,c.InvalidParameter,i)}))},s.signatures.push({name:"filterbysubtypecode",min:2,max:2})}export{hn as registerFunctions};
