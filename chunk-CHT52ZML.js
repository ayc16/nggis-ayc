import{a as X,b as Q,c as F,d as z,e as V,f as Y,g as Z}from"./chunk-CS6GS2YZ.js";import{a as ft,b as pt,c as Tt}from"./chunk-GEDCZS6Y.js";import{a as w}from"./chunk-WB63P7CN.js";import"./chunk-SDUXSXKH.js";import{f as _t}from"./chunk-BR6S5KCM.js";import"./chunk-DQ5TDMUL.js";import"./chunk-W5OI4BJ2.js";import"./chunk-2NH7HOKA.js";import"./chunk-XSMN6VN6.js";import"./chunk-BPP5MIUB.js";import{b as U}from"./chunk-I46GU3Q4.js";import"./chunk-H5IJXG2U.js";import"./chunk-TCQOV56D.js";import"./chunk-IFFYADB3.js";import"./chunk-BVW6ULEA.js";import"./chunk-7C6Z24SS.js";import"./chunk-AWOMJTYJ.js";import"./chunk-2EA2KAER.js";import"./chunk-J57HR4DB.js";import"./chunk-K5NHJTKR.js";import"./chunk-BCREO4Q5.js";import{b as A}from"./chunk-Z5Q76SB7.js";import"./chunk-E5R4OI7X.js";import"./chunk-6FWNINU2.js";import{D as mt,a as m,b as y,c as p,k as W,m as E,u as H,v as K,w as C,x as J}from"./chunk-ES7AH7WX.js";import"./chunk-RSDQHAJX.js";import{S as lt,k as ct,s as B}from"./chunk-KAAR5ZJN.js";import{a as ht}from"./chunk-W3WDPWBE.js";import{h as ut}from"./chunk-WKT5W7KT.js";import"./chunk-MLSR6YE6.js";import"./chunk-X3IDZTNG.js";import"./chunk-IQJU4QT3.js";import{h as L}from"./chunk-EAH6BNBL.js";function $(o){return o?{ray:X(o.ray),c0:o.c0,c1:o.c1}:{ray:X(),c0:0,c1:Number.MAX_VALUE}}var kt=new w(()=>$());function Pt(){return[m(),m(),m(),m(),m(),m(),m(),m()]}function G(o,t){for(let e=0;e<Bt;e++){let n=o[e];if(n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]>=t[3])return!1}return!0}var Ot,c;(function(o){o[o.LEFT=0]="LEFT",o[o.RIGHT=1]="RIGHT",o[o.BOTTOM=2]="BOTTOM",o[o.TOP=3]="TOP",o[o.NEAR=4]="NEAR",o[o.FAR=5]="FAR"})(Ot||(Ot={})),function(o){o[o.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",o[o.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",o[o.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",o[o.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",o[o.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",o[o.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",o[o.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",o[o.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(c||(c={}));var _e={bottom:[c.FAR_BOTTOM_RIGHT,c.NEAR_BOTTOM_RIGHT,c.NEAR_BOTTOM_LEFT,c.FAR_BOTTOM_LEFT],near:[c.NEAR_BOTTOM_LEFT,c.NEAR_BOTTOM_RIGHT,c.NEAR_TOP_RIGHT,c.NEAR_TOP_LEFT],far:[c.FAR_BOTTOM_RIGHT,c.FAR_BOTTOM_LEFT,c.FAR_TOP_LEFT,c.FAR_TOP_RIGHT],right:[c.NEAR_BOTTOM_RIGHT,c.FAR_BOTTOM_RIGHT,c.FAR_TOP_RIGHT,c.NEAR_TOP_RIGHT],left:[c.FAR_BOTTOM_LEFT,c.NEAR_BOTTOM_LEFT,c.NEAR_TOP_LEFT,c.FAR_TOP_LEFT],top:[c.FAR_TOP_LEFT,c.NEAR_TOP_LEFT,c.NEAR_TOP_RIGHT,c.FAR_TOP_RIGHT]},Bt=6;var fe=[A(-1,-1,-1,1),A(1,-1,-1,1),A(1,1,-1,1),A(-1,1,-1,1),A(-1,-1,1,1),A(1,-1,1,1),A(1,1,1,1),A(-1,1,1,1)],pe=new w($),Te=Pt();var v=class o{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(t,e){this.objectToBoundingSphere=t,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new l,this._objectCount=0,e&&(e.maximumObjectsPerNode!==void 0&&(this._maximumObjectsPerNode=e.maximumObjectsPerNode),e.maximumDepth!==void 0&&(this._maximumDepth=e.maximumDepth))}destroy(){this._degenerateObjects.clear(),l.clearPool(),st[0]=null,M.prune(),P.prune()}add(t,e=t.length){this._objectCount+=e,this._grow(t,e);let n=l.acquire();for(let s=0;s<e;s++){let r=t[s];this._isDegenerate(r)?this._degenerateObjects.add(r):(n.init(this._root),this._add(r,n))}l.release(n)}remove(t,e=null){this._objectCount-=t.length;let n=l.acquire();for(let s of t){let r=e??z(this.objectToBoundingSphere(s),Ht);D(r[3])?(n.init(this._root),this._remove(s,r,n)):this._degenerateObjects.delete(s)}l.release(n),this._shrink()}update(t,e){if(!D(e[3])&&this._isDegenerate(t))return;let n=yt(t);this.remove(n,e),this.add(n)}forEachAlongRay(t,e,n){let s=Q(t,e);this._forEachNode(this._root,r=>{if(!this._intersectsNode(s,r))return!1;let a=r.node;return a.terminals.forAll(d=>{this._intersectsObject(s,d)&&n(d)}),a.residents!==null&&a.residents.forAll(d=>{this._intersectsObject(s,d)&&n(d)}),!0})}forEachAlongRayWithVerticalOffset(t,e,n,s){let r=Q(t,e);this._forEachNode(this._root,a=>{if(!this._intersectsNodeWithOffset(r,a,s))return!1;let d=a.node;return d.terminals.forAll(i=>{this._intersectsObjectWithOffset(r,i,s)&&n(i)}),d.residents!==null&&d.residents.forAll(i=>{this._intersectsObjectWithOffset(r,i,s)&&n(i)}),!0})}forEach(t){this._forEachNode(this._root,e=>{let n=e.node;return n.terminals.forAll(t),n.residents!==null&&n.residents.forAll(t),!0}),this._degenerateObjects.forEach(t)}forEachDegenerateObject(t){this._degenerateObjects.forEach(t)}findClosest(t,e,n,s=()=>!0,r=1/0){let a=1/0,d=1/0,i=null,h=tt(t,e),_=u=>{if(--r,!s(u))return;let T=this.objectToBoundingSphere(u);if(!G(n,T))return;let b=x(t,e,T),j=b-T[3],f=b+T[3];j<a&&(a=j,d=f,i=u)};return this._forEachNodeDepthOrdered(this._root,u=>{if(r<=0||!G(n,u.bounds)||(H(R,h,u.halfSize),E(R,R,u.bounds),x(t,e,R)>d))return!1;let T=u.node;return T.terminals.forAll(b=>_(b)),T.residents!==null&&T.residents.forAll(b=>_(b)),!0},t,e),i}forEachInDepthRange(t,e,n,s,r,a,d){let i=-1/0,h=1/0,_={setRange:f=>{n===o.DepthOrder.FRONT_TO_BACK?(i=Math.max(i,f.near),h=Math.min(h,f.far)):(i=Math.max(i,-f.far),h=Math.min(h,-f.near))}};_.setRange(s);let u=x(e,n,t),T=tt(e,n),b=tt(e,-n),j=f=>{if(!d(f))return;let S=this.objectToBoundingSphere(f),I=S,dt=x(e,n,I)-u,xt=dt-S[3],Mt=dt+S[3];xt>h||Mt<i||!G(a,S)||r(f,_)};this._forEachNodeDepthOrdered(this._root,f=>{if(!G(a,f.bounds)||(H(R,T,f.halfSize),E(R,R,f.bounds),x(e,n,R)-u>h)||(H(R,b,f.halfSize),E(R,R,f.bounds),x(e,n,R)-u<i))return!1;let S=f.node;return S.terminals.forAll(I=>j(I)),S.residents!==null&&S.residents.forAll(I=>j(I)),!0},e,n)}forEachNode(t){this._forEachNode(this._root,e=>t(e.node,e.bounds,e.halfSize,e.depth))}forEachNeighbor(t,e){let n=V(e),s=e,r=i=>{let h=this.objectToBoundingSphere(i),_=V(h),u=n+_;return!(J(h,s)-u*u<=0)||t(i)},a=!0,d=i=>{a&&(a=r(i))};this._forEachNode(this._root,i=>{let h=V(i.bounds),_=n+h;if(J(i.bounds,s)-_*_>0)return!1;let u=i.node;return u.terminals.forAll(d),a&&u.residents!==null&&u.residents.forAll(d),a}),a&&this.forEachDegenerateObject(d)}_intersectsNode(t,e){return k(e.bounds,2*-e.halfSize,O),k(e.bounds,2*e.halfSize,g),U(t.origin,t.direction,O,g)}_intersectsNodeWithOffset(t,e,n){return k(e.bounds,2*-e.halfSize,O),k(e.bounds,2*e.halfSize,g),n.applyToMinMax(O,g),U(t.origin,t.direction,O,g)}_intersectsObject(t,e){let n=this.objectToBoundingSphere(e);return!(n[3]>0)||Y(n,t)}_intersectsObjectWithOffset(t,e,n){let s=this.objectToBoundingSphere(e);return!(s[3]>0)||Y(n.applyToBoundingSphere(s),t)}_forEachNode(t,e){let n=l.acquire().init(t),s=[n];for(;s.length!==0;){if(n=s.pop(),e(n)&&!n.isLeaf())for(let r=0;r<n.node.children.length;r++)n.node.children[r]&&s.push(l.acquire().init(n).advance(r));l.release(n)}}_forEachNodeDepthOrdered(t,e,n,s=o.DepthOrder.FRONT_TO_BACK){let r=l.acquire().init(t),a=[r];for(Lt(n,s,bt);a.length!==0;){if(r=a.pop(),e(r)&&!r.isLeaf())for(let d=7;d>=0;--d){let i=bt[d];r.node.children[i]&&a.push(l.acquire().init(r).advance(i))}l.release(r)}}_remove(t,e,n){M.clear();let s=n.advanceTo(e,(r,a)=>{M.push(r.node),M.push(a)})?n.node.terminals:n.node.residents;if(s.removeUnordered(t),s.length===0)for(let r=M.length-2;r>=0;r-=2){let a=M.data[r],d=M.data[r+1];if(!this._purge(a,d))break}}_nodeIsEmpty(t){if(t.terminals.length!==0)return!1;if(t.residents!==null)return t.residents.length===0;for(let e=0;e<t.children.length;e++)if(t.children[e])return!1;return!0}_purge(t,e){return e>=0&&(t.children[e]=null),!!this._nodeIsEmpty(t)&&(t.residents===null&&(t.residents=new B({shrink:!0})),!0)}_add(t,e){e.advanceTo(this.objectToBoundingSphere(t))?e.node.terminals.push(t):(e.node.residents.push(t),e.node.residents.length>this._maximumObjectsPerNode&&e.depth<this._maximumDepth&&this._split(e))}_split(t){let e=t.node.residents;t.node.residents=null;for(let n=0;n<e.length;n++){let s=l.acquire().init(t);this._add(e.at(n),s),l.release(s)}}_grow(t,e){if(e!==0&&(gt(t,e,n=>this.objectToBoundingSphere(n),N),D(N[3])&&!this._fitsInsideTree(N)))if(this._nodeIsEmpty(this._root.node))z(N,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize();else{let n=this._rootBoundsForRootAsSubNode(N);this._placingRootViolatesMaxDepth(n)?this._rebuildTree(N,n):this._growRootAsSubNode(n),l.release(n)}}_rebuildTree(t,e){W(nt,e.bounds),nt[3]=e.halfSize,gt([t,nt],2,s=>s,ot);let n=l.acquire().init(this._root);this._root.initFrom(null,ot,ot[3]),this._root.increaseHalfSize(1.25),this._forEachNode(n,s=>(this.add(s.node.terminals.data,s.node.terminals.length),s.node.residents!==null&&this.add(s.node.residents.data,s.node.residents.length),!0)),l.release(n)}_placingRootViolatesMaxDepth(t){let e=Math.log(t.halfSize/this._root.halfSize)*Math.LOG2E,n=0;return this._forEachNode(this._root,s=>(n=Math.max(n,s.depth),n+e<=this._maximumDepth)),n+e>this._maximumDepth}_rootBoundsForRootAsSubNode(t){let e=t[3],n=t,s=-1/0,r=this._root.bounds,a=this._root.halfSize;for(let i=0;i<3;i++){let h=r[i]-a-(n[i]-e),_=n[i]+e-(r[i]+a),u=Math.max(0,Math.ceil(h/(2*a))),T=Math.max(0,Math.ceil(_/(2*a)))+1,b=2**Math.ceil(Math.log(u+T)*Math.LOG2E);s=Math.max(s,b),q[i].min=u,q[i].max=T}for(let i=0;i<3;i++){let h=q[i].min,_=q[i].max,u=(s-(h+_))/2;h+=Math.ceil(u),_+=Math.floor(u);let T=r[i]-a-h*a*2;et[i]=T+(_+h)*a}let d=s*a;return et[3]=d*Ft,l.acquire().initFrom(null,et,d,0)}_growRootAsSubNode(t){let e=this._root.node;W(N,this._root.bounds),N[3]=this._root.halfSize,this._root.init(t),t.advanceTo(N,null,!0),t.node.children=e.children,t.node.residents=e.residents,t.node.terminals=e.terminals}_shrink(){for(;;){let t=this._findShrinkIndex();if(t===-1)break;this._root.advance(t),this._root.depth=0}}_findShrinkIndex(){if(this._root.node.terminals.length!==0||this._root.isLeaf())return-1;let t=null,e=this._root.node.children,n=0,s=0;for(;s<e.length&&t==null;)n=s++,t=e[n];for(;s<e.length;)if(e[s++])return-1;return n}_isDegenerate(t){return!D(this.objectToBoundingSphere(t)[3])}_fitsInsideTree(t){let e=this._root.bounds,n=this._root.halfSize;return t[3]<=n&&t[0]>=e[0]-n&&t[0]<=e[0]+n&&t[1]>=e[1]-n&&t[1]<=e[1]+n&&t[2]>=e[2]-n&&t[2]<=e[2]+n}toJSON(){let{maximumDepth:t,maximumObjectsPerNode:e,_objectCount:n}=this,s=this._nodeToJSON(this._root.node);return{maximumDepth:t,maximumObjectsPerNode:e,objectCount:n,root:{bounds:this._root.bounds,halfSize:this._root.halfSize,depth:this._root.depth,node:s}}}_nodeToJSON(t){let e=t.children.map(r=>r?this._nodeToJSON(r):null),n=t.residents?.map(r=>this.objectToBoundingSphere(r)),s=t.terminals?.map(r=>this.objectToBoundingSphere(r));return{children:e,residents:n,terminals:s}}static fromJSON(t){let e=new o(n=>n,{maximumDepth:t.maximumDepth,maximumObjectsPerNode:t.maximumObjectsPerNode});return e._objectCount=t.objectCount,e._root.initFrom(t.root.node,t.root.bounds,t.root.halfSize,t.root.depth),e}},l=class o{constructor(){this.bounds=F(),this.halfSize=0,this.initFrom(null,null,0,0)}init(t){return this.initFrom(t.node,t.bounds,t.halfSize,t.depth)}initFrom(t,e,n,s=this.depth){return this.node=t??o.createEmptyNode(),e&&z(e,this.bounds),this.halfSize=n,this.depth=s,this}increaseHalfSize(t){this.halfSize*=t,this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*Ft}advance(t){let e=this.node.children[t];e||(e=o.createEmptyNode(),this.node.children[t]=e),this.node=e,this.halfSize/=2,this.depth++;let n=At[t];return this.bounds[0]+=n[0]*this.halfSize,this.bounds[1]+=n[1]*this.halfSize,this.bounds[2]+=n[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}advanceTo(t,e,n=!1){for(;;){if(this.isTerminalFor(t))return e&&e(this,-1),!0;if(this.isLeaf()){if(!n)return e&&e(this,-1),!1;this.node.residents=null}let s=this._childIndex(t);e&&e(this,s),this.advance(s)}}isLeaf(){return this.node.residents!=null}isTerminalFor(t){return t[3]>this.halfSize/2}_childIndex(t){let e=this.bounds;return(e[0]<t[0]?1:0)+(e[1]<t[1]?2:0)+(e[2]<t[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new B({shrink:!0}),residents:new B({shrink:!0})}}static acquire(){return o._pool.acquire()}static release(t){o._pool.release(t)}static clearPool(){o._pool.prune()}};function jt(o,t){o[0]=Math.min(o[0],t[0]-t[3]),o[1]=Math.min(o[1],t[1]-t[3]),o[2]=Math.min(o[2],t[2]-t[3])}function It(o,t){o[0]=Math.max(o[0],t[0]+t[3]),o[1]=Math.max(o[1],t[1]+t[3]),o[2]=Math.max(o[2],t[2]+t[3])}function k(o,t,e){e[0]=o[0]+t,e[1]=o[1]+t,e[2]=o[2]+t}function gt(o,t,e,n){if(t===1){let s=e(o[0]);z(s,n)}else{O[0]=1/0,O[1]=1/0,O[2]=1/0,g[0]=-1/0,g[1]=-1/0,g[2]=-1/0;for(let s=0;s<t;s++){let r=e(o[s]);D(r[3])&&(jt(O,r),It(g,r))}mt(n,O,g,.5),n[3]=Math.max(g[0]-O[0],g[1]-O[1],g[2]-O[2])/2}}function Lt(o,t,e){if(!P.length)for(let n=0;n<8;++n)P.push({index:0,distance:0});for(let n=0;n<8;++n){let s=At[n];P.data[n].index=n,P.data[n].distance=x(o,t,s)}P.sort((n,s)=>n.distance-s.distance);for(let n=0;n<8;++n)e[n]=P.data[n].index}function tt(o,t){let e,n=1/0;for(let s=0;s<8;++s){let r=x(o,t,Rt[s]);r<n&&(n=r,e=Rt[s])}return e}function x(o,t,e){return t*(o[0]*e[0]+o[1]*e[1]+o[2]*e[2])}function D(o){return!isNaN(o)&&o!==-1/0&&o!==1/0&&o>0}l._pool=new ct(l),function(o){var t;(t=o.DepthOrder||(o.DepthOrder={}))[t.FRONT_TO_BACK=1]="FRONT_TO_BACK",t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(v||(v={}));var At=[p(-1,-1,-1),p(1,-1,-1),p(-1,1,-1),p(1,1,-1),p(-1,-1,1),p(1,-1,1),p(-1,1,1),p(1,1,1)],Rt=[p(-1,-1,-1),p(-1,-1,1),p(-1,1,-1),p(-1,1,1),p(1,-1,-1),p(1,-1,1),p(1,1,-1),p(1,1,1)],Ft=Math.sqrt(3),st=[null];function yt(o){return st[0]=o,st}var et=F(),R=m(),O=m(),g=m(),M=new B,Ht=F(),N=F(),nt=F(),ot=F(),q=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],P=new B,bt=[0,0,0,0,0,0,0,0],rt=v;var Nt=1e3;function St(o,t,e){let n=F(),s=n;return K(s,s,o,.5),K(s,s,t,.5),n[3]=C(s,o),E(s,s,e),n}var it=class{constructor(){this._idToComponent=new Map,this._components=new rt(o=>o.bounds),this._edges=new rt(o=>o.bounds),this._tmpLineSegment=ft(),this._tmpP1=m(),this._tmpP2=m(),this._tmpP3=m(),this.remoteClient=null}fetchCandidates(o,t){return L(this,null,function*(){yield Promise.resolve(),ut(t),yield this._ensureEdgeLocations(o,t);let e=[];return this._edges.forEachNeighbor(n=>(this._addCandidates(o,n,e),e.length<Nt),o.bounds),{result:{candidates:e}}})}_ensureEdgeLocations(o,t){return L(this,null,function*(){let e=[];if(this._components.forEachNeighbor(r=>{if(r.info==null){let{id:a,uid:d}=r;e.push({id:a,uid:d})}return!0},o.bounds),!e.length)return;let n={components:e},s=yield this.remoteClient.invoke("fetchAllEdgeLocations",n,t??{});for(let r of s.components)this._setFetchEdgeLocations(r)})}add(o){return L(this,null,function*(){let t=new Ct(o.id,o.bounds);return this._idToComponent.set(t.id,t),this._components.add([t]),{result:{}}})}remove(o){return L(this,null,function*(){let t=this._idToComponent.get(o.id);if(t){let e=[];this._edges.forEachNeighbor(n=>(n.component===t&&e.push(n),!0),t.bounds),this._edges.remove(e),this._components.remove([t]),this._idToComponent.delete(t.id)}return{result:{}}})}_setFetchEdgeLocations(o){let t=this._idToComponent.get(o.id);if(t==null||o.uid!==t.uid)return;let e=_t.createView(o.locations),n=new Array(e.count),s=m(),r=m();for(let i=0;i<e.count;i++){e.position0.getVec(i,s),e.position1.getVec(i,r);let h=St(s,r,o.origin),_=new at(t,i,h);n[i]=_}this._edges.add(n);let{objectIds:a,origin:d}=o;t.info={locations:e,objectIds:a,origin:d}}_addCandidates(o,t,e){let{info:n}=t.component,{origin:s,objectIds:r}=n,a=n.locations,d=a.position0.getVec(t.index,this._tmpP1),i=a.position1.getVec(t.index,this._tmpP2);E(d,d,s),E(i,i,s);let h=r[a.componentIndex.get(t.index)];this._addEdgeCandidate(o,h,d,i,e),this._addVertexCandidate(o,h,d,e),this._addVertexCandidate(o,h,i,e)}_addEdgeCandidate(o,t,e,n,s){if(!o.returnEdge)return;let r=o.bounds,a=pt(e,n,this._tmpLineSegment),d=Tt(a,r,this._tmpP3);Z(o.bounds,d)&&s.push({type:"edge",objectId:t,target:y(d),distance:C(r,d),start:y(e),end:y(n)})}_addVertexCandidate(o,t,e,n){if(!o.returnVertex||!Z(o.bounds,e))return;let s=o.bounds;n.push({type:"vertex",objectId:t,target:y(e),distance:C(s,e)})}};it=ht([lt("esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker")],it);var We=it,Ct=(()=>{class o{constructor(e,n){this.id=e,this.bounds=n,this.info=null,this.uid=++o.uid}}return o.uid=0,o})(),at=class{constructor(t,e,n){this.component=t,this.index=e,this.bounds=n}};export{We as default};
