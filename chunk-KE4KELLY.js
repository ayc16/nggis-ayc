import{a as M}from"./chunk-KKBJ5AEP.js";import{a as E}from"./chunk-MT7CYQIO.js";import{l as P}from"./chunk-C64FPBS5.js";import{a as w}from"./chunk-KBOF5WGE.js";import{u as C}from"./chunk-TALIOOAA.js";import{d as f}from"./chunk-UVZRJ2I3.js";import{a as j}from"./chunk-UMB6LRQI.js";import{h as R}from"./chunk-ZV7ILGPO.js";import{d as x}from"./chunk-MXADXAOS.js";import{a as A}from"./chunk-FIITBHDP.js";import{U as m}from"./chunk-CTGIUUCS.js";import{N as O}from"./chunk-KAAR5ZJN.js";import{r as i}from"./chunk-X3IDZTNG.js";import{a as b,b as F,h as s}from"./chunk-EAH6BNBL.js";function S(e,t,a){return s(this,null,function*(){t=t.clone(),e.capabilities.query.supportsMaxRecordCountFactor&&(t.maxRecordCountFactor=T(e));let r=L(e),n=e.capabilities.query.supportsPagination;t.start=0,t.num=r;let o=null;for(;;){let c=yield e.source.queryFeaturesJSON(t,a);if(o==null?o=c:o.features=o.features.concat(c.features),o.exceededTransferLimit=c.exceededTransferLimit,!n||!c.exceededTransferLimit)break;t.start+=r}return o})}function L(e){return T(e)*G(e)}function G(e){return e.capabilities.query.maxRecordCount||2e3}function T(e){return e.capabilities.query.supportsMaxRecordCountFactor?f.MAX_MAX_RECORD_COUNT_FACTOR:1}var te=new A({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});function re(e,t,a,r){return s(this,null,function*(){let n=yield p(e);if(yield I(e,t,r),!n.addAttachment)throw new i(r,"Layer source does not support addAttachment capability");return n.addAttachment(t,a)})}function I(e,t,a){let{attributes:r}=t,{objectIdField:n}=e;return e.capabilities?.data?.supportsAttachment?t?r?n&&r[n]?Promise.resolve():Promise.reject(new i(a,`feature is missing the identifying attribute ${n}`)):Promise.reject(new i(a,"'attributes' are required on a feature to query attachments")):Promise.reject(new i(a,"A feature is required to add/delete/update attachments")):Promise.reject(new i(a,"this layer doesn't support attachments"))}function ae(e,t,a,r,n){return s(this,null,function*(){let o=yield p(e);if(yield I(e,t,n),!o.updateAttachment)throw new i(n,"Layer source does not support updateAttachment capability");return o.updateAttachment(t,a,r)})}function ne(e,t,a){return s(this,null,function*(){let{applyEdits:r}=yield import("./chunk-T3IDSLZM.js"),n=yield e.load(),{source:o,globalIdField:c}=n,y=a;return n.type==="feature"&&n.infoFor3D&&t.deleteFeatures!=null&&c!=null&&(y=F(b({},y),{globalIdToObjectId:yield v(e,t.deleteFeatures,c)})),r(n,o,t,a)})}function oe(e,t,a){return s(this,null,function*(){let{uploadAssets:r}=yield import("./chunk-T3IDSLZM.js"),n=yield e.load();return r(n,n.source,t,a)})}function se(e,t,a,r){return s(this,null,function*(){let n=yield p(e);if(yield I(e,t,r),!n.deleteAttachments)throw new i(r,"Layer source does not support deleteAttachments capability");return n.deleteAttachments(t,a)})}function ie(e,t,a){return s(this,null,function*(){let r=(yield e.load({signal:t?.signal})).source;if(!r.fetchRecomputedExtents)throw new i(a,"Layer source does not support fetchUpdates capability");return r.fetchRecomputedExtents(t)})}function ue(e,t,a,r){return s(this,null,function*(){t=M.from(t),yield e.load();let n=e.source,o=e.capabilities;if(!o?.data?.supportsAttachment)throw new i(r,"this layer doesn't support attachments");let{attachmentTypes:c,objectIds:y,globalIds:h,num:u,size:l,start:d,where:q}=t;if(!o?.operations?.supportsQueryAttachments&&(c?.length>0||h?.length>0||l?.length>0||u||d||q))throw new i(r,"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",t);if(!(y?.length||h?.length||q))throw new i(r,"'objectIds', 'globalIds', or 'where' are required to perform attachment query",t);if(!n.queryAttachments)throw new i(r,"Layer source does not support queryAttachments capability",t);return n.queryAttachments(t)})}function ce(e,t,a,r){return s(this,null,function*(){let n=yield p(e);if(!n.queryObjectIds)throw new i(r,"Layer source does not support queryObjectIds capability");return n.queryObjectIds(f.from(t)??e.createQuery(),a)})}function le(e,t,a,r){return s(this,null,function*(){let n=yield p(e);if(!n.queryFeatureCount)throw new i(r,"Layer source does not support queryFeatureCount capability");return n.queryFeatureCount(f.from(t)??e.createQuery(),a)})}function de(e,t,a,r){return s(this,null,function*(){let n=yield p(e);if(!n.queryExtent)throw new i(r,"Layer source does not support queryExtent capability");return n.queryExtent(f.from(t)??e.createQuery(),a)})}function pe(e,t,a,r){return s(this,null,function*(){let n=yield p(e);if(!n.queryRelatedFeatures)throw new i(r,"Layer source does not support queryRelatedFeatures capability");return n.queryRelatedFeatures(w.from(t),a)})}function ye(e,t,a,r){return s(this,null,function*(){let n=yield p(e);if(!n.queryRelatedFeaturesCount)throw new i(r,"Layer source does not support queryRelatedFeaturesCount capability");return n.queryRelatedFeaturesCount(w.from(t),a)})}function fe(e){return s(this,null,function*(){let t=e.source;if(t?.refresh)try{let{dataChanged:a,updates:r}=yield t.refresh();if(r!=null&&(e.sourceJSON=b(b({},e.sourceJSON),r),e.read(r,{origin:"service",url:e.parsedUrl})),a)return!0}catch{}if(e.definitionExpression)try{return(yield j(e.definitionExpression,e.fieldsIndex)).hasDateFunctions}catch{}return!1})}function me(e){let t=new f,a=e.capabilities?.data,r=e.capabilities?.query;t.historicMoment=e.historicMoment,t.gdbVersion=e.gdbVersion,t.returnGeometry=!0,r&&(t.compactGeometryEnabled=r.supportsCompactGeometry,t.defaultSpatialReferenceEnabled=r.supportsDefaultSpatialReference),a&&(a.supportsZ&&e.returnZ!=null&&(t.returnZ=e.returnZ),a.supportsM&&e.returnM!=null&&(t.returnM=e.returnM)),t.outFields=["*"];let{timeOffset:n,timeExtent:o}=e;return t.timeExtent=n!=null&&o!=null?o.offset(-n.value,n.unit):o||null,t.multipatchOption=e.geometryType==="multipatch"?"xyFootprint":null,t}function he(e){let{globalIdField:t,fields:a}=e;if(t)return t;if(a){for(let r of a)if(r.type==="esriFieldTypeGlobalID")return r.name}}function be(e){let{objectIdField:t,fields:a}=e;if(t)return t;if(a){for(let r of a)if(r.type==="esriFieldTypeOID")return r.name}}function we(e){return e.currentVersion?e.currentVersion:e.hasOwnProperty("capabilities")||e.hasOwnProperty("drawingInfo")||e.hasOwnProperty("hasAttachments")||e.hasOwnProperty("htmlPopupType")||e.hasOwnProperty("relationships")||e.hasOwnProperty("timeInfo")||e.hasOwnProperty("typeIdField")||e.hasOwnProperty("types")?10:9.3}function p(e){return s(this,null,function*(){return(yield e.load()).source})}function D(e,t){return s(this,null,function*(){if(!m||m.findCredential(e))return;let a;try{let r=yield R(e,t);r&&(a=yield m.checkSignInStatus(`${r}/sharing`))}catch{}if(a)try{let r=t!=null?t.signal:null;yield m.getCredential(e,{signal:r})}catch{}})}function ge(e,t,a){return s(this,null,function*(){let r=e.parsedUrl?.path;r&&e.authenticationTriggerEvent===t&&(yield D(r,a))})}function Ie(e){return!e.sourceJSON?.isMultiServicesView&&(e.userHasUpdateItemPrivileges||e.editingEnabled)}var g=O({types:C});function qe(e,t){if(e.defaultSymbol)return e.types?.length?new P({defaultSymbol:g(e.defaultSymbol,e,t),field:e.typeIdField,uniqueValueInfos:e.types.map(a=>({id:a.id,symbol:g(a.symbol,a,t)}))}):new E({symbol:g(e.defaultSymbol,e,t)})}function Fe(e){let t=e.sourceJSON?.cacheMaxAge;if(!t)return!1;let a=e.editingInfo?.lastEditDate?.getTime();return a==null||(t*=1e3,Date.now()-a<t)}function v(e,t,a){return s(this,null,function*(){if(t==null)return null;let r=[],{objectIdField:n}=e;if(t.forEach(u=>{let l=null;if("attributes"in u){let{attributes:d}=u;l={globalId:d[a],objectId:d[n]!=null&&d[n]!==-1?d[n]:null}}else l={globalId:u.globalId,objectId:u.objectId!=null&&u.objectId!==-1?u.objectId:null};l.globalId!=null&&(l.objectId!=null&&l.objectId!==-1||r.push(l.globalId))}),r.length===0)return null;let o=e.createQuery();o.where=r.map(u=>`${a}='${u}'`).join(" OR "),o.returnGeometry=!1,o.outFields=[n,a],o.cacheHint=!1;let c=yield x(S(e,o));if(!c.ok)return null;let y=new Map,h=c.value.features;for(let u of h){let l=u.attributes[a],d=u.attributes[n];l!=null&&d!=null&&d!==-1&&y.set(l,d)}return y})}export{te as a,re as b,ae as c,ne as d,oe as e,se as f,ie as g,ue as h,ce as i,le as j,de as k,pe as l,ye as m,fe as n,me as o,he as p,be as q,we as r,ge as s,Ie as t,qe as u,Fe as v,v as w};
