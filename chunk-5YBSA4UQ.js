import{b as le,e as pe,g as ce,h as K,i as J,j as de,k as ue,l as he,m as me,n as V,o as kt}from"./chunk-76VP5DTV.js";import{b as ee,m as w,p as fe,q as ye,s as ge,t as q,v as we}from"./chunk-VOKUEHPE.js";import{a as te,c as Y}from"./chunk-EXOOWX4Z.js";import{e as oe,f as ie,g as xt,h as re,i as Ot,j as se,k as _t,l as ne,m as ae,n as ve}from"./chunk-4OBRNGC3.js";import{i as xe,k as Oe,n as _e,o as ke}from"./chunk-XFFRGEY6.js";import{e as $t,n as wt}from"./chunk-DF75A5VT.js";import{b as Kt,f as Jt,j as U,k as R,m as Qt}from"./chunk-O73QQ7Z7.js";import{a as Xt}from"./chunk-KKUKUFSJ.js";import{f as Yt,o as qt,p as Bt,w as Wt}from"./chunk-VIK3ZB6O.js";import{d as H}from"./chunk-SJTQM4NH.js";import{a as jt}from"./chunk-UXJVKRGT.js";import{a as Nt}from"./chunk-47Q3ZDMA.js";import{a as Zt}from"./chunk-KQMHXU66.js";import{b as E,c as X,d as Ht,e as Dt,f as Lt,g as yt,o as gt,x as vt}from"./chunk-2ETHV3H2.js";import{a as Pt,d as dt,h as At}from"./chunk-4XUOIGFO.js";import{c as Ft,d as zt,l as mt,z as ft}from"./chunk-OZF6BMOL.js";import{a as Gt,c as Mt,e as ht}from"./chunk-GJP6PTKT.js";import{b as ct}from"./chunk-SF6Z2K5H.js";import{a as St}from"./chunk-GBTN5LIS.js";import{e as Et}from"./chunk-JOSG37QF.js";import{_ as j,aa as ut}from"./chunk-4JWMB5SM.js";import{H as pt,L as s,O as W}from"./chunk-AUTL5LCV.js";import{S as m}from"./chunk-KUJG22IX.js";import{a as r}from"./chunk-W3WDPWBE.js";import{a as Z}from"./chunk-GISCFF3Z.js";import{b as B}from"./chunk-MLSR6YE6.js";import{a as lt,b as Ct,h as g}from"./chunk-EAH6BNBL.js";var y;(function(t){t[t.NeverApplied=0]="NeverApplied",t[t.Applied=1]="Applied",t[t.Undone=2]="Undone"})(y||(y={}));var k;(function(t){t.UndoRedoUpdating="UndoRedoUpdating",t.UndoInvalidError="UndoInvalidError",t.RedoInvalidError="RedoInvalidError",t.ApplyInvalidError="ApplyInvalidError"})(k||(k={}));var tt={[k.UndoRedoUpdating]:"Cannot perform operation whilst undo redo is updating",[k.UndoInvalidError]:"There are no items to Undo",[k.RedoInvalidError]:"There are no items to Redo",[k.ApplyInvalidError]:"Cannot apply an item that is already applied"},C=class extends Error{constructor(){super(tt[k.UndoRedoUpdating]),this.type="undo-redo-updating-error"}},P=class extends Error{constructor(){super(tt[k.UndoInvalidError]),this.type="undo-redo-undo-error"}},Q=class extends Error{constructor(){super(tt[k.RedoInvalidError]),this.type="undo-redo-redo-error"}},$=class extends Error{constructor(){super(tt[k.ApplyInvalidError]),this.type="undo-redo-apply-error"}};var I;(function(t){t[t.Apply=0]="Apply",t[t.Undo=1]="Undo",t[t.Redo=2]="Redo"})(I||(I={}));var et=class extends W{constructor(){super(...arguments),this.name="",this.tag=Symbol(),this.status=y.NeverApplied}get canUndo(){return this.status===y.Applied}get canRedo(){return this.status===y.Undone}executeUndoRedoOperation(t){return g(this,null,function*(){switch(t){case I.Apply:if(this.status!==y.NeverApplied)throw new $;return yield this.apply(),void(this.status=y.Applied);case I.Undo:if(this.status!==y.Applied)throw new P;return yield this.undo(),void(this.status=y.Undone);case I.Redo:if(this.status!==y.Undone)throw new P;return yield this.redo(),void(this.status=y.Applied)}})}};r([s()],et.prototype,"name",void 0),r([s()],et.prototype,"tag",void 0),et=r([m("esri.undoredo.UndoableOperation")],et);var O=class extends W{constructor(){super(...arguments),this._stack=new ct,this._stackPosition=-1,this._updatingHandles=new Nt}get updating(){return this._updatingHandles.updating}get canUndo(){return this.hasUndo&&!this.updating}get hasUndo(){return this._stackPosition>=0}get canRedo(){return this.hasRedo&&!this.updating}get hasRedo(){return this._stackPosition<this._stack.length-1}_truncateForwardStack(){this._stack.splice(this._stackPosition+1,this._stack.length-this._stackPosition).forEach(t=>t.destroy())}_drainStack(){this._stack.drain(t=>t.destroy()),this._stackPosition=-1}undo(){return g(this,null,function*(){if(!this.hasUndo)throw new P;if(this.updating)throw new C;let t=this._stack.getItemAt(this._stackPosition);yield this._updatingHandles.addPromise(g(this,null,function*(){yield t.executeUndoRedoOperation(I.Undo),--this._stackPosition,t.canRedo||this._truncateForwardStack()}))})}redo(){return g(this,null,function*(){if(!this.hasRedo)throw new Q;if(this.updating)throw new C;let t=this._stack.getItemAt(this._stackPosition+1);yield this._updatingHandles.addPromise(g(this,null,function*(){yield t.executeUndoRedoOperation(I.Redo),++this._stackPosition}))})}peekUndo(){return this.canUndo?this._stack.getItemAt(this._stackPosition):null}peekRedo(){return this.canRedo?this._stack.getItemAt(this._stackPosition+1):null}inject(t){return g(this,null,function*(){if(this.updating)throw new C;yield this._updatingHandles.addPromise(g(this,null,function*(){t.status===y.NeverApplied&&(yield t.executeUndoRedoOperation(I.Apply)),t.canUndo?(this._stack.splice(this._stackPosition+1,0,t),this._stackPosition++):this._stackPosition>-1&&(this._stack.splice(0,this._stackPosition+1).forEach(e=>e.destroy()),this._stackPosition=-1)}))})}add(t){return g(this,null,function*(){if(this.updating)throw new C;yield this._updatingHandles.addPromise(g(this,null,function*(){t.status===y.NeverApplied&&(yield t.executeUndoRedoOperation(I.Apply)),this._stackPosition>=-1&&this._truncateForwardStack(),t.canUndo?(this._stack.push(t),this._stackPosition=this._stack.length-1):this._drainStack()}))})}removeTagged(t,e=!1){return g(this,null,function*(){if(this.updating&&!e)return;yield dt(()=>!this.updating);let i=new ct;for(let o=0;o<this._stack.length;o++){let n=this._stack.getItemAt(o);n.tag===t?(n.destroy(),o===this._stackPosition&&(this._stackPosition=i.length-1)):i.push(n)}this._stack=i,this._stackPosition>i.length-1&&(this._stackPosition=i.length-1)})}clear(t=!1){return g(this,null,function*(){if(this.updating&&!t)throw new C;yield dt(()=>!this.updating),this._drainStack()})}};r([s()],O.prototype,"_stack",void 0),r([s()],O.prototype,"_stackPosition",void 0),r([s()],O.prototype,"updating",null),r([s({readOnly:!0})],O.prototype,"canUndo",null),r([s({readOnly:!0})],O.prototype,"hasUndo",null),r([s({readOnly:!0})],O.prototype,"canRedo",null),r([s({readOnly:!0})],O.prototype,"hasRedo",null),O=r([m("esri.UndoRedo")],O);var ot=class{constructor(){this.committedVertices=null,this.cursorVertex=null,this.full=null,this.outline=null,this.cursorEdge=null,this.circle=null,this.rectangle=null}};function it(t,e){switch(t){case"point":case"multipoint":return He();case"polyline":return De(e);case"polygon":return Le(e);default:return}}function He(t){return"point"}function De(t){return(t!=null&&t.type==="polyline"&&t.paths.length?t.paths[0].length:0)<2?"polylineZeroVertices":"polylineOneVertex"}function Le(t){let e=t!=null&&t.type==="polygon"&&t.rings.length?t.rings[0].length:0;return e<3?"polylineZeroVertices":e<4?"polygonOneVertex":"polygonTwoVertices"}function Ie(t,e){let i=t?.geometry;if(!t||i?.type!=="mesh"||!e)return;let{renderCoordsHelper:o,elevationProvider:n}=e,{camera:a}=e.state,{extent:p}=i,{center:h,spatialReference:l}=p,u=ut(l),f=j(l),v=ut(o.spatialReference),S=p.width*u,d=p.height*f,M=(p.zmax??0)*f,_=M-(p.zmin??0)*f,F=Math.max(S,d,_)/v,{x:z,y:at}=h,Rt=h.z??0;Ft(rt,z,at,Rt),o.toRenderCoords(rt,l,rt);let Vt=F/a.computeScreenPixelSizeAt(rt);if(Vt>a.width*Ze)return"meshTooClose";if(Vt<Ne)return"meshTooFar";let Fe=Yt(t),{absoluteZ:ze}=Bt(z,at,M,l,e,Fe);return ze<(n.getElevation(z,at,Rt,l,"ground")??0)*f+_*je?"meshUnderground":"mesh"}var Ne=20,Ze=1,je=.1,rt=Gt();var T=class extends w{constructor(t){super(t),this.type="draw-circle",this.radius=null,this.xSize=null,this.ySize=null,this.area=R}get allFields(){return[]}};r([s()],T.prototype,"type",void 0),r([s()],T.prototype,"radius",void 0),r([s()],T.prototype,"xSize",void 0),r([s()],T.prototype,"ySize",void 0),r([s()],T.prototype,"area",void 0),r([s()],T.prototype,"allFields",null),T=r([m("esri.views.interactive.tooltip.infos.DrawCircleTooltipInfo")],T);var D=class extends V(w){constructor(t){super(t),this.type="draw-mesh",this.orientation=ue({lockable:!1}),this.scale=he({lockable:!1})}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}};r([s()],D.prototype,"helpMessage",void 0),r([s()],D.prototype,"allFields",null),D=r([m("esri.views.interactive.tooltip.infos.DrawMeshTooltipInfo")],D);var L=class extends V(w){constructor(t){super(t),this.type="draw-point"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};r([s()],L.prototype,"helpMessage",void 0),r([s()],L.prototype,"allFields",null),L=r([m("esri.views.interactive.tooltip.infos.DrawPointTooltipInfo")],L);var A=class extends V(w){constructor(t){super(t),this.type="draw-polygon",this.direction=K(),this.distance=J({title:e=>e.messages.sketch.distance}),this.area=me(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.area]}};r([s()],A.prototype,"xyMode",void 0),r([s()],A.prototype,"helpMessage",void 0),r([s()],A.prototype,"allFields",null),A=r([m("esri.views.interactive.tooltip.infos.DrawPolygonTooltipInfo")],A);var G=class extends V(w){constructor(t){super(t),this.type="draw-polyline",this.direction=K(),this.distance=J({title:e=>e.messages.sketch.distance}),this.totalLength=de(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.totalLength]}};r([s()],G.prototype,"helpMessage",void 0),r([s()],G.prototype,"xyMode",void 0),r([s()],G.prototype,"allFields",null),G=r([m("esri.views.interactive.tooltip.infos.DrawPolylineTooltipInfo")],G);var b=class extends w{constructor(t){super(t),this.type="draw-rectangle",this.xSize=U,this.ySize=U,this.area=R}get allFields(){return[]}};r([s()],b.prototype,"type",void 0),r([s()],b.prototype,"xSize",void 0),r([s()],b.prototype,"ySize",void 0),r([s()],b.prototype,"area",void 0),r([s()],b.prototype,"allFields",null),b=r([m("esri.views.interactive.tooltip.infos.DrawRectangleTooltipInfo")],b);function Te(t,e){return{point:new L({sketchOptions:e,viewType:t}),polyline:new G({sketchOptions:e,viewType:t}),polygon:new A({sketchOptions:e,viewType:t}),mesh:new D({sketchOptions:e,viewType:t}),rectangle:new b({sketchOptions:e}),circle:new T({sketchOptions:e})}}function It(t){let{directionOptions:e,geometryType:i,sketchOptions:o,tooltipInfos:n}=t,a=h=>{let l=nt(t).mode,u=n[h].elevation;l==="relative-to-ground"||l==="relative-to-scene"||l==="on-the-ground"?u.lock(Ut(t)):u.unlock()},p=h=>{if(e){let l=n[h].direction;l.committed=e.angle,l.unlockOnVertexPlacement=!1,o.values.directionMode=e.mode}};switch(i){case"polygon":case"polyline":a(i),p(i);break;case"point":case"mesh":a(i)}}function Ue(t,e){let{drawOperation:i,view:o}=e,n=st(e),a=nt(e);if(o.type==="2d"||!t||a.mode!=="absolute-height"||i?.numCommittedVertices!==1||!n||n.type!=="draw-polyline"&&n.type!=="draw-polygon"||n.elevation.locked)return;let[p,h,l]=t,u=to(p,h,l,a,e);u!=null&&n.elevation.lock(u)}function Tt(t){st(t)?.allFields.forEach(e=>{e.unlockOnVertexPlacement&&e.unlock()})}function st({geometryType:t,graphic:e,tooltipInfos:i}){return t==="multipoint"||e?.geometry?.type!==Ye[t]?null:i[t]}var Ye={point:"point",mesh:"mesh",polyline:"polyline",polygon:"polygon",circle:"polygon",rectangle:"polygon"};function be(t,e){switch(t?.type){case"draw-point":qe(t,e);break;case"draw-polyline":We(t,e);break;case"draw-polygon":Xe(t,e);break;case"draw-rectangle":Je(t,e);break;case"draw-circle":Qe(t,e);break;case"draw-mesh":Be(t,e)}}function qe(t,e){let i=e.graphic?.geometry;i?.type==="point"&&(Re(t,i,e),t.helpMessage=it("point",i))}function Be(t,e){let{graphic:i,view:o}=e,n=i?.geometry;o.type==="3d"&&n?.type==="mesh"&&(Re(t,n.origin,e),le(t,n),t.helpMessage=Ie(i,o))}function Re(t,e,i){let{drawOperation:o,view:n,sketchOptions:a}=i,{cursorVertex:p}=o;if(t.sketchOptions=a,t.viewType=n.type,t.setLocationFromPoint(e,N(i)),Ce(t.elevation,i),!p)return void(o.constraints=void 0);let h=p;o.constraints={context:Ge(h,i),x:t.x.committed,y:t.y.committed,longitude:t.longitude.committed,latitude:t.latitude.committed,elevation:t.elevation.committed,distance:null,direction:null}}function We(t,e){let{createOperationGeometry:i,drawOperation:o}=e,n=i!=null?i.full:null;n?.type==="polyline"&&(Ve(t,e),t.totalLength.actual=o.lastVertex?ge(n)??U:null,t.helpMessage=it("polyline",n))}function Xe(t,e){let{createOperationGeometry:i,drawOperation:o}=e,n=i!=null?i.full:null;n?.type==="polygon"&&(Ve(t,e),t.area.actual=o.lastVertex?kt(n)??R:null,t.helpMessage=it("polygon",n))}function Ve(t,e){let{drawOperation:i,sketchOptions:o,view:n}=e,{cursorVertex:a,lastVertex:p,secondToLastVertex:h}=i,l=o.values.effectiveDirectionMode;t.sketchOptions=o,t.viewType=n.type;let u=p&&a?q(p,a)??U:null;if(t.distance.actual=u,t.distance.readOnly=p==null,t.direction.actual=null,t.direction.readOnly=!0,p&&a&&(l==="absolute"||h)){let S=$t(h,p,a,l);t.direction.actual=S??Qt,t.direction.readOnly=!1}t.setLocationFromPoint(a,N(e)),Ce(t.elevation,e);let f=Ke(p,e);t.xyMode=f,t.direction.visible=f==="direction-distance",t.distance.visible=f==="direction-distance",t.effectiveX.visible=f==="coordinates",t.effectiveY.visible=f==="coordinates";let v=a??p;i.constraints=v?{context:Ge(v,e),x:t.x.committed,y:t.y.committed,longitude:t.longitude.committed,latitude:t.latitude.committed,elevation:t.elevation.committed,distance:t.distance.committed,direction:t.direction.committed}:void 0}function Ke(t,{sketchOptions:e}){let i=e.tooltips.xyMode;return i==="auto"?t?"direction-distance":"coordinates":i}function Je(t,e){t.sketchOptions=e.sketchOptions,t.xSize=Ee(e),t.ySize=Pe(e),t.area=Se(e)}function Qe(t,e){let{forceUniformSize:i,sketchOptions:o}=e;t.sketchOptions=o,t.radius=i?$e(e):null,t.xSize=i?null:Ee(e),t.ySize=i?null:Pe(e),t.area=Se(e)}function Ce(t,e){let{drawOperation:i}=e,o=i?.cursorVertex??i?.lastVertex;t.actual=fe(o)??Ut(e),t.visible=i.hasZ,t.readOnly=!1,t.showAsZ=!0}function Se(t){let e=t.createOperationGeometry?.full;return e?.type!=="polygon"?R:kt(e)??R}function Ee(t){let e=t.createOperationGeometry?.rectangle?.midpoints;return(e!=null?q(e.left,e.right):null)??U}function Pe(t){let e=t.createOperationGeometry?.rectangle?.midpoints;return(e!=null?q(e.top,e.bottom):null)??U}function $e({createOperationGeometry:t}){return(t?.circle?.center!=null&&t.circle.edge!=null?q(t.circle.center,t.circle.edge):null)??U}function Ae(t){let{geometryType:e,tooltipInfos:i}=t;switch(e){case"point":case"mesh":case"polyline":case"polygon":{let o=i[e].elevation.committed;return o?Jt(o,"meters")/j(N(t)):void 0}default:return}}function to(t,e,i,o,n){let{view:a,drawOperation:p}=n;if(a.type!=="3d"||!p)return;i??=0;let h=N(n),l=nt(n),u=qt(a,t,e,i,h,l,o);return ye(u,h)??Ut(n)}function nt(t){return t.drawOperation.elevationInfo??Wt}function N(t){return t.drawOperation.coordinateHelper.spatialReference}function Ut(t){let e=j(N(t));return Kt(t.defaultZ*e,"meters")}function Ge(t,e){return ae(t,e.view,N(e),nt(e),e.drawOperation.coordinateHelper.hasZ(),e.sketchOptions.values.effectiveDirectionMode)}var c=class extends St.EventedMixin(ve){constructor(t){super(t),this._graphic=null,this._coordinateFormatterLoadTask=null,this._createOperationGeometry=null,this.defaultZ=0,this.directionOptions=null,this.geometryType=null,this.hasZ=!0,this.geometryToPlace=null,this.snappingManager=null,this.snapToScene=!1,this.sketchOptions=new wt}initialize(){let{view:t}=this;this.internalGraphicsLayer=new Xt({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer);let e=this.drawOperation=this.makeDrawOperation();this.tooltipInfos=Te(t.type,this.sketchOptions);let i=this.tooltip=new we({view:t});It(this._tooltipsContext),this._coordinateFormatterLoadTask=Et(()=>ee()),this.addHandles([e.on("vertex-add",o=>this.onVertexAdd(o)),e.on("vertex-remove",o=>this.onVertexRemove(o)),e.on("vertex-update",o=>this.onVertexUpdate(o)),e.on("cursor-update",o=>this.onCursorUpdate(o)),e.on("cursor-remove",()=>this._updateGraphic()),e.on("complete",o=>this.onComplete(o)),this._coordinateFormatterLoadTask,i.on("paste",o=>ce(o,this.activeTooltipInfo)),Pt(()=>this.cursor,o=>{e.cursor=o},At),pt(()=>{let{activeTooltipInfo:o,sketchOptions:n}=this;be(o,this._tooltipsContext),i.info=n.tooltips.effectiveEnabled?o:null}),pt(()=>{e.constraintZ=Ae(this._tooltipsContext)})]),this.finishToolCreation()}destroy(){this.drawOperation=B(this.drawOperation),this.tooltip=B(this.tooltip),this._destroyAllVisualizations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=B(this.internalGraphicsLayer),this._set("view",null)}get _drawSpatialReference(){return this.drawOperation.coordinateHelper.spatialReference}get _tooltipsContext(){return{createOperationGeometry:this._createOperationGeometry,defaultZ:this.defaultZ,directionOptions:this.directionOptions,drawOperation:this.drawOperation,forceUniformSize:this.forceUniformSize,geometryType:this.geometryType,graphic:this.graphic,sketchOptions:this.sketchOptions,tooltipInfos:this.tooltipInfos,view:this.view}}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(t){this._set("centered",t),this._updateGraphic()}get cursor(){return this._get("cursor")}set cursor(t){this._set("cursor",t)}set enabled(t){this.drawOperation.interactive=t,this._set("enabled",t)}set forceUniformSize(t){this._set("forceUniformSize",t),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(t){this._set("graphicSymbol",t),this._graphic!=null&&(this._graphic.symbol=t)}set mode(t){let e=this.drawOperation;e&&(e.drawingMode=t),this._set("mode",t)}get updating(){return this.drawOperation?.updating??!1}get undoRedo(){let{view:{type:t,map:e}}=this;return t==="2d"&&e&&"undoRedo"in e&&e.undoRedo instanceof O?e.undoRedo:null}set undoRedo(t){this._override("undoRedo",t)}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(t){this.destroyed||pe(t,this.tooltip)||this.drawOperation.onInputEvent(t)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo(),this.drawOperation.numCommittedVertices===0&&It(this._tooltipsContext)}_destroyAllVisualizations(){this.removeHandles(x.outline),this.removeHandles(x.regularVertices),this.removeHandles(x.activeVertex),this.removeHandles(x.activeEdge),this.removeHandles(bt)}_createOrUpdateGraphic(t){if(this._graphic!=null)return this.updateGraphicGeometry(t),this._graphic;let e=new jt(Ct(lt({},this.graphicProperties),{symbol:this.graphicSymbol}));return this._graphic=e,this.updateGraphicGeometry(t),this.internalGraphicsLayer.add(e),this.addHandles(this.initializeGraphic(e)),this.notifyChange("graphic"),this.addHandles(Z(()=>{this.internalGraphicsLayer.remove(e),this._graphic===e&&(this._graphic=null)}),bt),e}updateGraphicGeometry(t){this._graphic.geometry=t}_getCreateOperationGeometry(t={operationComplete:!1}){if(this.drawOperation==null)return;let{coordinateHelper:e,view:i,visualizationCursorVertex:o,lastVertex:n,committedVertices:a,geometryIncludingUncommittedVertices:p,numCommittedVertices:h}=this.drawOperation;if(!(h>0||o!=null))return;let l=t.operationComplete?a:p,u=l.length,f=o!=null?e.pointToArray(o):null,v=this._drawSpatialReference,S=i.type==="3d"&&i.viewingMode==="global",d=new ot;d.committedVertices=a,d.cursorVertex=f;let{geometryType:M}=this;switch(M){case"point":case"mesh":d.full=e.arrayToPoint(l[0]);break;case"multipoint":d.full=u>0?ie(l,v):null;break;case"polyline":case"polygon":u>0&&(d.full=M==="polygon"?re([l],v,S,!0):xt([l],v,S),d.cursorEdge=f!=null&&n&&!Zt(o,n)?xt([[f,e.pointToArray(n)]],v,S):null,d.outline=u>1?d.full:null);break;case"circle":case"rectangle":{if(d.committedVertices=d.cursorVertex=null,!u)break;let _=oe(i,l[0]),F=l[0],z=_.makeMapPoint(F[0]+eo*i.resolution,F[1]);M==="circle"?u===1&&t.operationComplete?d.circle=_t([F,z],_,!0):u===2&&(this.forceUniformSize?d.circle=_t(l,_,this.centered):d.rectangle=ne(l,_,this.centered)):u===1&&t.operationComplete?d.rectangle=Ot([F,z],_,!0):u===2&&(d.rectangle=this.forceUniformSize?Ot(l,_,this.centered):se(l,_,this.centered)),d.full=d.circle!=null?d.circle.geometry:d.rectangle?.geometry,d.outline=d.full?.type==="polygon"?d.full:null;break}default:return null}return d}initializeGraphic(t){return Z()}onComplete(t){if(!this.drawOperation)return;this._updateGraphic();let e=null;if(this.drawOperation.isCompleted){let i=this._getCreateOperationGeometry({operationComplete:!0});i!=null&&(e=this._createOrUpdateGraphic(i.full))}this._createOperationGeometry=null,this.emit("complete",lt({graphic:e},t))}onCursorUpdate(t){this._updateGraphic(),this.emit("cursor-update",t)}onDeactivate(){let{drawOperation:t}=this;t&&(t.isCompleted||t.cancel())}onOutlineChanged(t){return Z()}onCursorEdgeChanged(t){return Z()}onVertexAdd(t){Tt(this._tooltipsContext),this._updateGraphic(),Ue(t.vertices.at(0)?.coordinates,this._tooltipsContext),this.emit("vertex-add",t)}onVertexRemove(t){Tt(this._tooltipsContext),this._updateGraphic(),this.emit("vertex-remove",t)}onVertexUpdate(t){this._updateGraphic(),this.emit("vertex-update",t)}_updateGraphic(){let t=this._getCreateOperationGeometry();this._createOperationGeometry=t,t!=null?(t.cursorEdge!=null?this.addHandles(this.onCursorEdgeChanged(t.cursorEdge),x.activeEdge):this.removeHandles(x.activeEdge),t.outline!=null?this.addHandles(this.onOutlineChanged(t.outline),x.outline):this.removeHandles(x.outline),t.committedVertices!=null?this.addHandles(this.onRegularVerticesChanged(t.committedVertices),x.regularVertices):this.removeHandles(x.regularVertices),t.cursorVertex!=null?this.addHandles(this.onActiveVertexChanged(t.cursorVertex),x.activeVertex):this.removeHandles(x.activeVertex),t.full!=null?this._createOrUpdateGraphic(t.full):this.removeHandles(bt)):this._destroyAllVisualizations()}get activeTooltipInfo(){return this._coordinateFormatterLoadTask?.finished?st(this._tooltipsContext):null}};r([s()],c.prototype,"_coordinateFormatterLoadTask",void 0),r([s()],c.prototype,"_createOperationGeometry",void 0),r([s()],c.prototype,"_tooltipsContext",null),r([s({value:!0})],c.prototype,"centered",null),r([s()],c.prototype,"cursor",null),r([s({nonNullable:!0})],c.prototype,"defaultZ",void 0),r([s({constructOnly:!0})],c.prototype,"directionOptions",void 0),r([s()],c.prototype,"drawOperation",void 0),r([s({value:!0})],c.prototype,"enabled",null),r([s({value:!0})],c.prototype,"forceUniformSize",null),r([s({constructOnly:!0})],c.prototype,"geometryType",void 0),r([s()],c.prototype,"graphic",null),r([s({constructOnly:!0})],c.prototype,"graphicProperties",void 0),r([s()],c.prototype,"graphicSymbol",null),r([s({constructOnly:!0})],c.prototype,"hasZ",void 0),r([s({constructOnly:!0})],c.prototype,"geometryToPlace",void 0),r([s()],c.prototype,"mode",null),r([s()],c.prototype,"snappingManager",void 0),r([s()],c.prototype,"snapToScene",void 0),r([s()],c.prototype,"tooltip",void 0),r([s()],c.prototype,"tooltipInfos",void 0),r([s({constructOnly:!0,type:wt})],c.prototype,"sketchOptions",void 0),r([s()],c.prototype,"updating",null),r([s({constructOnly:!0,nonNullable:!0})],c.prototype,"view",void 0),r([s({constructOnly:!0})],c.prototype,"undoRedo",null),r([s()],c.prototype,"activeTooltipInfo",null),c=r([m("esri.views.draw.DrawGraphicTool")],c);var bt=Symbol("create-operation-graphic"),x={outline:Symbol("outline-visual"),regularVertices:Symbol("regular-vertices-visual"),activeVertex:Symbol("active-vertex-visual"),activeEdge:Symbol("active-edge-visual")};function Lr(t){switch(t){case"point":case"polyline":case"polygon":case"multipoint":return t;case"circle":case"rectangle":return"segment";case"mesh":return"point"}}var eo=48;function ts(t,e){return Me(t,e,!1)}function es(t,e){return Me(t,e,!0)}function Me(t,e,i){if(t instanceof xe){if(t.operation instanceof Oe)return oo(t.operation,e,i),!0;if(t.operation instanceof _e)return io(t.operation,e,i),!0;if(t.operation instanceof ke)return ro(t.operation,e,i),!0}return!1}function oo(t,e,i=!1){let o=i?-1:1,n=Mt(o*t.dx,o*t.dy,o*t.dz);zt(e.origin,e.origin,n),Y(e)}function io(t,e,i=!1){let o=i?-t.angle:t.angle;ft(e.basis1,e.basis1,ht,o),ft(e.basis2,e.basis2,ht,o),Y(e)}function ro(t,e,i=!1){let o=i?1/t.factor1:t.factor1,n=i?1/t.factor2:t.factor2;mt(e.basis1,e.basis1,o),mt(e.basis2,e.basis2,n),vt(e.origin,e.origin,t.origin,t.axis1,o),vt(e.origin,e.origin,t.origin,t.axis2,n),Y(e)}function os(t,e,i,o){o||(o=te());let n=E(H.get(),t[1],-t[0]),a=E(H.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),p=E(H.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),h=H.get();e.components.forEach(f=>f.vertices.forEach(({pos:v})=>{E(h,gt(t,v),gt(n,v)),Dt(a,a,h),Lt(p,p,h)}));let l=1e-6,u=E(H.get(),p[0]-a[0]<l?i/2:0,p[1]-a[1]<l?i/2:0);return Ht(a,a,u),X(p,p,u),yt(o.basis1,t,(p[0]-a[0])/2),yt(o.basis2,n,(p[1]-a[1])/2),E(o.origin,a[0]*t[0]+a[1]*n[0],a[0]*t[1]+a[1]*n[1]),X(o.origin,o.origin,o.basis1),X(o.origin,o.origin,o.basis2),Y(o),o}export{c as a,Lr as b,ts as c,es as d,os as e};
