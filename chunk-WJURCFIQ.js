import{a as Z,e as bt,g as Dt,h as Yt,i as me,k as qe}from"./chunk-FT46PIGB.js";import{a as Ke,d as Vt}from"./chunk-YUIUJIOR.js";import{b as Je,c as Ot,d as pe,e as de}from"./chunk-VAIXCJGK.js";import{a as he}from"./chunk-MFP2OFDR.js";import{a as He,j as We,t as fe}from"./chunk-UI76XBLJ.js";import{a as je,b as ze}from"./chunk-UE2YGKE7.js";import{a as Kt}from"./chunk-FIITBHDP.js";import{a as _e}from"./chunk-VSVNPPHQ.js";import{F as G,P as Ve,Q as gt}from"./chunk-VWEBO6QK.js";import{S as mt}from"./chunk-KAAR5ZJN.js";import{a as D}from"./chunk-W3WDPWBE.js";import{g as Be,j as Fe}from"./chunk-WKT5W7KT.js";import{a as Mt}from"./chunk-MLSR6YE6.js";import{b as qt}from"./chunk-VU5W7W6Y.js";import{b as $,p as ce,r as dt}from"./chunk-X3IDZTNG.js";import{a as X,b as Q,h as ft}from"./chunk-EAH6BNBL.js";var ge,Ye,Xe,Ze={exports:{}};Ye=Ze,ge=function(){function t(){this.pos=0,this.bufferLength=0,this.eof=!1,this.buffer=null}return t.prototype={ensureBuffer:function(e){var r=this.buffer,n=r?r.byteLength:0;if(e<n)return r;for(var l=512;l<e;)l<<=1;for(var s=new Uint8Array(l),f=0;f<n;++f)s[f]=r[f];return this.buffer=s},getByte:function(){for(var e=this.pos;this.bufferLength<=e;){if(this.eof)return null;this.readBlock()}return this.buffer[this.pos++]},getBytes:function(e){var r=this.pos;if(e){this.ensureBuffer(r+e);for(var n=r+e;!this.eof&&this.bufferLength<n;)this.readBlock();var l=this.bufferLength;n>l&&(n=l)}else{for(;!this.eof;)this.readBlock();n=this.bufferLength}return this.pos=n,this.buffer.subarray(r,n)},lookChar:function(){for(var e=this.pos;this.bufferLength<=e;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos])},getChar:function(){for(var e=this.pos;this.bufferLength<=e;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos++])},makeSubStream:function(e,r,n){for(var l=e+r;this.bufferLength<=l&&!this.eof;)this.readBlock();return new Stream(this.buffer,e,r,n)},skip:function(e){e||(e=1),this.pos+=e},reset:function(){this.pos=0}},t}(),(Xe=function(){if(!self||!self.Uint32Array)return null;var t=new Uint32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),e=new Uint32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),r=new Uint32Array([1,2,3,4,65541,65543,131081,131085,196625,196633,262177,262193,327745,327777,393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,724993,727041,794625,798721,868353,876545]),n=[new Uint32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,459020,524392,524328,59e4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,524356,590056,459014,524380,524316,589976,459030,524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,590072,459009,524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,524350,590044,459023,524398,524334,590012,524302,524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,590018,459016,524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,524365,590074,459009,524371,524307,524571,459025,524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,590054,459013,524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,524336,590017,459016,524384,524320,589985,524288,524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,590033,459020,524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,524354,590053,459013,524378,524314,589973,459029,524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,590069,459011,524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,524345,590035,459020,524393,524329,590003,524297,524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,590027,459018,524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,524363,590071,459011,524375,524311,524575,459027,524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,590063,459015,524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9],l=[new Uint32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];function s(o){throw new Error(o)}function f(o){var a=0,u=o[a++],i=o[a++];u!=-1&&i!=-1||s("Invalid header in flate stream"),(15&u)!=8&&s("Unknown compression method in flate stream"),((u<<8)+i)%31!=0&&s("Bad FCHECK in flate stream"),32&i&&s("FDICT bit set in flate stream"),this.bytes=o,this.bytesPos=a,this.codeSize=0,this.codeBuf=0,ge.call(this)}return f.prototype=Object.create(ge.prototype),f.prototype.getBits=function(o){for(var a,u=this.codeSize,i=this.codeBuf,c=this.bytes,p=this.bytesPos;u<o;)(a=c[p++])===void 0&&s("Bad encoding in flate stream"),i|=a<<u,u+=8;return a=i&(1<<o)-1,this.codeBuf=i>>o,this.codeSize=u-=o,this.bytesPos=p,a},f.prototype.getCode=function(o){for(var a=o[0],u=o[1],i=this.codeSize,c=this.codeBuf,p=this.bytes,C=this.bytesPos;i<u;){var g;(g=p[C++])===void 0&&s("Bad encoding in flate stream"),c|=g<<i,i+=8}var w=a[c&(1<<u)-1],S=w>>16,h=65535&w;return(i==0||i<S||S==0)&&s("Bad encoding in flate stream"),this.codeBuf=c>>S,this.codeSize=i-S,this.bytesPos=C,h},f.prototype.generateHuffmanTable=function(o){for(var a=o.length,u=0,i=0;i<a;++i)o[i]>u&&(u=o[i]);for(var c=1<<u,p=new Uint32Array(c),C=1,g=0,w=2;C<=u;++C,g<<=1,w<<=1)for(var S=0;S<a;++S)if(o[S]==C){var h=0,d=g;for(i=0;i<C;++i)h=h<<1|1&d,d>>=1;for(i=h;i<c;i+=w)p[i]=C<<16|S;++g}return[p,u]},f.prototype.readBlock=function(){function o(O,W,V,F,z){for(var Y=O.getBits(V)+F;Y-- >0;)W[w++]=z}var a=this.getBits(3);if(1&a&&(this.eof=!0),(a>>=1)!=0){var u,i;if(a==1)u=n,i=l;else if(a==2){for(var c=this.getBits(5)+257,p=this.getBits(5)+1,C=this.getBits(4)+4,g=Array(t.length),w=0;w<C;)g[t[w++]]=this.getBits(3);for(var S=this.generateHuffmanTable(g),h=0,d=(w=0,c+p),m=new Array(d);w<d;){var y=this.getCode(S);y==16?o(this,m,2,3,h):y==17?o(this,m,3,3,h=0):y==18?o(this,m,7,11,h=0):m[w++]=h=y}u=this.generateHuffmanTable(m.slice(0,c)),i=this.generateHuffmanTable(m.slice(c,d))}else s("Unknown block type in flate stream");for(var v=(M=this.buffer)?M.length:0,k=this.bufferLength;;){var b=this.getCode(u);if(b<256)k+1>=v&&(v=(M=this.ensureBuffer(k+1)).length),M[k++]=b;else{if(b==256)return void(this.bufferLength=k);var x=(b=e[b-=257])>>16;x>0&&(x=this.getBits(x)),h=(65535&b)+x,b=this.getCode(i),(x=(b=r[b])>>16)>0&&(x=this.getBits(x));var T=(65535&b)+x;k+h>=v&&(v=(M=this.ensureBuffer(k+h)).length);for(var I=0;I<h;++I,++k)M[k]=M[k-T]}}}else{var A,E=this.bytes,P=this.bytesPos;(A=E[P++])===void 0&&s("Bad block header in flate stream");var R=A;(A=E[P++])===void 0&&s("Bad block header in flate stream"),R|=A<<8,(A=E[P++])===void 0&&s("Bad block header in flate stream");var L=A;(A=E[P++])===void 0&&s("Bad block header in flate stream"),(L|=A<<8)!=(65535&~R)&&s("Bad uncompressed block length in flate stream"),this.codeBuf=0,this.codeSize=0;var B=this.bufferLength,M=this.ensureBuffer(B+R),j=B+R;this.bufferLength=j;for(var N=B;N<j;++N){if((A=E[P++])===void 0){this.eof=!0;break}M[N]=A}this.bytesPos=P}},f}())!==void 0&&(Ye.exports=Xe);var wt=qt(Ze.exports);var Xt=class t{constructor(e){this._canvas=null,this._ctx=null,e&&(this._canvas=e.canvas,this._ctx=e.ctx||e.canvas&&e.canvas.getContext("2d"))}decode(e,r,n){if(!e||e.byteLength<10)throw new dt("imagecanvasdecoder: decode","required a valid encoded data as input.");let{width:l=0,height:s=0,format:f}=r,{applyJpegMask:o}=r;if(o&&(!l||!s))throw new dt("imagecanvasdecoder: decode","image width and height are needed to apply jpeg mask directly to canvas");return new Promise((a,u)=>{let i=null;f==="jpg"&&o&&(i=t._getMask(e,{width:l,height:s}));let c=new Blob([new Uint8Array(e)],{type:"image/"+f=="jpg"?"jpeg":f}),p=URL.createObjectURL(c),C=new Image,g;C.src=p,C.onload=()=>{if(URL.revokeObjectURL(p),Fe(n))return void u(Be());l=C.width,s=C.height,this._canvas&&this._ctx?(this._canvas.width===l&&this._canvas.height===s||(this._canvas.width=l,this._canvas.height=s),this._ctx.clearRect(0,0,l,s)):(this._canvas=document.createElement("canvas"),this._canvas.width=l,this._canvas.height=s,this._ctx=this._canvas.getContext("2d")),this._ctx.drawImage(C,0,0);let w=this._ctx.getImageData(0,0,l,s),S;if(g=w.data,r.renderOnCanvas){if(i)for(S=0;S<i.length;S++)i[S]?g[4*S+3]=255:g[4*S+3]=0;return this._ctx.putImageData(w,0,0),void a(null)}let h=l*s,d=new Uint8Array(h),m=new Uint8Array(h),y=new Uint8Array(h);if(i)for(S=0;S<h;S++)d[S]=g[4*S],m[S]=g[4*S+1],y[S]=g[4*S+2];else for(i=new Uint8Array(h),S=0;S<h;S++)d[S]=g[4*S],m[S]=g[4*S+1],y[S]=g[4*S+2],i[S]=g[4*S+3];a({width:l,height:s,pixels:[d,m,y],mask:i,pixelType:"u8"})},C.onerror=()=>{URL.revokeObjectURL(p),u("cannot load image")}})}static _getMask(e,r){let n=null;try{let l=new Uint8Array(e),s=Math.ceil(l.length/2),f=0,o=l.length-2;for(f=s;f<o&&(l[f]!==255||l[f+1]!==217);f++);if(f+=2,f<l.length-1){let a=new wt(l.subarray(f)).getBytes();n=new Uint8Array(r.width*r.height);let u=0;for(let i=0;i<a.length;i++)for(let c=7;c>=0;c--)n[u++]=a[i]>>c&1}}catch{}return n}};var $e,Qe,tr,er={exports:{}};$e=er,Qe=function(){var t=function(){function e(r){this.message="JPEG error: "+r}return e.prototype=new Error,e.prototype.name="JpegError",e.constructor=e,e}();return function(){if(!self||!self.Uint8ClampedArray)return null;var e=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),r=4017,n=799,l=3406,s=2276,f=1567,o=3784,a=5793,u=2896;function i(){this.decodeTransform=null,this.colorTransform=-1}function c(h,d){for(var m,y,v=0,k=[],b=16;b>0&&!h[b-1];)b--;k.push({children:[],index:0});var x,T=k[0];for(m=0;m<b;m++){for(y=0;y<h[m];y++){for((T=k.pop()).children[T.index]=d[v];T.index>0;)T=k.pop();for(T.index++,k.push(T);k.length<=m;)k.push(x={children:[],index:0}),T.children[T.index]=x.children,T=x;v++}m+1<b&&(k.push(x={children:[],index:0}),T.children[T.index]=x.children,T=x)}return k[0].children}function p(h,d,m){return 64*((h.blocksPerLine+1)*d+m)}function C(h,d,m,y,v,k,b,x,T){var I=m.mcusPerLine,A=m.progressive,E=d,P=0,R=0;function L(){if(R>0)return R--,P>>R&1;if((P=h[d++])===255){var U=h[d++];if(U)throw new t("unexpected marker "+(P<<8|U).toString(16))}return R=7,P>>>7}function B(U){for(var H=U;;){if(typeof(H=H[L()])=="number")return H;if(typeof H!="object")throw new t("invalid huffman sequence")}}function M(U){for(var H=0;U>0;)H=H<<1|L(),U--;return H}function j(U){if(U===1)return L()===1?1:-1;var H=M(U);return H>=1<<U-1?H:H+(-1<<U)+1}function N(U,H){var J=B(U.huffmanTableDC),tt=J===0?0:j(J);U.blockData[H]=U.pred+=tt;for(var it=1;it<64;){var ct=B(U.huffmanTableAC),et=15&ct,at=ct>>4;if(et!==0){var Nr=e[it+=at];U.blockData[H+Nr]=j(et),it++}else{if(at<15)break;it+=16}}}function O(U,H){var J=B(U.huffmanTableDC),tt=J===0?0:j(J)<<T;U.blockData[H]=U.pred+=tt}function W(U,H){U.blockData[H]|=L()<<T}var V=0;function F(U,H){if(V>0)V--;else for(var J=k,tt=b;J<=tt;){var it=B(U.huffmanTableAC),ct=15&it,et=it>>4;if(ct!==0){var at=e[J+=et];U.blockData[H+at]=j(ct)*(1<<T),J++}else{if(et<15){V=M(et)+(1<<et)-1;break}J+=16}}}var z,Y=0;function nt(U,H){for(var J,tt,it=k,ct=b,et=0;it<=ct;){var at=e[it];switch(Y){case 0:if(et=(tt=B(U.huffmanTableAC))>>4,(J=15&tt)==0)et<15?(V=M(et)+(1<<et),Y=4):(et=16,Y=1);else{if(J!==1)throw new t("invalid ACn encoding");z=j(J),Y=et?2:3}continue;case 1:case 2:U.blockData[H+at]?U.blockData[H+at]+=L()<<T:--et==0&&(Y=Y===2?3:0);break;case 3:U.blockData[H+at]?U.blockData[H+at]+=L()<<T:(U.blockData[H+at]=z<<T,Y=0);break;case 4:U.blockData[H+at]&&(U.blockData[H+at]+=L()<<T)}it++}Y===4&&--V==0&&(Y=0)}function Rt(U,H,J,tt,it){var ct=J%I;H(U,p(U,(J/I|0)*U.v+tt,ct*U.h+it))}function Lt(U,H,J){H(U,p(U,J/U.blocksPerLine|0,J%U.blocksPerLine))}var pt,st,yt,St,q,Ft,Tt=y.length;Ft=A?k===0?x===0?O:W:x===0?F:nt:N;var ut,kt,Ht,Wt,Ct=0;for(kt=Tt===1?y[0].blocksPerLine*y[0].blocksPerColumn:I*m.mcusPerColumn;Ct<kt;){var Jt=v?Math.min(kt-Ct,v):kt;for(st=0;st<Tt;st++)y[st].pred=0;if(V=0,Tt===1)for(pt=y[0],q=0;q<Jt;q++)Lt(pt,Ft,Ct),Ct++;else for(q=0;q<Jt;q++){for(st=0;st<Tt;st++)for(Ht=(pt=y[st]).h,Wt=pt.v,yt=0;yt<Wt;yt++)for(St=0;St<Ht;St++)Rt(pt,Ft,Ct,yt,St);Ct++}R=0,(ut=S(h,d))&&ut.invalid&&(console.log("decodeScan - unexpected MCU data, next marker is: "+ut.invalid),d=ut.offset);var xt=ut&&ut.marker;if(!xt||xt<=65280)throw new t("marker was not found");if(!(xt>=65488&&xt<=65495))break;d+=2}return(ut=S(h,d))&&ut.invalid&&(console.log("decodeScan - unexpected Scan data, next marker is: "+ut.invalid),d=ut.offset),d-E}function g(h,d,m){var y,v,k,b,x,T,I,A,E,P,R,L,B,M,j,N,O,W=h.quantizationTable,V=h.blockData;if(!W)throw new t("missing required Quantization Table.");for(var F=0;F<64;F+=8)E=V[d+F],P=V[d+F+1],R=V[d+F+2],L=V[d+F+3],B=V[d+F+4],M=V[d+F+5],j=V[d+F+6],N=V[d+F+7],E*=W[F],P|R|L|B|M|j|N?(P*=W[F+1],R*=W[F+2],L*=W[F+3],B*=W[F+4],M*=W[F+5],j*=W[F+6],N*=W[F+7],v=(y=(y=a*E+128>>8)+(v=a*B+128>>8)+1>>1)-v,O=(k=R)*o+(b=j)*f+128>>8,k=k*f-b*o+128>>8,I=(x=(x=u*(P-N)+128>>8)+(I=M<<4)+1>>1)-I,T=(A=(A=u*(P+N)+128>>8)+(T=L<<4)+1>>1)-T,b=(y=y+(b=O)+1>>1)-b,k=(v=v+k+1>>1)-k,O=x*s+A*l+2048>>12,x=x*l-A*s+2048>>12,A=O,O=T*n+I*r+2048>>12,T=T*r-I*n+2048>>12,I=O,m[F]=y+A,m[F+7]=y-A,m[F+1]=v+I,m[F+6]=v-I,m[F+2]=k+T,m[F+5]=k-T,m[F+3]=b+x,m[F+4]=b-x):(O=a*E+512>>10,m[F]=O,m[F+1]=O,m[F+2]=O,m[F+3]=O,m[F+4]=O,m[F+5]=O,m[F+6]=O,m[F+7]=O);for(var z=0;z<8;++z)E=m[z],(P=m[z+8])|(R=m[z+16])|(L=m[z+24])|(B=m[z+32])|(M=m[z+40])|(j=m[z+48])|(N=m[z+56])?(v=(y=4112+((y=a*E+2048>>12)+(v=a*B+2048>>12)+1>>1))-v,O=(k=R)*o+(b=j)*f+2048>>12,k=k*f-b*o+2048>>12,b=O,I=(x=(x=u*(P-N)+2048>>12)+(I=M)+1>>1)-I,T=(A=(A=u*(P+N)+2048>>12)+(T=L)+1>>1)-T,O=x*s+A*l+2048>>12,x=x*l-A*s+2048>>12,A=O,O=T*n+I*r+2048>>12,T=T*r-I*n+2048>>12,E=(E=(y=y+b+1>>1)+A)<16?0:E>=4080?255:E>>4,P=(P=(v=v+k+1>>1)+(I=O))<16?0:P>=4080?255:P>>4,R=(R=(k=v-k)+T)<16?0:R>=4080?255:R>>4,L=(L=(b=y-b)+x)<16?0:L>=4080?255:L>>4,B=(B=b-x)<16?0:B>=4080?255:B>>4,M=(M=k-T)<16?0:M>=4080?255:M>>4,j=(j=v-I)<16?0:j>=4080?255:j>>4,N=(N=y-A)<16?0:N>=4080?255:N>>4,V[d+z]=E,V[d+z+8]=P,V[d+z+16]=R,V[d+z+24]=L,V[d+z+32]=B,V[d+z+40]=M,V[d+z+48]=j,V[d+z+56]=N):(O=(O=a*E+8192>>14)<-2040?0:O>=2024?255:O+2056>>4,V[d+z]=O,V[d+z+8]=O,V[d+z+16]=O,V[d+z+24]=O,V[d+z+32]=O,V[d+z+40]=O,V[d+z+48]=O,V[d+z+56]=O)}function w(h,d){for(var m=d.blocksPerLine,y=d.blocksPerColumn,v=new Int16Array(64),k=0;k<y;k++)for(var b=0;b<m;b++)g(d,p(d,k,b),v);return d.blockData}function S(h,d,m){function y(T){return h[T]<<8|h[T+1]}var v=h.length-1,k=m<d?m:d;if(d>=v)return null;var b=y(d);if(b>=65472&&b<=65534)return{invalid:null,marker:b,offset:d};for(var x=y(k);!(x>=65472&&x<=65534);){if(++k>=v)return null;x=y(k)}return{invalid:b.toString(16),marker:x,offset:k}}return i.prototype={parse:function(h){function d(){var U=h[b]<<8|h[b+1];return b+=2,U}function m(){var U=d(),H=b+U-2,J=S(h,H,b);J&&J.invalid&&(console.log("readDataBlock - incorrect length, next marker is: "+J.invalid),H=J.offset);var tt=h.subarray(b,H);return b+=tt.length,tt}function y(U){for(var H=Math.ceil(U.samplesPerLine/8/U.maxH),J=Math.ceil(U.scanLines/8/U.maxV),tt=0;tt<U.components.length;tt++){q=U.components[tt];var it=Math.ceil(Math.ceil(U.samplesPerLine/8)*q.h/U.maxH),ct=Math.ceil(Math.ceil(U.scanLines/8)*q.v/U.maxV),et=H*q.h,at=J*q.v*64*(et+1);q.blockData=new Int16Array(at),q.blocksPerLine=it,q.blocksPerColumn=ct}U.mcusPerLine=H,U.mcusPerColumn=J}var v,k,b=0,x=null,T=null,I=[],A=[],E=[],P=d();if(P!==65496)throw new t("SOI not found");for(P=d();P!==65497;){var R,L,B;switch(P){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var M=m();P===65504&&M[0]===74&&M[1]===70&&M[2]===73&&M[3]===70&&M[4]===0&&(x={version:{major:M[5],minor:M[6]},densityUnits:M[7],xDensity:M[8]<<8|M[9],yDensity:M[10]<<8|M[11],thumbWidth:M[12],thumbHeight:M[13],thumbData:M.subarray(14,14+3*M[12]*M[13])}),P===65518&&M[0]===65&&M[1]===100&&M[2]===111&&M[3]===98&&M[4]===101&&(T={version:M[5]<<8|M[6],flags0:M[7]<<8|M[8],flags1:M[9]<<8|M[10],transformCode:M[11]});break;case 65499:for(var j=d()+b-2;b<j;){var N=h[b++],O=new Uint16Array(64);if(N>>4){if(N>>4!=1)throw new t("DQT - invalid table spec");for(L=0;L<64;L++)O[e[L]]=d()}else for(L=0;L<64;L++)O[e[L]]=h[b++];I[15&N]=O}break;case 65472:case 65473:case 65474:if(v)throw new t("Only single frame JPEGs supported");d(),(v={}).extended=P===65473,v.progressive=P===65474,v.precision=h[b++],v.scanLines=d(),v.samplesPerLine=d(),v.components=[],v.componentIds={};var W,V=h[b++],F=0,z=0;for(R=0;R<V;R++){W=h[b];var Y=h[b+1]>>4,nt=15&h[b+1];F<Y&&(F=Y),z<nt&&(z=nt);var Rt=h[b+2];B=v.components.push({h:Y,v:nt,quantizationId:Rt,quantizationTable:null}),v.componentIds[W]=B-1,b+=3}v.maxH=F,v.maxV=z,y(v);break;case 65476:var Lt=d();for(R=2;R<Lt;){var pt=h[b++],st=new Uint8Array(16),yt=0;for(L=0;L<16;L++,b++)yt+=st[L]=h[b];var St=new Uint8Array(yt);for(L=0;L<yt;L++,b++)St[L]=h[b];R+=17+yt,(pt>>4?A:E)[15&pt]=c(st,St)}break;case 65501:d(),k=d();break;case 65498:d();var q,Ft=h[b++],Tt=[];for(R=0;R<Ft;R++){var ut=v.componentIds[h[b++]];q=v.components[ut];var kt=h[b++];q.huffmanTableDC=E[kt>>4],q.huffmanTableAC=A[15&kt],Tt.push(q)}var Ht=h[b++],Wt=h[b++],Ct=h[b++],Jt=C(h,b,v,Tt,k,Ht,Wt,Ct>>4,15&Ct);b+=Jt;break;case 65535:h[b]!==255&&b--;break;default:if(h[b-3]===255&&h[b-2]>=192&&h[b-2]<=254){b-=3;break}throw new t("unknown marker "+P.toString(16))}P=d()}for(this.width=v.samplesPerLine,this.height=v.scanLines,this.jfif=x,this.eof=b,this.adobe=T,this.components=[],R=0;R<v.components.length;R++){var xt=I[(q=v.components[R]).quantizationId];xt&&(q.quantizationTable=xt),this.components.push({output:w(v,q),scaleX:q.h/v.maxH,scaleY:q.v/v.maxV,blocksPerLine:q.blocksPerLine,blocksPerColumn:q.blocksPerColumn})}this.numComponents=this.components.length},_getLinearizedBlockData:function(h,d){var m,y,v,k,b,x,T,I,A,E,P,R=this.width/h,L=this.height/d,B=0,M=this.components.length,j=h*d*M,N=new Uint8ClampedArray(j),O=new Uint32Array(h),W=4294967288;for(T=0;T<M;T++){for(y=(m=this.components[T]).scaleX*R,v=m.scaleY*L,B=T,P=m.output,k=m.blocksPerLine+1<<3,b=0;b<h;b++)I=0|b*y,O[b]=(I&W)<<3|7&I;for(x=0;x<d;x++)for(E=k*((I=0|x*v)&W)|(7&I)<<3,b=0;b<h;b++)N[B]=P[E+O[b]],B+=M}var V=this.decodeTransform;if(V)for(T=0;T<j;)for(I=0,A=0;I<M;I++,T++,A+=2)N[T]=(N[T]*V[A]>>8)+V[A+1];return N},_isColorConversionNeeded:function(){return this.adobe?!!this.adobe.transformCode:this.numComponents===3?this.colorTransform!==0:this.colorTransform===1},_convertYccToRgb:function(h){for(var d,m,y,v=0,k=h.length;v<k;v+=3)d=h[v],m=h[v+1],y=h[v+2],h[v]=d-179.456+1.402*y,h[v+1]=d+135.459-.344*m-.714*y,h[v+2]=d-226.816+1.772*m;return h},_convertYcckToRgb:function(h){for(var d,m,y,v,k=0,b=0,x=h.length;b<x;b+=4)d=h[b],m=h[b+1],y=h[b+2],v=h[b+3],h[k++]=m*(-660635669420364e-19*m+.000437130475926232*y-54080610064599e-18*d+.00048449797120281*v-.154362151871126)-122.67195406894+y*(-.000957964378445773*y+.000817076911346625*d-.00477271405408747*v+1.53380253221734)+d*(.000961250184130688*d-.00266257332283933*v+.48357088451265)+v*(-.000336197177618394*v+.484791561490776),h[k++]=107.268039397724+m*(219927104525741e-19*m-.000640992018297945*y+.000659397001245577*d+.000426105652938837*v-.176491792462875)+y*(-.000778269941513683*y+.00130872261408275*d+.000770482631801132*v-.151051492775562)+d*(.00126935368114843*d-.00265090189010898*v+.25802910206845)+v*(-.000318913117588328*v-.213742400323665),h[k++]=m*(-.000570115196973677*m-263409051004589e-19*y+.0020741088115012*d-.00288260236853442*v+.814272968359295)-20.810012546947+y*(-153496057440975e-19*y-.000132689043961446*d+.000560833691242812*v-.195152027534049)+d*(.00174418132927582*d-.00255243321439347*v+.116935020465145)+v*(-.000343531996510555*v+.24165260232407);return h},_convertYcckToCmyk:function(h){for(var d,m,y,v=0,k=h.length;v<k;v+=4)d=h[v],m=h[v+1],y=h[v+2],h[v]=434.456-d-1.402*y,h[v+1]=119.541-d+.344*m+.714*y,h[v+2]=481.816-d-1.772*m;return h},_convertCmykToRgb:function(h){for(var d,m,y,v,k=0,b=1/255,x=0,T=h.length;x<T;x+=4)d=h[x]*b,m=h[x+1]*b,y=h[x+2]*b,v=h[x+3]*b,h[k++]=255+d*(-4.387332384609988*d+54.48615194189176*m+18.82290502165302*y+212.25662451639585*v-285.2331026137004)+m*(1.7149763477362134*m-5.6096736904047315*y-17.873870861415444*v-5.497006427196366)+y*(-2.5217340131683033*y-21.248923337353073*v+17.5119270841813)-v*(21.86122147463605*v+189.48180835922747),h[k++]=255+d*(8.841041422036149*d+60.118027045597366*m+6.871425592049007*y+31.159100130055922*v-79.2970844816548)+m*(-15.310361306967817*m+17.575251261109482*y+131.35250912493976*v-190.9453302588951)+y*(4.444339102852739*y+9.8632861493405*v-24.86741582555878)-v*(20.737325471181034*v+187.80453709719578),h[k++]=255+d*(.8842522430003296*d+8.078677503112928*m+30.89978309703729*y-.23883238689178934*v-14.183576799673286)+m*(10.49593273432072*m+63.02378494754052*y+50.606957656360734*v-112.23884253719248)+y*(.03296041114873217*y+115.60384449646641*v-193.58209356861505)-v*(22.33816807309886*v+180.12613974708367);return h},getData:function(h,d,m){if(this.numComponents>4)throw new t("Unsupported color mode");var y=this._getLinearizedBlockData(h,d);if(this.numComponents===1&&m){for(var v=y.length,k=new Uint8ClampedArray(3*v),b=0,x=0;x<v;x++){var T=y[x];k[b++]=T,k[b++]=T,k[b++]=T}return k}if(this.numComponents===3&&this._isColorConversionNeeded())return this._convertYccToRgb(y);if(this.numComponents===4){if(this._isColorConversionNeeded())return m?this._convertYcckToRgb(y):this._convertYcckToCmyk(y);if(m)return this._convertCmykToRgb(y)}return y}},i}()},(tr=Qe())!==void 0&&($e.exports=tr);var Zt=qt(er.exports);var $t=class{static decode(e,r=!1){let n=new Uint8Array(e),l=new Zt;l.parse(n);let{width:s,height:f,numComponents:o,eof:a}=l,u=l.getData(s,f,!0),i=s*f,c,p=null,C=0,g=0,w=0;if(!r&&a<n.length-1)try{let S=new wt(n.subarray(a)).getBytes();p=new Uint8Array(i);let h=0;for(C=0;C<S.length;C++)for(w=7;w>=0;w--)p[h++]=S[C]>>w&1}catch{}if(o===1&&u.length===s*f){let S=new Uint8Array(u.buffer);c=[S,S,S]}else{for(c=[],C=0;C<3;C++)c.push(new Uint8Array(i));for(w=0,g=0;g<i;g++)for(C=0;C<3;C++)c[C][g]=u[w++]}return{width:s,height:f,pixels:c,mask:p}}};var rr=[{pixelType:"S8",size:1,ctor:Int8Array,range:[-128,127]},{pixelType:"U8",size:1,ctor:Uint8Array,range:[0,255]},{pixelType:"S16",size:2,ctor:Int16Array,range:[-32768,32767]},{pixelType:"U16",size:2,ctor:Uint16Array,range:[0,65536]},{pixelType:"S32",size:4,ctor:Int32Array,range:[-2147483648,2147483647]},{pixelType:"U32",size:4,ctor:Uint32Array,range:[0,4294967296]},{pixelType:"F32",size:4,ctor:Float32Array,range:[-34027999387901484e22,34027999387901484e22]},{pixelType:"F64",size:8,ctor:Float64Array,range:[-17976931348623157e292,17976931348623157e292]}],ye=null;function te(){return ye||(ye=import("./chunk-HIGEOQUP.js").then(t=>t.l).then(({default:t})=>t({locateFile:e=>_e(`esri/layers/support/rasterFormats/${e}`)})).then(t=>{Fr(t)}),ye)}var Qt={getBlobInfo:null,decode:null};function Br(t){return 16+(t>>3<<3)}function vt(t,e,r){r.set(t.slice(e,e+r.length))}function Fr(t){let{_malloc:e,_free:r,_lerc_getBlobInfo:n,_lerc_getDataRanges:l,_lerc_decode_4D:s,asm:f}=t,o,a=Object.values(f).find(i=>i&&"buffer"in i&&i.buffer===t.HEAPU8.buffer),u=i=>{let c=i.map(w=>Br(w)),p=c.reduce((w,S)=>w+S),C=e(p);o=new Uint8Array(a.buffer);let g=c[0];c[0]=C;for(let w=1;w<c.length;w++){let S=c[w];c[w]=c[w-1]+g,g=S}return c};Qt.getBlobInfo=i=>{let C=new Uint8Array(48),g=new Uint8Array(8*3),[w,S,h]=u([i.length,C.length,g.length]);o.set(i,w),o.set(C,S),o.set(g,h);let d=n(w,i.length,S,h,12,3);if(d)throw r(w),new Error(`lerc-getBlobInfo: error code is ${d}`);o=new Uint8Array(a.buffer),vt(o,S,C),vt(o,h,g);let m=new Uint32Array(C.buffer),y=new Float64Array(g.buffer),[v,k,,b,x,T,I,A,E,P,R]=m,L={version:v,depthCount:P,width:b,height:x,validPixelCount:I,bandCount:T,blobSize:A,maskCount:E,dataType:k,minValue:y[0],maxValue:y[1],maxZerror:y[2],statistics:[],bandCountWithNoData:R};if(R&&P>1)return r(w),L;if(P===1&&T===1)return r(w),L.statistics.push({minValue:y[0],maxValue:y[1]}),L;let B=P*T*8,M=new Uint8Array(B),j=new Uint8Array(B),N=w,O=0,W=0,V=!1;if(o.byteLength<w+2*B?(r(w),V=!0,[N,O,W]=u([i.length,B,B]),o.set(i,N)):[O,W]=u([B,B]),o.set(M,O),o.set(j,W),d=l(N,i.length,P,T,O,W),d)throw r(N),V||r(O),new Error(`lerc-getDataRanges: error code is ${d}`);o=new Uint8Array(a.buffer),vt(o,O,M),vt(o,W,j);let F=new Float64Array(M.buffer),z=new Float64Array(j.buffer),Y=L.statistics;for(let nt=0;nt<T;nt++)if(P>1){let Rt=F.slice(nt*P,(nt+1)*P),Lt=z.slice(nt*P,(nt+1)*P),pt=Math.min.apply(null,Rt),st=Math.max.apply(null,Lt);Y.push({minValue:pt,maxValue:st,depthStats:{minValues:Rt,maxValues:Lt}})}else Y.push({minValue:F[nt],maxValue:z[nt]});return r(N),V||r(O),L},Qt.decode=(i,c)=>{let{maskCount:p,depthCount:C,bandCount:g,width:w,height:S,dataType:h,bandCountWithNoData:d}=c,m=rr[h],y=w*S,v=new Uint8Array(y*g),k=y*C*g*m.size,b=new Uint8Array(k),x=new Uint8Array(g),T=new Uint8Array(8*g),[I,A,E,P,R]=u([i.length,v.length,b.length,x.length,T.length]);o.set(i,I),o.set(v,A),o.set(b,E),o.set(x,P),o.set(T,R);let L=s(I,i.length,p,A,C,w,S,g,h,E,P,R);if(L)throw r(I),new Error(`lerc-decode: error code is ${L}`);o=new Uint8Array(a.buffer),vt(o,E,b),vt(o,A,v);let B=null;if(d){vt(o,P,x),vt(o,R,T),B=[];let M=new Float64Array(T.buffer);for(let j=0;j<x.length;j++)B.push(x[j]?M[j]:null)}return r(I),{data:b,maskData:v,noDataValues:B}}}function Vr(t,e,r,n,l){if(r<2)return t;let s=new n(e*r);if(l)for(let f=0,o=0;f<e;f++)for(let a=0,u=f;a<r;a++,u+=e)s[u]=t[o++];else for(let f=0,o=0;f<e;f++)for(let a=0,u=f;a<r;a++,u+=e)s[o++]=t[u];return s}function ee(t,e={}){let r=e.inputOffset??0,n=t instanceof Uint8Array?t.subarray(r):new Uint8Array(t,r),l=Qt.getBlobInfo(n),{data:s,maskData:f,noDataValues:o}=Qt.decode(n,l),{width:a,height:u,bandCount:i,depthCount:c,dataType:p,maskCount:C,statistics:g}=l,w=rr[p],S=new w.ctor(s.buffer),h=[],d=[],m=a*u,y=m*c;for(let I=0;I<i;I++){let A=S.subarray(I*y,(I+1)*y);if(e.returnInterleaved)h.push(A);else{let E=Vr(A,m,c,w.ctor,!0);h.push(E)}d.push(f.subarray(I*y,(I+1)*y))}let v=C===0?null:C===1?d[0]:new Uint8Array(m);if(C>1){v.set(d[0]);for(let I=1;I<d.length;I++){let A=d[I];for(let E=0;E<m;E++)v[E]=v[E]&A[E]}}let{noDataValue:k}=e,b=k!=null&&w.range[0]<=k&&w.range[1]>=k;if(C>0&&b)for(let I=0;I<i;I++){let A=h[I],E=d[I]||v;for(let P=0;P<m;P++)E[P]===0&&(A[P]=k)}let x=C===i&&i>1?d:null,{pixelType:T}=w;return{width:a,height:u,bandCount:i,pixelType:T,depthCount:c,statistics:g,pixels:h,mask:v,bandMasks:x,noDataValues:o}}function _r(t,e,r,n=!0){if(e%4!=0||r%4!=0){let l=new ArrayBuffer(4*Math.ceil(r/4)),s=new Uint8Array(l),f=new Uint8Array(t,e,r);if(n)for(let o=0;o<s.length;o+=4)s[o]=f[o+3],s[o+1]=f[o+2],s[o+2]=f[o+1],s[o+3]=f[o];else s.set(f);return new Uint32Array(s.buffer)}if(n){let l=new Uint8Array(t,e,r),s=new Uint8Array(l.length);for(let f=0;f<s.length;f+=4)s[f]=l[f+3],s[f+1]=l[f+2],s[f+2]=l[f+1],s[f+3]=l[f];return new Uint32Array(s.buffer)}return new Uint32Array(t,e,r/4)}function or(){let t=[];for(let e=0;e<=257;e++)t[e]=[e];return t}function ir(t,e){for(let r=0;r<e.length;r++)t.push(e[r])}var Ut=new Set;function _t(t,e,r,n=!0){let l=_r(t,e,r,n),s=9,f=or(),o=32,a=f.length,u=[],i=1,c=l[0],p=0,C=l.length,g=8*(4*C-r),w=[];for(;c!=null;){if(o>=s)o-=s,p=c>>>32-s,c<<=s;else{p=c>>>32-o,c=l[i++];let h=s-o;o=32-h,p=(p<<h)+(c>>>o),c<<=h}if(p===257)break;if(p===256){s=9,f=or(),a=f.length,u=[];continue}let S=f[p];if(S==null){if(p>f.length)throw new Error("data integrity issue: code does not exist on code page");u.push(u[0]),f[a++]=u.slice(),ir(w,u)}else ir(w,S),u.push(S[0]),u.length>1&&(f[a++]=u.slice()),u=S.slice();if(Ut.has(a)&&s++,o===0&&(c=l[i++],o=32),i>C||i===C&&o<=g)break}return new Uint8Array(w)}Ut.add(511),Ut.add(1023),Ut.add(2047),Ut.add(4095),Ut.add(8191);var nr=(t,e)=>{let r=e.width*e.height,n=e.pixelType;return Math.floor(t.byteLength/(r*ar(n)))},ar=t=>{let e=1;switch(t){case Uint8Array:case Int8Array:e=1;break;case Uint16Array:case Int16Array:e=2;break;case Uint32Array:case Int32Array:case Float32Array:e=4;break;case Float64Array:e=8}return e},jr=(t,e)=>{if(8*t.byteLength<e)return null;let r=new Uint8Array(t,0,Math.ceil(e/8)),n=new Uint8Array(e),l=0,s=0,f=0,o=0;for(f=0;f<r.length-1;f++)for(s=r[f],o=7;o>=0;o--)n[l++]=s>>o&1;for(o=7;l<e-1;)s=r[r.length-1],n[l++]=s>>o&1,o--;return n},re=class{static decode(e,r){let n=r.pixelType,l=[],s=r.width*r.height,f=nr(e,r),{bandIds:o,format:a}=r,u=o?.length||nr(e,r),i=e.byteLength-e.byteLength%(s*ar(n)),c=new n(e,0,s*f),p,C,g,w,S=null;if(a==="bip")for(p=0;p<u;p++){for(g=new n(s),w=o?o[p]:p,C=0;C<s;C++)g[C]=c[C*f+w];l.push(g)}else if(a==="bsq")for(p=0;p<u;p++)w=o?o[p]:p,l.push(c.subarray(w*s,(w+1)*s));return i<e.byteLength-1&&(S=jr(e.slice(i),s)),{pixels:l,mask:S}}};function sr(t,e){let r=0,n="",l=0,s=0,f=t.length;for(;r<f;)s=t[r++],l=s>>4,l<8?l=1:l===15?(l=4,s=(7&s)<<18|(63&t[r++])<<12|(63&t[r++])<<6|63&t[r++]):l===14?(l=3,s=(15&s)<<12|(63&t[r++])<<6|63&t[r++]):(l=2,s=(31&s)<<6|63&t[r++]),(s!==0||e)&&(n+=String.fromCharCode(s));return n}var be=(()=>{let t=[];return t[254]="NEWSUBFILETYPE",t[255]="SUBFILETYPE",t[256]="IMAGEWIDTH",t[257]="IMAGELENGTH",t[258]="BITSPERSAMPLE",t[259]="COMPRESSION",t[262]="PHOTOMETRICINTERPRETATION",t[263]="THRESHHOLDING",t[264]="CELLWIDTH",t[265]="CELLLENGTH",t[266]="FILLORDER",t[269]="DOCUMENTNAME",t[270]="IMAGEDESCRIPTION",t[271]="MAKE",t[272]="MODEL",t[273]="STRIPOFFSETS",t[274]="ORIENTATION",t[277]="SAMPLESPERPIXEL",t[278]="ROWSPERSTRIP",t[279]="STRIPBYTECOUNTS",t[280]="MINSAMPLEVALUE",t[281]="MAXSAMPLEVALUE",t[282]="XRESOLUTION",t[283]="YRESOLUTION",t[284]="PLANARCONFIGURATION",t[285]="PAGENAME",t[286]="XPOSITION",t[287]="YPOSITION",t[288]="FREEOFFSETS",t[289]="FREEBYTECOUNTS",t[290]="GRAYRESPONSEUNIT",t[291]="GRAYRESPONSECURVE",t[292]="T4OPTIONS",t[293]="T6OPTIONS",t[296]="RESOLUTIONUNIT",t[297]="PAGENUMBER",t[300]="COLORRESPONSEUNIT",t[301]="TRANSFERFUNCTION",t[305]="SOFTWARE",t[306]="DATETIME",t[315]="ARTIST",t[316]="HOSTCOMPUTER",t[317]="PREDICTOR",t[318]="WHITEPOINT",t[319]="PRIMARYCHROMATICITIES",t[320]="COLORMAP",t[321]="HALFTONEHINTS",t[322]="TILEWIDTH",t[323]="TILELENGTH",t[324]="TILEOFFSETS",t[325]="TILEBYTECOUNTS",t[326]="BADFAXLINES",t[327]="CLEANFAXDATA",t[328]="CONSECUTIVEBADFAXLINES",t[330]="SUBIFD",t[332]="INKSET",t[333]="INKNAMES",t[334]="NUMBEROFINKS",t[336]="DOTRANGE",t[337]="TARGETPRINTER",t[338]="EXTRASAMPLES",t[339]="SAMPLEFORMAT",t[340]="SMINSAMPLEVALUE",t[341]="SMAXSAMPLEVALUE",t[342]="TRANSFERRANGE",t[347]="JPEGTABLES",t[512]="JPEGPROC",t[513]="JPEGIFOFFSET",t[514]="JPEGIFBYTECOUNT",t[515]="JPEGRESTARTINTERVAL",t[517]="JPEGLOSSLESSPREDICTORS",t[518]="JPEGPOINTTRANSFORM",t[519]="JPEGQTABLES",t[520]="JPEGDCTABLES",t[521]="JPEGACTABLES",t[529]="YCBCRCOEFFICIENTS",t[530]="YCBCRSUBSAMPLING",t[531]="YCBCRPOSITIONING",t[532]="REFERENCEBLACKWHITE",t[700]="XMP",t[33550]="GEOPIXELSCALE",t[33922]="GEOTIEPOINTS",t[33432]="COPYRIGHT",t[42112]="GDAL_METADATA",t[42113]="GDAL_NODATA",t[50844]="RPCCOEFFICIENT",t[34264]="GEOTRANSMATRIX",t[34735]="GEOKEYDIRECTORY",t[34736]="GEODOUBLEPARAMS",t[34737]="GEOASCIIPARAMS",t[34665]="EXIFIFD",t[34853]="GPSIFD",t[40965]="INTEROPERABILITYIFD",t})(),zr=(()=>{let t=be.slice();return t[36864]="ExifVersion",t[40960]="FlashpixVersion",t[40961]="ColorSpace",t[42240]="Gamma",t[37121]="ComponentsConfiguration",t[37122]="CompressedBitsPerPixel",t[40962]="PixelXDimension",t[40963]="PixelYDimension",t[37500]="MakerNote",t[37510]="UserComment",t[40964]="RelatedSoundFile",t[36867]="DateTimeOriginal",t[36868]="DateTimeDigitized",t[36880]="OffsetTime",t[36881]="OffsetTimeOriginal",t[36882]="OffsetTimeDigitized",t[37520]="SubSecTime",t[37521]="SubSecTimeOriginal",t[37522]="SubSecTimeDigitized",t[37888]="Temperature",t[37889]="Humidity",t[37890]="Pressure",t[37891]="WaterDepth",t[37892]="Acceleration",t[37893]="CameraElevationAngle",t[42016]="ImageUniqueID",t[42032]="CameraOwnerName",t[42033]="BodySerialNumber",t[42034]="LensSpecification",t[42035]="LensMake",t[42036]="LensModel",t[42037]="LensSerialNumber",t[33434]="ExposureTime",t[33437]="FNumber",t[34850]="ExposureProgram",t[34852]="SpectralSensitivity",t[34855]="PhotographicSensitivity",t[34856]="OECF",t[34864]="SensitivityType",t[34865]="StandardOutputSensitivity",t[34866]="RecommendedExposureIndex",t[34867]="ISOSpeed",t[34868]="ISOSpeedLatitudeyyy",t[34869]="ISOSpeedLatitudezzz",t[37377]="ShutterSpeedValue",t[37378]="ApertureValue",t[37379]="BrightnessValue",t[37380]="ExposureBiasValue",t[37381]="MaxApertureValue",t[37382]="SubjectDistance",t[37383]="MeteringMode",t[37384]="LightSource",t[37385]="Flash",t[37386]="FocalLength",t[37396]="SubjectArea",t[41483]="FlashEnergy",t[41484]="SpatialFrequencyResponse",t[41486]="FocalPlaneXResolution",t[41487]="FocalPlaneYResolution",t[41488]="FocalPlaneResolutionUnit",t[41492]="SubjectLocation",t[41493]="ExposureIndex",t[41495]="SensingMethod",t[41728]="FileSource",t[41729]="SceneType",t[41730]="CFAPattern",t[41985]="CustomRendered",t[41986]="ExposureMode",t[41987]="WhiteBalance",t[41988]="DigitalZoomRatio",t[41989]="FocalLengthIn35mmFilm",t[41990]="SceneCaptureType",t[41991]="GainControl",t[41992]="Contrast",t[41993]="Saturation",t[41994]="Sharpness",t[41995]="DeviceSettingDescription",t[41996]="SubjectDistanceRange",t})(),Hr=["GPSVersionID","GPSLatitudeRef","GPSLatitude","GPSLongitudeRef","GPSLongitude","GPSAltitudeRef","GPSAltitude","GPSTimeStamp","GPSSatellites","GPSStatus","GPSMeasureMode","GPSDOP","GPSSpeedRef","GPSSpeed","GPSTrackRef","GPSTrack","GPSImgDirectionRef","GPSImgDirection","GPSMapDatum","GPSDestLatitudeRef","GPSDestLatitude","GPSDestLongitudeRef","GPSDestLongitude","GPSDestBearingRef","GPSDestBearing","GPSDestDistanceRef","GPSDestDistance","GPSProcessingMethod","GPSAreaInformation","GPSDateStamp","GPSDifferential","GPSHPositioningError"],Wr=(()=>{let t=[];return t[1024]="GTModelTypeGeoKey",t[1025]="GTRasterTypeGeoKey",t[1026]="GTCitationGeoKey",t[2048]="GeographicTypeGeoKey",t[2049]="GeogCitationGeoKey",t[2050]="GeogGeodeticDatumGeoKey",t[2051]="GeogPrimeMeridianGeoKey",t[2052]="GeogLinearUnitsGeoKey",t[2053]="GeogLinearUnitSizeGeoKey",t[2054]="GeogAngularUnitsGeoKey",t[2055]="GeogAngularUnitSizeGeoKey",t[2056]="GeogEllipsoidGeoKey",t[2057]="GeogSemiMajorAxisGeoKey",t[2058]="GeogSemiMinorAxisGeoKey",t[2059]="GeogInvFlatteningGeoKey",t[2061]="GeogPrimeMeridianLongGeoKey",t[2060]="GeogAzimuthUnitsGeoKey",t[3072]="ProjectedCSTypeGeoKey",t[3073]="PCSCitationGeoKey",t[3074]="ProjectionGeoKey",t[3075]="ProjCoordTransGeoKey",t[3076]="ProjLinearUnitsGeoKey",t[3077]="ProjLinearUnitSizeGeoKey",t[3078]="ProjStdParallel1GeoKey",t[3079]="ProjStdParallel2GeoKey",t[3080]="ProjNatOriginLongGeoKey",t[3081]="ProjNatOriginLatGeoKey",t[3082]="ProjFalseEastingGeoKey",t[3083]="ProjFalseNorthingGeoKey",t[3084]="ProjFalseOriginLongGeoKey",t[3085]="ProjFalseOriginLatGeoKey",t[3086]="ProjFalseOriginEastingGeoKey",t[3087]="ProjFalseOriginNorthingGeoKey",t[3088]="ProjCenterLongGeoKey",t[3090]="ProjCenterEastingGeoKey",t[3091]="ProjCenterNorthingGeoKey",t[3092]="ProjScaleAtNatOriginGeoKey",t[3093]="ProjScaleAtCenterGeoKey",t[3094]="ProjAzimuthAngleGeoKey",t[3095]="ProjStraightVertPoleLongGeoKey",t[4096]="VerticalCSTypeGeoKey",t[4097]="VerticalCitationGeoKey",t[4098]="VerticalDatumGeoKey",t[4099]="VerticalUnitsGeoKey",t})(),Jr=(t,e)=>{let r=(e||be)[t];return r===void 0&&(r="unknown"+String(t)),r},Ce=new Map;Ce.set("EXIFIFD",zr),Ce.set("GPSIFD",Hr);var It={tiffTags:be,ifdTags:Ce,geoKeys:Wr,getTagName:Jr};var jt=(()=>{let t=new ArrayBuffer(4),e=new Uint8Array(t);return new Uint32Array(t)[0]=1,e[0]===1})();var lr=[0,1,1,2,4,8,1,1,2,4,8,4,8,-1,-1,-1,8,8,8],Gt=4294967296,Kr=new Set([1,5,6,7,8,34712,34887]);function xe(t,e){let r="unknown";return t===3?r=e===64?"f64":"f32":t===1?e===1?r="u1":e===2?r="u2":e===4?r="u4":e<=8?r="u8":e<=16?r="u16":e<=32&&(r="u32"):t===2&&(e<=8?r="s8":e<=16?r="s16":e<=32&&(r="s32")),r}function ie(t){let e=null;switch(t?t.toLowerCase():"f32"){case"u1":case"u2":case"u4":case"u8":e=Uint8Array;break;case"u16":e=Uint16Array;break;case"u32":e=Uint32Array;break;case"s8":e=Int8Array;break;case"s16":e=Int16Array;break;case"s32":e=Int32Array;break;case"f64":e=Float64Array;break;default:e=Float32Array}return e}function qr(t,e){return{x:e[0]*t.x+e[1]*t.y+e[2],y:e[3]*t.x+e[4]*t.y+e[5]}}function cr(t,e){return t.get(e)?.values}function At(t,e){return t.get(e)?.values}function ur(t,e){return t.get(e)?.values?.[0]}function _(t,e){return t.get(e)?.values?.[0]}function we(t,e,r,n=0,l=It.tiffTags,s=4){let f=s===8,o=f?Ae(new DataView(t,r,8),0,e):new DataView(t,r,2).getUint16(0,e),a=4+2*s,u=f?8:2,i=u+o*a;if(r+i>t.byteLength)return{success:!1,ifd:null,nextIFD:null,requiredBufferSize:i};let c=r+i+4<=t.byteLength?oe(new DataView(t,r+i,s===8?8:4),0,e,s===8):null,p=r+u,C=new Map,g,w,S,h,d,m=0,y=0;for(let v=0;v<o;v++){w=new DataView(t,p+a*v,a),S=w.getUint16(0,e),d=w.getUint16(2,e),h=It.getTagName(S,l);let k=[];s===2?(m=w.getUint16(4,e),y=w.getUint16(6,e)):s===4?(m=w.getUint32(4,e),y=w.getUint32(8,e)):s===8&&(m=oe(w,4,e,!0),y=oe(w,12,e,!0),k.push(w.getUint32(12,e)),k.push(w.getUint32(16,e))),g={id:S,type:d,valueCount:m,valueOffset:y,valueOffsets:k,values:null},to(t,e,g,n,!1,s),C.set(h,g)}return{success:!0,ifd:C,nextIFD:c,requiredBufferSize:i}}var Yr=(t,e)=>ee(t,{inputOffset:e}).pixels[0];function ve(t,e){if(e!==1&&e!==2&&e!==4)return t;let r=new Uint8Array(t),n=8/e,l=new Uint8Array(t.byteLength*n),s=0,f=2**e-1;for(let o=0;o<r.length;o++){let a=r[o];for(let u=0;u<n;u++)l[s++]=a<<e*u>>>8-e&f}return l.buffer}function Se(t,e,r){let n=new Zt;n.parse(t),n.colorTransform=r===6?-1:0;let l=n.getData(n.width,n.height,e!==1&&e!==4);return new Uint8Array(l.buffer)}function Te(t){let e=new wt(t).getBytes(),r=new ArrayBuffer(e.length),n=new Uint8Array(r);return n.set(e),n}function ke(t,e,r,n,l){return ft(this,null,function*(){let s=jt===e,f=_(r,"BITSPERSAMPLE"),o=_(r,"SAMPLESPERPIXEL")??1,a=_(r,"PHOTOMETRICINTERPRETATION"),u=_(r,"SAMPLEFORMAT")??1,i=xe(u,f),c=_(r,"COMPRESSION")??1,p=ie(i),C,g,w;if(c===34887)return yield te(),Yr(t,n);if(c===1)C=t.slice(n,n+l),g=new Uint8Array(C);else if(c===8||c===32946)g=new Uint8Array(t,n,l),g=Te(g),C=g.buffer;else if(c===6)g=new Uint8Array(t,n,l),g=Se(g,o,a),C=g.buffer;else if(c===7){let m=r.get("JPEGTABLES").values,y=m.length-2;g=new Uint8Array(y+l-2);for(let k=0;k<y;k++)g[k]=m[k];let v=new Uint8Array(t,n+2,l-2);for(let k=0;k<v.length;k++)g[y+k]=v[k];g=Se(g,o,a),C=g.buffer}else{if(c!==5)throw new Error("tiff-decode: unsupport compression "+c);g=_t(t,n,l,e),C=g.buffer}if(C=ve(C,f),i==="u8"||i==="s8"||s)w=new p(C);else{C=new ArrayBuffer(g.length);let m=new Uint8Array(C);switch(i){case"u16":case"s16":for(let y=0;y<g.length;y+=2)m[y]=g[y+1],m[y+1]=g[y];break;case"u32":case"s32":case"f32":for(let y=0;y<g.length;y+=4)m[y]=g[y+3],m[y+1]=g[y+2],m[y+2]=g[y+1],m[y+3]=g[y]}w=new p(C)}let S=_(r,"PREDICTOR")??1,h=_(r,"TILEWIDTH"),d=_(r,"TILELENGTH");if(S>1&&(c===5||c===8||c===32946)&&h&&d){let m=ne(r),y=new p(w.length);y.set(w),w=no(y,d,h,u===3&&S===3,m?1:o)}return w})}function Xr(t,e,r){return ft(this,null,function*(){let n=At(r,"TILEOFFSETS");if(n===void 0)return null;let l=At(r,"TILEBYTECOUNTS"),{width:s,height:f,pixelType:o,tileWidth:a,tileHeight:u}=Ie([r]),i=ne(r,e),c=_(r,"SAMPLESPERPIXEL")||e.planes,p=s*f,C=_(r,"BITSPERSAMPLE"),g=(_(r,"COMPRESSION")??1)===34887,w=ie(o),S=[];for(let M=0;M<c;M++)S.push(new w(p));let h,d,m,y,v,k,b,x,T,I,A,E,P,R=Math.ceil(s/a),L=new Uint8Array(p).fill(255),B=!1;if(C%8==0)if(g&&i&&c>1){let M=Math.round(n.length/c);for(h=0;h<M;h++){k=Math.floor(h/R)*u,b=h%R*a,x=k*s+b;for(let j=0;j<c;j++){let N=h*c+j;for(l[N]===0?(m=null,B=!0):m=yield ke(t,e.littleEndian,r,n[N],l[N]),I=0,T=x,E=Math.min(a,s-b),A=Math.min(u,f-k),P=S[j],y=0;y<A;y++)for(T=x+y*s,I=y*a,v=0;v<E;v++,T++,I++)m?P[T]=m[I]:L[T]=0}}}else for(h=0;h<n.length;h++)for(k=Math.floor(h/R)*u,b=h%R*a,x=k*s+b,l[h]===0?(m=null,B=!0):m=yield ke(t,e.littleEndian,r,n[h],l[h]),I=0,T=x,E=Math.min(a,s-b),A=Math.min(u,f-k),d=0;d<c;d++)if(P=S[d],i||g)for(y=0;y<A;y++)for(T=x+y*s,I=a*u*d+y*a,v=0;v<E;v++,T++,I++)m?P[T]=m[I]:L[T]=0;else for(y=0;y<A;y++)for(T=x+y*s,I=y*a*c+d,v=0;v<E;v++,T++,I+=c)m?P[T]=m[I]:L[T]=0;return{width:s,height:f,pixelType:o,pixels:S,mask:B?L:void 0}})}var Zr=(t,e,r)=>{let n=jt===e.littleEndian,l=At(r,"STRIPOFFSETS");if(l===void 0)return null;let{width:s,height:f,pixelType:o}=Ie([r]),a=_(r,"SAMPLESPERPIXEL")||e.planes,u=_(r,"PHOTOMETRICINTERPRETATION"),i=s*f,c=_(r,"BITSPERSAMPLE"),p=ie(o),C=new p(i*a),g=At(r,"STRIPBYTECOUNTS"),w=_(r,"ROWSPERSTRIP"),S=_(r,"COMPRESSION")??1,h,d,m,y,v,k,b,x,T,I=w;if(c%8==0)for(h=0;h<l.length;h++){if(v=h*(w*s)*a,I=(h+1)*w>f?f-h*w:w,o==="u8"||o==="s8"||n)S===8||S===32946?(b=new Uint8Array(t,l[h],g[h]),b=Te(b),k=b.buffer):S===6?(b=new Uint8Array(t,l[h],g[h]),b=Se(b,a,u),k=b.buffer):S===5?(b=_t(t,l[h],g[h],e.littleEndian),k=b.buffer):(g[h]!==I*s*a*c/8&&console.log("strip byte counts is different than expected"),k=t.slice(l[h],l[h]+g[h])),k=ve(k,c),y=new p(k);else{switch(S===6||S===8||S===32946?(b=new Uint8Array(t,l[h],g[h]),x=Te(b),k=x.buffer):(g[h]!==I*s*a*c/8&&console.log("strip byte counts is different than expected"),k=new ArrayBuffer(g[h]),b=new Uint8Array(t,l[h],g[h]),x=new Uint8Array(k)),o){case"u16":case"s16":for(m=0;m<b.length;m+=2)x[m]=b[m+1],x[m+1]=b[m];break;case"u32":case"s32":case"f32":for(m=0;m<b.length;m+=4)x[m]=b[m+3],x[m+1]=b[m+2],x[m+2]=b[m+1],x[m+3]=b[m]}k=ve(k,c),y=new p(k)}C.set(y,v)}let A=[];if(a===1)A.push(C);else for(h=0;h<a;h++){for(T=new p(i),d=0;d<i;d++)T[d]=C[d*a+h];A.push(T)}return{width:s,height:f,pixelType:o,pixels:A}},$r=(t,e,r)=>{if(!(t&&t.length>0&&e&&r))return null;let n,l,s,f=t[0].length,o=t.length,a=new Uint8Array(f);for(let u=0;u<o;u++)if(n=t[u],l=e[u],s=r[u],u===0)for(let i=0;i<f;i++)a[i]=n[i]<l||n[i]>s?0:1;else for(let i=0;i<f;i++)a[i]&&(a[i]=n[i]<l||n[i]>s?0:1);return a},Qr=t=>{if(!t)return null;let e=t.match(/<Item(.*?)Item>/gi);if(!e||e.length===0)return null;let r=new Map,n,l,s,f,o;for(let h=0;h<e.length;h++)n=e[h],l=n.slice(6,n.indexOf(">")),f=n.indexOf("sample="),f>-1&&(o=n.slice(f+8,n.indexOf('"',f+8))),f=n.indexOf("name="),f>-1&&(l=n.slice(f+6,n.indexOf('"',f+6))),l&&(s=n.slice(n.indexOf(">")+1,n.indexOf("</Item>")).trim(),o!=null?r.has(l)?r.get(l)[o]=s:r.set(l,[s]):r.set(l,s)),o=null;let a=r.get("STATISTICS_MINIMUM"),u=r.get("STATISTICS_MAXIMUM"),i=r.get("STATISTICS_MEAN"),c=r.get("STATISTICS_STDDEV"),p=null;if(a&&u){p=[];for(let h=0;h<a.length;h++)p.push({min:parseFloat(a[h]),max:parseFloat(u[h]),avg:i&&parseFloat(i[h]),stddev:c&&parseFloat(c[h])})}let C=r.get("BandName"),g=r.get("WavelengthMin"),w=r.get("WavelengthMax"),S=null;if(C){S=[];for(let h=0;h<C.length;h++)S.push({BandName:C[h],WavelengthMin:g&&parseFloat(g[h]),WavelengthMax:w&&parseFloat(w[h])})}return{statistics:p,bandProperties:S,dataType:r.get("DataType"),rawMetadata:r}};function to(t,e,r,n=0,l=!1,s=4){if(r.values)return!0;let f=r.type,o=r.valueCount,a=r.valueOffset,u=[],i=lr[f],c=8*i,p=o*i,C=o*lr[f]*8,g,w,S=s===8?64:32,h=r.valueOffsets;if(C>S&&p>(l?t.byteLength:t?t.byteLength-a+n:0))return r.offlineOffsetSize=[a,p],r.values=null,!1;if(C<=S){if(!e)if(S<=32)a>>>=32-C;else{let d=h?.length?h[0]:a>>>0,m=h?.length?h[1]:Math.round((a-d)/Gt);C<=32?(a=d>>>32-C,h[0]=a):(a=d*2**(32-C)+(m>>>32-C),h[0]=d,h[1]=m>>>32-C)}if(o===1&&c===S)u=[a];else if(S===64){let d=h?.length?h[0]:a>>>0,m=h?.length?h[1]:Math.round((a-d)/Gt),y=d,v=32;for(w=1;w<=o;w++){let k=32-c*w%32;if(v<c){let b=y<<k>>>32-v,x=m<<32-v>>>32-v;y=m,u.push(b+x*2**(c-v)),v-=32-(c-v)}else u.push(y<<k>>>32-c),v-=c;v===0&&(v=32,y=m)}}else for(w=1;w<=o;w++){let d=32-c*w;u.push(a<<d>>>32-c)}}else{a-=n,l&&(a=0);for(let d=a;d<a+p;d+=i){switch(f){case 1:case 2:case 7:g=new DataView(t,d,1).getUint8(0);break;case 3:g=new DataView(t,d,2).getUint16(0,e);break;case 4:case 13:g=new DataView(t,d,4).getUint32(0,e);break;case 5:g=new DataView(t,d,4).getUint32(0,e)/new DataView(t,d+4,4).getUint32(0,e);break;case 6:g=new DataView(t,d,1).getInt8(0);break;case 8:g=new DataView(t,d,2).getInt16(0,e);break;case 9:g=new DataView(t,d,4).getInt32(0,e);break;case 10:g=new DataView(t,d,4).getInt32(0,e)/new DataView(t,d+4,4).getInt32(0,e);break;case 11:g=new DataView(t,d,4).getFloat32(0,e);break;case 12:g=new DataView(t,d,8).getFloat64(0,e);break;case 16:case 18:g=Ae(new DataView(t,d,8),0,e);break;case 17:g=ro(new DataView(t,d,8),0,e);break;default:g=null}u.push(g)}}if(f===2){let d="",m=u;for(u=[],w=0;w<m.length;w++)m[w]===0&&d!==""?(u.push(d),d=""):d+=String.fromCharCode(m[w]);d===""&&u.length!==0||u.push(d)}return r.values=u,!0}function Ie(t){let e=t[0],r=_(e,"TILEWIDTH"),n=_(e,"TILELENGTH"),l=_(e,"IMAGEWIDTH"),s=_(e,"IMAGELENGTH"),f=_(e,"BITSPERSAMPLE"),o=_(e,"SAMPLESPERPIXEL"),a=_(e,"SAMPLEFORMAT")??1,u=xe(a,f),i=ne(e),c=cr(e,"GDAL_NODATA"),p=null;c?.length&&(p=c.map(N=>parseFloat(N)),p.some(N=>isNaN(N))&&(p=null));let C=_(e,"COMPRESSION")??1,g;switch(C){case 1:g="NONE";break;case 2:case 3:case 4:case 32771:g="CCITT";break;case 5:g="LZW";break;case 6:case 7:g="JPEG";break;case 32773:g="PACKBITS";break;case 8:case 32946:g="DEFLATE";break;case 34712:g="JPEG2000";break;case 34887:g="LERC";break;default:g=String(C)}let w=!0,S="";Kr.has(C)||(w=!1,S+="unsupported tag compression "+C),a>3&&(w=!1,S+="unsupported tag sampleFormat "+a),f!==1&&f!==2&&f!==4&&f%8!=0&&(w=!1,S+="unsupported tag bitsPerSample "+f);let h=ur(e,"GEOASCIIPARAMS"),d;if(h){let N=h.split("|").find(W=>W.includes("ESRI PE String = ")),O=N?N.replace("ESRI PE String = ",""):"";d=O.startsWith("COMPD_CS")||O.startsWith("PROJCS")||O.startsWith("GEOGCS")?{wkid:null,wkt:O}:null}let m=At(e,"GEOTIEPOINTS"),y=At(e,"GEOPIXELSCALE"),v=At(e,"GEOTRANSMATRIX"),k=e.has("GEOKEYDIRECTORY")?e.get("GEOKEYDIRECTORY").data:null,b,x,T=!1,I=!1;if(k){T=_(k,"GTRasterTypeGeoKey")===2;let N=_(k,"GTModelTypeGeoKey");if(N===2){let O=_(k,"GeographicTypeGeoKey");O>=1024&&O<=32766&&(d={wkid:O}),d||O!==32767||(I=!0,d={wkid:4326})}else if(N===1){let O=_(k,"ProjectedCSTypeGeoKey");O>=1024&&O<=32766&&(d={wkid:O})}}if(y&&m&&m.length>=6?(b=[y[0],0,m[3]-m[0]*y[0],0,-Math.abs(y[1]),m[4]-m[1]*y[1]],T&&(b[2]-=.5*b[0]+.5*b[1],b[5]-=.5*b[3]+.5*b[4])):v&&v.length===16&&(b=T?[v[0],v[1],v[3]-.5*v[0],v[4],v[5],v[7]-.5*v[5]]:[v[0],v[1],v[3],v[4],v[5],v[7]]),b){let N=[{x:0,y:s},{x:0,y:0},{x:l,y:s},{x:l,y:0}],O,W=Number.POSITIVE_INFINITY,V=Number.POSITIVE_INFINITY,F=Number.NEGATIVE_INFINITY,z=Number.NEGATIVE_INFINITY;for(let Y=0;Y<N.length;Y++)O=qr(N[Y],b),W=O.x>W?W:O.x,F=O.x<F?F:O.x,V=O.y>V?V:O.y,z=O.y<z?z:O.y;x={xmin:W,xmax:F,ymin:V,ymax:z,spatialReference:d}}else x={xmin:-.5,ymin:.5-s,xmax:l-.5,ymax:.5,spatialReference:d};I&&(x.xmax-x.xmin>400||Math.max(Math.abs(x.xmin),Math.abs(x.xmax))>361)&&(d=null,x.spatialReference=null);let A=fr(t),E,P,R,L,B;if(A.length>0){R=Math.round(Math.log(l/_(A[0],"IMAGEWIDTH"))/Math.LN2);let N=A[A.length-1];L=Math.round(Math.log(l/_(N,"IMAGEWIDTH"))/Math.LN2),E=_(N,"TILEWIDTH"),P=_(N,"TILELENGTH")}E=L!=null&&L>0?E||r:null,P=L!=null&&L>0?P||n:null,r&&(B=[{maxCol:Math.ceil(l/r)-1,maxRow:Math.ceil(s/n)-1,minRow:0,minCol:0}],A.forEach(N=>{B.push({maxCol:Math.ceil(_(N,"IMAGEWIDTH")/_(N,"TILEWIDTH"))-1,maxRow:Math.ceil(_(N,"IMAGELENGTH")/_(N,"TILELENGTH"))-1,minRow:0,minCol:0})}));let M=ur(t[0],"GDAL_METADATA"),j=Qr(M);return S+=" "+pr({width:l,height:s,tileWidth:r,tileHeight:n,planes:o,ifds:t}),{width:l,height:s,tileWidth:r,tileHeight:n,planes:o,isBSQ:i,pixelType:u,compression:g,noData:p,hasMaskBand:hr(t).length===A.length+1,isSupported:w,message:S,extent:x,isPseudoGeographic:I,affine:y?null:b,firstPyramidLevel:R,maximumPyramidLevel:L,pyramidBlockWidth:E,pyramidBlockHeight:P,tileBoundary:B,metadata:j}}function ne(t,e){let r=cr(t,"PLANARCONFIGURATION");return r?r[0]===2:!!e&&e.isBSQ}function fr(t){return t.filter(e=>_(e,"NEWSUBFILETYPE")===1)}function hr(t){return t.filter(e=>{let r=(4&(_(e,"NEWSUBFILETYPE")??0))==4,n=_(e,"PHOTOMETRICINTERPRETATION")===4;return r&&n})}function eo(t){let{littleEndian:e,isBigTiff:r,firstIFDPos:n}=oo(t),l=n,s=[];do{let f=io(t,e,l,0,It.tiffTags,r?8:4);if(!f.success)break;s.push(f.ifd),l=f.nextIFD}while(l>0);return Q(X({},Ie(s)),{littleEndian:e,isBigTiff:r,ifds:s,pyramidIFDs:fr(s),maskIFDs:hr(s)})}function Ae(t,e,r){let n=t.getUint32(e,r),l=t.getUint32(e+4,r);return r?l*Gt+n:n*Gt+l}function ro(t,e,r){let n=r?t.getInt32(e,r):t.getUint32(e,r),l=r?t.getUint32(e+4,r):t.getInt32(e+4,r),s=(r?n:l)>=0?1:-1;return r?n*=s:l*=s,s*(r?l*Gt+n:n*Gt+l)}function oe(t,e,r,n){return n?Ae(t,e,r):t.getUint32(e,r)}function oo(t){let e=new DataView(t,0,16),r=e.getUint16(0,!1),n=null;if(r===18761)n=!0;else{if(r!==19789)throw new Error("unexpected endianess byte");n=!1}let l=e.getUint16(2,n);if(l!==42&&l!==43)throw new Error("unexpected tiff identifier");let s=4,f=l===43;if(f){let o=e.getUint16(s,n);if(s+=2,o!==8)throw new Error("unsupported bigtiff version");if(e.getUint16(s,n)!==0)throw new Error("unsupported bigtiff version");s+=2}return{littleEndian:n,isBigTiff:f,firstIFDPos:oe(e,s,n,f)}}function io(t,e,r,n=0,l=It.tiffTags,s=4){let f=we(t,e,r,n,l,s),o,a=f.ifd;if(a){if(It.ifdTags.forEach((u,i)=>{a.has(i)&&(o=a.get(i),o.data=we(t,e,o.valueOffset-n,n,u).ifd)}),a.has("GEOKEYDIRECTORY")){o=a.get("GEOKEYDIRECTORY");let u=o.values;if(u&&u.length>4){let i=u[0]+"."+u[1]+"."+u[2];o.data=we(t,e,o.valueOffset+6-n,n,It.geoKeys,2).ifd,o.data&&o.data.set("GEOTIFFVersion",{id:0,type:2,valueCount:1,valueOffset:null,values:[i]})}}if(a.has("XMP")){o=a.get("XMP");let u=o.values;typeof u[0]=="number"&&o.type===7&&(o.values=[sr(new Uint8Array(u))])}}return f}function pr(t){let{width:e,height:r,tileHeight:n,tileWidth:l}=t,s=t.planes,f=l?l*n:e*r,o=_(t.ifds[0],"BITSPERSAMPLE"),a="";return f*s>2**30/(o>8?o/8:1)&&(a=l?"tiled tiff exceeding 1 gigabits per tile is not supported":"scanline tiff exceeding 1 gigabits is not supported"),a}function no(t,e,r,n,l){let s=n?4:1,f=r*s*l;n&&(t=new Uint8Array(t.buffer));for(let u=0;u<e;u++){let i=u*f;for(let c=l;c<f;c++)t[i+c]+=t[i+c-l]}if(!n)return t;let o=new Uint8Array(t.length),a=r*l;for(let u=0;u<e;u++){let i=u*f;for(let c=0;c<a;c++)for(let p=0;p<s;p++)o[i+c*s+p]=t[i+c+(s-p-1)*a]}return new Float32Array(o.buffer)}function dr(t,e){return ft(this,null,function*(){let{headerInfo:r,ifd:n,offsets:l,sizes:s}=e,f=[];for(let T=0;T<l.length;T++){s[T];let I=yield ke(t,r.littleEndian,n,l[T],s[T]||t.byteLength);f.push(I)}let o=ne(n,r),a=_(n,"BITSPERSAMPLE"),u=xe(_(n,"SAMPLEFORMAT")??1,a),i=_(n,"SAMPLESPERPIXEL")||r.planes,c=ie(u),p=_(n,"TILEWIDTH"),C=_(n,"TILELENGTH"),g=_(n,"COMPRESSION")??1,w=p*C,S,h=[],d=f[0],m=g===34887;for(let T=0;T<i;T++){if(S=new c(w),f.length===i)d=f[T],d.length===w&&(S=d);else if(d.length)if(o||m)S=d.length===w?d:d.slice(w*T,w*(T+1));else for(let I=0;I<w;I++)S[I]=d[I*i+T];h.push(S)}let y=r.noData?r.noData[0]:e.noDataValue,v=r.metadata?r.metadata.statistics:null,k=v?v.map(T=>T.min):null,b=v?v.map(T=>T.max):null,x={pixelType:u,width:p,height:C,pixels:h,noDataValue:y};return y!=null?Vt(x,y):k&&b&&e.applyMinMaxConstraint&&(x.mask=$r(h,k,b)),x})}function mr(r){return ft(this,arguments,function*(t,e={}){let n=e.pyramidLevel||0,l=e.headerInfo||eo(t),{ifds:s,noData:f}=l;if(s.length===0)throw new Error("no valid image file directory");let o=pr(l);if(o)throw o;let a=null,u=n===-1?s[s.length-1]:s[n],i=f??e.noDataValue;return a=l.tileWidth?yield Xr(t,l,u):Zr(t,l,u),a&&(i!=null&&Vt(a,i),a)})}var ao=function(t){var e,r,n,l,s,f;function o(a){var u,i,c,p,C,g,w,S,h,d,m,y,v;for(this.data=a,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},C=null;;){switch(u=this.readUInt32(),S=(function(){var k,b;for(b=[],k=0;k<4;++k)b.push(String.fromCharCode(this.data[this.pos++]));return b}).call(this).join(""),S){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(u);break;case"fcTL":C&&this.animation.frames.push(C),this.pos+=4,C={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},p=this.readUInt16(),c=this.readUInt16()||100,C.delay=1e3*p/c,C.disposeOp=this.data[this.pos++],C.blendOp=this.data[this.pos++],C.data=[];break;case"IDAT":case"fdAT":for(S==="fdAT"&&(this.pos+=4,u-=4),a=C?.data||this.imgData,m=0;0<=u?m<u:m>u;0<=u?++m:--m)a.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(this.transparency.indexed=this.read(u),(h=255-this.transparency.indexed.length)>0)for(y=0;0<=h?y<h:y>h;0<=h?++y:--y)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(u)[0];break;case 2:this.transparency.rgb=this.read(u)}break;case"tEXt":g=(d=this.read(u)).indexOf(0),w=String.fromCharCode.apply(String,d.slice(0,g)),this.text[w]=String.fromCharCode.apply(String,d.slice(g+1));break;case"IEND":return C&&this.animation.frames.push(C),this.colors=(function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}).call(this),this.hasAlphaChannel=(v=this.colorType)===4||v===6,i=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*i,this.colorSpace=(function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}).call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=u}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}return o.load=function(a,u,i){var c;return typeof u=="function"&&(i=u),(c=new XMLHttpRequest).open("GET",a,!0),c.responseType="arraybuffer",c.onload=function(){var p;return p=new o(new Uint8Array(c.response||c.mozResponseArrayBuffer)),typeof u?.getContext=="function"&&p.render(u),typeof i=="function"?i(p):void 0},c.send(null)},r=1,n=2,e=0,o.prototype.read=function(a){var u,i;for(i=[],u=0;0<=a?u<a:u>a;0<=a?++u:--u)i.push(this.data[this.pos++]);return i},o.prototype.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},o.prototype.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},o.prototype.decodePixels=function(a){var u,i,c,p,C,g,w,S,h,d,m,y,v,k,b,x,T,I,A,E,P,R,L;if(a==null&&(a=this.imgData),a.length===0)return new Uint8Array(0);for(a=(a=new wt(a)).getBytes(),x=(y=this.pixelBitlength/8)*this.width,v=new Uint8Array(x*this.height),g=a.length,b=0,k=0,i=0;k<g;){switch(a[k++]){case 0:for(p=A=0;A<x;p=A+=1)v[i++]=a[k++];break;case 1:for(p=E=0;E<x;p=E+=1)u=a[k++],C=p<y?0:v[i-y],v[i++]=(u+C)%256;break;case 2:for(p=P=0;P<x;p=P+=1)u=a[k++],c=(p-p%y)/y,T=b&&v[(b-1)*x+c*y+p%y],v[i++]=(T+u)%256;break;case 3:for(p=R=0;R<x;p=R+=1)u=a[k++],c=(p-p%y)/y,C=p<y?0:v[i-y],T=b&&v[(b-1)*x+c*y+p%y],v[i++]=(u+Math.floor((C+T)/2))%256;break;case 4:for(p=L=0;L<x;p=L+=1)u=a[k++],c=(p-p%y)/y,C=p<y?0:v[i-y],b===0?T=I=0:(T=v[(b-1)*x+c*y+p%y],I=c&&v[(b-1)*x+(c-1)*y+p%y]),w=C+T-I,S=Math.abs(w-C),d=Math.abs(w-T),m=Math.abs(w-I),h=S<=d&&S<=m?C:d<=m?T:I,v[i++]=(u+h)%256;break;default:throw new Error("Invalid filter algorithm: "+a[k-1])}b++}return v},o.prototype.decodePalette=function(){var a,u,i,c,p,C,g,w,S;for(i=this.palette,C=this.transparency.indexed||[],p=new Uint8Array((C.length||0)+i.length),c=0,i.length,a=0,u=g=0,w=i.length;g<w;u=g+=3)p[c++]=i[u],p[c++]=i[u+1],p[c++]=i[u+2],p[c++]=(S=C[a++])!=null?S:255;return p},o.prototype.copyToImageData=function(a,u){var i,c,p,C,g,w,S,h,d,m,y;if(c=this.colors,d=null,i=this.hasAlphaChannel,this.palette.length&&(d=(y=this._decodedPalette)!=null?y:this._decodedPalette=this.decodePalette(),c=4,i=!0),h=(p=a.data||a).length,g=d||u,C=w=0,c===1)for(;C<h;)S=d?4*u[C/4]:w,m=g[S++],p[C++]=m,p[C++]=m,p[C++]=m,p[C++]=i?g[S++]:this.transparency.grayscale&&this.transparency.grayscale===m?0:255,w=S;else for(;C<h;)S=d?4*u[C/4]:w,p[C++]=g[S++],p[C++]=g[S++],p[C++]=g[S++],p[C++]=i?g[S++]:this.transparency.rgb&&this.transparency.rgb[1]===g[S-3]&&this.transparency.rgb[3]===g[S-2]&&this.transparency.rgb[5]===g[S-1]?0:255,w=S},o.prototype.decode=function(){var a;return a=new Uint8Array(this.width*this.height*4),this.copyToImageData(a,this.decodePixels()),a},s=t.document&&t.document.createElement("canvas"),f=s&&s.getContext("2d"),l=function(a){var u;return f.width=a.width,f.height=a.height,f.clearRect(0,0,a.width,a.height),f.putImageData(a,0,0),(u=new Image).src=s.toDataURL(),u},o.prototype.decodeFrames=function(a){var u,i,c,p,C,g,w,S;if(this.animation){for(S=[],i=C=0,g=(w=this.animation.frames).length;C<g;i=++C)u=w[i],c=a.createImageData(u.width,u.height),p=this.decodePixels(new Uint8Array(u.data)),this.copyToImageData(c,p),u.imageData=c,S.push(u.image=l(c));return S}},o.prototype.renderFrame=function(a,u){var i,c,p;return i=(c=this.animation.frames)[u],p=c[u-1],u===0&&a.clearRect(0,0,this.width,this.height),p?.disposeOp===r?a.clearRect(p.xOffset,p.yOffset,p.width,p.height):p?.disposeOp===n&&a.putImageData(p.imageData,p.xOffset,p.yOffset),i.blendOp===e&&a.clearRect(i.xOffset,i.yOffset,i.width,i.height),a.drawImage(i.image,i.xOffset,i.yOffset)},o.prototype.animate=function(a){var u,i,c,p,C,g,w=this;return i=0,g=this.animation,p=g.numFrames,c=g.frames,C=g.numPlays,(u=function(){var S,h;if(S=i++%p,h=c[S],w.renderFrame(a,S),p>1&&i/p<C)return w.animation._timeout=setTimeout(u,h.delay)})()},o.prototype.stopAnimation=function(){var a;return clearTimeout((a=this.animation)!=null?a._timeout:void 0)},o.prototype.render=function(a){var u,i;return a._png&&a._png.stopAnimation(),a._png=this,a.width=this.width,a.height=this.height,u=a.getContext("2d"),this.animation?(this.decodeFrames(u),this.animate(u)):(i=u.createImageData(this.width,this.height),this.copyToImageData(i,this.decodePixels()),u.putImageData(i,0,0))},o}(self),so=new Set(["jpg","png","bmp","gif"]);function lo(t,e){return ft(this,null,function*(){if(!jt)throw new dt("rasterCoded:decode","lerc decoder is not supported on big endian platform");yield te();let{offset:r}=e,{width:n,height:l,pixelType:s,statistics:f,depthCount:o,noDataValues:a,bandMasks:u,pixels:i,mask:c}=ee(t,{inputOffset:r,returnInterleaved:e.returnInterleaved}),p=new Z({width:n,height:l,pixelType:s.toLowerCase(),pixels:i,mask:c,statistics:f,bandMasks:u,depthCount:o,noDataValues:a});return f?.length||p.updateStatistics(),p})}function uo(t,e){return ft(this,null,function*(){let r=yield mr(t,Q(X({},e),{noDataValue:null}));Mt(r);let n=new Z({width:r.width,height:r.height,pixels:r.pixels,pixelType:r.pixelType.toLowerCase(),mask:r.mask,bandMasks:r.bandMasks,statistics:null});return n.updateStatistics(),n})}function co(t,e){return ft(this,null,function*(){let r=yield dr(t,e.customOptions),n=new Z({width:r.width,height:r.height,pixels:r.pixels,pixelType:r.pixelType.toLowerCase(),mask:r.mask,statistics:null});return n.updateStatistics(),n})}function gr(t,e){let r=e.pixelType||"u8",n=Z.getPixelArrayConstructor(r),l=r==="u8"?t:new n(t.buffer),s=[],f=e.planes||1;if(f===1)s.push(l);else for(let a=0;a<f;a++){let u=(e.width||1)*(e.height||t.length),i=new n(u);for(let c=0;c<u;c++)i[c]=l[c*f+a];s.push(i)}let o=new Z({width:e.width||1,height:e.height||t.length,pixels:s,pixelType:r,statistics:null});return o.updateStatistics(),o}function fo(t,e){return gr(new wt(new Uint8Array(t)).getBytes(),e)}function ho(t,e){return gr(_t(t,e.offset,e.eof,!e.isInputBigEndian),e)}function po(t,e,r){let{pixelTypeCtor:n}=bo(e.pixelType),l=(0,re.decode)(t,{width:e.width,height:e.height,pixelType:n,format:r}),s=new Z({width:e.width,height:e.height,pixels:l.pixels,pixelType:e.pixelType,mask:l.mask,statistics:null});return s.updateStatistics(),s}function mo(t,e){let r=$t.decode(t,e.hasNoZlibMask??void 0),n=new Z({width:r.width,height:r.height,pixels:r.pixels,pixelType:"U8",mask:r.mask,statistics:null});return n.updateStatistics(),n}function go(t,e){let r=new Uint8Array(t),n=new ao(r),{width:l,height:s}=e,f=l*s,o=n.decode(),a,u=0,i=0,c=new Uint8Array(f);for(u=0;u<f;u++)c[u]=o[4*u+3];let p=new Z({width:l,height:s,pixels:[],pixelType:"U8",mask:c,statistics:[]});for(u=0;u<3;u++){for(a=new Uint8Array(f),i=0;i<f;i++)a[i]=o[4*i+u];p.addData({pixels:a})}return p.updateStatistics(),p}function yo(t,e,r,n){return ft(this,null,function*(){let l=new Xt,s=X({applyJpegMask:!1,format:e},r),f=yield l.decode(t,s,n),o=new Z(f);return o.updateStatistics(),o})}function yr(t){if(t==null)throw new dt("rasterCodec:decode","parameter encodeddata is required.");let e=new Uint8Array(t,0,10),r="";return e[0]===255&&e[1]===216?r="jpg":e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71?r="png":e[0]===67&&e[1]===110&&e[2]===116&&e[3]===90&&e[4]===73&&e[5]===109&&e[6]===97&&e[7]===103&&e[8]===101&&e[9]===32?r="lerc":e[0]===76&&e[1]===101&&e[2]===114&&e[3]===99&&e[4]===50&&e[5]===32?r="lerc2":e[0]===73&&e[1]===73&&e[2]===42&&e[3]===0||e[0]===77&&e[1]===77&&e[2]===0&&e[3]===42||e[0]===73&&e[1]===73&&e[2]===43&&e[3]===0||e[0]===77&&e[1]===77&&e[2]===0&&e[3]===43?r="tiff":e[0]===71&&e[1]===73&&e[2]===70?r="gif":e[0]===66&&e[1]===77?r="bmp":String.fromCharCode.apply(null,e).toLowerCase().includes("error")&&(r="error"),r}function Co(t){let e=null;switch(t){case"lerc":case"lerc2":e=lo;break;case"jpg":e=mo;break;case"png":e=go;break;case"bsq":case"bip":e=(r,n)=>po(r,n,t);break;case"tiff":e=uo;break;case"deflate":e=fo;break;case"lzw":e=ho;break;case"error":e=()=>{throw new dt("rasterCodec:decode","input data contains error")};break;default:e=()=>{throw new dt("rasterCodec:decode","unsupported raster format")}}return e}function bo(t){let e=null,r=null;switch(t?t.toLowerCase():"f32"){case"u1":case"u2":case"u4":case"u8":r=255,e=Uint8Array;break;case"u16":r=r||65535,e=Uint16Array;break;case"u32":r=r||2**32-1,e=Uint32Array;break;case"s8":r=r||-128,e=Int8Array;break;case"s16":r=r||-32768,e=Int16Array;break;case"s32":r=r||0-2**31,e=Int32Array;break;default:e=Float32Array}return{pixelTypeCtor:e,noDataValue:r}}function wo(t,e=1){if(!t)return;let{pixels:r,width:n,height:l,mask:s}=t;if(!r||r.length===0)return;let f=r.length,o=n-1,a=l-1,u=[],i,c,p,C,g,w,S=null,h=Z.getPixelArrayConstructor(t.pixelType);if(e===0){for(i=0;i<f;i++){for(g=r[i],w=new h(o*a),c=0;c<a;c++)for(C=c*n,p=0;p<o;p++)w[c*o+p]=g[C+p];u.push(w)}if(s!=null)for(S=new Uint8Array(o*a),c=0;c<a;c++)for(C=c*n,p=0;p<o;p++)S[c*o+p]=s[C+p]}else{for(i=0;i<f;i++){for(g=r[i],w=new h(o*a),c=0;c<a;c++)for(C=c*n,p=0;p<o;p++)w[c*o+p]=(g[C+p]+g[C+p+1]+g[C+n+p]+g[C+n+p+1])/4;u.push(w)}if(s)for(S=new Uint8Array(o*a),c=0;c<a;c++)for(C=c*n,p=0;p<o;p++)S[c*o+p]=Math.min.apply(null,[s[C+p],s[C+p+1],s[C+n+p],s[C+n+p+1]])}t.width=o,t.height=a,t.mask=S,t.pixels=u}function Ti(t){let e=yr(t);return e==="lerc2"?e="lerc":e==="error"&&(e=""),e}function ki(n){return ft(this,arguments,function*(t,e={},r){if(t==null)throw new dt("rasterCodec:decode","missing encodeddata parameter.");let l=e.format?.toLowerCase();if(!(l!=="bsq"&&l!=="bip"||e.width!=null&&e.height!=null))throw new dt("rasterCodec:decode","requires width and height in options parameter.");if(l==="tiff"&&e.customOptions)return co(t,e);if((!l||l!=="bsq"&&l!=="bip"&&l!=="deflate"&&l!=="lzw")&&(l=yr(t)),e.useCanvas&&so.has(l))return yo(t,l,e,r);let s=Co(l),f;e.isPoint&&((e=X({},e)).width!=null&&e.width++,e.height!=null&&e.height++);let{offsets:o}=e;if(o&&o.length>1){let a=o.map((c,p)=>s(t.slice(c,o[p+1]),e)),u=yield Promise.all(a);f=u[0],f.pixels=u.map(c=>c.pixels[0]);let i=u.map(c=>c.mask);u.some(c=>c!=null)&&(i.forEach((c,p)=>{c==null&&(i[p]=new Uint8Array(f.width*f.height).fill(255))}),f.bandMasks=i,f.mask=Z.combineBandMasks(i)),f.updateStatistics()}else f=yield s(t,Q(X({},e),{offset:o?.[0]??e.offset}));return l!=="jpg"&&e.noDataValue!=null&&f.depthCount===1&&Vt(f,e.noDataValue,{customFloatTolerance:e.tolerance}),e.isPoint&&wo(f),f})}var Ei=new Kt({none:"none",standardDeviation:"standard-deviation",histogramEqualization:"histogram-equalization",minMax:"min-max",percentClip:"percent-clip",sigmoid:"sigmoid"}),Cr={0:"none",3:"standardDeviation",4:"histogramEqualization",5:"minMax",6:"percentClip",9:"sigmoid"};var Ee=1,vo=[.299,.587,.114];function Pe(t,e=256){e=Math.min(e,256);let{size:r,counts:n}=t,l=new Uint8Array(r),s=n.reduce((i,c)=>i+c/e,0),f=0,o=0,a=0,u=s;for(let i=0;i<r;i++)if(a+=n[i],!(i<r-1&&a+n[i+1]<u)){for(;f<e-1&&u<a;)f++,u+=s;for(let c=o;c<=i;c++)l[c]=f;o=i+1}for(let i=o;i<r;i++)l[i]=e-1;return l}function Re(t){let{minCutOff:e,maxCutOff:r,gamma:n,pixelType:l,rounding:s}=t,f=t.outMin||0,o=t.outMax||255;if(!["u8","u16","s8","s16"].includes(l))return null;let a=e.length,u,i,c=0;l==="s8"?c=-127:l==="s16"&&(c=-32767);let p=256;["u16","s16"].includes(l)&&(p=65536);let C=[],g=[],w=o-f;for(u=0;u<a;u++)g[u]=r[u]-e[u],C[u]=g[u]===0?0:w/g[u];let S,h=[],d,m,y;if(n&&n.length>=a){let v=wr(a,n);for(u=0;u<a;u++){for(y=[],i=0;i<p;i++)if(g[u]!==0)if(d=i+c,S=(d-e[u])/g[u],m=1,n[u]>1&&(m-=(1/w)**(S*v[u])),d<r[u]&&d>e[u]){let k=m*w*S**(1/n[u])+f;y[i]=s==="floor"?Math.floor(k):s==="round"?Math.round(k):k}else d>=r[u]?y[i]=o:y[i]=f;else y[i]=f;h[u]=y}}else for(u=0;u<a;u++){for(y=[],i=0;i<p;i++)if(d=i+c,d<=e[u])y[i]=f;else if(d>=r[u])y[i]=o;else{let v=(d-e[u])*C[u]+f;y[i]=s==="floor"?Math.floor(v):s==="round"?Math.round(v):v}h[u]=y}if(t.contrastOffset!=null){let v=So(t.contrastOffset,t.brightnessOffset);for(u=0;u<a;u++)for(y=h[u],i=0;i<p;i++)y[i]=v[y[i]]}return{lut:h,offset:c}}function So(t,e){let r=Math.min(Math.max(t,-100),100),n=Math.min(Math.max(e??0,-100),100),l=255,s=128,f=0,o=0,a=new Uint8Array(256);for(f=0;f<256;f++)r>0&&r<100?o=(200*f-100*l+2*l*n)/(2*(100-r))+s:r<=0&&r>-100?o=(200*f-100*l+2*l*n)*(100+r)/2e4+s:r===100?(o=200*f-100*l+(l+1)*(100-r)+2*l*n,o=o>0?l:0):r===-100&&(o=s),a[f]=o>l?l:o<0?0:o;return a}function br(t,e,r){let n=[];for(let l=0;l<e.length;l++){let s=0,f=0,o=0;"min"in e[l]?{min:s,max:f,avg:o}=e[l]:[s,f,o]=e[l];let a=o??0;t!=="u8"&&(a=255*(a-s)/(f-s)),r&&(a*=vo[l]),n.push(To(a))}return n}function To(t){if(t<=0||t>=255)return Ee;let e=0;t!==150&&(e=t<=150?45*Math.cos(.01047*t):17*Math.sin(.021*t));let r=255,n=t+e,l=Math.log(t/r),s=Math.log(n/r);if(s===0)return Ee;let f=l/s;return isNaN(f)?Ee:Math.min(9.9,Math.max(.01,f))}function ko(t,e,r,n){let l=1/0,s=-1/0,f=0,o=0,a=0,u=0,i=t.length,c=new Map,p=[];for(let b=0;b<i;b++){let x=t[b];if(!e||e[b]){p.push(x);let T=(c.get(x)??0)+1;c.set(x,T),T>u&&(u=T,a=x),l=x<l?x:l,s=x>s?x:s,f+=x,o++}}if(o===0)return{statistics:{min:0,max:0,avg:0,stddev:0,mode:0,median:0},histogram:null};let C=f/o,g=0;for(let b=0;b<i;b++)e&&!e[b]||(g+=(t[b]-C)**2);let w=e?e.filter(b=>b).length:i,S=w<=1?0:Math.sqrt(g/(w-1));p.sort((b,x)=>b-x);let h=o>>>1,d={min:l,max:s,avg:C,stddev:S,mode:a,median:o%2?p[Math.floor(h)]:(p[h-1]+p[h])/2};if(!n)return{statistics:d,histogram:null};if(["u8","s8","u4","u2","u1"].includes(r)){let b=s-l+1,x=new Uint32Array(b);for(let T=0;T<i;T++)e&&!e[T]||x[t[T]-l]++;return{statistics:d,histogram:{min:l-.5,max:s+.5,size:b,counts:x}}}let m=256,y=new Uint32Array(m),v=(s-l)/m;if(v===0)return{statistics:d,histogram:{min:l,max:s,size:1,counts:new Uint32Array(1).fill(o)}};let k=new Uint32Array(m+1);for(let b=0;b<i;b++)e&&!e[b]||k[Math.floor((t[b]-l)/v)]++;for(let b=0;b<m-1;b++)y[b]=k[b];return y[m-1]=k[m-1]+k[m],{statistics:d,histogram:{min:l,max:s,size:m,counts:y}}}function Di(t){let{pixels:e,mask:r,pixelType:n,bandMasks:l}=t,s=e.map((f,o)=>ko(f,l?.[o]??r,n,!0));return{statistics:s.map(({statistics:f})=>f),histograms:s.map(({histogram:f})=>f)}}function xo(t){if(!t?.pixels?.length)return null;let{pixels:e,mask:r,bandMasks:n,pixelType:l}=t,s=t.width*t.height,f=e.length,o=[],a=[],u=256,i,c,p,C;for(let g=0;g<f;g++){p=new Uint32Array(u);let w=e[g],S=n?.[g]??r;if(l==="u8"){if(i=255,c=0,S){for(let A=0;A<s;A++)if(S[A]){let E=w[A];i=E<i?E:i,c=E>c?E:c,p[E]++}}else for(let A=0;A<s;A++){let E=w[A];i=E<i?E:i,c=E>c?E:c,p[E]++}p=p.slice(i,c+1)}else{let A=!1;t.statistics||(t.updateStatistics(),A=!0);let E=t.statistics;i=E[g].minValue,c=E[g].maxValue;let P=(c-i)/u;if(P===0){!E||t.validPixelCount||A||t.updateStatistics();let R=(t.validPixelCount||t.width*t.height)/u;for(let L=0;L<u;L++)p[L]=Math.round(R*(L+1))-Math.round(R*L)}else{C=new Uint32Array(u+1);for(let R=0;R<s;R++)S&&!S[R]||C[Math.floor((w[R]-i)/P)]++;for(let R=0;R<u-1;R++)p[R]=C[R];p[u-1]=C[u-1]+C[u]}}let h=l==="u8"?i-.5:i,d=l==="u8"?c+.5:c;o.push({min:h,max:d,size:p.length,counts:p});let m=0,y=0,v=0;for(let A=0;A<p.length;A++)m+=p[A],y+=A*p[A];let k=y/m;for(let A=0;A<p.length;A++)v+=p[A]*(A-k)**2;let b=Math.sqrt(v/(m-1)),x=(d-h)/p.length,T=(k+(l==="u8"?0:.5))*x+i,I=b*x;a.push({min:i,max:c,avg:T,stddev:I})}return{statistics:a,histograms:o}}function Ui(t){let e=[];for(let r=0;r<t.length;r++){let{min:n,max:l,size:s,counts:f}=t[r],o=0,a=0;for(let g=0;g<s;g++)o+=f[g],a+=g*f[g];let u=a/o,i=0;for(let g=0;g<s;g++)i+=f[g]*(g-u)**2;let c=(l-n)/s,p=(u+.5)*c+n,C=Math.sqrt(i/(o-1))*c;e.push({min:n,max:l,avg:p,stddev:C})}return e}function Nt(t,e){let{pixelBlock:r,bandIds:n,returnHistogramLut:l,rasterInfo:s}=e,f=null,o=null,a=t.stretchType;if(typeof a=="number"&&(a=Cr[a]),t.dra)if(a==="minMax"&&r?.statistics)f=r.statistics.map(I=>[I.minValue,I.maxValue,0,0]);else{let I=xo(r);f=I!=null?I.statistics:null,o=I!=null?I.histograms:null}else f=t.statistics?.length?t.statistics:s.statistics,o="histograms"in t?t.histograms:void 0,o||(o=s.histograms);a!=="percentClip"&&a!=="histogramEqualization"||o?.length||(a="minMax");let u=f?.length||o?.length||s.bandCount,i=[],c=[],p,C,g,w,S,h,d,m,y;f&&!Array.isArray(f[0])&&(f=f.map(I=>[I.min,I.max,I.avg,I.stddev]));let[v,k]=Ke(s.pixelType);if(!f?.length){for(f=[],m=0;m<u;m++)f.push([v,k,1,1]);a==="standardDeviation"&&(a="minMax")}switch(a){case"none":for(m=0;m<u;m++)i[m]=v,c[m]=k;break;case"minMax":for(m=0;m<u;m++){let I=f[m];i[m]=I[0],c[m]=I[1]}break;case"standardDeviation":{let{numberOfStandardDeviations:I=2}=t;for(m=0;m<u;m++){let A=f[m];i[m]=A[2]-I*A[3],c[m]=A[2]+I*A[3],i[m]<A[0]&&(i[m]=A[0]),c[m]>A[1]&&(c[m]=A[1])}}break;case"histogramEqualization":for(Mt(o),m=0;m<u;m++)i[m]=o[m].min,c[m]=o[m].max;break;case"percentClip":for(Mt(o),m=0;m<o.length;m++){for(p=o[m],S=new Uint32Array(p.size),w=[...p.counts],w.length>=20&&(w[0]=w[1]=w[2]=w[w.length-1]=w[w.length-2]=0),g=0,C=(p.max-p.min)/p.size,d=p.min===-.5&&C===1?.5:0,y=0;y<p.size;y++)g+=w[y],S[y]=g;for(h=(t.minPercent||0)*g/100,i[m]=p.min+d,y=0;y<p.size;y++)if(S[y]>h){i[m]=p.min+C*(y+d);break}for(h=(1-(t.maxPercent||0)/100)*g,c[m]=p.max+d,y=p.size-2;y>=0;y--)if(S[y]<h){c[m]=p.min+C*(y+2-d);break}if(c[m]<i[m]){let I=i[m];i[m]=c[m],c[m]=I}}break;default:for(m=0;m<u;m++){let I=f[m];i[m]=I[0],c[m]=I[1]}}let b,x,T;return a==="histogramEqualization"?(Mt(o),x=o[0].size||256,b=0,l&&(T=o.map(I=>Pe(I)))):(x=t.max||255,b=t.min||0),Io({minCutOff:i,maxCutOff:c,outMax:x,outMin:b,histogramLut:T},n)}function Io(t,e){if(e==null||e.length===0)return t;let r=Math.max.apply(null,e),{minCutOff:n,maxCutOff:l,outMin:s,outMax:f,histogramLut:o}=t;return n.length===e.length||n.length<=r?t:{minCutOff:e.map(a=>n[a]),maxCutOff:e.map(a=>l[a]),histogramLut:o?e.map(a=>o[a]):null,outMin:s,outMax:f}}function wr(t,e){let r=new Float32Array(t);for(let n=0;n<t;n++)e[n]>1?e[n]>2?r[n]=6.5+(e[n]-2)**2.5:r[n]=6.5+100*(2-e[n])**4:r[n]=1;return r}function ae(t,e){if(!t?.pixels?.length)return t;let{mask:r,bandMasks:n,width:l,height:s,pixels:f}=t,{minCutOff:o,maxCutOff:a,gamma:u}=e,i=e.outMin||0,c=e.outMax||255,p=l*s,C=e.outputPixelType||"u8",g=t.pixels.map(()=>Z.createEmptyBand(C,p)),w=g.length,S=c-i,h=[],d=[];for(let b=0;b<w;b++)d[b]=a[b]-o[b],h[b]=d[b]===0?0:S/d[b];let m=C.startsWith("u")||C.startsWith("s"),y=u&&u.length>=w,v=!!e.isRenderer;if(y){let b=wr(w,u);for(let x=0;x<w;x++){let T=n?.[x]??r;for(let I=0;I<p;I++)if(T==null||T[I]){if(d[x]===0){g[x][I]=i;continue}let A=f[x][I],E=(A-o[x])/d[x],P=1;if(u[x]>1&&(P-=(1/S)**(E*b[x])),A<a[x]&&A>o[x]){let R=P*S*E**(1/u[x])+i;g[x][I]=v?Math.floor(R):m?Math.round(R):R}else A>=a[x]?g[x][I]=c:g[x][I]=i}}}else for(let b=0;b<w;b++){let x=n?.[b]??r;for(let T=0;T<p;T++)if(x==null||x[T]){let I=f[b][T];if(I<a[b]&&I>o[b]){let A=(I-o[b])*h[b]+i;g[b][T]=v?Math.floor(A):m?Math.round(A):A}else I>=a[b]?g[b][T]=c:g[b][T]=i}}let k=new Z({width:l,height:s,mask:r,bandMasks:n,pixels:g,pixelType:C});return k.updateStatistics(),k}var Le;function Et(t){return t=Number(t),isNaN(t)?void 0:t}var ht=Le=class extends gt{constructor(){super(...arguments),this.name=null,this.minWavelength=void 0,this.maxWavelength=void 0,this.radianceBias=void 0,this.radianceGain=void 0,this.reflectanceBias=void 0,this.reflectanceGain=void 0,this.solarIrradiance=void 0}clone(){return new Le({name:this.name,minWavelength:this.minWavelength,maxWavelength:this.maxWavelength,radianceBias:this.radianceBias,radianceGain:this.radianceGain,reflectanceBias:this.reflectanceBias,reflectanceGain:this.reflectanceGain,solarIrradiance:this.solarIrradiance})}};D([G({json:{name:"BandName",write:!0}})],ht.prototype,"name",void 0),D([G({json:{name:"WavelengthMin",read:{reader:Et},write:!0}})],ht.prototype,"minWavelength",void 0),D([G({json:{name:"WavelengthMax",read:{reader:Et},write:!0}})],ht.prototype,"maxWavelength",void 0),D([G({json:{name:"RadianceBias",read:{reader:Et},write:!0}})],ht.prototype,"radianceBias",void 0),D([G({json:{name:"RadianceGain",read:{reader:Et},write:!0}})],ht.prototype,"radianceGain",void 0),D([G({json:{name:"ReflectanceBias",read:{reader:Et},write:!0}})],ht.prototype,"reflectanceBias",void 0),D([G({json:{name:"ReflectanceGain",read:{reader:Et},write:!0}})],ht.prototype,"reflectanceGain",void 0),D([G({json:{name:"SolarIrradiance",read:{reader:Et},write:!0}})],ht.prototype,"solarIrradiance",void 0),ht=Le=D([mt("esri.layers.support.RasterBandInfo")],ht);var Me=ht;var Oe;function zt(t){return t=Number(t),isNaN(t)?void 0:t}var lt=Oe=class extends gt{constructor(){super(...arguments),this.acquisitionDate=void 0,this.cloudCover=void 0,this.productName=void 0,this.sensorName=null,this.sensorAzimuth=void 0,this.sensorElevation=void 0,this.sunAzimuth=void 0,this.sunElevation=void 0}readAcquisitionDate(t){return new Date(t)}writeAcquisitionDate(t,e){e.AcquisitionDate=t.getTime()}clone(){return new Oe({acquisitionDate:this.acquisitionDate,cloudCover:this.cloudCover,productName:this.productName,sensorName:this.sensorName,sensorAzimuth:this.sensorAzimuth,sensorElevation:this.sensorElevation,sunAzimuth:this.sunAzimuth,sunElevation:this.sunElevation})}};D([G({json:{name:"AcquisitionDate",write:!0}})],lt.prototype,"acquisitionDate",void 0),D([He("acquisitionDate")],lt.prototype,"readAcquisitionDate",null),D([je("acquisitionDate")],lt.prototype,"writeAcquisitionDate",null),D([G({json:{name:"CloudCover",read:{reader:zt},write:!0}})],lt.prototype,"cloudCover",void 0),D([G({json:{name:"ProductName",write:!0}})],lt.prototype,"productName",void 0),D([G({json:{name:"SensorName",write:!0}})],lt.prototype,"sensorName",void 0),D([G({json:{name:"SensorAzimuth",read:{reader:zt},write:!0}})],lt.prototype,"sensorAzimuth",void 0),D([G({json:{name:"SensorElevation",read:{reader:zt},write:!0}})],lt.prototype,"sensorElevation",void 0),D([G({json:{name:"SunAzimuth",read:{reader:zt},write:!0}})],lt.prototype,"sunAzimuth",void 0),D([G({json:{name:"SunElevation",read:{reader:zt},write:!0}})],lt.prototype,"sunElevation",void 0),lt=Oe=D([mt("esri.layers.support.RasterSensorInfo")],lt);var vr=lt;var De,rt=De=class extends gt{constructor(){super(...arguments),this.blockWidth=void 0,this.blockHeight=void 0,this.compression=null,this.origin=null,this.firstPyramidLevel=null,this.maximumPyramidLevel=null,this.pyramidScalingFactor=2,this.pyramidBlockWidth=null,this.pyramidBlockHeight=null,this.isVirtualTileInfo=!1,this.tileInfo=null,this.transposeInfo=null,this.blockBoundary=null}clone(){return new De({blockWidth:this.blockWidth,blockHeight:this.blockHeight,compression:this.compression,origin:$(this.origin),firstPyramidLevel:this.firstPyramidLevel,maximumPyramidLevel:this.maximumPyramidLevel,pyramidResolutions:$(this.pyramidResolutions),pyramidScalingFactor:this.pyramidScalingFactor,pyramidBlockWidth:this.pyramidBlockWidth,pyramidBlockHeight:this.pyramidBlockHeight,isVirtualTileInfo:this.isVirtualTileInfo,tileInfo:$(this.tileInfo),transposeInfo:$(this.transposeInfo),blockBoundary:$(this.blockBoundary)})}};D([G({type:Number,json:{write:!0}})],rt.prototype,"blockWidth",void 0),D([G({type:Number,json:{write:!0}})],rt.prototype,"blockHeight",void 0),D([G({type:String,json:{write:!0}})],rt.prototype,"compression",void 0),D([G({type:We,json:{write:!0}})],rt.prototype,"origin",void 0),D([G({type:Number,json:{write:!0}})],rt.prototype,"firstPyramidLevel",void 0),D([G({type:Number,json:{write:!0}})],rt.prototype,"maximumPyramidLevel",void 0),D([G({json:{write:!0}})],rt.prototype,"pyramidResolutions",void 0),D([G({type:Number,json:{write:!0}})],rt.prototype,"pyramidScalingFactor",void 0),D([G({type:Number,json:{write:!0}})],rt.prototype,"pyramidBlockWidth",void 0),D([G({type:Number,json:{write:!0}})],rt.prototype,"pyramidBlockHeight",void 0),D([G({type:Boolean,json:{write:!0}})],rt.prototype,"isVirtualTileInfo",void 0),D([G({json:{write:!0}})],rt.prototype,"tileInfo",void 0),D([G()],rt.prototype,"transposeInfo",void 0),D([G()],rt.prototype,"blockBoundary",void 0),rt=De=D([mt("esri.layers.support.RasterStorageInfo")],rt);var Sr=rt;var Ue,K=Ue=class extends gt{constructor(t){super(t),this.attributeTable=null,this.bandCount=null,this.colormap=null,this.extent=null,this.format=void 0,this.height=null,this.width=null,this.histograms=null,this.keyProperties={},this.multidimensionalInfo=null,this.noDataValue=null,this.pixelSize=null,this.pixelType=null,this.isPseudoSpatialReference=!1,this.spatialReference=null,this.statistics=null,this.storageInfo=null,this.transform=null}get bandInfos(){let t=this.keyProperties.BandProperties,{bandCount:e}=this;if(!t?.length||t.length<e){let n=[];for(let l=1;l<=e;l++)n.push(new Me({name:"band_"+l}));return n}let r=t.map(n=>Me.fromJSON(n));for(let n=0;n<r.length;n++)r[n].name=r[n].name||"band_"+(n+1);return r}get dataType(){let t=this.keyProperties?.DataType?.toLowerCase()??"generic";return t==="stdtime"?"standard-time":t}get nativeExtent(){return this._get("nativeExtent")||this.extent}set nativeExtent(t){t&&this._set("nativeExtent",t)}get nativePixelSize(){if(this.transform==null||!this.transform.affectsPixelSize)return this.pixelSize;let t=this.nativeExtent;return{x:t.width/this.width,y:t.height/this.height}}get hasMultidimensionalTranspose(){return!!this.storageInfo?.transposeInfo}get sensorInfo(){if(this.keyProperties?.SensorName)return vr.fromJSON(this.keyProperties)}clone(){return new Ue({attributeTable:$(this.attributeTable),bandCount:this.bandCount,colormap:$(this.colormap),extent:$(this.extent),nativePixelSize:$(this.nativePixelSize),format:this.format,height:this.height,width:this.width,histograms:$(this.histograms),keyProperties:$(this.keyProperties),multidimensionalInfo:$(this.multidimensionalInfo),noDataValue:this.noDataValue,pixelSize:$(this.pixelSize),pixelType:this.pixelType,isPseudoSpatialReference:this.isPseudoSpatialReference,spatialReference:$(this.spatialReference),statistics:$(this.statistics),storageInfo:$(this.storageInfo),transform:$(this.transform)})}};D([G({json:{write:!0}})],K.prototype,"attributeTable",void 0),D([G({json:{write:!0}})],K.prototype,"bandCount",void 0),D([G({readOnly:!0})],K.prototype,"bandInfos",null),D([G({json:{write:!0}})],K.prototype,"colormap",void 0),D([G({type:String,readOnly:!0})],K.prototype,"dataType",null),D([G({type:fe,json:{write:!0}})],K.prototype,"extent",void 0),D([G({type:fe,json:{write:!0}})],K.prototype,"nativeExtent",null),D([G({json:{write:!0}})],K.prototype,"nativePixelSize",null),D([G({json:{write:!0}})],K.prototype,"format",void 0),D([G({json:{write:!0}})],K.prototype,"height",void 0),D([G({json:{write:!0}})],K.prototype,"width",void 0),D([G({json:{write:!0}})],K.prototype,"hasMultidimensionalTranspose",null),D([G({json:{write:!0}})],K.prototype,"histograms",void 0),D([G({json:{write:!0}})],K.prototype,"keyProperties",void 0),D([G({json:{write:!0}})],K.prototype,"multidimensionalInfo",void 0),D([G({json:{write:!0}})],K.prototype,"noDataValue",void 0),D([G({json:{write:!0}})],K.prototype,"pixelSize",void 0),D([G({json:{write:!0}})],K.prototype,"pixelType",void 0),D([G()],K.prototype,"isPseudoSpatialReference",void 0),D([G({readOnly:!0})],K.prototype,"sensorInfo",null),D([G({type:ze,json:{write:!0}})],K.prototype,"spatialReference",void 0),D([G({json:{write:!0}})],K.prototype,"statistics",void 0),D([G({type:Sr,json:{write:!0}})],K.prototype,"storageInfo",void 0),D([G({json:{write:!0}})],K.prototype,"transform",void 0),K=Ue=D([mt("esri.layers.support.RasterInfo")],K);var Tr=K;var ot=1,Bt=1/111e3;function Ge(t){let{altitude:e,azimuth:r}=t,{hillshadeType:n,pixelSizePower:l=1,pixelSizeFactor:s=1,scalingType:f,isGCS:o,resolution:a}=t,u=n==="multi-directional"?2*t.zFactor:t.zFactor,{x:i,y:c}=a,p=u/(8*i),C=u/(8*c);if(o&&u>.001&&(p/=Bt,C/=Bt),f==="adjusted")if(o){let E=i*Bt,P=c*Bt;p=(u+E**l*s)/(8*E),C=(u+P**l*s)/(8*P)}else p=(u+i**l*s)/(8*i),C=(u+c**l*s)/(8*c);let g=(90-e)*Math.PI/180,w=Math.cos(g),S=(360-r+90)*Math.PI/180,h=Math.sin(g)*Math.cos(S),d=Math.sin(g)*Math.sin(S),m=[315,270,225,360,180,0],y=[60,60,60,60,60,90],v=new Float32Array([3,5,3,2,1,4]),k=v.reduce((E,P)=>E+P),b=v.map(E=>E/k),x=n==="multi-directional"?m.length:1,T=new Float32Array(6),I=new Float32Array(6),A=new Float32Array(6);if(n==="multi-directional")for(let E=0;E<x;E++)e=y[E],r=m[E],g=(90-e)*Math.PI/180,w=Math.cos(g),S=(360-r+90)*Math.PI/180,h=Math.sin(g)*Math.cos(S),d=Math.sin(g)*Math.sin(S),T[E]=w,I[E]=h,A[E]=d;else T.fill(w),I.fill(h),A.fill(d);return{resolution:a,factor:[p,C],sinZcosA:h,sinZsinA:d,cosZ:w,sinZcosAs:I,sinZsinAs:A,cosZs:T,weights:b,hillshadeType:["traditional","multi-directional"].indexOf(n)}}function se(t,e){let{width:r,height:n}=t,l=r*n,s=new Uint8Array(l),f=t.mask!=null,o;if(f){o=new Uint8Array(t.mask);for(let k=0;k<o.length;k++)o[k]&&(s[k]=1,o[k]=1)}let a=t.pixels[0],u=new Float32Array(l),i=new Float32Array(l),c,p=0;if(e){let{resolution:k}=e,b=k?(k.x+k.y)/2:1;p=200*e.zFactor/(b*b),c=new Float32Array(l)}let C=e?.curvatureType,g,w,S,h,d,m,y,v;for(let k=ot;k<n-ot;k++){let b=k*r;for(let x=ot;x<r-ot;x++){let T=b+x;if(!o||o[T]!==0){if(o){if(o[T-r-1]+o[T-r]+o[T-r+1]+o[T-1]+o[T+1]+o[T+r-1]+o[T+r]+o[T+r+1]<7){s[T]=0;continue}g=o[T-r-1]?a[T-r-1]:a[T],w=o[T-r]?a[T-r]:a[T],S=o[T-r+1]?a[T-r+1]:a[T],h=o[T-1]?a[T-1]:a[T],d=o[T+1]?a[T+1]:a[T],m=o[T+r-1]?a[T+r-1]:a[T],y=o[T+r]?a[T+r]:a[T],v=o[T+r+1]?a[T+r+1]:a[T]}else g=a[T-r-1],w=a[T-r],S=a[T-r+1],h=a[T-1],d=a[T+1],m=a[T+r-1],y=a[T+r],v=a[T+r+1];if(u[T]=S+d+d+v-(g+h+h+m),i[T]=m+y+y+v-(g+w+w+S),c!=null){let I=a[T],A=.5*(h+d)-I,E=.5*(w+y)-I;if(C==="standard")c[T]=-p*(A+E);else{let P=(-g+S+m-v)/4,R=(-h+d)/2,L=(w-y)/2,B=R*R,M=L*L,j=B+M;j&&(c[T]=C==="profile"?p*(A*B+E*M+P*R*L)/j:-p*(A*M+E*B-P*R*L)/j)}}}}}return{outMask:f?s:null,dzxs:u,dzys:i,curvatures:c}}function le(t,e,r){for(let n=0;n<r;n++)t[n*e]=t[n*e+1],t[(n+1)*e-1]=t[(n+1)*e-2];for(let n=1;n<e-1;n++)t[n]=t[n+e],t[n+(r-1)*e]=t[n+(r-2)*e]}function kr(t,e){if(!bt(t))return t;let{factor:r,sinZcosA:n,sinZsinA:l,cosZ:s,sinZcosAs:f,sinZsinAs:o,cosZs:a,weights:u}=Ge(e),[i,c]=r,p=e.hillshadeType==="traditional",{width:C,height:g}=t,w=new Uint8Array(C*g),{dzxs:S,dzys:h,outMask:d}=se(t);for(let m=ot;m<g-ot;m++){let y=m*C;for(let v=ot;v<C-ot;v++){let k=y+v;if(!d||d[k]){let b=S[k]*i,x=h[k]*c,T=Math.sqrt(1+b*b+x*x),I=0;if(p){let A=255*(s+l*x-n*b)/T;A<0&&(A=0),I=A}else{let A=o.length;for(let E=0;E<A;E++){let P=255*(a[E]+o[E]*x-f[E]*b)/T;P<0&&(P=0),I+=P*u[E]}}w[k]=255&I}}}return le(w,C,g),new Z({width:C,height:g,pixels:[w],mask:d,pixelType:"u8",validPixelCount:t.validPixelCount,statistics:[{minValue:0,maxValue:255}]})}function xr(t,e,r,n){if(!bt(t)||!bt(e))return;let{min:l,max:s}=n,f=t.pixels[0],{pixels:o,mask:a}=e,u=o[0],i=255.00001/(s-l),c=new Uint8ClampedArray(u.length),p=new Uint8ClampedArray(u.length),C=new Uint8ClampedArray(u.length),g=r.length-1;for(let w=0;w<u.length;w++){if(a&&a[w]===0)continue;let S=Math.floor((u[w]-l)*i),[h,d]=r[S<0?0:S>g?g:S],m=f[w],y=m*d,v=y*(1-Math.abs(h%2-1)),k=m-y;switch(Math.floor(h)){case 0:c[w]=y+k,p[w]=v+k,C[w]=k;break;case 1:c[w]=v+k,p[w]=y+k,C[w]=k;break;case 2:c[w]=k,p[w]=y+k,C[w]=v+k;break;case 3:c[w]=k,p[w]=v+k,C[w]=y+k;break;case 4:c[w]=v+k,p[w]=k,C[w]=y+k;break;case 5:case 6:c[w]=y+k,p[w]=k,C[w]=v+k}}t.pixels=[c,p,C],t.updateStatistics()}function Rn(t,e){if(!bt(t))return t;let r=e.zFactor,n=e.pixelSizePower??1,l=e.pixelSizeFactor??1,s=e.slopeType,f=e.isGCS,{x:o,y:a}=e.resolution,u=r/(8*o),i=r/(8*a);f&&Math.abs(r-1)<1e-4&&(u/=Bt,i/=Bt),s==="adjusted"&&(u=(r+o**n*l)/(8*o),i=(r+a**n*l)/(8*a));let{dzxs:c,dzys:p,outMask:C}=se(t),{width:g,height:w}=t,S=new Float32Array(g*w);for(let d=ot;d<w-ot;d++){let m=d*g;for(let y=ot;y<g-ot;y++){let v=m+y;if(!C||C[v]){let k=c[v]*u,b=p[v]*i,x=Math.sqrt(k*k+b*b);S[m+y]=s==="percent-rise"?100*x:57.2957795*Math.atan(x)}}}le(S,g,w);let h=new Z({width:g,height:w,pixels:[S],mask:C,pixelType:"f32",validPixelCount:t.validPixelCount});return h.updateStatistics(),h}function Ln(t,e={}){if(!bt(t))return t;let{resolution:r}=e,n=r?1/r.x:1,l=r?1/r.y:1,{dzxs:s,dzys:f,outMask:o}=se(t),{width:a,height:u}=t,i=new Float32Array(a*u);for(let c=ot;c<u-ot;c++){let p=c*a;for(let C=ot;C<a-ot;C++){let g=p+C;if(!o||o[g]){let w=s[g]*n,S=f[g]*l,h=-1;w===0&&S===0||(h=90-57.29578*Math.atan2(S,-w),h<0&&(h+=360),h===360?h=0:h>360&&(h%=360)),i[p+C]=h}}}return le(i,a,u),new Z({width:a,height:u,pixels:[i],mask:o,pixelType:"f32",validPixelCount:t.validPixelCount,statistics:[{minValue:-1,maxValue:360}]})}function Mn(t,e){if(!bt(t))return t;let{curvatures:r,outMask:n}=se(t,e),{width:l,height:s}=t;le(r,l,s);let f=new Z({width:l,height:s,pixels:[r],mask:n,pixelType:"f32",validPixelCount:t.validPixelCount});return f.updateStatistics(),f}var Bn=["random","ndvi","ndvi2","ndvi3","elevation","gray","hillshade"],Rr=[{id:"aspect",type:"multipart",colorRamps:[{fromColor:[190,190,190],toColor:[255,45,8]},{fromColor:[255,45,8],toColor:[255,181,61]},{fromColor:[255,181,61],toColor:[255,254,52]},{fromColor:[255,254,52],toColor:[0,251,50]},{fromColor:[0,251,50],toColor:[255,254,52]},{fromColor:[0,253,255],toColor:[0,181,255]},{fromColor:[0,181,255],toColor:[26,35,253]},{fromColor:[26,35,253],toColor:[255,57,251]},{fromColor:[255,57,251],toColor:[255,45,8]}]},{id:"black-to-white",fromColor:[0,0,0],toColor:[255,255,255]},{id:"blue-bright",fromColor:[204,204,255],toColor:[0,0,224]},{id:"blue-light-to-dark",fromColor:[211,229,232],toColor:[46,100,140]},{id:"blue-green-bright",fromColor:[203,245,234],toColor:[48,207,146]},{id:"blue-green-light-to-dark",fromColor:[216,242,237],toColor:[21,79,74]},{id:"brown-light-to-dark",fromColor:[240,236,170],toColor:[102,72,48]},{id:"brown-to-blue-green-diverging-right",type:"multipart",colorRamps:[{fromColor:[156,85,31],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[33,130,145]}]},{id:"brown-to-blue-green-diverging-dark",type:"multipart",colorRamps:[{fromColor:[110,70,45],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[48,100,102]}]},{id:"coefficient-bias",fromColor:[214,214,255],toColor:[0,57,148]},{id:"cold-to-hot-diverging",type:"multipart",colorRamps:[{fromColor:[69,117,181],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[214,47,39]}]},{id:"condition-number",type:"multipart",colorRamps:[{fromColor:[0,97,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,34,0]}]},{id:"cyan-to-purple",type:"multipart",colorRamps:[{fromColor:[0,245,245],toColor:[0,0,245]},{fromColor:[0,0,245],toColor:[245,0,245]}]},{id:"cyan-light-to-blue-dark",type:"multipart",colorRamps:[{fromColor:[182,237,240],toColor:[31,131,224]},{fromColor:[31,131,224],toColor:[9,9,145]}]},{id:"distance",fromColor:[255,200,0],toColor:[0,0,255]},{id:"elevation1",type:"multipart",colorRamps:[{fromColor:[175,240,233],toColor:[255,255,179]},{fromColor:[255,255,179],toColor:[0,128,64]},{fromColor:[0,128,64],toColor:[252,186,3]},{fromColor:[252,186,3],toColor:[128,0,0]},{fromColor:[120,0,0],toColor:[105,48,13]},{fromColor:[105,48,13],toColor:[171,171,171]},{fromColor:[171,171,171],toColor:[255,252,255]}]},{id:"elevation2",type:"multipart",colorRamps:[{fromColor:[118,219,211],toColor:[255,255,199]},{fromColor:[255,255,199],toColor:[255,255,128]},{fromColor:[255,255,128],toColor:[217,194,121]},{fromColor:[217,194,121],toColor:[135,96,38]},{fromColor:[135,96,38],toColor:[150,150,181]},{fromColor:[150,150,181],toColor:[181,150,181]},{fromColor:[181,150,181],toColor:[255,252,255]}]},{id:"errors",fromColor:[255,235,214],toColor:[196,10,10]},{id:"gray-light-to-dark",fromColor:[219,219,219],toColor:[69,69,69]},{id:"green-bright",fromColor:[204,255,204],toColor:[14,204,14]},{id:"green-light-to-dark",fromColor:[220,245,233],toColor:[34,102,51]},{id:"green-to-blue",type:"multipart",colorRamps:[{fromColor:[32,204,16],toColor:[0,242,242]},{fromColor:[0,242,242],toColor:[2,33,227]}]},{id:"orange-bright",fromColor:[255,235,204],toColor:[240,118,5]},{id:"orange-light-to-dark",fromColor:[250,233,212],toColor:[171,65,36]},{id:"partial-spectrum",type:"multipart",colorRamps:[{fromColor:[242,241,162],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]},{fromColor:[252,3,69],toColor:[176,7,237]},{fromColor:[176,7,237],toColor:[2,29,173]}]},{id:"partial-spectrum-1-diverging",type:"multipart",colorRamps:[{fromColor:[135,38,38],toColor:[240,149,12]},{fromColor:[240,149,12],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[74,80,181]},{fromColor:[74,80,181],toColor:[39,32,122]}]},{id:"partial-spectrum-2-diverging",type:"multipart",colorRamps:[{fromColor:[115,77,42],toColor:[201,137,52]},{fromColor:[201,137,52],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[91,63,176]},{fromColor:[91,63,176],toColor:[81,13,97]}]},{id:"pink-to-yellow-green-diverging-bright",type:"multipart",colorRamps:[{fromColor:[158,30,113],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[99,110,45]}]},{id:"pink-to-yellow-green-diverging-dark",type:"multipart",colorRamps:[{fromColor:[97,47,73],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[22,59,15]}]},{id:"precipitation",type:"multipart",colorRamps:[{fromColor:[194,82,60],toColor:[237,161,19]},{fromColor:[237,161,19],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,219,0]},{fromColor:[0,219,0],toColor:[32,153,143]},{fromColor:[32,153,143],toColor:[11,44,122]}]},{id:"prediction",type:"multipart",colorRamps:[{fromColor:[40,146,199],toColor:[250,250,100]},{fromColor:[250,250,100],toColor:[232,16,20]}]},{id:"purple-bright",fromColor:[255,204,255],toColor:[199,0,199]},{id:"purple-to-green-diverging-bright",type:"multipart",colorRamps:[{fromColor:[77,32,150],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[20,122,11]}]},{id:"purple-to-green-diverging-dark",type:"multipart",colorRamps:[{fromColor:[67,14,89],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[24,79,15]}]},{id:"purple-blue-bright",fromColor:[223,184,230],toColor:[112,12,242]},{id:"purple-blue-light-to-dark",fromColor:[229,213,242],toColor:[93,44,112]},{id:"purple-red-bright",fromColor:[255,204,225],toColor:[199,0,99]},{id:"purple-red-light-to-dark",fromColor:[250,215,246],toColor:[143,17,57]},{id:"red-bright",fromColor:[255,204,204],toColor:[219,0,0]},{id:"red-light-to-dark",fromColor:[255,224,224],toColor:[143,10,10]},{id:"red-to-blue-diverging-bright",type:"multipart",colorRamps:[{fromColor:[196,69,57],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[48,95,207]}]},{id:"red-to-blue-diverging-dark",type:"multipart",colorRamps:[{fromColor:[107,13,13],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[13,53,97]}]},{id:"red-to-green",type:"multipart",colorRamps:[{fromColor:[245,0,0],toColor:[245,245,0]},{fromColor:[245,245,0],toColor:[0,245,0]}]},{id:"red-to-green-diverging-bright",type:"multipart",colorRamps:[{fromColor:[186,20,20],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[54,145,33]}]},{id:"red-to-green-diverging-dark",type:"multipart",colorRamps:[{fromColor:[97,21,13],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[16,69,16]}]},{id:"slope",type:"multipart",colorRamps:[{fromColor:[56,168,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]}]},{id:"spectrum-full-bright",type:"multipart",colorRamps:[{fromColor:[255,0,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,0,255]}]},{id:"spectrum-full-dark",type:"multipart",colorRamps:[{fromColor:[153,0,0],toColor:[153,153,0]},{fromColor:[153,153,0],toColor:[0,153,153]},{fromColor:[0,153,153],toColor:[0,0,153]}]},{id:"spectrum-full-light",type:"multipart",colorRamps:[{fromColor:[255,153,153],toColor:[255,255,153]},{fromColor:[255,255,153],toColor:[153,255,255]},{fromColor:[153,255,255],toColor:[153,153,255]}]},{id:"surface",type:"multipart",colorRamps:[{fromColor:[112,153,89],toColor:[242,238,162]},{fromColor:[242,238,162],toColor:[242,206,133]},{fromColor:[242,206,133],toColor:[194,140,124]},{fromColor:[194,140,124],toColor:[255,242,255]}]},{id:"temperature",type:"multipart",colorRamps:[{fromColor:[255,252,255],toColor:[255,0,255]},{fromColor:[255,0,255],toColor:[0,0,255]},{fromColor:[0,0,255],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,255,0]},{fromColor:[0,255,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,128,0]},{fromColor:[255,128,0],toColor:[128,0,0]}]},{id:"white-to-black",fromColor:[255,255,255],toColor:[0,0,0]},{id:"yellow-to-dark-red",type:"multipart",colorRamps:[{fromColor:[255,255,128],toColor:[242,167,46]},{fromColor:[242,167,46],toColor:[107,0,0]}]},{id:"yellow-to-green-to-dark-blue",type:"multipart",colorRamps:[{fromColor:[255,255,128],toColor:[56,224,9]},{fromColor:[56,224,9],toColor:[26,147,171]},{fromColor:[26,147,171],toColor:[12,16,120]}]},{id:"yellow-to-red",fromColor:[245,245,0],toColor:[255,0,0]},{id:"yellow-green-bright",fromColor:[236,252,204],toColor:[157,204,16]},{id:"yellow-green-light-to-dark",fromColor:[215,240,175],toColor:[96,107,45]}],Ao=new Kt({Aspect:"aspect","Black to White":"black-to-white","Blue Bright":"blue-bright","Blue Light to Dark":"blue-light-to-dark","Blue-Green Bright":"blue-green-bright","Blue-Green Light to Dark":"blue-green-light-to-dark","Brown Light to Dark":"brown-light-to-dark","Brown to Blue Green Diverging, Bright":"brown-to-blue-green-diverging-right","Brown to Blue Green Diverging, Dark":"brown-to-blue-green-diverging-dark","Coefficient Bias":"coefficient-bias","Cold to Hot Diverging":"cold-to-hot-diverging","Condition Number":"condition-number","Cyan to Purple":"cyan-to-purple","Cyan-Light to Blue-Dark":"cyan-light-to-blue-dark",Distance:"distance","Elevation #1":"elevation1","Elevation #2":"elevation2",Errors:"errors","Gray Light to Dark":"gray-light-to-dark","Green Bright":"green-bright","Green Light to Dark":"green-light-to-dark","Green to Blue":"green-to-blue","Orange Bright":"orange-bright","Orange Light to Dark":"orange-light-to-dark","Partial Spectrum":"partial-spectrum","Partial Spectrum 1 Diverging":"partial-spectrum-1-diverging","Partial Spectrum 2 Diverging":"partial-spectrum-2-diverging","Pink to YellowGreen Diverging, Bright":"pink-to-yellow-green-diverging-bright","Pink to YellowGreen Diverging, Dark":"pink-to-yellow-green-diverging-dark",Precipitation:"precipitation",Prediction:"prediction","Purple Bright":"purple-bright","Purple to Green Diverging, Bright":"purple-to-green-diverging-bright","Purple to Green Diverging, Dark":"purple-to-green-diverging-dark","Purple-Blue Bright":"purple-blue-bright","Purple-Blue Light to Dark":"purple-blue-light-to-dark","Purple-Red Bright":"purple-red-bright","Purple-Red Light to Dark":"purple-red-light-to-dark","Red Bright":"red-bright","Red Light to Dark":"red-light-to-dark","Red to Blue Diverging, Bright":"red-to-blue-diverging-bright","Red to Blue Diverging, Dark":"red-to-blue-diverging-dark","Red to Green":"red-to-green","Red to Green Diverging, Bright":"red-to-green-diverging-bright","Red to Green Diverging, Dark":"red-to-green-diverging-dark",Slope:"slope","Spectrum-Full Bright":"spectrum-full-bright","Spectrum-Full Dark":"spectrum-full-dark","Spectrum-Full Light":"spectrum-full-light",Surface:"surface",Temperature:"temperature","White to Black":"white-to-black","Yellow to Dark Red":"yellow-to-dark-red","Yellow to Green to Dark Blue":"yellow-to-green-to-dark-blue","Yellow to Red":"yellow-to-red","Yellow-Green Bright":"yellow-green-bright","Yellow-Green Light to Dark":"yellow-green-light-to-dark"});function ue(t,e){if(!t||!e||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]>e[r]+2||t[r]<e[r]-2)return!1;return!0}function Ir(t){let e=t.clone();return e.fromColor=t.toColor,e.toColor=t.fromColor,e.algorithm=t.algorithm,e}function Eo(t){if(t.type==="multipart"){let e=t.clone();return e.colorRamps?.length&&(e.colorRamps=e.colorRamps.reverse().map(r=>Ir(r))),e}return Ir(t)}function Ar(t,e){if(!t)return;let r=e??Rr,n=null;return t.type==="algorithmic"?r.some(l=>{if(ue(t.fromColor.toRgb(),l.fromColor)&&ue(t.toColor.toRgb(),l.toColor))return n=l.id,!0}):t.type==="multipart"&&r.some(l=>{let s=t.colorRamps,f=l.colorRamps;if(s&&f&&s.length===f.length&&!f.some((o,a)=>{if(!ue(s[a].fromColor.toRgb(),new he(o.fromColor).toRgb())||!ue(s[a].toColor.toRgb(),new he(o.toColor).toRgb()))return!0})){if(n)return!0;n=l.id}}),n}function Po(t,e,r=!1){if(!t)return;let n=!1,l=Ar(t,e);return l!=null||r||(n=!0,l=Ar(t=Eo(t),e)),l?{id:l,inverted:n}:void 0}function Ro(t,e=!1){let r=typeof t=="string"?t:Po(t,void 0,e)?.id;return r?Ao.toJSON(r):null}function Fn(t,e="esriCIELabAlgorithm"){let r=Rr.find(({id:n})=>n===t);return r?r.colorRamps?{type:"multipart",colorRamps:r.colorRamps.map(n=>({type:"algorithmic",algorithm:e,fromColor:[...n.fromColor],toColor:[...n.toColor]}))}:{type:"algorithmic",algorithm:e,fromColor:[...r.fromColor],toColor:[...r.toColor]}:null}function Lr(t){let e=(t=t||{}).numColors||256,r=t.distanceOffset||0,n=t.isCustomInterval!=null?t.isCustomInterval:t.distanceInterval!==null&&t.distanceInterval!==1/(e-1),l=t.distanceInterval||1/(e-1);return Q(X({},t),{numColors:e,distanceOffset:r,interpolateAlpha:!!t.interpolateAlpha,distanceInterval:l,isCustomInterval:n,weights:t.weights})}function Lo(t,e,r){let{numColors:n,distanceOffset:l,distanceInterval:s,isCustomInterval:f}=r,o=t.s===0,a=e.s===0,u=t.h,i=e.h;o&&!a?u=i:a&&!o&&(e=Q(X({},e),{h:u}),i=u);let c,p=Math.abs(i-u),C=360;p<C/2?c=(i-u)*s:(p=C-p,c=u>i?p*s:-p*s);let g=(e.s-t.s)*s,w=(e.v-t.v)*s,{s:S,v:h}=t,d=u;if(l){let y=l/s;d=(d+y*c+C)%C,S+=y*g,h+=y*w}let m=[];for(let y=0;y<n-1;y++)m.push({h:d,s:S,v:h}),d=(d+c+C)%C,S+=g,h+=w;return m.push(f?{h:d,s:S,v:h}:e),m}function Mo(t,e,r){let{numColors:n,distanceOffset:l,distanceInterval:s,isCustomInterval:f}=r,{l:o,a,b:u}=t,i=(e.l-o)*s,c=(e.a-a)*s,p=(e.b-u)*s,C=[];if(l){let g=l/s;o+=g*i,a+=g*c,u+=g*p}for(let g=0;g<n-1;g++)C.push({l:o,a,b:u}),o+=i,a+=c,u+=p;return C.push(f?{l:o,a,b:u}:e),C}function Oo(t,e,r){let{numColors:n,distanceOffset:l,distanceInterval:s,isCustomInterval:f}=r,o=t.h,a=e.h,u=2*Math.PI,i;if(o<=a){let d=a-o,m=a-o-u;i=Math.abs(m)<Math.abs(d)?m:d}else{let d=a+u-o,m=a-o;i=Math.abs(m)<Math.abs(d)?m:d}let c=i*s,p=(e.l-t.l)*s,C=(e.c-t.c)*s,{l:g,c:w,h:S}=t;if(l){let d=l/s;g+=d*p,w+=d*C,S=(S+d*c+u)%u}let h=[];for(let d=0;d<n-1;d++)h.push({l:g,c:w,h:S}),g+=p,w+=C,S=(S+c+u)%u;return h.push(f?{l:g,c:w,h:S}:e),h}function Mr(t,e){let{fromColor:r,toColor:n}=t;r=[...r],n=[...n],r.length===3&&(r=r.concat([255])),n.length===3&&(n=n.concat([255]));let l=t.algorithm||"esriCIELabAlgorithm",s=Lr(e),{numColors:f,distanceOffset:o,isCustomInterval:a,interpolateAlpha:u}=s;if(f===1&&o===0)return[r];if(f===2&&o===0&&!a)return[r,n];let i={r:r[0],g:r[1],b:r[2]},c={r:n[0],g:n[1],b:n[2]},p=l==="esriCIELabAlgorithm"?Mo(pe(i),pe(c),s):l==="esriHSVAlgorithm"?Lo(Ot(i),Ot(c),s):Oo(de(i),de(c),s),C=[],g=r[3]??255,w=((n[3]??255)-g)/(f-1);for(let S=0;S<f;S++){let{r:h,g:d,b:m}=Je(p[S]),y=u?Math.round(g+w*S):255;C.push([h,d,m,y])}return C}function Do(t,e){let{numColors:r,interpolateAlpha:n}=Lr(e),l=e?.weights,{colorRamps:s}=t;if(l){let c=l.reduce((p,C)=>p+C);l=l.map(p=>p/c)}else{l=[];for(let c=0;c<s.length;c++)l[c]=1/s.length}let f=[],o=1/(r-1),a=0,u=!1;for(let c=0;c<s.length;c++){let p=f.length,C=u?0:p*o-a;a+=l[c];let g=c===s.length-1?r-1-p:(l[c]-C)/o;if(u=Math.ceil(g)===g,g=Math.ceil(g),g===0)continue;let w=Mr(s[c],{numColors:g,interpolateAlpha:n,distanceOffset:C/l[c],distanceInterval:o/l[c]});f.push(...w)}let i=[...s[s.length-1].toColor];return i.length===3&&i.push(255),f.push(i),f}function Uo(t,e){let r=Ve(t)?t.toJSON():t;return r.type==="multipart"?Do(r,e):Mr(r,e)}function Ne(t,e){let r=Uo(t,e),n=e?.interpolateAlpha;return r.forEach((l,s)=>{l.unshift(s),n||l.pop()}),r}function Er(t){let e=Ot(t);return{type:"HsvColor",Hue:e.h,Saturation:e.s,Value:e.v,AlphaValue:255}}function Pr(t){return{Algorithm:t.toJSON()?.Algorithm||"esriHSVAlgorithm",type:"AlgorithmicColorRamp",FromColor:Er(t.fromColor),ToColor:Er(t.toColor)}}function Vn(t){let e=Ro(t);if(!e)return null;if(t.type==="algorithmic")return Q(X({},Pr(t)),{Name:e});if(t.colorRamps){let r=t.colorRamps.map(Pr);return{type:"MultiPartColorRamp",NumColorRamps:r.length,ArrayOfColorRamp:r,Name:e}}return null}function _n(t){let e=t.reverse().map(r=>{let n=r.toString(16);return n.length<2?"0"+n:n});return 4294967295&Number.parseInt(e.join(""),16)}function Go(t){return["u8","s8"].includes(t.pixelType)&&t.statistics?.[0]?.min!=null&&t.statistics[0]?.max!=null&&t.bandCount===1}function Or(t,e){let{attributeTable:r,bandCount:n}=t;return r==null&&Go(t)?!0:!(r==null||n>1||e&&r.fields.find(l=>l.name.toLowerCase()===e.toLowerCase())==null)}function Dr(t){let{bandCount:e,dataType:r,pixelType:n}=t;return r==="elevation"||r==="generic"&&e===1&&(n==="s16"||n==="s32"||n==="f32"||n==="f64")}function Ur(t,e=!1){let{bandCount:r,colormap:n,pixelType:l}=t;return r===1&&(!!n?.length||!e&&l==="u8")}function Hn(t,e=!1){let{attributeTable:r,bandCount:n}=t;return n===1&&(!e||r!=null||t.histograms!=null)}function Wn(t){let{dataType:e}=t;return e==="vector-uv"||e==="vector-magdir"}function Jn(t){let{dataType:e}=t;return e==="vector-uv"||e==="vector-magdir"}var Pt=class extends gt{constructor(t){super(t)}bind(){let{rendererJSON:t}=this;if(!t)return{success:!1};let e;switch(this.lookup={rendererJSON:{}},t.type){case"uniqueValue":e=this._updateUVRenderer(t);break;case"rasterColormap":e=this._updateColormapRenderer(t);break;case"rasterStretch":e=this._updateStretchRenderer(t);break;case"classBreaks":e=this._updateClassBreaksRenderer(t);break;case"rasterShadedRelief":e=this._updateShadedReliefRenderer(t);break;case"vectorField":e=this._updateVectorFieldRenderer();break;case"flowRenderer":e=this._updateFlowRenderer()}return e}symbolize(t){let e=t?.pixelBlock;if(!Gr(e))return e;if(t.simpleStretchParams&&this.rendererJSON.type==="rasterStretch")return this.simpleStretch(e,t.simpleStretchParams);try{let r;switch(e.pixels.length>3&&(e=e.extractBands(t.bandIds??[0,1,2])),this.rendererJSON.type){case"uniqueValue":case"rasterColormap":r=this._symbolizeColormap(e);break;case"classBreaks":r=this._symbolizeClassBreaks(e);break;case"rasterStretch":r=this._symbolizeStretch(e,t.bandIds);break;case"rasterShadedRelief":{let n=t.extent,l=n.spatialReference.isGeographic,s={x:(n.xmax-n.xmin)/e.width,y:(n.ymax-n.ymin)/e.height};r=this._symbolizeShadedRelief(e,{isGCS:l,resolution:s});break}}return r}catch(r){return ce.getLogger(this).error("symbolize",r.message),e}}simpleStretch(t,e){if(!Gr(t))return t;try{return t.pixels.length>3&&(t=t.extractBands([0,1,2])),ae(t,Q(X({},e),{isRenderer:!0}))}catch(r){return ce.getLogger(this).error("symbolize",r.message),t}}generateWebGLParameters(t){if(["uniqueValue","rasterColormap","classBreaks"].includes(this.rendererJSON.type)){let{indexedColormap:f,offset:o}=this.lookup.colormapLut||{};return{colormap:f,colormapOffset:o,type:"lut"}}let{pixelBlock:e,isGCS:r,resolution:n,bandIds:l}=t,{rendererJSON:s}=this;return s.type==="rasterStretch"?this._generateStretchWebGLParams(e,s,l):s.type==="rasterShadedRelief"?this._generateShadedReliefWebGLParams(s,r,n??void 0):s.type==="vectorField"?this._generateVectorFieldWebGLParams(s):null}_isLUTChanged(t){if(!this.lookup||!this.lookup.rendererJSON)return!0;if("colorRamp"in this.rendererJSON){let e=this.rendererJSON.colorRamp;return t?JSON.stringify(e)!==JSON.stringify(this.lookup.rendererJSON.colorRamp):(this.rendererJSON,this.lookup.rendererJSON,JSON.stringify(this.rendererJSON)!==JSON.stringify(this.lookup.rendererJSON))}return JSON.stringify(this.rendererJSON)!==JSON.stringify(this.lookup.rendererJSON)}_symbolizeColormap(t){return this._isLUTChanged()&&!this.bind().success?t:Yt(t,this.lookup.colormapLut)}_symbolizeClassBreaks(t){let{canUseIndexedLUT:e}=this._analyzeClassBreaks(this.rendererJSON);return this._isLUTChanged()&&!this.bind().success?t:e?Yt(t,this.lookup.colormapLut):qe(t,this.lookup.remapLut??[])}_symbolizeStretch(t,e){let{rasterInfo:r}=this,{pixelType:n,bandCount:l}=r,s=this.rendererJSON,f=["u8","u16","s8","s16"].includes(n),o,a,{dra:u}=s,{gamma:i}=this.lookup;if(s.stretchType==="histogramEqualization"){let c=u?null:this.lookup?.histogramLut,p=Nt(s,{rasterInfo:r,pixelBlock:t,bandIds:e,returnHistogramLut:!c}),C=ae(t,Q(X({},p),{gamma:i,isRenderer:!0}));a=me(C,{lut:u?p.histogramLut:c,offset:0})}else if(f){if(u){let c=Nt(s,{rasterInfo:r,pixelBlock:t,bandIds:e});o=Re(Q(X({pixelType:n},c),{gamma:i,rounding:"floor"}))}else if(this._isLUTChanged()){if(!this.bind().success)return t;o=this.lookup?this.lookup.stretchLut:null}else o=this.lookup?this.lookup.stretchLut:null;if(!o)return t;l>1&&e!=null&&e.length===t?.pixels.length&&o?.lut.length===l&&(o={lut:e.map(c=>o.lut[c]),offset:o.offset}),a=me(t,o)}else{let c=Nt(s,{rasterInfo:r,pixelBlock:t,bandIds:e});a=ae(t,Q(X({},c),{gamma:i,isRenderer:!0}))}if(s.colorRamp){if(this._isLUTChanged(!0)&&!this.bind().success)return t;a=Yt(a,this.lookup?.colormapLut)}return a}_symbolizeShadedRelief(t,e){let r=this.rendererJSON,n=X(X({},r),e),l=kr(t,n);if(!r.colorRamp)return l;let s;if(this._isLUTChanged(!0)){if(!this.bind().success)return l;s=this.lookup?this.lookup.hsvMap:null}else s=this.lookup?this.lookup.hsvMap:null;if(!s)return l;let f=this.rasterInfo.statistics?.[0]??{min:0,max:8e3};return xr(l,t,s,f),l}_isVectorFieldData(){let{bandCount:t,dataType:e}=this.rasterInfo;return t===2&&(e==="vector-magdir"||e==="vector-uv")}_updateVectorFieldRenderer(){return this._isVectorFieldData()?{success:!0}:{success:!1,error:`Unsupported data type "${this.rasterInfo.dataType}"; VectorFieldRenderer only supports "vector-magdir" and "vector-uv".`}}_updateFlowRenderer(){return this._isVectorFieldData()?{success:!0}:{success:!1,error:`Unsupported data type "${this.rasterInfo.dataType}"; FlowRenderer only supports "vector-magdir" and "vector-uv".`}}_updateUVRenderer(t){let{bandCount:e,attributeTable:r,pixelType:n}=this.rasterInfo,l=t.field1;if(!l)return{success:!1,error:"Unsupported renderer; missing UniqueValueRenderer.field."};let s=t.defaultSymbol,f=e===1&&["u8","s8"].includes(n);if(!Or(this.rasterInfo,l)&&!f)return{success:!1,error:"Unsupported data; UniqueValueRenderer is only supported on single band data with a valid raster attribute table."};let o=[];if(r!=null){let u=r.fields.find(i=>i.name.toLowerCase()==="value");if(!u)return{success:!1,error:"Unsupported data; the data's raster attribute table does not have a value field."};r.features.forEach(i=>{let c=t.uniqueValueInfos?.find(C=>String(C.value)===String(i.attributes[l])),p=c?.symbol?.color;p?o.push([i.attributes[u.name]].concat(p)):s&&o.push([i.attributes[u.name]].concat(s.color))})}else{if(l.toLowerCase()!=="value")return{success:!1,error:'Unsupported renderer; UniqueValueRenderer.field must be "Value" when raster attribute table is not availalbe.'};t.uniqueValueInfos?.forEach(u=>{let i=u?.symbol?.color;i?o.push([parseInt(""+u.value,10)].concat(i)):s&&o.push([parseInt(""+u.value,10)].concat(s?.color))})}if(o.length===0)return{success:!1,error:"Invalid UniqueValueRenderer. Cannot find matching records in the raster attribute table."};let a=Dt({colormap:o});return this.lookup={rendererJSON:t,colormapLut:a},this.canRenderInWebGL=this._isColormapSupportedByWebGL(a?.indexedColormap),{success:!0}}_updateColormapRenderer(t){if(!Ur(this.rasterInfo))return{success:!1,error:"Unsupported data; the data source does not have a colormap."};let e=t.colormapInfos.map(n=>[n.value].concat(n.color)).sort((n,l)=>n[0]-l[0]);if(!e||e.length===0)return{success:!1,error:"Unsupported renderer; ColormapRenderer must have meaningful colormapInfos."};let r=Dt({colormap:e});return this.lookup={rendererJSON:t,colormapLut:r},this.canRenderInWebGL=this._isColormapSupportedByWebGL(r?.indexedColormap),{success:!0}}_updateShadedReliefRenderer(t){if(!Dr(this.rasterInfo))return{success:!1,error:`Unsupported data type "${this.rasterInfo.dataType}"; ShadedReliefRenderer only supports "elevation", or single band float/s16 data.`};if(t.colorRamp){let e=Ne(t.colorRamp,{interpolateAlpha:!0}),r=Dt({colormap:e}),n=[],l=r.indexedColormap;for(let s=0;s<l.length;s+=4){let f=Ot({r:l[s],g:l[s+1],b:l[s+2]});n.push([f.h/60,f.s/100,255*f.v/100])}this.lookup={rendererJSON:t,colormapLut:r,hsvMap:n}}else this.lookup=null;return this.canRenderInWebGL=!0,{success:!0}}_analyzeClassBreaks(t){let{attributeTable:e,pixelType:r}=this.rasterInfo,n=e!=null?e.fields.find(f=>f.name.toLowerCase()==="value"):null,l=e!=null?e.fields.find(f=>f.name.toLowerCase()===t.field.toLowerCase()):null,s=n!=null&&l!==null;return{canUseIndexedLUT:["u8","u16","s8","s16"].includes(r)||s,tableValueField:n,tableBreakField:l}}_updateClassBreaksRenderer(t){let{attributeTable:e}=this.rasterInfo,{canUseIndexedLUT:r,tableValueField:n,tableBreakField:l}=this._analyzeClassBreaks(t),s=t.classBreakInfos;if(!s?.length)return{success:!1,error:"Unsupported renderer; missing or invalid ClassBreaksRenderer.classBreakInfos."};let f=s.sort((c,p)=>c.classMaxValue-p.classMaxValue),o=f[f.length-1],a=t.minValue;if(!r){let c=[];for(let p=0;p<f.length;p++)c.push({value:f[p].classMinValue??a,mappedColor:f[p].symbol.color}),a=f[p].classMaxValue;return c.push({value:o.classMaxValue,mappedColor:o.symbol.color}),this.lookup={rendererJSON:t,remapLut:c},this.canRenderInWebGL=!1,{success:!0}}let u=[];if(e!=null&&n!=null&&l!==null&&n!==l){let c=n.name,p=l.name,C=f[f.length-1],{classMaxValue:g}=C;a=t.minValue;for(let w of e.features){let S=w.attributes[c],h=w.attributes[p],d=h===g?C:h<a?null:f.find(({classMaxValue:m})=>m>h);d&&u.push([S].concat(d.symbol.color))}}else{a=Math.floor(t.minValue);for(let c=0;c<f.length;c++){let p=f[c];for(let C=a;C<p.classMaxValue;C++)u.push([C].concat(p.symbol.color));a=Math.ceil(p.classMaxValue)}o.classMaxValue===a&&u.push([o.classMaxValue].concat(o.symbol.color))}let i=Dt({colormap:u,fillUnspecified:!1});return this.lookup={rendererJSON:t,colormapLut:i},this.canRenderInWebGL=this._isColormapSupportedByWebGL(i?.indexedColormap),{success:!0}}_isColormapSupportedByWebGL(t){return!!t?.length&&t.length<=16384}_isHistogramRequired(t){return t==="percentClip"||t==="histogramEqualization"}_isValidRasterStatistics(t){return t!=null&&t.length>0&&t[0].min!=null&&t[0].max!=null}_updateStretchRenderer(t){let{stretchType:e,dra:r}=t;if(!(e==="none"||t.statistics?.length||this._isValidRasterStatistics(this.rasterInfo.statistics)||r))return{success:!1,error:"Unsupported renderer; StretchRenderer.statistics is required when dynamic range adjustment is not used."};let n=t.histograms||this.rasterInfo.histograms;!this._isHistogramRequired(t.stretchType)||n?.length||r||(e="minMax");let{computeGamma:l,useGamma:s,colorRamp:f}=t,{gamma:o}=t;if(s&&l&&!o?.length){let i=t.statistics?.length?t.statistics:this.rasterInfo.statistics;o=br(this.rasterInfo.pixelType,i)}let a=this.rasterInfo.pixelType,u=!r&&["u8","u16","s8","s16"].includes(a);if(e==="histogramEqualization"){let i=n.map(c=>Pe(c));this.lookup={rendererJSON:t,histogramLut:i}}else if(u){let i=Nt(t,{rasterInfo:this.rasterInfo}),c=Re(Q(X({pixelType:a},i),{gamma:s?o:null,rounding:"floor"}));this.lookup={rendererJSON:t,stretchLut:c}}if(f&&!this._isStretchColorRampNoop(f)){let i=Ne(f,{interpolateAlpha:!0});this.lookup||(this.lookup={rendererJSON:t}),this.lookup.colormapLut=Dt({colormap:i}),this.lookup.rendererJSON=t}return this.lookup.gamma=s&&o?.length?o:null,this.canRenderInWebGL=!0,{success:!0}}_isStretchColorRampNoop(t){return t.type==="algorithmic"&&["0,0,0,255","0,0,0"].includes(t.fromColor.join(","))&&["255,255,255,255","255,255,255"].includes(t.toColor.join(","))}_generateStretchWebGLParams(t,e,r){let n=null,l=null,s=this.lookup?.colormapLut;e.colorRamp&&s&&(n=s.indexedColormap,l=s.offset),e.stretchType==="histogramEqualization"&&(e=Q(X({},e),{stretchType:"minMax"}));let{gamma:f}=this.lookup,o=!!(e.useGamma&&f&&f.some(m=>m!==1)),{minCutOff:a,maxCutOff:u,outMin:i,outMax:c}=Nt(e,{rasterInfo:this.rasterInfo,pixelBlock:t,bandIds:r}),p=0;t!=null&&(p=t.getPlaneCount(),p===2&&((t=t.clone()).statistics=[t.statistics[0]],t.pixels=[t.pixels[0]]));let{bandCount:C}=this.rasterInfo,g=Math.min(3,r?.length||p||C,C),w=new Float32Array(g),S=n||o?1:255,h;for(h=0;h<a.length;h++)w[h]=u[h]===a[h]?0:(c-i)/(u[h]-a[h])/S;let d=new Float32Array(g);if(o&&f)for(h=0;h<g;h++)f[h]>1?f[h]>2?d[h]=6.5+(f[h]-2)**2.5:d[h]=6.5+100*(2-f[h])**4:d[h]=1;return{bandCount:g,outMin:i/S,outMax:c/S,minCutOff:a,maxCutOff:u,factor:w,useGamma:o,gamma:o?f:[1,1,1],gammaCorrection:o?d:[1,1,1],colormap:n,colormapOffset:l,stretchType:e.stretchType,type:"stretch"}}_generateShadedReliefWebGLParams(t,e=!1,r={x:0,y:0}){let n=null,l=null,s=this.lookup?.colormapLut;t.colorRamp&&s&&(n=s.indexedColormap,l=s.offset);let f=Q(X({},t),{isGCS:e,resolution:r}),o=Ge(f),a=this.rasterInfo.statistics?.[0];return Q(X({},o),{minValue:a?.min??0,maxValue:a?.max??8e3,hillshadeType:t.hillshadeType==="traditional"?0:1,type:"hillshade",colormap:n,colormapOffset:l})}_generateVectorFieldWebGLParams(t){let{style:e,inputUnit:r,outputUnit:n,visualVariables:l,symbolTileSize:s,flowRepresentation:f}=t,o,a=this.rasterInfo.statistics?.[0].min??0,u=this.rasterInfo.statistics?.[0].max??50,i=l?.find(h=>h.type==="sizeInfo")??{type:"sizeInfo",field:"Magnitude",maxDataValue:u,maxSize:.8*s,minDataValue:a,minSize:.2*s},c=i.minDataValue??a,p=i.maxDataValue??u,C=i.maxSize!=null&&i.minSize!=null?[i.minSize/s,i.maxSize/s]:[.2,.8];if(e==="wind_speed"){let h=(C[0]+C[1])/2;C[0]=C[1]=h}let g=c!=null&&p!=null?[c,p]:null;if(e==="classified_arrow")if(c!=null&&p!=null&&i!=null){o=[];let h=(i.maxDataValue-i.minDataValue)/5;for(let d=0;d<6;d++)o.push(i.minDataValue+h*d)}else o=[0,1e-6,3.5,7,10.5,14];let w=f==="flow_to"==(e==="ocean_current_kn"||e==="ocean_current_m")?0:Math.PI,S=l?.find(h=>h.type==="rotationInfo");return{breakValues:o,dataRange:g,inputUnit:r,outputUnit:n,symbolTileSize:s,symbolPercentRange:C,style:e||"single_arrow",rotation:w,rotationType:this.rasterInfo.storageInfo?.tileInfo&&this.rasterInfo.dataType==="vector-uv"?"geographic":S?.rotationType||t.rotationType,type:"vectorField"}}};function Gr(t){return bt(t)&&t.validPixelCount!==0}D([G({json:{write:!0}})],Pt.prototype,"rendererJSON",void 0),D([G({type:Tr,json:{write:!0}})],Pt.prototype,"rasterInfo",void 0),D([G({json:{write:!0}})],Pt.prototype,"lookup",void 0),D([G()],Pt.prototype,"canRenderInWebGL",void 0),Pt=D([mt("esri.renderers.support.RasterSymbolizer")],Pt);var la=Pt;export{sr as a,It as b,jt as c,to as d,Ie as e,ne as f,fr as g,hr as h,oo as i,io as j,Ti as k,ki as l,Sr as m,Tr as n,Bt as o,Rn as p,Ln as q,Mn as r,Bn as s,Rr as t,Ao as u,Ro as v,Fn as w,Uo as x,Ne as y,Vn as z,_n as A,Ei as B,Cr as C,Re as D,So as E,Di as F,xo as G,Ui as H,Nt as I,wr as J,ae as K,Or as L,Dr as M,Ur as N,Hn as O,Wn as P,Jn as Q,la as R};
