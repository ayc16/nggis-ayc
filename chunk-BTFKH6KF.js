import{a as nt}from"./chunk-I7V2OAI2.js";import{f as L,r as et,t as tt}from"./chunk-RAMEUAPV.js";import{d as re}from"./chunk-5NHMASEK.js";import{e as Ye,f as Je,g as Qe,p as $e,q as oe}from"./chunk-3K3SLH5Z.js";import{a as ee}from"./chunk-AHLE435U.js";import{b as _,c as $,h as ze,i as w}from"./chunk-VORAPKV5.js";import{a as ie}from"./chunk-4OC4J3KU.js";import{b as Ue,d as Be,e as qe,f as je,i as te,j as Ke,k as ne,l as Ne,t as Xe}from"./chunk-CXJNPJ3A.js";import{b as x,h as z,j as Le}from"./chunk-QU6JU243.js";import{h as ke}from"./chunk-7SVLZCA4.js";import{a as Ae}from"./chunk-BWK3LBHF.js";import{b as Fe,d as Ge,f as D}from"./chunk-GAF32LQP.js";import{a as Q,b as We}from"./chunk-WBPLJNRU.js";import{b as Ee,l as He,m as J,o as Ze}from"./chunk-CDCW33GU.js";import{c as De}from"./chunk-E2J2V7JN.js";import{a as V}from"./chunk-4QS7PGAF.js";import{a as M}from"./chunk-NIYDRLW4.js";import{a as Ie}from"./chunk-XHOTVM3O.js";import{d as Ve}from"./chunk-JD3KGBGX.js";import{d as Oe,i as Re}from"./chunk-NYOCZ43I.js";import{a as Y}from"./chunk-IFFYADB3.js";import{a as Me}from"./chunk-47Q3ZDMA.js";import{a as W,b as k}from"./chunk-J7IKN4ZN.js";import{a as S,h as H}from"./chunk-4XUOIGFO.js";import{d as A,e as be}from"./chunk-AM3VOA32.js";import{a as F}from"./chunk-BCREO4Q5.js";import{b as we,d as xe,e as G,l as Se,s as Ce,t as Te,u as Pe,y as X}from"./chunk-OZF6BMOL.js";import{a as g}from"./chunk-GJP6PTKT.js";import{a as E}from"./chunk-GBTN5LIS.js";import{l as v}from"./chunk-SA4OMQAD.js";import{b as Z}from"./chunk-24BLFS5R.js";import{ha as ye,ia as _e}from"./chunk-JDDD6VJ4.js";import{L as u,O as ve}from"./chunk-AUTL5LCV.js";import{S as fe}from"./chunk-KUJG22IX.js";import{a as p}from"./chunk-W3WDPWBE.js";import{t as N}from"./chunk-GISCFF3Z.js";import{b as I,g as ge}from"./chunk-MLSR6YE6.js";import{b as K}from"./chunk-HQMV3KQV.js";import{q as me}from"./chunk-CRMMDK2Z.js";import{a as P,b}from"./chunk-EAH6BNBL.js";var bt=["freehand","hybrid","click"],se="click";var U=class{constructor({consumesClicks:e,grabbableForEvent:n}){this.events=new E,this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0,this.consumesClicks=e,this.grabbableForEvent=n}destroy(){}intersectionDistance(e,n){return 0}attach(){}detach(){}onElevationChange(){}onViewChange(){}};function Lt(t,e,n,i,r,s){let l="geodesic",o=ke(n),a=x();return z(t,e,i,a),a[2]=0,o&&V(a,n,a,o)||(l="euclidean",o=n),{mode:l,view:e,elevationInfo:i,hasZ:r,directionMode:s,spatialReference:t.spatialReference,measurementSR:o,origin:a}}function vt(t,e,n){if(e==null||t==null)return;let i=ye(n.measurementSR);if(i==null)return;let r=R(t,n);if(r==null)return;let s=D(e,i);return new Be(r,s)}function yt(t,e,n,i){if(n==null||t==null)return;let r=R(t,i);if(r==null)return;let s=w(n),l=10,o=h=>{if(h==null)return;let d=x(),y=Ge(h,"degrees","geographic");return ze(d,r,i.measurementSR,l,y,i.mode)?new je(r,d):void 0},a=()=>{if(e!=null&&t!=null)return w($(e,t))};switch(i.directionMode){case _.Absolute:return o(s);case _.Relative:{let h=a();return h==null?void 0:o(h+s)}case _.RelativeBilateral:{let h=a();return h==null?void 0:ne([o(h+s),o(h-s)])}}}function rt(t,e){let n=xt(t,e);return n!=null?new qe(n):void 0}function ot(t,e,n){let{context:i,longitude:r,latitude:s,direction:l,distance:o,elevation:a}=n;if(r!=null||s!=null||o!=null||a!=null||l!=null){if(r!=null||s!=null){let h=w(r),d=w(s),y=ae(a,i);return new te(h,d,y)}return _t(t,e,n)}}function _t(t,e,{context:n,direction:i,distance:r,elevation:s}){if(e==null)return rt(s,n);let{view:l,elevationInfo:o,measurementSR:a}=n,h=z(e,l,o);if(!a||!V(h,e.spatialReference,it,a))return;let[d,y]=it,C=r!=null?D(r,"meters"):void 0,m=w(i),ue=ae(s,n),T=f=>{let de=new Ke([d,y],a,C,ue,f);return C==null||f==null||ue==null&&n.hasZ?de:new Ue(de.closestTo(h))};if(m==null)return T(void 0);let he=()=>{if(t!=null&&e!=null)return w($(t,e))};switch(n.directionMode){case _.Absolute:return T(m);case _.Relative:{let f=he();return f==null?void 0:T(f+m)}case _.RelativeBilateral:{let f=he();return f==null?void 0:ne([T(f+m),T(f-m)])}}}function st(t){return t.context.mode==="geodesic"?ot(null,null,t):lt(t)}function at(t,e,n){let{context:i,x:r,y:s,distance:l,direction:o,elevation:a}=n;return i.mode==="geodesic"?ot(e,t,n):r!=null||s!=null?lt(n):wt([vt(t,l,i),yt(t,e,o,i),rt(a,i)])}function lt({x:t,y:e,elevation:n,context:i}){B.x=t?.value??0,B.y=e?.value??0,B.spatialReference=i.spatialReference;let r=R(B,i,St);return new te(t!=null&&r!=null?r[0]:void 0,e!=null&&r!=null?r[1]:void 0,ae(n,i))}function wt(t){let e;for(let n of t)n&&(e=e?.intersect(n)??n);return e}function R(t,e,n=x()){let{view:i,elevationInfo:r,measurementSR:s,origin:l,mode:o}=e;if(z(t,i,r,n),V(n,t.spatialReference,n,s))return o!=="geodesic"&&G(n,n,l),n}function pt(t,e,n,i){let{view:r,measurementSR:s,spatialReference:l,origin:o,mode:a}=n;if(a==="geodesic"?we(O,t):xe(O,t,o),V(O,s,O,l))return Le(O,r,e,n,i)}function xt(t,e){return ct(t,e)?.value??void 0}function ae(t,e){let n=ct(t,e);return n!=null?D(n,"meters"):void 0}function ct(t,{view:e,origin:n,elevationInfo:i,hasZ:r,measurementSR:s}){if(t==null||!r)return;let l=_e(s);if(l==null)return;let[o,a]=n,h=D(t,l),d=e?.type==="3d"?Ze(e,o,a,h,s,i):h;return d!=null?Fe(d,l):void 0}var it=x(),St=x(),O=x(),B=M(0,0,0,Z.WGS84);var Ct="crosshair",Tt="progress",ut=Symbol(),ht=Symbol(),c=class extends E.EventedMixin(ve){constructor(t){super(t),this._createOperationCompleted=!1,this._hideDefaultCursor=!1,this._pointerDownStates=new Ae,this._stagedScreenPoint=null,this._stagedPointerType=null,this._updatingHandles=new Me,this._stagedPointerId=null,this.constraintsEnabled=!1,this.constraints=void 0,this._getPointConstraint=ie(st),this._getPolylineOrPolygonConstraint=ie(at),this.constraintZ=null,this.defaultZ=null,this.isDraped=!0,this.labelOptions=new ee,this.cursor=null,this.loading=!1,this.snapToSceneEnabled=null,this.firstVertex=null,this.lastVertex=null,this.secondToLastVertex=null,t.elevationInfo==null&&(this.elevationInfo=Ee(!!t.hasZ))}initialize(){let{geometryType:t,view:e}=this,n=e.spatialReference,i="viewingMode"in e.state?e.state.viewingMode:Ie.Local,r=t==="segment"||t==="multipoint"?"polyline":t;this.coordinateHelper=Ye(this.hasZ,this.hasM,n),this._editGeometryOperations=new $e(new Qe(r,this.coordinateHelper),i),this._snappingOperation=new nt({view:e}),this.addHandles([S(()=>({stagedPoint:this._snappingOperation.stagedPoint,constraint:this._constraint}),({stagedPoint:o,constraint:a},h)=>{let{snappingOptions:d}=this;if(d&&(d.forceDisabled=a!=null&&Ne(a)),h!=null&&o===h.stagedPoint&&a!==h.constraint)return this._onKeyboardBasedChange();this._processCursor(o??this._screenToMap(this._stagedScreenPoint))},{equals:(o,a)=>o.stagedPoint===a.stagedPoint&&ge(o.constraint,a.constraint)}),S(()=>this.view.viewpoint,(o,a)=>{o&&a&&Ve(o,a)&&this._onKeyboardBasedChange()})]),this._activeComponent=new Je(n,i),this._editGeometryOperations.data.components.push(this._activeComponent);let s=this.segmentLabels;s!=null&&(s.context={view:e,editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,labelOptions:this.labelOptions},this.addHandles(S(()=>this.labelOptions.enabled,o=>{s.visible=o},H))),this.addHandles(this._editGeometryOperations.on(["vertex-add","vertex-update","vertex-remove"],o=>{let a=o.vertices.map(m=>({componentIndex:0,vertexIndex:m.index,coordinates:this.coordinateHelper.vectorToArray(m.pos)})),h=a.map(m=>m.coordinates),d=this.coordinateHelper.vectorToDehydratedPoint(this._activeComponent.getFirstVertex()?.pos)??null;W(d,this.firstVertex)||(this.firstVertex=d);let y=this.coordinateHelper.vectorToDehydratedPoint(this._activeComponent.getLastVertex()?.pos)??null;W(y,this.lastVertex)||(this.lastVertex=y);let C=this.coordinateHelper.vectorToDehydratedPoint(this._activeComponent.edges.at(-1)?.leftVertex?.pos)??null;switch(W(C,this.secondToLastVertex)||(this.secondToLastVertex=C),this._processCursor(this.cursorVertex),o.type){case"vertex-add":this.emit(o.type,b(P({},o),{added:h,vertices:a}));break;case"vertex-update":this.emit(o.type,b(P({},o),{updated:h,vertices:a}));break;case"vertex-remove":this.emit(o.type,b(P({},o),{removed:h,vertices:a}))}}));let l=this._manipulator=new U({consumesClicks:!1,grabbableForEvent:o=>this.drawingMode!=="click"||o.pointerType==="touch"&&this._snappingEnabled&&this._pointerDownStates.size===1});this.manipulators.add(l),l.grabbable=t!=="point",this.addHandles([l.events.on("immediate-click",o=>this._onImmediateClick(o)),l.events.on("immediate-double-click",o=>this._onImmediateDoubleClick(o)),S(()=>this.drawingMode,()=>{this.removeHandles(ut),this.addHandles(this._createManipulatorDragPipeline(l),ut)},H),S(()=>({effectiveCursor:this.effectiveCursor}),({effectiveCursor:o})=>{l.cursor=o},H)]),Xe(this,()=>{let o=this.view.inputManager.latestPointerType??"mouse",a=this._getSnappingContext(o);if(this.snappingManager!=null){let h=this._snappingOperation.snapAgainNearPreviousMapPoint(this.snappingManager,a);this._updatingHandles.addPromise(N(h))}})}destroy(){I(this.segmentLabels),I(this._snappingOperation),this._editGeometryOperations=I(this._editGeometryOperations),this._updatingHandles.destroy()}get _isDragging(){let{_stagedPointerId:t,_manipulator:e}=this;return t!=null&&this._pointerDownStates.has(t)||e.grabbing||!e.interactive}get _snappingEnabled(){return this.snappingManager!=null&&this.snappingManager.options.effectiveEnabled}get _requiresScenePoint(){let t=this._updateAndGetEffectiveDrawSurface();return this.view.type==="3d"&&this.drawSurface!==t}get canRedo(){return this._editGeometryOperations.canRedo}get canUndo(){return this._editGeometryOperations.canUndo}get committedVertices(){return this._activeComponent.vertices.map(t=>this.coordinateHelper.vectorToArray(t.pos))}get _constraint(){let{constraints:t,constraintsEnabled:e}=this;if(t&&e)switch(this.geometryType){case"point":return this._getPointConstraint(t);case"polygon":case"polyline":return this._getPolylineOrPolygonConstraint(this.lastVertex,this.secondToLastVertex,t)}}set drawingMode(t){this._set("drawingMode",t??se)}get effectiveCursor(){return this.loading?Tt:this._hideDefaultCursor?null:this.cursor||Ct}get interactive(){return this._manipulator.interactive}set interactive(t){this._manipulator.interactive=t}get isCompleted(){return this._createOperationCompleted}get numCommittedVertices(){return this._activeComponent.vertices.length}get snappingOptions(){return this.snappingManager!=null?this.snappingManager.options:null}get cursorVertex(){return this._get("cursorVertex")}get visualizationCursorVertex(){return this._stagedPointerType==="mouse"?this.cursorVertex:null}get committableVertex(){let{cursorVertex:t,lastVertex:e,firstVertex:n,geometryType:i}=this;return i==="polygon"&&k(t,n)||k(t,e)?null:t}get updating(){return this._updatingHandles.updating}get geometryIncludingUncommittedVertices(){let{committedVertices:t,committableVertex:e,coordinateHelper:n}=this,i=t.slice();return e!=null&&i.push(n.pointToArray(e)),i}cancel(){this.complete({aborted:!0})}commitStagedVertex(){this._snappingOperation.abort();let{committableVertex:t}=this;t!=null&&this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(t))}complete(t){let e=t?.aborted||!1;this._snappingOperation.abort(),this.snappingManager?.doneSnapping();let{geometryType:n,numCommittedVertices:i}=this,r=n==="multipoint"&&i===0||n==="polyline"&&i<2||n==="polygon"&&i<3;n!=="segment"&&n!=="point"||this.commitStagedVertex(),this._createOperationCompleted=!r,(this.isCompleted||e)&&(this._stagedScreenPoint=null,this._stagedPointerId=null,this._stagedPointerType=null,this._processCursor(null),this.emit("complete",{vertices:this.committedVertices.map((s,l)=>({componentIndex:0,vertexIndex:l,coordinates:s})),aborted:e,type:"complete"}))}onInputEvent(t){switch(t.type){case"pointer-down":this._pointerDownStates.add(t.pointerId);break;case"pointer-up":this._pointerDownStates.delete(t.pointerId)}switch(t.type){case"pointer-move":return this._onPointerMove(t);case"hold":return this._onHold(t)}}redo(){this._editGeometryOperations.redo()}undo(){this.snappingManager!=null&&this.snappingManager.doneSnapping(),this._editGeometryOperations.undo()}_processCursor(t){let e=K(this.cursorVertex),n=K(t),i=n&&(this._updateAndGetEffectiveDrawSurface()?.constrainZ(n)??n),r=this._snapToClosingVertex(i),s=this._applyConstraints(r);k(e,s)||(this._set("cursorVertex",s),this.segmentLabels?.set("stagedVertex",s!=null?this.coordinateHelper.pointToVector(s):null),s==null||this._stagedPointerType!=="mouse"?this.emit("cursor-remove"):this.emit("cursor-update",{updated:null,vertices:[{componentIndex:0,vertexIndex:this._activeComponent.vertices.length,coordinates:this.coordinateHelper.pointToArray(s)}],operation:"apply",type:"vertex-update"}))}_snapToClosingVertex(t){if(t==null||this._isDragging||this.geometryType!=="polygon"||this.numCommittedVertices<=2)return t;let e=this._mapToScreen(t);if(!e)return t;let n=this._activeComponent;return this._vertexWithinPointerDistance(n.vertices[0].pos,e)?this.firstVertex:this._vertexWithinPointerDistance(n.vertices.at(-1).pos,e)?this.lastVertex:t}_createManipulatorDragPipeline(t){switch(this.drawingMode){case"click":return this._createManipulatorDragPipelineClick(t);case"freehand":return this._createManipulatorDragPipelineFreehand(t);case"hybrid":return this._createManipulatorDragPipelineHybrid(t)}}_createManipulatorDragPipelineClick(t){return L(t,(e,n,i,r)=>{let s=r==="touch"&&this._snappingEnabled;if(this.isCompleted||!s)return;let{snappingStep:l,cancelSnapping:o}=tt({predicate:()=>s,snappingManager:this.snappingManager,snappingContext:new oe({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,feature:this.graphic,pointer:r,visualizer:this.snappingVisualizer,drawConstraints:this.constraints}),updatingHandles:this._updatingHandles,useZ:!this._requiresScenePoint});i=i.next(a=>(s&&this.snappingManager!=null&&this.snappingManager.doneSnapping(),a)).next(o),n.next(this._screenToMapDragEventStep()).next(a=>(a.action==="start"&&(this._processCursor(a.mapStart),(this.geometryType==="segment"||s&&!this.numCommittedVertices)&&this.commitStagedVertex()),a)).next(et(this.view,this.elevationInfo)).next(...l).next(a=>(s&&(this._processCursor(a.mapEnd),a.action==="end"&&this.commitStagedVertex()),a)).next(a=>(a.action==="end"&&(this._stagedPointerType!=="mouse"&&this._snappingOperation.abort(),this.geometryType!=="segment"&&this.geometryType!=="point"||this.complete()),a))})}_createManipulatorDragPipelineFreehand(t){return L(t,(e,n)=>{this.isCompleted||n.next(this._screenToMapDragEventStep()).next(i=>(i.action==="start"&&(this._snappingOperation.abort(),this.committableVertex==null&&this._processCursor(i.mapStart),this.geometryType==="segment"&&this.commitStagedVertex()),i)).next(i=>{switch(i.action){case"start":case"update":this._processCursor(i.mapEnd),this.geometryType!=="polygon"&&this.geometryType!=="polyline"||this.commitStagedVertex();break;case"end":this.complete()}return i})})}_createManipulatorDragPipelineHybrid(t){return L(t,(e,n)=>{this.isCompleted||n.next(this._screenToMapDragEventStep()).next(i=>(i.action==="start"&&(this._snappingOperation.abort(),this.addHandles(this._editGeometryOperations.createUndoGroup(),ht),this._processCursor(i.mapStart),this.commitStagedVertex()),i)).next(i=>{switch(i.action){case"start":case"update":this._processCursor(i.mapEnd),this.geometryType!=="polygon"&&this.geometryType!=="polyline"||this.commitStagedVertex();break;case"end":this._stagedPointerType!=="mouse"&&this._snappingOperation.abort(),this.removeHandles(ht),this.geometryType!=="segment"&&this.geometryType!=="point"||this.complete()}return i})})}get _drawAtFixedElevation(){let{constraintsEnabled:t,constraintZ:e,geometryType:n,numCommittedVertices:i}=this;return t?e!=null||n==="segment"&&i>0:(n==="segment"||n==="polygon")&&i>0}_updateAndGetEffectiveDrawSurface(){let{constraintsEnabled:t,coordinateHelper:e,drawSurface:n,elevationDrawSurface:i,snapToSceneEnabled:r}=this;if(i==null)return n;if(!this.hasZ)return i.defaultZ=null,i;let s=this.elevationInfo?.mode,l=this.defaultZ,o=t||s==="absolute-height";return r!=null&&(o=r),s==="on-the-ground"&&(o=!1),this._drawAtFixedElevation&&(l=(t?this.constraintZ:null)??e.getZ(this._activeComponent.vertices[0].pos),o=!1),o?n:(i.defaultZ=l,i)}_mapToScreen(t){return this._updateAndGetEffectiveDrawSurface()?.mapToScreen(t)}_onHold(t){this._snappingOperation.abort(),this.drawingMode==="click"&&t.pointerType==="touch"&&this._snappingEnabled&&this._processCursor(t.mapPoint),t.stopPropagation()}_onImmediateClick(t){if(!(t.pointerType==="mouse"&&t.button===2||this._manipulator.dragging))try{let{drawingMode:e,geometryType:n}=this;this._stagedPointerType=t.pointerType,this._stagedScreenPoint=t.screenPoint;let i=this._screenToMap(t.screenPoint);if(i==null||i==null||e==="freehand"&&n!=="point")return;if(this._snappingEnabled&&this.cursorVertex!=null||this._processCursor(i),this.committableVertex==null)return void this.complete();this.commitStagedVertex(),t.pointerType!=="mouse"&&this._processCursor(null),(e==="freehand"||n==="point"||n==="segment"&&this.numCommittedVertices===2||n==="segment"&&e==="hybrid"&&this.numCommittedVertices===1)&&this.complete()}finally{t.stopPropagation()}}_onImmediateDoubleClick(t){this._manipulator.dragging||this.geometryType==="point"||(this.complete(),t.stopPropagation())}_onPointerMove(t){let e=A(t.x,t.y);this._stagedScreenPoint=e,this._stagedPointerType=t.pointerType,this._stagedPointerId=t.pointerId,this._isDragging?this._snappingOperation.abort():(t.stopPropagation(),this._processCursorMovementRelativeToSurface(e,t.pointerType))}_onKeyboardBasedChange(){this._stagedPointerType==="mouse"&&this._stagedScreenPoint&&this._stagedPointerId!=null&&!this._isDragging?this._processCursorMovementRelativeToSurface(this._stagedScreenPoint,this._stagedPointerType):this._snappingOperation.abort()}_processCursorMovementRelativeToSurface(t,e){let n=this._snappingOperation,i=this._screenToMap(t),r=this._requiresScenePoint?this.drawSurface?.screenToMap(t):null;if(i==null)return this._hideDefaultCursor=!0,this._processCursor(null),void n.abort();this._hideDefaultCursor=!1;let s=this.snappingManager;if(s==null)return this._processCursor(i),void n.abort();let l=this._getSnappingContext(e);this._updatingHandles.addPromise(N(n.snap({point:i,scenePoint:r},s,l)))}_applyConstraints(t){let{_constraint:e,constraints:n}=this;if(!t||!n||!e)return t;let{context:i}=n,r=R(t,i),s=r?e.closestTo(r):void 0;if(!s)return t;let l=pt(s,t,i),o=this.view.type==="2d"||i.elevationInfo.mode!=="absolute-height";return l!=null&&o&&this.constraintZ!=null&&this.hasZ&&(l.z=this.constraintZ),l}_screenToMap(t){return t?this._updateAndGetEffectiveDrawSurface()?.screenToMap(t):null}_screenToMapDragEventStep(){let t=null;return e=>{if(e.action==="start"&&(t=this._screenToMap(e.screenStart)),t==null)return null;let n=this._screenToMap(e.screenEnd);return n!=null?b(P({},e),{mapStart:t,mapEnd:n}):null}}_vertexWithinPointerDistance(t,e){let i=this._mapToScreen(this.coordinateHelper.vectorToDehydratedPoint(t));return i!=null&&Pt(i,e,25)}_getSnappingContext(t){let e=this._drawAtFixedElevation?this.elevationDrawSurface?.defaultZ:null;return new oe({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:t,feature:this.graphic,visualizer:this.snappingVisualizer,selfSnappingZ:e!=null?{value:e,elevationInfo:this.elevationInfo}:null,drawConstraints:this.constraints})}};function Pt(t,e,n){let i=t.x-e.x,r=t.y-e.y;return i*i+r*r<=n}p([u()],c.prototype,"_hideDefaultCursor",void 0),p([u()],c.prototype,"_stagedPointerId",void 0),p([u()],c.prototype,"_isDragging",null),p([u()],c.prototype,"_snappingOperation",void 0),p([u()],c.prototype,"_snappingEnabled",null),p([u({constructOnly:!0})],c.prototype,"graphic",void 0),p([u()],c.prototype,"constraintsEnabled",void 0),p([u()],c.prototype,"constraints",void 0),p([u()],c.prototype,"_constraint",null),p([u()],c.prototype,"constraintZ",void 0),p([u()],c.prototype,"defaultZ",void 0),p([u()],c.prototype,"isDraped",void 0),p([u({value:se})],c.prototype,"drawingMode",null),p([u({constructOnly:!0})],c.prototype,"elevationDrawSurface",void 0),p([u({constructOnly:!0})],c.prototype,"elevationInfo",void 0),p([u({constructOnly:!0,type:ee})],c.prototype,"labelOptions",void 0),p([u({constructOnly:!0})],c.prototype,"geometryType",void 0),p([u({constructOnly:!0})],c.prototype,"hasM",void 0),p([u({constructOnly:!0})],c.prototype,"hasZ",void 0),p([u()],c.prototype,"cursor",void 0),p([u()],c.prototype,"effectiveCursor",null),p([u()],c.prototype,"loading",void 0),p([u({constructOnly:!0})],c.prototype,"manipulators",void 0),p([u({constructOnly:!0})],c.prototype,"drawSurface",void 0),p([u({constructOnly:!0})],c.prototype,"segmentLabels",void 0),p([u({constructOnly:!0})],c.prototype,"snappingManager",void 0),p([u({constructOnly:!0})],c.prototype,"snappingVisualizer",void 0),p([u()],c.prototype,"snapToSceneEnabled",void 0),p([u({readOnly:!0})],c.prototype,"cursorVertex",null),p([u({readOnly:!0})],c.prototype,"visualizationCursorVertex",null),p([u()],c.prototype,"committableVertex",null),p([u()],c.prototype,"firstVertex",void 0),p([u()],c.prototype,"lastVertex",void 0),p([u()],c.prototype,"secondToLastVertex",void 0),p([u()],c.prototype,"updating",null),p([u({constructOnly:!0})],c.prototype,"view",void 0),c=p([fe("esri.views.draw.DrawOperation")],c);var dt=class{constructor(e,n,i,r=null){this._elevationInfo=e,this.defaultZ=n,this._view=i,this._excludeGraphics=r}screenToMap(e){let{defaultZ:n,_view:i}=this,r=i.sceneIntersectionHelper.intersectElevationFromScreen(be(e.x,e.y),this._elevationInfo,n??0,this._excludeGraphics);return n==null&&r!=null&&(r.z=void 0),r}mapToScreen(e){let n=M(e.x,e.y,J(this._view,e,this._elevationInfo),e.spatialReference);return this._view.toScreen(n)}constrainZ(e){let{defaultZ:n}=this;return n!=null&&e.z!==n&&((e=re(e)).z=n),e}},mt=class{constructor(e,n,i=[]){this.view=e,this.elevationInfo=n,this.exclude=i}screenToMap(e){let n=this.view.toMap(e,{exclude:this.exclude,excludeHud:!0});return n!=null&&(n.z=He(n,this.view,this.elevationInfo)),n}mapToScreen(e){let n=e;return this.elevationInfo!=null&&(n=M(e.x,e.y,J(this.view,e,this.elevationInfo),e.spatialReference)),this.view.toScreen(n)}constrainZ(e){return e}},gt=class{constructor(e,n=!1,i=0){this.view=e,this.hasZ=n,this.defaultZ=i,this.mapToScreen=r=>e.toScreen(r),this.screenToMap=n?r=>{let s=e.toMap(r);return s.z=i,s}:r=>e.toMap(r)}constrainZ(e){let{defaultZ:n}=this;return this.hasZ&&e.z!==n&&((e=re(e)).z=n),e}},le=class t{screenToMap(e){let{x:n,y:i}=e;return new v({x:n,y:i,spatialReference:t.spatialReference})}mapToScreen(e){return A(e.x,e.y)}constrainZ(e){return e}};le.spatialReference=new Z;function q(t,e,n=null){return n!=null?[t,e,n]:[t,e]}function ft(t,e,n=null){return n!=null?{x:t,y:e,z:n}:{x:t,y:e}}var j=class{constructor(e){this.spatialReference=e}mapToLocalMultiple(e){return e.map(n=>this.mapToLocal(n)).filter(me)}get doUnnormalization(){return!1}},pe=class extends j{constructor(e,n,i=null){super(n),this._defaultZ=i,this.transform=Q(),this.transformInv=Q(),this.transform=We(e),De(this.transformInv,this.transform)}makeMapPoint(e,n){return q(e,n,this._defaultZ)}mapToLocal(e){return ft(this.transform[0]*e[0]+this.transform[2]*e[1]+this.transform[4],this.transform[1]*e[0]+this.transform[3]*e[1]+this.transform[5])}localToMap(e){return q(this.transformInv[0]*e.x+this.transformInv[2]*e.y+this.transformInv[4],this.transformInv[1]*e.x+this.transformInv[3]*e.y+this.transformInv[5],this._defaultZ)}},ce=class extends j{constructor(e,n){super(e.spatialReference),this.view=e,this.defaultZ=null,this.pWS=g(),this.tangentFrameUpWS=g(),this.tangentFrameRightWS=g(),this.tangentFrameForwardWS=g(),this.localFrameRightWS=g(),this.localFrameUpWS=g(),this.worldToLocalTransform=Y(),this.localToWorldTransform=Y(),this.scale=1,this.scale=e.resolution,this.referenceMapPoint=n,this.defaultZ=n.hasZ?n.z:null;let i=e.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,F.X,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,F.Y,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,F.Z,this.tangentFrameForwardWS);let r=g();Se(r,this.tangentFrameForwardWS,Te(i,this.tangentFrameForwardWS)),G(this.localFrameRightWS,i,r),Ce(this.localFrameRightWS,this.localFrameRightWS),Pe(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),Re(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),Oe(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return this.view.viewingMode==="global"}makeMapPoint(e,n){return q(e,n,this.defaultZ)}mapToLocal(e){let n=g();this.view.renderCoordsHelper.toRenderCoords(new v({x:e[0],y:e[1],spatialReference:this.spatialReference}),n),X(n,n,this.worldToLocalTransform);let i=this.view.renderCoordsHelper.fromRenderCoords(n,new v({spatialReference:this.view.spatialReference}));return i!=null?ft(i.x/this.scale,i.y/this.scale):null}localToMap(e){let n=g();this.view.renderCoordsHelper.toRenderCoords(new v({x:e.x*this.scale,y:e.y*this.scale,spatialReference:this.spatialReference}),n),X(n,n,this.localToWorldTransform);let i=this.view.renderCoordsHelper.fromRenderCoords(n,new v({spatialReference:this.view.spatialReference}));return i!=null?q(i.x,i.y,this.defaultZ):null}};function Bn(t,e){if(t.type==="2d")return new pe(t.state.transform,t.spatialReference,e.length>2?e[2]:null);if(t.type==="3d"){let n=e.length>2?new v({x:e[0],y:e[1],z:e[2],spatialReference:t.spatialReference}):new v({x:e[0],y:e[1],spatialReference:t.spatialReference});return new ce(t,n)}return null}export{ft as a,pe as b,Bn as c,Lt as d,bt as e,se as f,c as g,dt as h,mt as i,gt as j,le as k};
