import{a as Ft,b as He,c as Mt,d as It,e as Ct,f as et,g as Ji,h as Fe,i as Jt,j as ei,k as eo,l as to,m as io,n as oo,o as ti,p as At,q as xt,r as Et,s as ro,t as so,u as me,v as no,w as ao,x as lo}from"./chunk-ULFWXTOR.js";import{p as Ki}from"./chunk-KEUU4ZK6.js";import{a as bt}from"./chunk-OJV7UZQQ.js";import{a as Gi}from"./chunk-BYHNGOPC.js";import"./chunk-YW3L7OMP.js";import"./chunk-NSS2V4FU.js";import"./chunk-DDZ3KR2Q.js";import"./chunk-L76YGILQ.js";import"./chunk-DJNDWEES.js";import"./chunk-7QY3BMVN.js";import"./chunk-5L33MNIH.js";import"./chunk-TNPL7MIN.js";import{a as Tt,b as kt,c as co,d as mo}from"./chunk-BZFJVAQS.js";import{a as ho}from"./chunk-BWK3LBHF.js";import{a as uo}from"./chunk-JC4ZKBNS.js";import"./chunk-GAF32LQP.js";import{a as je,e as po,m as ii}from"./chunk-JNONQQQT.js";import{a as M}from"./chunk-FHBFWDFD.js";import{a as oi}from"./chunk-S3DH7XZE.js";import"./chunk-3SWZR32A.js";import"./chunk-DXCDSOAV.js";import"./chunk-4XUK6P2F.js";import"./chunk-3SBNJPR7.js";import"./chunk-WRIQADAP.js";import"./chunk-SCOBUUIE.js";import"./chunk-HHIR5BNR.js";import"./chunk-B6VNGUER.js";import"./chunk-DJEFBPF6.js";import"./chunk-4D3QHJI2.js";import"./chunk-E2J2V7JN.js";import{a as Xi}from"./chunk-ACH5BMOT.js";import"./chunk-UBMORCKY.js";import"./chunk-CLVC2DXO.js";import"./chunk-RZU6EEB3.js";import"./chunk-WDTJILD4.js";import"./chunk-ELOLYWII.js";import"./chunk-ITQMD4YG.js";import"./chunk-V5WEARAB.js";import"./chunk-UZW3KXUC.js";import"./chunk-EGCJAGQM.js";import"./chunk-TG4PXMOO.js";import"./chunk-HSRIUK76.js";import"./chunk-4S7NY4TS.js";import"./chunk-AN6X7B73.js";import"./chunk-FKIHG4NK.js";import"./chunk-UC7SIIH5.js";import"./chunk-4S7K5A3I.js";import"./chunk-SIDAXOMN.js";import"./chunk-S2CEVLI5.js";import"./chunk-ZLKXQ3X4.js";import"./chunk-DTDFZYW6.js";import"./chunk-XURBKGOF.js";import"./chunk-XSGDUFLB.js";import"./chunk-4VRL7OJD.js";import"./chunk-64QAVEVQ.js";import"./chunk-FCT46YZ7.js";import"./chunk-KQ3PALPO.js";import"./chunk-DYBVQO6C.js";import"./chunk-H5BQFJQG.js";import"./chunk-ZPGECEOH.js";import"./chunk-IK3IRLTV.js";import"./chunk-SFX6QP6J.js";import"./chunk-BRJSO7CG.js";import"./chunk-AATZFFI5.js";import"./chunk-YNG4NJVY.js";import"./chunk-3FOGM572.js";import"./chunk-4ANB723A.js";import"./chunk-IGVG5UOD.js";import{a as Kt}from"./chunk-GT3C7LC6.js";import"./chunk-LNUI6KC7.js";import"./chunk-BXHQ44WX.js";import"./chunk-EWHTP5EW.js";import"./chunk-N3SZSSU6.js";import"./chunk-3JBDNTAW.js";import"./chunk-H63LVRK7.js";import"./chunk-72WWHQIV.js";import"./chunk-QPCBRHQI.js";import"./chunk-MZNGYP6Z.js";import"./chunk-3GCOAQPV.js";import{a as Yt}from"./chunk-SJU4N7KJ.js";import"./chunk-6NTJ4HVA.js";import"./chunk-X2KAPCU7.js";import"./chunk-JD3KGBGX.js";import"./chunk-GC4LGG7K.js";import"./chunk-VXW5JMKD.js";import"./chunk-NJ5QXHI6.js";import"./chunk-TMYZ2I35.js";import"./chunk-CBIYPMNC.js";import"./chunk-LHY2TOIB.js";import"./chunk-F4UISFW6.js";import"./chunk-TXAFMDDV.js";import"./chunk-ZCSEBPCJ.js";import"./chunk-S3JJYXYO.js";import"./chunk-LOEAA5XF.js";import{a as Je}from"./chunk-S2YBNG2F.js";import"./chunk-NSK56ILC.js";import{a as ne}from"./chunk-R2Q5NMSG.js";import{b as zi,d as _t,e as Hi,f as ji,g as Ui,i as wt,j as Zi,k as Qi,l as Oe,m as Xt}from"./chunk-QL456MD5.js";import{a as yt}from"./chunk-IY6MAS3P.js";import"./chunk-RPWH7ONJ.js";import"./chunk-H76XKIVW.js";import"./chunk-UWZJQ7YC.js";import{k as qi}from"./chunk-NC2NFLV7.js";import"./chunk-UJ6V7JUK.js";import"./chunk-GK2MPWKO.js";import"./chunk-3NCGJLJJ.js";import"./chunk-7LLNOPTV.js";import"./chunk-XRRPDCIR.js";import{c as Wi,d as vt}from"./chunk-XF4ZC6Y7.js";import"./chunk-BBLWQBZT.js";import"./chunk-D6QUKPEY.js";import"./chunk-VIAVLHRB.js";import"./chunk-UMZZ3I5D.js";import"./chunk-LSEOQ2KR.js";import{a as Di}from"./chunk-VXJKEPDS.js";import"./chunk-I3S324BU.js";import"./chunk-OM7Z3UKX.js";import"./chunk-6KRFVLII.js";import"./chunk-F47ZTJ7Y.js";import"./chunk-YXPGI3LI.js";import"./chunk-LSFTWXAE.js";import"./chunk-OO35HBWJ.js";import"./chunk-R5OKRCI7.js";import"./chunk-2EF3JPLL.js";import"./chunk-FWB3IYJJ.js";import"./chunk-KRMYHUR3.js";import"./chunk-R4NNYEN7.js";import{h as Si,j as Vi,t as Bi}from"./chunk-7G4KK3KW.js";import"./chunk-J3ZDC5ZE.js";import"./chunk-KYNKUTEO.js";import"./chunk-QWLQUMDY.js";import{e as ee,f as S,g as W}from"./chunk-AUSMAEKP.js";import{g as c,h as Pi}from"./chunk-WVCJLLRA.js";import{a as Oi}from"./chunk-MDSLION2.js";import{f as le,g as Qt,h as Gt}from"./chunk-OVOWBDBP.js";import"./chunk-V2KSICSA.js";import{a as f,b as xe,c as re,d as Li,f as Ri,g as I}from"./chunk-4XUOIGFO.js";import"./chunk-5HCLBNUR.js";import"./chunk-JZ3XIQ5W.js";import"./chunk-OMYJOG47.js";import"./chunk-3B4QONMA.js";import"./chunk-3SZQ2UT4.js";import"./chunk-SPDSGGOE.js";import"./chunk-2OKSPLJT.js";import"./chunk-7LEG2VDW.js";import"./chunk-R2HWUZ3L.js";import"./chunk-G24ZJINL.js";import{w as Yi}from"./chunk-T25YY3N7.js";import"./chunk-ALQ3STGG.js";import"./chunk-EETFV2SL.js";import"./chunk-AM3VOA32.js";import"./chunk-SAOUSUZE.js";import"./chunk-LECQV7I4.js";import"./chunk-7HZKOXPR.js";import"./chunk-DFTBSFIN.js";import"./chunk-4HISZWR4.js";import"./chunk-33BSK37G.js";import"./chunk-TQAPQODA.js";import"./chunk-M2GLXRA2.js";import"./chunk-EBWCXIFH.js";import"./chunk-MRVR6F6G.js";import"./chunk-WXQQZY3K.js";import"./chunk-VPMDQK57.js";import"./chunk-BCREO4Q5.js";import"./chunk-ZVHU7VE3.js";import"./chunk-76YVRX2R.js";import"./chunk-OZF6BMOL.js";import"./chunk-GJP6PTKT.js";import"./chunk-RSDQHAJX.js";import{b as Zt,d as G}from"./chunk-HMKFQDR7.js";import"./chunk-2OT2C2UU.js";import{a as gt}from"./chunk-XIMCHX2H.js";import{b as he}from"./chunk-SF6Z2K5H.js";import{a as Ti}from"./chunk-GBTN5LIS.js";import"./chunk-JOSG37QF.js";import"./chunk-SLMQFZE3.js";import"./chunk-FJDNRF2P.js";import"./chunk-VNB5ZT3P.js";import"./chunk-NDG5FXLR.js";import"./chunk-EJG3F6VR.js";import"./chunk-5ODCEDHC.js";import"./chunk-BENVXA3L.js";import{h as $i,l as ze}from"./chunk-SA4OMQAD.js";import"./chunk-24BLFS5R.js";import"./chunk-JDDD6VJ4.js";import"./chunk-VOYK3LZF.js";import"./chunk-HOJTYTYD.js";import{a as se}from"./chunk-XNEAL2YW.js";import"./chunk-J7M5V2SQ.js";import{a as ki}from"./chunk-RQD6EDD6.js";import{aa as Ni}from"./chunk-XPCG2OJX.js";import{L as s,O as U,b as Ye}from"./chunk-AUTL5LCV.js";import{S as w}from"./chunk-KUJG22IX.js";import"./chunk-OVHPPCBL.js";import{a as r}from"./chunk-W3WDPWBE.js";import{B as qe,o as xi,r as Ei,s as Ke,t as mt,u as pe,x as ft}from"./chunk-GISCFF3Z.js";import{b as Ai}from"./chunk-MLSR6YE6.js";import"./chunk-SNFOAZZQ.js";import"./chunk-CPDJJRWA.js";import"./chunk-VU5W7W6Y.js";import{l as ht,p as Ut,r as B,t as k}from"./chunk-HQMV3KQV.js";import{f as jt,q as be}from"./chunk-CRMMDK2Z.js";import"./chunk-MDAB6L5Y.js";import"./chunk-FMFGIQYB.js";import{a as _,b as Xe,h as g}from"./chunk-EAH6BNBL.js";function Ne(e,t,i,o){let n=null,a=1e3;typeof t=="number"?(a=t,o=i):(n=t??null,a=i);let l,d=0,u=()=>{d=0,e.apply(o,l)},p=(...h)=>{n&&n.apply(o,h),l=h,a?d||(d=setTimeout(u,a)):u()};return p.remove=()=>{d&&(clearTimeout(d),d=0)},p.forceUpdate=()=>{d&&(clearTimeout(d),u())},p.hasPendingUpdates=()=>!!d,p}function tt(e){switch(e?.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":case"polyline":return e.extent?.center;default:return null}}function fo(e){return e?{backgroundImage:`url(${e})`}:{}}function go({action:e,feature:t}){let i=t?.attributes,o="image"in e?e.image:void 0;return o&&i?G(o,i):o??""}var yo={editing:!1,operations:{add:!0,update:!0,delete:!0}},vo=he.ofType(Gi),te=class extends U{constructor(e){super(e),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.capabilities=_({},yo),this.activeAttachmentInfo=null,this.activeFileInfo=null,this.attachmentInfos=new vo,this.fileInfos=new he,this.graphic=null,this.mode="view",this.filesEnabled=!1,this.addHandles(f(()=>this.graphic,()=>this._graphicChanged(),I))}destroy(){this._attachmentLayer=null,this.graphic=null}castCapabilities(e){return _(_({},yo),e)}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){let{graphic:e}=this;if(!e)return!1;let t=e.layer||e.sourceLayer;return t?.loaded&&"capabilities"in t&&t.capabilities&&"operations"in t.capabilities&&"supportsResizeAttachments"in t.capabilities.operations&&t.capabilities.operations.supportsResizeAttachments||!1}getAttachments(){return g(this,null,function*(){let{_attachmentLayer:e,attachmentInfos:t}=this;if(!e||typeof e.queryAttachments!="function")throw new k("invalid-layer","getAttachments(): A valid layer is required.");let i=this._getObjectId(),o=new Yt({objectIds:[i],returnMetadata:!0}),n=[],a=e.queryAttachments(o).then(d=>d[i]||n).catch(()=>n);this._getAttachmentsPromise=a,this.notifyChange("state");let l=yield a;return t.destroyAll(),l.length&&t.addMany(l),this._getAttachmentsPromise=null,this.notifyChange("state"),l})}addAttachment(i){return g(this,arguments,function*(e,t=this.graphic){let{_attachmentLayer:o,attachmentInfos:n,capabilities:a}=this;if(!t)throw new k("invalid-graphic","addAttachment(): A valid graphic is required.",{graphic:t});if(!e)throw new k("invalid-attachment","addAttachment(): An attachment is required.",{attachment:e});if(!a.operations?.add)throw new k("invalid-capabilities","addAttachment(): add capabilities are required.");if(!o||typeof o.addAttachment!="function")throw new k("invalid-layer","addAttachment(): A valid layer is required.");let l=o.addAttachment(t,e).then(u=>this._queryAttachment(u.objectId,t)),d=yield l;return n.add(d),d})}deleteAttachment(e){return g(this,null,function*(){let{_attachmentLayer:t,attachmentInfos:i,graphic:o,capabilities:n}=this;if(!e)throw new k("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(!n.operations?.delete)throw new k("invalid-capabilities","deleteAttachment(): delete capabilities are required.");if(!t||typeof t.deleteAttachments!="function")throw new k("invalid-layer","deleteAttachment(): A valid layer is required.");if(!o)throw new k("invalid-graphic","deleteAttachment(): A graphic is required.");let a=t.deleteAttachments(o,[e.id]).then(()=>e),l=yield a;return i.remove(l),l.destroy(),l})}updateAttachment(i){return g(this,arguments,function*(e,t=this.activeAttachmentInfo){let{_attachmentLayer:o,attachmentInfos:n,graphic:a,capabilities:l}=this;if(!e)throw new k("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:e});if(!t)throw new k("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:t});if(!l.operations?.update)throw new k("invalid-capabilities","updateAttachment(): Update capabilities are required.");let d=n.indexOf(t);if(!o||typeof o.updateAttachment!="function")throw new k("invalid-layer","updateAttachment(): A valid layer is required.");if(!a)throw new k("invalid-graphic","updateAttachment(): A graphic is required.");let u=o.updateAttachment(a,t.id,e).then(h=>this._queryAttachment(h.objectId)),p=yield u;return n.splice(d,1,p),p})}commitFiles(){return g(this,null,function*(){return yield Promise.all(this.fileInfos.items.map(e=>this.addAttachment(e.form))),this.fileInfos.removeAll(),this.getAttachments()})}addFile(e,t){if(!e||!t)return null;let i={file:e,form:t};return this.fileInfos.add(i),i}updateFile(e,t,i=this.activeFileInfo){if(!e||!t||!i)return null;let o=this.fileInfos.indexOf(i);return o>-1&&this.fileInfos.splice(o,1,{file:e,form:t}),this.fileInfos.items[o]}deleteFile(e){let t=this.fileInfos.find(i=>i.file===e);return t?(this.fileInfos.remove(t),t):null}_queryAttachment(e,t){return g(this,null,function*(){let{_attachmentLayer:i}=this;if(!e||!i?.queryAttachments)throw new k("invalid-attachment-id","Could not query attachment.");let o=this._getObjectId(t),n=new Yt({objectIds:[o],attachmentsWhere:`AttachmentId=${e}`,returnMetadata:!0});return i.queryAttachments(n).then(a=>a[o][0])})}_getObjectId(e=this.graphic){return e?.getObjectId()??null}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>{}))}_setAttachmentLayer(){let{graphic:e}=this,t=Ft(e);this._attachmentLayer=t?t.type==="scene"&&t.associatedLayer!=null?t.associatedLayer:t:null}};r([s()],te.prototype,"capabilities",void 0),r([se("capabilities")],te.prototype,"castCapabilities",null),r([s()],te.prototype,"activeAttachmentInfo",void 0),r([s()],te.prototype,"activeFileInfo",void 0),r([s({readOnly:!0,type:vo})],te.prototype,"attachmentInfos",void 0),r([s()],te.prototype,"fileInfos",void 0),r([s({type:ne})],te.prototype,"graphic",void 0),r([s()],te.prototype,"mode",void 0),r([s({readOnly:!0})],te.prototype,"state",null),r([s()],te.prototype,"filesEnabled",void 0),r([s({readOnly:!0})],te.prototype,"supportsResizeAttachments",null),te=r([w("esri.widgets.Attachments.AttachmentsViewModel")],te);var it=te;function ri(e){let t=e.toLowerCase();return t==="image/bmp"||t==="image/emf"||t==="image/exif"||t==="image/gif"||t==="image/x-icon"||t==="image/jpeg"||t==="image/png"||t==="image/tiff"||t==="image/x-wmf"}function _o(e){let t=ki("esri/themes/base/images/files/");return e?e==="text/plain"?`${t}text-32.svg`:e==="application/pdf"?`${t}pdf-32.svg`:e==="text/csv"?`${t}csv-32.svg`:e==="application/gpx+xml"?`${t}gpx-32.svg`:e==="application/x-dwf"?`${t}cad-32.svg`:e==="application/postscript"||e==="application/json"||e==="text/xml"||e==="model/vrml"?`${t}code-32.svg`:e==="application/x-zip-compressed"||e==="application/x-7z-compressed"||e==="application/x-gzip"||e==="application/x-tar"||e==="application/x-gtar"||e==="application/x-bzip2"||e==="application/gzip"||e==="application/x-compress"||e==="application/x-apple-diskimage"||e==="application/x-rar-compressed"||e==="application/zip"?`${t}zip-32.svg`:e.includes("image/")?`${t}image-32.svg`:e.includes("audio/")?`${t}sound-32.svg`:e.includes("video/")?`${t}video-32.svg`:e.includes("msexcel")||e.includes("ms-excel")||e.includes("spreadsheetml")?`${t}excel-32.svg`:e.includes("msword")||e.includes("ms-word")||e.includes("wordprocessingml")?`${t}word-32.svg`:e.includes("powerpoint")||e.includes("presentationml")?`${t}report-32.svg`:`${t}generic-32.svg`:`${t}generic-32.svg`}var de={checkMark:"esri-icon-check-mark",close:"esri-icon-close",collapse:"esri-icon-collapse",down:"esri-icon-down",downArrow:"esri-icon-down-arrow",dragHorizontal:"esri-icon-drag-horizontal",dragVertical:"esri-icon-drag-vertical",duplicate:"esri-icon-duplicate",expand:"esri-icon-expand",fontFallbackText:"esri-icon-font-fallback-text",forward:"esri-icon-forward",handleVertical:"esri-icon-handle-vertical",icon:"esri-icon",left:"esri-icon-left",loadingIndicator:"esri-icon-loading-indicator",locateCircled:"esri-icon-locate-circled",minus:"esri-icon-minus",noticeTriangle:"esri-icon-notice-triangle",pause:"esri-icon-pause",play:"esri-icon-play",plus:"esri-icon-plus",radioChecked:"esri-icon-radio-checked",radioUnchecked:"esri-icon-radio-unchecked",refresh:"esri-icon-refresh",reverse:"esri-icon-reverse",right:"esri-icon-right",search:"esri-icon-search",swap:"esri-icon-swap",table:"esri-icon-table",trash:"esri-icon-trash",up:"esri-icon-up",upArrow:"esri-icon-up-arrow",upDownArrows:"esri-icon-up-down-arrows",urbanModel:"esri-icon-urban-model",zoomInMagnifyingGlass:"esri-icon-zoom-in-magnifying-glass",zoomToObject:"esri-icon-zoom-to-object"};var wo={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},L="esri-attachments",F={base:L,loaderContainer:`${L}__loader-container`,loader:`${L}__loader`,fadeIn:`${L}--fade-in`,container:`${L}__container`,containerList:`${L}__container--list`,containerPreview:`${L}__container--preview`,actions:`${L}__actions`,deleteButton:`${L}__delete-button`,addAttachmentButton:`${L}__add-attachment-button`,errorMessage:`${L}__error-message`,items:`${L}__items`,item:`${L}__item`,itemButton:`${L}__item-button`,itemMask:`${L}__item-mask`,itemMaskIcon:`${L}__item-mask--icon`,itemImage:`${L}__image`,itemImageResizable:`${L}__image--resizable`,itemLabel:`${L}__label`,itemFilename:`${L}__filename`,itemChevronIcon:`${L}__item-chevron-icon`,itemLink:`${L}__item-link`,itemLinkOverlay:`${L}__item-link-overlay`,itemLinkOverlayIcon:`${L}__item-link-overlay-icon`,itemEditIcon:`${L}__item-edit-icon`,itemAddIcon:`${L}__item-add-icon`,itemAddButton:`${L}__item-add-button`,formNode:`${L}__form-node`,fileFieldset:`${L}__file-fieldset`,fileLabel:`${L}__file-label`,fileName:`${L}__file-name`,fileInput:`${L}__file-input`,metadata:`${L}__metadata`,metadataFieldset:`${L}__metadata-fieldset`,progressBar:`${L}__progress-bar`},si=window.CSS,Z=class extends S{constructor(e,t){super(e,t),this.displayType="auto",this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=null,this.visibleElements=_({},wo),this._supportsImageOrientation=si&&si.supports&&si.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}normalizeCtorArgs(e){return e?.viewModel||(e=_({viewModel:new it},e)),e}initialize(){this.addHandles([re(()=>this.viewModel?.attachmentInfos,"change",()=>this.scheduleRender()),re(()=>this.viewModel?.fileInfos,"change",()=>this.scheduleRender()),f(()=>this.viewModel?.mode,()=>this._modeChanged(),I)])}loadDependencies(){return ee({icon:()=>import("./chunk-4HUBSTEF.js")})}get capabilities(){return this.viewModel.capabilities}set capabilities(e){this.viewModel.capabilities=e}get effectiveDisplayType(){let{displayType:e}=this;return e&&e!=="auto"?e:this.viewModel.supportsResizeAttachments?"preview":"list"}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get icon(){return"attachment"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}castVisibleElements(e){return _(_({},wo),e)}addAttachment(){let{_addAttachmentForm:e,viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.addAttachment(e).then(i=>(this._set("submitting",!1),this._set("error",null),t.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new k("attachments:add-attachment",this.messages.addErrorMessage,i)),i})}deleteAttachment(e){let{viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.deleteAttachment(e).then(i=>(this._set("submitting",!1),this._set("error",null),t.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new k("attachments:delete-attachment",this.messages.deleteErrorMessage,i)),i})}updateAttachment(){let{viewModel:e}=this,{_updateAttachmentForm:t}=this;return this._set("submitting",!0),this._set("error",null),e.updateAttachment(t).then(i=>(this._set("submitting",!1),this._set("error",null),e.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new k("attachments:update-attachment",this.messages.updateErrorMessage,i)),i})}addFile(){let e=this.viewModel.addFile(this.selectedFile,this._addAttachmentForm);return this.viewModel.mode="view",e}updateFile(){let{viewModel:e}=this,t=e.updateFile(this.selectedFile,this._updateAttachmentForm,e.activeFileInfo);return e.mode="view",t}deleteFile(e){let t=this.viewModel.deleteFile(e||this.viewModel.activeFileInfo?.file);return this.viewModel.mode="view",t}render(){let{submitting:e,viewModel:t}=this,{state:i}=t;return c("div",{class:this.classes(F.base,M.widget)},e?this._renderProgressBar():null,i==="loading"?this._renderLoading():this._renderAttachments(),this._renderErrorMessage())}_renderErrorMessage(){let{error:e,visibleElements:t}=this;return e&&t.errorMessage?c("div",{class:F.errorMessage,key:"error-message"},e.message):null}_renderAttachments(){let{activeFileInfo:e,mode:t,activeAttachmentInfo:i}=this.viewModel;return t==="add"?this._renderAddForm():t==="edit"?this._renderDetailsForm(i||e):this._renderAttachmentContainer()}_renderLoading(){return c("div",{class:F.loaderContainer,key:"loader"},c("div",{class:F.loader}))}_renderProgressBar(){return this.visibleElements.progressBar?c("div",{class:F.progressBar,key:"progress-bar"}):null}_renderAddForm(){let{submitting:e,selectedFile:t}=this,i=e||!t,o=this.visibleElements.cancelAddButton?c("button",{bind:this,class:this.classes(M.button,M.buttonTertiary,M.buttonSmall,M.buttonHalf,e&&M.buttonDisabled),disabled:e,onclick:this._cancelForm,type:"button"},this.messages.cancel):null,n=this.visibleElements.addSubmitButton?c("button",{class:this.classes(M.button,M.buttonSecondary,M.buttonSmall,M.buttonHalf,{[M.buttonDisabled]:i}),disabled:i,type:"submit"},this.messages.add):null,a=t?c("span",{class:F.fileName,key:"file-name"},t.name):null,l=c("form",{afterCreate:Gt,afterRemoved:Qt,bind:this,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},c("fieldset",{class:F.fileFieldset},a,c("label",{class:this.classes(F.fileLabel,M.button,M.buttonSecondary)},t?this.messages.changeFile:this.messages.selectFile,c("input",{bind:this,class:F.fileInput,name:"attachment",onchange:this._handleFileInputChange,type:"file"}))),n,o);return c("div",{class:F.formNode,key:"add-form-container"},l)}_renderDetailsForm(e){let{visibleElements:t,viewModel:i,selectedFile:o,submitting:n}=this,{capabilities:a}=i,l=n||!o,d,u,p,h;o?(d=o.type,u=o.name,p=o.size):e&&"file"in e?(d=e.file.type,u=e.file.name,p=e.file.size):e&&"contentType"in e&&(d=e.contentType,u=e.name,p=e.size,h=e.url);let m=a.editing&&a.operations?.delete&&t.deleteButton?c("button",{bind:this,class:this.classes(M.button,M.buttonSmall,M.buttonTertiary,F.deleteButton,{[M.buttonDisabled]:n}),disabled:n,key:"delete-button",onclick:$=>this._submitDeleteAttachment($,e),type:"button"},this.messages.delete):void 0,v=a.editing&&a.operations?.update&&t.updateButton?c("button",{class:this.classes(M.button,M.buttonSmall,M.buttonThird,{[M.buttonDisabled]:l}),disabled:l,key:"update-button",type:"submit"},this.messages.update):void 0,y=this.visibleElements.cancelUpdateButton?c("button",{bind:this,class:this.classes(M.button,M.buttonSmall,M.buttonTertiary,M.buttonThird,{[M.buttonDisabled]:n}),disabled:n,key:"cancel-button",onclick:this._cancelForm,type:"button"},this.messages.cancel):void 0,b=a.editing&&a.operations?.update?c("fieldset",{class:F.fileFieldset,key:"file"},c("span",{class:F.fileName,key:"file-name"},u),c("label",{class:this.classes(F.fileLabel,M.button,M.buttonSecondary)},this.messages.changeFile,c("input",{bind:this,class:F.fileInput,name:"attachment",onchange:this._handleFileInputChange,type:"file"}))):void 0,T=c("fieldset",{class:F.metadataFieldset,key:"size"},c("label",null,Ki(this.messagesUnits,p??0))),R=c("fieldset",{class:F.metadataFieldset,key:"content-type"},c("label",null,d)),A=h!=null?c("a",{class:F.itemLink,href:h,rel:"noreferrer",target:"_blank"},this._renderImageMask(e,400),c("div",{class:F.itemLinkOverlay},c("span",{class:F.itemLinkOverlayIcon},c("calcite-icon",{icon:"launch"})))):this._renderImageMask(e,400),O=c("form",{afterCreate:Gt,afterRemoved:Qt,bind:this,"data-node-ref":"_updateAttachmentForm",onsubmit:$=>this._submitUpdateAttachment($,e)},c("div",{class:F.metadata},T,R),b,c("div",{class:F.actions},m,y,v));return c("div",{class:F.formNode,key:"edit-form-container"},A,O)}_renderImageMask(e,t){return e?"file"in e?this._renderGenericImageMask(e.file.name,e.file.type):this._renderImageMaskForAttachment(e,t):null}_renderGenericImageMask(e,t){let{supportsResizeAttachments:i}=this.viewModel,o=_o(t),n={[F.itemImageResizable]:i};return c("div",{class:this.classes(F.itemMaskIcon,F.itemMask),key:o},c("img",{alt:e,class:this.classes(n,F.itemImage),src:o,title:e}))}_renderImageMaskForAttachment(e,t){let{supportsResizeAttachments:i}=this.viewModel;if(!e)return null;let{contentType:o,name:n,url:a}=e;if(!i||!ri(o))return this._renderGenericImageMask(n,o);let l=this._getCSSTransform(e),d=l?{transform:l,"image-orientation":"none"}:{},u=`${a}${a?.includes("?")?"&":"?"}w=${t}`,p={[F.itemImageResizable]:i};return c("div",{class:this.classes(F.itemMask),key:u},c("img",{alt:n,class:this.classes(p,F.itemImage),src:u,styles:d,title:n}))}_renderFile(e){let{file:t}=e;return c("li",{class:F.item,key:t},c("button",{"aria-label":this.messages.attachmentDetails,bind:this,class:F.itemButton,key:"details-button",onclick:()=>this._startEditFile(e),title:this.messages.attachmentDetails,type:"button"},this._renderImageMask(e),c("label",{class:F.itemLabel},c("span",{class:F.itemFilename},t.name||this.messages.noTitle),c("span",{"aria-hidden":"true",class:this.classes(F.itemChevronIcon,le(this.container)?de.left:de.right)}))))}_renderAttachmentInfo({attachmentInfo:e,displayType:t}){let{viewModel:i,effectiveDisplayType:o}=this,{capabilities:n,supportsResizeAttachments:a}=i,{contentType:l,name:d,url:u}=e,p=this._renderImageMask(e,t==="list"?48:400),h=n.editing?c("span",{"aria-hidden":"true",class:this.classes(F.itemChevronIcon,le(this.container)?de.left:de.right)}):null,m=[p,o==="preview"&&a&&ri(l)?null:c("label",{class:F.itemLabel},c("span",{class:F.itemFilename},d||this.messages.noTitle),h)],v=n.editing?c("button",{"aria-label":this.messages.attachmentDetails,bind:this,class:F.itemButton,"data-attachment-info-id":e.id,key:"details-button",onclick:()=>this._startEditAttachment(e),title:this.messages.attachmentDetails,type:"button"},m):c("a",{class:F.itemButton,href:u??void 0,key:"details-link",rel:"noreferrer",target:"_blank"},m);return c("li",{class:F.item,key:e},v)}_renderAttachmentContainer(){let{effectiveDisplayType:e,viewModel:t,visibleElements:i}=this,{attachmentInfos:o,capabilities:n,fileInfos:a}=t,l=!!o?.length,d=!!a?.length,u={[F.containerList]:e!=="preview",[F.containerPreview]:e==="preview"},p=n.editing&&n.operations?.add&&i.addButton?c("button",{bind:this,class:this.classes(M.button,M.buttonTertiary,F.addAttachmentButton),onclick:()=>this._startAddAttachment(),type:"button"},c("span",{"aria-hidden":"true",class:this.classes(F.itemAddIcon,de.plus)}),this.messages.add):void 0,h=l?c("ul",{class:F.items,key:"attachments-list"},o.toArray().map(y=>this._renderAttachmentInfo({attachmentInfo:y,displayType:e}))):void 0,m=d?c("ul",{class:F.items,key:"file-list"},a.toArray().map(y=>this._renderFile(y))):void 0,v=d||l?void 0:c("div",{class:M.empty},this.messages.noAttachments);return c("div",{class:this.classes(F.container,u),key:"attachments-container"},h,m,v,p)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(e){let t=e.target,i=t.files?.item(0);this._set("selectedFile",i)}_submitDeleteAttachment(e,t){e.preventDefault(),t&&("file"in t?this.deleteFile(t.file):t&&this.deleteAttachment(t))}_submitAddAttachment(e){e.preventDefault(),this.viewModel.filesEnabled?this.addFile():this.addAttachment()}_submitUpdateAttachment(e,t){e.preventDefault(),t&&"file"in t?this.updateFile():this.updateAttachment()}_startEditAttachment(e){let{viewModel:t}=this;t.activeFileInfo=null,t.activeAttachmentInfo=e,t.mode="edit"}_startEditFile(e){let{viewModel:t}=this;t.activeAttachmentInfo=null,t.activeFileInfo=e,t.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(e){e.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(e){let{orientationInfo:t}=e;return!this._supportsImageOrientation&&t?[t.rotation?`rotate(${t.rotation}deg)`:"",t.mirrored?"scaleX(-1)":""].join(" "):""}};r([s()],Z.prototype,"capabilities",null),r([s()],Z.prototype,"displayType",void 0),r([s({readOnly:!0})],Z.prototype,"effectiveDisplayType",null),r([s()],Z.prototype,"graphic",null),r([s()],Z.prototype,"icon",null),r([s()],Z.prototype,"label",null),r([s(),W("esri/widgets/Attachments/t9n/Attachments")],Z.prototype,"messages",void 0),r([s(),W("esri/core/t9n/Units")],Z.prototype,"messagesUnits",void 0),r([s({readOnly:!0})],Z.prototype,"selectedFile",void 0),r([s({readOnly:!0})],Z.prototype,"submitting",void 0),r([s({readOnly:!0})],Z.prototype,"error",void 0),r([s({type:it})],Z.prototype,"viewModel",void 0),r([s()],Z.prototype,"visibleElements",void 0),r([se("visibleElements")],Z.prototype,"castVisibleElements",null),Z=r([w("esri.widgets.Attachments")],Z);var bo=Z;var ot=class extends it{constructor(e){super(e),this.description=null,this.title=null}};r([s()],ot.prototype,"description",void 0),r([s()],ot.prototype,"title",void 0),ot=r([w("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],ot);var rt=ot;var ni="esri-feature-element-info",ai={base:ni,title:`${ni}__title`,description:`${ni}__description`},Ue=class extends S{constructor(e,t){super(e,t),this.description=null,this.headingLevel=2,this.title=null}render(){return c("div",{class:ai.base},this._renderTitle(),this._renderDescription())}_renderTitle(){let{title:e}=this;return e?c(je,{class:ai.title,innerHTML:e,level:this.headingLevel}):null}_renderDescription(){let{description:e}=this;return e?c("div",{class:ai.description,innerHTML:e,key:"description"}):null}};r([s()],Ue.prototype,"description",void 0),r([s()],Ue.prototype,"headingLevel",void 0),r([s()],Ue.prototype,"title",void 0),Ue=r([w("esri.widgets.Feature.support.FeatureElementInfo")],Ue);var Ee=Ue;var nr={base:"esri-feature-attachments"},fe=class extends S{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attachmentsWidget=new bo,this.headingLevel=2,this.viewModel=new rt}initialize(){this._featureElementInfo=new Ee,this.addHandles([f(()=>[this.viewModel?.description,this.viewModel?.title,this.headingLevel],()=>this._setupFeatureElementInfo(),I),f(()=>this.viewModel,e=>this.attachmentsWidget.viewModel=e,I)])}destroy(){this.attachmentsWidget.viewModel=null,this.attachmentsWidget.destroy(),this._featureElementInfo?.destroy()}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get displayType(){return this.attachmentsWidget.displayType}set displayType(e){this.attachmentsWidget.displayType=e}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){let{attachmentsWidget:e}=this;return c("div",{class:nr.base},this._featureElementInfo?.render(),e?.render())}_setupFeatureElementInfo(){let{description:e,title:t,headingLevel:i}=this;this._featureElementInfo?.set({description:e,title:t,headingLevel:i})}};r([s({readOnly:!0})],fe.prototype,"attachmentsWidget",void 0),r([s()],fe.prototype,"description",null),r([s()],fe.prototype,"displayType",null),r([s()],fe.prototype,"graphic",null),r([s()],fe.prototype,"headingLevel",void 0),r([s()],fe.prototype,"title",null),r([s({type:rt})],fe.prototype,"viewModel",void 0),fe=r([w("esri.widgets.Feature.FeatureAttachments")],fe);var Fo=fe;var Te=class extends U{constructor(e){super(e),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.addHandles(f(()=>this.creator,t=>{this._destroyContent(),this._createContent(t)},I))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){let{created:e,graphic:t,destroyer:i}=this;e&&t&&(He({type:"content",value:i,event:{graphic:t}}),this._set("created",null))}_createContent(e){return g(this,null,function*(){let t=this.graphic;if(!t||!e)return;let i=He({type:"content",value:e,event:{graphic:t}});this._loadingPromise=i,this.notifyChange("state");let o=yield i;i===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",o))})}};r([s({readOnly:!0})],Te.prototype,"created",void 0),r([s()],Te.prototype,"creator",void 0),r([s()],Te.prototype,"destroyer",void 0),r([s({type:ne})],Te.prototype,"graphic",void 0),r([s({readOnly:!0})],Te.prototype,"state",null),Te=r([w("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],Te);var $e=Te;var li="esri-feature-content",di={base:li,loaderContainer:`${li}__loader-container`,loader:`${li}__loader`},Ze=class extends S{constructor(e,t){super(e,t),this.viewModel=null,this._addTargetToAnchors=i=>{Array.from(i.querySelectorAll("a")).forEach(o=>{Mt(o.href)&&!o.hasAttribute("target")&&o.setAttribute("target","_blank")})}}get creator(){return this.viewModel?.creator}set creator(e){this.viewModel&&(this.viewModel.creator=e)}get graphic(){return this.viewModel?.graphic}set graphic(e){this.viewModel&&(this.viewModel.graphic=e)}render(){let e=this.viewModel?.state;return c("div",{class:di.base},e==="loading"?this._renderLoading():this._renderCreated())}_renderLoading(){return c("div",{class:di.loaderContainer,key:"loader"},c("div",{class:di.loader}))}_renderCreated(){let e=this.viewModel?.created;return e?e instanceof HTMLElement?c("div",{afterCreate:this._attachToNode,bind:e,key:e}):kt(e)?c("div",{key:e},!e.destroyed&&e.render()):c("div",{afterCreate:this._addTargetToAnchors,innerHTML:e,key:e}):null}_attachToNode(e){let t=this;e.appendChild(t)}};r([s()],Ze.prototype,"creator",null),r([s()],Ze.prototype,"graphic",null),r([s({type:$e})],Ze.prototype,"viewModel",void 0),Ze=r([w("esri.widgets.Feature.FeatureContent")],Ze);var Qe=Ze;var Me=class extends U{constructor(e){super(e),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){let{expressionInfos:e,fieldInfos:t}=this,i=[];return t?.forEach(o=>{if(!(!o.hasOwnProperty("visible")||o.visible))return;let n=o.clone();n.label=Ct(n,e),i.push(n)}),i}};r([s()],Me.prototype,"attributes",void 0),r([s({type:[Zi]})],Me.prototype,"expressionInfos",void 0),r([s()],Me.prototype,"description",void 0),r([s({type:[_t]})],Me.prototype,"fieldInfos",void 0),r([s({readOnly:!0})],Me.prototype,"formattedFieldInfos",null),r([s()],Me.prototype,"title",void 0),Me=r([w("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],Me);var Se=Me;var ar=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];function Mo(e,t){if(typeof t!="string"||!t)return t;let i=ar.find(u=>u.pattern.test(t));if(!i)return t;let o=t.match(i.pattern),n=o?.[2],a=ht(ht(i.label,{messages:e,hierPart:n}),{appName:i.appName}),l=i.target?` target="${i.target}"`:"",d=i.target==="_blank"?' rel="noreferrer"':"";return t.replace(i.pattern,`<a${l} href="$1"${d}>${a}</a>`)}var Lt="esri-feature-fields",Rt={base:Lt,fieldHeader:`${Lt}__field-header`,fieldData:`${Lt}__field-data`,fieldDataDate:`${Lt}__field-data--date`},ce=class extends S{constructor(e,t){super(e,t),this._featureElementInfo=null,this.viewModel=new Se,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new Ee,this.addHandles(f(()=>[this.viewModel?.description,this.viewModel?.title],()=>this._setupFeatureElementInfo(),I))}destroy(){this._featureElementInfo?.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get expressionInfos(){return this.viewModel.expressionInfos}set expressionInfos(e){this.viewModel.expressionInfos=e}get fieldInfos(){return this.viewModel.fieldInfos}set fieldInfos(e){this.viewModel.fieldInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){return c("div",{class:Rt.base},this._featureElementInfo?.render(),this._renderFields())}_renderFieldInfo(e,t){let{attributes:i}=this.viewModel,o=e.fieldName||"",n=e.label||o,a=i?i[o]==null?"":i[o]:"",l=!!e.format?.dateFormat,d=typeof a=="number"&&!l?this._forceLTR(a):Mo(this.messagesURIUtils,a),u={[Rt.fieldDataDate]:l};return c("tr",{key:`fields-element-info-row-${o}-${t}`},c("th",{class:Rt.fieldHeader,innerHTML:n,key:`fields-element-info-row-header-${o}-${t}`}),c("td",{class:this.classes(Rt.fieldData,u),innerHTML:d,key:`fields-element-info-row-data-${o}-${t}`}))}_renderFields(){let{formattedFieldInfos:e}=this.viewModel;return e?.length?c("table",{class:M.table,summary:this.messages.fieldsSummary},c("tbody",null,e.map((t,i)=>this._renderFieldInfo(t,i)))):null}_setupFeatureElementInfo(){let{description:e,title:t}=this;this._featureElementInfo?.set({description:e,title:t})}_forceLTR(e){return`&lrm;${e}`}};r([s()],ce.prototype,"attributes",null),r([s()],ce.prototype,"description",null),r([s()],ce.prototype,"expressionInfos",null),r([s()],ce.prototype,"fieldInfos",null),r([s()],ce.prototype,"title",null),r([s({type:Se,nonNullable:!0})],ce.prototype,"viewModel",void 0),r([s(),W("esri/widgets/Feature/t9n/Feature")],ce.prototype,"messages",void 0),r([s(),W("esri/widgets/support/t9n/uriUtils")],ce.prototype,"messagesURIUtils",void 0),ce=r([w("esri.widgets.Feature.FeatureFields")],ce);var Pt=ce;var lr="esri.widgets.Feature.support.relatedFeatureUtils",Io=()=>B.getLogger(lr),Co=new Map;function Ge(e){if(!me(e))return null;let[t,i]=e.split("/").slice(1);return{layerId:t,fieldName:i}}function dr(e,t){if(!t.relationships)return null;let i=null,{relationships:o}=t;return o.some(n=>n.id===parseInt(e,10)&&(i=n,!0)),i}function cr({originRelationship:e,relationships:t,layerId:i}){return t.find(({relatedTableId:o,id:n})=>`${o}`===i&&n===e?.id)??null}function ur(e,t){let i=t.toLowerCase();for(let o in e)if(o.toLowerCase()===i)return e[o];return null}function Ao(e,t){let i=dr(e,t);if(i)return{url:`${t.url}/${i.relatedTableId}`,sourceSpatialReference:t.spatialReference,relation:i,relatedFields:[],outStatistics:[]}}function xo(e,t){if(!t||!e)return;let{features:i,statsFeatures:o}=e,n=i?.value;t.relatedFeatures=n?n.features:[];let a=o?.value;t.relatedStatsFeatures=a?a.features:[]}function pr(e,t,i,o){let n=new Je;return n.outFields=["*"],n.relationshipId=typeof t.id=="number"?t.id:parseInt(t.id,10),n.objectIds=[e.attributes[i.objectIdField]],n.gdbVersion=i.gdbVersion??null,n.historicMoment=i.historicMoment??null,i.queryRelatedFeatures?.(n,o)??Promise.resolve({})}function hr(e,t,i){let o=0,n=[];for(;o<t.length;)n.push(`${e} IN (${t.slice(o,i+o)})`),o+=i;return n.join(" OR ")}function mr(e){return e?jt(e):void 0}function fr(e){return e?jt(e,(t,i)=>JSON.stringify(t.toJSON())===JSON.stringify(i.toJSON())):void 0}function gr(e,t,i,o){return g(this,null,function*(){let n=i.layerId.toString(),{layerInfo:a,relation:l,relatedFields:d,outStatistics:u,url:p,sourceSpatialReference:h}=t,m=mr(d),v=fr(u);if(!a||!l)return null;let y=cr({originRelationship:l,relationships:a.relationships,layerId:n});if(y?.relationshipTableId&&y.keyFieldInRelationshipTable){let T=(yield pr(e,y,i,o))[e.attributes[i.objectIdField]];if(!T)return null;let R=T.features.map(A=>A.attributes[a.objectIdField]);if(v?.length&&a.supportsStatistics){let A=new vt;A.where=hr(a.objectIdField,R,1e3),A.outFields=m,A.outStatistics=v,A.sourceSpatialReference=h;let O={features:Promise.resolve(T),statsFeatures:bt(p,A)};return pe(O)}}let b=y?.keyField;if(b){let T=Yi(vr(a.fields,b)),R=ur(e.attributes,l.keyField),A=T?`${b}=${R}`:`${b}='${R}'`,O=i.historicMoment,$=i.gdbVersion,ae=bt(p,new vt({where:A,outFields:m,sourceSpatialReference:h,historicMoment:O,gdbVersion:$}),o),_e=v?.length&&a.supportsStatistics?bt(p,new vt({where:A,outFields:m,outStatistics:v,sourceSpatialReference:h}),o):null,Ae={features:ae};return _e&&(Ae.statsFeatures=_e),pe(Ae)}return null})}function yr(e,t){return Ni(e,{query:{f:"json"},signal:t?.signal})}function Eo({relatedInfos:e,layer:t},i){let o={};return e.forEach((n,a)=>{let{relation:l}=n;if(!l){let m=new k("relation-required","A relation is required on a layer to retrieve related records.");throw Io().error(m),m}let{relatedTableId:d}=l;if(typeof d!="number"){let m=new k("A related table ID is required on a layer to retrieve related records.");throw Io().error(m),m}let u=`${t.url}/${d}`,p=Co.get(u),h=p??yr(u);p||Co.set(u,h),o[a]=h}),Ei(pe(o),i)}function To({graphic:e,relatedInfos:t,layer:i},o){let n={};return t.forEach((a,l)=>{a.layerInfo&&(n[l]=gr(e,a,i,o))}),pe(n)}function ko({relatedInfo:e,fieldName:t,fieldInfo:i}){if(e.relatedFields?.push(t),i.statisticType){let o=new Wi({statisticType:i.statisticType,onStatisticField:t,outStatisticFieldName:t});e.outStatistics?.push(o)}}function vr(e,t){if(e!=null){t=t.toLowerCase();for(let i of e)if(i&&i.name.toLowerCase()===t)return i}return null}var Lo={chartAnimation:!0},q=class extends U{constructor(e){super(e),this.abilities=_({},Lo),this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.isAggregate=!1,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(e){return _(_({},Lo),e)}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(e){this._setContentElementMedia(e)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(e){let{formattedMediaInfoCount:t}=this,i=(e+t)%t;this.activeMediaInfoIndex=i}_pageContentElementMedia(e){let{activeMediaInfoIndex:t}=this,i=t+e;this._setContentElementMedia(i)}_formatMediaInfos(){let{mediaInfos:e,layer:t}=this,i=this.attributes??{},o=this.formattedAttributes??{},n=this.expressionAttributes??{},a=this.fieldInfoMap??new Map;return e?.map(l=>{let d=l?.clone();return d?(d.title=Fe({attributes:i,fieldInfoMap:a,globalAttributes:o,expressionAttributes:n,layer:t,text:d.title}),d.caption=Fe({attributes:i,fieldInfoMap:a,globalAttributes:o,expressionAttributes:n,layer:t,text:d.caption}),d.altText=Fe({attributes:i,fieldInfoMap:a,globalAttributes:o,expressionAttributes:n,layer:t,text:d.altText}),d.type==="image"?d.value?(this._setImageValue({value:d.value,formattedAttributes:o,layer:t}),d.value.sourceURL?d:void 0):void 0:d.type==="pie-chart"||d.type==="line-chart"||d.type==="column-chart"||d.type==="bar-chart"?d.value?(this._setChartValue({value:d.value,chartType:d.type,attributes:i,formattedAttributes:o,layer:t,expressionAttributes:n}),d):void 0:null):null}).filter(be)??[]}_setImageValue(e){let t=this.fieldInfoMap??new Map,{value:i,formattedAttributes:o,layer:n}=e,{linkURL:a,sourceURL:l}=i;if(l){let d=ei(l,n);i.sourceURL=Jt({formattedAttributes:o,template:d,fieldInfoMap:t})}if(a){let d=ei(a,n);i.linkURL=Jt({formattedAttributes:o,template:d,fieldInfoMap:t})}}_setChartValue(e){let{value:t,attributes:i,formattedAttributes:o,chartType:n,layer:a,expressionAttributes:l}=e,{popupTemplate:d,relatedInfos:u}=this,{fields:p,normalizeField:h}=t,m=a;if(t.fields=Ji(p,m),h&&(t.normalizeField=et(h,m)),!p.some(y=>!!(o[y]!=null||me(y)&&u?.size)))return;let v=d?.fieldInfos??[];p.forEach((y,b)=>{let T=t.colors?.[b];if(me(y))return void(t.series=[...t.series,...this._getRelatedChartInfos({fieldInfos:v,fieldName:y,formattedAttributes:o,chartType:n,value:t,color:T})]);let R=this._getChartOption({value:t,attributes:i,chartType:n,formattedAttributes:o,expressionAttributes:l,fieldName:y,fieldInfos:v,color:T});t.series.push(R)})}_getRelatedChartInfos(e){let{fieldInfos:t,fieldName:i,formattedAttributes:o,chartType:n,value:a,color:l}=e,d=[],u=Ge(i),p=u&&this.relatedInfos?.get(u.layerId.toString());if(!p)return d;let{relatedFeatures:h,relation:m}=p;if(!m||!h)return d;let{cardinality:v}=m;return h.forEach(y=>{let{attributes:b}=y;b&&Object.keys(b).forEach(T=>{T===u.fieldName&&d.push(this._getChartOption({value:a,attributes:b,formattedAttributes:o,fieldName:i,chartType:n,relatedFieldName:T,hasMultipleRelatedFeatures:h?.length>1,fieldInfos:t,color:l}))})}),v==="one-to-many"||v==="many-to-many"?d:[d[0]]}_getTooltip({label:e,value:t,chartType:i}){return i==="pie-chart"?`${e}`:`${e}: ${t}`}_getChartOption(e){let{value:t,attributes:i,formattedAttributes:o,expressionAttributes:n,fieldName:a,relatedFieldName:l,fieldInfos:d,chartType:u,hasMultipleRelatedFeatures:p,color:h}=e,m=this.layer,v=this.fieldInfoMap??new Map,{normalizeField:y,tooltipField:b}=t,T=y?me(y)?i[Ge(y).fieldName]:i[y]:null,R=It(a)&&n&&n[a]!==void 0?n[a]:l&&i[l]!==void 0?i[l]:i[a]!==void 0?i[a]:o[a],A=new ji({fieldName:a,color:h,value:R===void 0?null:R&&T?R/T:R});if(me(a)){let Ae=v.get(a.toLowerCase()),pt=b&&v.get(b.toLowerCase()),we=Ae?.fieldName??a,Ht=p&&b?Ge(b).fieldName:pt?.fieldName??b,rr=p&&Ht?i[Ht]:o[Ht]??Ae?.label??Ae?.fieldName??l,sr=p&&l?i[l]:o[we];return A.tooltip=this._getTooltip({label:rr,value:sr,chartType:u}),A}let O=to(d,a),$=et(a,m),ae=b&&o[b]!==void 0?o[b]:Ct(O||new _t({fieldName:$}),this.popupTemplate?.expressionInfos),_e=o[$];return A.tooltip=this._getTooltip({label:ae,value:_e,chartType:u}),A}};r([s()],q.prototype,"abilities",void 0),r([se("abilities")],q.prototype,"castAbilities",null),r([s()],q.prototype,"activeMediaInfoIndex",void 0),r([s({readOnly:!0})],q.prototype,"activeMediaInfo",null),r([s()],q.prototype,"attributes",void 0),r([s()],q.prototype,"description",void 0),r([s()],q.prototype,"fieldInfoMap",void 0),r([s()],q.prototype,"formattedAttributes",void 0),r([s()],q.prototype,"expressionAttributes",void 0),r([s({readOnly:!0})],q.prototype,"formattedMediaInfos",null),r([s()],q.prototype,"isAggregate",void 0),r([s()],q.prototype,"layer",void 0),r([s({readOnly:!0})],q.prototype,"formattedMediaInfoCount",null),r([s()],q.prototype,"mediaInfos",void 0),r([s()],q.prototype,"popupTemplate",void 0),r([s()],q.prototype,"relatedInfos",void 0),r([s()],q.prototype,"title",void 0),q=r([w("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],q);var ge=q;var z="esri-feature-media",Y={base:z,mediaContainer:`${z}__container`,mediaItemContainer:`${z}__item-container`,mediaItem:`${z}__item`,mediaItemText:`${z}__item-text`,mediaItemTitle:`${z}__item-title`,mediaItemCaption:`${z}__item-caption`,mediaNavigation:`${z}__item-navigation`,mediaPagination:`${z}__pagination`,mediaPaginationText:`${z}__pagination-text`,mediaPrevious:`${z}__previous`,mediaPreviousIconLTR:`${z}__previous-icon`,mediaPreviousIconRTL:`${z}__previous-icon--rtl`,mediaNext:`${z}__next`,mediaNextIconLTR:`${z}__next-icon`,mediaNextIconRTL:`${z}__next-icon--rtl`,mediaChart:`${z}__chart`,mediaPaginationButton:`${z}__pagination-button`,mediaPaginationIcon:`${z}__pagination-icon`,mediaChartRendered:`${z}__chart--rendered`},ci=15,ke="category",st="value",_r="rgba(50, 50, 50, 1)",wr=250,br=500,Fr=200,K=class extends S{constructor(e,t){super(e,t),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this._chartRootMap=new WeakMap,this.viewModel=new ge,this.messages=null,this._disposeChart=i=>{this._chartRootMap.get(i)?.dispose(),this._chartRootMap.delete(i)},this._createChart=i=>g(this,null,function*(){let{destroyed:o,viewModel:n}=this;if(o||!n||!i)return;let{createRoot:a}=yield import("./chunk-LFVMASJN.js"),l=yield a(i);this._chartRootMap.set(i,l),this._renderChart({mediaInfo:n.activeMediaInfo,root:l})})}initialize(){this._featureElementInfo=new Ee,this.addHandles([f(()=>[this.viewModel?.activeMediaInfo,this.viewModel?.activeMediaInfoIndex],()=>this._setupMediaRefreshTimer(),I),f(()=>[this.viewModel?.description,this.viewModel?.title],()=>this._setupFeatureElementInfo(),I)])}loadDependencies(){return ee({icon:()=>import("./chunk-4HUBSTEF.js")})}destroy(){this._clearMediaRefreshTimer(),this._featureElementInfo?.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get activeMediaInfoIndex(){return this.viewModel.activeMediaInfoIndex}set activeMediaInfoIndex(e){this.viewModel.activeMediaInfoIndex=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get fieldInfoMap(){return this.viewModel.fieldInfoMap}set fieldInfoMap(e){this.viewModel.fieldInfoMap=e}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get mediaInfos(){return this.viewModel.mediaInfos}set mediaInfos(e){this.viewModel.mediaInfos=e}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(e){this.viewModel.popupTemplate=e}get relatedInfos(){return this.viewModel.relatedInfos}set relatedInfos(e){this.viewModel.relatedInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){return c("div",{bind:this,class:Y.base,onkeyup:this._handleMediaKeyup},this._featureElementInfo?.render(),this._renderMedia())}_renderMedia(){let{formattedMediaInfoCount:e,activeMediaInfoIndex:t}=this.viewModel,i=this._renderMediaText();return e?c("div",{class:Y.mediaContainer,key:"media-element-container"},this._renderMediaInfo(),c("div",{class:Y.mediaNavigation},i,e>1?c("div",{class:Y.mediaPagination},this._renderMediaPageButton("previous"),c("span",{class:Y.mediaPaginationText},G(this.messages.pageText,{index:t+1,total:e})),this._renderMediaPageButton("next")):null)):null}_renderMediaText(){let{activeMediaInfo:e}=this.viewModel;if(!e)return null;let t=e&&e.title?c("div",{class:Y.mediaItemTitle,innerHTML:e.title,key:"media-title"}):null,i=e&&e.caption?c("div",{class:Y.mediaItemCaption,innerHTML:e.caption,key:"media-caption"}):null;return t||i?c("div",{class:Y.mediaItemText,key:"media-text"},t,i):null}_renderImageMediaInfo(e){if(!e.value)return null;let{_refreshIntervalInfo:t}=this,{activeMediaInfoIndex:i,formattedMediaInfoCount:o}=this.viewModel,{value:n,refreshInterval:a,altText:l,title:d,type:u}=e,{sourceURL:p,linkURL:h}=n,m=Mt(h??void 0)?"_blank":"_self",v=m==="_blank"?"noreferrer":"",y=a?t:null,b=y?y.timestamp:0,T=y?y.sourceURL:p,R=c("img",{alt:l||d,key:`media-${u}-${i}-${o}-${b}`,src:T??void 0});return(h?c("a",{href:h,rel:v,target:m,title:d},R):null)??R}_renderChartMediaInfo(e){let{activeMediaInfoIndex:t,formattedMediaInfoCount:i}=this.viewModel;return c("div",{afterCreate:this._createChart,afterRemoved:this._disposeChart,bind:this,class:Y.mediaChart,key:`media-${e.type}-${t}-${i}`})}_renderMediaInfoType(){let{activeMediaInfo:e}=this.viewModel;return e?e.type==="image"?this._renderImageMediaInfo(e):e.type.includes("chart")?this._renderChartMediaInfo(e):null:null}_renderMediaInfo(){let{activeMediaInfo:e}=this.viewModel;return e?c("div",{class:Y.mediaItemContainer,key:"media-container"},c("div",{class:Y.mediaItem,key:"media-item-container"},this._renderMediaInfoType())):null}_renderMediaPageButton(e){if(this.viewModel.formattedMediaInfoCount<2)return null;let t=e==="previous",i=t?this.messages.previous:this.messages.next,o=t?"chevron-left":"chevron-right",n=t?"media-previous":"media-next",a=t?this._previous:this._next;return c("button",{"aria-label":i,bind:this,class:Y.mediaPaginationButton,key:n,onclick:a,tabIndex:0,title:i,type:"button"},c("calcite-icon",{class:Y.mediaPaginationIcon,icon:o,scale:"s"}))}_setupFeatureElementInfo(){let{description:e,title:t}=this;this._featureElementInfo?.set({description:e,title:t})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}_getRenderer(){if(!this.viewModel)return;let{isAggregate:e,layer:t}=this.viewModel;return e&&t?.featureReduction&&"renderer"in t.featureReduction?t.featureReduction.renderer:t?.renderer}_getSeriesColors(e){return g(this,null,function*(){let{colorAm5:t}=yield import("./chunk-MWEP4TID.js"),i=new Map;return e.forEach(o=>{o.color&&i.set(o,t(o.color.toCss(!0)))}),i})}_getRendererColors(){return g(this,null,function*(){let{colorAm5:e}=yield import("./chunk-MWEP4TID.js"),t=new Map,i=this._getRenderer(),o="default";if(!i)return t;let n=yield po(i);return n.delete(o),Array.from(n.values()).every(a=>a?.length===1)&&Array.from(n.keys()).forEach(a=>{let l=n.get(a)?.[0]?.toCss(!0);l&&t.set(a,e(l))}),t})}_handleMediaKeyup(e){let{key:t}=e;t==="ArrowLeft"&&(e.stopPropagation(),this.viewModel.previous()),t==="ArrowRight"&&(e.stopPropagation(),this.viewModel.next())}_canAnimateChart(){return!!this.viewModel&&!!this.viewModel.abilities.chartAnimation&&!uo()}_getChartAnimationMS(){return this._canAnimateChart()?wr:0}_getChartSeriesAnimationMS(){return this._canAnimateChart()?br:0}_renderChart(e){return g(this,null,function*(){let{root:t,mediaInfo:i}=e,{value:o,type:n}=i,{ResponsiveThemeAm5:a,DarkThemeAm5:l,AnimatedThemeAm5:d,ColorSetAm5:u,ThemeAm5:p,esriChartColorSet:h}=yield import("./chunk-MWEP4TID.js"),m=p.new(t);m.rule("ColorSet").set("colors",h),m.rule("ColorSet").set("reuse",!0);let v=[a.new(t),m];Oi()&&v.push(l.new(t)),this._canAnimateChart()&&v.push(d.new(t)),t.setThemes(v);let y=yield this._getRendererColors(),b=yield this._getSeriesColors(o.series),T=u.new(t,{}),R=b.get(o.series[0]),A=R?{lineSettings:{stroke:R}}:void 0,O=o.series.map(($,ae)=>{let _e=b.get($)||y.get($.fieldName)||T.getIndex(ae);return _({[ke]:$.tooltip,[st]:$.value,columnSettings:{fill:_e,stroke:_e}},A)}).filter($=>n!=="pie-chart"||$.value!=null&&$.value>0);n==="pie-chart"?this._createPieChart(e,O):this._createXYChart(e,O)})}_getDirection(){return le(this.container)?"rtl":"ltr"}_isInversed(){return!!le(this.container)}_customizeChartTooltip(e,t="horizontal"){return g(this,null,function*(){let{colorAm5:i}=yield import("./chunk-MWEP4TID.js");e.setAll({pointerOrientation:t}),e.get("background")?.setAll({stroke:i(_r)}),e.label.setAll({direction:this._getDirection(),oversizedBehavior:"wrap",maxWidth:Fr})})}_createPieChart(e,t){return g(this,null,function*(){let{TooltipAm5:i}=yield import("./chunk-MWEP4TID.js"),{PieChartAm5:o,PieSeriesAm5:n}=yield import("./chunk-HLLRM4ET.js"),{mediaInfo:a,root:l}=e,{title:d}=a,u=5,p=a?.altText||a?.title||"",h=l.container.children.push(o.new(l,{ariaLabel:p,focusable:!0,paddingBottom:u,paddingTop:u,paddingLeft:u,paddingRight:u})),m=`{category}: {valuePercentTotal.formatNumber('0.00')}%
 ({value})`,v=i.new(l,{labelText:m}),y=h.series.push(n.new(l,{name:d,valueField:st,categoryField:ke,tooltip:v}));y.ticks.template.set("forceHidden",!0),y.labels.template.set("forceHidden",!0),y.slices.template.states.create("active",{shiftRadius:u}),this._customizeChartTooltip(v),y.slices.template.setAll({ariaLabel:m,focusable:!0,templateField:"columnSettings"}),y.data.setAll(t),y.appear(this._getChartSeriesAnimationMS()),h.appear(this._getChartAnimationMS()),h.root.dom.classList.toggle(Y.mediaChartRendered,!0)})}_getMinSeriesValue(e){let t=0;return e.forEach(i=>t=Math.min(i.value,t)),t}_createColumnChart(e,t,i){return g(this,null,function*(){let{TooltipAm5:o,ScrollbarAm5:n}=yield import("./chunk-MWEP4TID.js"),{CategoryAxisAm5:a,AxisRendererXAm5:l,ValueAxisAm5:d,AxisRendererYAm5:u,ColumnSeriesAm5:p}=yield import("./chunk-DSI5SC6Z.js"),{mediaInfo:h,root:m}=t,{value:v,title:y}=h;e.setAll({wheelX:"panX",wheelY:"zoomX"});let b=e.xAxes.push(a.new(m,{renderer:l.new(m,{inversed:this._isInversed()}),categoryField:ke}));b.get("renderer").labels.template.setAll({forceHidden:!0});let T=e.yAxes.push(d.new(m,{renderer:u.new(m,{inside:!1}),min:this._getMinSeriesValue(v.series)}));T.get("renderer").labels.template.setAll({direction:this._getDirection()});let R="{categoryX}",A=o.new(m,{labelText:R}),O=e.series.push(p.new(m,{name:y,xAxis:b,yAxis:T,valueYField:st,categoryXField:ke,tooltip:A}));this._customizeChartTooltip(A),O.columns.template.setAll({ariaLabel:R,focusable:!0,templateField:"columnSettings"}),v.series.length>ci&&e.set("scrollbarX",n.new(m,{orientation:"horizontal"})),b.data.setAll(i),O.data.setAll(i),O.appear(this._getChartSeriesAnimationMS()),e.appear(this._getChartAnimationMS())})}_createBarChart(e,t,i){return g(this,null,function*(){let{TooltipAm5:o,ScrollbarAm5:n}=yield import("./chunk-MWEP4TID.js"),{CategoryAxisAm5:a,AxisRendererXAm5:l,ValueAxisAm5:d,AxisRendererYAm5:u,ColumnSeriesAm5:p}=yield import("./chunk-DSI5SC6Z.js"),{mediaInfo:h,root:m}=t,{value:v,title:y}=h;e.setAll({wheelX:"panY",wheelY:"zoomY"});let b=e.yAxes.push(a.new(m,{renderer:u.new(m,{inversed:!0}),categoryField:ke}));b.get("renderer").labels.template.setAll({forceHidden:!0});let T=e.xAxes.push(d.new(m,{renderer:l.new(m,{inside:!1,inversed:this._isInversed()}),min:this._getMinSeriesValue(v.series)}));T.get("renderer").labels.template.setAll({direction:this._getDirection()});let R="{categoryY}",A=o.new(m,{labelText:R}),O=e.series.push(p.new(m,{name:y,xAxis:T,yAxis:b,valueXField:st,categoryYField:ke,tooltip:A}));this._customizeChartTooltip(A,"vertical"),O.columns.template.setAll({ariaLabel:R,focusable:!0,templateField:"columnSettings"}),v.series.length>ci&&e.set("scrollbarY",n.new(m,{orientation:"vertical"})),b.data.setAll(i),O.data.setAll(i),O.appear(this._getChartSeriesAnimationMS()),e.appear(this._getChartAnimationMS())})}_createLineChart(e,t,i){return g(this,null,function*(){let{TooltipAm5:o,ScrollbarAm5:n}=yield import("./chunk-MWEP4TID.js"),{CategoryAxisAm5:a,AxisRendererXAm5:l,ValueAxisAm5:d,AxisRendererYAm5:u,LineSeriesAm5:p}=yield import("./chunk-DSI5SC6Z.js"),{root:h,mediaInfo:m}=t,{value:v,title:y}=m;e.setAll({wheelX:"panX",wheelY:"zoomX"});let b=e.xAxes.push(a.new(h,{renderer:l.new(h,{inversed:this._isInversed()}),categoryField:ke}));b.get("renderer").labels.template.setAll({forceHidden:!0});let T=e.yAxes.push(d.new(h,{renderer:u.new(h,{inside:!1}),min:this._getMinSeriesValue(v.series)}));T.get("renderer").labels.template.setAll({direction:this._getDirection()});let R="{categoryX}",A=i[0]?.lineSettings?.stroke,O=o.new(h,{getFillFromSprite:!A,labelText:R});A&&O.get("background")?.setAll({fill:A});let $=e.series.push(p.new(h,{name:y,xAxis:b,yAxis:T,valueYField:st,categoryXField:ke,tooltip:O}));$.strokes.template.setAll({templateField:"lineSettings"}),this._customizeChartTooltip(O,"vertical"),v.series.length>ci&&e.set("scrollbarX",n.new(h,{orientation:"horizontal"})),b.data.setAll(i),$.data.setAll(i),$.appear(this._getChartSeriesAnimationMS()),e.appear(this._getChartAnimationMS())})}_createXYChart(e,t){return g(this,null,function*(){let{XYChartAm5:i,XYCursorAm5:o}=yield import("./chunk-DSI5SC6Z.js"),{root:n,mediaInfo:a}=e,{type:l}=a,d=a?.altText||a?.title||"",u=n.container.children.push(i.new(n,{ariaLabel:d,focusable:!0,panX:!0,panY:!0}));u.set("cursor",o.new(n,{})),l==="column-chart"&&(yield this._createColumnChart(u,e,t)),l==="bar-chart"&&(yield this._createBarChart(u,e,t)),l==="line-chart"&&(yield this._createLineChart(u,e,t)),u.root.dom.classList.toggle(Y.mediaChartRendered,!0)})}_clearMediaRefreshTimer(){let{_refreshTimer:e}=this;e&&(clearTimeout(e),this._refreshTimer=null)}_updateMediaInfoTimestamp(e){let t=Date.now();this._refreshIntervalInfo={timestamp:t,sourceURL:e&&this._getImageSource(e,t)}}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();let{activeMediaInfo:e}=this.viewModel;e?.type==="image"&&e?.refreshInterval>0&&this._setRefreshTimeout(e)}_setRefreshTimeout(e){let{refreshInterval:t,value:i}=e,o=6e4*t;this._updateMediaInfoTimestamp(i.sourceURL);let n=setInterval(()=>{this._updateMediaInfoTimestamp(i.sourceURL)},o);this._refreshTimer=n}_getImageSource(e,t){let i=e.includes("?")?"&":"?",[o,n=""]=e.split("#");return`${o}${i}timestamp=${t}${n?"#":""}${n}`}};r([s()],K.prototype,"_refreshIntervalInfo",void 0),r([s()],K.prototype,"attributes",null),r([s()],K.prototype,"activeMediaInfoIndex",null),r([s()],K.prototype,"description",null),r([s()],K.prototype,"fieldInfoMap",null),r([s()],K.prototype,"layer",null),r([s()],K.prototype,"mediaInfos",null),r([s()],K.prototype,"popupTemplate",null),r([s()],K.prototype,"relatedInfos",null),r([s()],K.prototype,"title",null),r([s({type:ge})],K.prototype,"viewModel",void 0),r([s(),W("esri/widgets/Feature/t9n/Feature")],K.prototype,"messages",void 0),K=r([w("esri.widgets.Feature.FeatureMedia")],K);var Ot=K;var Mr="esri.widgets.Feature.support.arcadeFeatureUtils",Ro=()=>B.getLogger(Mr);function Ir(e){return typeof e=="string"?xt(At(e)):Array.isArray(e)?Cr(e):e?.declaredClass==="esri.arcade.Dictionary"?Ar(e):e}function Cr(e){return`<ul class="esri-widget__list">${e.map(t=>`<li>${typeof t=="string"?xt(At(t)):t}</li>`).join("")}</ul>`}function Ar(e){let t=e.keys().map(i=>{let o=e.field(i);return`<tr><th>${i}</th><td>${typeof o=="string"?xt(At(o)):o}</td></tr>`}).join("");return`<table class="${M.table}">${t}</table>`}function ui(){return import("./chunk-UWMIKOUF.js")}function xr(e){return"createQuery"in e&&"queryFeatures"in e}function Er(o){return g(this,arguments,function*({graphic:e,view:t,options:i}){let{isAggregate:n,layer:a}=e;if(!n||!a||t?.type!=="2d")return[];let l=yield t.whenLayerView(a);if(!xr(l))return[];let d=l.createQuery(),u=e.getObjectId();d.aggregateIds=u!=null?[u]:[];let{features:p}=yield l.queryFeatures(d,i);return p})}function Tr({layer:e,aggregatedFeatures:t,interceptor:i}){let{fields:o,objectIdField:n,geometryType:a,spatialReference:l,displayField:d}=e;return new Xi(Xe(_({fields:o,objectIdField:n,geometryType:a,spatialReference:l,displayField:d,interceptor:i},e.type==="feature"?{templates:e.templates,typeIdField:e.typeIdField,types:e.types}:null),{source:t}))}function pi(p){return g(this,arguments,function*({expressionInfo:e,arcade:t,interceptor:i,spatialReference:o,map:n,graphic:a,location:l,view:d,options:u}){if(!e?.expression)return null;let{isAggregate:h}=a,m=(a.sourceLayer||a.layer)??void 0,v=h?"feature-reduction-popup":"popup",y=t.createArcadeProfile(v),b=t.createArcadeExecutor(e.expression,y).catch(ae=>Ro().error("arcade-executor-error",{error:ae,expressionInfo:e})),[T,R]=yield Promise.all([Er({graphic:a,view:d,options:u}),b]);if(!R)return null;let A=v==="feature-reduction-popup"?Tr({layer:m,aggregatedFeatures:T,interceptor:i}):void 0,O=Xe(_({},v==="feature-reduction-popup"?{$aggregatedFeatures:A}:{$datastore:m?.url,$layer:m?.type==="feature"||m?.type==="subtype-sublayer"||m?.type==="catalog-footprint"||m?.type==="oriented-imagery"?m:m?.type==="scene"&&m.associatedLayer!=null?m.associatedLayer:void 0,$map:n,$userInput:l,$graph:m?.type==="knowledge-graph-sublayer"?m?.parentCompositeLayer?.knowledgeGraph:void 0}),{$feature:a}),$={abortSignal:u?.signal??void 0,interceptor:i??void 0,rawOutput:!0,spatialReference:o??void 0,timeZone:d?.timeZone};return yield R.executeAsync(O,$).catch(ae=>Ro().error("arcade-execution-error",{error:ae,graphic:a,expressionInfo:e})).finally(()=>A?.destroy())})}function Po(u){return g(this,arguments,function*({expressionInfos:e,spatialReference:t,graphic:i,interceptor:o,map:n,view:a,location:l,options:d}){if(!e?.length)return{};let p=yield ui(),h={};for(let y of e)h[`expression/${y.name}`]=pi({expressionInfo:y,arcade:p,interceptor:o,spatialReference:t,map:n,graphic:i,location:l,view:a,options:d});let m=yield pe(h),v={};for(let y in m)v[y]=Ir(m[y].value);return v})}var kr=1,ie=class extends U{constructor(e){super(e),this._abortController=null,this.expressionInfo=null,this.graphic=null,this.contentElement=null,this.contentElementViewModel=null,this.interceptor=null,this.location=null,this.view=null,this._cancelQuery=()=>{let{_abortController:t}=this;t&&t.abort(),this._abortController=null},this._createVM=()=>{let t=this.contentElement?.type;this.contentElementViewModel?.destroy();let i=t==="fields"?new Se:t==="media"?new ge:t==="text"?new $e:null;this._set("contentElementViewModel",i)},this._compile=()=>g(this,null,function*(){this._cancelQuery();let t=new AbortController;this._abortController=t,yield this._compileExpression(),this._abortController===t&&(this._abortController=null)}),this._compileThrottled=Ne(this._compile,kr,this),this._compileExpression=()=>g(this,null,function*(){let{expressionInfo:t,graphic:i,interceptor:o,spatialReference:n,map:a,location:l,view:d,_abortController:u}=this;if(!t||!i)return void this._set("contentElement",null);let p=yield ui();if(u!==this._abortController)return;let h=yield pi({arcade:p,expressionInfo:t,graphic:i,location:l,interceptor:o,map:a,spatialReference:n,view:d});if(!h||h.declaredClass!=="esri.arcade.Dictionary")return void this._set("contentElement",null);let m=yield h.castAsJsonAsync(u?.signal),v=m?.type,y=v==="media"?Ui.fromJSON(m):v==="text"?wt.fromJSON(m):v==="fields"?Hi.fromJSON(m):null;this._set("contentElement",y)}),this.addHandles([f(()=>[this.expressionInfo,this.graphic,this.map,this.spatialReference,this.view],()=>this._compileThrottled(),I),f(()=>[this.contentElement],()=>this._createVM(),I)])}initialize(){this.addHandles(this._compileThrottled)}destroy(){this._cancelQuery(),this.contentElementViewModel?.destroy(),this._set("contentElementViewModel",null),this._set("contentElement",null)}get spatialReference(){return this.view?.spatialReference??null}set spatialReference(e){this._override("spatialReference",e)}get state(){let{_abortController:e,contentElement:t,contentElementViewModel:i}=this;return e?"loading":t||i?"ready":"disabled"}get map(){return this.view?.map??null}set map(e){this._override("map",e)}};r([s()],ie.prototype,"_abortController",void 0),r([s({type:zi})],ie.prototype,"expressionInfo",void 0),r([s({type:ne})],ie.prototype,"graphic",void 0),r([s({readOnly:!0})],ie.prototype,"contentElement",void 0),r([s({readOnly:!0})],ie.prototype,"contentElementViewModel",void 0),r([s()],ie.prototype,"interceptor",void 0),r([s({type:ze})],ie.prototype,"location",void 0),r([s()],ie.prototype,"spatialReference",null),r([s({readOnly:!0})],ie.prototype,"state",null),r([s()],ie.prototype,"map",null),r([s()],ie.prototype,"view",void 0),ie=r([w("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],ie);var nt=ie;var Oo="esri-feature",No={base:`${Oo}-expression`,loadingSpinnerContainer:`${Oo}__loading-container`},Nt=class extends S{constructor(e,t){super(e,t),this._contentWidget=null,this.viewModel=new nt}initialize(){this.addHandles(f(()=>this.viewModel?.contentElementViewModel,()=>this._setupExpressionWidget(),I))}loadDependencies(){return ee({loader:()=>import("./chunk-F63PXXTQ.js")})}destroy(){this._destroyContentWidget()}render(){let{state:e}=this.viewModel;return c("div",{class:No.base},e==="loading"?this._renderLoading():e==="disabled"?null:this._contentWidget?.render())}_renderLoading(){return c("div",{class:No.loadingSpinnerContainer,key:"loading-container"},c("calcite-loader",{inline:!0,label:""}))}_destroyContentWidget(){let{_contentWidget:e}=this;e&&(e.viewModel=null,e.destroy()),this._contentWidget=null}_setupExpressionWidget(){let{contentElementViewModel:e,contentElement:t}=this.viewModel,i=t?.type;this._destroyContentWidget();let o=e?i==="fields"?new Pt({viewModel:e}):i==="media"?new Ot({viewModel:e}):i==="text"?new Qe({viewModel:e}):null:null;this._contentWidget=o,this.scheduleRender()}};r([s({type:nt})],Nt.prototype,"viewModel",void 0),Nt=r([w("esri.widgets.Feature.FeatureExpression")],Nt);var $o=Nt;var So;(function(e){e.TOO_SHORT="length-validation-error::too-short",e.TOO_LONG="length-validation-error::too-long"})(So||(So={}));var Vo=e=>{let t=[];if(e.formTemplate){let{description:i,title:o}=e.formTemplate;e.fields?.forEach(n=>{let a=o&&Ut(o,n.name),l=i&&Ut(i,n.name);(a||l)&&t.push(n.name)})}return t};var hi=100,P=class extends Di(yt(U)){constructor(e){super(e),this._loaded=!1,this._queryAbortController=null,this._queryPageAbortController=null,this._queryFeatureCountAbortController=null,this.featuresPerPage=10,this.description=null,this.graphic=null,this.layer=null,this.map=null,this.orderByFields=null,this.featureCount=0,this.relationshipId=null,this.showAllEnabled=!1,this.title=null,this._cancelQuery=()=>{let{_queryAbortController:t}=this;t&&t.abort(),this._queryAbortController=null},this._cancelQueryFeatureCount=()=>{let{_queryFeatureCountAbortController:t}=this;t&&t.abort(),this._queryFeatureCountAbortController=null},this._cancelQueryPage=()=>{let{_queryPageAbortController:t}=this;t&&t.abort(),this._queryPageAbortController=null},this._queryController=()=>g(this,null,function*(){this._cancelQuery();let t=new AbortController;this._queryAbortController=t,yield mt(this._query()),this._queryAbortController===t&&(this._queryAbortController=null)}),this._queryFeatureCountController=()=>g(this,null,function*(){this._loaded=!1,this._cancelQueryFeatureCount();let t=new AbortController;this._queryFeatureCountAbortController=t,yield mt(this._queryFeatureCount()),this._queryFeatureCountAbortController===t&&(this._queryFeatureCountAbortController=null),this._loaded=!0}),this._queryPageController=()=>g(this,null,function*(){let t=new AbortController;this._queryPageAbortController=t,yield mt(this._queryPage()),this._queryPageAbortController===t&&(this._queryPageAbortController=null)}),this._queryDebounced=qe(this._queryController,hi),this._queryFeatureCountDebounced=qe(this._queryFeatureCountController,hi),this._queryPageDebounced=qe(this._queryPageController,hi),this._query=()=>g(this,null,function*(){let{_queryAbortController:t,relatedFeatures:i}=this;this.featureCount&&(this._destroyRelatedFeatureViewModels(),this.featurePage=1,i.destroyAll(),this.destroyed||i.addMany(this._sliceFeatures(yield this._queryRelatedFeatures({signal:t?.signal}))))}),this.addHandles([f(()=>[this.displayCount,this.graphic,this.layer,this.layer?.loaded,this.map,this.orderByFields,this.relationshipId,this.featuresPerPage,this.showAllEnabled,this.canQuery,this.featureCount],()=>this._queryDebounced(),I),f(()=>[this.featurePage,this.showAllEnabled],()=>this._queryPageDebounced()),f(()=>[this.layer,this.relationshipId,this.objectId,this.canQuery],()=>this._queryFeatureCountDebounced())])}destroy(){this._destroyRelatedFeatureViewModels(),this.relatedFeatures.destroyAll(),this._cancelQuery(),this._cancelQueryFeatureCount(),this._cancelQueryPage()}set featurePage(e){let{featuresPerPage:t,featureCount:i}=this,o=1,n=Math.ceil(i/t)||1;this._set("featurePage",Math.min(Math.max(e,o),n))}get featurePage(){return this._get("featurePage")}get orderByFieldsFixedCasing(){let{orderByFields:e,relatedLayer:t}=this;return e&&t?.loaded?e.map(i=>{let o=i.clone();return o.field=et(i.field,t),o}):e??[]}get supportsCacheHint(){return!!this.layer?.capabilities?.queryRelated?.supportsCacheHint}get canLoad(){return!!this.map&&this.relationshipId!=null&&typeof this.objectId=="number"}get canQuery(){let e=this.layer?.capabilities?.queryRelated;return!!(this.relatedLayer&&this.relationship&&this.relationshipId!=null&&this.objectId!=null&&e?.supportsCount&&e?.supportsPagination)}get itemDescriptionFieldName(){return this.orderByFieldsFixedCasing[0]?.field||null}set displayCount(e){this._set("displayCount",Math.min(Math.max(e,0),10))}get displayCount(){return this._get("displayCount")}get objectId(){return(this.objectIdField&&this.graphic?.attributes?.[this.objectIdField])??null}get objectIdField(){return this.layer?.objectIdField||null}get relatedFeatures(){return this._get("relatedFeatures")||new he}get relatedLayer(){let{layer:e,map:t,relationship:i}=this;return e?.loaded&&t&&i?lo(t,e,i)??null:null}get relationship(){let{relationshipId:e,layer:t}=this;return e!=null?t?.relationships?.find(({id:i})=>i===e)??null:null}get relatedFeatureViewModels(){return this._get("relatedFeatureViewModels")||new he}get state(){let{_queryAbortController:e,_queryFeatureCountAbortController:t,_queryPageAbortController:i,canQuery:o,_loaded:n,canLoad:a}=this;return t||a&&!n?"loading":e||i?"querying":o?"ready":"disabled"}getRelatedFeatureByObjectId(e){return this.relatedFeatures.find(t=>t.getObjectId()===e)}refresh(){this._queryFeatureCountDebounced()}_destroyRelatedFeatureViewModels(){this.relatedFeatureViewModels?.destroyAll()}_queryFeatureCount(){return g(this,null,function*(){let{layer:e,relatedLayer:t,relationshipId:i,objectId:o,_queryFeatureCountAbortController:n,canQuery:a,supportsCacheHint:l}=this;if(yield e?.load(),yield t?.load(),!a||!e||!t||o==null)return void this._set("featureCount",0);let d=t.createQuery(),{historicMoment:u,gdbVersion:p}=e,h=new Je({cacheHint:l,gdbVersion:p,historicMoment:u,relationshipId:i,returnGeometry:!1,objectIds:[o],where:d.where??void 0}),m=yield e.queryRelatedFeaturesCount(h,{signal:n?.signal});this._set("featureCount",m[o]||0)})}_sliceFeatures(e){let{showAllEnabled:t,displayCount:i}=this;return t?e:i?e.slice(0,i):[]}_queryPage(){return g(this,null,function*(){let{relatedFeatures:e,featurePage:t,showAllEnabled:i,_queryPageAbortController:o,featureCount:n}=this;!i||t<2||!n||e.addMany(yield this._queryRelatedFeatures({signal:o?.signal}))})}_queryRelatedFeatures(e){return g(this,null,function*(){let{orderByFieldsFixedCasing:t,showAllEnabled:i,featuresPerPage:o,displayCount:n,layer:a,relationshipId:l,featurePage:d,featureCount:u,relatedLayer:p,supportsCacheHint:h}=this,{canQuery:m,objectId:v}=this;if(!m||!a||!p||v==null)return[];let y=i?((d-1)*o+u)%u:0,b=i?o:n,T=p.objectIdField,R=[...t.map(we=>we.field),...Vo(p),T].filter(be),A=t.map(we=>`${we.field} ${we.order}`),O=p.createQuery(),{historicMoment:$,gdbVersion:ae}=a,_e=new Je({orderByFields:A,start:y,num:b,outFields:R,cacheHint:h,historicMoment:$,gdbVersion:ae,relationshipId:l,returnGeometry:!1,objectIds:[v],where:O.where??void 0}),Ae=yield a.queryRelatedFeatures(_e,{signal:e?.signal}),pt=Ae[v]?.features||[];return pt.forEach(we=>{we.sourceLayer=p,we.layer=p}),pt})}};r([s()],P.prototype,"_loaded",void 0),r([s()],P.prototype,"_queryAbortController",void 0),r([s()],P.prototype,"_queryPageAbortController",void 0),r([s()],P.prototype,"_queryFeatureCountAbortController",void 0),r([s({value:1})],P.prototype,"featurePage",null),r([s()],P.prototype,"featuresPerPage",void 0),r([s({readOnly:!0})],P.prototype,"orderByFieldsFixedCasing",null),r([s({readOnly:!0})],P.prototype,"supportsCacheHint",null),r([s({readOnly:!0})],P.prototype,"canLoad",null),r([s({readOnly:!0})],P.prototype,"canQuery",null),r([s()],P.prototype,"description",void 0),r([s({readOnly:!0})],P.prototype,"itemDescriptionFieldName",null),r([s({value:3})],P.prototype,"displayCount",null),r([s({type:ne})],P.prototype,"graphic",void 0),r([s()],P.prototype,"layer",void 0),r([s()],P.prototype,"map",void 0),r([s({readOnly:!0})],P.prototype,"objectId",null),r([s({readOnly:!0})],P.prototype,"objectIdField",null),r([s()],P.prototype,"orderByFields",void 0),r([s({readOnly:!0})],P.prototype,"relatedFeatures",null),r([s({readOnly:!0})],P.prototype,"relatedLayer",null),r([s({readOnly:!0})],P.prototype,"relationship",null),r([s()],P.prototype,"featureCount",void 0),r([s({readOnly:!0})],P.prototype,"relatedFeatureViewModels",null),r([s()],P.prototype,"relationshipId",void 0),r([s()],P.prototype,"showAllEnabled",void 0),r([s()],P.prototype,"state",null),r([s()],P.prototype,"title",void 0),P=r([w("esri.widgets.Feature.FeatureRelationship.FeatureRelationshipViewModel")],P);var at=P;var $t="esri-feature",lt=`${$t}-relationship`,Le={base:lt,listContainer:`${lt}__list`,listItem:`${lt}__list-item`,listItemHidden:`${lt}__list-item--hidden`,listContainerQuerying:`${lt}__list--querying`,featureObserver:`${$t}__feature-observer`,stickySpinnerContainer:`${$t}__sticky-loading-container`,loadingSpinnerContainer:`${$t}__loading-container`},Bo={title:!0,description:!0},J=class extends S{constructor(e,t){super(e,t),this._featureElementInfo=null,this._relatedFeatureIntersectionObserverNode=null,this._relatedFeatureIntersectionObserver=new IntersectionObserver(([i])=>{i?.isIntersecting&&this._increaseFeaturePage()},{root:window.document}),this.headingLevel=2,this.viewModel=new at,this.messages=null,this.messagesCommon=null,this.visibleElements=_({},Bo),this._increaseFeaturePage=()=>{let{state:i,showAllEnabled:o,relatedFeatures:n,featuresPerPage:a,featurePage:l}=this.viewModel;i==="ready"&&o&&n.length>=a*l&&this.viewModel.featurePage++}}initialize(){this._featureElementInfo=new Ee,this.addHandles([f(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),I),f(()=>[this.viewModel.state,this.viewModel.showAllEnabled,this._relatedFeatureIntersectionObserverNode],()=>this._handleRelatedFeatureObserverChange()),re(()=>this.viewModel.relatedFeatureViewModels,"change",()=>this._setupRelatedFeatureViewModels())])}loadDependencies(){return ee({icon:()=>import("./chunk-4HUBSTEF.js"),list:()=>import("./chunk-DB7XGNRL.js"),"list-item":()=>import("./chunk-4FFGJW4G.js"),loader:()=>import("./chunk-F63PXXTQ.js"),notice:()=>import("./chunk-PB4EE5XH.js")})}destroy(){this._unobserveRelatedFeatureObserver(),this._featureElementInfo=Ai(this._featureElementInfo)}get displayShowAllButton(){let{showAllEnabled:e,featureCount:t,displayCount:i,state:o}=this.viewModel;return!e&&!!t&&o==="ready"&&(t>i||i===0)}get displayListItems(){return this.displayShowAllButton||this.viewModel.relatedFeatureViewModels.length>0}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get featureCountDescription(){let{messages:e}=this,{featureCount:t}=this.viewModel;return G(e?.numberRecords,{number:t})}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}castVisibleElements(e){return _(_({},Bo),e)}render(){let{state:e}=this.viewModel;return c("div",{class:this.classes(Le.base,M.widget)},this._featureElementInfo?.render(),e==="loading"?this._renderLoading():e==="disabled"?this._renderRelationshipNotFound():this._renderRelatedFeatures())}_renderStickyLoading(){return this.viewModel.state==="querying"?c("div",{class:Le.stickySpinnerContainer,key:"sticky-loader"},this._renderLoadingIcon()):null}_renderLoadingIcon(){return c("calcite-loader",{inline:!0,label:""})}_renderLoading(){return c("div",{class:Le.loadingSpinnerContainer,key:"loading-container"},this._renderLoadingIcon())}_renderShowAllIconNode(){return c("calcite-icon",{icon:"list",scale:"s",slot:"content-end"})}_renderChevronIconNode(){let e=le(this.container)?"chevron-left":"chevron-right";return c("calcite-icon",{icon:e,scale:"s",slot:"content-end"})}_renderRelatedFeature(e){let{itemDescriptionFieldName:t}=this.viewModel,i=e.title;e.description=t&&e.formattedAttributes?.global[t];let o=e.state==="loading";return c("calcite-list-item",{class:this.classes(Le.listItem,{[Le.listItemHidden]:o}),description:e.description??"",key:e.uid,label:i,onCalciteListItemSelect:()=>this.emit("select-record",{featureViewModel:e})},this._renderChevronIconNode())}_renderShowAllListItem(){return this.displayShowAllButton?c("calcite-list-item",{description:this.featureCountDescription,key:"show-all-item",label:this.messages?.showAll,onCalciteListItemSelect:()=>this.emit("show-all-records")},this._renderShowAllIconNode()):null}_renderNoRelatedFeaturesMessage(){return c("calcite-notice",{icon:"information",key:"no-related-features-message",kind:"brand",open:!0,scale:"s",width:"full"},c("div",{slot:"message"},this.messages?.noRelatedFeatures))}_renderFeatureObserver(){return c("div",{afterCreate:this._relatedFeatureIntersectionObserverCreated,bind:this,class:Le.featureObserver,key:"feature-observer"})}_renderList(){let{relatedFeatureViewModels:e}=this.viewModel;return c("calcite-list",null,e.toArray().map(t=>this._renderRelatedFeature(t)),this._renderShowAllListItem())}_renderRelatedFeatures(){let{displayListItems:e}=this,{state:t}=this.viewModel;return c("div",{class:this.classes(Le.listContainer,{[Le.listContainerQuerying]:t==="querying"}),key:"list-container"},e?this._renderList():t==="ready"?this._renderNoRelatedFeaturesMessage():null,this._renderStickyLoading(),this._renderFeatureObserver())}_renderRelationshipNotFound(){return c("calcite-notice",{icon:"exclamation-mark-triangle",key:"relationship-not-found",kind:"danger",open:!0,scale:"s",width:"full"},c("div",{slot:"message"},this.messages?.relationshipNotFound))}_setupRelatedFeatureViewModels(){let{relatedFeatureViewModels:e}=this.viewModel,t="related-feature-viewmodels";this.removeHandles(t),e?.forEach(i=>{this.addHandles(f(()=>[i.title,i.state],()=>this.scheduleRender(),I),t)}),this.scheduleRender()}_setupFeatureElementInfo(){let{headingLevel:e,visibleElements:t}=this,i=t.description&&this.description,o=t.title&&this.title;this._featureElementInfo?.set({description:i,title:o,headingLevel:e})}_handleRelatedFeatureObserverChange(){return g(this,null,function*(){this._unobserveRelatedFeatureObserver();let{state:e,showAllEnabled:t}=this.viewModel;yield ft(0),this._relatedFeatureIntersectionObserverNode&&e==="ready"&&t&&this._relatedFeatureIntersectionObserver.observe(this._relatedFeatureIntersectionObserverNode)})}_relatedFeatureIntersectionObserverCreated(e){this._relatedFeatureIntersectionObserverNode=e}_unobserveRelatedFeatureObserver(){this._relatedFeatureIntersectionObserverNode&&this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode)}};r([s()],J.prototype,"_relatedFeatureIntersectionObserverNode",void 0),r([s({readOnly:!0})],J.prototype,"displayShowAllButton",null),r([s({readOnly:!0})],J.prototype,"displayListItems",null),r([s()],J.prototype,"description",null),r([s({readOnly:!0})],J.prototype,"featureCountDescription",null),r([s()],J.prototype,"headingLevel",void 0),r([s()],J.prototype,"title",null),r([s({type:at})],J.prototype,"viewModel",void 0),r([s(),W("esri/widgets/Feature/t9n/Feature")],J.prototype,"messages",void 0),r([s(),W("esri/t9n/common")],J.prototype,"messagesCommon",void 0),r([s()],J.prototype,"visibleElements",void 0),r([se("visibleElements")],J.prototype,"castVisibleElements",null),J=r([w("esri.widgets.Feature.FeatureRelationship")],J);var mi=J;var St=class{constructor(t,i){this.preLayerQueryCallback=t,this.preRequestCallback=i,this.preLayerQueryCallback||(this.preLayerQueryCallback=o=>{}),this.preRequestCallback||(this.preLayerQueryCallback=o=>{})}};var dt,Lr=1,Do="content-view-models",Wo="relationship-view-models",qo={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0,relationshipContent:!0},N=dt=class extends yt(U){constructor(e){super(e),this._error=null,this._featureAbortController=null,this._graphicChangedThrottled=Ne(this._graphicChanged,Lr,this),this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities=_({},qo),this.content=null,this.contentViewModels=[],this.description=null,this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.location=null,this.relatedInfos=new Map,this.title="",this.view=null,this._isAllowedContentType=t=>{let{abilities:i}=this;return t.type==="attachments"&&!!i.attachmentsContent||t.type==="custom"&&!!i.customContent||t.type==="fields"&&!!i.fieldsContent||t.type==="media"&&!!i.mediaContent||t.type==="text"&&!!i.textContent||t.type==="expression"&&!!i.expressionContent||t.type==="relationship"&&!!i.relationshipContent},this.addHandles(f(()=>[this.graphic,this._effectivePopupTemplate,this.abilities,this.timeZone],()=>this._graphicChangedThrottled(),I))}initialize(){this.addHandles(this._graphicChangedThrottled)}destroy(){this._clear(),this._cancelFeatureQuery(),this._error=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return this.graphic!=null?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return oo(ti(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return Ft(this.graphic)}castAbilities(e){return _(_({},qo),e)}get isTable(){return this._sourceLayer?.isTable||!1}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(e){this._set("graphic",e?.clone()??null)}get spatialReference(){return this.view?.spatialReference??null}set spatialReference(e){this._override("spatialReference",e)}get timeZone(){return this.view?.timeZone??gt}set timeZone(e){this._overrideIfSome("timeZone",e)}get map(){return this.view?.map||null}set map(e){this._override("map",e)}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(e,t){let i=this.contentViewModels[e];i instanceof ge&&i.setActiveMedia(t)}nextMedia(e){let t=this.contentViewModels[e];t instanceof ge&&t.next()}previousMedia(e){let t=this.contentViewModels[e];t instanceof ge&&t.previous()}updateGeometry(){return g(this,null,function*(){let{graphic:e,spatialReference:t,_sourceLayer:i}=this;yield i?.load();let o=i?.objectIdField;if(!o||!e||!i)return;let n=e?.attributes?.[o];if(n==null)return;let a=[n];if(!e.geometry){let l=yield ro({layer:i,graphic:e,outFields:[],objectIds:a,returnGeometry:!0,spatialReference:t}),d=l?.geometry;d&&(e.geometry=d)}})}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}_graphicChanged(){return g(this,null,function*(){this._cancelFeatureQuery(),this._error=null,this._clear();let{graphic:e}=this;if(!e)return;let t=new AbortController;this._featureAbortController=t;try{yield this._queryFeature({signal:t.signal})}catch(i){Ke(i)||(this._error=i,B.getLogger(this).error("error","The popupTemplate could not be displayed for this feature.",{error:i,graphic:e,popupTemplate:this._effectivePopupTemplate}))}this._featureAbortController===t&&(this._featureAbortController=null)})}_cancelFeatureQuery(){let{_featureAbortController:e}=this;e&&e.abort(),this._featureAbortController=null}_compileContentElement(e,t){return e.type==="attachments"?this._compileAttachments(e,t):e.type==="custom"?this._compileCustom(e,t):e.type==="fields"?this._compileFields(e,t):e.type==="media"?this._compileMedia(e,t):e.type==="text"?this._compileText(e,t):e.type==="expression"?this._compileExpression(e,t):e.type==="relationship"?this._compileRelationship(e,t):void 0}_compileContent(e){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(e)?e.filter(this._isAllowedContentType).map((t,i)=>this._compileContentElement(t,i)).filter(be):typeof e=="string"?this._compileText(new wt({text:e}),0).text:e}_destroyContentViewModels(){this.removeHandles(Wo),this.removeHandles(Do),this.contentViewModels.forEach(e=>e&&!e.destroyed&&e.destroy()),this._set("contentViewModels",[])}_matchesFeature(e,t){let i=e?.graphic?.getObjectId(),o=t?.getObjectId();return i!=null&&o!=null&&i===o}_setRelatedFeaturesViewModels({relatedFeatureViewModels:e,relatedFeatures:t,map:i}){let{view:o,spatialReference:n,timeZone:a}=this;t?.filter(Boolean).forEach(l=>{e.some(d=>this._matchesFeature(d,l))||e.add(new dt({abilities:{relationshipContent:!1},map:i,view:o,spatialReference:n,timeZone:a,graphic:l}))}),e.forEach(l=>{t?.find(u=>this._matchesFeature(l,u))||e.remove(l)})}_setExpressionContentVM(e,t){let i=this.formattedAttributes,{contentElement:o,contentElementViewModel:n}=e,a=o?.type;n&&a&&(a==="fields"&&(this._createFieldsFormattedAttributes({contentElement:o,contentElementIndex:t,formattedAttributes:i}),n.set(this._createFieldsVMParams(o,t))),a==="media"&&(this._createMediaFormattedAttributes({contentElement:o,contentElementIndex:t,formattedAttributes:i}),n.set(this._createMediaVMParams(o,t))),a==="text"&&n.set(this._createTextVMParams(o)))}_compileRelationship(e,t){let{displayCount:i,orderByFields:o,relationshipId:n,title:a,description:l}=e,{_sourceLayer:d,graphic:u,map:p}=this;if(!eo(d))return;let h=new at(_({displayCount:i,graphic:u,orderByFields:o,relationshipId:n,layer:d,map:p},this._compileTitleAndDesc({title:a,description:l})));return this.contentViewModels[t]=h,this.addHandles(re(()=>h.relatedFeatures,"change",()=>this._setRelatedFeaturesViewModels(h)),Wo),e}_compileExpression(e,t){let{expressionInfo:i}=e,{graphic:o,map:n,spatialReference:a,view:l,location:d}=this,u=new nt({expressionInfo:i,graphic:o,interceptor:dt.interceptor,map:n,spatialReference:a,view:l,location:d});return this.contentViewModels[t]=u,this.addHandles(f(()=>u.contentElementViewModel,()=>this._setExpressionContentVM(u,t),I),Do),e}_compileAttachments(e,t){let{graphic:i}=this,{description:o,title:n}=e;return this.contentViewModels[t]=new rt(_({graphic:i},this._compileTitleAndDesc({title:n,description:o}))),e}_compileCustom(e,t){let{graphic:i}=this,{creator:o,destroyer:n}=e;return this.contentViewModels[t]=new $e({graphic:i,creator:o,destroyer:n}),e}_compileTitleAndDesc({title:e,description:t}){let{_fieldInfoMap:i,_sourceLayer:o,graphic:n,formattedAttributes:a}=this,l=n?.attributes,d=this._expressionAttributes,u=a.global;return{title:Fe({attributes:l,fieldInfoMap:i,globalAttributes:u,expressionAttributes:d,layer:o,text:e}),description:Fe({attributes:l,fieldInfoMap:i,globalAttributes:u,expressionAttributes:d,layer:o,text:t})}}_createFieldsVMParams(e,t){let i=this._effectivePopupTemplate,o=this.formattedAttributes,n=_(_({},o?.global),o?.content[t]),a=e?.fieldInfos||i?.fieldInfos,l=a?.filter(({fieldName:h})=>!!h&&(It(h)||me(h)||n.hasOwnProperty(h))),d=i?.expressionInfos,{description:u,title:p}=e;return _({attributes:n,expressionInfos:d,fieldInfos:l},this._compileTitleAndDesc({title:p,description:u}))}_compileFields(e,t){let i=e.clone(),o=new Se(this._createFieldsVMParams(e,t));return this.contentViewModels[t]=o,i.fieldInfos=o.formattedFieldInfos.slice(0),i}_createMediaVMParams(e,t){let{abilities:i,graphic:o,_fieldInfoMap:n,_effectivePopupTemplate:a,relatedInfos:l,_sourceLayer:d,_expressionAttributes:u}=this,p=this.formattedAttributes,h=o?.attributes??{},{description:m,mediaInfos:v,title:y}=e;return _({abilities:{chartAnimation:i.chartAnimation},activeMediaInfoIndex:e.activeMediaInfoIndex||0,attributes:h,isAggregate:o?.isAggregate,layer:d,fieldInfoMap:n,formattedAttributes:_(_({},p?.global),p?.content[t]),expressionAttributes:u,mediaInfos:v,popupTemplate:a,relatedInfos:l},this._compileTitleAndDesc({title:y,description:m}))}_compileMedia(e,t){let i=e.clone(),o=new ge(this._createMediaVMParams(e,t));return i.mediaInfos=o.formattedMediaInfos.slice(0),this.contentViewModels[t]=o,i}_createTextVMParams(e){let{graphic:t,_fieldInfoMap:i,_sourceLayer:o,_expressionAttributes:n}=this;if(e&&e.text){let a=t?.attributes??{},l=this.formattedAttributes?.global??{};e.text=Fe({attributes:a,fieldInfoMap:i,globalAttributes:l,expressionAttributes:n,layer:o,text:e.text})}return{graphic:t,creator:e.text}}_compileText(e,t){let i=e.clone();return this.contentViewModels[t]=new $e(this._createTextVMParams(i)),i}_compileLastEditInfo(){let{_effectivePopupTemplate:e,_sourceLayer:t,graphic:i,timeZone:o}=this;if(!e)return;let{lastEditInfoEnabled:n}=e,a=t?.editFieldsInfo;return n&&a?io(a,i?.attributes,o,t):void 0}_compileTitle(e){let{_fieldInfoMap:t,_sourceLayer:i,graphic:o,_expressionAttributes:n}=this,a=o?.attributes??{},l=this.formattedAttributes?.global??{};return Fe({attributes:a,fieldInfoMap:t,globalAttributes:l,expressionAttributes:n,layer:i,text:e})}_getTitle(){return g(this,null,function*(){let{_effectivePopupTemplate:e,graphic:t}=this;return t?He({type:"title",value:e?.title,event:{graphic:t}}):null})}_getContent(){return g(this,null,function*(){let{_effectivePopupTemplate:e,graphic:t}=this;return t?He({type:"content",value:e?.content,event:{graphic:t}}):null})}_queryFeature(e){return g(this,null,function*(){let{_featureAbortController:t,_sourceLayer:i,graphic:o,_effectivePopupTemplate:n}=this,a=this.map,l=this.view,d=this.spatialReference,u=this.location;if(t!==this._featureAbortController||!o)return;yield so({graphic:o,popupTemplate:n,layer:i,spatialReference:d},e);let{content:{value:p},title:{value:h}}=yield pe({content:this._getContent(),title:this._getTitle()}),{expressionAttributes:{value:m}}=yield pe({checkForRelatedFeatures:this._checkForRelatedFeatures(e),expressionAttributes:Po({expressionInfos:n?.expressionInfos,spatialReference:d,graphic:o,map:a,interceptor:dt.interceptor,view:l,options:e,location:u})});t===this._featureAbortController&&o&&(this._expressionAttributes=m,this._graphicExpressionAttributes=_(_({},o.attributes),m),this._set("formattedAttributes",this._createFormattedAttributes(p)),this._set("title",this._compileTitle(h)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(p)||null))})}_createMediaFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:i}){let{_effectivePopupTemplate:o,graphic:n,relatedInfos:a,_sourceLayer:l,_fieldInfoMap:d,_graphicExpressionAttributes:u,timeZone:p}=this;i.content[t]=Et({fieldInfos:o?.fieldInfos,graphic:n,attributes:_(_({},u),e.attributes),layer:l,fieldInfoMap:d,relatedInfos:a,timeZone:p})}_createFieldsFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:i}){if(e.fieldInfos){let{graphic:o,relatedInfos:n,_sourceLayer:a,_fieldInfoMap:l,_graphicExpressionAttributes:d,timeZone:u}=this;i.content[t]=Et({fieldInfos:e.fieldInfos,graphic:o,attributes:_(_({},d),e.attributes),layer:a,fieldInfoMap:l,relatedInfos:n,timeZone:u})}}_createFormattedAttributes(e){let{_effectivePopupTemplate:t,graphic:i,relatedInfos:o,_sourceLayer:n,_fieldInfoMap:a,_graphicExpressionAttributes:l,timeZone:d}=this,u=t?.fieldInfos,p={global:Et({fieldInfos:u,graphic:i,attributes:l,layer:n,fieldInfoMap:a,relatedInfos:o,timeZone:d}),content:[]};return Array.isArray(e)&&e.forEach((h,m)=>{h.type==="fields"&&this._createFieldsFormattedAttributes({contentElement:h,contentElementIndex:m,formattedAttributes:p}),h.type==="media"&&this._createMediaFormattedAttributes({contentElement:h,contentElementIndex:m,formattedAttributes:p})}),p}_checkForRelatedFeatures(e){let{graphic:t,_effectivePopupTemplate:i}=this;return this._queryRelatedInfos(t,ti(i),e)}_queryRelatedInfos(e,t,i){return g(this,null,function*(){let{relatedInfos:o,_sourceLayer:n}=this;o.clear();let a=n?.associatedLayer!=null?yield n?.associatedLayer.load(i):n;if(!a||!e||!t.filter(p=>!!p.fieldName&&me(p.fieldName))?.length)return;t.forEach(p=>this._configureRelatedInfo(p,a));let d=yield Eo({relatedInfos:o,layer:a},i);Object.keys(d).forEach(p=>{let h=o.get(p.toString()),m=d[p]?.value;h&&m&&(h.layerInfo=m.data)});let u=yield To({graphic:e,relatedInfos:o,layer:a},i);Object.keys(u).forEach(p=>{xo(u[p]?.value,o.get(p.toString()))})})}_configureRelatedInfo(e,t){let{relatedInfos:i}=this,o=Ge(e.fieldName||"");if(!o)return;let{layerId:n,fieldName:a}=o;if(!n)return;let l=i.get(n.toString())||Ao(n,t);l&&(ko({relatedInfo:l,fieldName:a,fieldInfo:e}),this.relatedInfos.set(n,l))}};N.interceptor=new St(no,ao),r([s()],N.prototype,"_error",void 0),r([s()],N.prototype,"_featureAbortController",void 0),r([s({readOnly:!0})],N.prototype,"_effectivePopupTemplate",null),r([s({readOnly:!0})],N.prototype,"_fieldInfoMap",null),r([s({readOnly:!0})],N.prototype,"_sourceLayer",null),r([s()],N.prototype,"abilities",void 0),r([se("abilities")],N.prototype,"castAbilities",null),r([s({readOnly:!0})],N.prototype,"content",void 0),r([s({readOnly:!0})],N.prototype,"contentViewModels",void 0),r([s()],N.prototype,"description",void 0),r([s({type:Boolean})],N.prototype,"defaultPopupTemplateEnabled",void 0),r([s({readOnly:!0})],N.prototype,"isTable",null),r([s({readOnly:!0})],N.prototype,"state",null),r([s({readOnly:!0})],N.prototype,"formattedAttributes",void 0),r([s({type:ne,value:null})],N.prototype,"graphic",null),r([s({readOnly:!0})],N.prototype,"lastEditInfo",void 0),r([s({type:ze})],N.prototype,"location",void 0),r([s({readOnly:!0})],N.prototype,"relatedInfos",void 0),r([s()],N.prototype,"spatialReference",null),r([s()],N.prototype,"timeZone",null),r([s({readOnly:!0})],N.prototype,"title",void 0),r([s()],N.prototype,"map",null),r([s({readOnly:!0})],N.prototype,"waitingForContent",null),r([s()],N.prototype,"view",void 0),N=dt=r([w("esri.widgets.Feature.FeatureViewModel")],N);var ct=N;var Q="esri-feature",V={base:Q,container:`${Q}__size-container`,title:`${Q}__title`,main:`${Q}__main-container`,btn:`${Q}__button`,icon:`${Q}__icon`,content:`${Q}__content`,contentNode:`${Q}__content-node`,contentNodeText:`${Q}__content-node--text`,contentElement:`${Q}__content-element`,text:`${Q}__text`,lastEditedInfo:`${Q}__last-edited-info`,fields:`${Q}__fields`,fieldHeader:`${Q}__field-header`,fieldData:`${Q}__field-data`,fieldDataDate:`${Q}__field-data--date`,loadingSpinnerContainer:`${Q}__loading-container`};var Vt=e=>{let t=class extends e{constructor(){super(...arguments),this.renderNodeContent=i=>kt(i)&&!i.destroyed?c("div",{class:V.contentNode,key:i},i.render()):i instanceof HTMLElement?c("div",{afterCreate:this._attachToNode,bind:i,class:V.contentNode,key:i}):co(i)?c("div",{afterCreate:this._attachToNode,bind:i.domNode,class:V.contentNode,key:i}):null}_attachToNode(i){let o=this;i.appendChild(o)}};return t=r([w("esri.widgets.Feature.support.FeatureContentMixin")],t),t};var fi,zo={title:!0,content:!0,lastEditedInfo:!0},Ho="relationship-handles",H=fi=class extends Vt(S){constructor(e,t){super(e,t),this._contentWidgets=[],this.flowItems=null,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.visibleElements=_({},zo),this.viewModel=new ct}initialize(){this.addHandles(f(()=>this.viewModel?.contentViewModels,()=>this._setupContentWidgets(),I))}loadDependencies(){return ee({notice:()=>import("./chunk-PB4EE5XH.js"),loader:()=>import("./chunk-F63PXXTQ.js")})}destroy(){this._destroyContentWidgets()}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(e){this.viewModel.defaultPopupTemplateEnabled=e}get isTable(){return this.viewModel.isTable}get icon(){return"polygon"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(e){this.viewModel.spatialReference=e}get timeZone(){return this.viewModel.timeZone}set timeZone(e){this.viewModel.timeZone=e}get title(){return this.viewModel.title}castVisibleElements(e){return _(_({},zo),e)}get map(){return this.viewModel.map}set map(e){this.viewModel.map=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}setActiveMedia(e,t){return this.viewModel.setActiveMedia(e,t)}nextMedia(e){return this.viewModel.nextMedia(e)}previousMedia(e){return this.viewModel.previousMedia(e)}render(){let{state:e}=this.viewModel,t=c("div",{class:V.container,key:"container"},this._renderTitle(),e==="error"?this._renderError():e==="loading"?this._renderLoading():this._renderContentContainer());return c("div",{class:this.classes(V.base,M.widget)},t)}_renderError(){let{messagesCommon:e,messages:t,visibleElements:i}=this;return c("calcite-notice",{icon:"exclamation-mark-circle",kind:"danger",open:!0,scale:"s"},i.title?c("div",{key:"error-title",slot:"title"},e.errorMessage):null,c("div",{key:"error-message",slot:"message"},t.loadingError))}_renderLoading(){return c("div",{class:V.loadingSpinnerContainer,key:"loading-container"},c("calcite-loader",{inline:!0,label:""}))}_renderContentContainer(){let{visibleElements:e}=this;return e.content?c("div",{class:V.main},[this._renderContent(),this._renderLastEditInfo()]):null}_renderTitle(){let{visibleElements:e,title:t}=this;return e.title?c(je,{class:V.title,innerHTML:t,level:this.headingLevel}):null}_renderContent(){let e=this.viewModel.content,t="content";if(!e)return null;if(Array.isArray(e))return e.length?c("div",{class:V.contentNode,key:`${t}-content-elements`},e.map(this._renderContentElement,this)):null;if(typeof e=="string"){let i=this._contentWidgets[0];return!i||i.destroyed?null:c("div",{class:this.classes(V.contentNode,V.contentNodeText),key:`${t}-content`},i.render())}return this.renderNodeContent(e)}_renderContentElement(e,t){let{visibleElements:i}=this;if(typeof i.content!="boolean"&&!i.content?.[e.type])return null;switch(e.type){case"attachments":return this._renderAttachments(t);case"custom":return this._renderCustom(e,t);case"fields":return this._renderFields(t);case"media":return this._renderMedia(t);case"text":return this._renderText(e,t);case"expression":return this._renderExpression(t);case"relationship":return this._renderRelationship(t);default:return null}}_renderAttachments(e){let t=this._contentWidgets[e];if(!t||t.destroyed)return null;let{state:i,attachmentInfos:o}=t.viewModel;return i==="loading"||o.length>0?c("div",{class:this.classes(V.contentElement),key:this._buildKey("attachments-element",e)},t.render()):null}_renderRelationship(e){let t=this._contentWidgets[e];return t&&!t.destroyed&&this.flowItems?c("div",{class:V.contentElement,key:this._buildKey("relationship-element",e)},t.render()):null}_renderExpression(e){let t=this._contentWidgets[e];return!t||t.destroyed?null:c("div",{class:V.contentElement,key:this._buildKey("expression-element",e)},t.render())}_renderCustom(e,t){let{creator:i}=e,o=this._contentWidgets[t];return!o||o.destroyed?null:i?c("div",{class:V.contentElement,key:this._buildKey("custom-element",t)},o.render()):null}_renderFields(e){let t=this._contentWidgets[e];return!t||t.destroyed?null:c("div",{class:V.contentElement,key:this._buildKey("fields-element",e)},t.render())}_renderMedia(e){let t=this._contentWidgets[e];return!t||t.destroyed?null:c("div",{class:V.contentElement,key:this._buildKey("media-element",e)},t.render())}_renderLastEditInfo(){let{visibleElements:e,messages:t}=this,{lastEditInfo:i}=this.viewModel;if(!i||!e.lastEditedInfo)return null;let{date:o,user:n}=i,a=i.type==="edit"?n?t.lastEditedByUser:t.lastEdited:n?t.lastCreatedByUser:t.lastCreated,l=G(a,{date:o,user:n});return c("div",{class:this.classes(V.lastEditedInfo,V.contentElement),key:"edit-info-element"},l)}_renderText(e,t){let i=e.text,o=this._contentWidgets[t];return!o||o.destroyed?null:i?c("div",{class:this.classes(V.contentElement,V.text),key:this._buildKey("text-element",t)},o.render()):null}_buildKey(e,...t){return`${e}__${this.viewModel?.graphic?.uid||"0"}-${t.join("-")}`}_destroyContentWidget(e){e&&(e.viewModel=null,!e.destroyed&&e.destroy())}_destroyContentWidgets(){this.removeHandles(Ho),this._contentWidgets.forEach(e=>this._destroyContentWidget(e)),this._contentWidgets=[]}_addFeatureRelationshipHandles(e){let{flowItems:t,visibleElements:i}=this;this.addHandles([re(()=>e,"select-record",({featureViewModel:o})=>{t&&(o.abilities={relationshipContent:!0},t.push(new fi({flowItems:t,viewModel:o,visibleElements:i})))}),re(()=>e,"show-all-records",()=>{if(!t)return;let{viewModel:o}=e;o.showAllEnabled=!0;let n=new mi({visibleElements:{title:!1,description:!1},viewModel:o});this._addFeatureRelationshipHandles(n),t.push(n)})],Ho)}_setupContentWidgets(){this._destroyContentWidgets();let{headingLevel:e,visibleElements:t}=this,i=this.viewModel?.content,{contentViewModels:o}=this.viewModel;if(Array.isArray(i))i.forEach((n,a)=>{if(n.type==="attachments"&&(this._contentWidgets[a]=new Fo({displayType:n.displayType,headingLevel:t.title&&e<6?e+1:e,viewModel:o[a]})),n.type==="fields"&&(this._contentWidgets[a]=new Pt({viewModel:o[a]})),n.type==="media"&&(this._contentWidgets[a]=new Ot({viewModel:o[a]})),n.type==="text"&&(this._contentWidgets[a]=new Qe({viewModel:o[a]})),n.type==="custom"&&(this._contentWidgets[a]=new Qe({viewModel:o[a]})),n.type==="expression"&&(this._contentWidgets[a]=new $o({viewModel:o[a]})),n.type==="relationship"){let l=new mi({viewModel:o[a]});this._addFeatureRelationshipHandles(l),this._contentWidgets[a]=l}},this);else{let n=o[0];n&&!n.destroyed&&(this._contentWidgets[0]=new Qe({viewModel:n}))}this.scheduleRender()}};r([s()],H.prototype,"graphic",null),r([s()],H.prototype,"defaultPopupTemplateEnabled",null),r([s()],H.prototype,"flowItems",void 0),r([s()],H.prototype,"headingLevel",void 0),r([s({readOnly:!0})],H.prototype,"isTable",null),r([s()],H.prototype,"icon",null),r([s()],H.prototype,"label",null),r([s(),W("esri/widgets/Feature/t9n/Feature")],H.prototype,"messages",void 0),r([s(),W("esri/t9n/common")],H.prototype,"messagesCommon",void 0),r([s()],H.prototype,"spatialReference",null),r([s()],H.prototype,"timeZone",null),r([s({readOnly:!0})],H.prototype,"title",null),r([s()],H.prototype,"visibleElements",void 0),r([se("visibleElements")],H.prototype,"castVisibleElements",null),r([s()],H.prototype,"map",null),r([s()],H.prototype,"view",null),r([s({type:ct})],H.prototype,"viewModel",void 0),H=fi=r([w("esri.widgets.Feature")],H);var jo=H;var Ve=class extends Ti.EventedAccessor{constructor(e){super(e),this.location=null,this.screenLocationEnabled=!1,this.view=null,this.addHandles([xe(()=>{let t=this.screenLocationEnabled?this.view:null;return t?[t.size,t.type==="3d"?t.camera:t.viewpoint]:null},()=>this.notifyChange("screenLocation")),f(()=>this.screenLocation,(t,i)=>{t!=null&&i!=null&&this.emit("view-change")})])}destroy(){this.view=null}get screenLocation(){let{location:e,view:t,screenLocationEnabled:i}=this,o=t?.spatialReference,n=o?Vi(e,o).geometry:null;return i&&n&&t?.ready?t.toScreen(n):null}};r([s()],Ve.prototype,"location",void 0),r([s()],Ve.prototype,"screenLocation",null),r([s()],Ve.prototype,"screenLocationEnabled",void 0),r([s()],Ve.prototype,"view",void 0),Ve=r([w("esri.widgets.support.AnchorElementViewModel")],Ve);var Bt=Ve;var Dt=class extends Bt{constructor(e){super(e),this.visible=!1}};r([s()],Dt.prototype,"visible",void 0),Dt=r([w("esri.widgets.Spinner.SpinnerViewModel")],Dt);var gi=Dt;var yi="esri-spinner",vi={base:yi,spinnerStart:`${yi}--start`,spinnerFinish:`${yi}--finish`},Be=class extends S{constructor(e,t){super(e,t),this._animationDelay=500,this._animationPromise=null,this.viewModel=new gi}initialize(){this.addHandles(f(()=>this.visible,e=>this._visibleChange(e)))}destroy(){this._animationPromise=null}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}show(e){let{location:t,promise:i}=e??{};t&&(this.viewModel.location=t),this.visible=!0;let o=()=>this.hide();i&&i.catch(()=>{}).then(o)}hide(){this.visible=!1}render(){let{visible:e}=this,{screenLocation:t}=this.viewModel,i=!!t,o=e&&i,n=!e&&i,a={[vi.spinnerStart]:o,[vi.spinnerFinish]:n},l=this._getPositionStyles();return c("div",{class:this.classes(vi.base,a),styles:l})}_visibleChange(e){if(e)return void(this.viewModel.screenLocationEnabled=!0);let t=ft(this._animationDelay);this._animationPromise=t,t.catch(()=>{}).then(()=>{this._animationPromise===t&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)})}_getPositionStyles(){let{screenLocation:e,view:t}=this.viewModel;if(t==null||e==null)return{};let{padding:i}=t;return{left:e.x-i.left+"px",top:e.y-i.top+"px"}}};r([s()],Be.prototype,"location",null),r([s()],Be.prototype,"view",null),r([s({type:gi})],Be.prototype,"viewModel",void 0),r([s()],Be.prototype,"visible",null),Be=r([w("esri.widgets.Spinner")],Be);var Uo=Be;var X="esri-features",j={icon:`${X}__icon`,actionImage:`${X}__action-image`,base:X,container:`${X}__container`,contentContainer:`${X}__content-container`,contentFeature:`${X}__content-feature`,flowItemCollapsed:`${X}__flow-item--collapsed`,header:`${X}__header`,footer:`${X}__footer`,featureMenuObserver:`${X}__feature-menu-observer`,actionExit:`${X}__action--exit`,loader:`${X}__loader`,featuresHeading:`${X}__heading`,paginationActionBar:`${X}__pagination-action-bar`,paginationPrevious:`${X}__pagination-previous`,paginationNext:`${X}__pagination-next`};var De=class extends S{constructor(e,t){super(e,t),this.messages=null,this.closed=!1,this.closable=!0,this._handleOpenRelatedFeature=i=>{this.emit("open-related-feature",{feature:i})}}loadDependencies(){return ee({action:()=>import("./chunk-EANCIRMG.js"),"flow-item":()=>import("./chunk-M34V2RC7.js")})}render(){let{flowItems:e}=this,t=e?.toArray();return c(Pi,null,t?.map(i=>this._renderRelatedRecordsFlowItem(i)))}_handleCloseClick(){this.emit("close")}_handleExitClick(){this.emit("exit")}_handleRelatedRecordsBackClick(){let e=this.flowItems?.pop();e&&("showAllEnabled"in e.viewModel&&(e.viewModel.showAllEnabled=!1),e&&(e.viewModel=null,e.destroy()))}_renderRelatedRecordsFlowItem(e){let{messages:t,closable:i,closed:o}=this,n="graphic"in e&&!e.isTable&&e.graphic?.geometry,a=t.exitRelatedRecords,l=t.selectFeature;return c("calcite-flow-item",{bind:this,closable:i,closed:o,description:this._getRelatedRecordsFlowItemDescription(e),heading:e.title??"",key:`flow-item-${e.viewModel.uid}`,onCalciteFlowItemBack:d=>{d.preventDefault(),this._handleRelatedRecordsBackClick()},onCalciteFlowItemClose:this._handleCloseClick},c("calcite-action",{appearance:"transparent",bind:this,class:j.actionExit,icon:"move-up",key:"exit-related-records-action",onclick:this._handleExitClick,slot:"header-actions-start",text:a,title:a}),n?c("calcite-action",{appearance:"transparent",bind:this,icon:"zoom-to-object",key:"open-related-feature-action",onclick:()=>this._handleOpenRelatedFeature(e),slot:"header-actions-end",text:l,title:l}):null,c("div",{class:j.container},e.render()))}_getRelatedRecordsFlowItemDescription(e){return"featureCountDescription"in e?e.featureCountDescription:e.viewModel.description??""}};r([s()],De.prototype,"flowItems",void 0),r([s(),W("esri/widgets/Features/t9n/Features")],De.prototype,"messages",void 0),r([s()],De.prototype,"closed",void 0),r([s()],De.prototype,"closable",void 0),De=r([w("esri.widgets.Features.FeaturesRelatedRecords")],De);var Zo=De;var Qo="OBJECTID";var Ie=he.ofType({key:"type",defaultKeyValue:"button",base:Qi,typeMap:{button:Oe,toggle:Xt}}),Ce=new Oe({icon:"magnifying-glass-plus",id:"zoom-to-feature",title:"{messages.zoom}",className:de.zoomInMagnifyingGlass}),_i=new Oe({icon:"trash",id:"remove-selected-feature",title:"{messages.remove}",className:de.trash}),Re=new Oe({icon:"magnifying-glass-plus",id:"zoom-to-clustered-features",title:"{messages.zoom}",className:de.zoomInMagnifyingGlass}),ye=new Xt({icon:"table",id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:de.table,value:!1});var Rr="esri.widgets.Popup.PopupViewModel",Wt=()=>B.getLogger(Rr),Go=e=>{let{event:t,view:i,viewModel:o}=e,{action:n}=t;if(!n)return Promise.reject(new k("trigger-action:missing-arguments","Event has no action"));let{disabled:a,id:l}=n;if(!l)return Promise.reject(new k("trigger-action:invalid-action","action.id is missing"));if(a)return Promise.reject(new k("trigger-action:invalid-action","Action is disabled"));if(l===Ce.id)return Or(o).catch(xi);if(l===Re.id)return Nr(o);if(l===ye.id)return o.browseClusterEnabled=!o.browseClusterEnabled,o.featureMenuOpen=o.browseClusterEnabled,Promise.resolve();if(l===_i.id){o.visible=!1;let{selectedFeature:d}=o;if(!d)return Promise.reject(new k(`trigger-action:${_i.id}`,"selectedFeature is required",{selectedFeature:d}));let{sourceLayer:u}=d;return u?u.remove(d):i?.graphics.remove(d),Promise.resolve()}return Promise.resolve()};function wi(e){let{selectedFeature:t,location:i,view:o}=e;return o?t??i??null:null}function Pe(e){return!!e&&e.isAggregate&&e.sourceLayer?.featureReduction?.type==="cluster"}function Pr(e,t){return g(this,null,function*(){if(t?.type!=="3d"||!e||e.declaredClass!=="esri.Graphic")return!0;let i=t.getViewForGraphic(e);if(i&&"whenGraphicBounds"in i){let o=null;try{o=yield i.whenGraphicBounds(e,{useViewElevation:!0})}catch{}return!o||!o.boundingBox||o.boundingBox[0]===o.boundingBox[3]&&o.boundingBox[1]===o.boundingBox[4]&&o.boundingBox[2]===o.boundingBox[5]}return!0})}function Or(e){return g(this,null,function*(){let{location:t,selectedFeature:i,view:o,zoomFactor:n}=e,a=wi(e);if(!o||!a){let h=new k("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:a,view:o});throw Wt().error(h),h}let l=o.scale/n,d=e.selectedFeature?.geometry,u=d??t,p=u!=null&&u.type==="point"&&(yield Pr(i,o));Ce.active=!0,Ce.disabled=!0;try{yield e.zoomTo({target:{target:a,scale:p?l:void 0}})}catch{let m=new k("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:i});Wt().error(m)}finally{Ce.active=!1,Ce.disabled=!1,e.zoomToLocation=null,p&&(e.location=u)}})}function Nr(e){return g(this,null,function*(){let{selectedFeature:t,view:i}=e;if(i?.type!=="2d"){let l=new k("zoomToCluster:invalid-view","View must be 2d MapView.",{view:i});throw Wt().error(l),l}if(!t||!Pe(t)){let l=new k("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:t});throw Wt().error(l),l}let[o,n]=yield bi(i,t);Re.active=!0,Re.disabled=!0;let{extent:a}=yield o.queryExtent(n);a&&(yield e.zoomTo({target:a})),Re.active=!1,Re.disabled=!1})}function Xo(e){return g(this,null,function*(){let{view:t,selectedFeature:i}=e;if(!t||!i)return;let[o,n]=yield bi(t,i),{extent:a}=yield o.queryExtent(n);e.selectedClusterBoundaryFeature.geometry=a,t.graphics.add(e.selectedClusterBoundaryFeature)})}function Yo(e){return g(this,null,function*(){let{selectedFeature:t,view:i}=e;if(!i||!t)return;let[o,n]=yield bi(i,t);ye.active=!0,ye.disabled=!0;let{features:a}=yield o.queryFeatures(n);ye.active=!1,ye.disabled=!1,ye.value=!0,e?.open({features:[t].concat(a),featureMenuOpen:!0})})}function bi(e,t){return g(this,null,function*(){let i=yield e.whenLayerView(t.sourceLayer),o=i.createQuery(),n=t.getObjectId();return o.aggregateIds=n!=null?[n]:[],[i,o]})}function Ko(e){ye.value=!1;let t=e.features.filter(i=>Pe(i));t.length&&(e.features=t)}var Fi="location-scale-handle",$r=()=>[Ce.clone()],Sr=()=>[Re.clone(),ye.clone()],qt=null;function Vr(e,t){return e==="building-scene"||t==="2d"&&(e==="map-image"||e==="tile"||e==="imagery"||e==="imagery-tile")}var C=class extends mo(Bt){constructor(e){super(e),this._pendingPromises=new ho,this._fetchFeaturesController=null,this._highlightSelectedFeaturePromise=null,this._highlightActiveFeaturePromise=null,this._selectedClusterFeature=null,this.actions=new Ie,this.activeFeature=null,this.autoCloseEnabled=!1,this.browseClusterEnabled=!1,this.content=null,this.defaultPopupTemplateEnabled=!1,this.featurePage=null,this.featuresPerPage=20,this.featureMenuOpen=!1,this.featureViewModelAbilities=null,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.selectedClusterBoundaryFeature=new ne({symbol:new qi({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null,this._debouncedLocationUpdate=qe(t=>g(this,null,function*(){let{spatialReference:i}=this,o=this.selectedFeature?.geometry?.type,n=this.location??t;if(o&&o!=="mesh"&&i&&n&&this.selectedFeature)if(o!=="point")try{let a=this.selectedFeature,l=a.geometry,d=this._getHighlightLayer(a),u=a.getObjectId();if(!d||!this.view)return;if(u){let p=this.view?.allLayerViews.find(v=>v.layer.uid===d.uid);if(!p||!("queryFeatures"in p))return;let h=p.createQuery();h.outSpatialReference=i,h.objectIds=[u],h.returnGeometry=!0;let{features:m}=yield p.queryFeatures(h);l=m[0]?.geometry}if(!l||l.type==="mesh")return;if(l=Si(l,i),qt||(qt=yield import("./chunk-7PIWKYUS.js")),!(yield qt.intersects(l,n))){let p=(yield qt.nearestCoordinate(l,n)).coordinate??n;this.selectedFeature===a&&(this.location=p)}}catch(a){Ke(a)||B.getLogger(this).error(a)}else this.location=tt(this.selectedFeature.geometry)??n}))}initialize(){this.addHandles([this.on("view-change",()=>this._autoClose()),f(()=>[this.highlightEnabled,this.selectedFeature,this.visible,this.view],()=>this._highlightSelectedFeature()),f(()=>[this.highlightEnabled,this.activeFeature,this.visible,this.view],()=>this._highlightActiveFeature()),f(()=>this.view?.animation?.state,e=>this._animationStateChange(e)),f(()=>this.location,e=>this._locationChange(e)),f(()=>this.selectedFeature,e=>this._selectedFeatureChange(e)),f(()=>[this.selectedFeatureIndex,this.featureCount,this.featuresPerPage],()=>this._selectedFeatureIndexChange()),f(()=>[this.featurePage,this.selectedFeatureIndex,this.featureCount,this.featuresPerPage,this.featureViewModels],()=>this._setGraphicOnFeatureViewModels()),f(()=>this.featureViewModels,()=>this._featureViewModelsChange()),this.on("trigger-action",e=>Go({event:e,viewModel:this,view:this.view})),xe(()=>!this.waitingForResult,()=>this._waitingForResultChange(),Ri),f(()=>[this.features,this.map,this.spatialReference,this.timeZone],()=>this._updateFeatureVMs()),f(()=>this.view?.scale,()=>this._viewScaleChange()),xe(()=>!this.visible,()=>this.browseClusterEnabled=!1),f(()=>this.browseClusterEnabled,e=>e?this.enableClusterBrowsing():this.disableClusterBrowsing())])}destroy(){this._cancelFetchingFeatures(),this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null,this.map=null,this.spatialReference=null,this.timeZone=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){let e=this._get("allActions")||new Ie;e.removeAll();let{actions:t,defaultActions:i,defaultPopupTemplateEnabled:o,includeDefaultActions:n,selectedFeature:a}=this,l=n?i.concat(t):t,d=a&&(typeof a.getEffectivePopupTemplate=="function"&&a.getEffectivePopupTemplate(o)||a.popupTemplate),u=d?.actions;return(d?.overwriteActions?u:u?.concat(l)??l)?.filter(Boolean).forEach(h=>e.add(h)),e}get defaultActions(){let e=this._get("defaultActions")||new Ie;return e.removeAll(),e.addMany(Pe(this.selectedFeature)?Sr():$r()),e}get featureCount(){return this.features.length}set features(e){let t=e||[];this._set("features",t);let{pendingPromisesCount:i,promiseCount:o,selectedFeatureIndex:n}=this,a=o&&t.length;a&&i&&n===-1?this.selectedFeatureIndex=0:a&&n!==-1||(this.selectedFeatureIndex=t.length?0:-1)}set location(e){let t=e,i=this.spatialReference?.isWebMercator;e?.spatialReference?.isWGS84&&i&&(t=$i(e)),this._set("location",t)}get map(){return this.view?.map??null}set map(e){this._override("map",e)}get pendingPromisesCount(){return this._pendingPromises.size}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(e){this._pendingPromises.clear(),this.features=[],Array.isArray(e)&&e.length?(this._set("promises",e),(e=e.slice(0)).forEach(t=>this._pendingPromises.add(t)),e.reduce((t,i)=>t.finally(()=>i.then(o=>{this._pendingPromises.has(i)&&this._updateFeatures(o)}).finally(()=>this._pendingPromises.delete(i)).catch(()=>{})),Promise.resolve())):this._set("promises",[])}get selectedFeature(){let{features:e,selectedFeatureIndex:t}=this;return t===-1?null:e[t]||null}get selectedFeatureIndex(){let e=this._get("selectedFeatureIndex");return typeof e=="number"?e:-1}set selectedFeatureIndex(e){let{featureCount:t}=this;e=isNaN(e)||e<-1||!t?-1:(e+t)%t,this.activeFeature=null,this._set("selectedFeatureIndex",e)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get spatialReference(){return this.view?.spatialReference??null}set spatialReference(e){this._override("spatialReference",e)}get state(){let{view:e,map:t}=this;return e?e.ready?"ready":"disabled":t?"ready":"disabled"}get timeZone(){return this.view?.timeZone??gt}set timeZone(e){this._overrideIfSome("timeZone",e)}get waitingForContents(){return this.featureViewModels.some(e=>e.waitingForContent)}get waitingForResult(){return!(!(this._fetchFeaturesController||this.pendingPromisesCount>0)||this.featureCount!==0)}centerAtLocation(){let{view:e}=this,t=wi(this);return t&&e?this.callGoTo({target:{target:t,scale:e.scale}}):Promise.reject(new k("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:t,view:e}))}zoomTo(e){return this.callGoTo(e)}clear(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})}fetchFeatures(e,t){let{view:i}=this;if(!i||!e)throw new k("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:e,view:i});return i.fetchPopupFeatures(e,{pointerType:t?.event?.pointerType,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:t?.signal})}open(e){let t=Xe(_({updateLocationEnabled:!1,promises:[],fetchFeatures:!1},e),{visible:!0}),{fetchFeatures:i}=t;delete t.fetchFeatures,i&&this._setFetchFeaturesPromises(t.location);let o=["actionsMenuOpen","collapsed"];for(let n of o)delete t[n];this.set(t)}triggerAction(e){let t=this.allActions.at(e);t&&!t.disabled&&this.emit("trigger-action",{action:t})}next(){return this.selectedFeatureIndex++,this}previous(){return this.selectedFeatureIndex--,this}disableClusterBrowsing(){Ko(this),this._clearBrowsedClusterGraphics()}enableClusterBrowsing(){return g(this,null,function*(){let{view:e,selectedFeature:t}=this;e?.type==="2d"?Pe(t)?(yield Xo(this),yield Yo(this)):B.getLogger(this).warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",t):B.getLogger(this).warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",t)})}handleViewClick(e){this._fetchFeaturesAndOpen(e)}_animationStateChange(e){this.zoomToLocation||(Ce.disabled=e==="waiting-for-target")}_clearBrowsedClusterGraphics(){let e=[this.selectedClusterBoundaryFeature,this._selectedClusterFeature].filter(be);this.view?.graphics?.removeMany(e),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){if(Pe(this.selectedFeature))return this.browseClusterEnabled=!1,this.visible=!1,void this.clear();this.browseClusterEnabled&&(this.features=this.selectedFeature?[this.selectedFeature]:[])}_locationChange(e){let{selectedFeature:t,updateLocationEnabled:i,view:o}=this;o&&i&&e&&(!t||t.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>1?1:null}_setGraphicOnFeatureViewModels(){let{features:e,featureCount:t,featurePage:i,featuresPerPage:o,featureViewModels:n}=this;if(i===null)return;let a=((i-1)*o+t)%t,l=a+o;n.slice(a,l).forEach((d,u)=>{d&&(d.graphic??=e[a+u])})}_selectedFeatureChange(e){return g(this,null,function*(){let{location:t,updateLocationEnabled:i,view:o}=this;if(!e||!o)return;if(this.browseClusterEnabled)return this._selectedClusterFeature&&(o.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),Pe(e)?void 0:(e.symbol=yield ii(e),this._selectedClusterFeature=e,void o.graphics.add(this._selectedClusterFeature));let n=e.sourceLayer?.type;if(n!=="map-image"&&n!=="imagery"&&n!=="imagery-tile"||(e.symbol=yield ii(e)),!i&&t||!e.geometry){if(i&&!e.geometry){yield this.centerAtLocation();let a=o.center?.clone();a&&(this.location=a)}}else this.location=tt(e.geometry)})}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}_setFetchFeaturesPromises(e){return g(this,null,function*(){let{pendingFeatures:t}=yield this._fetchFeaturesWithController({mapPoint:e});this.promises=t})}_destroyFeatureVMs(){this.featureViewModels.forEach(e=>e&&!e.destroyed&&e.destroy()),this._set("featureViewModels",[])}_updateFeatureVMs(){let{selectedFeature:e,features:t,featureViewModels:i,view:o,spatialReference:n,map:a,timeZone:l,location:d}=this;if(Pe(e)||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),!t?.length)return;let u=i.slice(0),p=[];t.forEach((h,m)=>{if(!h)return;let v=null;if(u.some((y,b)=>(y&&y.graphic===h&&(v=y,u.splice(b,1)),!!v)),v)p[m]=v;else{let y=new ct({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:n,graphic:h===e?h:null,location:d,map:a,view:o,timeZone:l});p[m]=y}}),u.forEach(h=>h&&!h.destroyed&&h.destroy()),this._set("featureViewModels",p)}_getScreenPoint(e,t){return g(this,null,function*(){let{spatialReference:i,view:o}=this;if(!o)return null;yield o?.when();let n=e?.spatialReference;return n&&i?(yield Bi(n,i,null,t),o.toScreen(e)):null})}_cancelFetchingFeatures(){let e=this._fetchFeaturesController;e&&e.abort(),this._fetchFeaturesController=null}_projectScreenPointAndFetchFeatures(n){return g(this,arguments,function*({mapPoint:e,screenPoint:t,event:i,signal:o}){return this.fetchFeatures(t??(yield this._getScreenPoint(e??this.location,{signal:o})),{signal:o,event:i})})}_fetchFeaturesWithController({mapPoint:e,screenPoint:t,event:i}){this._cancelFetchingFeatures();let o=new AbortController,{signal:n}=o;this._fetchFeaturesController=o;let a=this._projectScreenPointAndFetchFeatures({mapPoint:e,screenPoint:t,signal:n,event:i});return a.catch(()=>{}).then(()=>{this._fetchFeaturesController=null}),a}_fetchFeaturesAndOpen(e){return g(this,null,function*(){let{mapPoint:t,screenPoint:i}=e,{view:o}=this;this.removeHandles(Fi),this.addHandles([f(()=>this.view?.scale,()=>this._debouncedLocationUpdate(t).catch(a=>{Ke(a)||B.getLogger(this).error(a)})),xe(()=>!this.visible,()=>{this.removeHandles(Fi)},{once:!0})],Fi);let{pendingFeatures:n}=yield this._fetchFeaturesWithController({mapPoint:t,screenPoint:i,event:e});o?.popup&&"open"in o.popup&&o.popup.open({location:t??void 0,promises:n})})}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}_getLayerView(e,t){return g(this,null,function*(){return yield e.when(),e.whenLayerView(t)})}_getHighlightLayer(e){let{layer:t,sourceLayer:i}=e;return i&&"layer"in i&&i.layer?i.layer:i?.type==="map-notes"||i?.type==="subtype-group"?i:t}_getHighlightTarget(e,t,i){if(Vr(t.type,i))return e;let o=e.getObjectId();if(o!=null)return o;let n=t.type==="imagery"?void 0:"objectIdField"in t?t.objectIdField||Qo:null,a=e.attributes;return a&&n&&a[n]||e}_mapIncludesLayer(e){return!!this.map?.allLayers?.includes(e)}_highlightActiveFeature(){return g(this,null,function*(){let e="highlight-active-feature";this.removeHandles(e);let{highlightEnabled:t,view:i,activeFeature:o,visible:n}=this;if(!(o&&i&&t&&n))return;let a=this._getHighlightLayer(o);if(!(a&&a instanceof Kt&&this._mapIncludesLayer(a)))return;let l=this._getLayerView(i,a);this._highlightActiveFeaturePromise=l;let d=yield l;if(!(d&&oi(d)&&this._highlightActiveFeaturePromise===l&&this.activeFeature&&this.highlightEnabled))return;let u=d.highlight(this._getHighlightTarget(o,a,i.type));this.addHandles(u,e)})}_highlightSelectedFeature(){return g(this,null,function*(){let e="highlight-selected-feature";this.removeHandles(e);let{selectedFeature:t,highlightEnabled:i,view:o,visible:n}=this;if(!(t&&o&&i&&n))return;let a=this._getHighlightLayer(t);if(!(a&&a instanceof Kt&&this._mapIncludesLayer(a)))return;let l=this._getLayerView(o,a);this._highlightSelectedFeaturePromise=l;let d=yield l;if(!(d&&oi(d)&&this._highlightSelectedFeaturePromise===l&&this.selectedFeature&&this.highlightEnabled&&this.visible))return;let u=d.highlight(this._getHighlightTarget(t,a,o.type));this.addHandles(u,e)})}_updateFeatures(e){let{features:t}=this,i=e.filter(o=>!t.includes(o));i?.length&&(this.features=t.concat(i))}};r([s()],C.prototype,"_fetchFeaturesController",void 0),r([s({type:Ie})],C.prototype,"actions",void 0),r([s({readOnly:!0})],C.prototype,"active",null),r([s()],C.prototype,"activeFeature",void 0),r([s({readOnly:!0})],C.prototype,"allActions",null),r([s()],C.prototype,"autoCloseEnabled",void 0),r([s()],C.prototype,"browseClusterEnabled",void 0),r([s()],C.prototype,"content",void 0),r([s({type:Ie,readOnly:!0})],C.prototype,"defaultActions",null),r([s({type:Boolean})],C.prototype,"defaultPopupTemplateEnabled",void 0),r([s({readOnly:!0})],C.prototype,"featureCount",null),r([s()],C.prototype,"featurePage",void 0),r([s({value:[]})],C.prototype,"features",null),r([s()],C.prototype,"featuresPerPage",void 0),r([s()],C.prototype,"featureMenuOpen",void 0),r([s()],C.prototype,"featureViewModelAbilities",void 0),r([s({readOnly:!0})],C.prototype,"featureViewModels",void 0),r([s()],C.prototype,"highlightEnabled",void 0),r([s()],C.prototype,"includeDefaultActions",void 0),r([s({type:ze})],C.prototype,"location",null),r([s()],C.prototype,"map",null),r([s({readOnly:!0})],C.prototype,"pendingPromisesCount",null),r([s({readOnly:!0})],C.prototype,"promiseCount",null),r([s()],C.prototype,"promises",null),r([s({readOnly:!0})],C.prototype,"selectedClusterBoundaryFeature",void 0),r([s({value:null,readOnly:!0})],C.prototype,"selectedFeature",null),r([s({value:-1})],C.prototype,"selectedFeatureIndex",null),r([s({readOnly:!0})],C.prototype,"selectedFeatureViewModel",null),r([s({readOnly:!0})],C.prototype,"state",null),r([s()],C.prototype,"timeZone",null),r([s()],C.prototype,"title",void 0),r([s()],C.prototype,"updateLocationEnabled",void 0),r([s()],C.prototype,"view",void 0),r([s()],C.prototype,"visible",void 0),r([s({readOnly:!0})],C.prototype,"waitingForContents",null),r([s({readOnly:!0})],C.prototype,"waitingForResult",null),r([s()],C.prototype,"zoomFactor",void 0),r([s()],C.prototype,"zoomToLocation",void 0),r([s()],C.prototype,"centerAtLocation",null),C=r([w("esri.widgets.Features.FeaturesViewModel")],C);var ut=C;var ue=class extends U{constructor(){super(...arguments),this.actionBar=!0,this.closeButton=!0,this.collapseButton=!1,this.featureNavigation=!0,this.featureListLayerTitle=!0,this.flow=!0,this.heading=!0,this.spinner=!0}};r([s({type:Boolean,nonNullable:!0})],ue.prototype,"actionBar",void 0),r([s({type:Boolean,nonNullable:!0})],ue.prototype,"closeButton",void 0),r([s({type:Boolean,nonNullable:!0})],ue.prototype,"collapseButton",void 0),r([s({type:Boolean,nonNullable:!0})],ue.prototype,"featureNavigation",void 0),r([s({type:Boolean,nonNullable:!0})],ue.prototype,"featureListLayerTitle",void 0),r([s({type:Boolean,nonNullable:!0})],ue.prototype,"flow",void 0),r([s({type:Boolean,nonNullable:!0})],ue.prototype,"heading",void 0),r([s({type:Boolean,nonNullable:!0})],ue.prototype,"spinner",void 0),ue=r([w("esri.widgets.Features.FeaturesVisibleElements")],ue);var Mi=ue;var Jo="selected-index",Br=0,er="features-spinner",Dr=50;function tr(e){return e?.declaredClass.startsWith("esri.layers.")??!1}var x=class extends Vt(S){constructor(e,t){super(e,t),this._featureMenuIntersectionObserverCallback=([i])=>{i?.isIntersecting&&this.viewModel.featurePage!=null&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback,{root:window.document}),this._featureMenuIntersectionObserverNode=null,this._focusOn=null,this._spinner=null,this._feature=null,this._relatedRecordsFlowItems=new he,this._relatedRecordsWidget=new Zo({flowItems:this._relatedRecordsFlowItems}),this._rootFlowItemNode=null,this._featureMenuViewportNode=null,this._actionBarMenuNode=null,this.collapsed=!1,this.featureNavigationTop=!1,this.headerActions=new Ie,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.responsiveActionsEnabled=!1,this.viewModel=new ut,this.visibleElements=new Mi,this._renderAction=(i,o)=>{let n=this._getActionTitle(i),{type:a,active:l,uid:d,disabled:u,indicator:p}=i;return i.visible?c("calcite-action",{active:a==="toggle"&&i.value,appearance:"solid",bind:this,"data-action-uid":d,disabled:u,icon:this._getActionIcon(i),indicator:p,key:`action-${o}`,loading:l,onclick:this._triggerAction,scale:"s",text:n,title:this._hideActionText?n:void 0},this._getFallbackIcon(i)):null},this._openFeatureMenu=()=>{this.featureMenuOpen=!0,this._focusOn="menu-flow-item"},this._previousFeature=()=>{this.viewModel.selectedFeatureIndex--},this._nextFeature=()=>{this.viewModel.selectedFeatureIndex++},this._handleFeatureMenuBack=()=>{this.featureMenuOpen&&(this._focusOn="root-flow-item",this.featureMenuOpen=!1)},this._focusFlowItemNode=i=>{this._focusOn===i&&requestAnimationFrame(()=>g(this,null,function*(){switch(i){case"menu-flow-item":yield this._featureMenuViewportNode?.setFocus();break;case"root-flow-item":yield this._rootFlowItemNode?.setFocus()}this._focusOn=null}))},this._focusFlowItemNodeThrottled=Ne(this._focusFlowItemNode,Dr),this._displaySpinnerThrottled=Ne(()=>this._displaySpinner(),Br),this._addSelectedFeatureIndexHandle(),this.addHandles([this._displaySpinnerThrottled,this._focusFlowItemNodeThrottled,f(()=>this.viewModel?.active,()=>this._toggleScreenLocationEnabled()),f(()=>this.viewModel?.active,i=>this._relatedRecordsWidget.closed=!i),f(()=>this.visibleElements?.closeButton,i=>this._relatedRecordsWidget.closable=i),f(()=>this.visibleElements?.spinner,i=>this._spinnerEnabledChange(i)),f(()=>this.viewModel?.view,(i,o)=>this._viewChange(i,o)),f(()=>this.viewModel?.view?.ready,(i,o)=>this._viewReadyChange(i??!1,o??!1)),f(()=>[this.viewModel?.waitingForResult,this.viewModel?.location],()=>{this._hideSpinner(),this._displaySpinnerThrottled()}),f(()=>this.viewModel?.screenLocation,()=>this._closeOpenActionMenu()),f(()=>this.selectedFeatureWidget,()=>this._destroyRelatedRecordsFlowItemWidgets()),f(()=>{let i=this.selectedFeatureWidget?.viewModel;return[i?.title,i?.state]},()=>this._setTitleFromFeatureWidget()),f(()=>{let i=this.selectedFeatureWidget?.viewModel;return[i?.content,i?.state]},()=>this._setContentFromFeatureWidget()),f(()=>this.viewModel?.featureViewModels,()=>this._featureMenuViewportScrollTop()),this._relatedRecordsWidget.on("close",()=>this.close()),this._relatedRecordsWidget.on("exit",()=>this._destroyRelatedRecordsFlowItemWidgets()),this._relatedRecordsWidget.on("open-related-feature",({feature:i})=>this._openRelatedFeature(i))])}loadDependencies(){return ee({action:()=>import("./chunk-EANCIRMG.js"),"action-bar":()=>import("./chunk-RTCS4G4F.js"),"action-group":()=>import("./chunk-66BFMTTX.js"),button:()=>import("./chunk-J63POI2Y.js"),flow:()=>import("./chunk-6T4OTXVC.js"),"flow-item":()=>import("./chunk-M34V2RC7.js"),list:()=>import("./chunk-DB7XGNRL.js"),"list-item":()=>import("./chunk-4FFGJW4G.js"),"list-item-group":()=>import("./chunk-ONEUWIUZ.js"),loader:()=>import("./chunk-F63PXXTQ.js")})}destroy(){this._destroyRelatedRecordsFlowItemWidgets(),this._destroySelectedFeatureWidget(),this._destroySpinner(),this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver?.disconnect(),this._relatedRecordsWidget?.destroy()}get _hideActionText(){if(!this.responsiveActionsEnabled)return!1;let e=this.view?.widthBreakpoint;return e==="xsmall"||e==="small"||e==="medium"}get _featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation}get _isCollapsed(){return this._collapseEnabled&&this.collapsed}get _collapseEnabled(){return this.visibleElements.collapseButton&&!!this.title&&!!this.content}get active(){return this.viewModel.active}get content(){return this.viewModel.content}set content(e){this.viewModel.content=e}get icon(){return null}get featureMenuOpen(){return this.viewModel.featureMenuOpen}set featureMenuOpen(e){this.viewModel.featureMenuOpen=e}get features(){return this.viewModel.features}set features(e){this.viewModel.features=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get map(){return this.viewModel.map}set map(e){this.viewModel.map=e}get promises(){return this.viewModel.promises}set promises(e){this.viewModel.promises=e}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(e){this.viewModel.selectedFeatureIndex=e}get selectedFeatureWidget(){let{_feature:e,headingLevel:t,_relatedRecordsFlowItems:i,timeZone:o,spatialReference:n,map:a}=this,{selectedFeatureViewModel:l}=this.viewModel,d={title:!1};return l?(e?(e.viewModel=l,e.visibleElements=d):this._feature=new jo({flowItems:i,headingLevel:t+1,timeZone:o,spatialReference:n,map:a,viewModel:l,visibleElements:d}),this._feature):null}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(e){this.viewModel.spatialReference=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}get timeZone(){return this.viewModel.timeZone}set timeZone(e){this.viewModel.timeZone=e}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(e){this.viewModel.updateLocationEnabled=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}blur(){let{active:e}=this.viewModel;e?this._rootFlowItemNode?.blur():B.getLogger(this).warn("Features can only be blurred when currently active.")}clear(){return this.viewModel.clear()}close(){this.viewModel.visible=!1}fetchFeatures(e,t){return this.viewModel.fetchFeatures(e,t)}focus(){let{active:e}=this.viewModel;e?this._setFocusOn():B.getLogger(this).warn("Features can only be focused when currently active.")}next(){return this.viewModel.next()}open(e){this.removeHandles(Jo);let t={collapsed:e?.collapsed??!1};this.set(t),this.viewModel.open(e),this.addHandles(xe(()=>!this.viewModel.waitingForResult,()=>this._addSelectedFeatureIndexHandle(),{once:!0}))}previous(){return this.viewModel.previous()}triggerAction(e){return this.viewModel.triggerAction(e)}render(){return c("div",{bind:this,class:this.classes(j.base,M.widget,M.panel),onkeydown:this._onMainKeydown},this._renderHeader(),this._renderContentContainer())}_renderFeatureNavigation(){return[this._renderPagination(),this._renderFeatureMenuButton()]}_renderHeader(){return!this.featureMenuOpen&&this.featureNavigationTop&&this._featureNavigationVisible?c("div",{class:j.header,key:"header-actions"},this._renderFeatureNavigation()):null}_renderFooter(){return this.featureMenuOpen||this.featureNavigationTop||!this._featureNavigationVisible?null:c("div",{class:j.footer,key:"footer-actions",slot:"footer"},this._renderFeatureNavigation())}_renderFeatureMenuButton(){let{messages:e,viewModel:t}=this,{featureCount:i,selectedFeatureIndex:o,pendingPromisesCount:n}=t;return c("calcite-action",{appearance:"solid",bind:this,icon:"list",key:"feature-menu-button",label:e.selectFeature,loading:n>0,onclick:this._openFeatureMenu,scale:"s",text:G(e.pageText,{index:Zt(o+1),total:Zt(i)}),textEnabled:!0,title:e.selectFeature})}_renderPagination(){let{previous:e,next:t}=this.messagesCommon.pagination;return c("calcite-action-bar",{class:j.paginationActionBar,expandDisabled:!0,key:"pagination-action-bar",layout:"horizontal",overflowActionsDisabled:!0,scale:"s"},c("calcite-action-group",{scale:"s"},c("calcite-action",{appearance:"solid",class:j.paginationPrevious,icon:"chevron-left",iconFlipRtl:!0,label:e,onclick:this._previousFeature,scale:"s",text:e,title:e}),c("calcite-action",{appearance:"solid",icon:"chevron-right",iconFlipRtl:!0,label:t,onclick:this._nextFeature,scale:"s",text:t,title:t})))}_renderFeatureMenuItem(e){let{selectedFeatureViewModel:t,featureViewModels:i}=this.viewModel,o=e===t,n=i.indexOf(e);return c("calcite-list-item",{bind:this,"data-feature-index":n,key:`feature-menu-item-${e.uid}`,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onmouseleave:this._removeActiveFeature,onmouseover:this._setActiveFeature,selected:o,onCalciteListItemSelect:this._selectFeature},c("span",{innerHTML:e.title||this.messagesCommon.untitled,slot:"content"}))}_groupResultsByLayer(){let{featureViewModels:e}=this.viewModel,t=new Map;return e.forEach(i=>{let o=i?.graphic;if(!o)return;let{layer:n,sourceLayer:a}=o,l=(tr(n)?n:null)||(tr(a)?a:null),d=t.get(l)??[];t.set(l,[...d,i])}),t}_renderFeatureMenu(){let{featureViewModels:e}=this.viewModel,t=this._groupResultsByLayer();return e.length?c("calcite-list",{selectionAppearance:"icon",selectionMode:"single"},Array.from(t.keys(),i=>{let o=t.get(i)?.map(a=>this._renderFeatureMenuItem(a)),n=i?i.title??this.messagesCommon.untitled:null;return this.visibleElements.featureListLayerTitle&&n!==null?c("calcite-list-item-group",{heading:n,key:i?.uid||"map-graphics"},o):o})):null}_renderHeaderAction(e,t){let i=e.title||"";return e.visible?c("calcite-action",{active:e.type==="toggle"&&e.value,appearance:"solid",bind:this,"data-action-uid":e.uid,disabled:e.disabled,icon:e.icon??void 0,indicator:e.indicator,key:`header-action-${t}`,loading:e.active,onclick:this._triggerHeaderAction,slot:"header-actions-end",text:i,title:i}):null}_renderHeaderActions(){return this.headerActions.map((e,t)=>this._renderHeaderAction(e,t)).toArray()}_renderContentFeature(){let{headingLevel:e,visibleElements:t,_isCollapsed:i,_collapseEnabled:o,featureNavigationTop:n}=this,{title:a,active:l}=this.viewModel,d=t.heading&&a?a:"";return c("calcite-flow-item",{afterCreate:this._storeRootFlowItemNode,afterUpdate:this._focusRootFlowItemNode,bind:this,class:this.classes({[j.contentFeature]:!0,[j.flowItemCollapsed]:i}),closable:t.closeButton,closed:!l,collapsed:i,collapseDirection:n?"down":"up",collapsible:o,headingLevel:e,key:"root-flow-item",onCalciteFlowItemClose:this.close,onCalciteFlowItemToggle:this._handleCollapseToggle},d?c(je,{class:this.classes(j.featuresHeading,M.heading),innerHTML:d,key:"header-content",level:this.headingLevel,slot:"header-content"}):null,this._renderHeaderActions(),this._renderActionBar(),i?null:c("div",{class:this.classes(j.container,j.contentContainer)},this._renderContent()),this._renderFooter())}_renderFeatureMenuContainer(){let{viewModel:e,featureMenuOpen:t,messages:i,messagesCommon:o}=this,{active:n,featureViewModels:a,pendingPromisesCount:l}=e;return t?c("calcite-flow-item",{afterCreate:this._storeFeatureMenuFlowItemNode,afterUpdate:this._focusFeatureMenuFlowItemNode,bind:this,closable:!1,closed:!n,description:G(i.total,{total:a.length}),heading:i.selectFeature,key:"feature-menu",loading:e.waitingForContents,onCalciteFlowItemBack:d=>{d.preventDefault(),this._handleFeatureMenuBack()}},l>0?c("calcite-loader",{class:j.loader,inline:!0,key:"feature-menu-loader",label:o.loading,slot:"header-actions-end"}):null,c("div",{class:j.container},this._renderFeatureMenu()),c("div",{afterCreate:this._featureMenuIntersectionObserverCreated,bind:this,class:j.featureMenuObserver}),c("calcite-button",{appearance:"transparent",onclick:this._handleFeatureMenuBack,slot:"footer-actions",width:"full"},o.back)):null}_renderContentContainer(){let e=[this._renderContentFeature(),this._renderFeatureMenuContainer(),this._relatedRecordsWidget.render()];return this.visibleElements.flow?c("calcite-flow",{key:"content-container"},e):e}_getFallbackIcon(e){let{className:t,icon:i}=e;if(i)return null;let o=go({action:e,feature:this.selectedFeature}),n={[j.icon]:!!t,[j.actionImage]:!!o};return t&&(n[t]=!0),o||t?c("span",{"aria-hidden":"true",class:this.classes(j.icon,n),key:"icon",styles:fo(o)}):null}_renderActionBar(){return!this._isCollapsed&&this.visibleElements.actionBar&&this.viewModel.allActions?.length?c("calcite-action-bar",{expandDisabled:!0,expanded:!this._hideActionText,key:"header-action-bar",scale:"s",slot:"action-bar"},c("calcite-action-group",{afterCreate:e=>this._actionBarMenuNode=e,overlayPositioning:"fixed",scale:"s"},this._renderActions())):null}_renderActions(){return this.viewModel.allActions.toArray().map(this._renderAction)}_renderContent(){let e=this.viewModel?.content;return e?typeof e=="string"?c("div",{class:V.contentNode,innerHTML:e,key:e}):this.renderNodeContent(e):null}_setFocusOn(){this.renderNow(),requestAnimationFrame(()=>{this._focusOn=this.featureMenuOpen?"menu-flow-item":"root-flow-item"})}_handleCollapseToggle(){this.collapsed=!this.collapsed}_openRelatedFeature(e){return g(this,null,function*(){yield e.viewModel.updateGeometry();let t=e.graphic,i=t?.geometry;if(i==null||t==null)return;this._destroyRelatedRecordsFlowItemWidgets(),yield this.viewModel.zoomTo({target:i});let o=tt(i);this.open({features:[t],location:o??void 0})})}_focusRootFlowItemNode(){this._focusFlowItemNodeThrottled("root-flow-item")}_focusFeatureMenuFlowItemNode(){this._focusFlowItemNodeThrottled("menu-flow-item")}_storeRootFlowItemNode(e){this._rootFlowItemNode=e,this._focusFlowItemNodeThrottled("root-flow-item")}_storeFeatureMenuFlowItemNode(e){this._featureMenuViewportNode=e,this._focusFlowItemNodeThrottled("menu-flow-item")}_setActiveFeature(e){let{viewModel:t}=this,i=e.currentTarget["data-feature-index"];t.activeFeature=t.features?.[i]||null}_removeActiveFeature(){this.viewModel.activeFeature=null}_selectFeature(e){let t=e.currentTarget["data-feature-index"];isNaN(t)||(this.viewModel.selectedFeatureIndex=t),this._handleFeatureMenuBack()}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(e){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(e),this._featureMenuIntersectionObserverNode=e}_getActionIcon(e){return e.icon?e.icon:e.image||e.className?void 0:"question"}_getActionTitle(e){let{messages:t,selectedFeature:i,messagesCommon:o}=this,{id:n}=e,a=i?.attributes,l=e.title??"",d=n==="zoom-to-feature"?G(l,{messages:t}):n==="remove-selected-feature"?G(l,{messages:o}):n==="zoom-to-clustered-features"||n==="browse-clustered-features"?G(l,{messages:t}):e.title;return d&&a?G(d,a):d??""}_onMainKeydown(e){let{key:t}=e;t==="ArrowLeft"&&(e.stopPropagation(),this._handleFeatureMenuBack(),this.previous()),t==="ArrowRight"&&(e.stopPropagation(),this._handleFeatureMenuBack(),this.next())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&this._featureMenuViewportNode.scrollContentTo({top:0})}_setContentFromFeatureWidget(){let{selectedFeatureWidget:e}=this;e&&(this.viewModel.content=e)}_setTitleFromFeatureWidget(){let{selectedFeatureWidget:e,messagesCommon:t}=this,i=e?.viewModel;e&&(this.viewModel.title=i?.state==="error"?t?.errorMessage:i?.title||"")}_addSelectedFeatureIndexHandle(){let e=f(()=>this.viewModel?.selectedFeatureIndex,(t,i)=>this._selectedFeatureIndexUpdated(t,i));this.addHandles(e,Jo)}_selectedFeatureIndexUpdated(e,t){let{featureCount:i}=this.viewModel;i&&e!==t&&e!==-1&&(this._destroyRelatedRecordsFlowItemWidgets(),this._rootFlowItemNode&&this._rootFlowItemNode.scrollContentTo({top:0}))}_triggerHeaderAction(e){let t=e.currentTarget;if(t.disabled)return;let i=t.dataset.actionUid,o=this.headerActions.find(({uid:n})=>n===i);o&&!o.disabled&&(o?.type==="toggle"&&(o.value=!o.value),this.emit("trigger-header-action",{action:o}))}_triggerAction(e){let t=e.currentTarget;if(t.disabled)return;let i=t.dataset.actionUid,{allActions:o}=this.viewModel,n=o.findIndex(l=>l.uid===i),a=o.at(n);a&&a.type==="toggle"&&(a.value=!a.value),this.viewModel.triggerAction(n)}_createSpinner(e){e&&(this._spinner=new Uo({view:e}),e.ui.add(this._spinner,{key:er,position:"manual",internal:!0}))}_wireUpView(e){this._destroySpinner(),e&&this.visibleElements?.spinner&&this._createSpinner(e)}_hideSpinner(){let{_spinner:e}=this;e&&(e.location=null,e.hide())}_viewReadyChange(e,t){e?this._wireUpView(this.viewModel?.view):t&&this.viewModel.clear()}_viewChange(e,t){e&&t&&this.viewModel.clear()}_destroySelectedFeatureWidget(){let{_feature:e}=this;e&&(e.viewModel=null,!e.destroyed&&e.destroy()),this._feature=null}_closeOpenActionMenu(){let{_actionBarMenuNode:e}=this;e&&(e.menuOpen=!1)}_destroyRelatedRecordsFlowItemWidgets(){this._relatedRecordsFlowItems.drain(e=>{"showAllEnabled"in e.viewModel&&(e.viewModel.showAllEnabled=!1),e.viewModel=null,e.destroy()})}_toggleScreenLocationEnabled(){let{viewModel:e}=this;e&&(e.screenLocationEnabled=e.active)}_displaySpinner(){let{_spinner:e}=this;if(!e)return;let{location:t,waitingForResult:i}=this.viewModel;i&&t?e.show({location:t}):e.hide()}_destroySpinner(){let{_spinner:e,view:t}=this;e&&(t?.ui?.remove(e,er),e.destroy(),this._spinner=null)}_spinnerEnabledChange(e){this._destroySpinner(),e&&this._createSpinner(this.viewModel?.view)}};r([s()],x.prototype,"_focusOn",void 0),r([s()],x.prototype,"_relatedRecordsFlowItems",void 0),r([s()],x.prototype,"_hideActionText",null),r([s()],x.prototype,"_featureNavigationVisible",null),r([s()],x.prototype,"_isCollapsed",null),r([s()],x.prototype,"_collapseEnabled",null),r([s({readOnly:!0})],x.prototype,"active",null),r([s()],x.prototype,"collapsed",void 0),r([s()],x.prototype,"content",null),r([s()],x.prototype,"icon",null),r([s()],x.prototype,"featureMenuOpen",null),r([s()],x.prototype,"featureNavigationTop",void 0),r([s()],x.prototype,"features",null),r([s()],x.prototype,"goToOverride",null),r([s({type:Ie})],x.prototype,"headerActions",void 0),r([s()],x.prototype,"headingLevel",void 0),r([s()],x.prototype,"location",null),r([s()],x.prototype,"label",null),r([s()],x.prototype,"map",null),r([s(),W("esri/widgets/Features/t9n/Features")],x.prototype,"messages",void 0),r([s(),W("esri/t9n/common")],x.prototype,"messagesCommon",void 0),r([s()],x.prototype,"promises",null),r([s()],x.prototype,"responsiveActionsEnabled",void 0),r([s({readOnly:!0})],x.prototype,"selectedFeature",null),r([s()],x.prototype,"selectedFeatureIndex",null),r([s({readOnly:!0})],x.prototype,"selectedFeatureWidget",null),r([s()],x.prototype,"spatialReference",null),r([s()],x.prototype,"title",null),r([s()],x.prototype,"timeZone",null),r([s()],x.prototype,"updateLocationEnabled",null),r([s()],x.prototype,"view",null),r([s({type:ut}),Tt(["triggerAction","trigger-action"])],x.prototype,"viewModel",void 0),r([s({type:Mi,nonNullable:!0})],x.prototype,"visibleElements",void 0),r([s()],x.prototype,"visible",null),x=r([w("esri.widgets.Features")],x);var ir=x;var oe="esri-popup",We=`${oe}--is-docked`,D={base:oe,baseHidden:`${oe}--hidden`,main:`${oe}__main-container`,shadow:`${oe}--shadow`,isDocked:We,isDockedTopLeft:`${We}-top-left`,isDockedTopCenter:`${We}-top-center`,isDockedTopRight:`${We}-top-right`,isDockedBottomLeft:`${We}-bottom-left`,isDockedBottomCenter:`${We}-bottom-center`,isDockedBottomRight:`${We}-bottom-right`,alignTopCenter:`${oe}--aligned-top-center`,alignBottomCenter:`${oe}--aligned-bottom-center`,alignTopLeft:`${oe}--aligned-top-left`,alignBottomLeft:`${oe}--aligned-bottom-left`,alignTopRight:`${oe}--aligned-top-right`,alignBottomRight:`${oe}--aligned-bottom-right`,pointer:`${oe}__pointer`,pointerDirection:`${oe}__pointer-direction`};var Ii=class extends ut{constructor(e){super(e)}};Ii=r([w("esri.widgets.Popup.PopupViewModel")],Ii);var Ci=Ii;var ve=class extends U{constructor(){super(...arguments),this.actionBar=!0,this.closeButton=!0,this.collapseButton=!0,this.featureNavigation=!0,this.featureListLayerTitle=!0,this.heading=!0,this.spinner=!0}};r([s({type:Boolean,nonNullable:!0})],ve.prototype,"actionBar",void 0),r([s({type:Boolean,nonNullable:!0})],ve.prototype,"closeButton",void 0),r([s({type:Boolean,nonNullable:!0})],ve.prototype,"collapseButton",void 0),r([s({type:Boolean,nonNullable:!0})],ve.prototype,"featureNavigation",void 0),r([s({type:Boolean,nonNullable:!0})],ve.prototype,"featureListLayerTitle",void 0),r([s({type:Boolean,nonNullable:!0})],ve.prototype,"heading",void 0),r([s({type:Boolean,nonNullable:!0})],ve.prototype,"spinner",void 0),ve=r([w("esri.widgets.Popup.PopupVisibleElements")],ve);var zt=ve;var or={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},E=class extends S{constructor(e,t){super(e,t),this._dockAction=new Oe({id:"popup-dock-action"}),this._featuresWidget=new ir({responsiveActionsEnabled:!0}),this._containerNode=null,this._mainContainerNode=null,this._pointerOffsetInPx=16,this.alignment="auto",this.dockEnabled=!1,this.headingLevel=2,this.messages=null,this.viewModel=new Ci,this.visibleElements=new zt}initialize(){this.addHandles([f(()=>[this.viewModel?.view?.widthBreakpoint,this.dockEnabled],()=>this._handleDockIcon(),I),f(()=>[this.dockEnabled,this.messages?.undock,this.messages?.dock],()=>this._handleDockEnabled(),I),f(()=>this.dockOptions,e=>{let{_dockAction:t}=this,i=this._featuresWidget.headerActions;i.remove(t),e.buttonEnabled&&i.add(t)},I),f(()=>this.viewModel?.screenLocation,()=>this._positionContainer()),f(()=>[this.viewModel?.active,this.dockEnabled],()=>this._toggleScreenLocationEnabled()),f(()=>[this.viewModel?.screenLocation,this.viewModel?.view?.padding,this.viewModel?.view?.size,this.viewModel?.active,this.viewModel?.location,this.alignment],()=>this.reposition()),f(()=>this.viewModel?.view?.size,(e,t)=>this._updateDockEnabledForViewSize(e,t)),f(()=>this.viewModel?.view,(e,t)=>this._viewChange(e,t)),f(()=>this.viewModel?.view?.ready,(e,t)=>this._viewReadyChange(e??!1,t??!1)),f(()=>this.viewModel,()=>this._featuresWidget.viewModel=this.viewModel,I),f(()=>this._featureNavigationTop,e=>this._featuresWidget.featureNavigationTop=e,I),f(()=>this.headingLevel,e=>this._featuresWidget.headingLevel=e,I),f(()=>this.visibleElements.actionBar,e=>this._featuresWidget.visibleElements.actionBar=!!e,I),f(()=>this.visibleElements.closeButton,e=>this._featuresWidget.visibleElements.closeButton=!!e,I),f(()=>this.visibleElements.collapseButton,e=>this._featuresWidget.visibleElements.collapseButton=!!e,I),f(()=>this.visibleElements.heading,e=>this._featuresWidget.visibleElements.heading=!!e,I),f(()=>this.visibleElements.spinner,e=>this._featuresWidget.visibleElements.spinner=!!e,I),f(()=>this.visibleElements.featureNavigation,e=>this._featuresWidget.visibleElements.featureNavigation=!!e,I),f(()=>this.visibleElements.featureListLayerTitle,e=>this._featuresWidget.visibleElements.featureListLayerTitle=!!e,I),re(()=>this._featuresWidget,"trigger-header-action",e=>{e.action===this._dockAction&&(this.dockEnabled=!this.dockEnabled)})])}normalizeCtorArgs(e){let t=_({},e);return e?.visibleElements!=null&&(t.visibleElements=new zt(e.visibleElements),e.collapseEnabled!=null&&(t.visibleElements.collapseButton=e.collapseEnabled),e.spinnerEnabled!=null&&(t.visibleElements.spinner=e.spinnerEnabled)),t}destroy(){this._dockAction.destroy(),this._featuresWidget?.destroy()}get _featureNavigationTop(){let{currentAlignment:e,currentDockPosition:t}=this;return e==="bottom-left"||e==="bottom-center"||e==="bottom-right"||t==="top-left"||t==="top-center"||t==="top-right"}get actions(){return this.viewModel.actions}set actions(e){this.viewModel.actions=e}get active(){return this.viewModel.active}get autoCloseEnabled(){return this.viewModel.autoCloseEnabled}set autoCloseEnabled(e){this.viewModel.autoCloseEnabled=e}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(e){this.viewModel.defaultPopupTemplateEnabled=e}get content(){return this.viewModel.content}set content(e){this.viewModel.content=e}get collapsed(){return this._featuresWidget.collapsed}set collapsed(e){this._featuresWidget.collapsed=e}get collapseEnabled(){return Ye(B.getLogger(this),"collapseEnabled",{replacement:"PopupVisibleElements.collapseButton",version:"4.29"}),this.visibleElements.collapseButton}set collapseEnabled(e){Ye(B.getLogger(this),"collapseEnabled",{replacement:"PopupVisibleElements.collapseButton",version:"4.29"}),this.visibleElements.collapseButton=e}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||or}set dockOptions(e){let t=_({},or),i=this.viewModel?.view?.breakpoints,o={};i&&(o.width=i.xsmall,o.height=i.xsmall);let n=_(_({},t),e),a=_(_({},t.breakpoint),o),{breakpoint:l}=n;typeof l=="object"?n.breakpoint=_(_({},a),l):l&&(n.breakpoint=a),this._set("dockOptions",n),this._setCurrentDockPosition(),this.reposition()}get featureCount(){return this.viewModel.featureCount}get featureMenuOpen(){return this.viewModel.featureMenuOpen}set featureMenuOpen(e){this.viewModel.featureMenuOpen=e}get features(){return this.viewModel.features}set features(e){this.viewModel.features=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get highlightEnabled(){return this.viewModel.highlightEnabled}set highlightEnabled(e){this.viewModel.highlightEnabled=e}get icon(){return"popup"}set icon(e){this._overrideIfSome("icon",e)}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get promises(){return this.viewModel.promises}set promises(e){this.viewModel.promises=e}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(e){this.viewModel.selectedFeatureIndex=e}get selectedFeatureWidget(){return this._featuresWidget.selectedFeatureWidget}get spinnerEnabled(){return Ye(B.getLogger(this),"spinnerEnabled",{replacement:"PopupVisibleElements.spinner",version:"4.29"}),this.visibleElements.spinner}set spinnerEnabled(e){Ye(B.getLogger(this),"spinnerEnabled",{replacement:"PopupVisibleElements.spinner",version:"4.29"}),this.visibleElements.spinner=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(e){this.viewModel.updateLocationEnabled=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}blur(){let{active:e}=this.viewModel;e||B.getLogger(this).warn("Popup can only be blurred when currently active."),this._featuresWidget.blur()}clear(){return this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(e,t){return this.viewModel.fetchFeatures(e,t)}focus(){let{active:e}=this.viewModel;e||B.getLogger(this).warn("Popup can only be focused when currently active."),this.reposition(),requestAnimationFrame(()=>{this._featuresWidget.focus()})}next(){return this.viewModel.next()}open(e){let t=!!e&&!!e.featureMenuOpen,i={collapsed:!!e&&!!e.collapsed,featureMenuOpen:t};this.set(i),this.viewModel.open(e),this._shouldFocus(e)}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(e){return this.viewModel.triggerAction(e)}render(){let{dockEnabled:e,currentAlignment:t,currentDockPosition:i}=this,{active:o,screenLocation:n}=this.viewModel,a=o&&e,l=o&&!e,d=this.selectedFeature?.layer?.title,u=this.selectedFeature?.layer?.id,p={[D.alignTopCenter]:t==="top-center",[D.alignBottomCenter]:t==="bottom-center",[D.alignTopLeft]:t==="top-left",[D.alignBottomLeft]:t==="bottom-left",[D.alignTopRight]:t==="top-right",[D.alignBottomRight]:t==="bottom-right",[D.isDocked]:a,[D.shadow]:l,[D.isDockedTopLeft]:i==="top-left",[D.isDockedTopCenter]:i==="top-center",[D.isDockedTopRight]:i==="top-right",[D.isDockedBottomLeft]:i==="bottom-left",[D.isDockedBottomCenter]:i==="bottom-center",[D.isDockedBottomRight]:i==="bottom-right"};return c("div",{afterCreate:this._positionContainer,afterUpdate:this._positionContainer,bind:this,class:this.classes(D.base,p,{[D.baseHidden]:!n&&!e}),"data-layer-id":u,"data-layer-title":d,role:"presentation"},o?[this._renderMainContainer(),this._renderPointer()]:null)}_renderPointer(){return this.dockEnabled?null:c("div",{class:D.pointer,key:"popup-pointer",role:"presentation"},c("div",{class:this.classes(D.pointerDirection,D.shadow)}))}_renderMainContainer(){let{dockEnabled:e}=this,t={[D.shadow]:e};return c("div",{afterCreate:this._setMainContainerNode,afterUpdate:this._setMainContainerNode,bind:this,class:this.classes(D.main,M.widget,t)},this._featuresWidget.render())}_shouldFocus(e){return g(this,null,function*(){e?.shouldFocus&&(yield Li(()=>this.viewModel?.active===!0),this.focus())})}_isOutsideView(e){let{popupHeight:t,popupWidth:i,screenLocation:o,side:n,view:a}=e;if(isNaN(i)||isNaN(t)||!a||!o)return!1;let l=a.padding;return n==="right"&&o.x+i/2>a.width-l.right||n==="left"&&o.x-i/2<l.left||n==="top"&&o.y-t<l.top||n==="bottom"&&o.y+t>a.height-l.bottom}_calculateAutoAlignment(e){if(e!=="auto")return e;let{_pointerOffsetInPx:t,_containerNode:i,_mainContainerNode:o,viewModel:n}=this,{screenLocation:a,view:l}=n;if(a==null||!l||!i)return"top-center";function d($){return parseInt($.replaceAll(/[^-\d.]/g,""),10)}let u=o?window.getComputedStyle(o,null):null,p=u?d(u.getPropertyValue("max-height")):0,h=u?d(u.getPropertyValue("height")):0,{height:m,width:v}=i.getBoundingClientRect(),y=v+t,b=Math.max(m,p,h)+t,T=this._isOutsideView({popupHeight:b,popupWidth:y,screenLocation:a,side:"right",view:l}),R=this._isOutsideView({popupHeight:b,popupWidth:y,screenLocation:a,side:"left",view:l}),A=this._isOutsideView({popupHeight:b,popupWidth:y,screenLocation:a,side:"top",view:l}),O=this._isOutsideView({popupHeight:b,popupWidth:y,screenLocation:a,side:"bottom",view:l});return R?A?"bottom-right":"top-right":T?A?"bottom-left":"top-left":A?O?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(e){return typeof e=="function"?e.call(this):e}_getCurrentAlignment(){let{alignment:e,dockEnabled:t}=this;return t||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(e)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(e){let t=["left","right"];return le(this.container)&&t.reverse(),e?.replace(/leading/gi,t[0]).replaceAll(/trailing/gi,t[1])}_callDockPosition(e){return typeof e=="function"?e.call(this):e}_getDockPosition(){return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition(this.dockOptions?.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_calculateAutoDockPosition(e){if(e!=="auto")return e;let t=this.viewModel?.view,i=le(this.container)?"top-left":"top-right";if(!t)return i;let o=t.padding||{left:0,right:0,top:0,bottom:0},n=t.width-o.left-o.right,{breakpoints:a}=t;return a&&n<=a.xsmall?"bottom-center":i}_getDockIcon(){let e=this._getDockPosition();if(this.dockEnabled)return"minimize";switch(e){case"top-left":case"bottom-left":return"dock-left";case"top-center":return"maximize";case"bottom-center":return"dock-bottom";default:return"dock-right"}}_handleDockIcon(){this._dockAction.icon=this._getDockIcon()}_handleDockEnabled(){this._dockAction.title=this.dockEnabled?this.messages?.undock:this.messages?.dock}_setMainContainerNode(e){this._mainContainerNode=e}_positionContainer(e=this._containerNode){if(e&&(this._containerNode=e),!this._containerNode)return;let{screenLocation:t}=this.viewModel,{width:i}=this._containerNode.getBoundingClientRect(),o=this._calculatePositionStyle(t,i);o&&Object.assign(this._containerNode.style,o)}_calculateFullWidth(e){let{currentAlignment:t,_pointerOffsetInPx:i}=this;return t==="top-left"||t==="bottom-left"||t==="top-right"||t==="bottom-right"?e+i:e}_calculateAlignmentPosition(e,t,i,o){let{currentAlignment:n,_pointerOffsetInPx:a}=this;if(!i)return;let{padding:l}=i,d=o/2,u=i.height-t,p=i.width-e;return n==="bottom-center"?{top:t+a-l.top,left:e-d-l.left}:n==="top-left"?{bottom:u+a-l.bottom,right:p+a-l.right}:n==="bottom-left"?{top:t+a-l.top,right:p+a-l.right}:n==="top-right"?{bottom:u+a-l.bottom,left:e+a-l.left}:n==="bottom-right"?{top:t+a-l.top,left:e+a-l.left}:n==="top-center"?{bottom:u+a-l.bottom,left:e-d-l.left}:void 0}_calculatePositionStyle(e,t){let{dockEnabled:i,view:o}=this;if(!o)return;if(i)return{left:"",top:"",right:"",bottom:""};if(e==null||!t)return;let n=this._calculateFullWidth(t),a=this._calculateAlignmentPosition(e.x,e.y,o,n);return a?{top:a.top!==void 0?`${a.top}px`:"auto",left:a.left!==void 0?`${a.left}px`:"auto",bottom:a.bottom!==void 0?`${a.bottom}px`:"auto",right:a.right!==void 0?`${a.right}px`:"auto"}:void 0}_viewChange(e,t){e&&t&&(this.close(),this.clear())}_viewReadyChange(e,t){e?this._wireUpView():t&&(this.close(),this.clear())}_wireUpView(){this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(e,t,i){let[o,n]=e,[a,l]=t,{width:d=0,height:u=0}=i??{};return o<=d&&a>d||o>d&&a<=d||n<=u&&l>u||n>u&&l<=u}_updateDockEnabledForViewSize(e,t){if(!e||!t)return;let i=this.viewModel?.view?.padding||{left:0,right:0,top:0,bottom:0},o=i.left+i.right,n=i.top+i.bottom,a=[],l=[];a[0]=e[0]-o,a[1]=e[1]-n,l[0]=t[0]-o,l[1]=t[1]-n;let{dockOptions:d}=this,u=d.breakpoint;this._dockingThresholdCrossed(a,l,u)&&this._setDockEnabledForViewSize(d),this._setCurrentDockPosition()}_toggleScreenLocationEnabled(){let{dockEnabled:e,viewModel:t}=this;if(!t)return;let i=t.active&&!e;t.screenLocationEnabled=i}_shouldDockAtCurrentViewSize(e){let t=e.breakpoint,i=this.viewModel?.view?.ui;if(!i)return!1;let{width:o,height:n}=i;if(isNaN(o)||isNaN(n)||!t)return!1;let a=t.hasOwnProperty("width")&&o<=(t.width??0),l=t.hasOwnProperty("height")&&n<=(t.height??0);return a||l}_setDockEnabledForViewSize(e){e.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(e))}};r([s({readOnly:!0})],E.prototype,"_featureNavigationTop",null),r([s()],E.prototype,"actions",null),r([s({readOnly:!0})],E.prototype,"active",null),r([s()],E.prototype,"alignment",void 0),r([s()],E.prototype,"autoCloseEnabled",null),r([s()],E.prototype,"defaultPopupTemplateEnabled",null),r([s()],E.prototype,"content",null),r([s()],E.prototype,"collapsed",null),r([s()],E.prototype,"collapseEnabled",null),r([s({readOnly:!0})],E.prototype,"currentAlignment",null),r([s({readOnly:!0})],E.prototype,"currentDockPosition",null),r([s()],E.prototype,"dockOptions",null),r([s()],E.prototype,"dockEnabled",void 0),r([s({readOnly:!0})],E.prototype,"featureCount",null),r([s()],E.prototype,"featureMenuOpen",null),r([s()],E.prototype,"features",null),r([s()],E.prototype,"goToOverride",null),r([s()],E.prototype,"headingLevel",void 0),r([s()],E.prototype,"highlightEnabled",null),r([s()],E.prototype,"icon",null),r([s()],E.prototype,"location",null),r([s()],E.prototype,"label",null),r([s(),W("esri/widgets/Popup/t9n/Popup")],E.prototype,"messages",void 0),r([s()],E.prototype,"promises",null),r([s({readOnly:!0})],E.prototype,"selectedFeature",null),r([s()],E.prototype,"selectedFeatureIndex",null),r([s({readOnly:!0})],E.prototype,"selectedFeatureWidget",null),r([s()],E.prototype,"spinnerEnabled",null),r([s()],E.prototype,"title",null),r([s()],E.prototype,"updateLocationEnabled",null),r([s()],E.prototype,"view",null),r([s({type:Ci}),Tt(["triggerAction","trigger-action"])],E.prototype,"viewModel",void 0),r([s()],E.prototype,"visible",null),r([s({type:zt,nonNullable:!0})],E.prototype,"visibleElements",void 0),E=r([w("esri.widgets.Popup")],E);var Lf=E;export{Lf as default};
