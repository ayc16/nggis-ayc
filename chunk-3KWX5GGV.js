import{B as cp,C as $r,D as pp,E as hp,F as lo,G as Me,H as Zi,I as co,L as di,N as Qr,O as dp,Q as ui,a as Jc,b as Ni,ba as et,c as Zs,ca as up,da as Ys,e as hi,ea as Se,f as fr,fa as Jr,g as gr,ga as mp,h as Kc,i as ep,ia as po,ja as fp,k as ip,ka as gp,l as op,la as vp,n as ne,ua as Ws,v as Ui,z as Bi}from"./chunk-QBGU4U42.js";import"./chunk-BJQH3R2Y.js";import{a as Sp,b as xp,c as wp}from"./chunk-US75X27K.js";import{a as ho,b as yp}from"./chunk-EAWGTJK3.js";import{a as _r}from"./chunk-2WMXPKXR.js";import"./chunk-KQ7IE7A4.js";import{b as _p}from"./chunk-L4N7O64W.js";import{b as bp}from"./chunk-REKWPGIN.js";import{b as Mp}from"./chunk-B3JBY4X6.js";import"./chunk-JAAOLJTO.js";import{a as jc,b as Lc,c as qc,d as $c,e as Qc}from"./chunk-RHRXOUJT.js";import{a as Ec,b as Pc,c as qr,d as io,e as dr,f as ro,k as Ac,l as Dc,n as ao,o as Fs}from"./chunk-UV5T4XE4.js";import{d as Rc,m as Ee,o as oo,p as Ic,r as Cc,s as ks,t as ur,u as so,v as At}from"./chunk-33NX2DRK.js";import{b as Xc}from"./chunk-GXCKH3OW.js";import{b as tp}from"./chunk-FVCRK5IX.js";import{a as rp,c as ap}from"./chunk-6W67IVZS.js";import"./chunk-CURQPDM4.js";import"./chunk-CUPRPTZ4.js";import{f as sp,g as np,h as lp}from"./chunk-B5ZLUQHV.js";import"./chunk-SFGIVWEM.js";import"./chunk-TB62XDET.js";import"./chunk-2TTSZYUA.js";import"./chunk-UJUCAWBP.js";import{a as si,b as ni,c as Hs}from"./chunk-EXOOWX4Z.js";import"./chunk-MVDBB2SU.js";import"./chunk-NJOVNAKA.js";import{a as Ka,b as oi}from"./chunk-I2LACOYT.js";import"./chunk-RCPMQJFX.js";import{B as uc,C as mc,D as Cs,G as fc,I as gc,J as _c,e as Na,f as sc,g as Wa,h as Xa,i as nc,j as lc,k as cc,l as pc,m as qa,o as Is,r as Ze,u as hc,x as dc}from"./chunk-G3QDAYGZ.js";import"./chunk-TXV2XM7Y.js";import{c as tc,d as $a}from"./chunk-SXPOFH4U.js";import"./chunk-PTPFKF3N.js";import"./chunk-FVCUBGKZ.js";import{a as pr}from"./chunk-6RS2QPMT.js";import"./chunk-QX5SMI65.js";import"./chunk-LCBWJNVO.js";import{a as Et,b as Rt,c as Pt}from"./chunk-JAXR3ZUJ.js";import{d as Ds,e as ic}from"./chunk-XN46SLSO.js";import"./chunk-UGL7UJES.js";import"./chunk-QKPKWNQQ.js";import"./chunk-IHA7ZQ4Q.js";import{a as js,b as N}from"./chunk-XSJRPCD6.js";import"./chunk-JRJHFO7J.js";import"./chunk-JR27VNVT.js";import"./chunk-WICM2VEE.js";import"./chunk-DUZ52FW3.js";import"./chunk-VLBUZRRG.js";import"./chunk-WGIVYVB4.js";import{b as Yt,d as Ua,i as rc,k as ac,l as M,m as Ba}from"./chunk-UKQRI6U4.js";import{a as wt}from"./chunk-UDMTFKLM.js";import"./chunk-BYXBJQAS.js";import"./chunk-L5A2ASNG.js";import"./chunk-3OLRRKKD.js";import"./chunk-PTXLSCMJ.js";import{a as cr,b as oc,d as Za,e as Ya,f as Ot,g as Tt}from"./chunk-AW3LMT4V.js";import"./chunk-LTJDZ7OM.js";import"./chunk-6EZU2A2D.js";import"./chunk-OZLCBZHH.js";import"./chunk-UTDAYTD2.js";import"./chunk-JCJ5KQ5Q.js";import"./chunk-TREMRME7.js";import"./chunk-C2FNHCAJ.js";import{a as zl}from"./chunk-ADDH3SWI.js";import"./chunk-GJBALZEB.js";import"./chunk-XAHD7XBV.js";import{a as Ca,b as ja,c as La,d as Va,h as za}from"./chunk-DL3OPG77.js";import{a as Bt,b as nr,c as Bl,d as lr,e as Zl,g as Hi,i as Yl}from"./chunk-RBP2Z7C6.js";import"./chunk-BYXBJQAS.js";import"./chunk-AIKSV6LF.js";import"./chunk-ELGDZDOQ.js";import"./chunk-NQ4QDYDP.js";import"./chunk-S26YVN25.js";import{a as Be,e as Ts,g as Wr,h as Ha}from"./chunk-DOFADBK3.js";import"./chunk-VYC75ESO.js";import"./chunk-ZN6YLP6I.js";import"./chunk-VVVTRG42.js";import"./chunk-CETY2ZOK.js";import"./chunk-CI3GTVLF.js";import"./chunk-Y6C54FDT.js";import"./chunk-5H3X7WYB.js";import{a as Ga}from"./chunk-GMW3QDVG.js";import"./chunk-RHABF3KL.js";import{b as Zr}from"./chunk-KRY2TW2S.js";import"./chunk-KLXERNY4.js";import{a as X}from"./chunk-OW7DVBQB.js";import"./chunk-ZCDCCVZZ.js";import"./chunk-UZSTUBKI.js";import"./chunk-HPYRFOMM.js";import{f as kl}from"./chunk-56SRKZHP.js";import"./chunk-YW3L7OMP.js";import{a as Al}from"./chunk-LAXYP2KV.js";import{b as Da}from"./chunk-TIXZ4OWB.js";import{a as Aa}from"./chunk-NDZXQR2V.js";import"./chunk-W5OI4BJ2.js";import{a as P}from"./chunk-UVJ5D37D.js";import"./chunk-2NH7HOKA.js";import{b as Rl,c as Ve,i as sr,r as Pl}from"./chunk-ZAQLF7TN.js";import"./chunk-JFY2XMDP.js";import"./chunk-ZHUHFKYD.js";import{a as Gi}from"./chunk-SKXQUOOX.js";import{a as Ll}from"./chunk-RKJVW4XE.js";import"./chunk-OIAELKUC.js";import{a as Ol,c as Tl}from"./chunk-I3DWOIS7.js";import{a as Vs,c as bc,d as Mc,e as to}from"./chunk-7H5UBCJY.js";import{A as Bc,B as ki,C as Zc,D as Yc,E as Wc,b as S,c as se,n as li,o as pe,p as Hc,q as Fc,s as kc,t as Nc,u as Uc,v as Wt,w as Ke,x as ci,y as pi,z as Bs}from"./chunk-Y6BDZT73.js";import{c as Vc,d as Ns,e as zc}from"./chunk-JVY3X3AX.js";import{a as Je,h as be,j as no,l as Gc,m as Us,p as mr,q as Fi}from"./chunk-XFFRGEY6.js";import{a as yc,n as Qe,s as Tc}from"./chunk-4DOINYTW.js";import"./chunk-4OC4J3KU.js";import{p as eo}from"./chunk-BY64D2AL.js";import{f as xc,i as zs,k as wc,l as Oc,s as Gs}from"./chunk-GLDWQ77T.js";import{h as Sc}from"./chunk-R4SFVOZO.js";import"./chunk-XSUSQPBO.js";import"./chunk-BKLTKOZS.js";import"./chunk-BWK3LBHF.js";import{a as vc,b as hr,d as Qa,h as Ja,j as _e}from"./chunk-O73QQ7Z7.js";import"./chunk-YKUB35EI.js";import"./chunk-ZJHI7U3R.js";import"./chunk-WBPLJNRU.js";import"./chunk-SXCLZREG.js";import"./chunk-XF3INXTN.js";import{h as Ls}from"./chunk-L45SDGKQ.js";import"./chunk-B6VNGUER.js";import{a as Es,b as Wl,c as Xl,f as ql,h as $l,i as Rs,k as Ql,l as ka,m as Jl,n as Kl,w as Xr,x as Ps}from"./chunk-VIK3ZB6O.js";import{c as ec,d as As}from"./chunk-DJEFBPF6.js";import"./chunk-KYPWFZ3A.js";import"./chunk-E2J2V7JN.js";import{a as Zt}from"./chunk-32VQE3PR.js";import{a as Ue}from"./chunk-NIYDRLW4.js";import{a as Br}from"./chunk-XHOTVM3O.js";import{a as xt,b as Yr,d as Ia,e as Os}from"./chunk-H3VY6XFU.js";import"./chunk-LNYBTIG7.js";import"./chunk-RZU6EEB3.js";import"./chunk-SFX6QP6J.js";import"./chunk-BRJSO7CG.js";import"./chunk-AATZFFI5.js";import"./chunk-YNG4NJVY.js";import"./chunk-M3S3XZ6A.js";import"./chunk-EWHTP5EW.js";import"./chunk-3JBDNTAW.js";import{g as Gl,h as ai,i as Hl,j as $e,k as Fl,l as J,m as bs,n as Ms}from"./chunk-VEC2OYBS.js";import"./chunk-JD3KGBGX.js";import{C as Ul,a as Nl,d as xs,e as y,g as q,h as ws,l as St,p as dt,x as ut}from"./chunk-SJTQM4NH.js";import{i as Ss}from"./chunk-NYOCZ43I.js";import"./chunk-IFFYADB3.js";import"./chunk-227GSM7M.js";import"./chunk-QH5JNOMP.js";import"./chunk-JBF4H4ZJ.js";import{a as ul}from"./chunk-IY6MAS3P.js";import"./chunk-HRVSZ5C7.js";import"./chunk-WR6DOBQL.js";import"./chunk-UWZJQ7YC.js";import"./chunk-HKSYSHBE.js";import{a as F}from"./chunk-UJ6V7JUK.js";import{a as ys}from"./chunk-2M366ZBT.js";import{b as Vl}from"./chunk-47MSGR2H.js";import"./chunk-BW3UVZYU.js";import{a as ri}from"./chunk-47Q3ZDMA.js";import{a as Fa}from"./chunk-VXEE6WER.js";import"./chunk-L6VKPRBR.js";import"./chunk-I7FAWQNR.js";import"./chunk-E2G5DGVE.js";import"./chunk-CP4KE5S6.js";import"./chunk-4X6XTGI2.js";import{a as Dl}from"./chunk-VXJKEPDS.js";import"./chunk-KQMHXU66.js";import"./chunk-I3S324BU.js";import"./chunk-VOTZUGKK.js";import"./chunk-JLQZQQTG.js";import"./chunk-6KRFVLII.js";import"./chunk-OJB2TSJ7.js";import"./chunk-MCO7DSFO.js";import"./chunk-LUPAMFKK.js";import{a as ar}from"./chunk-7JD62GP7.js";import"./chunk-CJYUOBHK.js";import"./chunk-KRMYHUR3.js";import{a as fl,g as Ra,n as gl,s as _l,t as vl,x as yl}from"./chunk-TX7DVQYF.js";import{a as ht,c as El}from"./chunk-PDBA6QOJ.js";import{a as vs}from"./chunk-CF52RSJZ.js";import{a as re,c as Cl,d as jl}from"./chunk-ALWV3RJ2.js";import{a as Il}from"./chunk-7C6Z24SS.js";import{r as Sl,v as Ur}from"./chunk-IISBSAYJ.js";import"./chunk-2TKJWM7A.js";import{f as bl,j as Ml}from"./chunk-PRVSRJH5.js";import"./chunk-QWLQUMDY.js";import{a as _s,b as qe,c as zi,d as xl,g as ii,j as Pa,n as or,q as wl}from"./chunk-2ETHV3H2.js";import"./chunk-4TPQ6F4N.js";import"./chunk-WVCJLLRA.js";import"./chunk-MDSLION2.js";import"./chunk-OVOWBDBP.js";import"./chunk-V2KSICSA.js";import{a as v,b as st,c as ti,f as Ht,g as I,h as nt}from"./chunk-4XUOIGFO.js";import"./chunk-7LEG2VDW.js";import"./chunk-R2HWUZ3L.js";import"./chunk-G24ZJINL.js";import"./chunk-4VLU4EXW.js";import"./chunk-ORM3VHG6.js";import"./chunk-7W3VFAAZ.js";import{e as Oe,g as Gr,h as ji}from"./chunk-AM3VOA32.js";import"./chunk-SAOUSUZE.js";import"./chunk-FVDACA4R.js";import"./chunk-4HISZWR4.js";import"./chunk-SJW4NR3T.js";import"./chunk-TQAPQODA.js";import{c as Le,d as gs}from"./chunk-M2GLXRA2.js";import{a as Hr,b as ds,c as Fr,f as ml,g as je,h as kr,i as Ut,j as us,k as Nr,m as ms,n as Li,o as Vi,p as Ta,r as Ea,x as fs}from"./chunk-EBWCXIFH.js";import{q as dl}from"./chunk-M76YZBV5.js";import{i as sl}from"./chunk-HXQMOXFX.js";import{n as hl,o as Oa}from"./chunk-BKKKVIAS.js";import"./chunk-BCREO4Q5.js";import{a as ge,l as Te}from"./chunk-ZVHU7VE3.js";import{b as Ci,f as oe,g as pt}from"./chunk-76YVRX2R.js";import{B as Nt,C as cl,D as hs,F as pl,a as fe,b as G,c as j,d as V,e as R,l as W,m as Ft,n as ls,o as wa,p as cs,q as ll,s as ie,t as lt,u as ce,v as ct,w as kt,x as ps}from"./chunk-OZF6BMOL.js";import{a as g,b as Xe,c as z,e as rr}from"./chunk-GJP6PTKT.js";import{a as nl}from"./chunk-RSDQHAJX.js";import"./chunk-W47PGZ3Y.js";import{b as tl}from"./chunk-2OT2C2UU.js";import"./chunk-XIMCHX2H.js";import{b as rl}from"./chunk-SF6Z2K5H.js";import{a as te}from"./chunk-GBTN5LIS.js";import{e as il}from"./chunk-JOSG37QF.js";import"./chunk-SLMQFZE3.js";import"./chunk-46V3IHDS.js";import"./chunk-NDG5FXLR.js";import"./chunk-V477EWXM.js";import"./chunk-5ODCEDHC.js";import"./chunk-BENVXA3L.js";import{l as Ne}from"./chunk-2KZICFRS.js";import{b as ns}from"./chunk-D2RUV6O4.js";import{I as xa,_ as al,aa as zr,ba as ol,ca as ss}from"./chunk-4JWMB5SM.js";import"./chunk-VOYK3LZF.js";import"./chunk-HOJTYTYD.js";import{a as os}from"./chunk-XNEAL2YW.js";import"./chunk-J7M5V2SQ.js";import"./chunk-HRFJUMCP.js";import"./chunk-375OYO4P.js";import{H as Kn,L as h,O as me,W as el,h as ei,s as Jn}from"./chunk-AUTL5LCV.js";import{S as E,w as as}from"./chunk-KUJG22IX.js";import"./chunk-OVHPPCBL.js";import{a as c}from"./chunk-W3WDPWBE.js";import{a as H,b as Vr,c as ee,d as Sa,e as ye,k as Qn}from"./chunk-GISCFF3Z.js";import{b as k,c as qn,d as ot,f as rs,g as $n}from"./chunk-MLSR6YE6.js";import"./chunk-SNFOAZZQ.js";import"./chunk-CPDJJRWA.js";import"./chunk-DKS57BVI.js";import"./chunk-VU5W7W6Y.js";import"./chunk-HQMV3KQV.js";import{a as ba,m as Xn,q as Ma}from"./chunk-CRMMDK2Z.js";import"./chunk-MDAB6L5Y.js";import"./chunk-FMFGIQYB.js";import{a as b,b as O,d as Ii,h as Wn}from"./chunk-EAH6BNBL.js";var nd=t=>({vnodeSelector:"",properties:void 0,children:void 0,text:t.toString(),domNode:null}),Op=(t,e,i)=>{for(let r=0,a=e.length;r<a;r++){let o=e[r];Array.isArray(o)?Op(t,o,i):o!=null&&o!==!1&&(typeof o=="string"&&(o=nd(o)),i.push(o))}};function Tp(t,e,i){if(Array.isArray(e))i=e,e=void 0;else if(e&&(typeof e=="string"||e.hasOwnProperty("vnodeSelector"))||i&&(typeof i=="string"||i.hasOwnProperty("vnodeSelector")))throw new Error("h called with invalid arguments");let r,a;return i&&i.length===1&&typeof i[0]=="string"?r=i[0]:i&&(a=[],Op(t,i,a),a.length===0&&(a=void 0)),{vnodeSelector:t,properties:e,children:a,text:r===""?void 0:r,domNode:null}}var Ep={bottom:"esri-text-overlay-item-anchor-bottom","bottom-right":"esri-text-overlay-item-anchor-bottom-right","bottom-left":"esri-text-overlay-item-anchor-bottom-left",top:"esri-text-overlay-item-anchor-top","top-right":"esri-text-overlay-item-anchor-top-right","top-left":"esri-text-overlay-item-anchor-top-left",center:"esri-text-overlay-item-anchor-center",right:"esri-text-overlay-item-anchor-right",left:"esri-text-overlay-item-anchor-left"},ve=class extends me{get position(){return[this.x,this.y]}set position(t){this._set("x",t[0]),this._set("y",t[1])}get _textShadowColor(){let{textColor:t,backgroundColor:e}=this,i=e.clone();return i.a*=t.a,i}get _textShadow(){let t=this._textShadowColor.toCss(!0);return`0 0 ${this._textShadowSize}px ${t}`}get padding(){return .5*this.fontSize}get _borderRadius(){return this.padding}constructor(t){super(t),this.x=0,this.y=0,this.text="-",this.fontSize=14,this.anchor="center",this.visible=!0,this.isDecoration=!0,this.backgroundColor=new F([0,0,0,.6]),this.textColor=new F([255,255,255]),this._textShadowSize=1}render(){return Tp("div",{classes:this._cssClasses(),styles:{left:Math.floor(this.x)+"px",top:Math.floor(this.y)+"px",visibility:this.visible?"visible":"hidden",fontSize:this.fontSize+"px",lineHeight:this.fontSize+"px",backgroundColor:this.backgroundColor.toCss(!0),color:this.textColor.toCss(!0),padding:this.padding+"px",borderRadius:this._borderRadius+"px",textShadow:this._textShadow}},[this.text])}renderCanvas(t){if(!this.visible)return;let e=t.font.replace(/^(.*?)px/,"");t.font=`${this.fontSize}px ${e}`;let i=this.padding,r=this._borderRadius,a=t.measureText(this.text).width,o=this.fontSize,s=ld[this.anchor];t.textAlign="center",t.textBaseline="middle";let n=a+2*i,l=o+2*i,p=this.x+s.x*n,u=this.y+s.y*l;this._roundedRect(t,p,u,n,l,r),t.fillStyle=this.backgroundColor.toCss(!0),t.fill();let d=this.x+(s.x+.5)*n,m=this.y+(s.y+.5)*l;this._renderTextShadow(t,this.text,d,m),t.fillStyle=this.textColor.toCss(!0),t.fillText(this.text,d,m)}_renderTextShadow(t,e,i,r){t.lineJoin="miter",t.fillStyle=`rgba(${this._textShadowColor.r}, ${this._textShadowColor.g}, ${this._textShadowColor.b}, ${1/Xs.length})`;let a=this._textShadowSize;for(let[o,s]of Xs)t.fillText(e,i+a*o,r+a*s)}_roundedRect(t,e,i,r,a,o){t.beginPath(),t.moveTo(e,i+o),t.arcTo(e,i,e+o,i,o),t.lineTo(e+r-o,i),t.arcTo(e+r,i,e+r,i+o,o),t.lineTo(e+r,i+a-o),t.arcTo(e+r,i+a,e+r-o,i+a,o),t.lineTo(e+o,i+a),t.arcTo(e,i+a,e,i+a-o,o),t.closePath()}_cssClasses(){let t={"esri-text-overlay-item":!0},e;for(e in Ep)t[Ep[e]]=this.anchor===e;return t}};c([h()],ve.prototype,"x",void 0),c([h()],ve.prototype,"y",void 0),c([h()],ve.prototype,"position",null),c([h()],ve.prototype,"text",void 0),c([h()],ve.prototype,"fontSize",void 0),c([h()],ve.prototype,"anchor",void 0),c([h()],ve.prototype,"visible",void 0),c([h()],ve.prototype,"isDecoration",void 0),c([h()],ve.prototype,"backgroundColor",void 0),c([h()],ve.prototype,"textColor",void 0),c([h()],ve.prototype,"_textShadowSize",void 0),c([h()],ve.prototype,"_textShadowColor",null),c([h()],ve.prototype,"_textShadow",null),c([h()],ve.prototype,"padding",null),c([h()],ve.prototype,"_borderRadius",null),ve=c([E("esri.views.overlay.TextOverlayItem")],ve);var ld={bottom:{x:-.5,y:-1,textAlign:"center",textBaseline:"bottom"},"bottom-left":{x:0,y:-1,textAlign:"left",textBaseline:"bottom"},"bottom-right":{x:-1,y:-1,textAlign:"right",textBaseline:"bottom"},center:{x:-.5,y:-.5,textAlign:"center",textBaseline:"middle"},left:{x:0,y:-.5,textAlign:"left",textBaseline:"middle"},right:{x:-1,y:-.5,textAlign:"right",textBaseline:"middle"},top:{x:-.5,y:0,textAlign:"center",textBaseline:"top"},"top-left":{x:0,y:0,textAlign:"left",textBaseline:"top"},"top-right":{x:-1,y:0,textAlign:"right",textBaseline:"top"}},Xs=[];for(let e=0;e<360;e+=360/16)Xs.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)]);var Rp=ve;var cd=3025,pd={default:15,far:25},tt=class extends me{constructor(t){super(t),this.context=null,this.stagedVertex=null,this.visible=!0,this.edgeDistance="default",this._messagesUnits=null,this._labelInfos=[],this._nextLabelIndex=0}initialize(){let t=il(e=>Wn(this,null,function*(){let i=yield tl("esri/core/t9n/Units");Qn(e),this._messagesUnits=i}));this.addHandles([v(()=>[this.context!=null&&this.getCameraOrExtent(this.context),this.visible,this._edgeDistancePixels,this.stagedVertex,this._messagesUnits],()=>this._update()),...["vertex-add","vertex-update","vertex-remove"].map(e=>ti(()=>this.context?.editGeometryOperations,e,()=>this._update())),H(()=>t.abort()),v(()=>this._colors,e=>this._updateStyle(e))])}destroy(){for(this._nextLabelIndex=0;this._labelInfos.length;)this._destroyLabel(this._labelInfos.pop())}get updating(){return this._messagesUnits==null}get test(){}get _edgeDistancePixels(){return pd[this.edgeDistance]}get _colors(){let t=this.context?.view.effectiveTheme.textColor??F.fromArray([255,255,255]);return{textColor:t,backgroundColor:$e(ai(t,Gl.Low),.6)}}_update(){if(this.destroyed)return;this._nextLabelIndex=0;let{context:t,stagedVertex:e}=this;if(!t)return this._destroyUnusedLabels();let{editGeometryOperations:i}=t,{components:r,geometry:a,coordinateHelper:o}=i.data;if(!a)return this._destroyUnusedLabels();let s=r.length;for(let n=0;n<s;++n){let l=hd(a,i,e,o,n);if(l.length<2||!dd(l,t.view,t.elevationInfo,o.spatialReference))continue;let p=s===1&&!sl(l),u=md,d=fd;this.toScreenPointArray(t,l[0],u);for(let m=1;m<l.length;++m){let f=l[m-1],_=l[m];this.toScreenPointArray(t,_,d),this._addLabel(t,f,u,_,d,p),[u,d]=[d,u]}}this._destroyUnusedLabels()}_updateStyle({textColor:t,backgroundColor:e}){let i=this._nextLabelIndex,r=this._labelInfos;for(let a=0;a<i;++a){let{label:o}=r[a];o.textColor=t,o.backgroundColor=e}}_addLabel(t,e,i,r,a,o){let{label:s}=this._getOrCreateLabel(t);if(!this.visible||Pa(i,a)<cd)return void(s.visible=!1);let{spatialReference:n}=t.editGeometryOperations.data,l=so(e,r,n),p=this._messagesUnits,u=yc(t.view);s.text=p!=null&&l!=null?Rc(p,l,u):"",s.visible=!0;let d=a[0]-i[0],m=a[1]-i[1];o?qe(mt,-m,d):qe(mt,m,-d),or(mt,mt),ii(mt,mt,this._edgeDistancePixels),wl(Kr,i,a,.5),zi(Kr,Kr,mt),s.position=[Kr[0],Kr[1]],Math.abs(mt[0])>Math.abs(mt[1])?s.anchor=mt[0]>0?"left":"right":s.anchor=-mt[1]<0?"top":"bottom"}_getOrCreateLabel(t){let e=this._labelInfos.length>this._nextLabelIndex,{textColor:i,backgroundColor:r}=this._colors;if(e){let s=this._labelInfos[this._nextLabelIndex++],{label:n}=s;return n.textColor=i,n.backgroundColor=r,s}let a=new Rp({anchor:"center",fontSize:8,textColor:i,backgroundColor:r});t.view.overlay?.items.add(a);let o={label:a};return this._labelInfos.push(o),this._nextLabelIndex=this._labelInfos.length,o}_destroyUnusedLabels(){for(;this._labelInfos.length>this._nextLabelIndex;)this._destroyLabel(this._labelInfos.pop())}_destroyLabel({label:t}){this.context?.view.overlay?.items.remove(t),t.destroy()}};function hd(t,e,i,r,a){let o=[];if(e.data.components[a].iterateVertices(l=>{o.push(r.toXYZ(l.pos,y.get()))}),a===0&&i!=null&&o.push(r.toXYZ(i,y.get())),o.length<2)return o;let s=o[0],n=o[o.length-1];return t.type==="polygon"&&o.length>2&&!cl(s,n)&&o.push(s),o}function dd(t,e,i,r){if(e.type==="2d")return!0;let a=ol(r)??1,o=al(r),s=n=>Kl(e,n,r,i,Xr)??0;for(let n=1;n<t.length;++n){let l=t[n-1],p=t[n],u=(p[0]-l[0])*a,d=(p[1]-l[1])*a,m=(s(p)-s(l))*o;if(Math.abs(m)/Math.sqrt(u*u+d*d)>ud)return!1}return!0}c([h()],tt.prototype,"context",void 0),c([h()],tt.prototype,"stagedVertex",void 0),c([h()],tt.prototype,"visible",void 0),c([h()],tt.prototype,"edgeDistance",void 0),c([h()],tt.prototype,"updating",null),c([h()],tt.prototype,"_messagesUnits",void 0),c([h()],tt.prototype,"_edgeDistancePixels",null),c([h()],tt.prototype,"_colors",null),tt=c([E("esri.views.interactive.SegmentLabels")],tt);var ud=oe(5),mt=ht(),Kr=ht(),md=Oe(),fd=Oe();var vr=class extends tt{getCameraOrExtent({view:t}){return t.state.camera}toScreenPointArray({view:t,elevationInfo:e,editGeometryOperations:i},r,a=Oe()){let{spatialReference:o}=i.data.coordinateHelper;return to(r,o,e,t,Pp),t.state.camera.projectToScreen(Pp,a),a}};vr=c([E("esri.views.3d.interactive.SegmentLabels3D")],vr);var Pp=g();var uo=class{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1,this._renderGroup=Ni.Outline}destroy(){this._destroyResources()}get resources(){return this._resources!=null?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}get renderGroup(){return this._renderGroup}set renderGroup(e){this._renderGroup=e;let i=this._resources?.layerView;i&&(i.renderGroup=e)}recreate(){this.attached&&this._createResources()}recreateGeometry(){this._resourceFactory.recreateGeometry?this._resources!=null&&(this._ensureRenderGeometriesRemoved(),this._resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}_createOrDestroyResources(){this._attached?this._resources==null&&this._createResources():this._destroyResources()}_createResources(){this._destroyResources();let e=this._resourceFactory.createResources(),i=new Yi({view:this._resourceFactory.view,renderGroup:this._renderGroup}),r=this._resourceFactory.view.basemapTerrain?.overlayManager;this._resources={layerView:new Yi({view:this._resourceFactory.view,renderGroup:this._renderGroup}),external:e,geometriesAdded:!1},r&&(this._resources.drapeSourceRenderer=r.registerGeometryDrapeSource(i)),this._syncGeometriesToRenderer()}_destroyResources(){if(this._resources==null)return;this._ensureRenderGeometriesRemoved();let e=this._resourceFactory.view.basemapTerrain?.overlayManager;e&&e.unregisterDrapeSource(this._resources.layerView),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncGeometriesToRenderer(){this._visible?this._ensureRenderGeometriesAdded():this._ensureRenderGeometriesRemoved()}_ensureRenderGeometriesRemoved(){this._resources?.drapeSourceRenderer!=null&&this._resources.geometriesAdded&&(this._resources.drapeSourceRenderer.removeGeometries(this._resources.external.geometries,Zs.UPDATE),this._resources.geometriesAdded=!1)}_ensureRenderGeometriesAdded(){this._resources?.drapeSourceRenderer!=null&&(this._resources.geometriesAdded||(this._resources.drapeSourceRenderer.addGeometries(this._resources.external.geometries,Zs.UPDATE),this._resources.geometriesAdded=!0))}},Yi=class extends ul(me){constructor(t){super(t),this.drapeSourceType=Jc.Features,this.updatePolicy=hi.SYNC,this.renderGroup=Ni.Outline}};c([h({constructOnly:!0})],Yi.prototype,"view",void 0),c([h({readOnly:!0})],Yi.prototype,"drapeSourceType",void 0),c([h()],Yi.prototype,"renderGroup",void 0),Yi=c([E("esri.views.3d.interactive.visualElements.DrapedVisualElementResources")],Yi);var mi=class{get isDecoration(){return this._isDecoration}set isDecoration(e){this._isDecoration=e}constructor(e){this._isDecoration=!1,this._attached=!1,this._resourcesCreated=!1,this._visible=!0,this.view=e.view,this._handle=v(()=>e.view.ready,i=>{this._resourcesCreated&&(i?this._createResources():this._destroyResources())})}applyProperties(e){let i=!1;for(let r in e)r in this&&(r==="attached"?i=e[r]:this[r]=e[r]);this.attached=i}destroy(){this.attached=!1,this._handle.remove()}get attached(){return this._attached}set attached(e){e!==this._attached&&this.view._stage&&(this._attached=e,this._attached&&!this._resourcesCreated?this._createResources():!this._attached&&this._resourcesCreated&&this._destroyResources(),this.onAttachedChange(e))}onAttachedChange(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.attached&&this.updateVisibility(e))}_createResources(){this.createResources(),this._resourcesCreated=!0,this.updateVisibility(this.visible)}_destroyResources(){this.destroyResources(),this._resourcesCreated=!1}};var mo=class{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get object(){return this._resources!=null?this._resources.object:null}get resources(){return this._resources!=null?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncVisible())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(!this._resourceFactory.recreateGeometry)return void this.recreate();let e=this._resourceFactory.view._stage;if(this._resources==null||!e)return;let i=this._resources.object;this._resources.external.forEach(r=>{r.type!==Yt.Mesh&&r.type!==Yt.Line&&r.type!==Yt.Point||e.remove(r)}),i.removeAllGeometries(),this._resourceFactory.recreateGeometry(this._resources.external,i,this._resources.layer),this._resources.external.forEach(r=>{r.type!==Yt.Mesh&&r.type!==Yt.Line&&r.type!==Yt.Point||e.add(r)})}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();let e=this._resourceFactory,i=e.view,r=i._stage;if(!r)return;let a=new gr(r,{pickable:!1,updatePolicy:hi.SYNC}),o=new fr({castShadow:!1}),s=e.createResources(o,a);s.forEach(p=>{r.add(p),p.type===Yt.Texture&&p.load(r.renderView.renderingContext)}),r.add(o),a.add(o);let n=e.cameraChanged,l=n?v(()=>i.state.camera,p=>n(p),I):null;this._resources={layer:a,object:o,external:s,cameraHandle:l},this._syncVisible()}_destroyResources(){if(this._resources==null)return;let e=this._resourceFactory.view._stage;e&&(e.remove(this._resources.object),this._resources.layer.destroy(),this._resources.external.forEach(i=>{e.remove(i),i.type===Yt.Texture&&i.unload()})),this._resources.object.dispose(),this._resources.cameraHandle?.remove(),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncVisible(){this._resources!=null&&(this._resources.object.visible=this._visible)}};var Dt=class extends mi{constructor(e){super(e),this._isDraped=!1,this.object3dResources=new mo(this.createObject3DResourceFactory(e.view)),this.drapedResources=new uo(this.createDrapedResourceFactory(e.view)),this.isDraped=e.isDraped??!1}get isDraped(){return this._isDraped}set isDraped(e){e!==this._isDraped&&(this._isDraped=e,this.object3dResources.attached=this.attached&&!e,this.drapedResources.attached=this.attached&&e)}get renderGroup(){return this.drapedResources.renderGroup}set renderGroup(e){this.drapedResources.renderGroup=e}createResources(){this.object3dResources.attached=!this._isDraped,this.drapedResources.attached=this._isDraped}destroyResources(){this.object3dResources.attached=!1,this.drapedResources.attached=!1}recreate(){this.object3dResources.recreate(),this.drapedResources.recreate()}recreateGeometry(){this.object3dResources.recreateGeometry(),this.drapedResources.recreateGeometry()}destroy(){this.object3dResources.destroy(),this.drapedResources.destroy(),super.destroy()}updateVisibility(e){this.object3dResources.visible=e,this.drapedResources.visible=e}};var ea=class t extends Rt{initializeProgram(e){return new Pt(e.rctx,t.shader.get().build(this.configuration),qs)}initializePipeline(){return Tt({blending:cr(Ve.ONE,Ve.ONE_MINUS_SRC_ALPHA),colorWrite:Ot})}};ea.shader=new Et(tp,()=>import("./chunk-KDLEZR2U.js"));var qs=new Map([[P.START,0],[P.END,1],[P.UP,2],[P.EXTRUDE,3]]);var ta=class{constructor(e){this._renderCoordsHelper=e,this._buffers=null,this._origin=g(),this._dirty=!1,this._count=0,this._vao=null}set vertices(e){let i=Gi(3*e.length),r=0;for(let a of e)i[r++]=a[0],i[r++]=a[1],i[r++]=a[2];this.buffers=[i]}set buffers(e){if(this._buffers=e,this._buffers.length>0){let i=this._buffers[0],r=3*Math.floor(i.length/3/2);j(this._origin,i[r],i[r+1],i[r+2])}else j(this._origin,0,0,0);this._dirty=!0}get origin(){return this._origin}draw(e){let i=this._ensureVAO(e);i!=null&&(e.bindVAO(i),e.drawArrays(Rl.TRIANGLES,0,this._count))}dispose(){this._vao!=null&&this._vao.dispose()}_ensureVAO(e){return this._buffers==null?null:(this._vao==null&&(this._vao=this._createVAO(e,this._buffers)),this._ensureVertexData(this._vao,this._buffers),this._vao)}_createVAO(e,i){let r=this._createDataBuffer(i);return this._dirty=!1,new ip(e,qs,{data:Al(Ip)},{data:zl.createVertex(e,Pl.STATIC_DRAW,r)})}_ensureVertexData(e,i){if(!this._dirty)return;let r=this._createDataBuffer(i);e.vertexBuffers.data?.setData(r),this._dirty=!1}_createDataBuffer(e){let i=e.reduce((n,l)=>n+Ap(l),0);this._count=i;let r=Ip.createBuffer(i),a=this._origin,o=0,s=0;for(let n of e){for(let l=0;l<n.length;l+=3){let p=j(Dp,n[l],n[l+1],n[l+2]);l===0?s=this._renderCoordsHelper.getAltitude(p):this._renderCoordsHelper.setAltitude(p,s);let u=this._renderCoordsHelper.worldUpAtPosition(p,gd),d=o+2*l,m=R(Dp,p,a);if(l<n.length-3){r.up.setVec(d,u),r.up.setVec(d+3,u),r.up.setVec(d+5,u);for(let f=0;f<6;f++)r.start.setVec(d+f,m);r.extrude.setValues(d,0,-1),r.extrude.setValues(d+1,1,-1),r.extrude.setValues(d+2,1,1),r.extrude.setValues(d+3,0,-1),r.extrude.setValues(d+4,1,1),r.extrude.setValues(d+5,0,1)}if(l>0){r.up.setVec(d-2,u),r.up.setVec(d-4,u),r.up.setVec(d-5,u);for(let f=-6;f<0;f++)r.end.setVec(d+f,m)}}o+=Ap(n)}return r.buffer}};function Ap(t){return 3*(2*(t.length/3-1))}var gd=g(),Dp=g(),Ip=Da().vec3f(P.START).vec3f(P.END).vec3f(P.UP).vec2f(P.EXTRUDE);var Wi=class extends js{constructor(){super(...arguments),this.contrastControlEnabled=!1}};c([N()],Wi.prototype,"contrastControlEnabled",void 0);var fo=class extends Ga{constructor(){super(...arguments),this.innerColor=z(1,1,1),this.innerWidth=1,this.glowColor=z(1,.5,0),this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=.75,this.globalAlphaContrastBoost=2,this.angleCutoff=oe(6),this.pointDistanceOrigin=g(),this.pointDistanceTarget=g(),this.lineVerticalPlaneSegment=Bt(),this.intersectsLineSegment=Bt(),this.intersectsLineRadius=3,this.heightManifoldTarget=g(),this.lineStartWorld=g(),this.lineEndWorld=g()}},ia=class t extends Rt{initializeProgram(e){return new Pt(e.rctx,t.shader.get().build(this.configuration),Ua)}initializePipeline(){return Tt({blending:cr(Ve.ONE,Ve.ONE_MINUS_SRC_ALPHA),colorWrite:Ot})}};ia.shader=new Et(ap,()=>import("./chunk-A5IN6IFG.js"));var Xt=class extends Wi{constructor(){super(...arguments),this.heightManifoldEnabled=!1,this.pointDistanceEnabled=!1,this.lineVerticalPlaneEnabled=!1,this.intersectsLineEnabled=!1,this.spherical=!1}};c([N()],Xt.prototype,"heightManifoldEnabled",void 0),c([N()],Xt.prototype,"pointDistanceEnabled",void 0),c([N()],Xt.prototype,"lineVerticalPlaneEnabled",void 0),c([N()],Xt.prototype,"intersectsLineEnabled",void 0),c([N()],Xt.prototype,"spherical",void 0);var fi=class extends ep{constructor(t){super(t),this._technique=null,this._heightManifoldEnabled=!1,this._pointDistanceEnabled=!1,this._lineVerticalPlaneEnabled=!1,this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._pathVerticalPlaneEnabled=!1,this._pathVerticalPlaneData=null,this._pathTechnique=null,this._passParameters=new fo,this.produces=new Map([[Ze.LASERLINES,()=>!this.contrastControlEnabled],[Ze.LASERLINES_CONTRAST_CONTROL,()=>this.contrastControlEnabled]])}initialize(){this._passParameters.renderCoordsHelper=this.renderCoordsHelper}consumes(){return Kc}get isDecoration(){return this._isDecoration}get heightManifoldEnabled(){return this._heightManifoldEnabled}set heightManifoldEnabled(t){this._heightManifoldEnabled!==t&&(this._heightManifoldEnabled=t,this._requestRender())}get heightManifoldTarget(){return this._passParameters.heightManifoldTarget}set heightManifoldTarget(t){G(this._passParameters.heightManifoldTarget,t),this._requestRender()}get pointDistanceEnabled(){return this._pointDistanceEnabled}set pointDistanceEnabled(t){t!==this._pointDistanceEnabled&&(this._pointDistanceEnabled=t,this._requestRender())}get pointDistanceTarget(){return this._passParameters.pointDistanceTarget}set pointDistanceTarget(t){G(this._passParameters.pointDistanceTarget,t),this._requestRender()}get pointDistanceOrigin(){return this._passParameters.pointDistanceOrigin}set pointDistanceOrigin(t){G(this._passParameters.pointDistanceOrigin,t),this._requestRender()}get lineVerticalPlaneEnabled(){return this._lineVerticalPlaneEnabled}set lineVerticalPlaneEnabled(t){t!==this._lineVerticalPlaneEnabled&&(this._lineVerticalPlaneEnabled=t,this._requestRender())}get lineVerticalPlaneSegment(){return this._passParameters.lineVerticalPlaneSegment}set lineVerticalPlaneSegment(t){nr(t,this._passParameters.lineVerticalPlaneSegment),this._requestRender()}get intersectsLineEnabled(){return this._intersectsLineEnabled}set intersectsLineEnabled(t){t!==this._intersectsLineEnabled&&(this._intersectsLineEnabled=t,this._requestRender())}get intersectsLineSegment(){return this._passParameters.intersectsLineSegment}set intersectsLineSegment(t){nr(t,this._passParameters.intersectsLineSegment),this._requestRender()}get intersectsLineRadius(){return this._passParameters.intersectsLineRadius}set intersectsLineRadius(t){t!==this._passParameters.intersectsLineRadius&&(this._passParameters.intersectsLineRadius=t,this._requestRender())}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(t){t!==this._intersectsLineInfinite&&(this._intersectsLineInfinite=t,this._requestRender())}get pathVerticalPlaneEnabled(){return this._pathVerticalPlaneEnabled}set pathVerticalPlaneEnabled(t){t!==this._pathVerticalPlaneEnabled&&(this._pathVerticalPlaneEnabled=t,this._pathVerticalPlaneData!=null&&this._requestRender())}set pathVerticalPlaneVertices(t){this._pathVerticalPlaneData==null&&(this._pathVerticalPlaneData=new ta(this._passParameters.renderCoordsHelper)),this._pathVerticalPlaneData.vertices=t,this.pathVerticalPlaneEnabled&&this._requestRender()}set pathVerticalPlaneBuffers(t){this._pathVerticalPlaneData==null&&(this._pathVerticalPlaneData=new ta(this._passParameters.renderCoordsHelper)),this._pathVerticalPlaneData.buffers=t,this.pathVerticalPlaneEnabled&&this._requestRender()}setParameters(t){rc(this._passParameters,t)&&this._requestRender()}initializeRenderContext(t){this._context=t,this._techniques=t.techniques,this._techniqueConfig=new Xt;let e=new Wi;e.contrastControlEnabled=this.contrastControlEnabled,this._pathTechnique=this._techniques.acquire(ea,e)}uninitializeRenderContext(){this._technique=rs(this._technique),this._pathVerticalPlaneData=qn(this._pathVerticalPlaneData),this._pathTechnique=rs(this._pathTechnique)}prepareTechnique(){return this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled?(this._techniqueConfig.heightManifoldEnabled=this.heightManifoldEnabled,this._techniqueConfig.lineVerticalPlaneEnabled=this.lineVerticalPlaneEnabled,this._techniqueConfig.pointDistanceEnabled=this.pointDistanceEnabled,this._techniqueConfig.intersectsLineEnabled=this.intersectsLineEnabled,this._techniqueConfig.contrastControlEnabled=this.contrastControlEnabled,this._techniqueConfig.spherical=this.viewingMode===Br.Global,this._technique=this._techniques.releaseAndAcquire(ia,this._techniqueConfig,this._technique),this._technique):this._pathTechnique}renderNode(t,e,i){let r=i?.get("normals")?.getTexture();r&&(this._passParameters.normals=r,(this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled)&&this._renderUnified(t,e),this.pathVerticalPlaneEnabled&&this._renderPath(t))}_renderUnified(t,e){let i=t.rctx;this._updatePassParameters(t),i.bindTechnique(e,t.bindParameters,this._passParameters),i.screen.draw()}_renderPath(t){if(this._pathVerticalPlaneData==null||this._pathTechnique==null)return;let e=t.rctx,i=this._pathTechnique;e.bindTechnique(i,t.bindParameters,O(b({},this._passParameters),{origin:this._pathVerticalPlaneData.origin})),this._pathVerticalPlaneData.draw(t.rctx)}_updatePassParameters(t){if(!this._intersectsLineEnabled)return;let e=t.bindParameters.camera;if(this._intersectsLineInfinite){if(ja(Yr(this._passParameters.intersectsLineSegment.origin,this._passParameters.intersectsLineSegment.vector),ra),ra.c0=-Number.MAX_VALUE,!za(e.frustum,ra))return;La(ra,this._passParameters.lineStartWorld),Va(ra,this._passParameters.lineEndWorld)}else G(this._passParameters.lineStartWorld,this._passParameters.intersectsLineSegment.origin),V(this._passParameters.lineEndWorld,this._passParameters.intersectsLineSegment.origin,this._passParameters.intersectsLineSegment.vector)}_requestRender(){this._context&&this._context.requestRender()}get test(){}};c([h({constructOnly:!0})],fi.prototype,"viewingMode",void 0),c([h({constructOnly:!0})],fi.prototype,"contrastControlEnabled",void 0),c([h({constructOnly:!0})],fi.prototype,"_isDecoration",void 0),c([h({constructOnly:!0})],fi.prototype,"renderCoordsHelper",void 0),fi=c([E("esri.views.3d.webgl-engine.effects.laserlines.LaserLineRenderer")],fi);var ra=Ca();var ft=class extends mi{constructor(e){super(e),this._angleCutoff=rp,this._style={},this._heightManifoldTarget=g(),this._heightManifoldEnabled=!1,this._intersectsLine=Bt(),this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._lineVerticalPlaneSegment=null,this._pathVerticalPlaneBuffers=null,this._pointDistanceLine=null,this.applyProperties(e)}get testData(){}createResources(){this._ensureRenderer()}destroyResources(){this._disposeRenderer()}updateVisibility(){this._syncRenderer(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance()}get angleCutoff(){return this._angleCutoff}set angleCutoff(e){this._angleCutoff!==e&&(this._angleCutoff=e,this._syncAngleCutoff())}get style(){return this._style}set style(e){this._style=e,this._syncStyle()}get heightManifoldTarget(){return this._heightManifoldEnabled?this._heightManifoldTarget:null}set heightManifoldTarget(e){e!=null?(G(this._heightManifoldTarget,e),this._heightManifoldEnabled=!0):this._heightManifoldEnabled=!1,this._syncRenderer(),this._syncHeightManifold()}set intersectsWorldUpAtLocation(e){if(e==null)return void(this.intersectsLine=null);let i=this.view.renderCoordsHelper.worldUpAtPosition(e,_d);this.intersectsLine=Bl(e,i),this.intersectsLineInfinite=!0}get intersectsLine(){return this._intersectsLineEnabled?this._intersectsLine:null}set intersectsLine(e){e!=null?(nr(e,this._intersectsLine),this._intersectsLineEnabled=!0):this._intersectsLineEnabled=!1,this._syncIntersectsLine(),this._syncRenderer()}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(e){this._intersectsLineInfinite=e,this._syncIntersectsLineInfinite()}get lineVerticalPlaneSegment(){return this._lineVerticalPlaneSegment}set lineVerticalPlaneSegment(e){this._lineVerticalPlaneSegment=e!=null?nr(e):null,this._syncLineVerticalPlane(),this._syncRenderer()}get pathVerticalPlane(){return this._pathVerticalPlaneBuffers}set pathVerticalPlane(e){this._pathVerticalPlaneBuffers=e,this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncRenderer()}get pointDistanceLine(){return this._pointDistanceLine}set pointDistanceLine(e){this._pointDistanceLine=e!=null?{origin:Xe(e.origin),target:e.target?Xe(e.target):null}:null,this._syncPointDistance(),this._syncRenderer()}_syncRenderer(){this.attached&&this.visible&&(this._intersectsLineEnabled||this._heightManifoldEnabled||this._pointDistanceLine!=null||this._pathVerticalPlaneBuffers!=null)?this._ensureRenderer():this._disposeRenderer()}_ensureRenderer(){this._renderer==null&&(this._renderer=new fi({renderCoordsHelper:this.view.renderCoordsHelper,contrastControlEnabled:!0,_isDecoration:this.isDecoration,viewingMode:this.view.state.viewingMode}),this._syncStyle(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncIntersectsLineInfinite(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncAngleCutoff(),this.view._stage&&this.view._stage.addRenderPlugin(this._renderer))}_syncStyle(){this._renderer!=null&&(this._renderer.setParameters(this._style),this._style.intersectsLineRadius!=null&&(this._renderer.intersectsLineRadius=this._style.intersectsLineRadius))}_syncAngleCutoff(){this._renderer!=null&&this._renderer.setParameters({angleCutoff:this._angleCutoff})}_syncHeightManifold(){this._renderer!=null&&(this._renderer.heightManifoldEnabled=this._heightManifoldEnabled&&this.visible,this._heightManifoldEnabled&&(this._renderer.heightManifoldTarget=this._heightManifoldTarget))}_syncIntersectsLine(){this._renderer!=null&&(this._renderer.intersectsLineEnabled=this._intersectsLineEnabled&&this.visible,this._intersectsLineEnabled&&(this._renderer.intersectsLineSegment=this._intersectsLine))}_syncIntersectsLineInfinite(){this._renderer!=null&&(this._renderer.intersectsLineInfinite=this._intersectsLineInfinite)}_syncPathVerticalPlane(){this._renderer!=null&&(this._renderer.pathVerticalPlaneEnabled=this._pathVerticalPlaneBuffers!=null&&this.visible,this._pathVerticalPlaneBuffers!=null&&(this._renderer.pathVerticalPlaneBuffers=this._pathVerticalPlaneBuffers))}_syncLineVerticalPlane(){this._renderer!=null&&(this._renderer.lineVerticalPlaneEnabled=this._lineVerticalPlaneSegment!=null&&this.visible,this._lineVerticalPlaneSegment!=null&&(this._renderer.lineVerticalPlaneSegment=this._lineVerticalPlaneSegment))}_syncPointDistance(){if(this._renderer==null)return;let e=this._pointDistanceLine,i=e!=null;this._renderer.pointDistanceEnabled=i&&e.target!=null&&this.visible,i&&(this._renderer.pointDistanceOrigin=e.origin,e.target!=null&&(this._renderer.pointDistanceTarget=e.target))}_disposeRenderer(){this._renderer!=null&&this.view._stage&&(this.view._stage.removeRenderPlugin(this._renderer),this._renderer=null)}},_d=g();var It=class extends Dt{constructor(e){super(e),this._ray=xt(),this._isWorldDown=!1,this._start=g(),this._end=z(1,0,0),this._width=1,this._color=oi(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=oi(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._falloff=0,this._extensionType=De.LINE,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=M.OccludeAndTransparent,this._fadedExtensions=Vp,this._laserline=new ft({view:this.view,isDecoration:e.isDecoration}),this.applyProperties(e)}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(e){return{view:e,createResources:i=>this._createObject3DResources(i),destroyResources:Cp,recreateGeometry:(i,r)=>this._recreateObject3DGeometry(i,r),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:Cp,recreateGeometry:i=>this._recreateDrapedGeometry(i)}}updateVisibility(e){super.updateVisibility(e),this._laserline.visible=e}onAttachedChange(){this._laserline.attached=this._laserlineAttached}setStartEndFromWorldDownAtLocation(e){this._isWorldDown=!0,G(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),R(this._end,e,this._end),Ia(this._start,this._end,this._ray),this._updateGeometry()}get start(){return this._start}set start(e){this._isWorldDown=!1,Nt(this._start,e)||(G(this._start,e),Ia(this._start,this._end,this._ray),this._updateGeometry())}get end(){return this._end}set end(e){this._isWorldDown=!1,Nt(this._end,e)||(G(this._end,e),Ia(this._start,this._end,this._ray),this._updateGeometry())}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){Te(e,this._color)||(ge(this._color,e),this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){Te(e,this._innerColor)||(ge(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){let i=e!=null!=(this._stipplePattern!=null);this._stipplePattern=e,i?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){e!=null&&this._stippleOffColor!=null&&Te(e,this._stippleOffColor)||(this._stippleOffColor=e!=null?Ka(e):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(e){e!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=e,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get extensionType(){return this._extensionType}set extensionType(e){e!==this._extensionType&&(this._extensionType=e,this.recreateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&this._laserlineStyle!=null&&this.attached&&!this.isDraped}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,e!=null&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===M.OccludeAndTransparentStencil?M.OccludeAndTransparent:this._renderOccluded}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(e){this._fadedExtensions=e??Vp,this.recreateGeometry()}_updateMaterial(){let{materialParameters:e}=this;this.object3dResources.resources?.material.setParameters(e),this.drapedResources.resources?.material.setParameters(e)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,hasPolygonOffset:this._polygonOffset,renderOccluded:this._normalizedRenderOccluded,isDecoration:this.isDecoration,writeDepth:this._writeDepthEnabled}}_createObject3DResources(e){let i=new ne(this.materialParameters),r=new Array;return this._createObject3DGeometry(i,e,r),{material:i,geometries:r,forEach:a=>{a(i),r.forEach(a)}}}_recreateObject3DGeometry(e,i){e.geometries.length=0,this._createObject3DGeometry(e.material,i,e.geometries)}_createObject3DGeometry(e,i,r){let a=this._createGeometry(e);r.push(a),i.addGeometry(a),this._updateVerticesObject3D(i)}_createDrapedResources(){let e=new ne(this.materialParameters);return{material:e,geometries:[this._createDrapedGeometry(e)]}}_recreateDrapedGeometry(e){e.geometries=[this._createDrapedGeometry(e.material)]}_createDrapedGeometry(e){let i=this._createGeometry(e);return this._updateVerticesDraped(i),new di(i)}_createGeometry(e){let i=this.extensionType===De.FADED,r=i?[g(),g(),g(),g()]:[g(),g()];return Me(e,r,null,i?[1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]:null)}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{let e=this.object3dResources.object;e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){let i=this._lineSegment;this._updateVertexAttributesObject3D(e,i),this._laserline.intersectsLine=i}_updateVerticesDraped(e){this._updateVertexAttributesDraped(e,this._lineSegment)}get _lineSegment(){return this._extensionType===De.FADED?this._updateLineSegmentFinite(jp):this._updateLineSegmentInfinite(this._extensionType,jp)}_updateLineSegmentFinite(e){return lr(this._start,this._end,e)}_updateLineSegmentInfinite(e,i){let r=this.view.state.camera;switch(ja(this._ray,gi),e){case De.LINE:gi.c0=-Number.MAX_VALUE;break;case De.RAY:case De.GROUND_RAY:{let s=this._ray.origin,n=this.view.elevationProvider.getElevation(s[0],s[1],s[2],this.view.renderCoordsHelper.spatialReference,"ground")??0,l=this.view.renderCoordsHelper.getAltitude(s);this._isWorldDown&&l<n&&ll(gi.ray.direction,gi.ray.direction),this._extensionType===De.GROUND_RAY&&n!=null&&(gi.c1=Math.abs(l-n));break}}if(!za(r.frustum,gi))return this._updateLineSegmentFinite(i);let a=La(gi,Xi),o=Va(gi,vd);return lr(a,o,i)}_updateVertexAttributesObject3D(e,i){let r=e.geometries[0].getMutableAttribute(P.POSITION)?.data;if(!r)return;let a=0;for(let o of this._lineVertices(i))r[a++]=o[0],r[a++]=o[1],r[a++]=o[2];e.geometryVertexAttributeUpdated(e.geometries[0],P.POSITION)}_updateVertexAttributesDraped(e,i){let r=e.getMutableAttribute(P.POSITION)?.data;if(!r)return;let a=0;for(let o of this._lineVertices(i))r[a++]=o[0],r[a++]=o[1],r[a++]=Ui;e.invalidateBoundingInfo()}*_lineVertices(e){this.extensionType===De.FADED?(yield Hi(e,-this.fadedExtensions.start,Xi),yield Hi(e,0,Xi),yield Hi(e,1,Xi),yield Hi(e,1+this.fadedExtensions.end,Xi)):(yield Hi(e,0,Xi),yield Hi(e,1,Xi))}};function Cp(t){t.geometries=[]}var gi=Ca(),Xi=g(),vd=g(),jp=Bt(),De;(function(t){t[t.LINE=0]="LINE",t[t.RAY=1]="RAY",t[t.GROUND_RAY=2]="GROUND_RAY",t[t.FADED=3]="FADED"})(De||(De={}));var Lp=1/3,Vp={start:Lp,end:Lp};var vo=class extends Dt{constructor(e){super(e),this._location=g(),this._direction=z(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=oi(1,0,1,1),this._renderOccluded=M.OccludeAndTransparent,this.applyProperties(e)}createObject3DResourceFactory(e){return{view:e,createResources:i=>this._createObject3DResources(i),destroyResources:bd,recreateGeometry:(i,r)=>this._recreateObject3DGeometry(i,r),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:Md,recreateGeometry:i=>this._recreateDrapedGeometry(i)}}get location(){return this._location}set location(e){Nt(this._location,e)||(G(this._location,e),this._updateGeometry())}get direction(){return this._direction}set direction(e){Nt(this._direction,e)||(G(this._direction,e),this._updateGeometry())}setDirectionFromPoints(e,i){ie(this._direction,R(this._direction,i,e)),this._updateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get offset(){return this._offset}set offset(e){e!==this._offset&&(this._offset=e,this._updateGeometry())}get length(){return this._length}set length(e){e!==this._length&&(this._length=e,this._updateGeometry())}get color(){return this._color}set color(e){Te(e,this._color)||(ge(this._color,e),this._updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}_createObject3DResources(e){let i=new ne(this.materialParameters),r=new Array;return this._createObject3DGeometry(i,e,r),{material:i,geometries:r,forEach:a=>{a(i),r.forEach(a)}}}_recreateObject3DGeometry(e,i){e.geometries.length=0,this._createObject3DGeometry(e.material,i,e.geometries)}_createObject3DGeometry(e,i,r){let[a,o]=zp(e);i.addGeometry(a),i.addGeometry(o),r.push(a),r.push(o),this._updateVerticesObject3D(i)}_createDrapedResources(){let e=new ne(this.materialParameters),i=v(()=>this.view.state.contentPixelRatio,()=>{this.drapedResources.recreateGeometry()});return{material:e,geometries:this._createDrapedGeometry(e),pixelRatioHandle:i}}_recreateDrapedGeometry(e){e.geometries=this._createDrapedGeometry(e.material)}_createDrapedGeometry(e){let i=zp(e);return this._updateVerticesDraped(i),i.map(r=>new di(r))}_updateMaterial(){let{materialParameters:e}=this;this.object3dResources.resources?.material.setParameters(e),this.drapedResources.resources?.material.setParameters(e)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{let e=this.object3dResources.object;e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){let i=this.view.state.camera;i.projectToScreen(this.location,_o),V(Ct,this.location,this.direction),i.projectToScreen(Ct,yr),or(yr,xl(yr,yr,_o)),this._updateVertexAttributesObject3D(i,e,0,_o,yr,1),this._updateVertexAttributesObject3D(i,e,1,_o,yr,-1)}_updateVertexAttributesObject3D(e,i,r,a,o,s){let n=i.geometries[r],l=n.getMutableAttribute(P.POSITION)?.data;if(!l)return;let{start:p,end:u}=Gp(o,a,s,this.offset,this.width,this.length);e.unprojectFromScreen(p,Ct),l[0]=Ct[0],l[1]=Ct[1],l[2]=Ct[2],e.unprojectFromScreen(u,Ct),l[3]=Ct[0],l[4]=Ct[1],l[5]=Ct[2],i.geometryVertexAttributeUpdated(n,P.POSITION)}_updateVerticesDraped(e){let{view:{basemapTerrain:{overlayManager:i},state:{contentPixelRatio:r}}}=this,{location:a,width:o,length:s,offset:n}=this,l=Sd;l.spatialReference=i.renderer.spatialReference,l.x=a[0],l.y=a[1];let p=this.view.overlayPixelSizeInMapUnits(l)*r,u=o*p,d=s*p,m=n*p;this._updateVertexAttributesDraped(e[0],u,d,m,-1),this._updateVertexAttributesDraped(e[1],u,d,m,1)}_updateVertexAttributesDraped(e,i,r,a,o){let s=e.getMutableAttribute(P.POSITION)?.data;if(!s)return;let{location:n,direction:l}=this,{start:p,end:u}=Gp(l,n,o,a,i,r);s[0]=p[0],s[1]=p[1],s[2]=Ui,s[3]=u[0],s[4]=u[1],s[5]=Ui,e.invalidateBoundingInfo()}};function zp(t){return[Me(t,[g(),g()]),Me(t,[g(),g()])]}function Gp(t,e,i,r,a,o){let s=ii(Hp,qe(Hp,t[1]*i,t[0]*-i),r+a/2),n=zi(go,zi(go,zi(go,e,ii(go,t,o/2)),s),s);return{start:n,end:zi(Fp,n,ii(Fp,t,-o))}}function bd(t){t.geometries.length=0}function Md(t){t.pixelRatioHandle.remove(),t.geometries=[]}var Ct=g(),Hp=ht(),go=ht(),Fp=ht(),_o=Oe(),yr=Oe(),Sd=Ue(0,0,void 0,null);var _i=class extends mi{constructor(e){super(e),this._resources=null,this._transform=re()}get object(){return this._resources!=null?this._resources.object:null}get transform(){return this._transform}set transform(e){Hr(this._transform,e),this._resources!=null&&(this._resources.object.transformation=this._transform)}recreate(){this.attached&&this.createResources()}recreateGeometry(){if(this._resources==null)return;let e=this._resources.object,i=this.view._stage;i.removeMany(e.geometries),e.removeAllGeometries(),this.createGeometries(e),e.visible=this.visible,i.addMany(e.geometries)}createResources(){this.destroyResources();let e=this.view._stage;if(!e)return;let i=new gr(e,{pickable:!1,updatePolicy:hi.SYNC}),r=new fr({castShadow:!1});r.transformation=this._transform,this.createExternalResources(),this.createGeometries(r),e.addMany(r.geometries),this.forEachExternalMaterial(a=>e.add(a)),e.add(r),i.add(r),r.visible=this.visible,this._resources={layer:i,object:r}}destroyResources(){let e=this.view._stage;this._resources!=null&&e&&(e.remove(this._resources.object),this._resources.layer.destroy(),this.forEachExternalMaterial(i=>{e.remove(i)}),e.removeMany(this._resources.object.geometries),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}updateVisibility(e){this._resources!=null&&(this._resources.object.visible=e)}};var qi=class extends _i{constructor(e){super(e),this._material=null,this._texture=null,this._geometry=null,this._size=3,this._color=Le(1,0,1,1),this._pixelSnappingEnabled=!0,this._primitive="square",this._outlineSize=1,this._outlineColor=Le(1,1,1,1),this._elevationInfo=null,this.applyProperties(e)}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get size(){return this._size}set size(e){if(e!==this._size){let i=this._preferredTextureSize;this._size=e,i<this._preferredTextureSize?this.recreate():this._updateSizeAttribute()}}get color(){return this._color}set color(e){Te(e,this._color)||(ge(this._color,e),this._updateMaterial())}get pixelSnappingEnabled(){return this._pixelSnappingEnabled}set pixelSnappingEnabled(e){this._pixelSnappingEnabled!==e&&(this._pixelSnappingEnabled=e,this._updateMaterial())}get primitive(){return this._primitive}set primitive(e){this._primitive!==e&&(this._primitive=e,this.recreate())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){Te(e,this._outlineColor)||(ge(this._outlineColor,e),this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}_updateMaterial(){this._material&&this._material.setParameters(this._materialParameters)}_updateSizeAttribute(){let e=this.object;if(e==null)return;let i=e.geometries[0];if(i==null)return;let r=i.getMutableAttribute(P.SIZE).data,a=this._geometrySize;r[0]=a,r[1]=a,e.geometryVertexAttributeUpdated(e.geometries[0],P.SIZE)}get _materialParameters(){return{color:this._color,textureIsSignedDistanceField:!0,sampleSignedDistanceFieldTexelCenter:np(this._primitive),distanceFieldBoundingBox:xd,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:this._texture?.id,polygonOffset:!1,shaderPolygonOffset:0,drawInSecondSlot:!0,depthEnabled:!1,pixelSnappingEnabled:this.pixelSnappingEnabled,isDecoration:this.isDecoration}}get _geometrySize(){return this._size/aa}createExternalResources(){this._texture=lp(this._primitive,this._preferredTextureSize),this._material=new up(this._materialParameters);let e=this.view._stage;this._texture.load(e.renderView.renderingContext),e.add(this._texture)}destroyExternalResources(){this._texture&&(this.view._stage.remove(this._texture),this._texture.dispose(),this._texture=null),this._material=null}createGeometries(e){let i=this._createRenderGeometry();i!=null&&e.addGeometry(i)}forEachExternalMaterial(e){this._material&&e(this._material)}get _preferredTextureSize(){return Ci(2*this._geometrySize,16,128)}calculateMapBounds(e){let i=this.object?.geometries[0];if(!i)return!1;let r=i.attributes.get(P.POSITION).data;return Zt(r,this.view.renderCoordsHelper.spatialReference,kp,this.view.spatialReference),Ra(e,kp),!0}_createRenderGeometry(){let{geometry:e,_material:i}=this;if(e==null||i==null)return null;let{renderCoordsHelper:r,elevationProvider:a}=this.view,o=ui(e,a,et.fromElevationInfo(this.elevationInfo),r),s=j(y.get(),e.x,e.y,o),n=y.get();Zt(s,e.spatialReference,n,r.spatialReference);let l=this._geometrySize;return cp(i,null,n,null,[l,l],[0,0,0,1])}},aa=sp,xd=[aa/2,aa/2,1-aa/2,1-aa/2],kp=g();var yo=class extends Dt{constructor(e){super(e),this._maxSize=0,this._position=g(),this._up=g(),this._right=g(),this._renderOccluded=M.OccludeAndTransparent,this._color=Le(1,0,0,1),this._outlineColor=Le(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=M.Opaque,this.applyProperties(e)}createObject3DResourceFactory(e){return{view:e,createResources:i=>this._createObject3DResources(i),destroyResources:()=>{},cameraChanged:()=>this._updateTransformObject3D()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:wd}}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get color(){return this._color}set color(e){ge(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){ge(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){let i=this._outlineSize===0!=(e===0);this._outlineSize=e,i?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry({previous:e,center:i,next:r}){this._maxSize=Math.min(ls(i,e),ls(i,r))/3,ie(this._up,R(this._up,e,i)),ie(this._right,R(this._right,r,i)),G(this._position,i),this.recreateGeometry()}_createObject3DResources(e){let i=new Se(this._quadMaterialParameters),r=this._outlineSize===0?void 0:new ne(this._outlineMaterialParameters);return this._createObject3DGeometries(e,i,r),{quadMaterial:i,outlineMaterial:r,forEach:a=>{a(i),r&&a(r)}}}_createObject3DGeometries(e,i,r){if(Nt(this._up,rr)&&Nt(this._right,rr))return;let a=this._createGeometries(i,r);for(let o of a)e.addGeometry(o);this._updateTransformObject3D(e)}_createDrapedResources(){let e=new Se(this._quadMaterialParameters),i=this._outlineSize===0?void 0:new ne(this._outlineMaterialParameters),r=this._createGeometries(e,i).map(a=>new di(a));return this._setTransformDraped(r),{quadMaterial:e,outlineMaterial:i,geometries:r,pixelRatioHandle:v(()=>this.view.state.contentPixelRatio,()=>{this.drapedResources.recreateGeometry()})}}_createGeometries(e,i){let{up:r,right:a,corner:o}=this._getVertices(),s=Od(r,a,o,e);return i?[s,Me(i,[r,o,a])]:[s]}_getVertices(){let e=this._up,i=this._right,r=V(y.get(),e,i);return this.isDraped&&(e=G(y.get(),e),i=G(y.get(),i),e[2]=0,i[2]=0,r[2]=0),{up:e,right:i,corner:r}}_updateTransform(){this.isDraped?this.drapedResources.recreateGeometry():this._updateTransformObject3D()}_updateTransformObject3D(e=this.object3dResources.object){if(!e)return;let i=this.view.state.camera,r=this._size*i.computeScreenPixelSizeAt(this._position),a=Math.min(this._maxSize,r);Li(vi,this._position),Ut(vi,vi,[a,a,a]),e.transformation=vi}_setTransformDraped(e){if(e.length===0)return;let{view:{basemapTerrain:{overlayManager:i},state:{contentPixelRatio:r}}}=this,{_position:a,_size:o}=this,s=G(y.get(),a);s[2]=Ui;let n=Td;n.spatialReference=i.renderer.spatialReference,n.x=s[0],n.y=s[1];let l=o*(this.view.overlayPixelSizeInMapUnits(n)*r),p=Math.min(this._maxSize,l);Li(vi,s),Ut(vi,vi,[p,p,1]);for(let u of e)u.transformation=vi}get _quadMaterialParameters(){return{color:this._color,forceTransparentMode:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateQuadMaterial(){this.object3dResources.resources?.quadMaterial.setParameters(this._quadMaterialParameters),this.drapedResources.resources?.quadMaterial.setParameters(this._quadMaterialParameters)}get _outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded,isDecoration:this.isDecoration}}_updateOutlineMaterial(){this.object3dResources.resources?.outlineMaterial?.setParameters(this._outlineMaterialParameters),this.drapedResources.resources?.outlineMaterial?.setParameters(this._outlineMaterialParameters)}};function wd(t){t.pixelRatioHandle.remove(),t.geometries=[]}function Od(t,e,i,r){return new Na(r,[[P.POSITION,new Zr([0,0,0,...e,...t,...i],[0,1,2,1,2,3],3,!0)]])}var vi=re(),Td=Ue(0,0,void 0,null);var gt=class extends Ec{sortUniqueHints(e){return e.sort((i,r)=>(r instanceof Gs?r.length:0)-(i instanceof Gs?i.length:0))}visualizeIntersectionPoint(e,i){let{spatialReference:r,view:a}=i,o=oa(i);return ye(new qi({view:a,primitive:"circle",geometry:zs(e.intersectionPoint,r),elevationInfo:e.isDraped?Ps:Xr,size:20,outlineSize:2,color:o.intersectionPointColor,outlineColor:o.intersectionPointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizePoint(e,i){let{view:r,spatialReference:a}=i,o=oa(i),s=yi(e.point,e.domain,i);return ye(new qi({view:r,primitive:"circle",geometry:zs(s,a),elevationInfo:bo(e),size:20,outlineSize:2,color:o.pointColor,outlineColor:o.pointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizeLine(e,i){let{view:r,spatialReference:a}=i,o=oa(i),s=yi(e.lineStart,e.domain,i),n=yi(e.lineEnd,e.domain,i);return ye(Ed(e.type,s,n,a,bo(e),r,o,e.isDraped,e.fadeLeft,e.fadeRight))}visualizeParallelSign(e,i){let{view:r,spatialReference:a}=i,o=oa(i),{isDraped:s}=e,n=bo(e),l=yi(e.lineStart,e.domain,i),p=yi(e.lineEnd,e.domain,i),u=$i(l,a,n,r,s),d=$i(p,a,n,r,s),m=ct(d,u,d,.5),f=new vo({view:r,attached:!1,offset:Je.parallelLineHintOffset,length:Je.parallelLineHintLength,width:Je.parallelLineHintWidth,color:o.parallelSignColor,location:m,renderOccluded:s?M.OccludeAndTransparent:M.Opaque,isDraped:s,renderGroup:Ni.SnappingHint,isDecoration:!0});return f.setDirectionFromPoints(u,m),f.attached=!0,ye(f)}visualizeRightAngleQuad(e,i){let{view:r,spatialReference:a}=i,o=oa(i),s=bo(e),{isDraped:n}=e,l=yi(e.previousVertex,e.domain,i),p=yi(e.centerVertex,e.domain,i),u=yi(e.nextVertex,e.domain,i),d=$i(l,a,s,r,n),m=$i(p,a,s,r,n),f=$i(u,a,s,r,n);return ye(new yo({view:r,attached:!0,color:n?o.rightAngleColorDraped:o.rightAngleColor,renderOccluded:n?M.OccludeAndTransparent:M.Transparent,outlineRenderOccluded:n?M.OccludeAndTransparent:M.Opaque,outlineColor:o.rightAngleOutlineColor,outlineSize:Je.rightAngleHintOutlineSize,size:Je.rightAngleHintSize,isDraped:n,geometry:{previous:d,center:m,next:f},renderGroup:Ni.SnappingHint,isDecoration:!0}))}};function oa(t){let{effectiveTheme:e}=t.view,i=F.toUnitRGBA(e.accentColor),r=[0,0,0,0];return{intersectionPointColor:r,intersectionPointOutlineColor:i,pointColor:r,pointOutlineColor:i,lineColor:i,lineOutlineColor:void 0,parallelSignColor:i,rightAngleColor:i,rightAngleColorDraped:F.toUnitRGBA($e(e.accentColor,.5)),rightAngleOutlineColor:i}}function yi(t,e,{selfSnappingZ:i,view:r,spatialReference:a}){return e&Oc.SELF&&xc(t)&&i!=null?wc(t,i,r,a):t}function bo(t){return t.isDraped?Ps:Xr}function Ed(t,e,i,r,a,o,s,n=!1,l=!0,p=!0){let u=$i(e,r,a,o,n),d=$i(i,r,a,o,n),m=new It({view:o,extensionType:De.FADED,start:u,end:d,isDraped:n,color:s.lineColor,renderOccluded:n?M.OccludeAndTransparent:M.Opaque,renderGroup:Ni.SnappingHint,isDecoration:!0});switch(t){case eo.TARGET:m.width=Je.lineHintWidthTarget,m.fadedExtensions={start:0,end:Je.lineHintFadedExtensions};break;case eo.REFERENCE_EXTENSION:m.width=Je.lineHintWidthReference,m.fadedExtensions={start:0,end:0};break;case eo.REFERENCE:m.width=Je.lineHintWidthReference,m.fadedExtensions={start:l?Je.lineHintFadedExtensions:0,end:p?Je.lineHintFadedExtensions:0}}return m.attached=!0,m}function $i(t,e,i,r,a){let o=g();if(a){let s=r.basemapTerrain.overlayManager.renderer.spatialReference;Zt(t,e,o,s)}else to(t,e,i,r,o);return o}function br(t){let e=t.graphic;return e?[v(()=>"visible"in t?t.visible:t.displaying,i=>{i&&e.notifyMeshTransformChanged({action:Jr.EnableFastUpdates})},b({},nt)),H(()=>e.notifyMeshTransformChanged({action:Jr.DisableFastUpdates}))]:[]}var Mr=.3;function xr(t,e){e&&Object.assign(t,e)}var $s=class{constructor(e){this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=M.Opaque,this.color=e.accent}},sa=class{constructor(r){var a=r,{colors:e}=a,i=Ii(a,["colors"]);this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=e.accent,this.outlineColor=e.outline,this.renderOccluded=M.Opaque,this.hoverOutlineColor=e.selectedOutline,xr(this,i)}applyColor(e){this._apply(this.color,e)}applyOutline(e){this._apply(this.outlineColor,e)}applyHoverOutline(e){this._apply(this.hoverOutlineColor,e)}_apply(e,i){i.setParameters({color:J(e),renderOccluded:this.renderOccluded})}},Qs=class{constructor(r){var a=r,{colors:e}=a,i=Ii(a,["colors"]);this.size=40,this.height=.2,this.offset=.25,this.collisionPadding=2,this.renderOccluded=M.Transparent,this.minSquaredEdgeLength=900,this.color=$e(e.accent,.5),this.hoverColor=e.accent,xr(this,i)}applyColor(e){this._apply(this.color,e)}applyHover(e){this._apply(this.hoverColor,e)}_apply(e,i){i.setParameters({color:J(e),renderOccluded:this.renderOccluded})}},Js=class{constructor(e){this.vertex=new sa({colors:e,color:e.accent,outlineColor:e.outline}),this.edge=new sa({colors:e,color:Fl($e(e.accent,2/3),.5),outlineColor:$e(e.outline,.5),size:8,collisionPadding:8}),this.selected=new sa({colors:e,color:e.selected,outlineColor:e.outline}),this.edgeOffset=new Qs({colors:e})}},na=class{constructor(r){var a=r,{colors:e}=a,i=Ii(a,["colors"]);this.width=1.5,this.stipplePattern=mp(3.3),this.falloff=0,this.innerWidth=1.5,this.renderOccluded=M.OccludeAndTransparent,this.color=e.selected,this.stippleOffColor=e.outline,this.innerColor=e.selected,xr(this,i)}apply(e){e.color=J(this.color),e.width=this.width,e.stipplePattern=this.stipplePattern,e.stippleOffColor=J(this.stippleOffColor),e.falloff=this.falloff,e.innerWidth=this.innerWidth,e.innerColor=J(this.innerColor),e.renderOccluded=this.renderOccluded}},Ks=class{constructor(r){var a=r,{colors:e}=a,i=Ii(a,["colors"]);this.size=4,this.outlineSize=1,this.shape="square",this.color=e.selected,this.outlineColor=e.outline,xr(this,i)}apply(e){e.color=J(this.color),e.size=this.size,e.outlineSize=this.outlineSize,e.outlineColor=J(this.outlineColor),e.primitive=this.shape}},Sr=class{constructor(r){var a=r,{colors:e}=a,i=Ii(a,["colors"]);this.innerWidth=1,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=Mr,this.globalAlphaContrastBoost=1.5,this.radius=3,this.innerColor=e.selected,this.glowColor=e.accent,this.heightFillColor=e.accent,xr(this,i)}apply(e,i=1){let r={glowColor:F.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:F.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*i*this.glowColor.a,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in e?e.style=r:e.laserlineStyle=r}},en=class{constructor(e){this.outline=new na({colors:e,color:e.stippleOff,renderOccluded:M.OccludeAndTransparentStencil,stippleOffColor:e.stippleOn,innerWidth:0}),this.staged=new na({colors:e,color:e.stippleOn,renderOccluded:M.OccludeAndTransparentStencil,innerColor:e.stagedSolid,stippleOffColor:e.stippleOff}),this.shadowStyle=new Sr({colors:e,globalAlpha:Mr,glowColor:e.accent,glowFalloff:8,glowWidth:8,innerColor:e.selected,innerWidth:1})}},tn=class{constructor(e){this.outline=new Ks({colors:e,color:e.selected,outlineColor:e.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new Sr({colors:e,globalAlpha:Mr,glowColor:e.accent,glowFalloff:1.5,glowWidth:6,innerColor:e.selected,innerWidth:1,radius:2})}},rn=class extends na{constructor(r){var a=r,{colors:e}=a,i=Ii(a,["colors"]);super({colors:e}),this.extensionType=De.GROUND_RAY,xr(this,i)}},an=class{constructor(e){this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,this.lineObjects=new en(e),this.pointObjects=new tn(e),this.heightPlane=new Sr({colors:e,globalAlpha:Mr,glowColor:e.accent,glowFalloff:8,glowWidth:8,innerColor:e.selected,innerWidth:1}),this.heightBox=new Sr({colors:e,globalAlpha:Mr,glowColor:e.accent,glowFalloff:8,glowWidth:8,innerColor:e.selected,innerWidth:0,heightFillColor:e.accent}),this.zVerticalLine=new rn({colors:e,color:$e(e.accent,5*Mr/3),falloff:2,innerColor:$e(e.selected,0),renderOccluded:M.OccludeAndTransparent,stipplePattern:null,width:5,extensionType:De.GROUND_RAY})}},ue=class extends me{constructor(t){super(t)}get colors(){let t=this.getTheme().accentColor,e=t.a;return{accent:t,contrast:ai(t),selected:F.fromArray([255,255,255,e]),selectedOutline:F.fromArray([255,255,255,e]),staged:F.fromArray([12,207,255,e]),stagedSolid:F.fromArray([12,207,255,1]),outline:F.fromArray([0,0,0,.5*e]),stippleOn:F.fromArray([255,255,255,1]),stippleOff:F.fromArray([0,0,0,.5])}}get visualElements(){return new an(this.colors)}get manipulators(){return new Js(this.colors)}get zManipulator(){return new $s(this.colors)}};c([h()],ue.prototype,"colors",null),c([h()],ue.prototype,"visualElements",null),c([h()],ue.prototype,"manipulators",null),c([h()],ue.prototype,"zManipulator",null),c([h()],ue.prototype,"getTheme",void 0),ue=c([E("esri.views.3d.interactive.editingTools.settings")],ue);var ze=class extends Dt{constructor(e){super(e),this._attachmentOrigin=Ue(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new te,this._geometry=null,this._width=1,this._color=oi(1,0,1,1),this._innerWidth=0,this._innerColor=oi(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=M.OccludeAndTransparentStencil,this._attachmentOrigin.spatialReference=e.view.spatialReference,this._laserline=new ft({view:e.view,isDecoration:e.isDecoration}),this.applyProperties(e),this.attached=e.attached??!0}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(e){return{view:e,createResources:i=>this._createObject3DResources(i),destroyResources:Np,recreateGeometry:(i,r)=>{i.geometries.length=0,this._recreateGeometry(r,i.material,i.geometries)}}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:Np,recreateGeometry:i=>{i.geometries=this._createRenderGeometriesDraped(i.material),this._attachmentOriginChanged()}}}get _laserlineAttached(){return this.attached&&this.visible&&this._laserlineStyle!=null&&!this.isDraped&&this.laserlineEnabled}onAttachedChange(e){this._laserline.attached=this._laserlineAttached,e&&this._attachmentOriginChanged()}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){Te(e,this._color)||(ge(this._color,e),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){Te(e,this._innerColor)||(ge(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){let i=e!=null!=(this._stipplePattern!=null);this._stipplePattern=e,i?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){e&&this._stippleOffColor&&Te(e,this._stippleOffColor)||(this._stippleOffColor=e?Ka(e):null,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,e!=null&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get attachmentOrigin(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;let e=this.object3dResources.resources?.geometries;if(!e||e.length===0)return null;j(wr,0,0,0);let i=0;for(let r of e)r.computeAttachmentOrigin(Up)&&(V(wr,wr,Up),i++);return i===0?null:(W(wr,wr,1/i),this.view.renderCoordsHelper.fromRenderCoords(wr,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}_updateMaterial(){this.object3dResources.resources!=null&&this.object3dResources.resources.material.setParameters(this._materialParameters),this.drapedResources.resources!=null&&this.drapedResources.resources.material.setParameters(this._materialParameters)}get _isClosed(){return this.geometry!=null&&this.geometry.type==="polygon"}get _materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:!1,isClosed:this._isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",hasPolygonOffset:!0,renderOccluded:this._normalizedRenderOccluded,isDecoration:this.isDecoration}}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===M.OccludeAndTransparentStencil?M.OccludeAndTransparent:this._renderOccluded}_recreateGeometry(e,i,r){this._createRenderGeometries(i,r);for(let a of r)e.addGeometry(a);this._attachmentOriginChanged()}_attachmentOriginChanged(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}_createObject3DResources(e){let i=new ne(this._materialParameters),r=new Array;return this._recreateGeometry(e,i,r),{material:i,geometries:r,forEach:a=>{a(i),r.forEach(a)}}}_createDrapedResources(){let e=new ne(this._materialParameters);return{material:e,geometries:this._createRenderGeometriesDraped(e)}}_createRenderGeometriesDraped(e){let{geometry:i,view:r}=this,a=r.basemapTerrain.spatialReference;return i==null||a==null?[]:gp(i,a).lines.map(({position:o})=>{let s={overlayInfo:{spatialReference:a,renderCoordsHelper:r.renderCoordsHelper},attributeData:{position:o},removeDuplicateStartEnd:this._isClosed};return new di(po(e,s))})}calculateMapBounds(e){if(this.object3dResources.resources==null)return!1;let i=this.view.renderCoordsHelper;for(let r of this.object3dResources.resources.geometries){let a=r.attributes.get(P.POSITION),o=Gi(a.data.length);Ml(a.data,i.spatialReference,0,o,this.view.spatialReference,0,a.data.length/3),Ra(e,o)}return!0}_createRenderGeometries(e,i){let r=this.geometry;if(r==null)return;let a=fp(r,this.view.elevationProvider,this.view.renderCoordsHelper,et.fromElevationInfo(this.elevationInfo??new Fa({mode:Xl(r,null)}))),o=new Array;for(let{position:s,mapPositions:n}of a.lines){let l={mapPositions:n,attributeData:{position:s},removeDuplicateStartEnd:this._isClosed};i.push(po(e,l)),o.push(s)}this._laserline.pathVerticalPlane=o}};function Np(t){t.geometries=[]}var Up=g(),wr=g();function Bp(t,e,i,r,a){let o=Gi(3*t.length),s=Gi(o.length);t.forEach((p,u)=>{o[3*u]=p[0],o[3*u+1]=p[1],o[3*u+2]=p.length>2?p[2]:0});let n=dp(o,e,0,s,0,o,0,o.length/3,i,r,a),l=n!=null;return{numVertices:t.length,position:o,mapPositions:s,projectionSuccess:l,sampledElevation:n}}var la=class t extends Rt{initializeProgram(e){return new Pt(e.rctx,t.shader.get().build(this.configuration),on)}_setPipelineState(e){let i=this.configuration,r=e===wt.NONE,a=e===wt.FrontFace;return Tt({blending:i.output===Be.Color&&i.transparent?r?sc:Wa(e):null,culling:Za(i.cullFace),depthTest:{func:a?sr.LESS:i.shadingEnabled?sr.LEQUAL:sr.LESS},depthWrite:r?i.writeDepth?Ya:null:Xa(e),drawBuffers:qa(e),colorWrite:Ot,polygonOffset:r||a?null:lc})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};la.shader=new Et(_p,()=>import("./chunk-UXD4JVBM.js"));var Ie=class extends $a{constructor(){super(...arguments),this.output=Be.Color,this.cullFace=X.None,this.transparencyPassType=wt.NONE,this.hasSlicePlane=!1,this.transparent=!1,this.writeDepth=!0,this.screenSizeEnabled=!0,this.shadingEnabled=!0,this.multipassEnabled=!1,this.cullAboveGround=!1}};c([N({count:Be.COUNT})],Ie.prototype,"output",void 0),c([N({count:X.COUNT})],Ie.prototype,"cullFace",void 0),c([N({count:wt.COUNT})],Ie.prototype,"transparencyPassType",void 0),c([N()],Ie.prototype,"hasSlicePlane",void 0),c([N()],Ie.prototype,"transparent",void 0),c([N()],Ie.prototype,"writeDepth",void 0),c([N()],Ie.prototype,"screenSizeEnabled",void 0),c([N()],Ie.prototype,"shadingEnabled",void 0),c([N()],Ie.prototype,"multipassEnabled",void 0),c([N()],Ie.prototype,"cullAboveGround",void 0),c([N({constValue:!1})],Ie.prototype,"occlusionPass",void 0);var on=new Map([[P.POSITION,0],[P.NORMAL,1],[P.OFFSET,2]]);var Qi=class extends ac{constructor(e){super(e,new nn),this.supportsEdges=!0,this.produces=new Map([[Ze.OPAQUE_MATERIAL,i=>i===Be.Highlight||Ha(i)&&!this._isTransparent],[Ze.TRANSPARENT_MATERIAL,i=>Ha(i)&&this._isTransparent&&this.parameters.writeDepth],[Ze.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,i=>Ha(i)&&this._isTransparent&&!this.parameters.writeDepth]]),this._configuration=new Ie,this._vertexAttributeLocations=on}getConfiguration(e,i){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._isTransparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.screenSizeEnabled=this.parameters.screenSizeEnabled,this._configuration.shadingEnabled=this.parameters.shadingEnabled,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}intersect(e,i,r,a,o,s){if(this.parameters.screenSizeEnabled){let n=e.attributes.get(P.OFFSET);Is(e,r,a,o,{applyToVertex:(p,u,d,m)=>{let f=j(Zp,n.data[3*m],n.data[3*m+1],n.data[3*m+2]),_=j(Rd,p,u,d);return W(f,f,this.parameters.screenSizeScale*r.camera.computeScreenPixelSizeAt(f)),V(_,_,f),[_[0],_[1],_[2]]},applyToAabb:p=>{let u=gl(p,Zp);return _l(p,this.parameters.screenSizeScale*r.camera.computeScreenPixelSizeAt(u))}},s)}else Is(e,r,a,o,void 0,s)}createGLMaterial(e){return new sn(e)}createBufferWriter(){return new ln(this.parameters.screenSizeEnabled)}get _isTransparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}},sn=class extends Ds{beginSlot(e){return this.ensureTechnique(la,e)}},nn=class extends Ba{constructor(){super(...arguments),this.color=Le(1,1,1,1),this.shadingTint=Le(0,0,0,.25),this.shadingDirection=ie(g(),[.5,-.5,-.5]),this.screenSizeScale=14,this.forceTransparentMode=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=X.None,this.screenSizeEnabled=!1,this.shadingEnabled=!0}},ln=class{constructor(e){this.screenSizeEnabled=e;let i=Da().vec3f(P.POSITION).vec3f(P.NORMAL);this.screenSizeEnabled&&i.vec3f(P.OFFSET),this.vertexBufferLayout=i}elementCount(e){return e.attributes.get(P.POSITION).indices.length}write(e,i,r,a,o){if(uc(r,this.vertexBufferLayout,e,i,a,o),this.screenSizeEnabled){if(!r.attributes.has(P.OFFSET))throw new Error(`${P.OFFSET} vertex attribute required for screenSizeEnabled ShadedColorMaterial`);{let s=r.attributes.get(P.OFFSET);Aa(s.size===3);let n=a.getField(P.OFFSET,Tl);if(!n)throw new Error("unable to acquire view for "+P.OFFSET);dc(s,i,n,o)}}}},Zp=g(),Rd=g();var ca=class extends _i{constructor(e){super(e),this.view=null,this._renderOccluded=M.OccludeAndTransparent,this._vertices=null,this._spatialReference=null,this._color=gs([1,127/255,0,1]),this._size=11,this._outlineColor=gs([0,0,0,.5]),this._outlineSize=1,this._elevationInfo=null,this.applyProperties(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial(),this._updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(e){this._vertices=e,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.recreateGeometry()}get color(){return this._color}set color(e){Te(e,this._color)||(ge(this._color,e),this._updateMaterial())}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){Te(e,this._outlineColor)||(ge(this._outlineColor,e),this._updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get _vertexMaterialParameters(){return{color:this._color,screenSizeScale:this.size,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}get _vertexOutlineMaterialParameters(){return{color:this._outlineColor,screenSizeScale:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateMaterial(){this.attached&&this._vertexMaterial.setParameters(this._vertexMaterialParameters)}_updateOutlineMaterial(){this.attached&&this._vertexOutlineMaterial.setParameters(this._vertexOutlineMaterialParameters)}_createRenderGeometries(){let e=this.vertices;if(e==null||e.length===0)return[];let i=.5,r=.5,a=Bp(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,et.fromElevationInfo(this.elevationInfo)),o=[],s=a.numVertices,n=a.position;for(let l=0;l<s;++l){let p=j(Pd,n[3*l],n[3*l+1],n[3*l+2]),u=Yp(this._vertexMaterial,i,p),d=Yp(this._vertexOutlineMaterial,r,p);o.push({vertexGeometry:u,vertexOutlineGeometry:d})}return o}createGeometries(e){let i=this._createRenderGeometries();for(let{vertexGeometry:r,vertexOutlineGeometry:a}of i)e.addGeometry(r),e.addGeometry(a)}createExternalResources(){this._vertexMaterial=new Qi(O(b({},this._vertexMaterialParameters),{writeDepth:!0,cullFace:X.Back,screenSizeEnabled:!0})),this._vertexOutlineMaterial=new Qi(O(b({},this._vertexOutlineMaterialParameters),{forceTransparentMode:!0,writeDepth:!0,cullFace:X.Front,screenSizeEnabled:!0,shadingEnabled:!1}))}destroyExternalResources(){this._vertexMaterial=null,this._vertexOutlineMaterial=null}forEachExternalMaterial(e){e(this._vertexMaterial),e(this._vertexOutlineMaterial)}},Pd=g();function Yp(t,e,i){return Bi(t,e,16,16,{offset:i})}var jt=class extends te.EventedAccessor{constructor(t){super(t),this.tracking=!1,this.displaying=!1,this.isDraped=!1}};c([h({constructOnly:!0})],jt.prototype,"graphic",void 0),c([h()],jt.prototype,"tracking",void 0),c([h()],jt.prototype,"displaying",void 0),c([h()],jt.prototype,"isDraped",void 0),jt=c([E("esri.views.3d.layers.graphics.GraphicState")],jt);var Ji=class extends jc{constructor(t){super(t),this._activeVertexVisualElement=null,this._createGraphicState=null,this._outlineVisualElement=null,this._verticesVisualElement=null,this._verticalLineVisualElement=null,this._settings=new ue({getTheme:()=>this.view.effectiveTheme}),this.geometryType=null,this.type="draw-3d"}initialize(){let{mode:t,offset:e,unit:i}=this.elevationInfo;this.internalGraphicsLayer.elevationInfo=new Fa({mode:t,offset:e,unit:i})}normalizeCtorArgs(t){if(!t.elevationInfo){let e=t.hasZ??!0;return O(b({},t),{elevationInfo:Wl(e)})}return t}initializeGraphic(t){let{view:e}=this,i=this._createGraphicState=new jt({graphic:t});return ee([e.maskOccludee(t),e.trackGraphicState(i),v(()=>({element:this._outlineVisualElement,isDraped:i.isDraped}),({element:r,isDraped:a})=>{r&&(r.isDraped=a)},nt),Kn(()=>{qr(this.tooltipInfos.mesh,this.geometryToPlace)}),this._setupLoadingIndicator(i),...br(i)])}makeDrawOperation(){let{geometryType:t}=this,e=t!=="circle"&&t!=="rectangle";return new Zc({view:this.view,manipulators:this.manipulators,geometryType:Lc(t),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:new Wc(this.view,this.elevationInfo,[this.internalGraphicsLayer]),elevationDrawSurface:new Yc(this.elevationInfo,this.defaultZ,this.view,this.internalGraphicsLayer),hasM:!1,elevationInfo:this.elevationInfo,snappingManager:this.snappingManager,snappingVisualizer:new gt,segmentLabels:e?new vr:null,labelOptions:this.sketchOptions.labels,isDraped:this._createGraphicState?this._createGraphicState.isDraped:Es(this.hasZ,this.elevationInfo)==="on-the-ground",cursor:this.cursor,constraintsEnabled:!0})}onActiveVertexChanged(t){let{view:e}=this;if(this._activeVertexVisualElement)return this._activeVertexVisualElement.vertices=[t],this._activeVertexVisualElement.recreate(),this._updateVerticalLineVisualElement(t),H();let i=this._settings,r=i.manipulators.vertex,a=new ca({view:e,spatialReference:e.spatialReference,vertices:[t],elevationInfo:this.internalGraphicsLayer.elevationInfo,size:r.size,outlineSize:r.outlineSize,renderOccluded:r.renderOccluded,attached:!1,isDecoration:!0});this._activeVertexVisualElement=a;let o=i.visualElements.zVerticalLine,s=new It({view:e,extensionType:o.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:M.OccludeAndTransparent,isDecoration:!0});this._verticalLineVisualElement=s;let n=ee([v(()=>i.visualElements.zVerticalLine,l=>l.apply(s),I),v(()=>({selectedColor:J(i.colors.selected),outlineColor:J(i.manipulators.vertex.outlineColor)}),({selectedColor:l,outlineColor:p})=>{a.color=l,a.outlineColor=p},I),H(()=>{this._activeVertexVisualElement=k(this._activeVertexVisualElement),this._verticalLineVisualElement=k(this._verticalLineVisualElement)})]);return a.attached=!0,this._updateVerticalLineVisualElement(t),n}_updateVerticalLineVisualElement(t){let e=this._verticalLineVisualElement;if(!e)return;let{renderCoordsHelper:i,elevationProvider:r}=this.view;j(Or,t[0],t[1],t[2]),Wp.setFromElevationInfo(this.elevationInfo),Or[2]=ui(Or,r,Wp,i),i.toRenderCoords(Or,this.view.spatialReference,Or)?(e.setStartEndFromWorldDownAtLocation(Or),e.attached=!0):e.attached=!1}onOutlineChanged(t){if(this._outlineVisualElement)return this._outlineVisualElement.geometry=t,H();let e=this.internalGraphicsLayer.elevationInfo,{view:i}=this,r=this._settings,a=new ze({view:i,geometry:t,elevationInfo:e,isDraped:this._createGraphicState?this._createGraphicState.isDraped:Es(this.hasZ,e)==="on-the-ground",attached:!1,isDecoration:!0});this._outlineVisualElement=a;let o=ee([v(()=>r.visualElements.lineObjects.outline,s=>s.apply(a),I),v(()=>r.visualElements.lineObjects.shadowStyle,s=>s.apply(a),I),H(()=>{this._outlineVisualElement=k(this._outlineVisualElement)})]);return a.attached=!0,a.laserlineEnabled=!0,o}onRegularVerticesChanged(t){if(this._verticesVisualElement)return this._verticesVisualElement.vertices=t,H();let{view:e}=this,i=this._settings,r=i.manipulators.vertex,a=new ca({view:e,spatialReference:e.spatialReference,vertices:t,elevationInfo:this.internalGraphicsLayer.elevationInfo,size:r.size,outlineSize:r.outlineSize,renderOccluded:r.renderOccluded,attached:!1,isDecoration:!0}),o=ee([v(()=>({color:J(i.manipulators.vertex.color),outlineColor:J(i.manipulators.vertex.outlineColor)}),({color:s,outlineColor:n})=>{a.color=s,a.outlineColor=n},I),H(()=>{this._verticesVisualElement=k(this._verticesVisualElement)})]);return a.attached=!0,this._verticesVisualElement=a,o}updateGraphicGeometry(t){if(this.geometryType!=="mesh"||t?.type!=="point")super.updateGraphicGeometry(t);else{let e=this.geometryToPlace;e?.centerAt(t),qr(this.tooltipInfos.mesh,e);let i=this._graphic;e&&i.geometry===e||(i.geometry=e)}}_setupLoadingIndicator(t){let{drawOperation:e}=this;if(!this.geometryToPlace)return e.loading=!1,null;e.loading=!0;let i=H(()=>{e.loading=!1}),r,a=()=>r&&cancelAnimationFrame(r);return ee([st(()=>t.displaying,()=>{a(),r=requestAnimationFrame(()=>i.remove())},O(b({},nt),{once:!0})),H(a),i])}};c([h({constructOnly:!0})],Ji.prototype,"elevationInfo",void 0),c([h({constructOnly:!0})],Ji.prototype,"geometryType",void 0),c([h()],Ji.prototype,"type",void 0),c([h({constructOnly:!0})],Ji.prototype,"view",void 0),Ji=c([E("esri.views.3d.interactive.editingTools.draw.DrawGraphicTool3D")],Ji);var Wp=new et,Or=g();function Xp(t){let e=pa(t);return El(Math.cos(e),Math.sin(e))}function pa(t){if(t==null||t.type!=="polyline"&&t.type!=="polygon")return 0;let e=t.type==="polyline"?t.paths:t.rings,i=nl();for(let r of e)for(let a=0;a<r.length-1;a++){let o=r[a],s=r[a+1],n=o[0]-s[0],l=o[1]-s[1];if(n*n+l*l>i)return Math.atan2(s[1]-o[1],s[0]-o[0])}return 0}function B(t){return t?.operations?.data.geometry}function _t(t,e){return Ad(t?.data.coordinateHelper.hasZ(),e)}function Ad(t,e){return!!t&&e.mode!=="on-the-ground"&&!$l(e)}function Mo(t,e,i){function r(){let s=i(),n=s.sketchOptions.tooltips.effectiveEnabled?s.activeTooltipInfo:null;return O(b({},s),{activeTooltipInfo:n})}let a=!1;function o({activeTooltipInfo:s,sketchOptions:n}){a=!0,s&&(s.sketchOptions=n,cn(s,e)),t.info=s,a=!1}return ee([v(r,o,nt),v(()=>{let s=r(),{activeTooltipInfo:n}=s;if(n)return{context:s,activeTooltipInfo:n,key:n.key,geometry:B(e)}},(s,n)=>{s&&!a&&n&&n.key!==s.key&&Dd(s.activeTooltipInfo,e,s.context)},Ht),e.on("committed",()=>o(r())),ro(t)])}function Dd(t,e,{callbacks:i}){let r=B(e);switch(r?.type){case"mesh":ha(t,r.origin,e,i),"orientation"in t&&"scale"in t&&qr(t,r,i);break;case"point":ha(t,r,e,i)}}function ha(t,e,i,r){let{dx:a,dy:o,dz:s}=io(t,e);a===0&&o===0&&s===0||(r.onMoveStart?.(),i.operations?.move(a,o,s,be.NEW_STEP),r.onMove?.(a,o,s),r.onMoveStop?.())}function cn(t,e){let i=B(e);if(!t||!i||i.type!=="mesh"&&i.type!=="point")return;let r=i.type==="mesh",a=r?i.origin:i;t.setLocationFromPoint(a),pn(t,a,e),t.type==="transform-mesh"&&r&&Pc(t,i),t.clearInputValues()}function pn(t,e,i){t.elevation.actual=Ic(e),t.elevation.visible=!!i.operations?.data.coordinateHelper.hasZ(),t.elevation.readOnly=!1,t.elevation.showAsZ=!0}function So(t,e,i=xt()){return bi(t,ji(e),i),ie(i.direction,i.direction),i}function bi(t,e,i){return qp(t,t.screenToRender(e,y.get()),i)}function qp(t,e,i){let r=_s(y.get(),e);if(r[2]=0,!t.unprojectFromRenderScreen(r,i.origin))return null;let a=_s(y.get(),e);a[2]=1;let o=t.unprojectFromRenderScreen(a,y.get());return o==null?null:(R(i.direction,o,i.origin),i)}var Z=class{constructor(e){this.metadata=void 0,this._camera=new op,this._elevation={offset:0,override:null},this.collisionType={type:"point"},this.collisionPriority=0,this._renderObjects=new Array,this.autoScaleRenderObjects=!0,this._available=!0,this._noDisplayCount=0,this._radius=10,this._worldSized=!1,this.focusMultiplier=2,this.touchMultiplier=2.5,this.worldOriented=!1,this._modelTransform=re(),this._worldFrame=null,this._renderLocation=g(),this._renderLocationDirty=!0,this._location=new Ne({x:0,y:0,z:0}),this._elevationAlignedLocation=new Ne,this._elevationAlignedLocationDirty=!0,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.consumesClicks=!0,this.cursor=null,this.grabCursor=null,this._grabbing=!1,this.dragging=!1,this._hovering=!1,this._selected=!1,this._state=se.None,this._focused=!1,this.events=new te.EventEmitter,this._screenLocation={screenPointArray:Oe(),renderScreenPointArray:Gr(),pixelSize:0},this._screenLocationDirty=!0,this._engineResourcesAddedToStage=!1,this._attached=!1,this._location.spatialReference=e.view.spatialReference,Object.assign(this,e);let i=this.view.state?.camera;i&&this._camera.copyFrom(i)}destroy(){this._applyObjectTransform=zd,this._removeResourcesFromStage(),this._engineResources=null,this.view=null,this._camera=null}get _stage(){return this.view?._stage}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this._elevationAlignedLocationDirty=!0,this._renderLocationDirty=!0,this._updateEngineObject()}get renderObjects(){return this._renderObjects}set renderObjects(e){this._removeResourcesFromStage(),this._engineResources=null,this._renderObjects=e.slice(),this._updateEngineObject()}set available(e){e!==this._available&&(this._available=e,this._updateEngineObject())}get available(){return this._available}disableDisplay(){return this._noDisplayCount++,this._noDisplayCount===1&&this._updateEngineObject(),H(()=>{this._noDisplayCount--,this._noDisplayCount===0&&this._updateEngineObject()})}set radius(e){e!==this._radius&&(this._radius=e,this._updateEngineObject())}get radius(){return this._radius}set worldSized(e){e!==this._worldSized&&(this._worldSized=e,this._updateEngineObject())}get worldSized(){return this._worldSized}get modelTransform(){return this._modelTransform}set modelTransform(e){$p(e)&&(this._screenLocationDirty=!0),Hr(this._modelTransform,e),this._updateEngineObject()}get renderLocation(){return this._renderLocationDirty&&(this._renderLocationDirty=!1,this.view.renderCoordsHelper.toRenderCoords(this.elevationAlignedLocation,this._renderLocation),this.worldOriented?(this._worldFrame||(this._worldFrame=re()),Cd(this.view,this._renderLocation,this._worldFrame)):this._worldFrame&&(this._worldFrame=null)),this._renderLocation}set renderLocation(e){this.view.renderCoordsHelper.fromRenderCoords(e,this._location),this.elevationAlignedLocation=this._location}get location(){return this._location}set location(e){Ns(e,this._location),this._notifyLocationChanged()}_notifyLocationChanged(){this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!0,this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}get elevationAlignedLocation(){return this._elevationAlignedLocationDirty?(this._evaluateElevationAlignment(),this._updateElevationAlignedLocation(),this._elevationAlignedLocation):this._elevationAlignedLocation}set elevationAlignedLocation(e){Ns(e,this._location),this._evaluateElevationAlignment(),this._location.z-=this._elevation.offset,this._updateElevationAlignedLocation(),this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}_updateElevationAlignedLocation(){let e=this._elevation.override!=null?this._elevation.override:this.location.z||0;this._elevationAlignedLocation.x=this.location.x,this._elevationAlignedLocation.y=this.location.y,this._elevationAlignedLocation.z=e+this._elevation.offset,this._elevationAlignedLocation.spatialReference=zc(this.location.spatialReference),this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!1}grabbableForEvent(){return!0}get grabbing(){return this._grabbing}set grabbing(e){e!==this._grabbing&&(this._grabbing=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get hovering(){return this._hovering}set hovering(e){e!==this._hovering&&(this._hovering=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get selected(){return this._selected}set selected(e){e!==this._selected&&(this._selected=e,this._updateEngineObject(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._updateEngineObject())}updateStateEnabled(e,i){i?this.state|=e:this.state&=~e}_setFocused(e){e!==this._focused&&(this._focused=e,this.events.emit("focus-changed",{action:e===!0?"focus":"unfocus"}))}get focused(){return this._focused}get screenLocation(){return this._ensureScreenLocation(),this._screenLocation}_ensureScreenLocation(){if(!this._screenLocationDirty)return;this._screenLocation.pixelSize=this._camera.computeScreenPixelSizeAt(this.renderLocation),this._screenLocationDirty=!1;let e;if($p(this._modelTransform)){let i=this._calculateModelTransformOffset(Vd);e=V(i,i,this.renderLocation)}else e=this.renderLocation;this._camera.projectToRenderScreen(e,this._screenLocation.renderScreenPointArray),this._camera.renderToScreen(this._screenLocation.renderScreenPointArray,this._screenLocation.screenPointArray)}get applyObjectTransform(){return this._applyObjectTransform}set applyObjectTransform(e){this._applyObjectTransform=e,this._screenLocationDirty=!0,this._updateEngineObject()}get attached(){return this._attached}intersectionDistance(e,i){if(!this.available)return null;let r=ji(e,jd),a=this._getCollisionRadius(i),o=-1*this.collisionPriority;switch(this.collisionType.type){case"point":if(Pa(this.screenLocation.screenPointArray,r)<a*a)return this.screenLocation.renderScreenPointArray[2]+o;break;case"line":{let s=this.collisionType.paths,n=this._getWorldToScreenObjectScale(),l=this._calculateObjectTransform(n,xo),p=a*this.screenLocation.pixelSize,u=bi(this._camera,r,hn);if(u==null)return null;for(let d of s){if(d.length===0)continue;let m=kt(da,d[0],l);for(let f=1;f<d.length;f++){let _=kt(Kp,d[f],l),x=Yl(lr(m,_,Qp),u);if(x!=null&&x<p*p){let D=V(y.get(),m,_);W(D,D,.5);let T=y.get();return this._camera.projectToRenderScreen(D,T),T[2]+o}G(m,_)}}break}case"disc":{let s=this.collisionType.direction,n=this.collisionType.offset??rr,l=this._getWorldToScreenObjectScale(),p=this._calculateObjectTransform(l,xo),u=a*this.screenLocation.pixelSize,d=bi(this._camera,r,hn);if(d==null)return null;let m=vs(Jp,p),f=ps(th,s,m),_=kt(ih,n,p);dt(_,f,wo);let x=eh;if(ut(wo,d,x)&&wa(x,_)<u*u)return this.screenLocation.renderScreenPointArray[2]+o;break}case"ribbon":{let{paths:s,direction:n}=this.collisionType,l=this._getWorldToScreenObjectScale(),p=this._calculateObjectTransform(l,xo),u=a*this._camera.computeScreenPixelSizeAt(this.renderLocation),d=bi(this._camera,r,hn);if(d==null)return null;let m=vs(Jp,p),f=ps(th,n,m),_=this._calculateModelTransformPosition(ih);dt(_,f,wo);let x=eh;if(!ut(wo,d,x))break;for(let D of s){if(D.length===0)continue;let T=kt(da,D[0],p);for(let A=1;A<D.length;A++){let Q=kt(Kp,D[A],p),ae=Zl(lr(T,Q,Qp),x);if(ae!=null&&ae<u*u){let xe=V(y.get(),T,Q);W(xe,xe,.5);let Ce=y.get();return this._camera.projectToRenderScreen(xe,Ce),Ce[2]+o}G(T,Q)}}break}default:this.collisionType}return null}attach(e={manipulator3D:{}}){let i=this._stage;if(!i)return;let r=e.manipulator3D;r.engineLayerId==null?(this._engineLayer=new gr(i,{pickable:!1,updatePolicy:hi.SYNC}),r.engineLayerId=this._engineLayer.id):i?.getObject&&(this._engineLayer=i.getObject(r.engineLayerId)),r.engineLayerReferences=(r.engineLayerReferences||0)+1,this._materialIdReferences=r.materialIdReferences,this._materialIdReferences==null&&(this._materialIdReferences=new Map,r.materialIdReferences=this._materialIdReferences),this._camera.copyFrom(this.view.state.camera),this._attached=!0,this._updateEngineObject(),Sl(this._location.spatialReference,this.view.spatialReference)||(this.location=new Ne({x:0,y:0,z:0,spatialReference:this.view.spatialReference}))}detach(e={manipulator3D:{}}){let i=e.manipulator3D;i.engineLayerReferences--;let r=i.engineLayerReferences===0;this._removeResourcesFromStage(),r&&(i.engineLayerId=null,k(this._engineLayer)),this._engineResources=null,this._engineLayer=null,this._materialIdReferences=null,this._attached=!1}onViewChange(){this._camera.copyFrom(this.view.state.camera),this._screenLocationDirty=!0,this._updateEngineObject()}onElevationChange(e){Ur(this.location,rh,e.spatialReference)&&hl(e.extent,rh)&&this._notifyLocationChanged()}_evaluateElevationAlignment(){if(this.elevationInfo==null)return;let e=null,i=0,r=Ql(this.elevationInfo,this.location.spatialReference??this.view.elevationProvider.spatialReference);switch(this.elevationInfo.mode){case"on-the-ground":e=Qr(this.view.elevationProvider,this.location,"ground")??0;break;case"relative-to-ground":i=(Qr(this.view.elevationProvider,this.location,"ground")??0)+r;break;case"relative-to-scene":i=(Qr(this.view.elevationProvider,this.location,"scene")??0)+r;break;case"absolute-height":i=r}return i!==this._elevation.offset||e!==this._elevation.override?(this._elevation.offset=i,void(this._elevation.override=e)):void 0}_updateEngineObject(){if(!this._attached)return;if(!this.available)return void this._removeResourcesFromStage();let e=this._getWorldToScreenObjectScale(),i=xo;if(this.autoScaleRenderObjects===!0){let s=this._getFocusedSize(this._radius,this.focused)*e;this._calculateObjectTransform(s,i)}else this._calculateObjectTransform(e,i);let{objectsByState:r}=this._ensureEngineResources(),a=(this.focused?S.Focused:S.Unfocused)|(this.selected?S.Selected:S.Unselected),o=this._noDisplayCount>0;for(let{stateMask:s,objects:n}of r){if(o){for(let m of n)m.visible=!1;continue}let l=(s&S.All)!==S.None,p=(s&se.All)!==se.None,u=!l||(a&s)==(s&S.All),d=!p||(this.state&s)==(s&se.All);if(u&&d)for(let m of n)m.visible=!0,m.transformation=i;else for(let m of n)m.visible=!1}}_ensureEngineResources(){if(this._engineResources==null){let e=this._engineLayer,i=[],r=new Set;this.renderObjects.forEach(({geometry:{material:s}})=>{r.has(s)||(i.push(s),r.add(s))});let a=new Map;this._renderObjects.forEach(s=>{let n=new fr({castShadow:!1,geometries:[s.geometry]}),l=a.get(s.stateMask)||[];l.push(n),a.set(s.stateMask,l)});let o=[];a.forEach((s,n)=>o.push({stateMask:n,objects:s})),this._engineResources={objectsByState:o,layer:e,materials:i}}return this._addResourcesToStage(),this._engineResources}_addResourcesToStage(){let e=this._stage;if(this._engineResourcesAddedToStage||this._engineResources==null||!e)return;let{objectsByState:i,layer:r,materials:a}=this._engineResources;a.forEach(o=>{let s=this._materialIdReferences,n=s.get(o.id)||0;n===0&&e.add(o),s.set(o.id,n+1)}),i.forEach(({objects:o})=>{r.addMany(o),e.addMany(o)}),this._engineResourcesAddedToStage=!0}_removeResourcesFromStage(){let e=this._stage;if(!this._engineResourcesAddedToStage||this._engineResources==null||!e)return;let{objectsByState:i,layer:r,materials:a}=this._engineResources;i.forEach(({objects:o})=>{r.removeMany(o),e.removeMany(o)}),a.forEach(o=>{let s=this._materialIdReferences,n=s.get(o.id);n===1?(e.remove(o),s.delete(o.id)):s.set(o.id,n-1)}),this._engineResourcesAddedToStage=!1}_getCollisionRadius(e){return this._getFocusedSize(this.radius,!0)*(e==="touch"?this.touchMultiplier:1)}_getFocusedSize(e,i){return e*(i?this.focusMultiplier:1)}_getWorldToScreenObjectScale(){return this._worldSized?1:this.screenLocation.pixelSize}_calculateModelTransformPosition(e){let i=this._getWorldToScreenObjectScale(),r=this._calculateObjectTransform(i,Ld);return j(e,r[12],r[13],r[14])}_calculateModelTransformOffset(e){let i=this._calculateModelTransformPosition(e);return R(e,i,this.renderLocation)}_calculateObjectTransform(e,i){return ds(i,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1),this._worldFrame&&je(i,i,this._worldFrame),je(i,i,this._modelTransform),i[12]+=this.renderLocation[0],i[13]+=this.renderLocation[1],i[14]+=this.renderLocation[2],i[15]=1,this._applyObjectTransform!=null&&this._applyObjectTransform(i),i}get test(){}};function $p(t){return t[12]!==0||t[13]!==0||t[14]!==0}function Cd(t,e,i){switch(t.viewingMode){case"local":return Fr(i),!0;case"global":{let r=xa(t.renderCoordsHelper.spatialReference);return bl(e,0,da,0,r.radius),Ll(oe(da[0]),oe(da[1]),i),!0}}}var jd=Oe(),Qp=Bt(),hn=xt(),Jp=Il(),Ld=re(),xo=re(),wo=St(),da=g(),Kp=g(),eh=g(),th=g(),ih=g(),Vd=g(),rh=new Ne({x:0,y:0,z:0,spatialReference:null}),zd=()=>{};var Ge;(function(t){t[t.NONE=0]="NONE",t[t.ANY=1]="ANY",t[t.Z=2]="Z",t[t.XY=4]="XY"})(Ge||(Ge={}));var C;(function(t){t[t.TRANSLATE_Z=0]="TRANSLATE_Z",t[t.TRANSLATE_XY=1]="TRANSLATE_XY",t[t.SCALE=2]="SCALE",t[t.ROTATE=3]="ROTATE",t[t.SCALE_ROTATE=4]="SCALE_ROTATE"})(C||(C={}));var Tr=class{constructor(){this.grabbingState=Ge.NONE,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}update(e){this.grabbingState=Ge.NONE,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,e.forEachManipulator((i,r)=>{if(r===C.TRANSLATE_Z&&(this.zManipulator=i),i instanceof Z&&(i.selected&&(this.numSelected===0&&(this.firstSelected=i),this.numSelected++),this.firstGrabbedXY==null&&i.grabbing&&r===C.TRANSLATE_XY&&(this.firstGrabbedXY=i)),i.grabbing)switch(this.grabbingState|=Ge.ANY,r){case C.TRANSLATE_Z:this.grabbingState|=Ge.Z;break;case C.TRANSLATE_XY:this.grabbingState|=Ge.XY}})}};function ah(t){let{object:e}=t,i=Gd(t),r=[i,Hd(t,i.visualElement)];return e.maskOccludee&&r.push(e.maskOccludee()),{visualElement:i.visualElement,remove:()=>Vr(r)}}function Gd(t){let{view:e,object:i}=t,r=B(i),a=new ze({view:e,geometry:dn(r)?r:null,elevationInfo:i.elevationInfo,attached:!1,isDecoration:!0}),o=new ue({getTheme:()=>e.effectiveTheme}),s=()=>{a.attached=i.visible},n=ee([v(()=>o.visualElements.lineObjects.outline,l=>l.apply(a),I),v(()=>o.visualElements.lineObjects.shadowStyle,l=>l.apply(a),I),v(()=>i.visible,s),v(()=>i.isDraped,l=>{a.isDraped=l},I),i.on("committed",()=>{let l=B(i);a.geometry=dn(l)?l:null}),ye(a)]);return s(),{visualElement:a,remove:()=>n.remove()}}function Hd(t,e){let{object:i,view:r}=t,a=[],o=i.elevationInfo,s=o.mode==="on-the-ground"||!o.offset&&o.mode!=="absolute-height",n=new Tr,l=new ue({getTheme:()=>r.effectiveTheme}),p=l.visualElements,u=new It({view:r,extensionType:p.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:M.OccludeAndTransparent,isDecoration:!0}),d=oe(p.heightPlaneAngleCutoff),m=new ft({view:r,attached:!1,angleCutoff:d,isDecoration:!0}),f=ar(1);a.push(v(()=>({lineShadowStyle:l.visualElements.lineObjects.shadowStyle,pointShadowStyle:l.visualElements.pointObjects.shadowStyle,alpha:f.value}),({lineShadowStyle:A,pointShadowStyle:Q,alpha:ae})=>{A.apply(e,ae),Q.apply(u,ae)},I));let _=ar(1);a.push(v(()=>({heightPlane:l.visualElements.heightPlane,alpha:_.value}),({heightPlane:A,alpha:Q})=>A.apply(m,Q),I));let x=()=>{n.update(t);let A=B(i);if(!i.visible||s&&(i.isDraped||!dn(A)||!A.hasZ))return e.laserlineEnabled=!1,u.attached=!1,void(m.attached=!1);e.laserlineEnabled=!0;let Q=n.grabbingState&Ge.XY?p.laserlineAlphaMultiplier:1;f.value=Q;let ae=n.grabbingState&Ge.Z?p.laserlineAlphaMultiplier:1;_.value=ae,Fd(u,n),kd(t,e,m,n)};a.push(v(()=>l.visualElements.zVerticalLine,A=>A.apply(u),I)),a.push(i.on("committed",x),v(()=>i.visible,x),e.events.on("attachment-origin-changed",x),ye(u),ye(m));let D=[],T=()=>{Vr(D),D.length=0,t.forEachManipulator(A=>D.push(A.events.on("grab-changed",x))),t.forEachManipulator(A=>D.push(A.events.on("select-changed",x))),x()};return T(),a.push(t.onManipulatorsChanged(T),Sa(()=>ee(D))),ee(a)}function Fd(t,e){let i=e.numSelected===1?e.firstSelected:e.numSelected>1&&e.firstGrabbedXY!=null?e.firstGrabbedXY:null;i!=null?(t.setStartEndFromWorldDownAtLocation(i.renderLocation),t.attached=!0):t.attached=!1}function kd(t,e,i,r){if(r.numSelected>0){j(Ki,0,0,0);let a=0;t.forEachManipulator((o,s)=>{s===C.TRANSLATE_XY&&o.selected&&o instanceof Z&&(V(Ki,Ki,o.renderLocation),a++)}),a>0?(i.heightManifoldTarget=W(Ki,Ki,1/a),i.attached=!0):i.attached=!1}else{let a=e.attachmentOrigin;a!=null&&t.view.renderCoordsHelper.toRenderCoords(a,Ki)?(i.heightManifoldTarget=Ki,i.attached=!0):i.attached=!1}}function dn(t){return t!=null&&(t.type==="polygon"||t.type==="polyline")}var Ki=g();function oh(t){let e=[],i=Ud(t,e);return Nd(t,e,i),{visualElement:i,remove:()=>Vr(e)}}function Nd(t,e,i){let{view:r,object:a}=t,o=new ue({getTheme:()=>r.effectiveTheme}),s=new It({view:r,extensionType:o.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:M.OccludeAndTransparent,isDecoration:!0});e.push(v(()=>o.visualElements.zVerticalLine,T=>T.apply(s),I));let n=new ft({view:r,intersectsLineInfinite:!0,attached:!1,isDecoration:!0}),l=oe(o.visualElements.heightPlaneAngleCutoff),p=new ft({view:r,attached:!1,angleCutoff:l,isDecoration:!0}),u=a.elevationInfo,d=et.fromElevationInfo(u),m=u.mode==="on-the-ground"||!u.offset&&u.mode!=="absolute-height",f=new Tr,_=ar(1);e.push(v(()=>({heightPlane:o.visualElements.heightPlane,alpha:_.value}),({heightPlane:T,alpha:A})=>T.apply(p,A),I));let x=ar(1);e.push(v(()=>({shadowStyle:o.visualElements.pointObjects.shadowStyle,alpha:x.value}),({shadowStyle:T,alpha:A})=>T.apply(n,A),I));let D=()=>{f.update(t);let T=un(B(a)),A=m&&(a.isDraped||T==null||!T.hasZ),Q=!0;if(A||T==null)Q=!1;else{Rs(a.elevationInfo)&&(T=T.clone(),T.z=0);let de=ui(T,r.elevationProvider,d,r.renderCoordsHelper);j(vt,T.x,T.y,de),Zt(vt,T.spatialReference,vt,r.renderCoordsHelper.spatialReference),s.setStartEndFromWorldDownAtLocation(vt),n.intersectsWorldUpAtLocation=vt}let ae=f.grabbingState&Ge.Z?o.visualElements.laserlineAlphaMultiplier:1;_.value=ae;let xe=yl(Wd);!A&&a.visible&&i.calculateMapBounds(xe)&&Zt(vl(xe,vt),r.spatialReference,vt,r.renderCoordsHelper.spatialReference)?(p.heightManifoldTarget=vt,p.attached=!0):p.attached=!1;let Ce=f.grabbingState&Ge.XY?o.visualElements.laserlineAlphaMultiplier:1;x.value=Ce;let L=Q&&a.visible&&!A;n.attached=L,s.attached=L};e.push(v(()=>[a.visible,a.isDraped],D),a.on("committed",D)),t.forEachManipulator(T=>{e.push(T.events.on("grab-changed",D))}),e.push(ye(n)),e.push(ye(s)),e.push(ye(p)),D()}function Ud(t,e){let{view:i,object:r}=t,a=new qi({view:i,geometry:un(B(r)),elevationInfo:r.elevationInfo,isDecoration:!0});return Bd(t,a,e),e.push(ye(a)),a}function un(t){return t==null?null:t.type==="point"?t:t.type==="mesh"?t.anchor.clone():null}function Bd(t,e,i){let{view:r,object:a}=t,o=()=>{e.attached=a.visible},s=new ue({getTheme:()=>r.effectiveTheme});Zd(t,e,i),s.visualElements.pointObjects.outline.apply(e),i.push(v(()=>a.visible,o,I))}function Zd(t,e,i){let{view:r,object:a}=t,o=null,s=l=>{o!=null&&(o.remove(),o=null),a.isDraped&&l!=null&&(o=Yd(r,l,()=>{e.geometry=l}))},n=()=>{let l=un(B(a));l!=null&&Rs(a.elevationInfo)&&(l.z=0),s(l),e.geometry=l};i.push(a.on("committed",n),Sa(()=>o)),n()}function Yd(t,e,i){let r=t.elevationProvider.spatialReference;ys(e,vt,r);let a=vt[0],o=vt[1];return t.elevationProvider.on("elevation-change",s=>{Oa(s.extent,a,o)&&i()})}var vt=g(),Wd=fl();function Mi(t){switch(B(t.object)?.type){case"point":case"mesh":return oh(t);case"polygon":case"polyline":return ah(t);default:return null}}var Oo=Math.ceil(46.666666666666664),Si=160,To=.5,Eo=24,er=9,sh=Si+30,mn=Si+53,nh=60,lh=23,ch=5*Math.PI/12,ph=1*Math.PI/3,fn=10,gn=.2,_n=30,vn=53,yn=.2,bn=.3,hh=200,dh=3,uh=1e6;var it=class{constructor(){this._available=!0}set location(e){this._forEachManipulator3D(i=>i.location=e)}set elevationAlignedLocation(e){this._forEachManipulator3D(i=>i.elevationAlignedLocation=e)}set elevationInfo(e){this._forEachManipulator3D(i=>i.elevationInfo=e)}get renderLocation(){let e;return this._forEachManipulator3D(i=>{e||(e=i.renderLocation)}),e}get available(){return this._available}set available(e){this._available=e,this._forEachManipulator3D(i=>i.available=e)}get hovering(){return this.someManipulator(e=>e.hovering)}get grabbing(){return this.someManipulator(e=>e.grabbing)}get dragging(){return this.someManipulator(e=>e.dragging)}get selected(){return this.someManipulator(e=>e.selected)}hasManipulator(e){return this.someManipulator(i=>i===e)}someManipulator(e){let i=!1;return this.forEachManipulator(r=>{!i&&e(r)&&(i=!0)}),i}_forEachManipulator3D(e){this.forEachManipulator((i,r)=>{i instanceof Z&&e(i,r)})}};var w=class{constructor(e,i=S.None){this.geometry=e,this.stateMask=i}};function tr(t,e){return _h(t,()=>e)}function gh(t){return _h(t,e=>e.plane)}function _h(t,e){let i=g(),r=g(),a=!1;return o=>{let s=e(o);if(o.action==="start"){let p=ji(o.screenStart,xs.get()),u=bi(t.state.camera,p,fh);u!=null&&(a=ut(s,u,i))}if(!a)return null;let n=ji(o.screenEnd,xs.get()),l=bi(t.state.camera,n,fh);return l==null?null:ut(s,l,r)?O(b({},o),{renderStart:i,renderEnd:r,plane:s,ray:l}):null}}function Xd(t,e,i=0,r=null,a=null){let o=null;return s=>{if(s.action==="start"&&(o=t.sceneIntersectionHelper.intersectElevationFromScreen(Oe(s.screenStart.x,s.screenStart.y),e,i,a),o!=null&&r!=null&&!Ur(o,o,r))||o==null)return null;let n=t.sceneIntersectionHelper.intersectElevationFromScreen(Oe(s.screenEnd.x,s.screenEnd.y),e,i,a);return n!=null&&(r==null||Ur(n,n,r))?O(b({},s),{mapStart:o,mapEnd:n}):null}}function xi(t,e,i,r=null,a=null){return Xd(t,i,ka(e,t,i),r,a)}function vh(t,e,i,r){let a=i.toMap(t.screenStart);return a!=null?xi(e,a,i.elevationInfo,r):null}function qd(t,e){let i=Qd,r=Jd,a=St();t.renderCoordsHelper.worldUpAtPosition(e,i);let o=ce(a,i,R(r,e,t.state.camera.eye));return ce(o,o,i),dt(e,o,a)}function Ro(t,e,i){let r=null,a=new pi;return a.next(tr(t,qd(t,e))).next($d(t,e)).next(Sn(t,i)).next(o=>{o.mapEnd.x=o.mapStart.x,o.mapEnd.y=o.mapStart.y,r=o}),o=>(r=null,a.execute(o),r)}function $d(t,e){let i=g(),r=fe(e);t.renderCoordsHelper.worldUpAtPosition(e,i);let a=g(),o=g(),s=n=>(R(n,n,e),Nl(i,n,n),t.viewingMode==="global"&&fe(n)*Math.sign(lt(i,n))<.001-r&&R(n,W(n,i,.001),e),V(n,n,e),n);return n=>(n.renderStart=s(G(a,n.renderStart)),n.renderEnd=s(G(o,n.renderEnd)),n)}function Sn(t,e){let i=t.renderCoordsHelper;return r=>{let a=i.fromRenderCoords(r.renderStart,new Ne({spatialReference:e})),o=i.fromRenderCoords(r.renderEnd,new Ne({spatialReference:e}));return a!=null&&o!=null?O(b({},r),{mapStart:a,mapEnd:o}):null}}var mh;(function(t){t[t.GROUND=0]="GROUND",t[t.OTHER=1]="OTHER"})(mh||(mh={}));var Qd=g(),Jd=g(),fh=xt();function wi(t,e,i){let r=(a,o)=>{e({action:a,object:t,dxScreen:o.screenDeltaX,dyScreen:o.screenDeltaY})};return i((a,o,s)=>(o.next(n=>(n.action==="start"&&r("start",n),n)).next(Fc(t)).next(n=>{switch(n.action){case"start":case"update":(n.translationX||n.translationY||n.translationZ)&&r("update",n);break;case"end":r("end",n)}return n}),{steps:o,cancel:s=s.next(Nc(t)).next(n=>(r("end",{screenDeltaX:0,screenDeltaY:0}),n))}))}function Po(t){if(t?.axis==null)return 1;let{mapStart:e,mapEnd:i,axis:r}=t,a=[i.x-e.x,i.y-e.y];return a[0]*r[0]+a[1]*r[1]>0?1:-1}var Ao=class extends it{constructor(e){super(),this._handles=new ei,this._arrowManipulatorInfos=new Array,this._angle=0,this._scale=1,this._radius=70,this._updateAfterDrag=!1,this.events=new te,this._tool=e.tool,this._view=e.view,this._opaqueMaterial=this._createMaterial(),this._transparentMaterial=this._createMaterial(.5),e.radius!=null&&(this._radius=e.radius),this._createManipulators(),this.forEachManipulator(i=>this._tool.manipulators.add(i))}set orthogonalAvailable(e){this._arrowManipulatorInfos.length>=3&&(this._arrowManipulatorInfos[1].manipulator.available=e,this._arrowManipulatorInfos[3].manipulator.available=e)}destroy(){this._handles=k(this._handles),this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()}),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0}forEachManipulator(e){for(let{manipulator:i}of this._arrowManipulatorInfos)e(i,C.TRANSLATE_XY)}createManipulatedObjectDragPipeline(e,i,r){if(!i.operations)return H();let a=i.operations.data.spatialReference,o=i.graphic;return wi(i,r,s=>this.createDragPipeline((n,l,p,u,d)=>({steps:l,cancel:p}=e(n,l,p,u,d),s(n,l,p)),i.elevationInfo,a,o))}createDragPipeline(e,i,r,a){return ee(this._arrowManipulatorInfos.map(({manipulator:o},s)=>pe(o,(n,l,p,u,d)=>{let m=l.next(f=>O(b({},f),{manipulatorType:C.TRANSLATE_XY})).next(ci(this._view,n.elevationAlignedLocation)).next(xi(this._view,n.elevationAlignedLocation,i,r,a)).next(Hc(n.location,this.angle+(s+1)*Math.PI*.5)).next(Ke());e(n,m,p,u,d)})))}get angle(){return this._angle}set angle(e){this._angle=e,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get radius(){return this._radius}set radius(e){this._radius!==e&&(this._radius=e,this._updateManipulators())}_updateManipulators(){for(let e=0;e<this._arrowManipulatorInfos.length;e++)this._updateArrowManipulator(this._arrowManipulatorInfos[e],e);this._updateManipulatorTransform()}_updateArrowManipulator({manipulator:e,transform:i},r){let a=this._radius/70,o=54*a,s=o*Math.sqrt(3)/2,n=Zi(this._opaqueMaterial,s,o/2,o/2,.02);co(n,Li(q.get(),j(y.get(),0,-s/3,0))),e.renderObjects=[new w(n,S.Focused),new w(n.instantiate({material:this._transparentMaterial}),S.Unfocused)],e.radius=s/3*2*1.2;let l=Ea(q.get(),r*Math.PI/2),p=Li(q.get(),j(y.get(),0,100*a,0));je(i,l,p)}_createManipulators(){for(let e=0;e<4;e++){let i=this._createArrowManipulator(e);this._arrowManipulatorInfos.push(i)}this._updateManipulatorTransform()}_updateManipulatorTransform(){let e=this.angle,i=Ta(q.get(),e,z(0,0,1));if(i==null)return;let r=Vi(q.get(),j(y.get(),this.displayScale,this.displayScale,this.displayScale)),a=je(q.get(),r,i);for(let o of this._arrowManipulatorInfos){let s=je(q.get(),a,o.transform);o.manipulator.modelTransform=s}}_createArrowManipulator(e){let i=new Z({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:z(0,0,1)}}),r={manipulator:i,transform:re()};return this._updateArrowManipulator(r,e),this._handles.add(i.events.on("drag",a=>{this._updateAfterDrag&&a.action==="end"&&!this.dragging&&(this._updateManipulatorTransform(),this._updateAfterDrag=!1)})),r}_createMaterial(e=1){let i=new Se({cullFace:X.Back,renderOccluded:M.Transparent,isDecoration:!0});return this._handles.add(v(()=>F.toUnitRGBA(this._view.effectiveTheme.accentColor),r=>{r[3]*=e,i.setParameters({color:r})},I)),i}get test(){}};var Do=class{constructor(){this._view=null,this._elevationInfo=null,this._lastDragEvent=null,this._next=null,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&this._lastDragEvent!=null&&this._next!=null){let i=this._lastDragEvent.mapEnd,r=this._snap(this._lastDragEvent.screenEnd);if(r!=null){let a={action:"update",mapStart:this._lastDragEvent.mapStart,mapEnd:e===!0?r:i,screenStart:this._lastDragEvent.screenEnd,screenEnd:this._lastDragEvent.screenEnd};this._next.execute(a)}}this._enabled=e}_snap(e){let i=this._view!=null?this._view.toMap(e,{exclude:[]}):null;return i!=null&&this._view!=null&&(i.z=ka(i,this._view,this._elevationInfo)),i}createDragEventPipelineStep(e,i){this._view=e,this._elevationInfo=i,this._lastDragEvent=null;let r=new pi;return this._next=r,[a=>{if(this._lastDragEvent=a.action!=="end"?b({},a):null,this._enabled){let o=this._snap(a.screenEnd);return o!=null?{action:a.action,mapStart:a.mapStart,mapEnd:o,screenStart:a.screenStart,screenEnd:a.screenEnd}:null}return{action:a.action,mapStart:a.mapStart,mapEnd:a.mapEnd,screenStart:a.screenStart,screenEnd:a.screenEnd}},r]}};var Io=class extends it{constructor(e){super(),this._handles=new ei,this._snapToScene=new Do,this._scale=1,this._radius=70,this._view=e.view,this._tool=e.tool,this._discMaterial=this._createMaterial(),this._discMaterialTransparent=this._createMaterial(.5),e.snapToScene!=null&&(this.snapToScene=e.snapToScene),e.radius!=null&&(this._radius=e.radius),this._createManipulator(),this.forEachManipulator(i=>this._tool.manipulators.add(i))}destroy(){this._handles=k(this._handles),this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()}),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(e){e(this._manipulator,C.TRANSLATE_XY)}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get snapToScene(){return this._snapToScene.enabled}set snapToScene(e){this._snapToScene.enabled=e}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}get discManipulator(){return this._manipulator}createManipulatedObjectDragPipeline(e,i,r){if(!i.operations)return H();let a=i.graphic,o=i.elevationInfo,s=i.operations.data.spatialReference;return wi(i,r,n=>this.createDragPipeline((l,p,u,d,m)=>({steps:p,cancel:u}=e(l,p,u,d,m),n(l,p,u)),o,s,a))}createDragPipeline(e,i,r,a){let o=this._view;return pe(this._manipulator,(s,n,l,p,u)=>{let d=n.next(ci(o,s.elevationAlignedLocation)).next(xi(o,s.elevationAlignedLocation,i,r,a)).next(...this._snapToScene.createDragEventPipelineStep(o,i)).next(m=>O(b({},m),{manipulatorType:C.TRANSLATE_XY})).next(Ke());e(s,d,l,p,u)})}_updateManipulatorTransform(){let e=Vi(q.get(),j(y.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=e}_createManipulator(){let e=this._view;this._manipulator=new Z({view:e,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:z(0,0,1)},worldOriented:!0}),this._updateManipulator()}_updateManipulator(){let e=pp(this._discMaterial,.02,1,128,z(0,0,1),z(0,0,0));e.transformation=Vi(re(),z(this._radius,this._radius,this._radius)),this._manipulator.renderObjects=[new w(e,S.Focused),new w(e.instantiate({material:this._discMaterialTransparent}),S.Unfocused)],this._manipulator.radius=80*(this._radius/70)}_createMaterial(e=1){let i=new Se({cullFace:X.Back,renderOccluded:M.Transparent,isDecoration:!0});return this._handles.add(v(()=>F.toUnitRGBA(this._view.effectiveTheme.accentColor),r=>{r[3]*=e,i.setParameters({color:r})},I)),i}get test(){}};function yt(t,e=M.OccludeAndTransparent,i=!0){let r=bs(t),a=!(t[3]<1);return i?new Qi({color:r,writeDepth:a,cullFace:X.Back,renderOccluded:e,isDecoration:!0}):new Se({color:r,writeDepth:a,cullFace:X.Back,renderOccluded:e,isDecoration:!0})}function Er(t,e=M.OccludeAndTransparent){let i=bs(t);return new Se({color:i,writeDepth:!0,cullFace:X.Front,renderOccluded:e,isDecoration:!0})}var On=Object.freeze({calloutLength:40,calloutWidth:1,discRadius:27,focusMultiplier:1.1}),yh=Object.freeze({autoScaleRenderObjects:!1,worldSized:!0});function Co(t,e,i,r){let a=R(y.get(),t,i),o=Tn(a,ce(y.get(),r,a),i,q.get());ml(o,o);let s=kt(y.get(),e,o);return Math.atan2(s[1],s[0])}function Tn(t,e,i,r){let a=ie(y.get(),t),o=ie(y.get(),e),s=ce(y.get(),a,o);return r[0]=a[0],r[1]=a[1],r[2]=a[2],r[3]=0,r[4]=o[0],r[5]=o[1],r[6]=o[2],r[7]=0,r[8]=s[0],r[9]=s[1],r[10]=s[2],r[11]=0,r[12]=i[0],r[13]=i[1],r[14]=i[2],r[15]=1,r}function bh(t,e){let i=t.getViewForGraphic(e);return i!=null&&"computeAttachmentOrigin"in i?i.computeAttachmentOrigin(e,t.spatialReference):null}function jo(t,e){let i=e.origin;i==null?iu(t,B(e)):t.elevationAlignedLocation=i}function iu(t,e){if(e==null)return;let i=e.type==="mesh"?e.anchor:vp(e);i!=null&&(t.location=Vc(i))}var Lo=class extends it{constructor(e){super(),this._radius=70,this.events=new te,this._tool=e.tool,this._view=e.view;let i=new ue({getTheme:()=>this._view.effectiveTheme});this._settings=i,e.radius!=null&&(this._radius=e.radius);let r=this._view.effectiveTheme.accentColor;this._materials={materialUnfocused:yt(Oi(r,1,.25),M.Occlude),materialFocused:yt(Oi(r,1,0),M.Occlude),materialOccludedUnfocused:yt(Oi(r,.7,0),i.zManipulator.renderOccluded),materialOccludedFocused:yt(Oi(r,.85,0),i.zManipulator.renderOccluded)},this._themeHandle=v(()=>this._view.effectiveTheme.accentColor,a=>{let o=Oi(a,1,.25),s=Oi(a,1,0),n=Oi(a,.7,0),l=Oi(a,.85,0),{materialUnfocused:p,materialFocused:u,materialOccludedUnfocused:d,materialOccludedFocused:m}=this._materials;p.setParameters({color:o}),u.setParameters({color:s}),d.setParameters({color:n}),m.setParameters({color:l})}),this._createManipulator(),this.forEachManipulator(a=>this._tool.manipulators.add(a))}destroy(){this._themeHandle=ot(this._themeHandle),this._manipulator.applyObjectTransform=au,this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()})}forEachManipulator(e){e(this._manipulator,C.TRANSLATE_Z)}createManipulatedObjectDragPipeline(e,i,r){if(!i.operations)return H();let a=i.operations.data.spatialReference;return wi(i,r,o=>this.createDragPipeline((s,n,l,p,u)=>({steps:n,cancel:l}=e(s,n,l,p,u),o(s,n,l)),a))}createDragPipeline(e,i){let r=this._view;return pe(this._manipulator,(a,o,s,n,l)=>{let p=o.next(u=>O(b({},u),{manipulatorType:C.TRANSLATE_Z})).next(Ro(r,a.renderLocation,i)).next(Ke());e(a,p,s,n,l)})}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}_updateManipulator(){let e=this._settings,i=this._radius/70,r=e.zManipulator.height*i,a=e.zManipulator.coneHeight*i,o=e.zManipulator.coneWidth*i,s=e.zManipulator.width*i,n=[z(0,0,0),z(0,0,r)],l=[z(0,0,0),z(0,0,r+a)],p=(D=>{let T=re();return kr(T,T,[0,0,r]),Nr(T,T,Math.PI/2),T})(),{materialUnfocused:u,materialFocused:d,materialOccludedUnfocused:m,materialOccludedFocused:f}=this._materials,_=hp(u,n,s/2,16,!1),x=$r(u,a,o/2,16,!1);x.transformation=p,this._manipulator.renderObjects=[new w(x,S.Unfocused),new w(_,S.Unfocused),new w(x.instantiate({material:d}),S.Focused),new w(_.instantiate({material:d}),S.Focused),new w(x.instantiate({material:m}),S.Unfocused),new w(_.instantiate({material:m}),S.Unfocused),new w(x.instantiate({material:f}),S.Focused),new w(_.instantiate({material:f}),S.Focused)],this._manipulator.radius=s/2+2,this._manipulator.collisionType={type:"line",paths:[l]}}_createManipulator(){let e=this._view,i=new Z({view:e,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});i.applyObjectTransform=r=>{let a=e.state.camera,o=Mh;e.renderCoordsHelper.toRenderCoords(this._manipulator.elevationAlignedLocation,o);let s=pl(a.eye,o),n=a.computeRenderPixelSizeAtDist(s),l=R(Rr,o,a.eye);ie(l,l);let p=ru;e.renderCoordsHelper.worldUpAtPosition(Mh,p);let u=Math.abs(lt(l,p)),d=ce(Rr,l,p),m=ce(Rr,d,p),f=Ci(u,.01,1),_=1-Math.sqrt(1-f*f)/f/a.fullWidth,x=this._settings,D=this._radius/70,T=x.zManipulator.width*D;W(m,ie(m,m),(1/_-1)*s+n*T),r[12]-=Rr[0],r[13]-=Rr[1],r[14]-=Rr[2]},this._manipulator=i,this._updateManipulator()}get test(){}};function Oi(t,e,i){let r=Hl(t,i);return r.a*=e,F.toUnitRGBA(r)}var Mh=g(),Rr=g(),ru=g(),au=()=>{};var rt=class extends it{constructor(e){super(),this._handles=new ei,this._interactive=!0;let{tool:i,view:r,snapToScene:a,radius:o}=e;this._view=r,this.xyManipulation=new Io({tool:i,view:r,snapToScene:a,radius:o}),this.xyAxisManipulation=new Ao({tool:i,view:r,radius:o}),this.zManipulation=new Lo({tool:i,view:r,radius:o}),this.xyManipulation.available=e.xyAvailable,this.xyAxisManipulation.available=e.xyAxisAvailable,this.zManipulation.available=e.zAvailable,this._autoHideXYAxis(),this.forEachManipulator(s=>this._handles.add(s.events.on("grab-changed",()=>this._updateManipulatorInteractivity())))}destroy(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}createManipulatedObjectDragPipeline(e,i,r){return ee([this.xyManipulation.createManipulatedObjectDragPipeline((a,o,s,n,l)=>e(Y.XY,a,o,s,n,l),i,r),this.xyAxisManipulation.createManipulatedObjectDragPipeline((a,o,s,n,l)=>e(Y.XY_AXIS,a,o,s,n,l),i,r),this.zManipulation.createManipulatedObjectDragPipeline((a,o,s,n,l)=>e(Y.Z,a,o,s,n,l),i,r)])}createDragPipeline(e,i,r,a){return ee([this.xyManipulation.createDragPipeline((o,s,n,l,p)=>e(Y.XY,o,s,n,l,p),i,r,a),this.xyAxisManipulation.createDragPipeline((o,s,n,l,p)=>e(Y.XY_AXIS,o,s,n,l,p),i,r,a),this.zManipulation.createDragPipeline((o,s,n,l,p)=>e(Y.Z,o,s,n,l,p),r)])}set snapToScene(e){this.xyManipulation.snapToScene=e}set angle(e){this.xyAxisManipulation.angle=e}set interactive(e){this._interactive!==e&&(this._interactive=e,this._updateManipulatorInteractivity())}set radius(e){this.xyAxisManipulation.radius=e,this.xyManipulation.radius=e,this.zManipulation.radius=e}set displayScale(e){this.xyManipulation.displayScale=e,this.xyAxisManipulation.displayScale=e}forEachManipulator(e){this.xyManipulation.forEachManipulator(i=>e(i,C.TRANSLATE_XY)),this.xyAxisManipulation.forEachManipulator(i=>e(i,C.TRANSLATE_XY)),this.zManipulation.forEachManipulator(i=>e(i,C.TRANSLATE_Z))}get _xyAxisVisible(){let e=this.xyManipulation.someManipulator(i=>i.focused)||this.xyAxisManipulation.someManipulator(i=>i.focused);return this._view.inputManager&&this._view.inputManager.latestPointerType==="touch"||e}_autoHideXYAxis(){let e=this.xyAxisManipulation,i=this.xyManipulation;if(ba("esri-mobile"))return;let r=[];i.forEachManipulator(o=>r.push(o)),e.forEachManipulator(o=>r.push(o));let a=()=>{let o=[];this._xyAxisVisible||e.forEachManipulator(s=>o.push(s.disableDisplay())),this._handles.remove(Sh),this._handles.add(o,Sh)};for(let o of r)this._handles.add(o.events.on("focus-changed",a));this._view.inputManager&&this._handles.add(st(()=>this._view.inputManager?.latestPointerType,a)),a()}_updateManipulatorInteractivity(){let e=this.grabbing;this.forEachManipulator(i=>{i.interactive=!e&&this._interactive||i.grabbing})}static radiusForSymbol(e){let i=e!=null&&e.type==="point-3d"&&e.symbolLayers;return i&&i.some(r=>r.type==="icon")?Oo:70}},Sh="disable-xy-axis-display",Y;(function(t){t[t.XY=0]="XY",t[t.XY_AXIS=1]="XY_AXIS",t[t.Z=2]="Z"})(Y||(Y={}));var Ti=class extends it{constructor(e){super(),this._view=e.view,this._tool=e.tool,this._object=e.object,this._manipulator=this._object.createManipulator?.({selectable:!0,cursor:"move"}),this.forEachManipulator(i=>this._tool.manipulators.add(i))}destroy(){this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()}),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(e){this._manipulator&&e(this._manipulator,C.TRANSLATE_XY)}createManipulatedObjectDragPipeline(e){return wi(this._object,e,i=>this.createDragPipeline(i))}createDragPipeline(e){if(!this._manipulator)return H();let i=this._view;return pe(this._manipulator,(r,a,o,s,n)=>{let l=this._object.operations?.data.spatialReference,p=a.next(u=>l?u:null).next(vh(n,i,this._object,l)).next(Wt()).next(Ke());e(r,p,o,s,n)})}};var Ei=class extends Ee{constructor(t){super(t),this.type="translate-xy",this.distance=_e}};c([h()],Ei.prototype,"type",void 0),c([h()],Ei.prototype,"distance",void 0),Ei=c([E("esri.views.interactive.tooltip.infos.TranslateXYTooltipInfo")],Ei);var Lt=class extends Ee{constructor(t){super(t),this.type="translate-z",this.distance=_e}clear(){this.distance=_e}};c([h()],Lt.prototype,"type",void 0),c([h()],Lt.prototype,"distance",void 0),Lt=c([E("esri.views.interactive.tooltip.infos.TranslateZTooltipInfo")],Lt);var Vo=class{constructor(e){this.objects=e,this.type="move-start"}},zo=class{constructor(e,i,r){this.dx=e,this.dy=i,this.objects=r,this.type="move"}},ua=class{constructor(e){this.objects=e,this.type="move-stop"}},Vt=Symbol("manipulators"),xh=Symbol("tooltips"),We=class extends li{constructor(t){super(t),this._infos=new Map,this.events=new te,this.objects=new rl,this.enableZ=!0,this.sketchOptions=new Qe,this.type="move-3d",this._latestTooltipInfo=null,this._translateTooltipInfo=null,this._translateXYTooltipInfo=null,this._translateZTooltipInfo=null,this._updatingHandles=new ri,this._moveManipulation=null}initialize(){let{view:t}=this;this.tooltip=new At({view:t}),this.addHandles([this.objects.on("change",i=>{i.removed.forEach(r=>this.removeHandles(r)),this._updateObjectInfos(i),this._setupFastTransformUpdates(i.added),this._refreshManipulators()}),this.objects.on("change",()=>this._connectTooltips())]);let e=this.objects.toArray();this._updateObjectInfos({added:e,removed:[]}),this._setupFastTransformUpdates(e),this._refreshManipulators(),this._connectTooltips(),this.finishToolCreation()}destroy(){this.tooltip=k(this.tooltip),this._moveManipulation=k(this._moveManipulation),this._set("view",null),this._updatingHandles.destroy()}onInputEvent(t){if(!this.destroyed&&!dr(t,this.tooltip))return super.onInputEvent(t)}get updating(){return this._updatingHandles.updating}get _shouldShowMovePointTooltip(){let{objects:t}=this;if(t.length!==1)return!1;let e=B(t.at(0))?.type;return e==="point"||e==="mesh"}get activeTooltipInfo(){return this._shouldShowMovePointTooltip?this._movePointTooltipInfo:this._latestTooltipInfo}reset(){}_updateObjectInfos({added:t,removed:e}){for(let i of t){if(Mc(i)!==bc.SUPPORTED)continue;let r=new Rn(i);this._infos.set(i,r)}for(let i of e)this._infos.delete(i)}_setupFastTransformUpdates(t){for(let e of t){let i=this._infos.get(e);this.addHandles(br(i.object),e)}}_refreshManipulators(){if(this.removeHandles(Vt),this._moveManipulation=k(this._moveManipulation),this.manipulators.removeAll(),this._infos.size===0)return;let t=Array.from(this._infos.values());this._createManipulators(t),this._createVisualElements(t),this._updateMoveManipulation(t)}_createManipulators(t){for(let e of t){let i=e.object;e.manipulationXY=new Ti({tool:this,view:this.view,object:i}),e.manipulationXY.forEachManipulator(r=>{this.addHandles([r.events.on("immediate-click",a=>{this.events.emit("immediate-click",O(b({},a),{object:i})),a.stopPropagation()}),r.events.on("grab-changed",({action:a})=>{a==="start"?this._showTooltip(Y.XY):this._hideTooltip()})],Vt)}),this.addHandles(e.manipulationXY.createDragPipeline((r,a,o,s)=>this._buildDragEventPipeline(t,Y.XY,r,a,o,s)),Vt)}this._createMoveManipulation(t)}_createMoveManipulation(t){let e=new rt({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:t.length===1?rt.radiusForSymbol(t[0].object.graphic?.symbol):70});this._moveManipulation=e,e.elevationInfo={mode:"absolute-height",offset:0},e.forEachManipulator(n=>{this.addHandles(n.events.on("immediate-click",l=>{let p=this.objects.at(0);!e.zManipulation.hasManipulator(n)&&this.objects.length===1&&p&&this.events.emit("immediate-click",O(b({},l),{object:p})),l.stopPropagation()}),Vt)});let i=n=>l=>{this.addHandles([l.events.on("focus-changed",({action:p})=>{p==="focus"?this._showTooltip(n):this._hideTooltip()}),l.events.on("grab-changed",()=>{this._latestTooltipInfo&&(this._latestTooltipInfo.distance=_e)})],Vt)};this._moveManipulation.xyManipulation.forEachManipulator(i(Y.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(i(Y.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(i(Y.Z));let r=()=>this._updateMoveManipulation(t);for(let n of t)this.addHandles([n.object.on("committed",r),v(()=>n.object.visible,r)],Vt);let a=t[t.length-1];this.addHandles(a.object.on("committed",()=>this._updateMoveManipulationAngle(a)),Vt);let{object:o}=a,{operations:s}=o;if(s){let n=o.graphic;this.addHandles(e.createDragPipeline((l,p,u,d,m)=>this._buildDragEventPipeline(t,l,p,u,d,m),o.elevationInfo,s.data.spatialReference,n),Vt)}this._updateMoveManipulationAngle(a)}_createVisualElements(t){for(let e of t){let i=e.object,r=Mi({view:this.view,object:i,forEachManipulator:a=>{e.manipulationXY?.forEachManipulator(a),this._moveManipulation?.forEachManipulator(a)},onManipulatorsChanged:()=>H()});r!=null&&(e.geometryRepresentation=r.visualElement,e.geometryRepresentation instanceof ze&&this.addHandles([e.geometryRepresentation.events.on("attachment-origin-changed",()=>{e.object.isDraped||this._updateMoveManipulation(t)}),v(()=>e.object.isDraped,()=>this._updateMoveManipulation(t))],Vt),this.addHandles(r,Vt))}}_updateMoveManipulationAngle(t){this._moveManipulation&&(this._moveManipulation.angle=pa(B(t.object)))}_updateMoveManipulation(t){let e=Ue(0,0,0,this.view.spatialReference),i=0,r=!1,a=this._moveManipulation;if(a){for(let o of t){if(!o.object.visible)continue;this.enableZ&&_t(o.object.operations,o.object.elevationInfo)&&(r=!0);let s=o.geometryRepresentation instanceof ze&&!o.object.isDraped?o.geometryRepresentation.attachmentOrigin:o.object.origin;if(s!=null){let{x:n,y:l,z:p}=s;e.x+=n,e.y+=l,p&&(e.z??=0,e.z+=p),i++}}i>0?(e.x/=i,e.y/=i,e.z??=0,e.z/=i,a.location=e,a.xyManipulation.available=!0,a.xyAxisManipulation.available=!0,a.zManipulation.available=r):a.available=!1}}_buildDragEventPipeline(t,e,i,r,a,o){let s=[],n=[],l=null,p=null,u=()=>{for(let d of s)d.dragging=!1;s.length=0,n.length=0,l=null,p=null,this._moveManipulation&&(this._moveManipulation.interactive=!0)};if(t.length===1&&e===Y.XY){let d=t[0].object;({steps:r,cancel:a}=this._buildSnappingPipelineSteps(d,d.elevationInfo,r,a,o))}return a=a.next(d=>p?.(d)).next(()=>(n.length&&this.events.emit("move-stop",new ua(n)),this.destroyed||u(),null)),{steps:r=r.next(d=>{if(d.action==="start"){s.length=0,n.length=0;for(let m of t)m.dragging||!m.manipulationXY?.hasManipulator(i)&&m.manipulationXY?.grabbing||(s.push(m),n.push(m.object),m.dragging=!0);if(n.length!==0&&(this._moveManipulation&&(this._moveManipulation.interactive=!1),l=kc(n),p=Uc(n),this._emitRecordUndo(),this.events.emit("move-start",new Vo(n)),this.destroyed))return null}return n.length!==0?d:null}).next(d=>l?.(d)).next(d=>(this._updateMoveTooltip(e,d),d)).next(d=>{switch(d.action){case"start":case"update":if(d.translationX||d.translationY||d.translationZ){let m=this.view.toScreen(d.mapStart),f=this.view.toScreen(d.mapEnd),_=f.x-m.x,x=f.y-m.y;if(this.events.emit("move",new zo(_,x,n)),this.destroyed)return null}break;case"end":if(this.events.emit("move-stop",new ua(n)),this.destroyed)return null;u()}return null}),cancel:a}}_connectTooltips(){let t;if(this.removeHandles(xh),this._shouldShowMovePointTooltip){let e=this.objects.at(0),{events:i}=this;this._movePointTooltipInfo??=new ho({viewType:this.view.type,sketchOptions:this.sketchOptions});let r={onMoveStart:()=>{this._emitRecordUndo(),i.emit("move-start",new Vo([e]))},onMove:()=>i.emit("move",new zo(0,0,[e])),onMoveStop:()=>i.emit("move-stop",new ua([e]))};t=Mo(this.tooltip,e,()=>({sketchOptions:this.sketchOptions,activeTooltipInfo:this._movePointTooltipInfo,callbacks:r}))}else t=v(()=>this.sketchOptions.tooltips.effectiveEnabled?this._latestTooltipInfo:null,e=>{this.tooltip.info=e},nt);this.addHandles(t,xh)}_showTooltip(t){this._shouldShowMovePointTooltip||this._updateMoveTooltip(t)}_hideTooltip(){this._shouldShowMovePointTooltip||(this.tooltip?.clear(),this._latestTooltipInfo=null)}_updateMoveTooltip(t,e){if(this._shouldShowMovePointTooltip)return;let{sketchOptions:i}=this;switch(t){case Y.XY:this._latestTooltipInfo=this._translateTooltipInfo??=new _r({sketchOptions:i}),En(this._latestTooltipInfo,e,(r,a)=>ur(r,a));break;case Y.XY_AXIS:this._latestTooltipInfo=this._translateXYTooltipInfo??=new Ei({sketchOptions:i}),En(this._latestTooltipInfo,e,(r,a)=>Ja(ur(r,a),Po(e)));break;case Y.Z:this._latestTooltipInfo=this._translateZTooltipInfo??=new Lt({sketchOptions:i}),En(this._latestTooltipInfo,e,oo)}this._latestTooltipInfo.sketchOptions=i}_emitRecordUndo(){let t=this.objects.toArray().map(e=>e.createUndoRecord?.()).filter(Ma);t.length>0&&this.events.emit("record-undo",{updates:t})}_buildSnappingPipelineSteps(t,e,i,r,a){let o=B(t);if(o==null||o.type!=="point"&&o.type!=="mesh")return{steps:i,cancel:r};let s=(o.type==="point"?o:o.anchor).clone(),n=new Fi({elevationInfo:e,pointer:a,editGeometryOperations:mr.fromGeometry(s,this.view.state.viewingMode),visualizer:new gt,excludeFeature:t.graphic}),l=this.snappingManager,{snappingStep:p,cancelSnapping:u}=ki({snappingContext:n,snappingManager:l,updatingHandles:this._updatingHandles});return r=r.next(u),{steps:i=i.next(d=>(s.z=Jl(this.view,s,t.elevationInfo,{mode:"absolute-height",offset:0}),O(b({},d),{snapOrigin:n.coordinateHelper.pointToVector(s)}))).next(...p),cancel:r}}};c([h({constructOnly:!0,nonNullable:!0})],We.prototype,"view",void 0),c([h()],We.prototype,"objects",void 0),c([h({constructOnly:!0,nonNullable:!0})],We.prototype,"enableZ",void 0),c([h({constructOnly:!0,type:Qe})],We.prototype,"sketchOptions",void 0),c([h({constructOnly:!0})],We.prototype,"snappingManager",void 0),c([h()],We.prototype,"type",void 0),c([h()],We.prototype,"updating",null),c([h()],We.prototype,"_latestTooltipInfo",void 0),c([h()],We.prototype,"_shouldShowMovePointTooltip",null),c([h()],We.prototype,"activeTooltipInfo",null),We=c([E("esri.views.3d.interactive.editingTools.move.MoveTool3D")],We);var Rn=class{constructor(e){this.object=e,this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1}};function En(t,e,i){if(e==null||e.action==="end")return void(t.distance=_e);let{mapStart:r,mapEnd:a}=e,o=i(r,a);t.distance=o??_e}function Pn(t,e,i){let r=i.mode==="on-the-ground"?Us.XY:Us.XYZ;return new Gc(t,r,e,0)}function An(t,e,i){let r=g();if(!t.renderCoordsHelper.toRenderCoords(e,r))return null;let a=wh(t,e,i.plane),o=wh(t,e,i.edgeDirection);if(a==null||o==null)return null;let s=ce(g(),a,o);return dt(r,s,St())}function wh(t,e,i){let r=Ue(e.x+i[0],e.y+i[1],e.z+i[2],e.spatialReference),a=g(),o=g();return t.renderCoordsHelper.toRenderCoords(e,a)&&t.renderCoordsHelper.toRenderCoords(r,o)?hs(o,a,o):null}function Oh(t,e,i){let r=t,a=hs(g(),e,i),o=ce(g(),a,r),s=ce(g(),a,o);return Cl(a[0],a[1],a[2],0,o[0],o[1],o[2],0,s[0],s[1],s[2],0,0,0,0,1)}function Th(t,e,i){let r=i.projectToRenderScreen(t,Gr()),a=i.projectToRenderScreen(e,Gr());return r!=null&&a!=null?cs(R(r,r,a)):0}var Ri=class extends Ee{constructor(t){super(t),this.type="reshape-edge-offset",this.distance=_e,this.area=null,this.totalLength=null}};c([h()],Ri.prototype,"type",void 0),c([h()],Ri.prototype,"distance",void 0),c([h()],Ri.prototype,"area",void 0),c([h()],Ri.prototype,"totalLength",void 0),Ri=c([E("esri.views.interactive.tooltip.infos.ReshapeEdgeOffsetTooltipInfo")],Ri);function Eh(t,e){let i=e?.type;return{edgeOffset:new Ri({sketchOptions:t,viewType:i}),movePoint:new ho({sketchOptions:t,viewType:i}),selectedVertex:new yp({sketchOptions:t,viewType:i}),translate:new _r({sketchOptions:t,viewType:i}),translateXY:new Ei({sketchOptions:t,viewType:i}),translateZ:new Lt({sketchOptions:t,viewType:i})}}function Rh(t,e,i){function r(){let s=i(),n=s.sketchOptions.tooltips.effectiveEnabled?s.activeTooltipInfo:null;return O(b({},s),{activeTooltipInfo:n})}let a=!1;function o(s){a=!0,nu(e,s),t.info=s.activeTooltipInfo,a=!1}return ee([v(r,o,nt),v(()=>{let s=r(),{activeTooltipInfo:n}=s;if(n&&"key"in n)return{context:s,activeTooltipInfo:n,key:n.key,geometry:B(e)}},(s,n)=>{s&&!a&&n&&n.key!==s.key&&ou(s.activeTooltipInfo,e,s.context)},Ht),e.on("committed",()=>o(r())),ro(t)])}function ou(t,e,{selectedVertexManipulatorInfo:i,callbacks:r}){let a=B(e);switch(a?.type){case"mesh":t.type==="move-point"&&ha(t,a.origin,e,r);break;case"point":t.type==="move-point"&&ha(t,a,e,r);break;case"polyline":case"polygon":t.type==="selected-vertex"&&su(t,i,e,r)}}function su(t,e,i,r){if(e?.type!=="vertex")return;let{dx:a,dy:o,dz:s}=io(t,e.manipulator.location);a===0&&o===0&&s===0||(r.onReshapeStart?.(),i.operations?.moveVertices([e.handle],a,o,s,be.NEW_STEP),r.onReshape?.(),r.onReshapeStop?.())}function nu(t,{activeTooltipInfo:e,selectedVertexManipulatorInfo:i,sketchOptions:r}){if(e)switch(e.sketchOptions=r,e?.type){case"move-point":cn(e,t);break;case"selected-vertex":lu(e,i,t)}}function lu(t,e,i){if(!t||t.type!=="selected-vertex")return;let r=e?.manipulator.location;t.setLocationFromPoint(r),pn(t,r,i);let a=i.operations?.data.geometry;switch(a?.type){case"polygon":t.geometryType="polygon",t.totalLength.visible=!1,t.area.actual=Fs(a);break;case"polyline":t.geometryType="polyline",t.totalLength.actual=ks(a),t.area.visible=!1}}function Ph(t,e,{sketchOptions:i,tooltipInfos:r}){let a=null;switch(t){case Y.XY:a=r.translate,Dn(a,e,(o,s)=>ur(o,s));break;case Y.XY_AXIS:a=r.translateXY,Dn(a,e,(o,s)=>Ja(ur(o,s),Po(e)));break;case Y.Z:a=r.translateZ,Dn(a,e,oo)}return a.sketchOptions=i,a}function Dn(t,e,i){if(e!=null&&e.action!=="end"){let{mapStart:r,mapEnd:a}=e,o=i(r,a);t.distance=o??_e}else t.distance=_e}function Ah(t,e,{sketchOptions:i,tooltipInfos:r}){let a=r.edgeOffset;if(a.distance=_e,e!=null&&e.action!=="end"){let s=t.operations,{mapEnd:n,signedDistance:l,operation:p}=e;if(l!=null&&s!=null){let u=s.data.coordinateHelper,d=l*p.selectedArrow;a.distance=cu(t.isDraped,d,n,p.plane,u)}}let o=t.operations?.data.geometry;return a.area=o?.type==="polygon"?Fs(o):null,a.totalLength=o?.type==="polyline"?ks(o):null,a.sketchOptions=i,a}function cu(t,e,i,r,a){if(t){let o=a.toXYZ(a.pointToVector(i)),s=Ul(r,o,y.get()),n=Tc(s,o,a.spatialReference);if(n!=null)return hr(n.value*Math.sign(e),n.unit)}return hr(e*zr(i.spatialReference),"meters")}var Dh=Symbol(),$=class extends me{get grabbingOrDragging(){return this._numGrabbing+this._numDragging>0}get _operations(){return this.object.operations}constructor(t){super(t),this._selectedIndex=0,this._manipulatorHandles=new ei,this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0,this._reshapeEventState=K.NONE,this._updatingHandles=new ri,this._recreatingManipulators=!1,this._settings=new ue({getTheme:()=>this.view.effectiveTheme}),this.events=new te,this.activeTooltipInfo=null,this._vertexLaserLineVisualElement=null}initialize(){let{view:t}=this,e=this._settings.manipulators,i=e.vertex;this.tooltipInfos=Eh(this._sketchOptions,t),this._vertexManipulatorMaterial=yt(J(i.color),i.renderOccluded),this._vertexManipulatorOutlineMaterial=Er(J(i.outlineColor),i.renderOccluded),this._vertexManipulatorHoverOutlineMaterial=Er(J(i.hoverOutlineColor),i.renderOccluded);let r=e.edge;this._edgeManipulatorMaterial=yt(J(r.color),r.renderOccluded),this._edgeManipulatorOutlineMaterial=Er(J(r.outlineColor),r.renderOccluded);let a=e.edgeOffset;this._edgeOffsetManipulatorMaterial=yt(J(a.color),a.renderOccluded,!1),this._edgeOffsetManipulatorHoverMaterial=yt(J(a.hoverColor),a.renderOccluded,!1);let o=e.selected;this._selectedManipulatorMaterial=yt(J(o.color),o.renderOccluded),this._selectedManipulatorOutlineMaterial=Er(J(o.outlineColor),o.renderOccluded),this._selectedManipulatorHoverOutlineMaterial=Er(J(o.hoverOutlineColor),o.renderOccluded),this.tooltip=new At({view:t}),this.addHandles([v(()=>{let s=this._settings.manipulators;return{vertexSettings:s.vertex,edgeSettings:s.edge,edgeOffsetSettings:s.edgeOffset,selectedSettings:s.selected}},({vertexSettings:s,edgeSettings:n,edgeOffsetSettings:l,selectedSettings:p})=>{s.applyColor(this._vertexManipulatorMaterial),s.applyOutline(this._vertexManipulatorOutlineMaterial),s.applyHoverOutline(this._vertexManipulatorHoverOutlineMaterial),n.applyColor(this._edgeManipulatorMaterial),n.applyOutline(this._edgeManipulatorOutlineMaterial),l.applyColor(this._edgeOffsetManipulatorMaterial),l.applyHover(this._edgeOffsetManipulatorHoverMaterial),p.applyColor(this._selectedManipulatorMaterial),p.applyOutline(this._selectedManipulatorOutlineMaterial),p.applyHoverOutline(this._selectedManipulatorHoverOutlineMaterial)}),v(()=>this.object.visible,s=>{for(let n of this._manipulatorInfos)n.manipulator.available=s,n.type==="edge"&&"edgeManipulator"in n&&(n.edgeManipulator.available=s)}),v(()=>this._numGrabbing+this._numDragging===0,s=>this._toggleAutoHideManipulators(s)),v(()=>({labels:this._segmentLabels,enabled:this._sketchOptions.labels.enabled,edgeOffsetEnabled:this.enableEdgeOffset}),({labels:s,enabled:n,edgeOffsetEnabled:l})=>{s!=null&&(s.visible=n,s.edgeDistance=l?"far":"default")},I),Rh(this.tooltip,this.object,()=>this._tooltipsContext),ti(()=>this._operations,"vertex-update",s=>{this._updateManipulatorPositions(s.vertices)},{onListenerAdd:()=>this._recreateManipulators()}),ti(()=>this._operations?.data,"change",s=>{s.operation!=="undo"&&s.operation!=="redo"||this._recreateManipulators()})])}destroy(){this._segmentLabels=k(this._segmentLabels),this.tooltip=k(this.tooltip),this._removeManipulators(),this._updatingHandles.destroy()}get updating(){return this._updatingHandles.updating}get manipulators(){return this.tool.manipulators}get view(){return this.tool.view}get object(){return this.tool.object}get enableZShape(){return this.tool.enableZShape}get enableDeleteVertices(){return this.tool.enableDeleteVertices}get enableZVertex(){return this.tool.enableZVertex}get autoHideManipulators(){return this.tool.autoHideManipulators}get enableMoveObject(){return this.tool.enableMoveObject}get enableMidpoints(){return this.tool.enableMidpoints}get enableEdgeOffset(){return this.tool.enableEdgeOffset}get _sketchOptions(){return this.tool.sketchOptions}get _accentColor(){return this.view.effectiveTheme.accentColor}removeSelectedVertices(){let t=this._manipulatorInfos.filter(e=>e.manipulator.selected&&e.type==="vertex");return this._removeVertices(t),t.length}onManipulatorSelectionChanged(){this.events.emit("manipulators-changed")}_removeManipulators(){this._manipulatorHandles.removeAll(),this._moveManipulation=k(this._moveManipulation),this._objectMoveManipulation=k(this._objectMoveManipulation),this.manipulators.removeAll(),this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0}_createManipulators(t){if(this._operations==null)return;let e=this.object.elevationInfo;for(let i of this._operations.data.components){let r=t?.byComponentIndex.get(i.index);for(let a of i.vertices){let o=r?.has(a.index);this._createVertexOrEdgeManipulator(a,e,o)}for(let a of i.edges)this._createVertexOrEdgeManipulator(a,e)}this._createObjectMoveManipulation(),this._createMoveManipulation(e),this._createVisualElements()}get canRedo(){return this._operations!=null&&this._operations.canRedo}get canUndo(){return this._operations!=null&&this._operations.canUndo}redo(){return this._operations?.redo()}undo(){return this.events.emit("undo"),this._operations?.undo()}_recreateManipulators(){if(!this._recreatingManipulators){if(this._recreatingManipulators=!0,this._removeManipulators(),this._resetTooltip(),this._operations&&this._segmentLabels?.context?.editGeometryOperations===this._operations||(this._segmentLabels=k(this._segmentLabels)),this._createManipulators(),!this._segmentLabels&&this._operations){let t=this._sketchOptions.labels;this._segmentLabels=new vr({context:{view:this.view,editGeometryOperations:this._operations,elevationInfo:this.object.elevationInfo,labelOptions:t},visible:t.enabled})}this._recreatingManipulators=!1}}_perObjectManipulatorDragAction(t,e){if(e.action==="end")return e;let i=0,r=[],a=this._manipulatorInfos.some(s=>s.type==="vertex"&&s.manipulator.selected),o=t===Pr.SELECTED_OR_ALL&&a;for(let s of this._manipulatorInfos)s.type==="vertex"&&(s.manipulator.grabbing||o&&!s.manipulator.selected||r.push(s),i++);if(this._moveVertices(r,e),r.length===i){if(this._updateEventState(K.MOVING),this.destroyed)return e;this.events.emit("move",{type:"move",dx:e.screenDeltaX,dy:e.screenDeltaY,object:this.object})}else{if(this._updateEventState(K.RESHAPING),this.destroyed)return e;this.events.emit("reshape",{type:"reshape",object:this.object})}return e}_toggleAutoHideManipulators(t){this.autoHideManipulators&&(t?this.removeHandles(Dh):this.tool.manipulators.forEach(({manipulator:e})=>{let i=e.disableDisplay?.();i&&this.addHandles(i,Dh)}))}_isMultiVertexSelection(){return this._manipulatorInfos.reduce((t,e)=>e.type==="vertex"&&e.manipulator.selected?t+1:t,0)>1}_perVertexManipulatorDragAction(t){if(this._updateEventState(K.RESHAPING),this.destroyed)return;let{mapDeltaX:e,mapDeltaY:i,mapDeltaZ:r}=t;if(!e&&!i&&!r)return;let a=[];for(let o of this._manipulatorInfos)o.type==="vertex"&&(o.manipulator.selected&&!o.manipulator.grabbing||o===t.info)&&a.push(o);this._moveVertices(a,t,be.ACCUMULATE_STEPS),this.events.emit("reshape",{type:"reshape",object:this.object})}_updateEventState(t){if(t===this._reshapeEventState)return!1;switch(t){case K.NONE:if(this._numGrabbing!==0||this._numDragging!==0)return!1;switch(this._reshapeEventState){case K.MOVING:this.events.emit("move",{type:"move-stop",dx:0,dy:0,object:this.object});break;case K.RESHAPING:this.events.emit("reshape",{type:"reshape-stop",object:this.object})}break;case K.MOVING:switch(this._reshapeEventState){case K.NONE:this.events.emit("move",{type:"move-start",dx:0,dy:0,object:this.object});break;case K.RESHAPING:this.events.emit("reshape",{type:"reshape-stop",object:this.object}),this.destroyed||this.events.emit("move",{type:"move-start",dx:0,dy:0,object:this.object})}break;case K.RESHAPING:switch(this._reshapeEventState){case K.NONE:this.events.emit("reshape",{type:"reshape-start",object:this.object});break;case K.MOVING:this.events.emit("move",{type:"move-stop",dx:0,dy:0,object:this.object}),this.destroyed||this.events.emit("reshape",{type:"reshape-start",object:this.object})}}if(this.destroyed)return!1;let e=this._reshapeEventState!==t;return this._reshapeEventState=t,e}_createObjectMoveManipulation(){let{tool:t,view:e,object:i,_operations:r}=this;if(r){if(this._objectMoveManipulation=new Ti({tool:t,view:e,object:i}),this.enableMoveObject){let a=null;this._manipulatorHandles.add(this._objectMoveManipulation.createDragPipeline((o,s,n)=>{s.next(l=>this._trackNumDragging(l)).next(l=>(l.action==="start"&&(a=r.createUndoGroup()),l)).next(l=>this._perObjectManipulatorDragAction(Pr.ALL,l)).next(l=>(this._updateTranslateObjectTooltip(Y.XY,l),l)).next(l=>{l.action==="end"&&(this._resetTooltip(),a=ot(a))}),n.next(()=>this._onDragCancel(!0,()=>a=ot(a)))})),this._objectMoveManipulation.forEachManipulator(o=>this._manipulatorHandles.add(this._watchAndUpdateGrabState(o,!1)))}else this._objectMoveManipulation.forEachManipulator(a=>{a.grabbable=!1,a.cursor=null});this._objectMoveManipulation.forEachManipulator(a=>this._manipulatorHandles.add(a.events.on("immediate-click",o=>{this._manipulatorInfos.some(s=>s.manipulator.selected)?this._clearSelection():this.events.emit("immediate-click",O(b({},o),{object:this.object})),o.stopPropagation()})))}}_createMoveManipulation(t){let{object:e,tool:i,view:r,_operations:a}=this;if(!a)return;this._moveManipulation=new rt({tool:i,view:r,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZShape&&_t(e.operations,e.elevationInfo),snapToScene:!1,radius:rt.radiusForSymbol(e.graphic?.symbol)}),this._moveManipulation.forEachManipulator(n=>this.addHandles([n.events.on("immediate-click",l=>{this._moveManipulation.zManipulation.hasManipulator(n)||this._manipulatorInfos.some(p=>p.manipulator.selected)||this.events.emit("immediate-click",O(b({},l),{object:this.object})),l.stopPropagation()}),this._watchAndUpdateGrabState(n,!1)]));let o=n=>l=>{this.addHandles(l.events.on("focus-changed",({action:p})=>{p==="focus"?this._updateTranslateTooltip(n):this._resetTooltip()}))};this._moveManipulation.xyManipulation.forEachManipulator(o(Y.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(o(Y.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(o(Y.Z)),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};let s=a.data.spatialReference;this.addHandles([this._moveManipulation.createDragPipeline((n,l,p,u,d)=>{let{snappingStep:m,cancelSnapping:f}=ki({predicate:_=>!!_.info,snappingManager:i.snappingManager,snappingContext:new Fi({editGeometryOperations:a,elevationInfo:t,pointer:d,excludeFeature:e.graphic,visualizer:new gt}),updatingHandles:this._updatingHandles,useZ:!1});return u=u.next(_=>(this._onDragCancel(),_)).next(f),{steps:p=p.next(_=>this._trackNumDragging(_)).next(_=>{let x=this._manipulatorInfos.filter(D=>D.type==="vertex"&&D.manipulator.selected);return _.manipulatorType===C.TRANSLATE_XY&&x.length===1?O(b({},_),{info:x[0],snapOrigin:x[0].handle.pos}):_}).next(Bs(this.view,t,e.graphic??void 0)).next(...m).next(Wt()).next(_=>this._perObjectManipulatorDragAction(Pr.SELECTED_OR_ALL,_)).next(_=>(this._updateTranslateTooltip(n,_),_)),cancel:u}},t,s,e.graphic),v(()=>e.visible,()=>this._updateMoveManipulationPosition(),I),e.on("committed",()=>{this._recreatingManipulators||this._updateMoveManipulationPosition()}),v(()=>e.isDraped,n=>{this._updateMoveManipulationPosition();let l="align-move-manipulation";n?this.addHandles(this.view.elevationProvider.on("elevation-change",()=>this._updateMoveManipulationPosition()),l):this.removeHandles(l)},I)])}_createVisualElements(){let{object:t,view:e}=this,i=Mi({view:e,object:t,forEachManipulator:a=>{if(!this.destroyed&&!this._recreatingManipulators){this._objectMoveManipulation.forEachManipulator(a),this._moveManipulation.forEachManipulator(a);for(let o of this._manipulatorInfos)a(o.manipulator,C.TRANSLATE_XY)}},onManipulatorsChanged:a=>this.events.on("manipulators-changed",a)});i!=null&&(this._outlineVisualElement=i.visualElement instanceof ze?i.visualElement:null);let r=this._outlineVisualElement;if(r!=null){let a=()=>{t.isDraped||this._updateMoveManipulationPosition()};this._manipulatorHandles.add(ti(()=>r.events,"attachment-origin-changed",a,{onListenerAdd:a}))}this._manipulatorHandles.add(i)}_createEdgeOffsetManipulator(t,e=this.object.elevationInfo){let i=this._operations;if(t.component.vertices.length<=2||!i)return null;let r=this._settings.manipulators.edgeOffset,a=r.size/2,o=a+r.collisionPadding,s=a/o,n=s*Math.sqrt(3)/2;this._edgeOffsetManipulatorGeometryInside==null&&(this._edgeOffsetManipulatorGeometryInside=Zi(this._edgeOffsetManipulatorMaterial,n,s/2,s/2,r.height,r.offset)),this._edgeOffsetManipulatorGeometryOutside==null&&(this._edgeOffsetManipulatorGeometryOutside=Zi(this._edgeOffsetManipulatorMaterial,-n,s/2,s/2,r.height,-r.offset));let l=[new w(this._edgeOffsetManipulatorGeometryInside.instantiate(),S.Unfocused),new w(this._edgeOffsetManipulatorGeometryInside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),S.Focused),new w(this._edgeOffsetManipulatorGeometryOutside.instantiate(),S.Unfocused),new w(this._edgeOffsetManipulatorGeometryOutside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),S.Focused)],p=new Z({view:this.view,renderObjects:l,elevationInfo:e.mode!=="on-the-ground"||Ls(this.object.graphic?.symbol)?{mode:"absolute-height",offset:0}:e,worldOriented:!1,focusMultiplier:1,radius:o,available:this.object.visible,collisionType:{type:"disc",direction:z(0,0,1)},collisionPriority:1,metadata:{deleting:!1}}),u=new Z({view:this.view,worldSized:!0,worldOriented:!1,available:this.object.visible,collisionPriority:-10,cursor:this.enableMoveObject?"move":"default",metadata:{deleting:!1}}),d={manipulator:p,handle:t,locationUpdateHandle:null,type:"edge",selectedIndex:0,edgeManipulator:u,elevationInfo:e,visibilityHandle:null};this._autoHideEdgeOffsetManipulator(d,r.minSquaredEdgeLength),this._updateEdgeOffsetManipulator(d);let m=[];for(let _ of[t.leftVertex,t.rightVertex]){let x=this._getManipulatorInfoFromHandle(_);x!=null&&m.push(x.manipulator.events.on("location-update",()=>this._updateEdgeOffsetManipulator(d)))}d.locationUpdateHandle=ee(m),this._manipulatorHandles.add(d.locationUpdateHandle,p),this._manipulatorHandles.add([this._watchAndUpdateGrabState(p,!0),this._watchAndUpdateGrabState(u,!0)],p),this._manipulatorHandles.add(pe(p,this._createEdgeOffsetPipeline(d,e)),p),this._manipulatorHandles.add(pe(u,(_,x,D,T)=>{if(T==="touch")this._createEdgeOffsetPipeline(d,e)(_,x,D);else if(this.enableMoveObject){let A=this.object.graphic,Q=i.data.spatialReference;x.next(ae=>this._trackNumDragging(ae)).next(ci(this.view,_.elevationAlignedLocation)).next(xi(this.view,_.elevationAlignedLocation,e,Q,A)).next(Ke()).next(Wt()).next(ae=>this._perObjectManipulatorDragAction(Pr.ALL,ae)).next(ae=>(this._updateTranslateObjectTooltip(Y.XY,ae),ae)).next(ae=>{ae.action==="end"&&this._resetTooltip()}),D.next(()=>this._onDragCancel(!_.metadata.deleting))}}),p);let f=_=>{this._manipulatorInfos.some(x=>x.manipulator.selected)?this._clearSelection():this.events.emit("immediate-click",O(b({},_),{object:this.object})),_.stopPropagation()};return this._manipulatorHandles.add([p.events.on("immediate-click",f),u.events.on("immediate-click",f),p.events.on("focus-changed",({action:_})=>{_==="focus"?this._updateEdgeOffsetTooltip(null):this._resetTooltip()})],p),this._manipulatorInfos.push(d),this.manipulators.add(p),this.manipulators.add(u),this.events.emit("manipulators-changed"),d}_autoHideEdgeOffsetManipulator(t,e){let i=t.manipulator,r=t.edgeManipulator,a=()=>{t.visibilityHandle=ot(t.visibilityHandle);let o=this._getManipulatorInfoFromHandle(t.handle.leftVertex),s=this._getManipulatorInfoFromHandle(t.handle.rightVertex),n=o!=null&&s!=null&&Th(o.manipulator.renderLocation,s.manipulator.renderLocation,this.view.state.camera)<e;(!i.focused&&!r.focused||n)&&(i.grabbable=!n,r.grabbable=!n,t.visibilityHandle=ee([i.disableDisplay(),H(()=>{i.grabbable=!0,r.grabbable=this.enableMoveObject})]))};this._manipulatorHandles.add([i.events.on("focus-changed",a),r.events.on("focus-changed",a),H(()=>{ot(t.visibilityHandle),r.metadata.deleting=!0,this.manipulators.remove(r)})],i),a()}_updateEdgeOffsetManipulator(t){if(!this._operations)return;this._updateManipulatorPosition(t);let{coordinateHelper:e}=this._operations.data,i=An(this.view,t.manipulator.elevationAlignedLocation,Pn(e,t.handle,t.manipulator.elevationInfo)),r=this._getManipulatorInfoFromHandle(t.handle.leftVertex),a=this._getManipulatorInfoFromHandle(t.handle.rightVertex);if(r==null||a==null)return;let o=r.manipulator.renderLocation,s=a.manipulator.renderLocation,n=i!=null?Oh(i,o,s):jl;t.manipulator.modelTransform=n,t.edgeManipulator.elevationAlignedLocation=t.manipulator.elevationAlignedLocation,t.edgeManipulator.modelTransform=n;let l=fe(R(Go,o,s))/2;t.edgeManipulator.collisionType={type:"line",paths:[[[-l,0,0],[l,0,0]]]}}_createEdgeOffsetPipeline(t,e){return(i,r,a)=>{let o=this._operations;if(!o)return;this._clearSelection();let{step:s,cleanup:n}=this._initializeEdgeOffset(t,e,o);r.next(l=>this._trackNumDragging(l)).next(ci(this.view,i.elevationAlignedLocation)).next(s).next(gh(this.view)).next(Sn(this.view,o.data.spatialReference)).next(Wt()).next(pu()).next(this._applyEdgeOffsetStep(t)).next(this._showEdgeOffsetTooltip()).next(l=>{l.action==="end"&&n()}),a.next(()=>{i.metadata.deleting||(n(),this._onDragCancel())})}}_initializeEdgeOffset(t,e,i){let{view:r}=this,a=Pn(i.data.coordinateHelper,t.handle,e),o=i.createUndoGroup(),s=An(r,t.manipulator.elevationAlignedLocation,a);if(a.requiresSplitEdgeLeft){let f=this._getManipulatorInfoFromHandle(t.handle.leftVertex.leftEdge);f!=null&&this._splitEdgeManipulator(f,1)}if(a.requiresSplitEdgeRight){let f=this._getManipulatorInfoFromHandle(t.handle.rightVertex.rightEdge);f!=null&&this._splitEdgeManipulator(f,0)}let n=()=>new dl({paths:[[t.handle.leftVertex.pos,t.handle.rightVertex.pos]],spatialReference:i.data.spatialReference}),l=this._settings,p=new ze({view:r,isDraped:this.object.isDraped,geometry:n(),elevationInfo:t.elevationInfo,width:l.visualElements.lineObjects.outline.width,attached:!1,isDecoration:!0}),u,d=()=>{this._cleanEdgeOffsetCollapsedEdges(t),u=ot(u)},m=this.events.on("undo",d);return u=ee([v(()=>J(this._accentColor),f=>p.color=f,I),ye(p),v(()=>this.object.isDraped,f=>p.isDraped=f),this.object.on("committed",()=>p.geometry=n()),o,m]),p.attached=!0,{step:f=>a==null||s==null?(d(),null):O(b({},f),{operation:a,plane:s}),cleanup:d}}_applyEdgeOffsetStep(t){return e=>{if(this.destroyed||e.operation==null)return e;this._updateEventState(K.RESHAPING);let{mapDeltaX:i,mapDeltaY:r,mapDeltaZ:a}=e;return(i||r||a)&&(this._offsetEdge(t,e),this.events.emit("reshape",{type:"reshape",object:this.object})),e}}_showEdgeOffsetTooltip(){return t=>(t.signedDistance!=null&&this.object.operations?this._updateEdgeOffsetTooltip(t):this._resetTooltip(),t)}_cleanEdgeOffsetCollapsedEdges(t){if(!this._operations)return;let e=t.handle.leftVertex.leftEdge?.leftVertex,i=t.handle.leftVertex,r=t.handle.rightVertex.rightEdge?.rightVertex,a=t.handle.rightVertex,o=this._operations.data.coordinateHelper,s=[];if(e&&o.distance(e.pos,i.pos)<In){let n=this._getManipulatorInfoFromHandle(i);n!=null&&s.push(n)}if(o.distance(i.pos,a.pos)<In||r&&o.distance(r.pos,a.pos)<In){let n=this._getManipulatorInfoFromHandle(a);n!=null&&s.push(n)}s.length&&this._removeVertices(s)}_createVertexOrEdgeManipulator(t,e=this.object.elevationInfo,i=!1){let{view:r,_operations:a}=this;if(!a)return null;let o=this._settings;if(t.type==="edge"){if(this.enableEdgeOffset)return this._createEdgeOffsetManipulator(t,e);if(!this.enableMidpoints)return null}if(this._vertexManipulatorGeometry==null||this._vertexManipulatorOutlineGeometry==null){let{size:d,outlineSize:m}=Ih(o.manipulators.vertex);this._vertexManipulatorGeometry=Bi(this._vertexManipulatorMaterial,d,16,16),this._vertexManipulatorOutlineGeometry=Bi(this._vertexManipulatorOutlineMaterial,m,16,16)}if(this._edgeManipulatorGeometry==null||this._edgeManipulatorOutlineGeometry==null){let{size:d,outlineSize:m}=Ih(o.manipulators.edge);this._edgeManipulatorGeometry=Bi(this._edgeManipulatorMaterial,d,16,16),this._edgeManipulatorOutlineGeometry=Bi(this._edgeManipulatorOutlineMaterial,m,16,16)}let s=this._operations?.data.type,n=s==="point"||s==="mesh"?[]:[new w(this._vertexManipulatorGeometry.instantiate(),bt.Vertex|S.Unselected),new w(this._vertexManipulatorOutlineGeometry.instantiate(),bt.Vertex|S.Unfocused|S.Unselected),new w(this._vertexManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),bt.Vertex|S.Focused|S.Unselected),new w(this._vertexManipulatorGeometry.instantiate({material:this._selectedManipulatorMaterial}),S.Selected),new w(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorOutlineMaterial}),S.Selected|S.Unfocused),new w(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorHoverOutlineMaterial}),S.Selected|S.Focused)];this.enableMidpoints&&n.push(new w(this._edgeManipulatorGeometry.instantiate({material:this._vertexManipulatorMaterial}),bt.Edge|S.Focused|S.Unselected),new w(this._edgeManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),bt.Edge|S.Focused|S.Unselected),new w(this._edgeManipulatorGeometry.instantiate(),bt.Edge|S.Unfocused|S.Unselected),new w(this._edgeManipulatorOutlineGeometry.instantiate(),bt.Edge|S.Unfocused|S.Unselected));let l=new Z({view:r,renderObjects:n,elevationInfo:e,focusMultiplier:1,touchMultiplier:1,available:this.object.visible,metadata:{deleting:!1}});l.selected=i,this._setTypeSpecificManipulatorSettings(l,t,e);let p=t.type==="edge"?{manipulator:l,handle:t,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:l,handle:t,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(p),this.manipulators.add(l),this._updateManipulatorPosition(p),p.type==="edge"){let d=[];for(let m of[p.handle.leftVertex,p.handle.rightVertex]){let f=this._getManipulatorInfoFromHandle(m);f!=null&&d.push(f.manipulator.events.on("location-update",()=>this._updateManipulatorPosition(p)))}p.locationUpdateHandle=ee(d),this._manipulatorHandles.add(p.locationUpdateHandle,l)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(l,!0),l);let u=pe(l,(d,m,f,_)=>{let x=null,{snappingStep:D,cancelSnapping:T}=ki({predicate:()=>!this._isMultiVertexSelection(),snappingManager:this.tool.snappingManager,snappingContext:new Fi({editGeometryOperations:a,elevationInfo:e,pointer:_,excludeFeature:this.object.graphic,visualizer:new gt}),updatingHandles:this._updatingHandles,useZ:!1});f=f.next(A=>(this._onDragCancel(!d.metadata.deleting,()=>x=ot(x)),A)).next(T),m.next(A=>this._trackNumDragging(A)).next(A=>{if(A.action==="start"&&this._operations&&(x=this._operations.createUndoGroup()),p.type==="edge"){let Q=this._splitEdgeManipulator(p);return O(b({},A),{info:Q,snapOrigin:Q.handle.pos})}return O(b({},A),{info:p,snapOrigin:p.handle.pos})}).next(ci(this.view,d.elevationAlignedLocation)).next(xi(this.view,d.elevationAlignedLocation,this.object.elevationInfo,d.location.spatialReference,this.object.graphic)).next(Bs(this.view,e,this.object.graphic??void 0)).next(...D).next(Wt()).next(A=>{this._perVertexManipulatorDragAction(A),A.action==="end"&&(x=ot(x)),this._resetTooltip()})});return this._manipulatorHandles.add([u,l.events.on("immediate-click",d=>this._manipulatorClickCallback(d,p)),l.events.on("select-changed",()=>{p.selectedIndex=++this._selectedIndex,this._updateMoveManipulationPosition(),this._resetTooltip()}),l.events.on("focus-changed",()=>{this._resetTooltip()})],l),this.events.emit("manipulators-changed"),p}_trackNumDragging(t){switch(t.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return t}_onDragCancel(t=!0,e){switch(this._numDragging--,t&&this.undo(),this.tool.snappingManager!=null&&this.tool.snappingManager.doneSnapping(),this._resetTooltip(),this._reshapeEventState){case K.NONE:break;case K.MOVING:this.events.emit("move",{type:"move",dx:0,dy:0,object:this.object});break;case K.RESHAPING:this.events.emit("reshape",{type:"reshape",object:this.object})}e&&e(),this.destroyed||this._updateEventState(K.NONE)}_setTypeSpecificManipulatorSettings(t,e,i){let r=this._settings;switch(e.type){case"vertex":{t.state=bt.Vertex,t.selectable=!0,t.cursor="move",t.collisionPriority=2;let{size:a,collisionPadding:o}=r.manipulators.vertex;t.radius=a/2+o,t.elevationInfo=i;let s=this._operations?.data.type;t.interactive=s!=null&&s!=="point"&&s!=="mesh";break}case"edge":{t.state=bt.Edge,t.selectable=!1,t.cursor="copy",t.collisionPriority=-1;let{size:a,collisionPadding:o}=r.manipulators.edge;t.radius=a/2+o,t.elevationInfo=i.mode!=="on-the-ground"||Ls(this.object.graphic?.symbol)?{mode:"absolute-height",offset:0}:i;break}}}_watchAndUpdateGrabState(t,e){return t.events.on("grab-changed",i=>this._onGrabStateChanged(t,e,i.action,i.pointerType))}_onGrabStateChanged(t,e,i,r="mouse"){if(!this._recreatingManipulators){if(i==="start")e&&this._updateSelection(t),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(K.NONE),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing,(r!=="touch"||this.enableEdgeOffset)&&(this._manipulatorInfos.forEach(a=>{let{manipulator:o}=a,s=this._operations?.data.type;o.interactive=o.grabbing||!this._numGrabbing&&s!=null&&s!=="point"&&s!=="mesh","edgeManipulator"in a&&(a.edgeManipulator.interactive=a.edgeManipulator.grabbing||!this._numGrabbing)}),this._objectMoveManipulation.forEachManipulator(a=>{a.interactive=a.grabbing||!this._numGrabbing}))}}_clearSelection(){for(let t of this._manipulatorInfos)t.manipulator.grabbing||(t.manipulator.selected=!1)}_updateSelection(t){t.grabbing&&!t.selected&&t.selectable&&(this._clearSelection(),t.selected=!0,this.events.emit("manipulators-changed"))}_removeManipulator(t){t!=null&&(t.manipulator.metadata.deleting=!0,this.manipulators.remove(t.manipulator),this._manipulatorHandles.remove(t.manipulator),Xn(this._manipulatorInfos,t),this.events.emit("manipulators-changed"),this._resetTooltip())}_getManipulatorInfoFromHandle(t){if(t){for(let e of this._manipulatorInfos)if(t===e.handle)return e}return null}_updateManipulatorPositions(t){for(let e of t)this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e))}_updateManipulatorPosition(t){let e=this._operations;if(t!=null&&e){if(t.type==="vertex")t.manipulator.location=e.data.coordinateHelper.vectorToDehydratedPoint(t.handle.pos,ma),t.manipulator.grabbing&&this._vertexLaserLineVisualElement!=null&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=t.manipulator.renderLocation);else if(t.type==="edge"){let i=this._getManipulatorInfoFromHandle(t.handle.leftVertex),r=this._getManipulatorInfoFromHandle(t.handle.rightVertex);if(i==null||r==null)return;let a=i.manipulator,o=r.manipulator;if(t.manipulator.elevationInfo!=null&&t.manipulator.elevationInfo.mode==="on-the-ground"){let s=a.location,n=o.location,l=.5,p=s.x+l*(n.x-s.x),u=s.y+l*(n.y-s.y),d=s.hasZ&&n.hasZ?0:void 0;t.manipulator.location=Ue(p,u,d,e.data.spatialReference)}else ct(Go,a.renderLocation,o.renderLocation,.5),t.manipulator.renderLocation=Go}}}_splitEdgeManipulator(t,e=.5){let i=this._operations,r=i.splitEdge(t.handle,e).createdVertex;t.locationUpdateHandle=ot(t.locationUpdateHandle);let a=this.object.elevationInfo,o;this.enableEdgeOffset?(this._removeManipulator(t),o=this._createVertexOrEdgeManipulator(r)):(o=t,o.handle=r,o.type="vertex",this._setTypeSpecificManipulatorSettings(t.manipulator,t.handle,a)),r.leftEdge&&this._createVertexOrEdgeManipulator(r.leftEdge),r.rightEdge&&this._createVertexOrEdgeManipulator(r.rightEdge),this._updateManipulatorPosition(o),this.enableEdgeOffset||this._resetTooltip(),this._updateSelection(t.manipulator);let s=this._updateEventState(K.RESHAPING),n=i.data.coordinateHelper.vectorToArray(o.handle.pos),l=i.data.components.indexOf(r.component);return this.events.emit("vertex-add",{type:"vertex-add",object:this.object,vertices:[{coordinates:n,componentIndex:l,vertexIndex:r.index}],added:n}),s&&this._updateEventState(K.NONE),o}_updateMoveManipulationPosition(){let t=j(Go,0,0,0),e=0,i=!1,r=null,a=null;for(let n of this._manipulatorInfos)n.type==="vertex"&&(n.manipulator.selected?(e++,V(t,t,n.manipulator.renderLocation),r==null||n.selectedIndex>r.selectedIndex?(a=r,r=n):(a==null||n.selectedIndex>a.selectedIndex)&&(a=n)):i=!0);let o=this.object,s=this._operations?.data.geometry;if(e===0){let n=o.visible&&this.enableMoveObject;this._moveManipulation.xyManipulation.available=n,this._moveManipulation.xyAxisManipulation.available=n,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=n,this._moveManipulation.zManipulation.available=n&&this.enableZShape&&_t(this._operations,o.elevationInfo),this._moveManipulation.angle=pa(s),this._moveManipulation.radius=rt.radiusForSymbol(o.graphic?.symbol)}else{let n=o.visible;this._moveManipulation.xyManipulation.available=n,this._moveManipulation.xyAxisManipulation.available=n,this._moveManipulation.zManipulation.available=n&&this.enableZVertex&&_t(this._operations,this.object.elevationInfo),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=n&&e!==1;let l=0;if(r!=null){let p=r.handle.pos,u=a!=null?a.handle.pos:r.handle.leftEdge?.leftVertex?r.handle.leftEdge.leftVertex.pos:null,d=a==null&&r.handle.rightEdge?.rightVertex?r.handle.rightEdge.rightVertex.pos:null;u&&d?this._moveManipulation.xyAxisManipulation.available=!1:u?l=Ch(u,p):d&&(l=Ch(p,d))}this._moveManipulation.angle=l,this._moveManipulation.radius=Oo}e!==0&&i?(W(t,t,1/e),ma.spatialReference=this._operations.data.spatialReference,ma.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(t,ma),this._moveManipulation.elevationAlignedLocation=ma):this._outlineVisualElement==null||this.object.isDraped||this._outlineVisualElement.attachmentOrigin==null?jo(this._moveManipulation,this.object):this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin}_removeVertices(t){let e=new Array,i=this._operations;if(i){for(let r of t){let a=r.handle.component;if(r.type==="vertex"&&i.canRemoveVertex(a)){e.push(r.handle),this._removeManipulator(r),this._removeManipulator(this._getManipulatorInfoFromHandle(r.handle.leftEdge)),this._removeManipulator(this._getManipulatorInfoFromHandle(r.handle.rightEdge));let o=i.removeVertices([r.handle]),s=o.removedVertices?.[0].createdEdge;s?this._createVertexOrEdgeManipulator(s):this.enableEdgeOffset&&a.vertices.length<=2&&this._removeManipulator(this._getManipulatorInfoFromHandle(a.edges[0]))}}if(e.length>0){let r=e.map(o=>{let s=i.data.components.indexOf(o.component);return{coordinates:i.data.coordinateHelper.vectorToArray(o.pos),componentIndex:s,vertexIndex:o.index}}),a=this._updateEventState(K.RESHAPING);if(this.destroyed||(this.events.emit("vertex-remove",{type:"vertex-remove",object:this.object,removed:r.map(o=>o.coordinates),vertices:r}),this.destroyed)||a&&(this._updateEventState(K.NONE),this.destroyed))return;this._updateMoveManipulationPosition()}}}_moveVertices(t,e,i=e.action==="start"?be.NEW_STEP:be.ACCUMULATE_STEPS){let r=this._operations;if(r){t.length>0&&r.moveVertices(t.map(a=>a.handle),e.mapDeltaX,e.mapDeltaY,e.mapDeltaZ,i);for(let a of t)this._updateManipulatorPosition(a)}}_offsetEdge(t,e){if(e.operation==null||e.signedDistance==null)return;let i=this._operations;if(!i)return;let r=e.operation.clone();r.distance=e.signedDistance,i.updateVertices([t.handle.leftVertex,t.handle.rightVertex],r),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(t.handle.leftVertex)),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(t.handle.rightVertex))}_manipulatorClickCallback(t,e){t.shiftKey||this._clearSelection(),e.type==="vertex"&&(e.manipulator.selected=!e.manipulator.selected,this.enableDeleteVertices&&t.button===Vs.Right&&this._removeVertices([e])),e.type==="edge"&&t.button===Vs.Left&&this._splitEdgeManipulator(e),t.stopPropagation()}_updateTranslateTooltip(t,e){this._defaultTooltipInfo!=null?this._resetTooltip():this._updateTranslateObjectTooltip(t,e)}_updateTranslateObjectTooltip(t,e){this.activeTooltipInfo=Ph(t,e,this._tooltipsContext)}_updateEdgeOffsetTooltip(t){this.activeTooltipInfo=Ah(this.object,t,this._tooltipsContext)}_resetTooltip(){this.activeTooltipInfo=this._defaultTooltipInfo}get _defaultTooltipInfo(){switch(this._operations?.data.type){case"polyline":case"polygon":return this._selectedVertexManipulatorInfo?this.tooltipInfos.selectedVertex:null;case"point":case"mesh":return this.tooltipInfos.movePoint;default:return null}}get _selectedVertexManipulatorInfo(){let t=this._manipulatorInfos.filter(e=>e.type==="vertex"&&e.manipulator.selected);return t.length===1?t[0]:null}get _tooltipsContext(){let{events:t}=this;return{sketchOptions:this._sketchOptions,tooltipInfos:this.tooltipInfos,activeTooltipInfo:this.activeTooltipInfo,selectedVertexManipulatorInfo:this._selectedVertexManipulatorInfo,callbacks:{onReshapeStart:()=>t.emit("reshape",{type:"reshape-start",object:this.object}),onReshape:()=>t.emit("reshape",{type:"reshape",object:this.object}),onReshapeStop:()=>t.emit("reshape",{type:"reshape-stop",object:this.object}),onMoveStart:()=>t.emit("move",{type:"move-start",object:this.object,dx:0,dy:0}),onMove:()=>t.emit("move",{type:"move",object:this.object,dx:0,dy:0}),onMoveStop:()=>t.emit("move",{type:"move-stop",object:this.object,dx:0,dy:0})}}}get test(){}};function pu(){return t=>{let{operation:e,mapEnd:i}=t;return e==null||i==null?t:(t.action==="start"&&e.selectArrowFromStartPoint(i),O(b({},t),{signedDistance:e.signedDistanceToPoint(i)}))}}function Ih(t){let e=t.size/2,i=e+t.collisionPadding;return{size:e/i,outlineSize:(e+t.outlineSize)/i}}function Ch(t,e){return Math.atan2(e[1]-t[1],e[0]-t[0])+Math.PI/2}c([h()],$.prototype,"_numGrabbing",void 0),c([h()],$.prototype,"_numDragging",void 0),c([h()],$.prototype,"grabbingOrDragging",null),c([h()],$.prototype,"_operations",null),c([h()],$.prototype,"_segmentLabels",void 0),c([h({constructOnly:!0})],$.prototype,"tool",void 0),c([h()],$.prototype,"tooltip",void 0),c([h()],$.prototype,"activeTooltipInfo",void 0),c([h({readOnly:!0})],$.prototype,"updating",null),c([h()],$.prototype,"manipulators",null),c([h()],$.prototype,"view",null),c([h()],$.prototype,"object",null),c([h()],$.prototype,"enableZShape",null),c([h()],$.prototype,"enableDeleteVertices",null),c([h()],$.prototype,"enableZVertex",null),c([h()],$.prototype,"autoHideManipulators",null),c([h()],$.prototype,"enableMoveObject",null),c([h()],$.prototype,"enableMidpoints",null),c([h()],$.prototype,"enableEdgeOffset",null),c([h()],$.prototype,"_sketchOptions",null),c([h()],$.prototype,"_accentColor",null),c([h()],$.prototype,"_tooltipsContext",null),$=c([E("esri.views.3d.interactive.editingTools.reshape.ReshapeOperation")],$);var ma=Ue(0,0,void 0,ns.WGS84),Go=g(),In=1e-6,bt,K,Pr;(function(t){t.Vertex=se.Custom1,t.Edge=se.Custom2})(bt||(bt={})),function(t){t[t.NONE=0]="NONE",t[t.MOVING=1]="MOVING",t[t.RESHAPING=2]="RESHAPING"}(K||(K={})),function(t){t[t.ALL=0]="ALL",t[t.SELECTED_OR_ALL=1]="SELECTED_OR_ALL"}(Pr||(Pr={}));var he=class extends li{constructor(t){super(t),this.events=new te,this.enableZShape=!0,this.enableZVertex=!0,this.enableMoveObject=!0,this.enableDeleteVertices=!0,this.autoHideManipulators=!1,this.enableMidpoints=!0,this.enableEdgeOffset=!1,this.type="reshape-3d",this.sketchOptions=new Qe,this.snappingManager=null,this.automaticManipulatorSelection=!1}initialize(){let t=this._reshapeOperation=new $({tool:this});this.addHandles([t.events.on("reshape",e=>this.events.emit("reshape",e)),t.events.on("move",e=>this.events.emit("move",e)),t.events.on("vertex-add",e=>this.events.emit("vertex-add",e)),t.events.on("vertex-remove",e=>this.events.emit("vertex-remove",e)),t.events.on("immediate-click",e=>this.events.emit("immediate-click",O(b({},e),{object:this.object}))),this.view.on("pointer-down",["Shift"],e=>e.stopPropagation())]),this.finishToolCreation()}destroy(){this._reshapeOperation=k(this._reshapeOperation)}get updating(){return((this.object.updating??!1)||this._reshapeOperation?.updating)??!1}get activeTooltipInfo(){return this._reshapeOperation?.activeTooltipInfo??null}get tooltip(){return this._reshapeOperation?.tooltip??null}onManipulatorSelectionChanged(){this._reshapeOperation&&this._reshapeOperation.onManipulatorSelectionChanged()}get canUndo(){return this._reshapeOperation.canUndo??!1}undo(){this.snappingManager!=null&&this.snappingManager.doneSnapping(),this._reshapeOperation.undo()}get canRedo(){return this._reshapeOperation.canRedo??!1}redo(){this.snappingManager!=null&&this.snappingManager.doneSnapping(),this._reshapeOperation.redo()}onInputEvent(t){let e=this._reshapeOperation;(!e||e.grabbingOrDragging||!dr(t,e.tooltip))&&this.enableDeleteVertices&&t.type==="key-down"&&Sc.delete.includes(t.key)&&this._reshapeOperation.removeSelectedVertices()>0&&t.stopPropagation()}reset(){}get test(){}};c([h()],he.prototype,"_reshapeOperation",void 0),c([h()],he.prototype,"view",void 0),c([h({constructOnly:!0})],he.prototype,"object",void 0),c([h()],he.prototype,"enableZShape",void 0),c([h()],he.prototype,"enableZVertex",void 0),c([h()],he.prototype,"enableMoveObject",void 0),c([h()],he.prototype,"enableDeleteVertices",void 0),c([h()],he.prototype,"autoHideManipulators",void 0),c([h()],he.prototype,"enableMidpoints",void 0),c([h()],he.prototype,"enableEdgeOffset",void 0),c([h()],he.prototype,"type",void 0),c([h({type:Qe})],he.prototype,"sketchOptions",void 0),c([h()],he.prototype,"snappingManager",void 0),c([h()],he.prototype,"updating",null),c([h()],he.prototype,"activeTooltipInfo",null),c([h()],he.prototype,"tooltip",null),c([h()],he.prototype,"automaticManipulatorSelection",void 0),he=c([E("esri.views.3d.interactive.editingTools.reshape.ReshapeTool3D")],he);var He=class extends me{constructor(t){super(t),this._interactionState=null}initialize(){this.addHandles([st(()=>{let t=this._interactionState;return t&&t.angle!==t.previousAngle?{interactionState:t,angle:t.state.angle}:null},({interactionState:t})=>{this._updateMeshRotation(t)},Ht),st(()=>{let t=this._interactionState;return t&&t.scale!==t.previousScale?{interactionState:t,scale:t.state.scale}:null},({interactionState:t})=>{this._updateMeshSize(t)},Ht)])}get initialAngle(){return this._interactionState?.initialAngle??0}get angle(){let t=this.geometry.transform;if(t==null)return this._interactionState?.angle??0;let e=t.rotation[2];return Math.abs(e)>.999999?oe(kl(t.rotation))*Math.sign(e):0}get angleClockwise(){return-this.angle}get relativeAngle(){return this.angle-this.initialAngle}get relativeAngleClockwise(){return-this.relativeAngle}get scale(){return this._interactionState?.scale??1}startInteraction(){let t=new qt({angle:this.angle});this._interactionState=t;let e=()=>{this._interactionState=null};return{state:t,done:e,cancel:()=>{t.cancel(),e()}}}createUndoRecord(){return this.object.createUndoRecord()}_updateMeshRotation(t){let{angle:e,previousAngle:i}=t;t.previousAngle=e;let r=pt(e-i);this.geometry.rotate(0,0,r,{origin:this.geometry.anchor})}_updateMeshSize(t){let{scale:e,previousScale:i}=t;t.previousScale=e;let r=e/i,a=this.geometry.anchor;this.geometry.scale(r,{origin:a})}};c([h({constructOnly:!0})],He.prototype,"object",void 0),c([h({constructOnly:!0})],He.prototype,"geometry",void 0),c([h({constructOnly:!0})],He.prototype,"viewingMode",void 0),c([h()],He.prototype,"initialAngle",null),c([h()],He.prototype,"angle",null),c([h()],He.prototype,"angleClockwise",null),c([h()],He.prototype,"relativeAngle",null),c([h()],He.prototype,"relativeAngleClockwise",null),c([h()],He.prototype,"scale",null),c([h()],He.prototype,"_interactionState",void 0),He=c([E("esri.views.3d.interactive.editingTools.transform.ScaleRotateMeshAdapter")],He);var qt=class extends me{get state(){let{angle:t,scale:e}=this;return{angle:t,scale:e}}constructor(t){super(t),this.angle=0,this.initialAngle=0,this.previousAngle=0,this.previousScale=1,this.scale=1,this.initialAngle=t.angle,this.previousAngle=t.angle}cancel(){this.angle=this.initialAngle,this.scale=1}};c([h()],qt.prototype,"angle",void 0),c([h()],qt.prototype,"initialAngle",void 0),c([h()],qt.prototype,"previousAngle",void 0),c([h()],qt.prototype,"previousScale",void 0),c([h()],qt.prototype,"scale",void 0),c([h()],qt.prototype,"state",null),qt=c([E("esri.views.3d.interactive.editingTools.transform.ScaleRotateMeshAdapter.InteractionState")],qt);var le=class extends me{constructor(t){super(t),this.sizeAxis=null,this._interactionState=null}initialize(){this.addHandles(st(()=>this._interactionState!=null?this._interactionState.state:null,t=>{this._updateSymbol(t)},Ht))}get initialAngle(){return this._interactionState?.initialAngle??0}get angle(){return this._interactionState!=null?this._interactionState.angle:this._orientationReferenceSymbolLayer!=null?hu(this._orientationReferenceSymbolLayer.heading??0):0}get angleClockwise(){return-this.angle}get orientation(){return this.angle}get orientationClockwise(){return this.angleClockwise}get relativeAngle(){return this.angle-this.initialAngle}get relativeAngleClockwise(){return-this.relativeAngle}get scale(){return this._interactionState?.scale??1}get size(){let t=this._sizeReferenceSymbolLayer;if(t==null)return null;let e=this.findLayerView(),i=this._graphicSymbol;if(e==null||i==null||i.type!=="point-3d")return null;let r=e.getSymbolLayerSize(i,t);if("size"in r&&r.size!=null)return r.size;let a=this.sizeAxis;return!("width"in r)||r.width==null||a!=null&&a!=="width"&&a!=="all"&&a!=="width-and-depth"?!("depth"in r)||t.depth==null||a!=null&&a!=="depth"&&a!=="all"&&a!=="width-and-depth"?!("height"in r)||t.height==null||a!=null&&a!=="height"&&a!=="all"?null:r.height:r.depth:r.width}get _sizeReferenceSymbolLayer(){let t=this._graphicSymbol;return t==null||t.symbolLayers.length===0?null:t.symbolLayers.find(e=>e.type==="object")}get _orientationReferenceSymbolLayer(){let t=this._graphicSymbol;return t==null||t.symbolLayers.length===0?null:t.symbolLayers.find(e=>e.type==="object"&&e.heading!=null)}get _graphicSymbol(){return this.graphic?.symbol!=null&&this.graphic.symbol.type==="point-3d"?this.graphic.symbol:null}set _graphicSymbol(t){this.graphic.symbol=t}startInteraction(){let t=this._graphicSymbol,e=this.findLayerView();if(this._interactionState!=null||t==null||e==null)return du;let i=t.symbolLayers.map(n=>n.type==="object"?e.getSymbolLayerSize(t,n):null).toArray(),r=t.clone(),a=this.angle,o=new $t({originalSymbol:r,angle:a,initialSizes:i});this._interactionState=o;let s=()=>{this._interactionState=null};return{state:o,done:s,cancel:()=>{this._graphicSymbol=r,s()}}}createUndoRecord(){let t=this.graphic.symbol,e=null;return{undo:i=>{e=i.symbol,i.symbol=t},redo:i=>{t=i.symbol,i.symbol=e}}}_updateSymbol({scale:t,angle:e,originalSymbol:i,initialSizes:r}){let a=this._graphicSymbol;if(a==null||a.type!=="point-3d")return;let o=a.clone(),s=-pt(e-this.initialAngle),n=!1;this._forEachObjectSymbolLayerPair(i,o,(l,p,u)=>{let d=(l.heading??0)+s;p.heading!==d&&(p.heading=d,n=!0);let m=r[u];if(m!=null&&"width"in m){m.width=this.sizeFilter(m.width),m.height=this.sizeFilter(m.height),m.depth=this.sizeFilter(m.depth);let f=m.width*t;p.width!==f&&(p.width=f,n=!0);let _=m.depth*t;p.depth!==_&&(p.depth=_,n=!0);let x=m.height*t;p.height!==x&&(p.height=x,n=!0)}}),n&&(this._graphicSymbol=o)}_forEachObjectSymbolLayerPair(t,e,i){t.symbolLayers.forEach((r,a)=>{let o=e.symbolLayers.at(a);r.type==="object"&&o.type==="object"&&i(r,o,a)})}};function hu(t){return-oe(t)}c([h()],le.prototype,"initialAngle",null),c([h()],le.prototype,"angle",null),c([h()],le.prototype,"angleClockwise",null),c([h()],le.prototype,"orientation",null),c([h()],le.prototype,"orientationClockwise",null),c([h()],le.prototype,"relativeAngle",null),c([h()],le.prototype,"relativeAngleClockwise",null),c([h()],le.prototype,"scale",null),c([h()],le.prototype,"size",null),c([h()],le.prototype,"sizeAxis",void 0),c([h({constructOnly:!0})],le.prototype,"graphic",void 0),c([h()],le.prototype,"_interactionState",void 0),c([h({constructOnly:!0})],le.prototype,"findLayerView",void 0),c([h({constructOnly:!0})],le.prototype,"sizeFilter",void 0),c([h()],le.prototype,"_sizeReferenceSymbolLayer",null),c([h()],le.prototype,"_orientationReferenceSymbolLayer",null),c([h()],le.prototype,"_graphicSymbol",null),le=c([E("esri.views.3d.interactive.editingTools.transform.ScaleRotateObjectSymbol3DAdapter")],le);var du={state:{angle:0,scale:0},done:()=>{},cancel:()=>{}},$t=class extends me{get state(){let{originalSymbol:t,angle:e,initialAngle:i,scale:r,initialSizes:a}=this;return{originalSymbol:t,angle:e,initialAngle:i,scale:r,initialSizes:a}}constructor(t){super(t),this.angle=0,this.initialAngle=0,this.scale=1,this.initialAngle=t.angle}};c([h()],$t.prototype,"originalSymbol",void 0),c([h()],$t.prototype,"angle",void 0),c([h()],$t.prototype,"initialAngle",void 0),c([h()],$t.prototype,"initialSizes",void 0),c([h()],$t.prototype,"scale",void 0),c([h()],$t.prototype,"state",null),$t=c([E("esri.views.3d.interactive.editingTools.transform.ScaleRotateObjectSymbol3DAdapter.InteractionState")],$t);var Mt=class extends Ee{constructor(t){super(t),this.type="transform-absolute",this.orientation=null,this.orientationPrecision=null,this.rotationType="geographic",this.size=null,this.sizePrecision=null,this.sizeUnit=null}};c([h()],Mt.prototype,"type",void 0),c([h()],Mt.prototype,"orientation",void 0),c([h()],Mt.prototype,"orientationPrecision",void 0),c([h()],Mt.prototype,"rotationType",void 0),c([h()],Mt.prototype,"size",void 0),c([h()],Mt.prototype,"sizePrecision",void 0),c([h()],Mt.prototype,"sizeUnit",void 0),Mt=c([E("esri.views.interactive.tooltip.infos.TransformAbsoluteTooltipInfo")],Mt);var zt=class extends Ee{constructor(t){super(t),this.type="transform-rotate",this.rotation=null,this.rotationPrecision=null,this.orientation=null,this.orientationPrecision=null,this.rotationType="geographic"}};c([h()],zt.prototype,"type",void 0),c([h()],zt.prototype,"rotation",void 0),c([h()],zt.prototype,"rotationPrecision",void 0),c([h()],zt.prototype,"orientation",void 0),c([h()],zt.prototype,"orientationPrecision",void 0),c([h()],zt.prototype,"rotationType",void 0),zt=c([E("esri.views.interactive.tooltip.infos.TransformRotateTooltipInfo")],zt);var Qt=class extends Ee{constructor(t){super(t),this.type="transform-scale",this.size=null,this.sizeUnit=null,this.sizePrecision=null}};c([h()],Qt.prototype,"type",void 0),c([h()],Qt.prototype,"scale",void 0),c([h()],Qt.prototype,"size",void 0),c([h()],Qt.prototype,"sizeUnit",void 0),c([h()],Qt.prototype,"sizePrecision",void 0),Qt=c([E("esri.views.interactive.tooltip.infos.TransformScaleTooltipInfo")],Qt);var U;(function(t){t.ScaleIn=se.Custom2,t.ScaleOut=se.Custom3,t.RotateLeft=se.Custom4,t.RotateRight=se.Custom5,t.Unlocked=se.Custom7,t.DelayedFocused=se.Custom8,t.TouchInput=se.Custom12})(U||(U={}));var at=class extends me{get angle(){return this.adapter.angle}get scale(){return this.adapter.scale}set location(t){this._ringManipulator.location=t}set elevationAlignedLocation(t){this._ringManipulator.elevationAlignedLocation=t}get grabbing(){return this._ringManipulator.grabbing}set interactive(t){this._ringManipulator.interactive=t}get updating(){return!!this._activeAnimation}get tooltipEffectiveEnabled(){return this.sketchOptions.tooltips.effectiveEnabled&&this.tooltipEnabled}constructor(t){super(t),this.mode=null,this.tooltipEnabled=!0,this._scaleRotateDragData=null,this._activeAnimation=null,this._ringIndicatorDelayMs=hh,this._absoluteTooltipInfo=null,this._scaleTooltipInfo=null,this._rotateTooltipInfo=null,this.events=new te,this.getFocused=()=>this._ringManipulator.focused,this.getScale=()=>this._scaleRotateDragData?.mode==="scale"?this.adapter.scale:1}initialize(){this.tooltip=new At({view:this.tool.view}),this._createManipulator(),this._updateDragState(),this._updateManipulatorTransform(),this.addHandles([st(()=>!this.tooltipEffectiveEnabled,()=>this.tooltip.clear(),I),v(()=>{let{adapter:t}=this,{info:e}=this.tooltip;return e===this._absoluteTooltipInfo&&this.getFocused()?[e,t.size,t.orientationClockwise]:[null]},([t])=>{t&&this._updateFocusTooltip()}),v(()=>{let{adapter:t}=this;return[t.angle,t.scale]},()=>this._updateManipulatorTransform())])}destroy(){this._activeAnimation?.frameTask.remove(),this._activeAnimation=null,this.tool.manipulators.remove(this._ringManipulator),this._ringManipulator=null,this.tooltip=k(this.tooltip)}startAnimation(t){this.cancelActiveAnimation(),t.start();let e=Jn({update:({deltaTime:i})=>{t.update(i)&&this.cancelActiveAnimation()}});this._activeAnimation=O(b({},t),{frameTask:e})}cancelActiveAnimation(){this._activeAnimation?.frameTask.remove(),this._activeAnimation=k(this._activeAnimation)}forEachManipulator(t){t(this._ringManipulator,C.SCALE_ROTATE)}_createManipulator(){let t=this._createRingManipulator();this._ringManipulator=t,this.tool.manipulators.add(t);let e=this.tool.object,i=pe(t,(r,a,o)=>{this._scaleRotateDragData=null;let s=this.adapter.startInteraction(),n={mode:"none",origin:Xe(r.renderLocation),initialAngle:this.adapter.angle,angle:0,angleDir:0,scaleDir:0};this._scaleRotateDragData=n,this._updateDragState();let l=y.get();this.tool.view.renderCoordsHelper.worldUpAtPosition(r.renderLocation,l),a.next(tr(this.tool.view,dt(r.renderLocation,l,St()))).next(p=>{let u=p.plane,d=Co(p.renderStart,p.renderEnd,n.origin,u),m=ec.shortestSignedDiff(n.angle,d);n.angleDir=Ci(n.angleDir+m,-bn,bn),n.angle=d;let f=uu(n,p),_=f-this.adapter.scale;if(n.scaleDir=Ci(n.scaleDir+_,-yn,yn),this._onScaleChanged(),n.mode==="none"){let x=this.mode||mu(p,p.plane,n.origin,this.tool.view.state.camera);if(x!=null){switch(x){case"rotate":this.tool.events.emit("rotate-start",{object:e,angle:0}),this.tool.events.emit("record-undo",{updates:[this.adapter.createUndoRecord()]});break;case"scale":this.tool.events.emit("scale-start",{object:e,xScale:1,yScale:1}),this.tool.events.emit("record-undo",{updates:[this.adapter.createUndoRecord()]})}n.mode=x}}switch(n.mode){case"rotate":s.state.angle=n.initialAngle+d;break;case"scale":s.state.scale=f,this._onScaleChanged()}switch(this._updateDragState(),this._updateManipulatorTransform(),p.action){case"start":case"update":switch(n.mode){case"rotate":this.tool.events.emit("rotate",{object:e,angle:pt(n.angle)});break;case"scale":this.tool.events.emit("scale",{object:e,xScale:f,yScale:f})}break;case"end":switch(n.mode){case"rotate":this.tool.events.emit("rotate-stop",{object:e,angle:pt(n.angle)});break;case"scale":this.tool.events.emit("scale-stop",{object:e,xScale:f,yScale:f})}}return p.action==="end"&&(this.startAnimation(jh(this,()=>this._onScaleChanged())),this._scaleRotateDragData=null,this._updateDragState(),s.done()),p}).next(this._updateTooltipPipelineStep(n)),o.next(()=>{if(s.cancel(),this._scaleRotateDragData!=null){switch(this._scaleRotateDragData.mode){case"none":break;case"rotate":this.tool.events.emit("rotate-stop",{object:e,angle:0});break;case"scale":this.tool.events.emit("scale-stop",{object:e,xScale:1,yScale:1})}this.startAnimation(jh(this,()=>this._onScaleChanged())),this._scaleRotateDragData=null,this._updateDragState()}this._updateFocusTooltip()})});this.addHandles([i,t.events.on("focus-changed",r=>{r.action==="focus"?this.startAnimation(fu(this,()=>this._updateDelayedFocusedState(),{delayMs:this._ringIndicatorDelayMs})):this._updateDelayedFocusedState()}),t.events.on("immediate-click",r=>{r.stopPropagation()}),v(()=>this.tool.object.visible,r=>this._ringManipulator.available=r,I)])}_updateTooltipPipelineStep(t){return e=>{let{sketchOptions:i}=this,{visualVariables:r}=i.tooltips;if(!this.tooltipEffectiveEnabled)return e;if(e.action==="end")return this._updateFocusTooltip(),e;let{tooltip:a}=this;switch(t.mode){case"scale":{a.info=this._scaleTooltipInfo??=new Qt({sketchOptions:i});let{size:o,scale:s}=this.adapter,n=r?.size,l=a.info;l.sketchOptions=i,l.scale=vc(s),l.size=o!=null?hr(o,"meters"):void 0,l.sizePrecision=Fo(n?.valueType),l.sizeUnit=n?.unit;break}case"rotate":{a.info=this._rotateTooltipInfo??=new zt({sketchOptions:i});let{orientationClockwise:o,relativeAngleClockwise:s}=this.adapter,n=r?.rotation,l=Fo(n?.valueType),p=a.info;p.sketchOptions=i,p.rotation=s!=null?Qa(s,"radians","geographic"):void 0,p.rotationPrecision=l,p.rotationType=n?.rotationType??"geographic",p.orientation=o!=null?Qa(o,"radians","geographic"):void 0,p.orientationPrecision=l;break}}return e}}_updateFocusTooltip(){let{sketchOptions:t,tooltip:e}=this,{visualVariables:i}=t.tooltips;if(this.tooltipEffectiveEnabled)if(this.getFocused()){let r=i?.rotation,a=i?.size,o=this.mode,{size:s,orientationClockwise:n}=this.adapter,l=n!=null&&(o==null||o==="rotate"),p=s!=null&&(o==null||o==="scale");e.info=this._absoluteTooltipInfo??=new Mt({sketchOptions:t});let u=e.info;u.sketchOptions=t,u.orientation=l?Qa(n,"radians","geographic"):void 0,u.orientationPrecision=Fo(r?.valueType),u.rotationType=r?.rotationType??"geographic",u.size=p?hr(s,"meters"):void 0,u.sizeUnit=a?.unit,u.sizePrecision=Fo(a?.valueType)}else e.clear()}_onScaleChanged(){this.events.emit("scale-changed"),this._updateManipulatorTransform()}_updateDelayedFocusedState(){this._ringManipulator.updateStateEnabled(U.DelayedFocused,this.getFocused()),this._updateFocusTooltip()}_updateDragState(){if(this._ringManipulator.updateStateEnabled(U.Unlocked,!(this._scaleRotateDragData!=null&&this._scaleRotateDragData?.mode!=="none")),this._scaleRotateDragData!=null)switch(this._scaleRotateDragData.mode){case"rotate":this._ringManipulator.updateStateEnabled(U.ScaleIn|U.ScaleOut,!1),this._ringManipulator.updateStateEnabled(U.RotateLeft,this._scaleRotateDragData.angleDir<0),this._ringManipulator.updateStateEnabled(U.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this._ringManipulator.updateStateEnabled(U.RotateLeft|U.RotateRight,!1),this._ringManipulator.updateStateEnabled(U.ScaleIn,this._scaleRotateDragData.scaleDir<0),this._ringManipulator.updateStateEnabled(U.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this._ringManipulator.updateStateEnabled(U.ScaleIn|U.ScaleOut|U.RotateLeft|U.RotateRight,!1)}_updateManipulatorTransform(){let t=Ta(q.get(),this.adapter.angle,z(0,0,1));if(t==null)return;let e=this.getScale(),i=Vi(q.get(),j(y.get(),e,e,e));this._ringManipulator.modelTransform=je(q.get(),i,t)}_createRingManipulator(){let t=(L,de,Ae)=>{let Jt=[],Kt=Math.ceil(128*(de-L)/(2*Math.PI));for(let we=0;we<Kt+1;we++){let Lr=L+we*(de-L)/Kt;Jt.push(z(Ae*Math.cos(Lr),Ae*Math.sin(Lr),0))}return Jt},e=L=>t(0,2*Math.PI,L),i=L=>[[-L/2,0],[L/2,0],[L/2,To/2],[-L/2,To/2]],r=this._createMaterial(1),a=(L,de,Ae=r)=>lo(Ae,i(de),L,[],[],!1),o=e(Si),s=a(o,Eo),n={left:new Array,right:new Array},l=[];for(let L=0;L<2;L++){let de=L*Math.PI-Math.PI/4,Ae=Math.PI/2-ch,Jt=de+Ae,Kt=de+Math.PI/2-Ae,we=t(Jt,Kt,sh),Lr=a(we,er);l.push(we),l.push(t(Jt,Kt,mn-Eo/2)),n.left.push(Lr),n.right.push(Lr.instantiate());for(let is=0;is<2;is++){let Zn=is===0,ke=re();if(Zn){Ut(ke,ke,[1,-1,1]),us(ke,ke,-Jt,[0,0,1]);let Di=Math.round(gn*(we.length-1));ke[12]=we[Di][0],ke[13]=we[Di][1],ke[14]=we[Di][2]}else{us(ke,ke,Kt,[0,0,1]);let Di=Math.round((1-gn)*(we.length-1));ke[12]=we[Di][0],ke[13]=we[Di][1],ke[14]=we[Di][2]}let Yn=Zi(r,nh,0,lh,To);co(Yn,ke),(Zn?n.left:n.right).push(Yn)}}let p=[];for(let L=0;L<2;L++){let de=L*Math.PI-Math.PI/4,Ae=Math.PI/2-ph,Jt=de+Ae,Kt=de+Math.PI/2-Ae,we=t(Jt,Kt,mn);p.push(a(we,er))}let u=this._createMaterial(.66),d=this._createMaterial(.5),m=this._createMaterial(.33),f=e(Si+_n),_=e(Si+vn),x=a(f,er,u),D=a(_,er,m),T=e(Si-_n),A=e(Si-vn),Q=a(T,er,u),ae=a(A,er,m),xe=[new w(s,U.DelayedFocused),new w(s.instantiate({material:d}),S.None)];this.mode&&this.mode!=="scale"||(xe=xe.concat([...p.map(L=>new w(L,U.DelayedFocused|U.Unlocked)),new w(x,U.DelayedFocused|U.ScaleIn),new w(D,U.DelayedFocused|U.ScaleIn),new w(Q,U.DelayedFocused|U.ScaleOut),new w(ae,U.DelayedFocused|U.ScaleOut)])),this.mode&&this.mode!=="rotate"||(xe=xe.concat([...n.right.map(L=>new w(L.instantiate(),U.DelayedFocused|U.Unlocked)),...n.left.map(L=>new w(L,U.DelayedFocused|U.RotateLeft)),...n.right.map(L=>new w(L,U.DelayedFocused|U.RotateRight))]));let Ce=[o,...l];return new Z({view:this.tool.view,renderObjects:xe,autoScaleRenderObjects:!1,worldOriented:!0,radius:Eo,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:this.tool.object.elevationInfo,collisionType:{type:"ribbon",paths:Ce,direction:z(0,0,1)}})}_createMaterial(t){let e=new Se({cullFace:X.Back,renderOccluded:M.Transparent,isDecoration:!0});return this.addHandles(v(()=>({color:Ms(this.tool.view.effectiveTheme.accentColor,t)}),i=>e.setParameters(i),I)),e}get test(){}};function uu(t,e){let i=R(y.get(),e.renderStart,t.origin),r=R(y.get(),e.renderEnd,t.origin),a=fe(i),o=fe(r);return a===0?0:o/a}function mu(t,e,i,r){let{renderStart:a,renderEnd:o}=t,s=Ho(a,r,y.get()),n=Ho(o,r,y.get());if(wa(s,n)<fn*fn)return null;let l=R(y.get(),a,i),p=ce(y.get(),l,e),u=a,d=V(y.get(),u,p),m=Ho(i,r,y.get()),f=s,_=Ho(d,r,y.get()),x=R(y.get(),_,f),D=R(y.get(),s,m),T=Yr(f,x),A=Yr(m,D);return Os(T,n)<Os(A,n)?"rotate":"scale"}function Ho(t,e,i){return e.projectToScreen(t,Cn),j(i,Cn[0],Cn[1],0)}var Ar;function jh(t,e){let i=null,r=1,a=()=>r;return{start:()=>{r=t.getScale(),i=t.getScale,t.getScale=a,e()},update:o=>(r+=((r+1)/2-r)*Math.min(o*dh,1),e(),Math.abs(r-1)<.01?Ar.STOP:Ar.CONTINUE),destroy:()=>{i&&(t.getScale=i),e()}}}function fu(t,e,i){let r=0,a=null,o=()=>!1;return{start:()=>{a=t.getFocused,t.getFocused=o,r=0,e()},update:s=>(r+=s,!a?.()||r>=i.delayMs?Ar.STOP:Ar.CONTINUE),destroy:()=>{a&&(t.getFocused=a),e()}}}function Fo(t){switch(t){case"integer":case"long":return 0;default:return null}}c([h({constructOnly:!0})],at.prototype,"tool",void 0),c([h({constructOnly:!0})],at.prototype,"adapter",void 0),c([h({constructOnly:!0})],at.prototype,"sketchOptions",void 0),c([h()],at.prototype,"mode",void 0),c([h()],at.prototype,"tooltipEnabled",void 0),c([h()],at.prototype,"_activeAnimation",void 0),c([h()],at.prototype,"updating",null),c([h()],at.prototype,"tooltipEffectiveEnabled",null),at=c([E("esri.views.3d.interactive.editingTools.transform.ScaleRotateTransform")],at),function(t){t[t.CONTINUE=0]="CONTINUE",t[t.STOP=1]="STOP"}(Ar||(Ar={}));var Cn=Oe();var Dr=class extends ao(Ee){constructor(t){super(t),this.type="transform-mesh",this.orientation=Ac({actual:null,lockable:!1}),this.scale=Dc({actual:null,lockable:!1}),this.allFields.forEach(e=>{e.lockable=!1,e.setActual(null)})}get key(){return{longitude:this.longitude.actual,latitude:this.latitude.actual,x:this.x.actual,y:this.y.actual,elevation:this.elevation.actual,geographic:this.geographic,orientation:this.orientation.actual,scale:this.scale.actual}}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}};c([h()],Dr.prototype,"key",null),c([h()],Dr.prototype,"allFields",null),Dr=c([E("esri.views.interactive.tooltip.infos.TransformMeshTooltipInfo")],Dr);var fa=class extends ao(Ee){constructor(t){super(t),this.type="transform-point",this.allFields.forEach(e=>{e.lockable=!1,e.setActual(null)})}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};c([h()],fa.prototype,"allFields",null),fa=c([E("esri.views.interactive.tooltip.infos.TransformPointTooltipInfo")],fa);var Fe=class extends li{constructor(t){super(t),this.events=new te,this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.sketchOptions=new Qe,this.type="transform-3d",this._updatingHandles=new ri,this._scaleRotate=null}initialize(){let{events:t,object:e,view:i}=this;this.tooltip=new At({view:i}),this._moveManipulation=new rt({tool:this,view:i,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&_t(e.operations,e.elevationInfo),radius:rt.radiusForSymbol(e.graphic?.symbol)}),this._moveManipulation.forEachManipulator(l=>this.addHandles(l.events.on("immediate-click",p=>{t.emit("immediate-click",O(b({},p),{object:this.object})),p.stopPropagation()})));let r=e.elevationInfo;if(this._moveManipulation.elevationInfo=r,this.addHandles(br(e)),this._moveManipulation.createManipulatedObjectDragPipeline((l,p,u,d,m)=>{if(l===Y.XY){let{snappingStep:f,cancelSnapping:_}=ki({snappingContext:new Fi({elevationInfo:r,pointer:m,editGeometryOperations:mr.fromGeometry(new Ne({spatialReference:e.operations?.data.spatialReference}),i.state.viewingMode),visualizer:new gt,excludeFeature:e.graphic}),snappingManager:this.snappingManager,updatingHandles:this._updatingHandles,useZ:!1});d=d.next(_),u=u.next(Bc(this.view,r)).next(...f)}return{steps:u,cancel:d}},e,l=>{let{action:p,object:u,dxScreen:d,dyScreen:m}=l,f={object:u,dxScreen:d,dyScreen:m};switch(p){case"start":this._emitRecordUndo(),t.emit("translate-start",f);break;case"update":t.emit("translate",f);break;case"end":t.emit("translate-stop",f)}}),this._moveManipulation.angle=this._scaleRotate!=null?this._scaleRotate.angle:0,this._scaleRotateAdapter=this._createScaleRotateAdapter(),this.addHandles(v(()=>this._scaleRotateAdapter.angle,()=>this._updateMoveAngle())),this.enableScaling||this.enableRotation){let l=this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate";this._scaleRotate=new at({tool:this,mode:l,adapter:this._scaleRotateAdapter,sketchOptions:this.sketchOptions,tooltipEnabled:B(e)?.type!=="mesh"}),this.addHandles(this._scaleRotate.events.on("scale-changed",()=>this._onScaleChanged()))}this.addHandles([Mi({view:this.view,object:e,forEachManipulator:l=>this._forEachManipulator(l),onManipulatorsChanged:()=>H()}),e.on("committed",()=>this._onGeometryChanged()),this._hideManipulatorsForObjectState(),v(()=>i.scale,()=>this._updateMoveAngle())].filter(Ma)),this._onGeometryChanged(),this._updateMoveAngle(),this._forEachManipulator(l=>{l instanceof Z&&this.addHandles(l.events.on("grab-changed",()=>this._updateManipulatorsInteractive()))});let a=i?.type,{sketchOptions:o}=this;this._meshTooltipInfo=new Dr({viewType:a,sketchOptions:o}),this._pointTooltipInfo=new fa({viewType:a,sketchOptions:o});let s={object:e,dxScreen:0,dyScreen:0},n={onMoveStart:()=>{this._emitRecordUndo(),t.emit("translate-start",b({},s))},onMove:()=>t.emit("translate",b({},s)),onMoveStop:()=>t.emit("translate-stop",b({},s)),onRotateStart:l=>{this._emitRecordUndo(),t.emit("rotate-start",{object:e,angle:l})},onRotate:l=>t.emit("rotate",{object:e,angle:l}),onRotateStop:l=>t.emit("rotate-stop",{object:e,angle:l}),onScaleStart:(l,p)=>{this._emitRecordUndo(),t.emit("scale-start",{object:e,xScale:l,yScale:p})},onScale:(l,p)=>t.emit("scale",{object:e,xScale:l,yScale:p}),onScaleStop:(l,p)=>t.emit("scale-stop",{object:e,xScale:l,yScale:p})};this.addHandles(Mo(this.tooltip,this.object,()=>({sketchOptions:this.sketchOptions,activeTooltipInfo:this.activeTooltipInfo,callbacks:n}))),this.finishToolCreation()}destroy(){this.tooltip.destroy(),this._moveManipulation.destroy(),this._scaleRotate=k(this._scaleRotate),this._scaleRotateAdapter=k(this._scaleRotateAdapter),this._updatingHandles.destroy(),this._set("view",null),this._set("object",null)}onInputEvent(t){if(!this.destroyed&&!dr(t,this.tooltip))return super.onInputEvent(t)}_updateManipulatorsInteractive(){this._scaleRotate!=null&&(this._scaleRotate.interactive=!this._moveManipulation.grabbing,this._moveManipulation.interactive=!this._scaleRotate.grabbing)}_createScaleRotateAdapter(){let t=B(this.object);return t?.type==="mesh"?new He({object:this.object,geometry:t,viewingMode:this.view.state.viewingMode}):new le({graphic:this.object.graphic,sizeFilter:e=>this._enforceNonZeroSize(e),findLayerView:()=>this.view.allLayerViews.find(e=>e.layer===this.object.graphic?.layer),sizeAxis:this.sketchOptions?.tooltips?.visualVariables?.size?.axis??null})}_forEachManipulator(t){this._moveManipulation?.forEachManipulator(t),this._scaleRotate?.forEachManipulator(t)}_hideManipulatorsForObjectState(){return v(()=>this.object.visible,t=>{this._forEachManipulator(e=>e.available=t),this._moveManipulation.zManipulation.available=t&&this.enableZ&&_t(this.object.operations,this.object.elevationInfo)})}_emitRecordUndo(){this.events.emit("record-undo",{updates:[this.object.createUndoRecord()]})}set snapToScene(t){this._moveManipulation&&(this._moveManipulation.snapToScene=t),this._set("snapToScene",t)}get updating(){return this._updatingHandles.updating||!!this._scaleRotate?.updating}get activeTooltipInfo(){return this._scaleRotate?.tooltip?.info!=null?null:B(this.object)?.type==="mesh"?this._meshTooltipInfo:this._pointTooltipInfo}set location(t){this._moveManipulation.location=t,this._scaleRotate&&(this._scaleRotate.location=t)}set elevationAlignedLocation(t){this._moveManipulation.elevationAlignedLocation=t,this._scaleRotate&&(this._scaleRotate.elevationAlignedLocation=t)}reset(){}onHide(){this._scaleRotate?.cancelActiveAnimation()}_onScaleChanged(){this._scaleRotate!=null&&(this._moveManipulation.displayScale=this._scaleRotate.getScale())}_updateMoveAngle(){let{view:t}=this,e=t.state.viewingMode===Br.Local||t.scale<uh;this._moveManipulation.angle=e?this._scaleRotateAdapter.angle:0}_onGeometryChanged(){jo(this,this.object)}_enforceNonZeroSize(t){return t||this.view.state.camera.computeRenderPixelSizeAt(this._moveManipulation.renderLocation)}get test(){}};c([h({constructOnly:!0,nonNullable:!0})],Fe.prototype,"view",void 0),c([h({constructOnly:!0,nonNullable:!0})],Fe.prototype,"object",void 0),c([h({constructOnly:!0,nonNullable:!0})],Fe.prototype,"enableZ",void 0),c([h()],Fe.prototype,"enableRotation",void 0),c([h()],Fe.prototype,"enableScaling",void 0),c([h({constructOnly:!0,type:Qe})],Fe.prototype,"sketchOptions",void 0),c([h({value:!1})],Fe.prototype,"snapToScene",null),c([h({constructOnly:!0})],Fe.prototype,"snappingManager",void 0),c([h({readOnly:!0})],Fe.prototype,"type",void 0),c([h({readOnly:!0})],Fe.prototype,"updating",null),c([h()],Fe.prototype,"activeTooltipInfo",null),Fe=c([E("esri.views.3d.interactive.editingTools.transform.TransformTool3D")],Fe);var Pi=class extends Dl(el){constructor(t){super(t),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}equals(t){return this.heading===t.heading&&this.tilt===t.tilt&&$n(this.position,t.position)&&this.width===t.width&&this.height===t.height}};c([h({readOnly:!0,json:{read:!1,write:!0}})],Pi.prototype,"type",void 0),c([h({type:Ne}),pr()],Pi.prototype,"position",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:360}}),pr(),os(t=>As.normalize(as(t),0,!0))],Pi.prototype,"heading",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:360}}),pr(),os(t=>As.normalize(as(t),0,!0))],Pi.prototype,"tilt",void 0),c([h({type:Number,nonNullable:!0}),pr()],Pi.prototype,"width",void 0),c([h({type:Number,nonNullable:!0}),pr()],Pi.prototype,"height",void 0),Pi=c([E("esri.analysis.SlicePlane")],Pi);var gu=Le(0,0,0,.04);var tD=ba("mac")?"Meta":"Control";var Lh=2,Vh=1.15,zh=1.15;var _u=Math.cos(oe(45)),vu=Math.cos(oe(5));var Gh=3,jn=11,ko=22.5,ga=40,Ln=48,Hh=2.25,Fh=4,Vn=1,kh=.3,Nh=6,Uh=4;var _D=re();var No=class t extends Rt{initializeProgram(e){return new Pt(e.rctx,t.shader.get().build(this.configuration),Ua)}initializePipeline(){return Tt({blending:oc(Ve.ONE,Ve.ONE,Ve.ONE_MINUS_SRC_ALPHA,Ve.ONE_MINUS_SRC_ALPHA),depthTest:{func:sr.LESS},colorWrite:Ot})}};No.shader=new Et(bp,()=>import("./chunk-3PSUJ62S.js"));var n1=2**50;var l1=g();var c1=g();function Xh(t,e){return Tn(t.basis1,t.basis2,t.origin,e)}function qh(t,e,i,r){let a=e.worldUpAtPosition(t.origin,y.get()),o=y.get();switch(i){case Ir.HEADING:G(o,a);break;case Ir.TILT:G(o,t.basis1)}return dt(t.origin,o,r)}function $h(t,e,i,r){let a=fe(r.basis1),o=fe(r.basis2),s=Qh(r),n=Uo(r),l=j(y.get(),0,0,0);V(l,W(y.get(),r.basis1,e.direction[0]),W(y.get(),r.basis2,e.direction[1])),V(l,r.origin,l);let p=0,u=1;if(ir(e))e.direction[0]===1&&e.direction[1]===-1?p=Wh:e.direction[0]===1&&e.direction[1]===1?p=Math.PI:e.direction[0]===-1&&e.direction[1]===1&&(p=3*Math.PI/2),u=n;else{let m=e.direction[0]!==0?1:2;p=m===1?Wh:0,u=(m===1?o:a)-s}let d=Ea(q.get(),p);Ut(d,d,j(y.get(),u,u,u)),je(d,i,d),d[12]=0,d[13]=0,d[14]=0,t.modelTransform=d,t.renderLocation=l}var Zh;function Qh(t){let e=fe(t.basis1),i=fe(t.basis2);return kh*Math.min(e,i)}function Uo(t){return Qh(t)}function ir(t){return t.direction[0]!==0&&t.direction[1]!==0}(function(t){t[t.POSITIVE_X=0]="POSITIVE_X",t[t.POSITIVE_Y=1]="POSITIVE_Y",t[t.NEGATIVE_X=2]="NEGATIVE_X",t[t.NEGATIVE_Y=3]="NEGATIVE_Y"})(Zh||(Zh={}));var Gt=se.Custom1,Ir,Yh;(function(t){t[t.HEADING=1]="HEADING",t[t.TILT=2]="TILT"})(Ir||(Ir={})),function(t){t[t.HORIZONTAL_OR_VERTICAL=0]="HORIZONTAL_OR_VERTICAL",t[t.HORIZONTAL=1]="HORIZONTAL",t[t.VERTICAL=2]="VERTICAL",t[t.TILTED=3]="TILTED"}(Yh||(Yh={}));var _a=se.Custom2,CI=xt(),Wh=Math.PI/2,Cr=se.Custom1,Bo=se.Custom2;var va;(function(t){t[t.CENTER_ON_CALLOUT=0]="CENTER_ON_CALLOUT",t[t.CENTER_ON_ARROW=1]="CENTER_ON_ARROW"})(va||(va={}));var Zo=class extends Z{constructor(e,i){let r=new ne({width:1,renderOccluded:M.OccludeAndTransparent,isDecoration:!0}),a=new Se({cullFace:X.Back,renderOccluded:M.Opaque,isDecoration:!0}),o=new Se({cullFace:X.Back,renderOccluded:M.Opaque,isDecoration:!0}),s=new Se({cullFace:X.Back,renderOccluded:M.Opaque,isDecoration:!0}),n=new Se({writeDepth:!1,cullFace:X.Front,renderOccluded:M.Transparent,isDecoration:!0});super(b({view:e},xu({offsetMode:i,tubeMaterial:a,tipMaterial:o,capMaterial:s,outlineMaterial:n,calloutMaterial:r}))),this._themeHandle=v(()=>e.effectiveTheme.accentColor,l=>{let p=ai(l),u=F.toUnitRGBA(l),d=F.toUnitRGBA(p),m=F.toUnitRGBA(F.blendColors(p,l,.4)),f=F.toUnitRGBA(F.blendColors(p,l,.14));r.setParameters({color:u}),a.setParameters({color:f}),o.setParameters({color:d}),s.setParameters({color:m}),n.setParameters({color:u})},I)}destroy(){this._themeHandle.remove(),super.destroy()}};function xu({offsetMode:t,tubeMaterial:e,tipMaterial:i,capMaterial:r,outlineMaterial:a,calloutMaterial:o}){let s=t===va.CENTER_ON_CALLOUT?ga:0,n=[z(s,0,-Ln/2),z(s,0,Ln/2)],l=Ou(n),p=Jh({vertices:n,padding:0,materials:{tube:e,tip:i,cap:r}}),u=Jh({vertices:n,padding:Hh,materials:{tube:a,tip:a,cap:a}}),d=Me(o,[[s,0,0],[s-ga,0,0]]),m=Me(o,[[s,0,0],[s-ga,0,0]]);return{renderObjects:[...p.normal.map(f=>new w(f,S.Unfocused|Gt)),...u.normal.map(f=>new w(f,S.Unfocused|Gt)),new w(d,S.Unfocused|Gt|_a),...p.focused.map(f=>new w(f,S.Focused|Gt)),...u.focused.map(f=>new w(f,S.Focused|Gt)),new w(m,S.Focused|Gt|_a)],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[l]},collisionPriority:1,radius:jn,state:Gt}}function Jh({vertices:t,padding:e,materials:i}){let r=a=>{let o=t.slice(0),s=R(y.get(),o[0],o[1]);ie(s,s);let n=R(y.get(),o[o.length-1],o[o.length-2]);if(ie(n,n),e>0){let L=W(g(),n,-e);o[o.length-1]=V(L,L,o[o.length-1]);let de=W(g(),s,-e);o[0]=V(de,de,o[0])}let l=a?zh:1,p=ko*l,u=jn*l,d=Fr(q.get());if(e>0){let L=p/4,de=j(y.get(),0,L,0),Ae=1+e/L;kr(d,d,de),Ut(d,d,j(y.get(),Ae,Ae,Ae)),kr(d,d,W(de,de,-1/Ae))}let m=Fr(re()),f=z(0,1,0),_=fs(re(),Ss(ws.get(),f,n));_[12]=o[o.length-1][0],_[13]=o[o.length-1][1],_[14]=o[o.length-1][2],je(_,_,d);let x=i.tube,D=wu(Gh*(a?Vh:1)+e,o,x);D.transformation=m;let T=[D],A=i.tip,Q=$r(A,p,u,24,!1,!1,!0);Q.transformation=_,T.push(Q);let ae=i.cap,xe=$r(ae,p,u,24,!1,!0,!1);xe.transformation=_,T.push(xe);let Ce=fs(re(),Ss(ws.get(),f,s));return Ce[12]=o[0][0],Ce[13]=o[0][1],Ce[14]=o[0][2],je(Ce,Ce,d),T.push(Q.instantiate({transformation:Ce})),T.push(xe.instantiate({transformation:Ce})),T};return{normal:r(!1),focused:r(!0)}}function wu(t,e,i){let r=[];for(let o=0;o<12;o++){let s=o/12*2*Math.PI;r.push([Math.cos(s)*t,Math.sin(s)*t])}return lo(i,r,e,[],[],!1)}function Ou(t,e){let i=R(g(),t[t.length-1],t[t.length-2]);ie(i,i),W(i,i,ko),V(i,i,t[t.length-1]);{let r=R(g(),t[0],t[1]);return ie(r,r),W(r,r,ko),V(r,r,t[0]),[r,...t,i]}}var Yo=class{get _object(){return this._tool.object}get _operations(){return this._object.operations}constructor(e,i){this._tool=e,this._bounds=i,this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null;let r=this._tool,a=r.view;this.moveXYObjectManipulation=new Ti({view:a,tool:r,object:this._object}),r.addHandles(this._createMoveXYObjectDragPipeline()),this.moveZManipulator=new Zo(a,va.CENTER_ON_CALLOUT),this.moveZManipulator.state|=_a,r.manipulators.add(this.moveZManipulator),r.addHandles([this._createMoveZDragPipeline()]),r.addHandles([r.events.on("translate-stop",()=>{this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null})])}destroy(){this.moveXYObjectManipulation.destroy(),this._tool.manipulators.remove(this.moveZManipulator),this.moveZManipulator.destroy()}forEachManipulator(e){this.moveXYObjectManipulation.forEachManipulator(e),e(this.moveZManipulator,C.TRANSLATE_Z)}updateManipulators(e,i){let r=this.moveZManipulator,a=ms(q.get(),e,Math.PI);a[12]=0,a[13]=0,a[14]=0,r.modelTransform=a,r.renderLocation=R(y.get(),i.origin,i.basis1)}getUpdatedTooltipInfo(){return this.moveXYObjectManipulation.grabbing||this.moveXYObjectManipulation.dragging?this._computeMoveXYTooltipInfo():this.moveZManipulator.focused?this._computeMoveZTooltipInfo():null}_computeMoveXYTooltipInfo(){let e=this._tool,i=this._moveXYTooltipInfo??=new _r({sketchOptions:e.sketchOptions});if(this.moveXYObjectManipulation.dragging){let r=this._bounds,a=r.mapBoundsStart.origin,o=r.mapBounds.origin,{renderSpatialReference:s}=e.view;if(!s)return null;let n=so(a,o,s);if(n==null)return null;i.distance=n}else i.distance=_e;return i}_computeMoveZTooltipInfo(){let e=this._tool,i=this._moveZTooltipInfo??=new Lt({sketchOptions:e.sketchOptions});if(this.moveZManipulator.dragging){let r=this._bounds,a=r.mapBoundsStart.origin,o=r.mapBounds.origin,{renderSpatialReference:s}=e.view;if(!s)return null;let n=Cc(a,o,s);if(n==null)return null;i.distance=n}else i.distance=_e;return i}_createMoveXYObjectDragPipeline(){return this.moveXYObjectManipulation.createDragPipeline((e,i,r)=>this._applyObjectMoveSteps(i,r))}_createMoveZDragPipeline(){if(!this._operations)return H();let e=this._operations.data.spatialReference;return pe(this.moveZManipulator,(i,r,a)=>{let o=Xe(i.renderLocation),s=r.next(Ro(this._tool.view,o,e)).next(Ke());this._applyObjectMoveSteps(s,a)})}_applyObjectMoveSteps(e,i){let{_tool:r,_object:a}=this,o=e.next(s=>(s.action==="start"&&(r.inputState={type:"move"},this._bounds.backupMapBounds(),r.events.emit("translate-start",{object:a,dxScreen:s.screenDeltaX,dyScreen:s.screenDeltaY})),s)).next(Wt()).next(this._moveDragUpdateGeometry()).next(s=>{let n={object:a,dxScreen:s.screenDeltaX,dyScreen:s.screenDeltaY};switch(s.action){case"start":case"update":(s.mapEnd.x-s.mapStart.x||s.mapEnd.y-s.mapStart.y||(s.mapEnd.z??0)-(s.mapStart.z??0))&&r.events.emit("translate",n);break;case"end":r.inputState=null,r.events.emit("translate-stop",n)}return s});return i.next(()=>{r.inputState!=null&&r.events.emit("translate-stop",{object:a,dxScreen:0,dyScreen:0}),r.cancel()}),o}_moveDragUpdateGeometry(){let e=this._tool;return i=>{if(e.inputState==null||e.inputState.type!=="move")return i;let r=i.action==="start"?be.NEW_STEP:be.ACCUMULATE_STEPS;if(this._operations){let a=this._operations.move(i.mapDeltaX,i.mapDeltaY,i.mapDeltaZ,r);this._bounds.updateMapBoundsFromOperation(a)}return i}}};var Tu="theme-style";function Kh(t,e){return Au(Pu(Eu(Ru(t),e)),e.size)}function Eu(t,{accentColor:e,contrastColor:i}){let r=e.toHex(),a=e.a,o=i.toHex(),s=i.a,n=t.getElementsByTagNameNS("http://www.w3.org/2000/svg","style").namedItem(Tu);return n&&(n.innerHTML=`
      .contrast-fill { fill: ${o}; fill-opacity: ${s}; }
      .contrast-stroke { stroke: ${o}; stroke-opacity: ${s};  }
      .accent-fill { fill: ${r}; fill-opacity: ${a}; }
      .accent-stroke { stroke: ${r}; stroke-opacity:  ${a}; }`),t}function Ru(t){let e=t.split(",")[1],i=atob(e);return new DOMParser().parseFromString(i,"image/svg+xml")}function Pu(t){let e=new XMLSerializer().serializeToString(t);return`data:image/svg+xml;base64,${btoa(e)}`}function Au(t,e){let i=new Image(e,e);return i.src=t,i}var ed="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NiIgaGVpZ2h0PSI1NiIgZmlsbD0ibm9uZSIgdmVyc2lvbj0iMi4wIj48c3R5bGUgaWQ9InRoZW1lLXN0eWxlIj4uY29udHJhc3QtZmlsbHtmaWxsOiNmZmZ9LmNvbnRyYXN0LXN0cm9rZXtzdHJva2U6I2ZmZn0uYWNjZW50LWZpbGx7ZmlsbDojZmY3ZjAwO2ZpbGwtb3BhY2l0eTouNX08L3N0eWxlPjxwYXRoIGQ9Ik0yOCAwYTI4IDI4IDAgMSAxIDAgNTYgMjggMjggMCAwIDEgMC01NiIgY2xhc3M9ImFjY2VudC1maWxsIi8+PHBhdGggc3Ryb2tlLXdpZHRoPSI0Ljk5IiBkPSJNMjAuMDUgNDAuODZhMTUuMDUgMTUuMDUgMCAwIDAgMTcuMTQtMS41IDE1LjA1IDE1LjA1IDAgMCAwIDQuNDctMTYuNjUgMTUuMDUgMTUuMDUgMCAwIDAtMjIuNzItNy4xNSAxNS4wNSAxNS4wNSAwIDAgMC01LjUgNy4xNSIgY2xhc3M9ImNvbnRyYXN0LXN0cm9rZSIvPjxwYXRoIGQ9Im0xMC45NyAzNS41NyA1LjM4IDEyLjA3IDcuNzktMTMuNDd6IiBjbGFzcz0iY29udHJhc3QtZmlsbCIvPjwvc3ZnPg==";var td=64;function id(t,e){let{accentColor:i,contrastColor:r,preMultiplyAlpha:a}=e;return t.fromData(`heading-rotate:[accent:${i},contrast:${r},size:${td}]`,()=>new tc(Kh(ed,{accentColor:i,contrastColor:r,size:td}),{mipmap:!0,reloadable:!0,preMultiplyAlpha:a}))}var ya=class t extends Rt{initializeProgram(e){return new Pt(e.rctx,t.shader.get().build(this.configuration),zn)}_setPipelineState(e,i){let r=this.configuration,a=e===wt.NONE,o=e===wt.FrontFace;return Tt({blending:r.output===Be.Color&&r.transparent?a?Du:Wa(e):null,culling:Za(r.cullFace),depthTest:{func:pc(e)},depthWrite:a?r.writeDepth?Ya:null:Xa(e),drawBuffers:qa(e),colorWrite:Ot,stencilWrite:r.hasOccludees?fc:null,stencilTest:r.hasOccludees?i?_c:gc:null,polygonOffset:a||o?null:cc(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};ya.shader=new Et(Mp,()=>import("./chunk-U4CBJV54.js"));var Du=cr(Ve.ONE,Ve.ONE_MINUS_SRC_ALPHA),Re=class extends $a{constructor(){super(...arguments),this.output=Be.Color,this.cullFace=X.None,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=wt.NONE,this.multipassEnabled=!1,this.cullAboveGround=!1,this.perspectiveInterpolation=!0}};c([N({count:Be.COUNT})],Re.prototype,"output",void 0),c([N({count:X.COUNT})],Re.prototype,"cullFace",void 0),c([N()],Re.prototype,"hasSlicePlane",void 0),c([N()],Re.prototype,"transparent",void 0),c([N()],Re.prototype,"enableOffset",void 0),c([N()],Re.prototype,"writeDepth",void 0),c([N()],Re.prototype,"hasOccludees",void 0),c([N({count:wt.COUNT})],Re.prototype,"transparencyPassType",void 0),c([N()],Re.prototype,"multipassEnabled",void 0),c([N()],Re.prototype,"cullAboveGround",void 0),c([N()],Re.prototype,"perspectiveInterpolation",void 0),c([N({constValue:!1})],Re.prototype,"occlusionPass",void 0);var zn=new Map([[P.POSITION,0],[P.UV0,2],[P.PERSPECTIVEDIVIDE,3]]);var Wo=class extends Ys{constructor(e){super(e,new Fn),this.supportsEdges=!0,this.produces=new Map([[Ze.OPAQUE_MATERIAL,i=>Ts(i)||Wr(i)&&!this.parameters.transparent],[Ze.TRANSPARENT_MATERIAL,i=>Wr(i)&&this.parameters.transparent&&this.parameters.writeDepth],[Ze.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,i=>Wr(i)&&this.parameters.transparent&&!this.parameters.writeDepth],[Ze.DRAPED_MATERIAL,i=>Wr(i)||Ts(i)]]),this._vertexAttributeLocations=zn,this._configuration=new Re}getConfiguration(e,i){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<nc,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration.perspectiveInterpolation=this.parameters.perspectiveInterpolation,this._configuration}createGLMaterial(e){return new Gn(e)}createBufferWriter(){let e=Ws.clone();return this.parameters.perspectiveInterpolation&&e.f32(P.PERSPECTIVEDIVIDE),new Hn(e)}},Gn=class extends ic{constructor(e){super(b(b({},e),e.material.parameters))}_updateParameters(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(ya,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&(this._material.setParameters({hasOccludees:e.hasOccludees}),this._updateParameters(e))}beginSlot(e){return this._output===Be.Color&&this._updateOccludeeState(e),this._updateParameters(e)}},Hn=class extends Cs{write(e,i,r,a,o){for(let s of this.vertexBufferLayout.fields.keys()){let n=r.attributes.get(s);if(n)if(s===P.PERSPECTIVEDIVIDE){Aa(n.size===1);let l=a.getField(s,Ol);l&&hc(n,l,o)}else mc(s,n,e,i,a,o)}}},Fn=class extends Ba{constructor(){super(...arguments),this.transparent=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=X.None,this.hasOccludees=!1,this.opacity=1,this.textureId=null,this.initTextureTransparent=!0,this.perspectiveInterpolation=!1}};var Xo=class extends Z{constructor(e,i){let r=new Wo({transparent:!0,writeDepth:!1,renderOccluded:M.Opaque,isDecoration:!0}),a=On.calloutWidth,o=new ne({width:a,renderOccluded:M.OccludeAndTransparent,isDecoration:!0});super(b({view:e},Iu({imageMaterial:r,calloutMaterial:o}))),this._currentTexture=null,this._themeHandle=v(()=>e.effectiveTheme.accentColor,s=>{let n=$e(s,.5),l=ai(s),p=this._currentTexture,u=i(n,l);r.setParameters({textureId:u.texture.id}),o.setParameters({color:F.toUnitRGBA(s)}),this._currentTexture=u,p?.release()},I)}destroy(){this._themeHandle.remove(),this._currentTexture?.release(),super.destroy()}};function Iu({imageMaterial:t,calloutMaterial:e}){let{focusMultiplier:i,calloutLength:r,discRadius:a}=On,o=a*i,s=(u,d)=>{let m=[0,1,2,2,3,0];return new Na(d,[[P.POSITION,new Zr([r-u,-u,0,r+u,-u,0,r+u,u,0,r-u,u,0],m,3,!0)],[P.UV0,new Zr([0,0,1,0,1,1,0,1],m,2,!0)]])},n=Me(e,[[0,0,0],[r-a,0,0]]),l=Me(e,[[0,0,0],[r-o,0,0]]),p=Gt;return{autoScaleRenderObjects:!1,collisionPriority:1,collisionType:{type:"disc",direction:[0,0,1],offset:[r,0,0]},focusMultiplier:i,radius:a,renderObjects:[new w(s(a,t),S.Unfocused|p),new w(n,S.Unfocused|p),new w(s(o,t),S.Focused|p),new w(l,S.Focused|p)],state:p}}var qo=class{get _object(){return this._tool.object}get _operations(){return this._object.operations}constructor(e,i,r){this._tool=e,this._bounds=i,this._snapRotation=r,this._rotateTooltipInfo=null,this._startAngle=0,this._endAngle=0;let a=this._tool,o=a.view,s=!o._stage?.renderView.renderingContext.driverTest.svgPremultipliesAlpha.result;this.rotateManipulator=new Xo(o,(n,l)=>id(o.textures,{accentColor:n,contrastColor:l,preMultiplyAlpha:s})),a.addHandles([this.rotateManipulator.events.on("grab-changed",n=>this._onRotateGrab(n)),this._createRotateDragPipeline(this.rotateManipulator)]),a.manipulators.add(this.rotateManipulator),a.addHandles([a.events.on("rotate-start",n=>this._startAngle=n.angle),a.events.on("rotate",n=>this._endAngle=n.angle),a.events.on("rotate-stop",()=>{this._startAngle=0,this._endAngle=0})])}destroy(){this._tool.manipulators.remove(this.rotateManipulator),this.rotateManipulator.destroy()}forEachManipulator(e){e(this.rotateManipulator,C.ROTATE)}updateManipulators(e,i){let r=this._bounds.mapBounds.plane[2]<0?Math.PI:0,a=Nr(q.get(),e,r);a[12]=0,a[13]=0,a[14]=0,this.rotateManipulator.modelTransform=a,this.rotateManipulator.renderLocation=V(y.get(),i.origin,i.basis1)}getUpdatedTooltipInfo(){return this.rotateManipulator.focused?this._computeRotateTooltipInfo():null}_computeRotateTooltipInfo(){let e=this._rotateTooltipInfo??=new Sp({sketchOptions:this._tool.sketchOptions});return e.angle=this._startAngle-this._endAngle,e}_onRotateGrab({action:e,screenPoint:i}){let r=this._tool,a=this._bounds;if(e!=="start"||!i)return;let o=qh(a.displayBounds,r.view.renderCoordsHelper,Ir.HEADING,St()),s=So(r.view.state.camera,i);ut(o,s,y.get())&&(a.backupMapBounds(),r.inputState={type:"rotate",rotatePlane:o})}_createRotateDragPipeline(e){let{_tool:i,_object:r}=this;return pe(e,(a,o,s)=>{let n=i.inputState;n!=null&&(o.next(l=>(l.action==="start"&&i.events.emit("rotate-start",{object:r,angle:0}),l)).next(tr(i.view,n.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(n)).next(...this._snapRotation()).next(this._rotateDragUpdateGeometry()).next(l=>{let p={object:r,angle:pt(l.rotateAngle)};switch(l.action){case"start":case"update":i.events.emit("rotate",p);break;case"end":i.inputState=null,i.events.emit("rotate-stop",p)}return l}),s.next(()=>{i.inputState!=null&&i.events.emit("rotate-stop",{object:r,angle:0}),i.cancel()}))})}_rotateDragRenderPlaneToRotate(e){return i=>{let r=e.rotatePlane,a=Co(i.renderStart,i.renderEnd,this._bounds.displayBounds.origin,r);return O(b({},i),{rotateAxis:r,rotateAngle:a})}}_rotateDragUpdateGeometry(){let e=this._bounds;return i=>{let r=G(g(),e.mapBoundsStart.origin),a=i.action==="start"?be.NEW_STEP:be.ACCUMULATE_STEPS;if(this._operations){let o=this._operations.rotate(r,i.rotateAngle,a,no.REPLACE);ni(e.mapBoundsStart,e.mapBounds),e.updateMapBoundsFromOperation(o)}return i}}};var $o=class extends Z{constructor(e,i){let r=ir(i),a=r?Fh:Vn,o=a*Lh,s=Vn,n={renderOccluded:M.OccludeAndTransparent,isDecoration:!0},l=new ne(O(b({},n),{width:a})),p=new ne(O(b({},n),{width:o})),u=new ne(O(b({},n),{width:s}));super(b(b({view:e},yh),Cu({isCorner:r,unfocusedMaterial:l,focusedMaterial:p,outlineMaterial:u}))),this._themeHandle=v(()=>e.effectiveTheme.accentColor,d=>{let m=F.toUnitRGBA(d);l.setParameters({color:m}),p.setParameters({color:m}),u.setParameters({color:m})},I)}destroy(){this._themeHandle.remove(),super.destroy()}};function Cu({isCorner:t,unfocusedMaterial:e,focusedMaterial:i,outlineMaterial:r}){let a=t?[z(1,0,0),z(0,0,0),z(0,1,0)]:[z(1,0,0),z(-1,0,0)];return{renderObjects:[new w(Me(e,a),S.Unfocused|Cr),new w(Me(i,a),S.Focused|Cr),new w(Me(r,a),Bo)],collisionType:{type:"line",paths:[a]},radius:t?Nh:Uh,state:Cr}}var Jo=class{constructor(e,i){this._tool=e,this.mapBounds=si(),this.mapBoundsStart=si(),this.displayBounds=si(),e.addHandles(ti(()=>e.object,"modified-externally",()=>this._resetMapBounds(),{onListenerAdd:()=>this._resetMapBounds()})),this._onDisplayBoundsChanged=i}get displayBoundsMargin(){let{view:e,object:i}=this._tool,r=B(i),a=e.pointsOfInterest?.centerOnSurfaceFrequent.location??r?.extent?.center;return a?ju*e.pixelSizeAt(a):0}backupMapBounds(){ni(this.mapBounds,this.mapBoundsStart)}updateDisplayBounds(){this._calculateDisplayBounds(),this._onDisplayBoundsChanged?.()}updateMapBoundsFromOperation(e){qc(e,this.mapBounds),this.updateDisplayBounds()}updateMapBoundsFromOperationInverse(e){$c(e,this.mapBounds),this.updateDisplayBounds()}_resetMapBounds(){this._calculateMapBounds(),this.updateDisplayBounds()}_calculateMapBounds(){let{view:e,attachmentOrigin:i,object:r}=this._tool,a=r.operations?.data;if(!a)return;let o=a.geometry;this.spatialReference=o.spatialReference;let s=Xp(o);ii(s,s,-1);let n=e.spatialReference,l=o.spatialReference,p=i?e.pixelSizeAt(i)*ss(n)/zr(l):0;Qc(s,a,Lu*p,this.mapBounds)}_calculateDisplayBounds(){let{view:e,attachmentOrigin:i}=this._tool,r=i?.z??ui(this.mapBounds.origin,e.elevationProvider,et.fromElevationInfo(this._tool.object.elevationInfo),e.renderCoordsHelper),a=ni(this.mapBounds);a.origin[2]=r??0,Vu(a,e.renderCoordsHelper,this.spatialReference,this.displayBoundsMargin,this.displayBounds)}},ju=10,Lu=80;function Vu(t,e,i,r=0,a){a||(a=si()),e.toRenderCoords(t.origin,i,a.origin);let o=y.get();V(o,t.origin,t.basis1),V(o,o,t.basis2),e.toRenderCoords(o,i,o);let s=y.get();V(s,t.origin,t.basis1),R(s,s,t.basis2),e.toRenderCoords(s,i,s);let n=y.get();R(n,t.origin,t.basis1),R(n,n,t.basis2),e.toRenderCoords(n,i,n);let l=y.get();R(l,t.origin,t.basis1),V(l,l,t.basis2),e.toRenderCoords(l,i,l);let p=ct(y.get(),o,s,.5);R(p,p,a.origin);let u=ct(y.get(),n,l,.5);R(u,a.origin,u),ct(a.basis1,p,u,.5);let d=ct(y.get(),l,o,.5);R(d,d,a.origin);let m=ct(y.get(),s,n,.5);R(m,a.origin,m),ct(a.basis2,d,m,.5);let f=ce(y.get(),a.basis1,a.basis2),_=ce(f,f,a.basis1);return ie(_,_),W(a.basis2,_,lt(a.basis2,_)),W(a.basis1,a.basis1,1+r/fe(a.basis1)),W(a.basis2,a.basis2,1+r/fe(a.basis2)),Hs(a),a}function Un(t,e,i){return R(jr,R(jr,t.origin,t.basis1),t.basis2),Ft(Qo,jr,t.basis1,2),Ft(Nn,Qo,t.basis2,2),Ft(kn,jr,t.basis2,2),jr[2]=Qo[2]=Nn[2]=kn[2]=e,xp({topLeft:kn,topRight:Nn,bottomRight:Qo,bottomLeft:jr,spatialReference:i})}var kn=g(),Nn=g(),Qo=g(),jr=g();var Ko=class{get _object(){return this._tool.object}get _operations(){return this._object.operations}get zMax(){if(!this._zMaxDirty||!this._operations)return this._zMax;let e=this._operations.data;if(e.geometry.hasZ){let i=e.coordinateHelper;this._zMax=Number.NEGATIVE_INFINITY;for(let r of e.components)for(let a of r.vertices){let o=i.getZ(a.pos)??0;this._zMax=Math.max(o,this._zMax)}}else this._zMax=0;return this._zMaxDirty=!1,this._zMax}constructor(e,i,r){this._tool=e,this._bounds=i,this._preserveAspectRatioStep=r,this._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],this._scaleTooltipInfo=null,this._displayBoundsStart=si(),this._displayBoundsMarginStart=0,this._startScale=ht(),this._endScale=ht(),this._sizeStart=null,this._zMax=0,this._zMaxDirty=!0;let a=this._tool,o=a.view;this.resizeManipulators=this._resizeHandles.map(s=>{let n=new $o(o,s);return a.addHandles([n.events.on("grab-changed",l=>this._onResizeGrab(l)),this._createResizeDragPipeline(n,s)]),n}),a.manipulators.addMany(this.resizeManipulators),a.addHandles([a.events.on("scale-start",s=>{qe(this._startScale,s.xScale,s.yScale),qe(this._endScale,s.xScale,s.yScale)}),a.events.on("scale",s=>{qe(this._endScale,s.xScale,s.yScale)}),a.events.on("scale-stop",()=>{qe(this._startScale,0,0),qe(this._endScale,0,0)})]),this._operations&&a.addHandles(this._operations.data.on("change",()=>{a.inputState?.type!=="resize"&&(this._zMaxDirty=!0)}))}destroy(){this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()})}forEachManipulator(e){this.resizeManipulators.forEach(i=>e(i,C.SCALE))}updateManipulators(e,i){this.resizeManipulators.forEach((r,a)=>{$h(r,this._resizeHandles[a],e,i)})}getUpdatedTooltipInfo(){return this.resizeManipulators.some(e=>e.focused)?this._computeScaleTooltipInfo():null}_computeScaleTooltipInfo(){let e=this._tool,i=this._scaleTooltipInfo??=new wp({sketchOptions:e.sketchOptions}),r=Un(this._bounds.mapBounds,this.zMax,this._bounds.spatialReference);return r==null?null:(i.xSize=r.xSize,i.ySize=r.ySize,this._sizeStart!=null&&this.resizeManipulators.some(a=>a.dragging)?(i.xScale=r.xSize.value/this._sizeStart.xSize.value,i.yScale=r.ySize.value/this._sizeStart.ySize.value):(i.xScale=1,i.yScale=1),i)}_onResizeGrab({action:e,screenPoint:i}){let r=this._tool,a=this._bounds;if(e!=="start"||!i)return;let o=So(r.view.state.camera,i);ut(a.displayBounds.plane,o,y.get())&&(a.backupMapBounds(),ni(a.displayBounds,this._displayBoundsStart),this._displayBoundsMarginStart=a.displayBoundsMargin,this._sizeStart=Un(a.mapBoundsStart,this.zMax,a.spatialReference),r.inputState={type:"resize"})}_createResizeDragPipeline(e,i){let{_tool:r,_object:a}=this;return pe(e,(o,s,n)=>{r.inputState!=null&&(s.next(l=>(l.action==="start"&&r.events.emit("scale-start",{object:a,xScale:1,yScale:1}),l)).next(tr(r.view,this._displayBoundsStart.plane)).next(l=>O(b({},l),{handle:i})).next(this._resizeDragRenderPlaneToFactors()).next(...this._preserveAspectRatioStep()).next(this._resizeDragUpdateGeometry()).next(l=>{let p={object:a,xScale:l.factor1,yScale:l.factor2};switch(l.action){case"start":case"update":r.events.emit("scale",p);break;case"end":r.inputState=null,r.events.emit("scale-stop",p)}return l}),n.next(()=>{r.inputState!=null&&r.events.emit("scale-stop",{object:a,xScale:1,yScale:1}),r.cancel()}))})}_resizeDragRenderPlaneToFactors(){let e=this._bounds;return i=>{let r=this._displayBoundsStart,a=i.handle.direction,o=e.displayBoundsMargin,s=this._displayBoundsMarginStart,n=G(y.get(),r.origin);Ft(n,n,r.basis1,-a[0]),Ft(n,n,r.basis2,-a[1]);let l=R(y.get(),i.renderEnd,n),p=R(y.get(),i.renderStart,n),u=ir(i.handle),d=Uo(r),m=Uo(e.displayBounds)/d,f=(_,x)=>{if(_===0)return 1;let D=fe(x),T=.5*_*lt(x,l)/D,A=T<0?-1:1;u&&(T+=(D-.5*_*lt(x,p)/D)*A*m);let Q=D<1.5*s?1:rd;return D=Math.max(D-s,rd),A>0&&(T-=o),A*Math.max(A*(T/D),Q)};return O(b({},i),{factor1:f(a[0],r.basis1),factor2:f(a[1],r.basis2)})}}_resizeDragUpdateGeometry(){let e=this._bounds;return i=>{let r=G(g(),e.mapBoundsStart.origin);Ft(r,r,e.mapBoundsStart.basis1,-i.handle.direction[0]),Ft(r,r,e.mapBoundsStart.basis2,-i.handle.direction[1]);let a=qe(ht(),e.mapBoundsStart.basis1[0],e.mapBoundsStart.basis1[1]);or(a,a);let o=i.action==="start"?be.NEW_STEP:be.ACCUMULATE_STEPS;if(this._operations){let s=this._operations.scale(r,a,i.factor1,i.factor2,o,no.REPLACE);ni(e.mapBoundsStart,e.mapBounds),e.updateMapBoundsFromOperation(s)}return i}}},rd=1e-6;var es=class{constructor(){this._lastDragEvent=null,this._next=null,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&this._lastDragEvent!=null&&this._next!=null){let i=O(b({},this._lastDragEvent),{action:"update"});e&&ad(i),this._next.execute(i)}this._enabled=e}createDragEventPipelineStep(){this._lastDragEvent=null;let e=new pi;return this._next=e,[i=>(this._lastDragEvent=i.action!=="end"?b({},i):null,this._enabled&&ad(i),i),e]}get test(){}};function ad(t){let e=ir(t.handle)?Math.max(Math.abs(t.factor1),Math.abs(t.factor2)):t.handle.direction[0]===0?Math.abs(t.factor2):Math.abs(t.factor1);t.factor1=t.factor1<0?-e:e,t.factor2=t.factor2<0?-e:e}var ts=class{constructor(){this._lastDragEvent=null,this._next=null,this.incrementRadians=oe(5),this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&this._lastDragEvent!=null&&this._next!=null){let i=O(b({},this._lastDragEvent),{action:"update"});e&&this._adjustRotation(i),this._next.execute(i)}this._enabled=e}createDragEventPipelineStep(){this._lastDragEvent=null;let e=new pi;return this._next=e,[i=>(this._lastDragEvent=i.action!=="end"?b({},i):null,this._enabled&&this._adjustRotation(i),i),e]}_adjustRotation(e){e.rotateAngle=Math.round(e.rotateAngle/this.incrementRadians)*this.incrementRadians}};var Pe=class extends li{get updating(){return!!this.object.updating}constructor(t){super(t),this.events=new te,this.enableZ=!0,this.enableScaling=!0,this.enableRotation=!0,this.sketchOptions=new Qe,this._preserveAspectRatio=new es,this._snapRotation=new ts,this.grabbing=!1,this.inputState=null,this._attachmentOrigin=null,this.type="transform-3d",this._outlineVisualElement=null}initialize(){let{view:t,object:e}=this,i=this._bounds=new Jo(this,()=>this._updateManipulators());this._extentMove=new Yo(this,i),this._extentScale=new Ko(this,i,()=>this._preserveAspectRatio.createDragEventPipelineStep()),this._extentRotate=new qo(this,i,()=>this._snapRotation.createDragEventPipelineStep()),this.addHandles([v(()=>this.enableZ,()=>this._updateManipulatorAvailability(this._extentMove.moveZManipulator,C.TRANSLATE_Z)),v(()=>this.enableScaling,()=>this._extentScale.forEachManipulator(s=>this._updateManipulatorAvailability(s,C.SCALE))),v(()=>this.enableRotation,()=>this._updateManipulatorAvailability(this._extentRotate.rotateManipulator,C.ROTATE))]),this._updateManipulators(),this._updateAllManipulatorAvailability();let r=Mi({view:t,object:e,forEachManipulator:s=>this._forEachManipulator(s),onManipulatorsChanged:()=>H()});if(r!=null){let{visualElement:s}=r;s instanceof ze&&(this._outlineVisualElement=s,this.addHandles(s.events.on("attachment-origin-changed",()=>this._bounds.updateDisplayBounds()))),this.addHandles(r)}this.addHandles([e.on("committed",()=>this._onGeometryChanged()),v(()=>this.object.visible,()=>this._updateAllManipulatorAvailability()),v(()=>this.object.isDraped,()=>this._graphicDrapedChanged(),I),v(()=>t.pointsOfInterest?.centerOnSurfaceFrequent.location,()=>i.updateDisplayBounds())]);let a=s=>{this.addHandles(s.events.on("grab-changed",()=>{this.grabbing=s.grabbing,this._updateAllManipulatorAvailability()}))};this._forEachManipulator(a);let o=(s,n)=>{this.addHandles(s.events.on("immediate-click",l=>{n===C.TRANSLATE_XY&&this.events.emit("immediate-click",O(b({},l),{object:e})),l.stopPropagation()}))};this._forEachManipulator(o),this._initializeTooltip(),this.finishToolCreation()}destroy(){this._extentMove.destroy(),this._extentScale.destroy(),this._extentRotate.destroy(),this.tooltip.destroy(),this._set("view",null),this._set("object",null)}_initializeTooltip(){let{view:t}=this,e=this.tooltip=new At({view:t}),i=()=>{e.info=this._getUpdatedTooltipInfo()};this.addHandles([v(()=>this.sketchOptions.tooltips.effectiveEnabled,i),this.events.on("translate-start",i),this.events.on("translate",i),this.events.on("translate-stop",()=>this.tooltip.clear()),this.events.on("rotate-start",i),this.events.on("rotate",i),this.events.on("rotate-stop",i),this.events.on("scale-start",i),this.events.on("scale",i),this.events.on("scale-stop",i)]),this._forEachManipulator(r=>{this.addHandles([r.events.on("focus-changed",i),r.events.on("grab-changed",i),r.events.on("drag",a=>{a.action==="cancel"?this.tooltip.clear():i()})])})}_getUpdatedTooltipInfo(){return this.sketchOptions.tooltips.effectiveEnabled?this._extentMove.getUpdatedTooltipInfo()??this._extentScale.getUpdatedTooltipInfo()??this._extentRotate.getUpdatedTooltipInfo():null}_onGeometryChanged(){this._bounds.updateDisplayBounds()}_graphicDrapedChanged(){this.removeHandles(od),this._bounds.updateDisplayBounds(),this.object.isDraped&&this.addHandles(this.view.elevationProvider.on("elevation-change",t=>{this._attachmentOrigin!=null&&Oa(t.extent,this._attachmentOrigin.x,this._attachmentOrigin.y)&&this._bounds.updateDisplayBounds()}),od)}_updateManipulators(){if(!this.visible)return;let t=this._bounds.displayBounds,e=Xh(t,q.get());this._extentMove.updateManipulators(e,t),this._extentScale.updateManipulators(e,t),this._extentRotate.updateManipulators(e,t)}_updateAllManipulatorAvailability(){this._forEachManipulator((t,e)=>this._updateManipulatorAvailability(t,e))}_updateManipulatorAvailability(t,e){let i=this.grabbing&&!t.grabbing;if(t.interactive=!i,t instanceof Z){let r=this.object.visible,a=this.enableZ&&_t(this.object.operations,this.object.elevationInfo);switch(e){case C.ROTATE:t.available=r&&this.enableRotation;break;case C.SCALE:t.available=r&&(this.enableScaling||this.enableRotation||a),t.interactive=!i&&this.enableScaling,t.state=this.enableScaling?Cr:Bo;break;case C.TRANSLATE_Z:t.available=r&&a;break;default:t.available=r}}}_forEachManipulator(t){this._extentMove.forEachManipulator(t),this._extentScale.forEachManipulator(t),this._extentRotate.forEachManipulator(t)}get preserveAspectRatio(){return this._preserveAspectRatio.enabled}set preserveAspectRatio(t){this._preserveAspectRatio.enabled=t,this._set("preserveAspectRatio",t)}get snapRotation(){return this._snapRotation.enabled}set snapRotation(t){this._snapRotation.enabled=t,this._set("snapRotation",t)}get attachmentOrigin(){let t=this.object.isDraped?null:this._outlineVisualElement?.attachmentOrigin;return this._attachmentOrigin=t??this.object.origin??B(this.object)?.extent?.center,this._attachmentOrigin}reset(){}cancel(){if(this.canUndo){let t=this.object.operations?.undo();t&&this._bounds.updateMapBoundsFromOperationInverse(t)}this.inputState=null}get canUndo(){return!!this.object.operations?.canUndo}undo(){if(this.inputState!=null)this.view.activeTool=null;else if(this.canUndo){let t=this.object.operations?.undo();t&&this._bounds.updateMapBoundsFromOperationInverse(t)}}get canRedo(){return!!this.object.operations?.canRedo}redo(){if(this.canRedo){let t=this.object.operations?.redo();t&&this._bounds.updateMapBoundsFromOperation(t)}}get test(){}};c([h()],Pe.prototype,"updating",null),c([h({constructOnly:!0,nonNullable:!0})],Pe.prototype,"view",void 0),c([h({constructOnly:!0,nonNullable:!0})],Pe.prototype,"object",void 0),c([h()],Pe.prototype,"enableZ",void 0),c([h()],Pe.prototype,"enableScaling",void 0),c([h()],Pe.prototype,"enableRotation",void 0),c([h({constructOnly:!0,type:Qe})],Pe.prototype,"sketchOptions",void 0),c([h()],Pe.prototype,"preserveAspectRatio",null),c([h()],Pe.prototype,"snapRotation",null),c([h()],Pe.prototype,"grabbing",void 0),c([h()],Pe.prototype,"inputState",void 0),c([h({readOnly:!0})],Pe.prototype,"type",void 0),c([h()],Pe.prototype,"tooltip",void 0),Pe=c([E("esri.views.3d.interactive.editingTools.transform.ExtentTransformTool")],Pe);var od="draped-elevation-changes";function sd(t){return t!=null&&t.type==="mesh"?zu(t):Gu(t)}function zu(t){return Vl(t.vertexSpace)?Hu(t,t.transform,t.vertexSpace):Fu(t)}function Gu(t){let e=t,i=null;return{undo(r){i=r.geometry,r.geometry=e},redo(r){e=r.geometry,r.geometry=i}}}function Hu(t,e,i){let r=e?.clone(),a=Xe(i.origin),o=null,s=null;return{undo:()=>{o=t.transform?.clone(),s=Xe(i.origin),t.transform=r,t.vertexSpace.origin=a},redo:()=>{r=t.transform?.clone(),a=Xe(i.origin),t.transform=o,t.vertexSpace.origin=s}}}function Fu(t){let e,i=t.vertexAttributes.clonePositional();return{undo:()=>{e=t.vertexAttributes.clonePositional(),t.vertexAttributes=i},redo:()=>{i=t.vertexAttributes.clonePositional(),t.vertexAttributes=e}}}var Bn=Symbol(),Ai=class extends te.EventedAccessor{get operations(){return this._operations}get updating(){return this._updatingHandles.updating}get elevationInfo(){return ql(this.graphic)}get visible(){return this._graphicState.displaying}get isDraped(){return this._graphicState.isDraped}get origin(){return bh(this.view,this.graphic)}constructor(t){super(t),this._updatingHandles=new ri}destroy(){this._operations=k(this._operations),this._updatingHandles.destroy()}initialize(){this._graphicState=new jt({graphic:this.graphic}),this._graphicState.on("changed",()=>this.emit("committed")),this.addHandles(this.view.trackGraphicState(this._graphicState)),this.addHandles(this._updatingHandles.add(()=>this.graphic.geometry,t=>{let e=this._operations?.data.geometry;if(t!==e){if(!t||t?.type==="multipoint"||t?.type==="extent")return k(this._operations),this.removeHandles(Bn),void(this._operations=null);if(this._operations?.trySetGeometry(t))this.emit("modified-externally");else{k(this._operations),this.removeHandles(Bn);let i=mr.fromGeometry(t,this.view.state.viewingMode);this._operations=i,this.addHandles(i.data.on("change",()=>this.graphic.geometry=i.data.geometry),Bn)}}},I))}createManipulator(t){return new Xc(b({view:this.view,graphic:this.graphic},t))}maskOccludee(){return this.view.maskOccludee(this.graphic)}endInteraction(){this.graphic.geometry?.type==="mesh"&&this.graphic.notifyMeshTransformChanged({action:Jr.UpdateFastLocalOrigin})}toMap(t){return this.view.toMap(t,{include:[this.graphic]})}createUndoRecord(){let{graphic:{geometry:t}}=this;return sd(t)}};c([h({constructOnly:!0})],Ai.prototype,"view",void 0),c([h({constructOnly:!0})],Ai.prototype,"graphic",void 0),c([h()],Ai.prototype,"_operations",void 0),c([h()],Ai.prototype,"operations",null),c([h()],Ai.prototype,"updating",null),Ai=c([E("esri.views.3d.interactive.editingTools.ManipulatedObject3DGraphic")],Ai);export{Ji as DrawGraphicTool3D,Pe as ExtentTransformTool,Ai as ManipulatedObject3DGraphic,We as MoveTool3D,he as ReshapeTool3D,Fe as TransformTool3D};
