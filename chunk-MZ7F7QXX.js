import{a as D,b as H,c as Q}from"./chunk-QNCJ4TWX.js";import{a as _}from"./chunk-RVDKVZJB.js";import"./chunk-4ZAUVUMT.js";import"./chunk-ZOL2XRTU.js";import"./chunk-ZISGARXA.js";import"./chunk-7IBFEZ3C.js";import"./chunk-7EQBH2NW.js";import"./chunk-CPR27CS2.js";import"./chunk-DDZ3KR2Q.js";import"./chunk-YYR2JD3H.js";import"./chunk-GFEKSNS7.js";import"./chunk-UDAVCKBV.js";import"./chunk-7QY3BMVN.js";import"./chunk-BGI2WQLI.js";import"./chunk-Z33JZO3Q.js";import{a as X}from"./chunk-DK6J4FRV.js";import"./chunk-4Y7EKSO4.js";import{a as $}from"./chunk-XVXRQZ3E.js";import{a as T}from"./chunk-Z6LOQ73Z.js";import"./chunk-VLQOBYCU.js";import"./chunk-DJ47AFVJ.js";import"./chunk-6EWOYGD5.js";import"./chunk-SGQDWWIB.js";import"./chunk-WERKLYA3.js";import{a as C}from"./chunk-FDMAP7C3.js";import{a as V}from"./chunk-NSTNSNXJ.js";import{a as B}from"./chunk-FEVELSXH.js";import"./chunk-NSRU3MRX.js";import"./chunk-NJFASAXZ.js";import{a as z}from"./chunk-NHAXDXHR.js";import"./chunk-MP434LRL.js";import"./chunk-KXDUJJUF.js";import{a as G}from"./chunk-FTVSSLGC.js";import"./chunk-QPOMWSFR.js";import"./chunk-2MVYKHX3.js";import"./chunk-7DPBVZFZ.js";import{a as Z}from"./chunk-F4H7OIJK.js";import{a as U}from"./chunk-IM3BGYEV.js";import{a as J}from"./chunk-6QEGDZGH.js";import"./chunk-ZNEMFYSX.js";import"./chunk-ZB2MLS4M.js";import{a as q}from"./chunk-BF4ZL3U3.js";import{a as W}from"./chunk-U3EFYVM2.js";import{a as j}from"./chunk-NEL2DIHD.js";import{f as K}from"./chunk-6MKTTYAV.js";import{a as Y}from"./chunk-LCWKR6WR.js";import"./chunk-MAVOHF7Q.js";import"./chunk-JIO2NKRP.js";import"./chunk-JIFV566L.js";import"./chunk-VAIXCJGK.js";import"./chunk-KKBJ5AEP.js";import"./chunk-MT7CYQIO.js";import"./chunk-C64FPBS5.js";import"./chunk-STCMK6X3.js";import"./chunk-2XAYS5PW.js";import"./chunk-2O2C5MZC.js";import"./chunk-2F3ICBUH.js";import"./chunk-C4OC7UNL.js";import"./chunk-WBNQAM3K.js";import"./chunk-KH5B55IZ.js";import"./chunk-NPQPIZAK.js";import"./chunk-LOEAA5XF.js";import"./chunk-LX5FIKVZ.js";import"./chunk-576BZULE.js";import"./chunk-N7KNO35F.js";import"./chunk-TALIOOAA.js";import"./chunk-6UOVQ25A.js";import"./chunk-BNSYK2BT.js";import"./chunk-DHY7QZ2H.js";import"./chunk-MFP2OFDR.js";import"./chunk-TUJ6FPE6.js";import"./chunk-B7SBOPIK.js";import"./chunk-PDWLAUMH.js";import"./chunk-UVZRJ2I3.js";import"./chunk-SZLPDMBI.js";import{a as k}from"./chunk-65QIQYGA.js";import"./chunk-TLLESPR2.js";import"./chunk-NFADXGWT.js";import"./chunk-FI6XC3PH.js";import"./chunk-I3S324BU.js";import"./chunk-YTC2EJDQ.js";import"./chunk-2UDQ3IWX.js";import"./chunk-YC7IXNOA.js";import"./chunk-MMZZL453.js";import"./chunk-XDMNA7OV.js";import"./chunk-NKZ7R6T6.js";import"./chunk-VHAPMMA5.js";import"./chunk-DR5D3NPO.js";import"./chunk-ERH7ZNSC.js";import"./chunk-GUOR3BIM.js";import"./chunk-WXS2B4FF.js";import"./chunk-XFK3CDZ5.js";import"./chunk-4XBATNKX.js";import"./chunk-3IJY37BG.js";import"./chunk-GNCG2SQP.js";import"./chunk-5HCLBNUR.js";import{a as P}from"./chunk-JEEYT3GD.js";import"./chunk-RMOIVYM4.js";import"./chunk-5JXPUH2D.js";import"./chunk-F4I5LECK.js";import"./chunk-J4PQZSQE.js";import"./chunk-Q3WN5PJ6.js";import"./chunk-UMB6LRQI.js";import"./chunk-AQ74ANSJ.js";import"./chunk-SAOUSUZE.js";import"./chunk-IFPBW5UQ.js";import"./chunk-ZV7ILGPO.js";import"./chunk-6ZT4EXDX.js";import"./chunk-RHHHYJSZ.js";import"./chunk-QBQKFGOZ.js";import"./chunk-K5NHJTKR.js";import"./chunk-XKXYUJUA.js";import"./chunk-F7PIPM6E.js";import"./chunk-FR6Q4MSQ.js";import"./chunk-C6JT6KYF.js";import"./chunk-BCREO4Q5.js";import"./chunk-Z5Q76SB7.js";import"./chunk-E5R4OI7X.js";import"./chunk-6FWNINU2.js";import"./chunk-ES7AH7WX.js";import"./chunk-RSDQHAJX.js";import"./chunk-NYONONNN.js";import"./chunk-MZFPLWMN.js";import{d as w}from"./chunk-DS2JVXBM.js";import"./chunk-G3LLBABP.js";import"./chunk-T4B3RN6B.js";import"./chunk-MXADXAOS.js";import"./chunk-RJHITHLB.js";import"./chunk-5TVEQGKJ.js";import"./chunk-U4U366GW.js";import"./chunk-JTJ3UVF7.js";import"./chunk-R4TNLPIN.js";import"./chunk-5HLV7XP5.js";import"./chunk-BENVXA3L.js";import{a as F,t as N}from"./chunk-UI76XBLJ.js";import{a as R}from"./chunk-UE2YGKE7.js";import{p as A}from"./chunk-BE76S5KT.js";import"./chunk-3RDV3O6N.js";import"./chunk-D2ITYHSM.js";import"./chunk-FIITBHDP.js";import"./chunk-VSVNPPHQ.js";import{_ as b}from"./chunk-CTGIUUCS.js";import{F as o,j as v,l as I}from"./chunk-VWEBO6QK.js";import{I as M,S as L}from"./chunk-KAAR5ZJN.js";import{a as i}from"./chunk-W3WDPWBE.js";import{k as O,p as E}from"./chunk-WKT5W7KT.js";import"./chunk-MLSR6YE6.js";import"./chunk-JPDAKIWT.js";import"./chunk-VU5W7W6Y.js";import{r as x}from"./chunk-X3IDZTNG.js";import"./chunk-IQJU4QT3.js";import{a as l,b as d,h}from"./chunk-EAH6BNBL.js";var r=class extends J(z(q(Q(D(B(W(Z(j(U(V(G(Y)))))))))))){constructor(...e){super(...e),this.dateFieldsTimeZone=null,this.datesInUnknownTimezone=!1,this.dpi=96,this.gdbVersion=null,this.imageFormat="png24",this.imageMaxHeight=2048,this.imageMaxWidth=2048,this.imageTransparency=!0,this.isReference=null,this.labelsVisible=!1,this.operationalLayerType="ArcGISMapServiceLayer",this.preferredTimeZone=null,this.sourceJSON=null,this.sublayers=null,this.type="map-image",this.url=null}normalizeCtorArgs(e,t){return typeof e=="string"?l({url:e},t):e}load(e){let t=e!=null?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Map Service"]},e).catch(O).then(()=>this._fetchService(t))),Promise.resolve(this)}readImageFormat(e,t){let m=t.supportedImageFormatTypes;return m&&m.includes("PNG32")?"png32":"png24"}writeSublayers(e,t,m,a){if(!this.loaded||!e)return;let p=e.slice().reverse().flatten(({sublayers:n})=>n&&n.toArray().reverse()).toArray(),s=!1;if(this.capabilities?.operations.supportsExportMap&&this.capabilities?.exportMap?.supportsDynamicLayers){let n=I(a.origin);if(n===v.PORTAL_ITEM){let y=this.createSublayersForOrigin("service").sublayers;s=T(p,y,v.SERVICE)}else if(n>v.PORTAL_ITEM){let y=this.createSublayersForOrigin("portal-item");s=T(p,y.sublayers,I(y.origin))}}let c=[],u=l({writeSublayerStructure:s},a),f=s;p.forEach(n=>{let y=n.write({},u);c.push(y),f=f||n.originOf("visible")==="user"}),c.some(n=>Object.keys(n).length>1)&&(t.layers=c),f&&(t.visibleLayers=p.filter(n=>n.visible).map(n=>n.id))}createExportImageParameters(e,t,m,a){let p=a?.pixelRatio||1;e&&this.version>=10&&(e=e.clone().shiftCentralMeridian());let s=new X({layer:this,floors:a?.floors,scale:$({extent:e,width:t})*p}),c=s.toJSON();s.destroy();let u=!a?.rotation||this.version<10.3?{}:{rotation:-a.rotation},f=e?.spatialReference,n=A(f);c.dpi*=p;let y={};if(a?.timeExtent){let{start:g,end:S}=a.timeExtent.toJSON();y.time=g&&S&&g===S?""+g:`${g??"null"},${S??"null"}`}else this.timeInfo&&!this.timeInfo.hasLiveData&&(y.time="null,null");return l(l(l({bbox:e&&e.xmin+","+e.ymin+","+e.xmax+","+e.ymax,bboxSR:n,imageSR:n,size:t+","+m},c),u),y)}fetchImage(e,t,m,a){return h(this,null,function*(){let{data:p}=yield this._fetchImage("image",e,t,m,a);return p})}fetchImageBitmap(e,t,m,a){return h(this,null,function*(){let{data:p,url:s}=yield this._fetchImage("blob",e,t,m,a);return _(p,s,a?.signal)})}fetchRecomputedExtents(){return h(this,arguments,function*(e={}){let t=d(l({},e),{query:d(l({returnUpdates:!0,f:"json"},this.customParameters),{token:this.apiKey})}),{data:m}=yield b(this.url,t),{extent:a,fullExtent:p,timeExtent:s}=m,c=a||p;return{fullExtent:c&&N.fromJSON(c),timeExtent:s&&k.fromJSON({start:s[0],end:s[1]})}})}loadAll(){return P(this,e=>{e(this.allSublayers)})}serviceSupportsSpatialReference(e){return C(this,e)}_fetchImage(e,t,m,a,p){return h(this,null,function*(){let s={responseType:e,signal:p?.signal??null,query:d(l(l(d(l(l({},this.parsedUrl.query),this.createExportImageParameters(t,m,a,p)),{f:"image"}),this.refreshParameters),this.customParameters),{token:this.apiKey})},c=this.parsedUrl.path+"/export";if(s.query?.dynamicLayers!=null&&!this.capabilities?.exportMap?.supportsDynamicLayers)throw new x("mapimagelayer:dynamiclayer-not-supported",`service ${this.url} doesn't support dynamic layers, which is required to be able to change the sublayer's order, rendering, labeling or source.`,{query:s.query});try{let{data:u}=yield b(c,s);return{data:u,url:c}}catch(u){throw E(u)?u:new x("mapimagelayer:image-fetch-error",`Unable to load image: ${c}`,{error:u})}})}_fetchService(e){return h(this,null,function*(){if(this.sourceJSON)return void this.read(this.sourceJSON,{origin:"service",url:this.parsedUrl});let{data:t,ssl:m}=yield b(this.parsedUrl.path,{query:d(l(l({f:"json"},this.parsedUrl.query),this.customParameters),{token:this.apiKey}),signal:e});m&&(this.url=this.url.replace(/^http:/i,"https:")),this.sourceJSON=t,this.read(t,{origin:"service",url:this.parsedUrl})})}};i([o(w("dateFieldsTimeReference"))],r.prototype,"dateFieldsTimeZone",void 0),i([o({type:Boolean})],r.prototype,"datesInUnknownTimezone",void 0),i([o()],r.prototype,"dpi",void 0),i([o()],r.prototype,"gdbVersion",void 0),i([o()],r.prototype,"imageFormat",void 0),i([F("imageFormat",["supportedImageFormatTypes"])],r.prototype,"readImageFormat",null),i([o({json:{origins:{service:{read:{source:"maxImageHeight"}}}}})],r.prototype,"imageMaxHeight",void 0),i([o({json:{origins:{service:{read:{source:"maxImageWidth"}}}}})],r.prototype,"imageMaxWidth",void 0),i([o()],r.prototype,"imageTransparency",void 0),i([o({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],r.prototype,"isReference",void 0),i([o({json:{read:!1,write:!1}})],r.prototype,"labelsVisible",void 0),i([o({type:["ArcGISMapServiceLayer"]})],r.prototype,"operationalLayerType",void 0),i([o({json:{read:!1,write:!1}})],r.prototype,"popupEnabled",void 0),i([o(w("preferredTimeReference"))],r.prototype,"preferredTimeZone",void 0),i([o()],r.prototype,"sourceJSON",void 0),i([o({json:{write:{ignoreOrigin:!0}}})],r.prototype,"sublayers",void 0),i([R("sublayers",{layers:{type:[H]},visibleLayers:{type:[M]}})],r.prototype,"writeSublayers",null),i([o({type:["show","hide","hide-children"]})],r.prototype,"listMode",void 0),i([o({json:{read:!1},readOnly:!0,value:"map-image"})],r.prototype,"type",void 0),i([o(K)],r.prototype,"url",void 0),r=i([L("esri.layers.MapImageLayer")],r);var qe=r;export{qe as default};
