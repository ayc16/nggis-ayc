import{a as E}from"./chunk-ORM3VHG6.js";import{a as M}from"./chunk-HTWD7KCG.js";import{d}from"./chunk-BENVXA3L.js";import{z as V}from"./chunk-AUTL5LCV.js";import{h as O}from"./chunk-MLSR6YE6.js";import{h as D,i as v,t as T}from"./chunk-HQMV3KQV.js";import{a as g,b as F,h as r}from"./chunk-EAH6BNBL.js";function B(e){return typeof e=="number"}function f(e){return typeof e=="string"||e instanceof String}var J="yyyy-MM-dd",q="TT",o;(function(e){e.HM="HH:mm",e.HMS="HH:mm:ss",e.HMS_MS="HH:mm:ss.SSS"})(o||(o={}));var W=[o.HMS_MS,o.HMS,o.HM,q];function I(e){if(!e||!f(e))return null;let n=d.fromFormat(e,J);return n.isValid?n:null}function b(e){return e&&f(e)?O(W,n=>{let t=d.fromFormat(e,n);return t.isValid?t:null})??null:null}function x(e){if(!e||!f(e))return null;let n=d.fromISO(e);return n.isValid?n:null}var s;(function(e){e.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",e.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(s||(s={}));var Y=new Set(["integer","small-integer","big-integer","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"]);function K(e){return e!=null&&Y.has(e.type)}function N(e){return e!=null&&(e.type==="date-only"||e.type==="esriFieldTypeDateOnly")}function A(e){return e!=null&&(e.type==="timestamp-offset"||e.type==="esriFieldTypeTimestampOffset")}function _(e){return e!=null&&(e.type==="time-only"||e.type==="esriFieldTypeTimeOnly")}function L(e,n,t){let i=t??e?.domain;if(!i)return null;switch(i.type){case"range":{let{min:a,max:l}=R(e,t);if(a!=null&&+n<a||l!=null&&+n>l)return s.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(i.codedValues==null||i.codedValues.every(a=>a==null||a.code!==n))return s.INVALID_CODED_VALUE}return null}function R(e,n){let t=n??e?.domain;if(!t||t.type!=="range")return;let i="range"in t?t.range[0]:t.minValue,a="range"in t?t.range[1]:t.maxValue,l=K(e);return N(e)||_(e)||A(e)?F(g({},Q(e,a,i)),{isInteger:l}):{min:i!=null&&typeof i=="number"?i:null,max:a!=null&&typeof a=="number"?a:null,rawMin:i,rawMax:a,isInteger:l}}function Q(e,n,t){return N(e)?{min:I(t)?.toMillis(),max:I(n)?.toMillis(),rawMin:t,rawMax:n}:_(e)?{min:b(t)?.toMillis(),max:b(n)?.toMillis(),rawMin:t,rawMax:n}:A(e)?{min:x(t)?.toMillis(),max:x(n)?.toMillis(),rawMin:t,rawMax:n}:{max:null,min:null}}var ee=/^([0-9_])/,ne=/[^a-z0-9_\u0080-\uffff]+/gi;function fn(e){return e==null?null:e.trim().replaceAll(ne,"_").replace(ee,"F$1")||null}var te=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],ie=["field","normalizationField"];function cn(e,n){if(e!=null&&n!=null){for(let t of Array.isArray(e)?e:[e])if(C(te,t,n),"visualVariables"in t&&t.visualVariables)for(let i of t.visualVariables)C(ie,i,n)}}function C(e,n,t){if(e)for(let i of e){let a=D(i,n),l=a&&typeof a!="function"&&t.get(a);l&&v(i,l.name,n)}}function mn(e,n){if(e!=null&&n?.fields?.length)if("startField"in e){let t=n.get(e.startField),i=n.get(e.endField);e.startField=t?.name??null,e.endField=i?.name??null}else{let t=n.get(e.startTimeField),i=n.get(e.endTimeField);e.startTimeField=t?.name??null,e.endTimeField=i?.name??null}}var w=new Set;function h(e,n){return e&&n?(w.clear(),c(w,e,n),Array.from(w).sort()):[]}function c(e,n,t){if(t)if(n?.fields?.length)if(t.includes("*"))for(let{name:i}of n.fields)e.add(i);else for(let i of t)y(e,n,i);else{if(t.includes("*"))return e.clear(),void e.add("*");for(let i of t)i!=null&&e.add(i)}}function y(e,n,t){if(typeof t=="string")if(n){let i=n.get(t);i&&e.add(i.name)}else e.add(t)}function pn(e,n){return n==null||e==null?[]:n.includes("*")?(e.fields??[]).map(t=>t.name):n}function yn(e,n,t=1){if(!n||!e)return[];if(n.includes("*"))return["*"];let i=h(e,n);return i.length/e.fields.length>=t?["*"]:i}function u(e,n,t){return r(this,null,function*(){if(!t)return;let{arcadeUtils:i}=yield M(),a=i.extractFieldNames(t,n?.fields?.map(l=>l.name));for(let l of a)y(e,n,l)})}function $(e,n,t){return r(this,null,function*(){if(t&&t!=="1=1"){let i=yield E(t,n);if(!i.isStandardized)throw new T("fieldUtils:collectFilterFields","Where clause is not standardized",{where:t});c(e,n,i.fieldNames)}})}function gn({displayField:e,fields:n}){return e||(n?.length?S(n,"name-or-title")||S(n,"unique-identifier")||S(n,"type-or-category")||ae(n):null)}function ae(e){for(let n of e){if(!n?.name)continue;let t=n.name.toLowerCase();if(t.includes("name")||t.includes("title"))return n.name}return null}function S(e,n){for(let t of e)if(t?.valueType&&t.valueType===n)return t.name;return null}function Fn(e,n){return r(this,null,function*(){if(!n)return;let t=n.elevationInfo?.featureExpressionInfo;return t?t.collectRequiredFields(e,n.fieldsIndex):void 0})}function le(e,n,t){t.onStatisticExpression?u(e,n,t.onStatisticExpression.expression):e.add(t.onStatisticField)}function Tn(e,n,t){return r(this,null,function*(){if(!n||!t||!("fields"in t))return;let i=[],a=t.popupTemplate;i.push(re(e,n,a)),t.fields&&i.push(...t.fields.map(l=>r(this,null,function*(){return le(e,n.fieldsIndex,l)}))),yield Promise.all(i)})}function re(e,n,t){return r(this,null,function*(){let i=[];t?.expressionInfos&&i.push(...t.expressionInfos.map(l=>u(e,n.fieldsIndex,l.expression)));let a=t?.content;if(Array.isArray(a))for(let l of a)l.type==="expression"&&l.expressionInfo&&i.push(u(e,n.fieldsIndex,l.expressionInfo.expression));yield Promise.all(i)})}function In(e,n,t){return r(this,null,function*(){n&&(n.timeInfo&&t?.timeExtent&&c(e,n.fieldsIndex,[n.timeInfo.startField,n.timeInfo.endField]),n.floorInfo&&c(e,n.fieldsIndex,[n.floorInfo.floorField]),t?.where!=null&&(yield $(e,n.fieldsIndex,t.where)))})}function bn(e,n,t){return r(this,null,function*(){n&&t&&(yield Promise.all(t.map(i=>se(e,n,i))))})}function se(e,n,t){return r(this,null,function*(){n&&t&&(t.valueExpression?yield u(e,n.fieldsIndex,t.valueExpression):t.field&&y(e,n.fieldsIndex,t.field))})}function xn(e){return e?h(e.fieldsIndex,U(e)):[]}function oe(e){if(!e)return[];let n=e.geometryFieldsInfo;return n?h(e.fieldsIndex,[n.shapeAreaField,n.shapeLengthField]):[]}var ue=new Set(["oid","global-id","guid"]),de=new Set(["oid","global-id"]),fe=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^shape$/i,/^shape_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/perimeter/i,/objectid/i,/_i$/i];function ce(e){let n=new Set;k(e).forEach(i=>n.add(i)),oe(e).forEach(i=>n.add(i.toLowerCase()));let t=e&&"infoFor3D"in e?e.infoFor3D:void 0;return t&&(Object.values(t.assetMapFieldRoles).forEach(i=>n.add(i.toLowerCase())),Object.values(t.transformFieldRoles).forEach(i=>n.add(i.toLowerCase()))),Array.from(n)}function U(e){if(!e)return[];let n="editFieldsInfo"in e&&e.editFieldsInfo;if(!n)return[];let{creationDateField:t,creatorField:i,editDateField:a,editorField:l}=n;return[t,i,a,l].filter(Boolean)}function k(e){return U(e).map(n=>n.toLowerCase())}function wn(e,n){return e.editable&&!ue.has(e.type)&&!k(n).includes(e.name?.toLowerCase()??"")}function Sn(e,n){let t=e.name?.toLowerCase()??"";return!(n?.objectIdField!=null&&t===n.objectIdField.toLowerCase()||n?.globalIdField!=null&&t===n.globalIdField.toLowerCase()||ce(n).includes(t)||de.has(e.type)||fe.some(i=>i.test(t)))}function hn(e,n){return r(this,null,function*(){let{labelingInfo:t,fieldsIndex:i}=n;t?.length&&(yield Promise.all(t.map(a=>me(e,i,a))))})}function me(e,n,t){return r(this,null,function*(){if(!t)return;let i=t.getLabelExpression(),a=t.where;if(i.type==="arcade")yield u(e,n,i.expression);else{let l=i.expression.match(/{[^}]*}/g);l&&l.forEach(X=>{y(e,n,X.slice(1,-1))})}yield $(e,n,a)})}function Dn(e){let n=e.defaultValue;return n!==void 0&&G(e,n)?n:e.nullable?null:void 0}function vn(e){let n=typeof e=="string"?{type:e}:e;return he(n)?255:n.type==="esriFieldTypeDate"||n.type==="date"?8:void 0}function z(e){return typeof e=="number"&&!isNaN(e)&&isFinite(e)}function pe(e){return e===null||z(e)}function ye(e){return e===null||Number.isInteger(e)}function H(e){return e!=null&&typeof e=="string"}function ge(e){return e===null||H(e)}function Fe(){return!0}function G(e,n){let t;switch(e.type){case"date":case"integer":case"long":case"small-integer":case"big-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":case"esriFieldTypeBigInteger":t=e.nullable?ye:Number.isInteger;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":t=e.nullable?pe:z;break;case"string":case"esriFieldTypeString":t=e.nullable?ge:H;break;default:t=Fe}return arguments.length===1?t:t(n)}var Z=["integer","small-integer","big-integer"],j=["single","double"],On=[...Z,...j],Te=["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"],Ie=["esriFieldTypeSingle","esriFieldTypeDouble"],be=new Set([...Z,...Te]),xe=new Set([...j,...Ie]),we=V(be,xe);function Se(e){return e!=null&&we.has(e.type)}function he(e){return e!=null&&(e.type==="string"||e.type==="esriFieldTypeString")}function Vn(e){return e!=null&&(e.type==="date"||e.type==="esriFieldTypeDate")}function En(e){return e!=null&&(e.type==="date-only"||e.type==="esriFieldTypeDateOnly")}function Mn(e){return e!=null&&(e.type==="timestamp-offset"||e.type==="esriFieldTypeTimestampOffset")}function Nn(e){return e!=null&&(e.type==="time-only"||e.type==="esriFieldTypeTimeOnly")}function An(e){return e!=null&&(e.type==="oid"||e.type==="esriFieldTypeOID")}function _n(e){return e!=null&&(e.type==="global-id"||e.type==="esriFieldTypeGlobalID")}function Ln(e,n){return De(e,n)===null}var m,p;function Rn(e){return e==null||typeof e=="number"&&isNaN(e)?null:e}function De(e,n){return e==null||e.nullable&&n===null?null:Se(e)&&!ve(e.type,Number(n))?m.OUT_OF_RANGE:G(e,n)?e.domain?L(e,n):null:p.INVALID_TYPE}function ve(e,n){let t=typeof e=="string"?P(e):e;if(!t)return!1;let i=t.min,a=t.max;return t.isInteger?Number.isInteger(n)&&n>=i&&n<=a:n>=i&&n<=a}function P(e){switch(e){case"esriFieldTypeSmallInteger":case"small-integer":return Oe;case"esriFieldTypeInteger":case"integer":return Ve;case"esriFieldTypeBigInteger":case"big-integer":return Ee;case"esriFieldTypeSingle":case"single":return Me;case"esriFieldTypeDouble":case"double":return Ne}}(function(e){e.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(m||(m={})),function(e){e.INVALID_TYPE="type-validation-error::invalid-type"}(p||(p={}));var Oe={min:-32768,max:32767,isInteger:!0,rawMin:-32768,rawMax:32767},Ve={min:-2147483648,max:2147483647,isInteger:!0,rawMin:-2147483648,rawMax:2147483647},Ee={min:-Number.MAX_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,isInteger:!0,rawMin:-Number.MAX_SAFE_INTEGER,rawMax:Number.MAX_SAFE_INTEGER},Me={min:-34e37,max:12e37,isInteger:!1,rawMin:-34e37,rawMax:12e37},Ne={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1,rawMin:-Number.MAX_VALUE,rawMax:Number.MAX_VALUE};function Cn(e,n,t){switch(e){case s.INVALID_CODED_VALUE:return`Value ${t} is not in the coded domain - field: ${n.name}, domain: ${JSON.stringify(n.domain)}`;case s.VALUE_OUT_OF_RANGE:return`Value ${t} is out of the range of valid values - field: ${n.name}, domain: ${JSON.stringify(n.domain)}`;case p.INVALID_TYPE:return`Value ${t} is not a valid value for the field type - field: ${n.name}, type: ${n.type}, nullable: ${n.nullable}`;case m.OUT_OF_RANGE:{let{min:i,max:a}=P(n.type);return`Value ${t} is out of range for the number type - field: ${n.name}, type: ${n.type}, value range is ${i} to ${a}`}}}function $n(e,n){return!Ae(e,n,null)}function Ae(e,n,t){if(!n?.attributes||!e){if(t!=null)for(let l of e??[])t.add(l);return!0}let i=new Set(Object.keys(n.attributes)),a=!1;for(let l of e)if(!i.has(l)){if(a=!0,t==null)break;t.add(l)}return a}function Un(e){return!!e&&["raster.itempixelvalue","raster.servicepixelvalue"].some(n=>e.toLowerCase().startsWith(n))}function kn(e){let n=e?.match(/{[^}]+}/g);return n?n.map(t=>t.slice(1,-1).split(":")[0].trim()):[]}export{B as a,R as b,fn as c,cn as d,mn as e,h as f,c as g,y as h,pn as i,yn as j,u as k,gn as l,Fn as m,Tn as n,In as o,bn as p,xn as q,wn as r,Sn as s,hn as t,Dn as u,vn as v,Se as w,he as x,Vn as y,En as z,Mn as A,Nn as B,An as C,_n as D,Ln as E,Rn as F,De as G,Cn as H,$n as I,Un as J,kn as K};
