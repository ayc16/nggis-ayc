import{a as te}from"./chunk-A7GL2RI2.js";import"./chunk-JQFP5YCE.js";import"./chunk-ZOL2XRTU.js";import"./chunk-ZISGARXA.js";import"./chunk-YINO7Z5Z.js";import"./chunk-F7N72PQ7.js";import"./chunk-XBGVI2JJ.js";import"./chunk-7EQBH2NW.js";import{a as se}from"./chunk-7R3J7GYS.js";import"./chunk-CPR27CS2.js";import"./chunk-DDZ3KR2Q.js";import"./chunk-YYR2JD3H.js";import"./chunk-GFEKSNS7.js";import{a as M}from"./chunk-A77UUT27.js";import"./chunk-HHJJPMV6.js";import"./chunk-UDAVCKBV.js";import"./chunk-7QY3BMVN.js";import"./chunk-BGI2WQLI.js";import"./chunk-Z33JZO3Q.js";import"./chunk-C4XQ3IUU.js";import"./chunk-T2INZTCD.js";import"./chunk-H34WFTDW.js";import{f as V}from"./chunk-KOW2YKW3.js";import"./chunk-OR5TQLC2.js";import{a as z}from"./chunk-P3DBVG4K.js";import{a as H}from"./chunk-A3QOQ5KT.js";import{a as D}from"./chunk-YUUJN5G2.js";import"./chunk-3SDF35T4.js";import{a as k}from"./chunk-UHY7OSK2.js";import"./chunk-SGQDWWIB.js";import"./chunk-WERKLYA3.js";import{a as $}from"./chunk-FDMAP7C3.js";import"./chunk-XPKJ6EMR.js";import{a as N}from"./chunk-NSTNSNXJ.js";import{a as A}from"./chunk-FEVELSXH.js";import{a as Y}from"./chunk-NRFGADTQ.js";import{a as Z}from"./chunk-5UPCWP56.js";import{a as K}from"./chunk-B4WKB6RS.js";import{a as X}from"./chunk-KYPXGO7D.js";import"./chunk-MP434LRL.js";import{a as ee}from"./chunk-Q5WO5FYM.js";import{a as G}from"./chunk-FTVSSLGC.js";import{b as J}from"./chunk-7BH5HWH4.js";import"./chunk-TBR6RMWR.js";import"./chunk-OE7FZA67.js";import{a as W}from"./chunk-N7XJSFDL.js";import{a as E}from"./chunk-Q4SUOLOJ.js";import{a as c}from"./chunk-6QEGDZGH.js";import"./chunk-ZNEMFYSX.js";import"./chunk-ZB2MLS4M.js";import{a as f}from"./chunk-BF4ZL3U3.js";import{a as ae}from"./chunk-CFQXRJP4.js";import{a as u}from"./chunk-NEL2DIHD.js";import{d as re,e as oe,g as ie,j as L}from"./chunk-IFW7DQNN.js";import{a as y}from"./chunk-GUM5P5S3.js";import"./chunk-MAVOHF7Q.js";import"./chunk-JIO2NKRP.js";import"./chunk-JIFV566L.js";import"./chunk-VAIXCJGK.js";import"./chunk-V36WZPMJ.js";import{s as U}from"./chunk-DYDXLXQM.js";import"./chunk-KKBJ5AEP.js";import"./chunk-5CFTTUH7.js";import"./chunk-BLPOW374.js";import"./chunk-STCMK6X3.js";import"./chunk-2XAYS5PW.js";import"./chunk-2O2C5MZC.js";import"./chunk-2F3ICBUH.js";import"./chunk-FXKKVZVX.js";import"./chunk-YEFYLX2H.js";import"./chunk-DMNYUKK6.js";import"./chunk-FEPWAAH4.js";import"./chunk-LOEAA5XF.js";import"./chunk-KBOF5WGE.js";import"./chunk-RNDCFWL7.js";import"./chunk-X6FZ7Z76.js";import{n as Q}from"./chunk-5RW6D2ZS.js";import"./chunk-N7KNO35F.js";import"./chunk-53X2B37Z.js";import"./chunk-6UOVQ25A.js";import"./chunk-BNSYK2BT.js";import"./chunk-DHY7QZ2H.js";import"./chunk-MFP2OFDR.js";import"./chunk-TUJ6FPE6.js";import"./chunk-KMJL237I.js";import"./chunk-PDWLAUMH.js";import{d as h}from"./chunk-UVZRJ2I3.js";import"./chunk-SZLPDMBI.js";import"./chunk-65QIQYGA.js";import"./chunk-TLLESPR2.js";import"./chunk-NFADXGWT.js";import"./chunk-FI6XC3PH.js";import"./chunk-I3S324BU.js";import"./chunk-YTC2EJDQ.js";import"./chunk-2UDQ3IWX.js";import{c as q}from"./chunk-YC7IXNOA.js";import"./chunk-KVRBCQMQ.js";import"./chunk-XDMNA7OV.js";import"./chunk-NKZ7R6T6.js";import"./chunk-VHAPMMA5.js";import"./chunk-DR5D3NPO.js";import"./chunk-ERH7ZNSC.js";import"./chunk-GUOR3BIM.js";import{a as B}from"./chunk-WXS2B4FF.js";import"./chunk-XFK3CDZ5.js";import"./chunk-4XBATNKX.js";import"./chunk-3IJY37BG.js";import"./chunk-V2KSICSA.js";import"./chunk-GNCG2SQP.js";import"./chunk-5HCLBNUR.js";import"./chunk-RMOIVYM4.js";import"./chunk-5JXPUH2D.js";import"./chunk-F4I5LECK.js";import"./chunk-J4PQZSQE.js";import"./chunk-KYP6LPQU.js";import"./chunk-UMB6LRQI.js";import"./chunk-AQ74ANSJ.js";import"./chunk-SAOUSUZE.js";import"./chunk-IFPBW5UQ.js";import"./chunk-ZV7ILGPO.js";import"./chunk-6ZT4EXDX.js";import"./chunk-RHHHYJSZ.js";import"./chunk-QBQKFGOZ.js";import"./chunk-K5NHJTKR.js";import"./chunk-XKXYUJUA.js";import"./chunk-F7PIPM6E.js";import"./chunk-FR6Q4MSQ.js";import"./chunk-C6JT6KYF.js";import"./chunk-BCREO4Q5.js";import"./chunk-Z5Q76SB7.js";import"./chunk-E5R4OI7X.js";import"./chunk-6FWNINU2.js";import"./chunk-ES7AH7WX.js";import"./chunk-RSDQHAJX.js";import"./chunk-NYONONNN.js";import"./chunk-MZFPLWMN.js";import"./chunk-DS2JVXBM.js";import{b as v}from"./chunk-G3LLBABP.js";import"./chunk-T4B3RN6B.js";import"./chunk-MXADXAOS.js";import"./chunk-RJHITHLB.js";import{a as C}from"./chunk-IZZ2BWJH.js";import{c as pe}from"./chunk-CGTLZX6D.js";import"./chunk-JTJ3UVF7.js";import"./chunk-R4TNLPIN.js";import"./chunk-5HLV7XP5.js";import"./chunk-BENVXA3L.js";import"./chunk-UI76XBLJ.js";import"./chunk-UE2YGKE7.js";import"./chunk-BE76S5KT.js";import"./chunk-3RDV3O6N.js";import"./chunk-D2ITYHSM.js";import"./chunk-FIITBHDP.js";import"./chunk-VSVNPPHQ.js";import{_ as P,g as O,s as R}from"./chunk-CTGIUUCS.js";import{F as i}from"./chunk-VWEBO6QK.js";import{S as d,u as j}from"./chunk-KAAR5ZJN.js";import{a as o}from"./chunk-W3WDPWBE.js";import{a as F,k as T}from"./chunk-WKT5W7KT.js";import"./chunk-MLSR6YE6.js";import"./chunk-JPDAKIWT.js";import"./chunk-VU5W7W6Y.js";import{p as x,r as _}from"./chunk-X3IDZTNG.js";import"./chunk-IQJU4QT3.js";import{a as I,b as w,h as m}from"./chunk-EAH6BNBL.js";var S=class{constructor(t,r){this.objectId=t,this.itemSource=r,this.count=0,this.layer=null,this.sortValue=void 0}},b=new q(20,e=>e.destroy()),n=class extends f(c(u(y))){constructor(e){super(e),this._oidToReference=new Map,this._layerToReference=new Map,this._portals=new Map,this.layers=new v,this.maximumVisibleSublayers=10,this.opacity=1,this.title="Layers In View",this.type="catalog-dynamic-group",this.visible=!0}load(e){return this.addResolvingPromise(this.parent.load()),Promise.resolve(this)}get _orderBy(){return this.parent.orderBy?.find(e=>!e.valueExpression&&e.field)??new H({field:this.parent.objectIdField})}get _referenceComparator(){let e=this._orderBy,t=this.parent.fieldsIndex.get(e.field),r=V(t?.toJSON().type,e.order==="descending");return(a,l)=>r(a.sortValue,l.sortValue)||a.objectId-a.objectId}acquireLayer(e){let t=e.getObjectId(),r=j(this._oidToReference,t,()=>this._createLayerReference(e));return r.count++,F(()=>{r.count--,r.count||this._disposeLayerReference(r)})}_createLayerReference(e){let t=e.getObjectId(),r=e.getAttribute(this.parent.itemSourceField),a=new S(t,r);if(b.get(r))return this._addLayer(b.pop(r),a,e),a;let l;try{l=JSON.parse(r)}catch(g){return x.getLogger(this).error(g),a}return this._createLayer(l).then(g=>{this.destroyed||a.count===0?(b.get(r)||b.put(a.itemSource,g),a.layer=null):this._addLayer(g,a,e)}).catch(()=>{}),a}_addLayer(e,t,r){this._layerToReference.set(e,t),t.sortValue=r.getAttribute(this._orderBy.field),t.layer=e,e.parent=this,this.layers.add(e),this.layers.sort((a,l)=>this._referenceComparator(this._layerToReference.get(a),this._layerToReference.get(l)))}_disposeLayerReference(e){e.layer&&(this._layerToReference.delete(e.layer),this.layers.remove(e.layer),b.put(e.itemSource,e.layer)),this._oidToReference.delete(e.objectId)}_createLayer(e){return m(this,null,function*(){if(!ye(e))return new(yield se.UnsupportedLayer());let{itemId:t,portalUrl:r}=e,a=j(this._portals,r,()=>new pe({url:r}));return y.fromPortalItem(new C({id:t,portal:a}))})}};o([i()],n.prototype,"_orderBy",null),o([i()],n.prototype,"_referenceComparator",null),o([i({readOnly:!0})],n.prototype,"layers",void 0),o([i()],n.prototype,"maximumVisibleSublayers",void 0),o([i(L)],n.prototype,"opacity",void 0),o([i({type:String,json:{name:"title",write:!0}})],n.prototype,"title",void 0),o([i({json:{read:!1}})],n.prototype,"type",void 0),o([i({type:Boolean,json:{name:"visibility",write:!0}})],n.prototype,"visible",void 0),n=o([d("esri.layers.catalog.CatalogDynamicGroupLayer")],n);var ne=n;function ye(e){return typeof e=="object"&&e!=null&&"itemId"in e&&"portalUrl"in e}var p=class extends f(D(c(u(y)))){constructor(e){super(e),this.labelingInfo=null,this.labelsVisible=!0,this.legendEnabled=!0,this.opacity=1,this.popupEnabled=!0,this.popupTemplate=null,this.renderer=null,this.type="catalog-footprint",this.visible=!0}load(e){return this.addResolvingPromise(this.parent.load()),Promise.resolve(this)}get defaultPopupTemplate(){return this.createPopupTemplate()}get fields(){return this.parent.fields}get fieldsIndex(){return this.parent.fieldsIndex}get geometryType(){return this.parent.geometryType}get objectIdField(){return this.parent.objectIdField}get orderBy(){return this.parent.orderBy}createPopupTemplate(e){let t={fields:this.parent.fields,objectIdField:this.parent.objectIdField,title:this.title};return ee(t,e)}createQuery(){return this.parent.createQuery()}queryFeatures(e,t){return this.parent.queryFeatures(e,t)}};o([i({readOnly:!0})],p.prototype,"defaultPopupTemplate",null),o([i({type:[K],json:{name:"layerDefinition.drawingInfo.labelingInfo",read:Z,write:!0}})],p.prototype,"labelingInfo",void 0),o([i(oe)],p.prototype,"labelsVisible",void 0),o([i(ie)],p.prototype,"legendEnabled",void 0),o([i(L)],p.prototype,"opacity",void 0),o([i(re)],p.prototype,"popupEnabled",void 0),o([i({type:Q,json:{name:"popupInfo",write:!0}})],p.prototype,"popupTemplate",void 0),o([i({types:J,json:{name:"layerDefinition.drawingInfo.renderer"}})],p.prototype,"renderer",void 0),o([i({json:{read:!1}})],p.prototype,"type",void 0),o([i({type:Boolean,json:{name:"visibility",write:!0}})],p.prototype,"visible",void 0),p=o([d("esri.layers.catalog.CatalogFootprintLayer")],p);var le=p;var de="esri.layers.CatalogLayer",me=Y(),s=class extends k(c(z(X(f(E(A(ae(W(u(G(N(B(y))))))))))))){constructor(e){super(e),this.dynamicGroupLayer=new ne({parent:this}),this.fields=null,this.fieldsIndex=null,this.footprintLayer=new le({parent:this}),this.itemSourceField="cd_itemsource",this.itemTypeField="cd_itemtype",this.layers=new v([this.dynamicGroupLayer,this.footprintLayer]),this.source=new te({layer:this}),this.type="catalog"}load(e){let t=e!=null?e.signal:null,r=this.loadFromPortal({supportedTypes:["Feature Service"]},e).catch(T).then(()=>m(this,null,function*(){if(!this.url)throw new _("catalog-layer:missing-url","Catalog layer must be created with a url");if(this.url&&this.layerId==null){let a=yield this._fetchFirstValidLayerId(t);if(a==null)throw new _("catalog-layer:missing-layerId","There is no Catalog Layer in the service",{service:this.url});this.layerId=a}yield this.source.load(),this.source.sourceJSON&&(this.sourceJSON=this.source.sourceJSON,this.read(this.source.sourceJSON,{origin:"service",portalItem:this.portalItem,portal:this.portalItem?.portal,url:this.parsedUrl}))})).then(()=>U(this,"load",e));return this.addResolvingPromise(r),Promise.resolve(this)}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("capabilities"),(this._get("createQueryVersion")??0)+1}get parsedUrl(){let e=O(this.url);return e!=null&&this.layerId!=null&&(e.path=R(e.path,this.layerId.toString())),e}createQuery(){let e=new h,t=this.capabilities?.query;e.returnGeometry=!0,t&&(e.compactGeometryEnabled=t.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=t.supportsDefaultSpatialReference),e.outFields=["*"];let{timeOffset:r,timeExtent:a}=this;return e.timeExtent=r!=null&&a!=null?a.offset(-r.value,r.unit):a||null,e}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,t){return this.fieldsIndex.get(e)?.domain}queryFeatures(e,t){return m(this,null,function*(){let r=yield this.load(),a=yield r.source.queryFeatures(h.from(e)??r.createQuery(),t);if(a?.features)for(let l of a.features)l.layer=l.sourceLayer=r.footprintLayer;return a})}queryObjectIds(e,t){return m(this,null,function*(){return(yield this.load()).source.queryObjectIds(h.from(e)??this.createQuery(),t)})}queryFeatureCount(e,t){return m(this,null,function*(){return(yield this.load()).source.queryFeatureCount(h.from(e)??this.createQuery(),t)})}queryExtent(e,t){return m(this,null,function*(){return(yield this.load()).source.queryExtent(h.from(e)??this.createQuery(),t)})}serviceSupportsSpatialReference(e){return this.loaded&&$(this,e)}read(e,t){super.read(e,t);let r=e.footprintLayer;r||t?.origin!=="service"||(r={layerDefinition:{drawingInfo:M(e.geometryType)}}),this.footprintLayer.read(r,t)}_fetchFirstValidLayerId(e){return P(this.url,{query:w(I({f:"json"},this.customParameters),{token:this.apiKey}),responseType:"json",signal:e}).then(t=>{let r=t.data;if(r)return Array.isArray(r.layers)?r.layers.find(a=>a.type==="Catalog Layer")?.id:void 0})}};o([i({readOnly:!0})],s.prototype,"createQueryVersion",null),o([i(w(I({},me.fields),{json:{origins:{service:{name:"fields"}}}}))],s.prototype,"fields",void 0),o([i(me.fieldsIndex)],s.prototype,"fieldsIndex",void 0),o([i({json:{read:!1,write:!1}})],s.prototype,"footprintLayer",void 0),o([i()],s.prototype,"itemSourceField",void 0),o([i()],s.prototype,"itemTypeField",void 0),o([i()],s.prototype,"layers",void 0),o([i({value:"CatalogLayer",type:["CatalogLayer"]})],s.prototype,"operationalLayerType",void 0),o([i()],s.prototype,"outFields",void 0),o([i({readOnly:!0})],s.prototype,"parsedUrl",null),o([i()],s.prototype,"source",void 0),o([i({json:{read:!1}})],s.prototype,"type",void 0),s=o([d(de)],s);var Dt=s;export{Dt as default};
