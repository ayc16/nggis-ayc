import{j as _}from"./chunk-DL3OPG77.js";import{a as y,d as P,f as v}from"./chunk-RBP2Z7C6.js";import{f as L}from"./chunk-IOCFWX7T.js";import"./chunk-ZRUFSF4E.js";import"./chunk-LAXYP2KV.js";import"./chunk-TIXZ4OWB.js";import"./chunk-NDZXQR2V.js";import"./chunk-W5OI4BJ2.js";import"./chunk-UVJ5D37D.js";import"./chunk-2NH7HOKA.js";import"./chunk-ZAQLF7TN.js";import"./chunk-JFY2XMDP.js";import"./chunk-ZHUHFKYD.js";import"./chunk-I3DWOIS7.js";import{g as j,p as l}from"./chunk-H3VY6XFU.js";import"./chunk-LNYBTIG7.js";import"./chunk-SJTQM4NH.js";import"./chunk-IFFYADB3.js";import"./chunk-PDBA6QOJ.js";import"./chunk-ALWV3RJ2.js";import"./chunk-7C6Z24SS.js";import"./chunk-2ETHV3H2.js";import"./chunk-M2GLXRA2.js";import"./chunk-EBWCXIFH.js";import"./chunk-BCREO4Q5.js";import"./chunk-ZVHU7VE3.js";import"./chunk-76YVRX2R.js";import{d as h,m as f,n as g}from"./chunk-OZF6BMOL.js";import{a as c,b as p}from"./chunk-GJP6PTKT.js";import"./chunk-RSDQHAJX.js";import{S as w}from"./chunk-KUJG22IX.js";import"./chunk-OVHPPCBL.js";import{a as E}from"./chunk-W3WDPWBE.js";import{k as x}from"./chunk-GISCFF3Z.js";import"./chunk-MLSR6YE6.js";import"./chunk-CPDJJRWA.js";import"./chunk-HQMV3KQV.js";import"./chunk-CRMMDK2Z.js";import{h as u}from"./chunk-EAH6BNBL.js";var I=1e3;function S(t,n,o){let s=j(),e=s;return f(e,e,t,.5),f(e,e,n,.5),s[3]=g(e,t),h(e,e,o),s}var b=class{constructor(){this._idToComponent=new Map,this._components=new _(t=>t.bounds),this._edges=new _(t=>t.bounds),this._tmpLineSegment=y(),this._tmpP1=c(),this._tmpP2=c(),this._tmpP3=c(),this.remoteClient=null}fetchCandidates(t,n){return u(this,null,function*(){yield Promise.resolve(),x(n),yield this._ensureEdgeLocations(t,n);let o=[];return this._edges.forEachNeighbor(s=>(this._addCandidates(t,s,o),o.length<I),t.bounds),{result:{candidates:o}}})}_ensureEdgeLocations(t,n){return u(this,null,function*(){let o=[];if(this._components.forEachNeighbor(i=>{if(i.info==null){let{id:a,uid:r}=i;o.push({id:a,uid:r})}return!0},t.bounds),!o.length)return;let s={components:o},e=yield this.remoteClient.invoke("fetchAllEdgeLocations",s,n??{});for(let i of e.components)this._setFetchEdgeLocations(i)})}add(t){return u(this,null,function*(){let n=new A(t.id,t.bounds);return this._idToComponent.set(n.id,n),this._components.add([n]),{result:{}}})}remove(t){return u(this,null,function*(){let n=this._idToComponent.get(t.id);if(n){let o=[];this._edges.forEachNeighbor(s=>(s.component===n&&o.push(s),!0),n.bounds),this._edges.remove(o),this._components.remove([n]),this._idToComponent.delete(n.id)}return{result:{}}})}_setFetchEdgeLocations(t){let n=this._idToComponent.get(t.id);if(n==null||t.uid!==n.uid)return;let o=L.createView(t.locations),s=new Array(o.count),e=c(),i=c();for(let d=0;d<o.count;d++){o.position0.getVec(d,e),o.position1.getVec(d,i);let m=S(e,i,t.origin),T=new C(n,d,m);s[d]=T}this._edges.add(s);let{objectIds:a,origin:r}=t;n.info={locations:o,objectIds:a,origin:r}}_addCandidates(t,n,o){let{info:s}=n.component,{origin:e,objectIds:i}=s,a=s.locations,r=a.position0.getVec(n.index,this._tmpP1),d=a.position1.getVec(n.index,this._tmpP2);h(r,r,e),h(d,d,e);let m=i[a.componentIndex.get(n.index)];this._addEdgeCandidate(t,m,r,d,o),V(t,m,r,o),V(t,m,d,o)}_addEdgeCandidate(t,n,o,s,e){if(!t.returnEdge)return;let i=t.bounds,a=P(o,s,this._tmpLineSegment),r=v(a,i,this._tmpP3);l(t.bounds,r)&&e.push({type:"edge",objectId:n,target:p(r),distance:g(i,r),start:p(o),end:p(s)})}};b=E([w("esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker")],b);var Y=b;function V(t,n,o,s){if(!t.returnVertex||!l(t.bounds,o))return;let e=t.bounds;s.push({type:"vertex",objectId:n,target:p(o),distance:g(e,o)})}var A=(()=>{class t{constructor(o,s){this.id=o,this.bounds=s,this.info=null,this.uid=++t.uid}}return t.uid=0,t})(),C=class{constructor(n,o,s){this.component=n,this.index=o,this.bounds=s}};export{Y as default};
