import{a as Nt}from"./chunk-YNJY3BMZ.js";import{c as v}from"./chunk-TJO74ND6.js";import{c as Zt}from"./chunk-A3KX3DLS.js";import{a as Lt}from"./chunk-G3LBVS5W.js";import{h as Pt}from"./chunk-3VXDWYJU.js";import{g as X,w as zt,x as Rt}from"./chunk-WD4CT5CX.js";import{c as dt}from"./chunk-KDRAUGQW.js";import{a as E,f as It,i as Ft,p as At,t as Y,w as Bt,x as pt,y as I}from"./chunk-QRAERHGP.js";import{a as z}from"./chunk-2EA2KAER.js";import{a as Et,b as G,c as Vt}from"./chunk-J57HR4DB.js";import{b as tt}from"./chunk-GNCG2SQP.js";import{d as Ct,e as Dt}from"./chunk-AQ74ANSJ.js";import{b as x}from"./chunk-6FWNINU2.js";import{a as et,c as xt,j as Tt,l as St,u as it}from"./chunk-ES7AH7WX.js";import{a as bt}from"./chunk-T4B3RN6B.js";import{j as D}from"./chunk-UI76XBLJ.js";import{F as _,I as y}from"./chunk-VWEBO6QK.js";import{S as M}from"./chunk-KAAR5ZJN.js";import{a as u}from"./chunk-W3WDPWBE.js";import{b as $}from"./chunk-MLSR6YE6.js";import{a as L}from"./chunk-IQJU4QT3.js";import{h as U}from"./chunk-EAH6BNBL.js";var Kt={shaders:{vertexShader:v("bitBlit/bitBlit.vert"),fragmentShader:v("bitBlit/bitBlit.frag")},attributes:new Map([["a_pos",0],["a_tex",1]])};var ee={shaders:{vertexShader:v("stencil/stencil.vert"),fragmentShader:v("stencil/stencil.frag")},attributes:new Map([["a_pos",0]])};var oe={shaders:{vertexShader:v("highlight/textured.vert"),fragmentShader:v("highlight/highlight.frag")},attributes:new Map([["a_position",0],["a_texcoord",1]])},ne={shaders:{vertexShader:v("highlight/textured.vert"),fragmentShader:v("highlight/blur.frag")},attributes:new Map([["a_position",0],["a_texcoord",1]])};var T=L("esri-2d-profiler"),kt=class{constructor(t,e){if(this._events=new bt,this._entries=new Map,this._timings=new Lt(10),this._currentContainer=null,this._currentPass=null,this._currentBrush=null,this._currentSummary=null,!T)return;this._ext=Nt(t.gl,{}),this._debugOutput=e;let i=t.gl;if(!this.enableCommandLogging)return;let o;for(o in i)if(typeof i[o]=="function"){let n=i[o],r=o.includes("draw");i[o]=(...m)=>(this._events.emit("command",{container:this._currentContainer,pass:this._currentPass,brush:this._currentBrush,method:o,args:m,isDrawCommand:r}),this._currentSummary&&(this._currentSummary.commands++,r&&this._currentSummary.drawCommands++),n.apply(i,m))}}get enableCommandLogging(){return!(typeof T=="object"&&T.disableCommands)}recordContainerStart(t){T&&(this._currentContainer=t)}recordContainerEnd(){T&&(this._currentContainer=null)}recordPassStart(t){T&&(this._currentPass=t,this._initSummary())}recordPassEnd(){T&&(this._currentPass=null,this._emitSummary())}recordBrushStart(t){T&&(this._currentBrush=t)}recordBrushEnd(){T&&(this._currentBrush=null)}recordStart(t){if(T&&this._ext!=null){if(this._entries.has(t)){let i=this._entries.get(t),o=this._ext.resultAvailable(i.query),n=this._ext.disjoint();if(o&&!n){let r=this._ext.getResult(i.query)/1e6,m=0;if(this._timings.enqueue(r)!=null){let l=this._timings.entries,p=l.length,d=0;for(let c of l)d+=c;m=d/p}let a=r.toFixed(2),h=m?m.toFixed(2):"--";this.enableCommandLogging?(console.groupCollapsed(`Frame report for ${t}, ${a} ms (${h} last 10 avg)
${i.commandsLen} Commands (${i.drawCommands} draw)`),console.log("RenderPass breakdown: "),console.table(i.summaries),console.log("Commands: ",i.commands),console.groupEnd()):console.log(`Frame report for ${t}, ${a} ms (${h} last 10 avg)`),this._debugOutput.innerHTML=`${a} (${h})`}for(let r of i.handles)r.remove();this._ext.deleteQuery(i.query),this._entries.delete(t)}let e={name:t,query:this._ext.createQuery(),commands:[],commandsLen:0,drawCommands:0,summaries:[],handles:[]};this.enableCommandLogging&&(e.handles.push(this._events.on("command",i=>{e.commandsLen++,e.commands.push(i),i.isDrawCommand&&e.drawCommands++})),e.handles.push(this._events.on("summary",i=>{e.summaries.push(i)}))),this._ext.beginTimeElapsed(e.query),this._entries.set(t,e)}}recordEnd(t){T&&this._ext!=null&&this._entries.has(t)&&this._ext.endTimeElapsed()}_initSummary(){this.enableCommandLogging&&(this._currentSummary={container:this._currentContainer,pass:this._currentPass,drawCommands:0,commands:0})}_emitSummary(){this.enableCommandLogging&&this._currentSummary&&this._events.emit("summary",this._currentSummary)}};var S=1,j=0,F=1,A=2,st=class{constructor(t,e,i){this._debugMap=new Map,this._width=t*i,this._height=e*i,this._pixelRatio=i;let o=Math.ceil(this._width/S),n=Math.ceil(this._height/S);this._cols=o,this._rows=n,this._cells=Pt.create(o*n)}insertMetrics(t){this._markMetrics(t)}hasCollision(t){let e=0;for(let{computedX:i,computedY:o,width:n,height:r}of t.bounds){let m=(n+X)*this._pixelRatio,a=(r+X)*this._pixelRatio;switch(this._collide(i,o,m,a)){case A:return A;case F:e++}}return e===t.bounds.length?F:j}getCellId(t,e){return t+e*this._cols}has(t){return this._cells.has(t)}hasRange(t,e){return this._cells.hasRange(t,e)}set(t){this._cells.set(t)}setRange(t,e){this._cells.setRange(t,e)}_collide(t,e,i,o){let n=t-i/2,r=e-o/2,m=n+i,a=r+o;if(m<0||a<0||n>this._width||r>this._height)return F;let h=x(Math.floor(n/S),0,this._cols),l=x(Math.floor(r/S),0,this._rows),p=x(Math.ceil(m/S),0,this._cols),d=x(Math.ceil(a/S),0,this._rows);for(let c=l;c<=d;c++)for(let f=h;f<=p;f++){let g=this.getCellId(f,c);if(this.has(g))return A}return j}_mark(t,e,i,o,n){let r=t-i/2,m=e-o/2,a=r+i,h=m+o,l=x(Math.floor(r/S),0,this._cols),p=x(Math.floor(m/S),0,this._rows),d=x(Math.ceil(a/S),0,this._cols),c=x(Math.ceil(h/S),0,this._rows);for(let f=p;f<=c;f++)for(let g=l;g<=d;g++){let O=this.getCellId(g,f);this._debugMap.set(O,n),this.set(O)}return!1}_markMetrics(t){for(let{computedX:e,computedY:i,width:o,height:n}of t.bounds){let r=(o+X)*this._pixelRatio,m=(n+X)*this._pixelRatio;this._mark(e,i,r,m,t.entityTexel)}}};var H=254,ot=255,Q=0;function B(s,t){let e=s.children.slice();e.sort((i,o)=>i.tileAge-o.tileAge),e.forEach(i=>{i.labelMetrics!=null&&i.isReady&&t(i,i.labelMetrics)})}function qt(s,t){return(!s.minScale||s.minScale>=t)&&(!s.maxScale||s.maxScale<=t)}var nt=class{run(t,e,i,o){let n=[];for(let r=t.length-1;r>=0;r--){let m=t[r];m.labelingCollisionInfos?.length&&n.push(...m.labelingCollisionInfos)}L("esri-2d-update-debug")&&n.length&&console.debug("CollisionEngine.run"),this._transformMetrics(n),this._runCollision(n,e,i,o);for(let r of n)r.container.requestRender()}_runCollision(t,e,i,o){let[n,r]=e.state.size,m=new st(n,r,e.pixelRatio);for(let{container:a,deconflictionEnabled:h,visible:l}of t){let p=a.attributeView;h?l?(this._prepare(a),this._collideVisible(m,a,i,o),this._collideInvisible(m,a)):B(a,(d,c)=>{for(let f of c)p.setLabelMinZoom(f.entityTexel,ot)}):B(a,(d,c)=>{for(let f of c)qt(f,i)?(p.setLabelMinZoom(f.entityTexel,Q),l&&m.insertMetrics(f)):p.setLabelMinZoom(f.entityTexel,H)})}}_isFiltered(t,e,i){let o=e.getFilterFlags(t),n=!i.hasFilter||!!(o&zt),r=i.featureEffect==null||i.featureEffect.excludedLabelsVisible||!!(o&Rt);return!(n&&r)}_prepare(t){let e=t.attributeView,i=new Set;B(t,(o,n)=>{for(let r of n){let m=r.entityTexel;if(!i.has(m)){if(i.add(m),this._isFiltered(m,e,t.layerView)){e.setLabelMinZoom(m,H);continue}e.getLabelMinZoom(m)!==Q?e.setLabelMinZoom(m,ot):e.setLabelMinZoom(m,Q)}}})}_collideVisible(t,e,i,o){let n=e.attributeView,r=new Set;B(e,(m,a)=>{for(let h=0;h<a.length;h++){let l=a[h].entityTexel;if(r.has(l))continue;if(m.key.level!==o){n.setLabelMinZoom(l,H),r.add(l);continue}if(!qt(a[h],i)){n.setLabelMinZoom(l,H),r.add(l);continue}if(n.getLabelMinZoom(l)!==0){r.add(l);continue}let p=!1,d=!0,c=h,f=h;for(;f<a.length;f++){let g=a[f];if(g.entityTexel!==l)break;if(!p)switch(t.hasCollision(g)){case F:break;case A:p=!0,d=!1;break;case j:d=!1}}if(!p)for(let g=c;g<f;g++)t.insertMetrics(a[g]);h=f-1,d||(r.add(l),n.setLabelMinZoom(l,p?H:Q))}})}_collideInvisible(t,e){let i=e.attributeView,o=new Set;B(e,(n,r)=>{for(let m=0;m<r.length;m++){let a=r[m].entityTexel;if(o.has(a))continue;if(i.getLabelMinZoom(a)!==ot){o.add(a);continue}let h=!1,l=!0,p=m,d=m;for(;d<r.length;d++){let c=r[d];if(c.entityTexel!==a)break;if(!h)switch(t.hasCollision(c)){case F:break;case A:h=!0,l=!1;break;case j:l=!1}}if(!h)for(let c=p;c<d;c++)t.insertMetrics(r[c]);m=d-1,l||(o.add(a),i.setLabelMinZoom(a,h?ot:Q))}})}_transformMetrics(t){for(let{container:e,geometryType:i,vvEvaluators:o}of t)B(e,(n,r)=>{let m=e.attributeView,a=n.transforms.labelMat2d;a[4]=Math.round(a[4]),a[5]=Math.round(a[5]);let h=i==="polyline";for(let l of r){let{entityTexel:p,anchorX:d,anchorY:c}=l,f=l.referenceBounds?.size??0,g=o[0];if(g!=null){let w=g(m.getVVSize(p));f=isNaN(w)||w==null||w===1/0?f:w}let O=l.directionX*(f/2),yt=l.directionY*(f/2);for(let w of l.bounds){let ut=d,ct=c;if(h){let R=ut+w.x+O,P=ct+w.y+yt;R=a[0]*R+a[2]*P+a[4],P=a[1]*R+a[3]*P+a[5],w.computedX=Math.floor(R),w.computedY=Math.floor(P)}else{ut=a[0]*d+a[2]*c+a[4],ct=a[1]*d+a[3]*c+a[5];let R=ut+w.x+O,P=ct+w.y+yt;w.computedX=R,w.computedY=P}}}})}};var Ht=32,J=class extends y{constructor(s){super(s),this._lastUpdate=0,this.collisionEngine=new nt,this.lastUpdateId=-1,this.updateRequested=!1,this.view=null}get updating(){return L("esri-2d-log-updating")&&console.log(`Updating LabelManager ${this.updateRequested}:
-> updateRequested: ${this.updateRequested}`),this.updateRequested}update(s){let t=performance.now();t-this._lastUpdate>=Ht?(this._lastUpdate=t,this.doUpdate(s)):this.requestUpdate()}viewChange(){this.requestUpdate()}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.view?.requestUpdate())}processUpdate(s){this.updateRequested&&(this.updateRequested=!1,this.update(s))}doUpdate(s){let t=this.view;if(t)try{let e=s.state.scale,i=t.featuresTilingScheme.getClosestInfoForScale(e).level;this.collisionEngine.run(t.allLayerViews.items,s,e,i)}catch{}}};u([_()],J.prototype,"updateRequested",void 0),u([_()],J.prototype,"updating",null),u([_()],J.prototype,"view",void 0),J=u([M("esri.views.2d.LabelManager")],J);var at="esri-zoom-box",rt={container:`${at}__container`,overlay:`${at}__overlay`,background:`${at}__overlay-background`,box:`${at}__outline`},_t={zoom:"Shift",counter:"Ctrl"},K=class extends y{constructor(s){super(s),this._container=null,this._overlay=null,this._backgroundShape=null,this._boxShape=null,this._box={x:0,y:0,width:0,height:0},this._rafId=null,this._redraw=this._redraw.bind(this)}destroy(){this.view=null}set view(s){this.removeAllHandles(),this._destroyOverlay(),this._set("view",s),s&&this.addHandles([s.on("drag",[_t.zoom],t=>this._handleDrag(t,1),dt.INTERNAL),s.on("drag",[_t.zoom,_t.counter],t=>this._handleDrag(t,-1),dt.INTERNAL)])}_start(){this._createContainer(),this._createOverlay(),this.navigation.begin()}_update(s,t,e,i){this._box.x=s,this._box.y=t,this._box.width=e,this._box.height=i,this._rafId||(this._rafId=requestAnimationFrame(this._redraw))}_end(s,t,e,i,o){let n=this.view,r=n.toMap(Ct(s+.5*e,t+.5*i)),m=Math.max(e/n.width,i/n.height);o===-1&&(m=1/m),this._destroyOverlay(),this.navigation.end(),n.goTo({center:r,scale:n.scale*m})}_updateBox(s,t,e,i){let o=this._boxShape;o.setAttributeNS(null,"x",""+s),o.setAttributeNS(null,"y",""+t),o.setAttributeNS(null,"width",""+e),o.setAttributeNS(null,"height",""+i),o.setAttributeNS(null,"class",rt.box)}_updateBackground(s,t,e,i){this._backgroundShape.setAttributeNS(null,"d",this._toSVGPath(s,t,e,i,this.view.width,this.view.height))}_createContainer(){let s=document.createElement("div");s.className=rt.container,this.view.root.appendChild(s),this._container=s}_createOverlay(){let s=this.view.width,t=this.view.height,e=document.createElementNS("http://www.w3.org/2000/svg","path");e.setAttributeNS(null,"d","M 0 0 L "+s+" 0 L "+s+" "+t+" L 0 "+t+" Z"),e.setAttributeNS(null,"class",rt.background);let i=document.createElementNS("http://www.w3.org/2000/svg","rect"),o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),o.setAttributeNS(null,"class",rt.overlay),o.appendChild(e),o.appendChild(i),this._container.appendChild(o),this._backgroundShape=e,this._boxShape=i,this._overlay=o}_destroyOverlay(){this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container),this._container=this._backgroundShape=this._boxShape=this._overlay=null}_toSVGPath(s,t,e,i,o,n){let r=s+e,m=t+i;return"M 0 0 L "+o+" 0 L "+o+" "+n+" L 0 "+n+" ZM "+s+" "+t+" L "+s+" "+m+" L "+r+" "+m+" L "+r+" "+t+" Z"}_handleDrag(s,t){let e=s.x,i=s.y,o=s.origin.x,n=s.origin.y,r,m,a,h;switch(e>o?(r=o,a=e-o):(r=e,a=o-e),i>n?(m=n,h=i-n):(m=i,h=n-i),s.action){case"start":this._start();break;case"update":this._update(r,m,a,h);break;case"end":this._end(r,m,a,h,t)}s.stopPropagation()}_redraw(){if(!this._rafId||(this._rafId=null,!this._overlay))return;let{x:s,y:t,width:e,height:i}=this._box;this._updateBox(s,t,e,i),this._updateBackground(s,t,e,i),this._rafId=requestAnimationFrame(this._redraw)}};u([_()],K.prototype,"navigation",void 0),u([_()],K.prototype,"view",null),K=u([M("esri.views.2d.navigation.ZoomBox")],K);var Ot=K;var b=class{constructor(t){this._gain=t,this.lastValue=void 0,this.filteredDelta=void 0}update(t){if(this.hasLastValue()){let e=this.computeDelta(t);this._updateDelta(e)}this.lastValue=t}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return this.lastValue!==void 0}hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(t){return this.lastValue===void 0?NaN:t-this.lastValue}_updateDelta(t){this.filteredDelta!==void 0?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*t:this.filteredDelta=t}};var V=class{constructor(t,e,i){this._initialVelocity=t,this._stopVelocity=e,this._friction=i,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(t){return t>this.duration}get friction(){return this._friction}value(t){return this.valueFromInitialVelocity(this._initialVelocity,t)}valueDelta(t,e){let i=this.value(t);return this.value(t+e)-i}valueFromInitialVelocity(t,e){e=Math.min(e,this.duration);let i=1-this.friction;return t*(i**e-1)/Math.log(i)}};var ft=class extends V{constructor(t,e,i,o,n){super(t,e,i),this._sceneVelocity=o,this.direction=n}value(t){return super.valueFromInitialVelocity(this._sceneVelocity,t)}},mt=class{constructor(t=300,e=12,i=.84){this._minimumInitialVelocity=t,this._stopVelocity=e,this._friction=i,this.enabled=!0,this._time=new b(.6),this._screen=[new b(.4),new b(.4)],this._scene=[new b(.6),new b(.6),new b(.6)],this._tmpDirection=et()}add(t,e,i){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(i)<.015)return;this._screen[0].update(t[0]),this._screen[1].update(t[1]),this._scene[0].update(e[0]),this._scene[1].update(e[1]),this._scene[2].update(e[2]),this._time.update(i)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;let t=this._screen[0].filteredDelta,e=this._screen[1].filteredDelta,i=t==null||e==null?0:Math.sqrt(t*t+e*e),o=this._time.filteredDelta,n=o==null||i==null?0:i/o;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(t,e,i){St(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);let o=Tt(this._tmpDirection);o>0&&it(this._tmpDirection,this._tmpDirection,1/o);let n=this._time.filteredDelta;return new ft(t,e,i,n==null?0:o/n,this._tmpDirection)}};var Z=class extends y{constructor(s){super(s),this.animationTime=0,this.momentumEstimator=new mt(500,6,.92),this.momentum=null,this.tmpMomentum=et(),this.momentumFinished=!1,this.viewpoint=new E({targetGeometry:new D,scale:0,rotation:0}),this._previousDrag=null,tt(()=>this.momentumFinished,()=>this.navigation.stop())}begin(s,t){this.navigation.begin(),this.momentumEstimator.reset(),this.addToEstimator(t),this._previousDrag=t}update(s,t){this.addToEstimator(t);let e=t.center.x,i=t.center.y,o=this._previousDrag;e=o?o.center.x-e:-e,i=o?i-o.center.y:i,s.viewpoint=I(this.viewpoint,s.viewpoint,[e||0,i||0]),this._previousDrag=t}end(s,t){this.addToEstimator(t);let e=s.navigation.momentumEnabled;this.momentum=e?this.momentumEstimator.evaluateMomentum():null,this.animationTime=0,this.momentum&&this.onAnimationUpdate(s),this._previousDrag=null,this.navigation.end()}addToEstimator(s){let t=s.center.x,e=s.center.y,i=Dt(-t,e),o=xt(-t,e,0);this.momentumEstimator.add(i,o,.001*s.timestamp)}onAnimationUpdate(s){this.navigation.animationManager?.animateContinous(s.viewpoint,(t,e)=>{let{momentum:i,animationTime:o,tmpMomentum:n}=this,r=.001*e;if(!(this.momentumFinished=!i||i.isFinished(o))){let m=i.valueDelta(o,r);it(n,i.direction,m),I(t,t,n),s.constraints.constrainByGeometry(t)}this.animationTime+=r})}stopMomentumNavigation(){this.momentum&&(this.momentumEstimator.reset(),this.momentum=null,this.navigation.stop())}};u([_()],Z.prototype,"momentumFinished",void 0),u([_()],Z.prototype,"viewpoint",void 0),u([_()],Z.prototype,"navigation",void 0),Z=u([M("esri.views.2d.navigation.actions.Pan")],Z);var Ut=Z;var N=class{constructor(t=2.5,e=.01,i=.95,o=12){this._minimumInitialVelocity=t,this._stopVelocity=e,this._friction=i,this._maxVelocity=o,this.enabled=!0,this.value=new b(.8),this.time=new b(.3)}add(t,e){if(this.enabled&&e!=null){if(this.time.hasLastValue()){if(this.time.computeDelta(e)<.01)return;if(this.value.hasFilteredDelta()){let i=this.value.computeDelta(t);this.value.filteredDelta*i<0&&this.value.reset()}}this.time.update(e),this.value.update(t)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let t=this.value.filteredDelta/this.time.filteredDelta;return t=x(t,-this._maxVelocity,this._maxVelocity),Math.abs(t)<this._minimumInitialVelocity?null:this.createMomentum(t,this._stopVelocity,this._friction)}createMomentum(t,e,i){return new V(t,e,i)}};var ht=class extends N{constructor(t=3,e=.01,i=.95,o=12){super(t,e,i,o)}add(t,e){let i=this.value.lastValue;if(i!=null){let o=t-i;for(;o>Math.PI;)o-=2*Math.PI;for(;o<-Math.PI;)o+=2*Math.PI;t=i+o}super.add(t,e)}};var gt=class extends V{constructor(t,e,i){super(t,e,i)}value(t){let e=super.value(t);return Math.exp(e)}valueDelta(t,e){let i=super.value(t),o=super.value(t+e)-i;return Math.exp(o)}},lt=class extends N{constructor(t=2.5,e=.01,i=.95,o=12){super(t,e,i,o)}add(t,e){super.add(Math.log(t),e)}createMomentum(t,e,i){return new gt(t,e,i)}};var k=class extends y{constructor(s){super(s),this._animationTime=0,this._momentumFinished=!1,this._previousAngle=0,this._previousRadius=0,this._previousCenter=null,this._rotationMomentumEstimator=new ht(.6,.15,.95),this._rotationDirection=1,this._startAngle=0,this._startRadius=0,this._updateTimestamp=null,this._zoomDirection=1,this._zoomMomentumEstimator=new lt,this._zoomOnly=null,this.zoomMomentum=null,this.rotateMomentum=null,this.viewpoint=new E({targetGeometry:new D,scale:0,rotation:0}),this.addHandles(tt(()=>this._momentumFinished,()=>this.navigation.stop()))}begin(s,t){this.navigation.begin(),this._rotationMomentumEstimator.reset(),this._zoomMomentumEstimator.reset(),this._zoomOnly=null,this._previousAngle=this._startAngle=t.angle,this._previousRadius=this._startRadius=t.radius,this._previousCenter=t.center,this._updateTimestamp=null,s.constraints.rotationEnabled&&this.addToRotateEstimator(0,t.timestamp),this.addToZoomEstimator(t,1)}update(s,t){this._updateTimestamp===null&&(this._updateTimestamp=t.timestamp);let e=t.angle,i=t.radius,o=t.center,n=Math.abs(180*(e-this._startAngle)/Math.PI),r=Math.abs(i-this._startRadius),m=this._startRadius/i;if(this._previousRadius&&this._previousCenter){let a=i/this._previousRadius,h=180*(e-this._previousAngle)/Math.PI;this._rotationDirection=h>=0?1:-1,this._zoomDirection=a>=1?1:-1,s.constraints.rotationEnabled?(this._zoomOnly===null&&t.timestamp-this._updateTimestamp>200&&(this._zoomOnly=r-n>0),this._zoomOnly===null||this._zoomOnly?h=0:this.addToRotateEstimator(e-this._startAngle,t.timestamp)):h=0,this.addToZoomEstimator(t,m),this.navigation.setViewpoint([o.x,o.y],1/a,h,[this._previousCenter.x-o.x,o.y-this._previousCenter.y])}this._previousAngle=e,this._previousRadius=i,this._previousCenter=o}end(s){this.rotateMomentum=this._rotationMomentumEstimator.evaluateMomentum(),this.zoomMomentum=this._zoomMomentumEstimator.evaluateMomentum(),this._animationTime=0,(this.rotateMomentum||this.zoomMomentum)&&this.onAnimationUpdate(s),this.navigation.end()}addToRotateEstimator(s,t){this._rotationMomentumEstimator.add(s,.001*t)}addToZoomEstimator(s,t){this._zoomMomentumEstimator.add(t,.001*s.timestamp)}canZoomIn(s){let t=s.scale,e=s.constraints.effectiveMaxScale;return e===0||t>e}canZoomOut(s){let t=s.scale,e=s.constraints.effectiveMinScale;return e===0||t<e}onAnimationUpdate(s){this.navigation.animationManager?.animateContinous(s.viewpoint,(t,e)=>{let i=!this.canZoomIn(s)&&this._zoomDirection>1||!this.canZoomOut(s)&&this._zoomDirection<1,o=!this.rotateMomentum||this.rotateMomentum.isFinished(this._animationTime),n=i||!this.zoomMomentum||this.zoomMomentum.isFinished(this._animationTime),r=.001*e;if(this._momentumFinished=o&&n,!this._momentumFinished){let m=this.rotateMomentum?Math.abs(this.rotateMomentum.valueDelta(this._animationTime,r))*this._rotationDirection*180/Math.PI:0,a=this.zoomMomentum?Math.abs(this.zoomMomentum.valueDelta(this._animationTime,r)):1,h=z(),l=z();if(this._previousCenter){G(h,this._previousCenter.x,this._previousCenter.y),Ft(l,s.size,s.padding),Vt(h,h,l);let{constraints:p,scale:d}=s,c=d*a;a<1&&!p.canZoomInTo(c)?(a=d/p.effectiveMaxScale,this.zoomMomentum=null,this.rotateMomentum=null):a>1&&!p.canZoomOutTo(c)&&(a=d/p.effectiveMinScale,this.zoomMomentum=null,this.rotateMomentum=null),Bt(t,s.viewpoint,a,m,h,s.size),s.constraints.constrainByGeometry(t)}}this._animationTime+=r})}stopMomentumNavigation(){(this.rotateMomentum||this.zoomMomentum)&&(this.rotateMomentum&&(this._rotationMomentumEstimator.reset(),this.rotateMomentum=null),this.zoomMomentum&&(this._zoomMomentumEstimator.reset(),this.zoomMomentum=null),this.navigation.stop())}};u([_()],k.prototype,"_momentumFinished",void 0),u([_()],k.prototype,"viewpoint",void 0),u([_()],k.prototype,"navigation",void 0),k=u([M("esri.views.2d.navigation.actions.Pinch")],k);var $t=k;var vt=z(),Gt=z(),W=class extends y{constructor(s){super(s),this._previousCenter=z(),this.viewpoint=new E({targetGeometry:new D,scale:0,rotation:0})}begin(s,t){this.navigation.begin(),G(this._previousCenter,t.center.x,t.center.y)}update(s,t){let{state:{size:e,padding:i}}=s;G(vt,t.center.x,t.center.y),It(Gt,e,i),s.viewpoint=Y(this.viewpoint,s.state.paddedViewState.viewpoint,At(Gt,this._previousCenter,vt)),Et(this._previousCenter,vt)}end(){this.navigation.end()}};u([_()],W.prototype,"viewpoint",void 0),u([_()],W.prototype,"navigation",void 0),W=u([M("esri.views.2d.actions.Rotate")],W);var Xt=W;var q=10,Yt=1,wt=new E({targetGeometry:new D}),Mt=[0,0],jt=250,C=class extends y{constructor(s){super(s),this._endTimer=null,this._lastEventTimestamp=null,this.animationManager=null,this.interacting=!1}initialize(){this.pan=new Ut({navigation:this}),this.rotate=new Xt({navigation:this}),this.pinch=new $t({navigation:this}),this.zoomBox=new Ot({view:this.view,navigation:this})}destroy(){this.pan=$(this.pan),this.rotate=$(this.rotate),this.pinch=$(this.pinch),this.zoomBox=$(this.zoomBox),this.animationManager=null}begin(){this.stop(),this._set("interacting",!0)}end(){this._lastEventTimestamp=performance.now(),this._startTimer(jt)}zoom(e){return U(this,arguments,function*(s,t=this._getDefaultAnchor()){if(this.begin(),this.view.constraints.snapToZoom&&this.view.constraints.effectiveLODs)return s<1?this.zoomIn(t):this.zoomOut(t);this.setViewpoint(t,s,0,[0,0])})}zoomIn(s){return U(this,null,function*(){let t=this.view,e=t.constraints.snapToNextScale(t.scale);return this._zoomToScale(e,s)})}zoomOut(s){return U(this,null,function*(){let t=this.view,e=t.constraints.snapToPreviousScale(t.scale);return this._zoomToScale(e,s)})}setViewpoint(s,t,e,i){this.begin(),this.view.stateManager.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,s,t,e,i),this.end()}setViewpointImmediate(s,t=0,e=[0,0],i=this._getDefaultAnchor()){this.view.stateManager.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,i,s,t,e)}continousRotateClockwise(){let s=this.view.viewpoint;this.animationManager?.animateContinous(s,t=>{Y(t,t,-Yt)})}continousRotateCounterclockwise(){let s=this.view.viewpoint;this.animationManager?.animateContinous(s,t=>{Y(t,t,Yt)})}resetRotation(){this.view.constraints.rotationEnabled&&(this.view.rotation=0)}continousPanLeft(){this._continuousPan([-q,0])}continousPanRight(){this._continuousPan([q,0])}continousPanUp(){this._continuousPan([0,q])}continousPanDown(){this._continuousPan([0,-q])}continuousPanVector({x:s,y:t}){this._continuousPan([s*q,t*q])}stop(){this.pan.stopMomentumNavigation(),this.animationManager?.stop(),this.end(),this._endTimer!==null&&(clearTimeout(this._endTimer),this._endTimer=null,this._set("interacting",!1))}_continuousPan(s){let t=this.view.viewpoint;this.animationManager?.animateContinous(t,e=>{I(e,e,s),this.view.constraints.constrainByGeometry(e)})}_startTimer(s){return this._endTimer!==null||(this._endTimer=setTimeout(()=>{this._endTimer=null;let t=performance.now()-(this._lastEventTimestamp??0);t<jt?this._endTimer=this._startTimer(t):this._set("interacting",!1)},s)),this._endTimer}_getDefaultAnchor(){let{size:s,padding:{left:t,right:e,top:i,bottom:o}}=this.view;return Mt[0]=.5*(s[0]-e+t),Mt[1]=.5*(s[1]-o+i),Mt}_zoomToScale(e){return U(this,arguments,function*(s,t=this._getDefaultAnchor()){let{view:i}=this,{constraints:o,scale:n,viewpoint:r,size:m,padding:a}=i,h=o.canZoomInTo(s),l=o.canZoomOutTo(s);if(!(s<n&&!h||s>n&&!l))return pt(wt,r,s/n,0,t,m,a),o.constrainByGeometry(wt),i.goTo(wt,{animate:!0,pickClosestTarget:!1})})}_scaleRotateTranslateViewpoint(s,t,e,i,o){let{view:n}=this,{size:r,padding:m,constraints:a,scale:h,viewpoint:l}=n,p=h*e,d=a.canZoomInTo(p),c=a.canZoomOutTo(p);return(e<1&&!d||e>1&&!c)&&(e=1),I(l,l,o),pt(s,l,e,i,t,r,m),a.constrainByGeometry(s)}};u([_()],C.prototype,"animationManager",void 0),u([_({type:Boolean,readOnly:!0})],C.prototype,"interacting",void 0),u([_()],C.prototype,"pan",void 0),u([_()],C.prototype,"pinch",void 0),u([_()],C.prototype,"rotate",void 0),u([_()],C.prototype,"view",void 0),u([_()],C.prototype,"zoomBox",void 0),C=u([M("esri.views.2d.navigation.MapViewNavigation")],C);var fs=C;var Qt={shaders:{vertexShader:v("magnifier/magnifier.vert"),fragmentShader:v("magnifier/magnifier.frag")},attributes:new Map([["a_pos",0]])};function bs(s){return Zt(s,Qt)}export{Kt as a,ee as b,oe as c,ne as d,kt as e,J as f,fs as g,Qt as h,bs as i};
