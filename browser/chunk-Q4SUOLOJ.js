import{a as v}from"./chunk-IFW7DQNN.js";import{b as y}from"./chunk-G3LLBABP.js";import{a as g}from"./chunk-D2ITYHSM.js";import{B as u,F as i}from"./chunk-VWEBO6QK.js";import{S as d}from"./chunk-KAAR5ZJN.js";import{a}from"./chunk-W3WDPWBE.js";import{q as p,y as c}from"./chunk-WKT5W7KT.js";import{p as m}from"./chunk-X3IDZTNG.js";import{h as l}from"./chunk-EAH6BNBL.js";var n=new y,o=new WeakMap;function b(r){R(r)&&n.push(new WeakRef(r))}function I(r){let e=n.find(s=>s.deref()===r);e&&n.remove(e)}function R(r){return r!=null&&typeof r=="object"&&"refreshInterval"in r&&"refresh"in r}function w(r,e){return Number.isFinite(r)&&Number.isFinite(e)?e<=0?r:w(e,r%e):0}var h=0,f=0;function T(){let r=Date.now(),e=!1;for(let s of n){let t=s.deref();t?t.refreshInterval&&r-(o.get(t)??0)+5>=6e4*t.refreshInterval&&(o.set(t,r),t.refresh(r)):e=!0}if(e)for(let s=n.length-1;s>=0;s--)n.at(s).deref()||n.removeAt(s)}u(()=>{let r=Date.now(),e=0;for(let s of n){let t=s.deref();t&&(e=w(Math.round(6e4*t.refreshInterval),e),t.refreshInterval?o.get(t)||o.set(t,r):o.delete(t))}if(e!==f){if(f=e,clearInterval(h),f===0)return void(h=0);h=setInterval(T,f)}});var L=.1,B=r=>{let e=class extends r{constructor(...s){super(...s),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=c(()=>this.hasDataChanged()),this.when().then(()=>{this.destroyed||b(this)},()=>{})}destroy(){I(this)}castRefreshInterval(s){return s>=L?s:s<=0?0:L}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(s=Date.now()){p(this._debounceHasDataChanged()).then(t=>{t&&this._set("refreshTimestamp",s),this.emit("refresh",{dataChanged:t})},t=>{m.getLogger(this).error(t),this.emit("refresh",{dataChanged:!1,error:t})})}hasDataChanged(){return l(this,null,function*(){return!0})}get test(){let s=this;return{set refreshInterval(t){s._set("refreshInterval",t)}}}};return a([i({type:Number,json:{write:!0,origins:{"web-scene":{write:{enabled:!0,layerContainerTypes:v}}}}})],e.prototype,"refreshInterval",void 0),a([g("refreshInterval")],e.prototype,"castRefreshInterval",null),a([i({readOnly:!0})],e.prototype,"refreshTimestamp",void 0),a([i({readOnly:!0})],e.prototype,"refreshParameters",null),e=a([d("esri.layers.mixins.RefreshableLayer")],e),e};export{B as a};
