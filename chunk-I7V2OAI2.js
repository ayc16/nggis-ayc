import{c as b,e as y}from"./chunk-OJB2TSJ7.js";import{L as l,O as g}from"./chunk-AUTL5LCV.js";import{S as m}from"./chunk-KUJG22IX.js";import{a}from"./chunk-W3WDPWBE.js";import{B as d}from"./chunk-GISCFF3Z.js";import{d as _,e as c}from"./chunk-MLSR6YE6.js";import{a as h,b as u,h as p}from"./chunk-EAH6BNBL.js";var r=class extends g{constructor(t){super(t),this.constrainResult=s=>s,this._snapPoints=null,this._frameTask=null,this._abortController=null,this._stagedPoint=null,this._snap=d((s,i,o,n)=>p(this,null,function*(){let e=this._frameTask;if(e==null)return;let P=yield e.schedule(()=>i.snap(u(h({},s),{context:o,signal:n})),n);P.valid&&(yield e.schedule(()=>{this.stagedPoint=P.apply(),s!==this._snapPoints&&this._snapPoints!=null&&(this.stagedPoint=i.update(u(h({},this._snapPoints),{context:o})))},n))}))}get stagedPoint(){return this._stagedPoint}set stagedPoint(t){this._stagedPoint=this.constrainResult(t)}initialize(){let t=this.view.type==="3d"?this.view?.resourceController?.scheduler:null;this._frameTask=t!=null?t.registerTask(b.SNAPPING):y}destroy(){this._abortController=c(this._abortController),this._frameTask=_(this._frameTask)}update(t,s,i){this._snapPoints=t;let{point:o,scenePoint:n}=t,e=s.update({point:o,scenePoint:n,context:i});return this.stagedPoint=e,e}snap(t,s,i){return p(this,null,function*(){let{point:o,scenePoint:n}=t;return this.stagedPoint=s.update({point:o,scenePoint:n,context:i}),this._snapPoints=t,this._abortController==null&&(this._abortController=new AbortController),this._snap(t,s,i,this._abortController.signal)})}snapAgainNearPreviousMapPoint(t,s){return p(this,null,function*(){this._snapPoints!=null&&(yield this.snap(this._snapPoints,t,s))})}abort(){this._abortController=c(this._abortController),this._snapPoints=null}};a([l({constructOnly:!0})],r.prototype,"view",void 0),a([l()],r.prototype,"stagedPoint",null),a([l()],r.prototype,"constrainResult",void 0),a([l()],r.prototype,"_stagedPoint",void 0),r=a([m("esri.views.interactive.snapping.SnappingOperation")],r);export{r as a};
