import{a as H}from"./chunk-25AVAB3I.js";import{p as z,r as T,v as I}from"./chunk-DK23A5VB.js";import{b as G}from"./chunk-JPYM7Q24.js";import{C as x}from"./chunk-EWHTP5EW.js";import{h as P}from"./chunk-EAH6BNBL.js";var O=96/72,k=class{constructor(g){this._spatialReference=g,this._imageDataCanvas=null,this._cimResourceManager=new H}get _canvas(){return this._imageDataCanvas||(this._imageDataCanvas=document.createElement("canvas")),this._imageDataCanvas}get resourceManager(){return this._cimResourceManager}rasterizeCIMSymbolAsync(g,u,p,f,s,a,n,o,C){return P(this,null,function*(){if(!g)return null;let{data:l}=g;if(!l||l.type!=="CIMSymbolReference"||!l.symbol)return null;let{symbol:M}=l;a||(a=x(M));let i=yield G.resolveSymbolOverrides(l,u,this._spatialReference,s,a,n,o),c=this._cimResourceManager,w=[];I.fetchResources(i,c,w),I.fetchFonts(i,c,w),w.length>0&&(yield Promise.all(w));let{width:t,height:r}=p,v=E(a,t,r,f),e=I.getEnvelope(i,v,c);if(!e)return null;let h=1,S=0,R=0;switch(M.type){case"CIMPointSymbol":case"CIMTextSymbol":{let m=1;e.width>t&&(m=t/e.width);let d=1;e.height>r&&(d=r/e.height),f==="preview"&&(e.width<t&&(m=t/e.width),e.height<r&&(d=r/e.height)),h=Math.min(m,d),S=e.x+e.width/2,R=e.y+e.height/2}break;case"CIMLineSymbol":{(C||e.height>r)&&(h=r/e.height),R=e.y+e.height/2;let m=e.x*h+t/2,d=(e.x+e.width)*h+t/2,{paths:b}=v;b[0][0][0]-=m/h,b[0][2][0]-=(d-t)/h}break;case"CIMPolygonSymbol":{S=e.x+e.width/2,R=e.y+e.height/2;let m=e.x*h+t/2,d=(e.x+e.width)*h+t/2,b=e.y*h+r/2,_=(e.y+e.height)*h+r/2,{rings:y}=v;m<0&&(y[0][0][0]-=m,y[0][3][0]-=m,y[0][4][0]-=m),b<0&&(y[0][0][1]+=b,y[0][1][1]+=b,y[0][4][1]+=b),d>t&&(y[0][1][0]-=d-t,y[0][2][0]-=d-t),_>r&&(y[0][2][1]+=_-r,y[0][3][1]+=_-r)}}let F={type:"cim",data:{type:"CIMSymbolReference",symbol:i}};return this.rasterize(F,t,r,S,R,h,a,1,v)})}rasterize(g,u,p,f,s,a,n,o=0,C=null){let{data:l}=g;if(!l||l.type!=="CIMSymbolReference"||!l.symbol)return null;let{symbol:M}=l,i=this._canvas,c=(window.devicePixelRatio||1)*O;i.width=u*c,i.height=p*c,n||(n=x(M)),C||(C=E(n,u,p,"legend")),i.width+=2*o,i.height+=2*o;let w=i.getContext("2d",{willReadFrequently:!0}),t=z.createIdentity();return t.translate(-f,-s),t.scale(a*c,-a*c),t.translate(u*c/2+o,p*c/2+o),w.clearRect(0,0,i.width,i.height),new T(w,this._cimResourceManager,t,!0).drawSymbol(M,C),w.getImageData(0,0,i.width,i.height)}};function E(D,g,u,p){let s=-g/2+1,a=g/2-1,n=u/2-1,o=-u/2+1;switch(D){case"esriGeometryPoint":return{x:0,y:0};case"esriGeometryPolyline":return{paths:[[[s,0],[0,0],[a,0]]]};default:return p==="legend"?{rings:[[[s,n],[a,0],[a,o],[s,o],[s,n]]]}:{rings:[[[s,n],[a,n],[a,o],[s,o],[s,n]]]}}}export{k as a};
