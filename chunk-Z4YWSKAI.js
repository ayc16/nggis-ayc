import{A as $n,B as Jn,C as Go,a as Hn,b as qe,c as mi,d as Ja,e as Lo,f as Nn,g as fe,h as Ka,i as F,j as Ho,k as N,l as b,m as gi,n as Yn,o as Qe,p as Xn,q as Vo,r as Wn,v as Zt,w as _i,x as ts,y as qn,z as ko}from"./chunk-MSTVL2XB.js";import{a as Wi,b as Un,d as zo,e as Bn,f as Zn,h as es}from"./chunk-RXA6WDPO.js";import{C as Xi,D as Vn,E as kn,F as Co,G as ee,H as Je,I as jo,L as Gn,O as Fn,Q as fi,ba as ie,da as Qa,ea as Bt,n as Dt,z as $e}from"./chunk-QRTF6HWT.js";import"./chunk-BJQH3R2Y.js";import{a as el,b as il,c as ol}from"./chunk-JGTIZGGZ.js";import{a as Fo,b as Qn}from"./chunk-TGSASXL3.js";import{a as vi}from"./chunk-XR6AAVXE.js";import"./chunk-I6JXU463.js";import"./chunk-L4N7O64W.js";import{b as Kn}from"./chunk-REKWPGIN.js";import{b as tl}from"./chunk-B3JBY4X6.js";import"./chunk-JAAOLJTO.js";import{a as Mn,b as Sn,c as jn,d as Ln,e as zn}from"./chunk-YCBC7RWF.js";import{a as gn,b as Yi,c as Eo,d as ci,e as Ao,j as _n,k as vn,m as Io,n as Xa}from"./chunk-L57KLCZM.js";import"./chunk-EB5CS3GG.js";import"./chunk-QJKE5PUA.js";import{d as fn,m as dt,o as Ro,p as yn,r as bn,s as Wa,t as hi,u as Po,v as te}from"./chunk-3HJJZGL7.js";import{b as Cn}from"./chunk-WFLT3Z7F.js";import"./chunk-FVCRK5IX.js";import"./chunk-6W67IVZS.js";import"./chunk-CURQPDM4.js";import"./chunk-AWMFYQHJ.js";import"./chunk-DRX336HH.js";import"./chunk-SFGIVWEM.js";import"./chunk-TB62XDET.js";import"./chunk-724MIMFK.js";import"./chunk-UJUCAWBP.js";import{a as Oe,b as Ee,c as Ya}from"./chunk-EXOOWX4Z.js";import"./chunk-UZMIDNNF.js";import"./chunk-KEUU4ZK6.js";import{a as ln,b as Za}from"./chunk-I2LACOYT.js";import"./chunk-RCPMQJFX.js";import{D as en,E as Na,H as on,J as an,K as sn,e as kr,g as Wr,h as qr,i as $r,k as Jr,l as Qr,m as Kr,r as ni,v as tn}from"./chunk-7E3X25PE.js";import"./chunk-TXV2XM7Y.js";import{c as Gr,d as rn}from"./chunk-PJBIIWFF.js";import"./chunk-R5K6EMED.js";import"./chunk-FVCUBGKZ.js";import{a as li}from"./chunk-C4HIHYDS.js";import"./chunk-DYIKRVEE.js";import"./chunk-LCBWJNVO.js";import{a as So,b as xo,c as wo}from"./chunk-JAXR3ZUJ.js";import{e as Fr}from"./chunk-XN46SLSO.js";import"./chunk-UGL7UJES.js";import"./chunk-QKPKWNQQ.js";import"./chunk-IHA7ZQ4Q.js";import{b as wt}from"./chunk-XSJRPCD6.js";import"./chunk-JRJHFO7J.js";import"./chunk-JR27VNVT.js";import"./chunk-WICM2VEE.js";import"./chunk-DUZ52FW3.js";import"./chunk-VLBUZRRG.js";import"./chunk-7G763D5W.js";import{d as Nr,l as A,m as Ur}from"./chunk-3DDJTCET.js";import{a as Zi}from"./chunk-UDMTFKLM.js";import"./chunk-BYXBJQAS.js";import"./chunk-L5A2ASNG.js";import"./chunk-3OLRRKKD.js";import"./chunk-PTXLSCMJ.js";import{a as Br,b as Zr,d as Yr,e as Xr,f as bo,g as Mo}from"./chunk-AW3LMT4V.js";import"./chunk-LTJDZ7OM.js";import"./chunk-6EZU2A2D.js";import"./chunk-OZLCBZHH.js";import"./chunk-UTDAYTD2.js";import"./chunk-JCJ5KQ5Q.js";import"./chunk-TREMRME7.js";import"./chunk-C2FNHCAJ.js";import"./chunk-ADDH3SWI.js";import"./chunk-GJBALZEB.js";import"./chunk-XAHD7XBV.js";import"./chunk-DL3OPG77.js";import"./chunk-RBP2Z7C6.js";import"./chunk-BYXBJQAS.js";import"./chunk-AIKSV6LF.js";import"./chunk-ELGDZDOQ.js";import"./chunk-NQ4QDYDP.js";import"./chunk-S26YVN25.js";import{a as Ye,e as Va,g as Bi}from"./chunk-DOFADBK3.js";import"./chunk-VYC75ESO.js";import"./chunk-ZN6YLP6I.js";import"./chunk-VVVTRG42.js";import"./chunk-CETY2ZOK.js";import"./chunk-CI3GTVLF.js";import"./chunk-Y6C54FDT.js";import"./chunk-5H3X7WYB.js";import"./chunk-GMW3QDVG.js";import"./chunk-RHABF3KL.js";import{b as La}from"./chunk-KUOODJRB.js";import"./chunk-KLXERNY4.js";import{a as ot}from"./chunk-OW7DVBQB.js";import"./chunk-A2AOHK3A.js";import"./chunk-UZSTUBKI.js";import"./chunk-HPYRFOMM.js";import{f as Er}from"./chunk-56SRKZHP.js";import"./chunk-YW3L7OMP.js";import"./chunk-LAXYP2KV.js";import"./chunk-TIXZ4OWB.js";import{a as vr}from"./chunk-NDZXQR2V.js";import"./chunk-W5OI4BJ2.js";import{a as It}from"./chunk-UVJ5D37D.js";import"./chunk-2NH7HOKA.js";import{c as xe,i as yr}from"./chunk-ZAQLF7TN.js";import"./chunk-JFY2XMDP.js";import"./chunk-ZHUHFKYD.js";import{a as Ni}from"./chunk-SKXQUOOX.js";import"./chunk-6HNTTYFF.js";import"./chunk-LWKMZQFJ.js";import{a as gr}from"./chunk-I3DWOIS7.js";import{a as Ba,c as cn,d as hn}from"./chunk-UWVTXX2V.js";import{a as un}from"./chunk-OQUBYVYT.js";import"./chunk-AJX3FWW2.js";import{g as Rn,h as Pn,i as Dn}from"./chunk-BTFKH6KF.js";import"./chunk-I7V2OAI2.js";import{b as M,c as ht,e as Ae,f as K,g as wn,h as Tn,j as On,l as En,m as An,n as me,o as Pt,p as Ie,q as ui,r as $a,s as In,t as We}from"./chunk-RAMEUAPV.js";import"./chunk-5NHMASEK.js";import{h as nt,j as Do,l as xn,m as qa,p as di,q as Xe}from"./chunk-3K3SLH5Z.js";import{c as Rt}from"./chunk-77GHZE77.js";import"./chunk-AHLE435U.js";import{a as pn,o as mn}from"./chunk-VORAPKV5.js";import"./chunk-4OC4J3KU.js";import"./chunk-CXJNPJ3A.js";import"./chunk-QU6JU243.js";import{i as dn}from"./chunk-7SVLZCA4.js";import"./chunk-ZVNCKSTP.js";import"./chunk-BKLTKOZS.js";import"./chunk-BWK3LBHF.js";import"./chunk-JC4ZKBNS.js";import{a as nn,b as pi,d as To,h as Oo,j as st}from"./chunk-GAF32LQP.js";import"./chunk-YKUB35EI.js";import"./chunk-ZJHI7U3R.js";import"./chunk-WBPLJNRU.js";import"./chunk-MW7BA4EZ.js";import"./chunk-QNOFG4YA.js";import{h as Ua}from"./chunk-HHIR5BNR.js";import"./chunk-B6VNGUER.js";import{a as ka,b as Rr,c as Pr,f as Dr,h as Cr,i as Ga,l as jr,m as Lr,n as zr,w as Hr}from"./chunk-CDCW33GU.js";import{c as Vr,d as Fa}from"./chunk-DJEFBPF6.js";import"./chunk-DYVXH2D6.js";import"./chunk-E2J2V7JN.js";import{a as vo}from"./chunk-4QS7PGAF.js";import{a as ue}from"./chunk-NIYDRLW4.js";import{a as ja}from"./chunk-XHOTVM3O.js";import{a as Ir,b as za,e as Ha}from"./chunk-H3VY6XFU.js";import"./chunk-LNYBTIG7.js";import"./chunk-RZU6EEB3.js";import"./chunk-SFX6QP6J.js";import"./chunk-BRJSO7CG.js";import"./chunk-AATZFFI5.js";import"./chunk-YNG4NJVY.js";import"./chunk-GT3C7LC6.js";import"./chunk-EWHTP5EW.js";import"./chunk-3JBDNTAW.js";import{g as wr,h as Te,i as Tr,j as Kt,k as Or,l as B,p as Pa}from"./chunk-H63LVRK7.js";import"./chunk-JD3KGBGX.js";import{C as Ar,e as y,g as X,h as Ca,l as si,p as ri,x as Ui}from"./chunk-SJTQM4NH.js";import{i as Da}from"./chunk-NYOCZ43I.js";import"./chunk-IFFYADB3.js";import"./chunk-ZCSEBPCJ.js";import"./chunk-R2Q5NMSG.js";import"./chunk-QL456MD5.js";import"./chunk-IY6MAS3P.js";import"./chunk-RPWH7ONJ.js";import"./chunk-H76XKIVW.js";import"./chunk-UWZJQ7YC.js";import"./chunk-NC2NFLV7.js";import{a as z}from"./chunk-UJ6V7JUK.js";import{a as Ra}from"./chunk-Z5FRAQHK.js";import{b as xr}from"./chunk-LQWMDYLF.js";import"./chunk-BW3UVZYU.js";import{a as we}from"./chunk-47Q3ZDMA.js";import{a as yo}from"./chunk-7LLNOPTV.js";import"./chunk-XRRPDCIR.js";import"./chunk-XF4ZC6Y7.js";import"./chunk-D6QUKPEY.js";import"./chunk-VIAVLHRB.js";import"./chunk-UMZZ3I5D.js";import{a as br}from"./chunk-VXJKEPDS.js";import"./chunk-J7IKN4ZN.js";import"./chunk-I3S324BU.js";import"./chunk-OM7Z3UKX.js";import"./chunk-VNTMBMJI.js";import"./chunk-6KRFVLII.js";import"./chunk-OJB2TSJ7.js";import"./chunk-MCO7DSFO.js";import"./chunk-LUPAMFKK.js";import{a as ai}from"./chunk-7JD62GP7.js";import"./chunk-F47ZTJ7Y.js";import"./chunk-YXPGI3LI.js";import"./chunk-KRMYHUR3.js";import{a as lr,g as pr,t as cr,x as hr}from"./chunk-R4NNYEN7.js";import{a as Ze,c as _r}from"./chunk-PDBA6QOJ.js";import"./chunk-CF52RSJZ.js";import{a as vt,c as Mr,d as Sr}from"./chunk-ALWV3RJ2.js";import"./chunk-7C6Z24SS.js";import"./chunk-7G4KK3KW.js";import"./chunk-J3ZDC5ZE.js";import{j as dr}from"./chunk-KYNKUTEO.js";import"./chunk-QWLQUMDY.js";import{b as Qt,c as ur,g as go,j as mr,n as _o,q as fr}from"./chunk-2ETHV3H2.js";import"./chunk-AUSMAEKP.js";import"./chunk-WVCJLLRA.js";import"./chunk-MDSLION2.js";import"./chunk-OVOWBDBP.js";import"./chunk-V2KSICSA.js";import{a as g,b as Gt,c as Se,f as le,g as R,h as Ft}from"./chunk-4XUOIGFO.js";import"./chunk-7LEG2VDW.js";import"./chunk-R2HWUZ3L.js";import"./chunk-G24ZJINL.js";import"./chunk-T25YY3N7.js";import"./chunk-ALQ3STGG.js";import"./chunk-EETFV2SL.js";import{e as Fe,g as wa}from"./chunk-AM3VOA32.js";import"./chunk-SAOUSUZE.js";import"./chunk-LECQV7I4.js";import"./chunk-4HISZWR4.js";import"./chunk-33BSK37G.js";import"./chunk-TQAPQODA.js";import{c as Fi,d as Ia}from"./chunk-M2GLXRA2.js";import{c as Ta,g as Ut,h as ki,i as oi,j as Oa,k as Gi,m as Ea,n as uo,o as Ne,p as mo,r as fo,x as Aa}from"./chunk-EBWCXIFH.js";import{q as nr}from"./chunk-MRVR6F6G.js";import{i as ir}from"./chunk-WXQQZY3K.js";import{o as ho}from"./chunk-VPMDQK57.js";import"./chunk-BCREO4Q5.js";import{a as Ue,l as Be}from"./chunk-ZVHU7VE3.js";import{b as Vi,f as ct,g as Nt}from"./chunk-76YVRX2R.js";import{C as sr,D as xa,F as rr,a as gt,b as Jt,c as G,d as W,e as C,l as J,m as ce,o as ar,p as Sa,s as At,t as he,u as _t,v as de}from"./chunk-OZF6BMOL.js";import{a as O,b as pe,c as k}from"./chunk-GJP6PTKT.js";import{a as or}from"./chunk-RSDQHAJX.js";import"./chunk-HMKFQDR7.js";import{b as Js}from"./chunk-2OT2C2UU.js";import"./chunk-XIMCHX2H.js";import{b as Ks}from"./chunk-SF6Z2K5H.js";import{a as q}from"./chunk-GBTN5LIS.js";import{e as Qs}from"./chunk-JOSG37QF.js";import"./chunk-SLMQFZE3.js";import"./chunk-VNB5ZT3P.js";import"./chunk-NDG5FXLR.js";import"./chunk-EJG3F6VR.js";import"./chunk-5ODCEDHC.js";import"./chunk-BENVXA3L.js";import{l as Hi}from"./chunk-SA4OMQAD.js";import{b as Ma}from"./chunk-24BLFS5R.js";import{ba as tr,da as zi,ea as er,fa as ba}from"./chunk-JDDD6VJ4.js";import"./chunk-VOYK3LZF.js";import"./chunk-HOJTYTYD.js";import{a as ya}from"./chunk-XNEAL2YW.js";import"./chunk-J7M5V2SQ.js";import"./chunk-RQD6EDD6.js";import"./chunk-XPCG2OJX.js";import{H as qs,L as h,O as pt,W as $s,h as Me,s as Ws}from"./chunk-AUTL5LCV.js";import{S as w,w as va}from"./chunk-KUJG22IX.js";import"./chunk-OVHPPCBL.js";import{a as p}from"./chunk-W3WDPWBE.js";import{a as j,b as Li,c as Y,d as co,e as kt,k as Xs}from"./chunk-GISCFF3Z.js";import{b as H,d as Vt,g as Ys}from"./chunk-MLSR6YE6.js";import"./chunk-SNFOAZZQ.js";import"./chunk-CPDJJRWA.js";import"./chunk-DKS57BVI.js";import"./chunk-VU5W7W6Y.js";import"./chunk-HQMV3KQV.js";import{a as lo,m as Zs,q as po}from"./chunk-CRMMDK2Z.js";import"./chunk-MDAB6L5Y.js";import"./chunk-FMFGIQYB.js";import{a as v,b as x,d as Ge,h as Bs}from"./chunk-EAH6BNBL.js";var dp=e=>({vnodeSelector:"",properties:void 0,children:void 0,text:e.toString(),domNode:null}),al=(e,t,i)=>{for(let a=0,o=t.length;a<o;a++){let s=t[a];Array.isArray(s)?al(e,s,i):s!=null&&s!==!1&&(typeof s=="string"&&(s=dp(s)),i.push(s))}};function sl(e,t,i){if(Array.isArray(t))i=t,t=void 0;else if(t&&(typeof t=="string"||t.hasOwnProperty("vnodeSelector"))||i&&(typeof i=="string"||i.hasOwnProperty("vnodeSelector")))throw new Error("h called with invalid arguments");let a,o;return i&&i.length===1&&typeof i[0]=="string"?a=i[0]:i&&(o=[],al(e,i,o),o.length===0&&(o=void 0)),{vnodeSelector:e,properties:t,children:o,text:a===""?void 0:a,domNode:null}}var rl={bottom:"esri-text-overlay-item-anchor-bottom","bottom-right":"esri-text-overlay-item-anchor-bottom-right","bottom-left":"esri-text-overlay-item-anchor-bottom-left",top:"esri-text-overlay-item-anchor-top","top-right":"esri-text-overlay-item-anchor-top-right","top-left":"esri-text-overlay-item-anchor-top-left",center:"esri-text-overlay-item-anchor-center",right:"esri-text-overlay-item-anchor-right",left:"esri-text-overlay-item-anchor-left"},rt=class extends pt{get position(){return[this.x,this.y]}set position(e){this._set("x",e[0]),this._set("y",e[1])}get _textShadowColor(){let{textColor:e,backgroundColor:t}=this,i=t.clone();return i.a*=e.a,i}get _textShadow(){let e=this._textShadowColor.toCss(!0);return`0 0 ${this._textShadowSize}px ${e}`}get padding(){return .5*this.fontSize}get _borderRadius(){return this.padding}constructor(e){super(e),this.x=0,this.y=0,this.text="-",this.fontSize=14,this.anchor="center",this.visible=!0,this.isDecoration=!0,this.backgroundColor=new z([0,0,0,.6]),this.textColor=new z([255,255,255]),this._textShadowSize=1}render(){return sl("div",{classes:this._cssClasses(),styles:{left:Math.floor(this.x)+"px",top:Math.floor(this.y)+"px",visibility:this.visible?"visible":"hidden",fontSize:this.fontSize+"px",lineHeight:this.fontSize+"px",backgroundColor:this.backgroundColor.toCss(!0),color:this.textColor.toCss(!0),padding:this.padding+"px",borderRadius:this._borderRadius+"px",textShadow:this._textShadow}},[this.text])}renderCanvas(e){if(!this.visible)return;let t=e.font.replace(/^(.*?)px/,"");e.font=`${this.fontSize}px ${t}`;let i=this.padding,a=this._borderRadius,o=e.measureText(this.text).width,s=this.fontSize,r=up[this.anchor];e.textAlign="center",e.textBaseline="middle";let n=o+2*i,l=s+2*i,c=this.x+r.x*n,u=this.y+r.y*l;this._roundedRect(e,c,u,n,l,a),e.fillStyle=this.backgroundColor.toCss(!0),e.fill();let d=this.x+(r.x+.5)*n,m=this.y+(r.y+.5)*l;this._renderTextShadow(e,this.text,d,m),e.fillStyle=this.textColor.toCss(!0),e.fillText(this.text,d,m)}_renderTextShadow(e,t,i,a){e.lineJoin="miter",e.fillStyle=`rgba(${this._textShadowColor.r}, ${this._textShadowColor.g}, ${this._textShadowColor.b}, ${1/is.length})`;let o=this._textShadowSize;for(let[s,r]of is)e.fillText(t,i+o*s,a+o*r)}_roundedRect(e,t,i,a,o,s){e.beginPath(),e.moveTo(t,i+s),e.arcTo(t,i,t+s,i,s),e.lineTo(t+a-s,i),e.arcTo(t+a,i,t+a,i+s,s),e.lineTo(t+a,i+o-s),e.arcTo(t+a,i+o,t+a-s,i+o,s),e.lineTo(t+s,i+o),e.arcTo(t,i+o,t,i+o-s,s),e.closePath()}_cssClasses(){let e={"esri-text-overlay-item":!0},t;for(t in rl)e[rl[t]]=this.anchor===t;return e}};p([h()],rt.prototype,"x",void 0),p([h()],rt.prototype,"y",void 0),p([h()],rt.prototype,"position",null),p([h()],rt.prototype,"text",void 0),p([h()],rt.prototype,"fontSize",void 0),p([h()],rt.prototype,"anchor",void 0),p([h()],rt.prototype,"visible",void 0),p([h()],rt.prototype,"isDecoration",void 0),p([h()],rt.prototype,"backgroundColor",void 0),p([h()],rt.prototype,"textColor",void 0),p([h()],rt.prototype,"_textShadowSize",void 0),p([h()],rt.prototype,"_textShadowColor",null),p([h()],rt.prototype,"_textShadow",null),p([h()],rt.prototype,"padding",null),p([h()],rt.prototype,"_borderRadius",null),rt=p([w("esri.views.overlay.TextOverlayItem")],rt);var up={bottom:{x:-.5,y:-1,textAlign:"center",textBaseline:"bottom"},"bottom-left":{x:0,y:-1,textAlign:"left",textBaseline:"bottom"},"bottom-right":{x:-1,y:-1,textAlign:"right",textBaseline:"bottom"},center:{x:-.5,y:-.5,textAlign:"center",textBaseline:"middle"},left:{x:0,y:-.5,textAlign:"left",textBaseline:"middle"},right:{x:-1,y:-.5,textAlign:"right",textBaseline:"middle"},top:{x:-.5,y:0,textAlign:"center",textBaseline:"top"},"top-left":{x:0,y:0,textAlign:"left",textBaseline:"top"},"top-right":{x:-1,y:0,textAlign:"right",textBaseline:"top"}},is=[];for(let t=0;t<360;t+=360/16)is.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)]);var nl=rt;var mp=3025,fp={default:15,far:25},Ct=class extends pt{constructor(e){super(e),this.context=null,this.stagedVertex=null,this.visible=!0,this.edgeDistance="default",this._messagesUnits=null,this._labelInfos=[],this._nextLabelIndex=0}initialize(){let e=Qs(t=>Bs(this,null,function*(){let i=yield Js("esri/core/t9n/Units");Xs(t),this._messagesUnits=i}));this.addHandles([g(()=>[this.context!=null&&this.getCameraOrExtent(this.context),this.visible,this._edgeDistancePixels,this.stagedVertex,this._messagesUnits],()=>this._update()),...["vertex-add","vertex-update","vertex-remove"].map(t=>Se(()=>this.context?.editGeometryOperations,t,()=>this._update())),j(()=>e.abort()),g(()=>this._colors,t=>this._updateStyle(t))])}destroy(){for(this._nextLabelIndex=0;this._labelInfos.length;)this._destroyLabel(this._labelInfos.pop())}get updating(){return this._messagesUnits==null}get test(){}get _edgeDistancePixels(){return fp[this.edgeDistance]}get _colors(){let e=this.context?.view.effectiveTheme.textColor??z.fromArray([255,255,255]);return{textColor:e,backgroundColor:Kt(Te(e,wr.Low),.6)}}_update(){if(this.destroyed)return;this._nextLabelIndex=0;let{context:e,stagedVertex:t}=this;if(!e)return this._destroyUnusedLabels();let{editGeometryOperations:i}=e,{components:a,geometry:o,coordinateHelper:s}=i.data;if(!o)return this._destroyUnusedLabels();let r=a.length;for(let n=0;n<r;++n){let l=gp(o,i,t,s,n);if(l.length<2||!_p(l,e.view,e.elevationInfo,s.spatialReference))continue;let c=r===1&&!ir(l),u=yp,d=bp;this.toScreenPointArray(e,l[0],u);for(let m=1;m<l.length;++m){let f=l[m-1],_=l[m];this.toScreenPointArray(e,_,d),this._addLabel(e,f,u,_,d,c),[u,d]=[d,u]}}this._destroyUnusedLabels()}_updateStyle({textColor:e,backgroundColor:t}){let i=this._nextLabelIndex,a=this._labelInfos;for(let o=0;o<i;++o){let{label:s}=a[o];s.textColor=e,s.backgroundColor=t}}_addLabel(e,t,i,a,o,s){let{label:r}=this._getOrCreateLabel(e);if(!this.visible||mr(i,o)<mp)return void(r.visible=!1);let{spatialReference:n}=e.editGeometryOperations.data,l=Po(t,a,n),c=this._messagesUnits,u=pn(e.view);r.text=c!=null&&l!=null?fn(c,l,u):"",r.visible=!0;let d=o[0]-i[0],m=o[1]-i[1];s?Qt(Yt,-m,d):Qt(Yt,m,-d),_o(Yt,Yt),go(Yt,Yt,this._edgeDistancePixels),fr(qi,i,o,.5),ur(qi,qi,Yt),r.position=[qi[0],qi[1]],Math.abs(Yt[0])>Math.abs(Yt[1])?r.anchor=Yt[0]>0?"left":"right":r.anchor=-Yt[1]<0?"top":"bottom"}_getOrCreateLabel(e){let t=this._labelInfos.length>this._nextLabelIndex,{textColor:i,backgroundColor:a}=this._colors;if(t){let r=this._labelInfos[this._nextLabelIndex++],{label:n}=r;return n.textColor=i,n.backgroundColor=a,r}let o=new nl({anchor:"center",fontSize:8,textColor:i,backgroundColor:a});e.view.overlay?.items.add(o);let s={label:o};return this._labelInfos.push(s),this._nextLabelIndex=this._labelInfos.length,s}_destroyUnusedLabels(){for(;this._labelInfos.length>this._nextLabelIndex;)this._destroyLabel(this._labelInfos.pop())}_destroyLabel({label:e}){this.context?.view.overlay?.items.remove(e),e.destroy()}};function gp(e,t,i,a,o){let s=[];if(t.data.components[o].iterateVertices(l=>{s.push(a.toXYZ(l.pos,y.get()))}),o===0&&i!=null&&s.push(a.toXYZ(i,y.get())),s.length<2)return s;let r=s[0],n=s[s.length-1];return e.type==="polygon"&&s.length>2&&!sr(r,n)&&s.push(r),s}function _p(e,t,i,a){if(t.type==="2d")return!0;let o=er(a)??1,s=tr(a),r=n=>zr(t,n,a,i,Hr)??0;for(let n=1;n<e.length;++n){let l=e[n-1],c=e[n],u=(c[0]-l[0])*o,d=(c[1]-l[1])*o,m=(r(c)-r(l))*s;if(Math.abs(m)/Math.sqrt(u*u+d*d)>vp)return!1}return!0}p([h()],Ct.prototype,"context",void 0),p([h()],Ct.prototype,"stagedVertex",void 0),p([h()],Ct.prototype,"visible",void 0),p([h()],Ct.prototype,"edgeDistance",void 0),p([h()],Ct.prototype,"updating",null),p([h()],Ct.prototype,"_messagesUnits",void 0),p([h()],Ct.prototype,"_edgeDistancePixels",null),p([h()],Ct.prototype,"_colors",null),Ct=p([w("esri.views.interactive.SegmentLabels")],Ct);var vp=ct(5),Yt=Ze(),qi=Ze(),yp=Fe(),bp=Fe();var yi=class extends Ct{getCameraOrExtent({view:e}){return e.state.camera}toScreenPointArray({view:e,elevationInfo:t,editGeometryOperations:i},a,o=Fe()){let{spatialReference:s}=i.data.coordinateHelper;return un(a,s,t,e,ll),e.state.camera.projectToScreen(ll,o),o}};yi=p([w("esri.views.3d.interactive.SegmentLabels3D")],yi);var ll=O();function bi(e){let t=e.graphic;return t?[g(()=>"visible"in e?e.visible:e.displaying,i=>{i&&t.notifyMeshTransformChanged({action:Wi.EnableFastUpdates})},v({},Ft)),j(()=>t.notifyMeshTransformChanged({action:Wi.DisableFastUpdates}))]:[]}var Mi=.3;function xi(e,t){t&&Object.assign(e,t)}var os=class{constructor(t){this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=A.Opaque,this.color=t.accent}},$i=class{constructor(a){var o=a,{colors:t}=o,i=Ge(o,["colors"]);this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=t.accent,this.outlineColor=t.outline,this.renderOccluded=A.Opaque,this.hoverOutlineColor=t.selectedOutline,xi(this,i)}applyColor(t){this._apply(this.color,t)}applyOutline(t){this._apply(this.outlineColor,t)}applyHoverOutline(t){this._apply(this.hoverOutlineColor,t)}_apply(t,i){i.setParameters({color:B(t),renderOccluded:this.renderOccluded})}},as=class{constructor(a){var o=a,{colors:t}=o,i=Ge(o,["colors"]);this.size=40,this.height=.2,this.offset=.25,this.collisionPadding=2,this.renderOccluded=A.Transparent,this.minSquaredEdgeLength=900,this.color=Kt(t.accent,.5),this.hoverColor=t.accent,xi(this,i)}applyColor(t){this._apply(this.color,t)}applyHover(t){this._apply(this.hoverColor,t)}_apply(t,i){i.setParameters({color:B(t),renderOccluded:this.renderOccluded})}},ss=class{constructor(t){this.vertex=new $i({colors:t,color:t.accent,outlineColor:t.outline}),this.edge=new $i({colors:t,color:Or(Kt(t.accent,2/3),.5),outlineColor:Kt(t.outline,.5),size:8,collisionPadding:8}),this.selected=new $i({colors:t,color:t.selected,outlineColor:t.outline}),this.edgeOffset=new as({colors:t})}},Ji=class{constructor(a){var o=a,{colors:t}=o,i=Ge(o,["colors"]);this.width=1.5,this.stipplePattern=Un(3.3),this.falloff=0,this.innerWidth=1.5,this.renderOccluded=A.OccludeAndTransparent,this.color=t.selected,this.stippleOffColor=t.outline,this.innerColor=t.selected,xi(this,i)}apply(t){t.color=B(this.color),t.width=this.width,t.stipplePattern=this.stipplePattern,t.stippleOffColor=B(this.stippleOffColor),t.falloff=this.falloff,t.innerWidth=this.innerWidth,t.innerColor=B(this.innerColor),t.renderOccluded=this.renderOccluded}},rs=class{constructor(a){var o=a,{colors:t}=o,i=Ge(o,["colors"]);this.size=4,this.outlineSize=1,this.shape="square",this.color=t.selected,this.outlineColor=t.outline,xi(this,i)}apply(t){t.color=B(this.color),t.size=this.size,t.outlineSize=this.outlineSize,t.outlineColor=B(this.outlineColor),t.primitive=this.shape}},Si=class{constructor(a){var o=a,{colors:t}=o,i=Ge(o,["colors"]);this.innerWidth=1,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=Mi,this.globalAlphaContrastBoost=1.5,this.radius=3,this.innerColor=t.selected,this.glowColor=t.accent,this.heightFillColor=t.accent,xi(this,i)}apply(t,i=1){let a={glowColor:z.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:z.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*i*this.glowColor.a,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in t?t.style=a:t.laserlineStyle=a}},ns=class{constructor(t){this.outline=new Ji({colors:t,color:t.stippleOff,renderOccluded:A.OccludeAndTransparentStencil,stippleOffColor:t.stippleOn,innerWidth:0}),this.staged=new Ji({colors:t,color:t.stippleOn,renderOccluded:A.OccludeAndTransparentStencil,innerColor:t.stagedSolid,stippleOffColor:t.stippleOff}),this.shadowStyle=new Si({colors:t,globalAlpha:Mi,glowColor:t.accent,glowFalloff:8,glowWidth:8,innerColor:t.selected,innerWidth:1})}},ls=class{constructor(t){this.outline=new rs({colors:t,color:t.selected,outlineColor:t.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new Si({colors:t,globalAlpha:Mi,glowColor:t.accent,glowFalloff:1.5,glowWidth:6,innerColor:t.selected,innerWidth:1,radius:2})}},ps=class extends Ji{constructor(a){var o=a,{colors:t}=o,i=Ge(o,["colors"]);super({colors:t}),this.extensionType=Ja.GROUND_RAY,xi(this,i)}},cs=class{constructor(t){this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,this.lineObjects=new ns(t),this.pointObjects=new ls(t),this.heightPlane=new Si({colors:t,globalAlpha:Mi,glowColor:t.accent,glowFalloff:8,glowWidth:8,innerColor:t.selected,innerWidth:1}),this.heightBox=new Si({colors:t,globalAlpha:Mi,glowColor:t.accent,glowFalloff:8,glowWidth:8,innerColor:t.selected,innerWidth:0,heightFillColor:t.accent}),this.zVerticalLine=new ps({colors:t,color:Kt(t.accent,5*Mi/3),falloff:2,innerColor:Kt(t.selected,0),renderOccluded:A.OccludeAndTransparent,stipplePattern:null,width:5,extensionType:Ja.GROUND_RAY})}},at=class extends pt{constructor(e){super(e)}get colors(){let e=this.getTheme().accentColor,t=e.a;return{accent:e,contrast:Te(e),selected:z.fromArray([255,255,255,t]),selectedOutline:z.fromArray([255,255,255,t]),staged:z.fromArray([12,207,255,t]),stagedSolid:z.fromArray([12,207,255,1]),outline:z.fromArray([0,0,0,.5*t]),stippleOn:z.fromArray([255,255,255,1]),stippleOff:z.fromArray([0,0,0,.5])}}get visualElements(){return new cs(this.colors)}get manipulators(){return new ss(this.colors)}get zManipulator(){return new os(this.colors)}};p([h()],at.prototype,"colors",null),p([h()],at.prototype,"visualElements",null),p([h()],at.prototype,"manipulators",null),p([h()],at.prototype,"zManipulator",null),p([h()],at.prototype,"getTheme",void 0),at=p([w("esri.views.3d.interactive.editingTools.settings")],at);var yt=class extends Hn{constructor(t){super(t),this._attachmentOrigin=ue(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new q,this._geometry=null,this._width=1,this._color=Za(1,0,1,1),this._innerWidth=0,this._innerColor=Za(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=A.OccludeAndTransparentStencil,this._attachmentOrigin.spatialReference=t.view.spatialReference,this._laserline=new qe({view:t.view,isDecoration:t.isDecoration}),this.applyProperties(t),this.attached=t.attached??!0}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(t){return{view:t,createResources:i=>this._createObject3DResources(i),destroyResources:pl,recreateGeometry:(i,a)=>{i.geometries.length=0,this._recreateGeometry(a,i.material,i.geometries)}}}createDrapedResourceFactory(t){return{view:t,createResources:()=>this._createDrapedResources(),destroyResources:pl,recreateGeometry:i=>{i.geometries=this._createRenderGeometriesDraped(i.material),this._attachmentOriginChanged()}}}get _laserlineAttached(){return this.attached&&this.visible&&this._laserlineStyle!=null&&!this.isDraped&&this.laserlineEnabled}onAttachedChange(t){this._laserline.attached=this._laserlineAttached,t&&this._attachmentOriginChanged()}get geometry(){return this._geometry}set geometry(t){this._geometry=t,this.recreateGeometry()}get width(){return this._width}set width(t){t!==this._width&&(this._width=t,this._updateMaterial())}get color(){return this._color}set color(t){Be(t,this._color)||(Ue(this._color,t),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(t){t!==this._innerWidth&&(this._innerWidth=t,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(t){Be(t,this._innerColor)||(Ue(this._innerColor,t),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(t){let i=t!=null!=(this._stipplePattern!=null);this._stipplePattern=t,i?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(t){t&&this._stippleOffColor&&Be(t,this._stippleOffColor)||(this._stippleOffColor=t?ln(t):null,this._updateMaterial())}get falloff(){return this._falloff}set falloff(t){t!==this._falloff&&(this._falloff=t,this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(t){this._elevationInfo=t,this.recreateGeometry()}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(t){this._laserlineStyle=t,this._laserline.attached=this._laserlineAttached,t!=null&&(this._laserline.style=t)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(t){this._laserlineEnabled!==t&&(this._laserlineEnabled=t,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(t){t!==this._renderOccluded&&(this._renderOccluded=t,this._updateMaterial())}get attachmentOrigin(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;let t=this.object3dResources.resources?.geometries;if(!t||t.length===0)return null;G(wi,0,0,0);let i=0;for(let a of t)a.computeAttachmentOrigin(cl)&&(W(wi,wi,cl),i++);return i===0?null:(J(wi,wi,1/i),this.view.renderCoordsHelper.fromRenderCoords(wi,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}_updateMaterial(){this.object3dResources.resources!=null&&this.object3dResources.resources.material.setParameters(this._materialParameters),this.drapedResources.resources!=null&&this.drapedResources.resources.material.setParameters(this._materialParameters)}get _isClosed(){return this.geometry!=null&&this.geometry.type==="polygon"}get _materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:!1,isClosed:this._isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",hasPolygonOffset:!0,renderOccluded:this._normalizedRenderOccluded,isDecoration:this.isDecoration}}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===A.OccludeAndTransparentStencil?A.OccludeAndTransparent:this._renderOccluded}_recreateGeometry(t,i,a){this._createRenderGeometries(i,a);for(let o of a)t.addGeometry(o);this._attachmentOriginChanged()}_attachmentOriginChanged(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}_createObject3DResources(t){let i=new Dt(this._materialParameters),a=new Array;return this._recreateGeometry(t,i,a),{material:i,geometries:a,forEach:o=>{o(i),a.forEach(o)}}}_createDrapedResources(){let t=new Dt(this._materialParameters);return{material:t,geometries:this._createRenderGeometriesDraped(t)}}_createRenderGeometriesDraped(t){let{geometry:i,view:a}=this,o=a.basemapTerrain.spatialReference;return i==null||o==null?[]:Zn(i,o).lines.map(({position:s})=>{let r={overlayInfo:{spatialReference:o,renderCoordsHelper:a.renderCoordsHelper},attributeData:{position:s},removeDuplicateStartEnd:this._isClosed};return new Gn(zo(t,r))})}calculateMapBounds(t){if(this.object3dResources.resources==null)return!1;let i=this.view.renderCoordsHelper;for(let a of this.object3dResources.resources.geometries){let o=a.attributes.get(It.POSITION),s=Ni(o.data.length);dr(o.data,i.spatialReference,0,s,this.view.spatialReference,0,o.data.length/3),pr(t,s)}return!0}_createRenderGeometries(t,i){let a=this.geometry;if(a==null)return;let o=Bn(a,this.view.elevationProvider,this.view.renderCoordsHelper,ie.fromElevationInfo(this.elevationInfo??new yo({mode:Pr(a,null)}))),s=new Array;for(let{position:r,mapPositions:n}of o.lines){let l={mapPositions:n,attributeData:{position:r},removeDuplicateStartEnd:this._isClosed};i.push(zo(t,l)),s.push(r)}this._laserline.pathVerticalPlane=s}};function pl(e){e.geometries=[]}var cl=O(),wi=O();function hl(e,t,i,a,o){let s=Ni(3*e.length),r=Ni(s.length);e.forEach((c,u)=>{s[3*u]=c[0],s[3*u+1]=c[1],s[3*u+2]=c.length>2?c[2]:0});let n=Fn(s,t,0,r,0,s,0,s.length/3,i,a,o),l=n!=null;return{numVertices:e.length,position:s,mapPositions:r,projectionSuccess:l,sampledElevation:n}}var Qi=class extends Lo{constructor(t){super(t),this.view=null,this._renderOccluded=A.OccludeAndTransparent,this._vertices=null,this._spatialReference=null,this._color=Ia([1,127/255,0,1]),this._size=11,this._outlineColor=Ia([0,0,0,.5]),this._outlineSize=1,this._elevationInfo=null,this.applyProperties(t)}get renderOccluded(){return this._renderOccluded}set renderOccluded(t){t!==this._renderOccluded&&(this._renderOccluded=t,this._updateMaterial(),this._updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(t){this._vertices=t,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(t){this._spatialReference=t,this.recreateGeometry()}get color(){return this._color}set color(t){Be(t,this._color)||(Ue(this._color,t),this._updateMaterial())}get size(){return this._size}set size(t){t!==this._size&&(this._size=t,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(t){Be(t,this._outlineColor)||(Ue(this._outlineColor,t),this._updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(t){t!==this._outlineSize&&(this._outlineSize=t,this._updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(t){this._elevationInfo=t,this.recreateGeometry()}get _vertexMaterialParameters(){return{color:this._color,screenSizeScale:this.size,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}get _vertexOutlineMaterialParameters(){return{color:this._outlineColor,screenSizeScale:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateMaterial(){this.attached&&this._vertexMaterial.setParameters(this._vertexMaterialParameters)}_updateOutlineMaterial(){this.attached&&this._vertexOutlineMaterial.setParameters(this._vertexOutlineMaterialParameters)}_createRenderGeometries(){let t=this.vertices;if(t==null||t.length===0)return[];let i=.5,a=.5,o=hl(t,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,ie.fromElevationInfo(this.elevationInfo)),s=[],r=o.numVertices,n=o.position;for(let l=0;l<r;++l){let c=G(Mp,n[3*l],n[3*l+1],n[3*l+2]),u=dl(this._vertexMaterial,i,c),d=dl(this._vertexOutlineMaterial,a,c);s.push({vertexGeometry:u,vertexOutlineGeometry:d})}return s}createGeometries(t){let i=this._createRenderGeometries();for(let{vertexGeometry:a,vertexOutlineGeometry:o}of i)t.addGeometry(a),t.addGeometry(o)}createExternalResources(){this._vertexMaterial=new Ka(x(v({},this._vertexMaterialParameters),{writeDepth:!0,cullFace:ot.Back,screenSizeEnabled:!0})),this._vertexOutlineMaterial=new Ka(x(v({},this._vertexOutlineMaterialParameters),{forceTransparentMode:!0,writeDepth:!0,cullFace:ot.Front,screenSizeEnabled:!0,shadingEnabled:!1}))}destroyExternalResources(){this._vertexMaterial=null,this._vertexOutlineMaterial=null}forEachExternalMaterial(t){t(this._vertexMaterial),t(this._vertexOutlineMaterial)}},Mp=O();function dl(e,t,i){return $e(e,t,16,16,{offset:i})}var oe=class extends q.EventedAccessor{constructor(e){super(e),this.tracking=!1,this.displaying=!1,this.isDraped=!1}};p([h({constructOnly:!0})],oe.prototype,"graphic",void 0),p([h()],oe.prototype,"tracking",void 0),p([h()],oe.prototype,"displaying",void 0),p([h()],oe.prototype,"isDraped",void 0),oe=p([w("esri.views.3d.layers.graphics.GraphicState")],oe);var Ke=class extends Mn{constructor(e){super(e),this._activeVertexVisualElement=null,this._createGraphicState=null,this._outlineVisualElement=null,this._verticesVisualElement=null,this._verticalLineVisualElement=null,this._settings=new at({getTheme:()=>this.view.effectiveTheme}),this.geometryType=null,this.type="draw-3d"}initialize(){let{mode:e,offset:t,unit:i}=this.elevationInfo;this.internalGraphicsLayer.elevationInfo=new yo({mode:e,offset:t,unit:i})}normalizeCtorArgs(e){if(!e.elevationInfo){let t=e.hasZ??!0;return x(v({},e),{elevationInfo:Rr(t)})}return e}initializeGraphic(e){let{view:t}=this,i=this._createGraphicState=new oe({graphic:e});return Y([t.maskOccludee(e),t.trackGraphicState(i),g(()=>({element:this._outlineVisualElement,isDraped:i.isDraped}),({element:a,isDraped:o})=>{a&&(a.isDraped=o)},Ft),qs(()=>{Yi(this.tooltipInfos.mesh,this.geometryToPlace)}),this._setupLoadingIndicator(i),...bi(i)])}makeDrawOperation(){let{geometryType:e}=this,t=e!=="circle"&&e!=="rectangle";return new Rn({view:this.view,manipulators:this.manipulators,geometryType:Sn(e),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:new Dn(this.view,this.elevationInfo,[this.internalGraphicsLayer]),elevationDrawSurface:new Pn(this.elevationInfo,this.defaultZ,this.view,this.internalGraphicsLayer),hasM:!1,elevationInfo:this.elevationInfo,snappingManager:this.snappingManager,snappingVisualizer:new fe,segmentLabels:t?new yi:null,labelOptions:this.sketchOptions.labels,isDraped:this._createGraphicState?this._createGraphicState.isDraped:ka(this.hasZ,this.elevationInfo)==="on-the-ground",cursor:this.cursor,constraintsEnabled:!0})}onActiveVertexChanged(e){let{view:t}=this;if(this._activeVertexVisualElement)return this._activeVertexVisualElement.vertices=[e],this._activeVertexVisualElement.recreate(),this._updateVerticalLineVisualElement(e),j();let i=this._settings,a=i.manipulators.vertex,o=new Qi({view:t,spatialReference:t.spatialReference,vertices:[e],elevationInfo:this.internalGraphicsLayer.elevationInfo,size:a.size,outlineSize:a.outlineSize,renderOccluded:a.renderOccluded,attached:!1,isDecoration:!0});this._activeVertexVisualElement=o;let s=i.visualElements.zVerticalLine,r=new mi({view:t,extensionType:s.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:A.OccludeAndTransparent,isDecoration:!0});this._verticalLineVisualElement=r;let n=Y([g(()=>i.visualElements.zVerticalLine,l=>l.apply(r),R),g(()=>({selectedColor:B(i.colors.selected),outlineColor:B(i.manipulators.vertex.outlineColor)}),({selectedColor:l,outlineColor:c})=>{o.color=l,o.outlineColor=c},R),j(()=>{this._activeVertexVisualElement=H(this._activeVertexVisualElement),this._verticalLineVisualElement=H(this._verticalLineVisualElement)})]);return o.attached=!0,this._updateVerticalLineVisualElement(e),n}_updateVerticalLineVisualElement(e){let t=this._verticalLineVisualElement;if(!t)return;let{renderCoordsHelper:i,elevationProvider:a}=this.view;G(Ti,e[0],e[1],e[2]),ul.setFromElevationInfo(this.elevationInfo),Ti[2]=fi(Ti,a,ul,i),i.toRenderCoords(Ti,this.view.spatialReference,Ti)?(t.setStartEndFromWorldDownAtLocation(Ti),t.attached=!0):t.attached=!1}onOutlineChanged(e){if(this._outlineVisualElement)return this._outlineVisualElement.geometry=e,j();let t=this.internalGraphicsLayer.elevationInfo,{view:i}=this,a=this._settings,o=new yt({view:i,geometry:e,elevationInfo:t,isDraped:this._createGraphicState?this._createGraphicState.isDraped:ka(this.hasZ,t)==="on-the-ground",attached:!1,isDecoration:!0});this._outlineVisualElement=o;let s=Y([g(()=>a.visualElements.lineObjects.outline,r=>r.apply(o),R),g(()=>a.visualElements.lineObjects.shadowStyle,r=>r.apply(o),R),j(()=>{this._outlineVisualElement=H(this._outlineVisualElement)})]);return o.attached=!0,o.laserlineEnabled=!0,s}onRegularVerticesChanged(e){if(this._verticesVisualElement)return this._verticesVisualElement.vertices=e,j();let{view:t}=this,i=this._settings,a=i.manipulators.vertex,o=new Qi({view:t,spatialReference:t.spatialReference,vertices:e,elevationInfo:this.internalGraphicsLayer.elevationInfo,size:a.size,outlineSize:a.outlineSize,renderOccluded:a.renderOccluded,attached:!1,isDecoration:!0}),s=Y([g(()=>({color:B(i.manipulators.vertex.color),outlineColor:B(i.manipulators.vertex.outlineColor)}),({color:r,outlineColor:n})=>{o.color=r,o.outlineColor=n},R),j(()=>{this._verticesVisualElement=H(this._verticesVisualElement)})]);return o.attached=!0,this._verticesVisualElement=o,s}updateGraphicGeometry(e){if(this.geometryType!=="mesh"||e?.type!=="point")super.updateGraphicGeometry(e);else{let t=this.geometryToPlace;t?.centerAt(e),Yi(this.tooltipInfos.mesh,t);let i=this._graphic;t&&i.geometry===t||(i.geometry=t)}}_setupLoadingIndicator(e){let{drawOperation:t}=this;if(!this.geometryToPlace)return t.loading=!1,null;t.loading=!0;let i=j(()=>{t.loading=!1}),a,o=()=>a&&cancelAnimationFrame(a);return Y([Gt(()=>e.displaying,()=>{o(),a=requestAnimationFrame(()=>i.remove())},x(v({},Ft),{once:!0})),j(o),i])}};p([h({constructOnly:!0})],Ke.prototype,"elevationInfo",void 0),p([h({constructOnly:!0})],Ke.prototype,"geometryType",void 0),p([h()],Ke.prototype,"type",void 0),p([h({constructOnly:!0})],Ke.prototype,"view",void 0),Ke=p([w("esri.views.3d.interactive.editingTools.draw.DrawGraphicTool3D")],Ke);var ul=new ie,Ti=O();function ml(e){let t=Ki(e);return _r(Math.cos(t),Math.sin(t))}function Ki(e){if(e==null||e.type!=="polyline"&&e.type!=="polygon")return 0;let t=e.type==="polyline"?e.paths:e.rings,i=or();for(let a of t)for(let o=0;o<a.length-1;o++){let s=a[o],r=a[o+1],n=s[0]-r[0],l=s[1]-r[1];if(n*n+l*l>i)return Math.atan2(r[1]-s[1],r[0]-s[0])}return 0}function Xt(e,t){return Sp(e?.data.coordinateHelper.hasZ(),t)}function Sp(e,t){return!!e&&t.mode!=="on-the-ground"&&!Cr(t)}function No(e,t,i){function a(){let r=i(),n=r.sketchOptions.tooltips.effectiveEnabled?r.activeTooltipInfo:null;return x(v({},r),{activeTooltipInfo:n})}let o=!1;function s({activeTooltipInfo:r,sketchOptions:n}){o=!0,r&&(r.sketchOptions=n,hs(r,t)),e.info=r,o=!1}return Y([g(a,s,Ft),g(()=>{let r=a(),{activeTooltipInfo:n}=r;if(n)return{context:r,activeTooltipInfo:n,key:n.key,geometry:F(t)}},(r,n)=>{r&&!o&&n&&n.key!==r.key&&xp(r.activeTooltipInfo,t,r.context)},le),t.on("committed",()=>s(a())),Ao(e)])}function xp(e,t,{callbacks:i}){let a=F(t);switch(a?.type){case"mesh":to(e,a.origin,t,i),"orientation"in e&&"scale"in e&&Yi(e,a,i);break;case"point":to(e,a,t,i)}}function to(e,t,i,a){let{dx:o,dy:s,dz:r}=Eo(e,t);o===0&&s===0&&r===0||(a.onMoveStart?.(),i.operations?.move(o,s,r,nt.NEW_STEP),a.onMove?.(o,s,r),a.onMoveStop?.())}function hs(e,t){let i=F(t);if(!e||!i||i.type!=="mesh"&&i.type!=="point")return;let a=i.type==="mesh",o=a?i.origin:i;e.setLocationFromPoint(o),ds(e,o,t),e.type==="transform-mesh"&&a&&gn(e,i),e.clearInputValues()}function ds(e,t,i){e.elevation.actual=yn(t),e.elevation.visible=!!i.operations?.data.coordinateHelper.hasZ(),e.elevation.readOnly=!1,e.elevation.showAsZ=!0}var bt;(function(e){e[e.NONE=0]="NONE",e[e.ANY=1]="ANY",e[e.Z=2]="Z",e[e.XY=4]="XY"})(bt||(bt={}));var I;(function(e){e[e.TRANSLATE_Z=0]="TRANSLATE_Z",e[e.TRANSLATE_XY=1]="TRANSLATE_XY",e[e.SCALE=2]="SCALE",e[e.ROTATE=3]="ROTATE",e[e.SCALE_ROTATE=4]="SCALE_ROTATE"})(I||(I={}));var Oi=class{constructor(){this.grabbingState=bt.NONE,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}update(t){this.grabbingState=bt.NONE,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,t.forEachManipulator((i,a)=>{if(a===I.TRANSLATE_Z&&(this.zManipulator=i),i instanceof N&&(i.selected&&(this.numSelected===0&&(this.firstSelected=i),this.numSelected++),this.firstGrabbedXY==null&&i.grabbing&&a===I.TRANSLATE_XY&&(this.firstGrabbedXY=i)),i.grabbing)switch(this.grabbingState|=bt.ANY,a){case I.TRANSLATE_Z:this.grabbingState|=bt.Z;break;case I.TRANSLATE_XY:this.grabbingState|=bt.XY}})}};function fl(e){let{object:t}=e,i=wp(e),a=[i,Tp(e,i.visualElement)];return t.maskOccludee&&a.push(t.maskOccludee()),{visualElement:i.visualElement,remove:()=>Li(a)}}function wp(e){let{view:t,object:i}=e,a=F(i),o=new yt({view:t,geometry:us(a)?a:null,elevationInfo:i.elevationInfo,attached:!1,isDecoration:!0}),s=new at({getTheme:()=>t.effectiveTheme}),r=()=>{o.attached=i.visible},n=Y([g(()=>s.visualElements.lineObjects.outline,l=>l.apply(o),R),g(()=>s.visualElements.lineObjects.shadowStyle,l=>l.apply(o),R),g(()=>i.visible,r),g(()=>i.isDraped,l=>{o.isDraped=l},R),i.on("committed",()=>{let l=F(i);o.geometry=us(l)?l:null}),kt(o)]);return r(),{visualElement:o,remove:()=>n.remove()}}function Tp(e,t){let{object:i,view:a}=e,o=[],s=i.elevationInfo,r=s.mode==="on-the-ground"||!s.offset&&s.mode!=="absolute-height",n=new Oi,l=new at({getTheme:()=>a.effectiveTheme}),c=l.visualElements,u=new mi({view:a,extensionType:c.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:A.OccludeAndTransparent,isDecoration:!0}),d=ct(c.heightPlaneAngleCutoff),m=new qe({view:a,attached:!1,angleCutoff:d,isDecoration:!0}),f=ai(1);o.push(g(()=>({lineShadowStyle:l.visualElements.lineObjects.shadowStyle,pointShadowStyle:l.visualElements.pointObjects.shadowStyle,alpha:f.value}),({lineShadowStyle:E,pointShadowStyle:$,alpha:et})=>{E.apply(t,et),$.apply(u,et)},R));let _=ai(1);o.push(g(()=>({heightPlane:l.visualElements.heightPlane,alpha:_.value}),({heightPlane:E,alpha:$})=>E.apply(m,$),R));let S=()=>{n.update(e);let E=F(i);if(!i.visible||r&&(i.isDraped||!us(E)||!E.hasZ))return t.laserlineEnabled=!1,u.attached=!1,void(m.attached=!1);t.laserlineEnabled=!0;let $=n.grabbingState&bt.XY?c.laserlineAlphaMultiplier:1;f.value=$;let et=n.grabbingState&bt.Z?c.laserlineAlphaMultiplier:1;_.value=et,Op(u,n),Ep(e,t,m,n)};o.push(g(()=>l.visualElements.zVerticalLine,E=>E.apply(u),R)),o.push(i.on("committed",S),g(()=>i.visible,S),t.events.on("attachment-origin-changed",S),kt(u),kt(m));let D=[],T=()=>{Li(D),D.length=0,e.forEachManipulator(E=>D.push(E.events.on("grab-changed",S))),e.forEachManipulator(E=>D.push(E.events.on("select-changed",S))),S()};return T(),o.push(e.onManipulatorsChanged(T),co(()=>Y(D))),Y(o)}function Op(e,t){let i=t.numSelected===1?t.firstSelected:t.numSelected>1&&t.firstGrabbedXY!=null?t.firstGrabbedXY:null;i!=null?(e.setStartEndFromWorldDownAtLocation(i.renderLocation),e.attached=!0):e.attached=!1}function Ep(e,t,i,a){if(a.numSelected>0){G(ti,0,0,0);let o=0;e.forEachManipulator((s,r)=>{r===I.TRANSLATE_XY&&s.selected&&s instanceof N&&(W(ti,ti,s.renderLocation),o++)}),o>0?(i.heightManifoldTarget=J(ti,ti,1/o),i.attached=!0):i.attached=!1}else{let o=t.attachmentOrigin;o!=null&&e.view.renderCoordsHelper.toRenderCoords(o,ti)?(i.heightManifoldTarget=ti,i.attached=!0):i.attached=!1}}function us(e){return e!=null&&(e.type==="polygon"||e.type==="polyline")}var ti=O();function gl(e){let t=[],i=Ip(e,t);return Ap(e,t,i),{visualElement:i,remove:()=>Li(t)}}function Ap(e,t,i){let{view:a,object:o}=e,s=new at({getTheme:()=>a.effectiveTheme}),r=new mi({view:a,extensionType:s.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:A.OccludeAndTransparent,isDecoration:!0});t.push(g(()=>s.visualElements.zVerticalLine,T=>T.apply(r),R));let n=new qe({view:a,intersectsLineInfinite:!0,attached:!1,isDecoration:!0}),l=ct(s.visualElements.heightPlaneAngleCutoff),c=new qe({view:a,attached:!1,angleCutoff:l,isDecoration:!0}),u=o.elevationInfo,d=ie.fromElevationInfo(u),m=u.mode==="on-the-ground"||!u.offset&&u.mode!=="absolute-height",f=new Oi,_=ai(1);t.push(g(()=>({heightPlane:s.visualElements.heightPlane,alpha:_.value}),({heightPlane:T,alpha:E})=>T.apply(c,E),R));let S=ai(1);t.push(g(()=>({shadowStyle:s.visualElements.pointObjects.shadowStyle,alpha:S.value}),({shadowStyle:T,alpha:E})=>T.apply(n,E),R));let D=()=>{f.update(e);let T=ms(F(o)),E=m&&(o.isDraped||T==null||!T.hasZ),$=!0;if(E||T==null)$=!1;else{Ga(o.elevationInfo)&&(T=T.clone(),T.z=0);let it=fi(T,a.elevationProvider,d,a.renderCoordsHelper);G(Wt,T.x,T.y,it),vo(Wt,T.spatialReference,Wt,a.renderCoordsHelper.spatialReference),r.setStartEndFromWorldDownAtLocation(Wt),n.intersectsWorldUpAtLocation=Wt}let et=f.grabbingState&bt.Z?s.visualElements.laserlineAlphaMultiplier:1;_.value=et;let Et=hr(Cp);!E&&o.visible&&i.calculateMapBounds(Et)&&vo(cr(Et,Wt),a.spatialReference,Wt,a.renderCoordsHelper.spatialReference)?(c.heightManifoldTarget=Wt,c.attached=!0):c.attached=!1;let Ht=f.grabbingState&bt.XY?s.visualElements.laserlineAlphaMultiplier:1;S.value=Ht;let P=$&&o.visible&&!E;n.attached=P,r.attached=P};t.push(g(()=>[o.visible,o.isDraped],D),o.on("committed",D)),e.forEachManipulator(T=>{t.push(T.events.on("grab-changed",D))}),t.push(kt(n)),t.push(kt(r)),t.push(kt(c)),D()}function Ip(e,t){let{view:i,object:a}=e,o=new Nn({view:i,geometry:ms(F(a)),elevationInfo:a.elevationInfo,isDecoration:!0});return Rp(e,o,t),t.push(kt(o)),o}function ms(e){return e==null?null:e.type==="point"?e:e.type==="mesh"?e.anchor.clone():null}function Rp(e,t,i){let{view:a,object:o}=e,s=()=>{t.attached=o.visible},r=new at({getTheme:()=>a.effectiveTheme});Pp(e,t,i),r.visualElements.pointObjects.outline.apply(t),i.push(g(()=>o.visible,s,R))}function Pp(e,t,i){let{view:a,object:o}=e,s=null,r=l=>{s!=null&&(s.remove(),s=null),o.isDraped&&l!=null&&(s=Dp(a,l,()=>{t.geometry=l}))},n=()=>{let l=ms(F(o));l!=null&&Ga(o.elevationInfo)&&(l.z=0),r(l),t.geometry=l};i.push(o.on("committed",n),co(()=>s)),n()}function Dp(e,t,i){let a=e.elevationProvider.spatialReference;Ra(t,Wt,a);let o=Wt[0],s=Wt[1];return e.elevationProvider.on("elevation-change",r=>{ho(r.extent,o,s)&&i()})}var Wt=O(),Cp=lr();function Re(e){switch(F(e.object)?.type){case"point":case"mesh":return gl(e);case"polygon":case"polyline":return fl(e);default:return null}}var Uo=Math.ceil(46.666666666666664),Pe=160,Bo=.5,Zo=24,ei=9,_l=Pe+30,fs=Pe+53,vl=60,yl=23,bl=5*Math.PI/12,Ml=1*Math.PI/3,gs=10,_s=.2,vs=30,ys=53,bs=.2,Ms=.3,Sl=200,xl=3,wl=1e6;var jt=class{constructor(){this._available=!0}set location(t){this._forEachManipulator3D(i=>i.location=t)}set elevationAlignedLocation(t){this._forEachManipulator3D(i=>i.elevationAlignedLocation=t)}set elevationInfo(t){this._forEachManipulator3D(i=>i.elevationInfo=t)}get renderLocation(){let t;return this._forEachManipulator3D(i=>{t||(t=i.renderLocation)}),t}get available(){return this._available}set available(t){this._available=t,this._forEachManipulator3D(i=>i.available=t)}get hovering(){return this.someManipulator(t=>t.hovering)}get grabbing(){return this.someManipulator(t=>t.grabbing)}get dragging(){return this.someManipulator(t=>t.dragging)}get selected(){return this.someManipulator(t=>t.selected)}hasManipulator(t){return this.someManipulator(i=>i===t)}someManipulator(t){let i=!1;return this.forEachManipulator(a=>{!i&&t(a)&&(i=!0)}),i}_forEachManipulator3D(t){this.forEachManipulator((i,a)=>{i instanceof N&&t(i,a)})}};function De(e,t,i){let a=(o,s)=>{t({action:o,object:e,dxScreen:s.screenDeltaX,dyScreen:s.screenDeltaY})};return i((o,s,r)=>(s.next(n=>(n.action==="start"&&a("start",n),n)).next(Tn(e)).next(n=>{switch(n.action){case"start":case"update":(n.translationX||n.translationY||n.translationZ)&&a("update",n);break;case"end":a("end",n)}return n}),{steps:s,cancel:r=r.next(En(e)).next(n=>(a("end",{screenDeltaX:0,screenDeltaY:0}),n))}))}function Yo(e){if(e?.axis==null)return 1;let{mapStart:t,mapEnd:i,axis:a}=e,o=[i.x-t.x,i.y-t.y];return o[0]*a[0]+o[1]*a[1]>0?1:-1}var Xo=class extends jt{constructor(t){super(),this._handles=new Me,this._arrowManipulatorInfos=new Array,this._angle=0,this._scale=1,this._radius=70,this._updateAfterDrag=!1,this.events=new q,this._tool=t.tool,this._view=t.view,this._opaqueMaterial=this._createMaterial(),this._transparentMaterial=this._createMaterial(.5),t.radius!=null&&(this._radius=t.radius),this._createManipulators(),this.forEachManipulator(i=>this._tool.manipulators.add(i))}set orthogonalAvailable(t){this._arrowManipulatorInfos.length>=3&&(this._arrowManipulatorInfos[1].manipulator.available=t,this._arrowManipulatorInfos[3].manipulator.available=t)}destroy(){this._handles=H(this._handles),this.forEachManipulator(t=>{this._tool.manipulators.remove(t),t.destroy()}),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0}forEachManipulator(t){for(let{manipulator:i}of this._arrowManipulatorInfos)t(i,I.TRANSLATE_XY)}createManipulatedObjectDragPipeline(t,i,a){if(!i.operations)return j();let o=i.operations.data.spatialReference,s=i.graphic;return De(i,a,r=>this.createDragPipeline((n,l,c,u,d)=>({steps:l,cancel:c}=t(n,l,c,u,d),r(n,l,c)),i.elevationInfo,o,s))}createDragPipeline(t,i,a,o){return Y(this._arrowManipulatorInfos.map(({manipulator:s},r)=>K(s,(n,l,c,u,d)=>{let m=l.next(f=>x(v({},f),{manipulatorType:I.TRANSLATE_XY})).next(Ie(this._view,n.elevationAlignedLocation)).next(Qe(this._view,n.elevationAlignedLocation,i,a,o)).next(wn(n.location,this.angle+(r+1)*Math.PI*.5)).next(Pt());t(n,m,c,u,d)})))}get angle(){return this._angle}set angle(t){this._angle=t,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}get displayScale(){return this._scale}set displayScale(t){this._scale=t,this._updateManipulatorTransform()}get radius(){return this._radius}set radius(t){this._radius!==t&&(this._radius=t,this._updateManipulators())}_updateManipulators(){for(let t=0;t<this._arrowManipulatorInfos.length;t++)this._updateArrowManipulator(this._arrowManipulatorInfos[t],t);this._updateManipulatorTransform()}_updateArrowManipulator({manipulator:t,transform:i},a){let o=this._radius/70,s=54*o,r=s*Math.sqrt(3)/2,n=Je(this._opaqueMaterial,r,s/2,s/2,.02);jo(n,uo(X.get(),G(y.get(),0,-r/3,0))),t.renderObjects=[new b(n,M.Focused),new b(n.instantiate({material:this._transparentMaterial}),M.Unfocused)],t.radius=r/3*2*1.2;let l=fo(X.get(),a*Math.PI/2),c=uo(X.get(),G(y.get(),0,100*o,0));Ut(i,l,c)}_createManipulators(){for(let t=0;t<4;t++){let i=this._createArrowManipulator(t);this._arrowManipulatorInfos.push(i)}this._updateManipulatorTransform()}_updateManipulatorTransform(){let t=this.angle,i=mo(X.get(),t,k(0,0,1));if(i==null)return;let a=Ne(X.get(),G(y.get(),this.displayScale,this.displayScale,this.displayScale)),o=Ut(X.get(),a,i);for(let s of this._arrowManipulatorInfos){let r=Ut(X.get(),o,s.transform);s.manipulator.modelTransform=r}}_createArrowManipulator(t){let i=new N({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:k(0,0,1)}}),a={manipulator:i,transform:vt()};return this._updateArrowManipulator(a,t),this._handles.add(i.events.on("drag",o=>{this._updateAfterDrag&&o.action==="end"&&!this.dragging&&(this._updateManipulatorTransform(),this._updateAfterDrag=!1)})),a}_createMaterial(t=1){let i=new Bt({cullFace:ot.Back,renderOccluded:A.Transparent,isDecoration:!0});return this._handles.add(g(()=>z.toUnitRGBA(this._view.effectiveTheme.accentColor),a=>{a[3]*=t,i.setParameters({color:a})},R)),i}get test(){}};var Wo=class{constructor(){this._view=null,this._elevationInfo=null,this._lastDragEvent=null,this._next=null,this._enabled=!1}get enabled(){return this._enabled}set enabled(t){if(this._enabled!==t&&this._lastDragEvent!=null&&this._next!=null){let i=this._lastDragEvent.mapEnd,a=this._snap(this._lastDragEvent.screenEnd);if(a!=null){let o={action:"update",mapStart:this._lastDragEvent.mapStart,mapEnd:t===!0?a:i,screenStart:this._lastDragEvent.screenEnd,screenEnd:this._lastDragEvent.screenEnd};this._next.execute(o)}}this._enabled=t}_snap(t){let i=this._view!=null?this._view.toMap(t,{exclude:[]}):null;return i!=null&&this._view!=null&&(i.z=jr(i,this._view,this._elevationInfo)),i}createDragEventPipelineStep(t,i){this._view=t,this._elevationInfo=i,this._lastDragEvent=null;let a=new ui;return this._next=a,[o=>{if(this._lastDragEvent=o.action!=="end"?v({},o):null,this._enabled){let s=this._snap(o.screenEnd);return s!=null?{action:o.action,mapStart:o.mapStart,mapEnd:s,screenStart:o.screenStart,screenEnd:o.screenEnd}:null}return{action:o.action,mapStart:o.mapStart,mapEnd:o.mapEnd,screenStart:o.screenStart,screenEnd:o.screenEnd}},a]}};var qo=class extends jt{constructor(t){super(),this._handles=new Me,this._snapToScene=new Wo,this._scale=1,this._radius=70,this._view=t.view,this._tool=t.tool,this._discMaterial=this._createMaterial(),this._discMaterialTransparent=this._createMaterial(.5),t.snapToScene!=null&&(this.snapToScene=t.snapToScene),t.radius!=null&&(this._radius=t.radius),this._createManipulator(),this.forEachManipulator(i=>this._tool.manipulators.add(i))}destroy(){this._handles=H(this._handles),this.forEachManipulator(t=>{this._tool.manipulators.remove(t),t.destroy()}),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(t){t(this._manipulator,I.TRANSLATE_XY)}get displayScale(){return this._scale}set displayScale(t){this._scale=t,this._updateManipulatorTransform()}get snapToScene(){return this._snapToScene.enabled}set snapToScene(t){this._snapToScene.enabled=t}get radius(){return this._radius}set radius(t){t!==this._radius&&(this._radius=t,this._updateManipulator())}get discManipulator(){return this._manipulator}createManipulatedObjectDragPipeline(t,i,a){if(!i.operations)return j();let o=i.graphic,s=i.elevationInfo,r=i.operations.data.spatialReference;return De(i,a,n=>this.createDragPipeline((l,c,u,d,m)=>({steps:c,cancel:u}=t(l,c,u,d,m),n(l,c,u)),s,r,o))}createDragPipeline(t,i,a,o){let s=this._view;return K(this._manipulator,(r,n,l,c,u)=>{let d=n.next(Ie(s,r.elevationAlignedLocation)).next(Qe(s,r.elevationAlignedLocation,i,a,o)).next(...this._snapToScene.createDragEventPipelineStep(s,i)).next(m=>x(v({},m),{manipulatorType:I.TRANSLATE_XY})).next(Pt());t(r,d,l,c,u)})}_updateManipulatorTransform(){let t=Ne(X.get(),G(y.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=t}_createManipulator(){let t=this._view;this._manipulator=new N({view:t,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:k(0,0,1)},worldOriented:!0}),this._updateManipulator()}_updateManipulator(){let t=Vn(this._discMaterial,.02,1,128,k(0,0,1),k(0,0,0));t.transformation=Ne(vt(),k(this._radius,this._radius,this._radius)),this._manipulator.renderObjects=[new b(t,M.Focused),new b(t.instantiate({material:this._discMaterialTransparent}),M.Unfocused)],this._manipulator.radius=80*(this._radius/70)}_createMaterial(t=1){let i=new Bt({cullFace:ot.Back,renderOccluded:A.Transparent,isDecoration:!0});return this._handles.add(g(()=>z.toUnitRGBA(this._view.effectiveTheme.accentColor),a=>{a[3]*=t,i.setParameters({color:a})},R)),i}get test(){}};var $o=class extends jt{constructor(t){super(),this._radius=70,this.events=new q,this._tool=t.tool,this._view=t.view;let i=new at({getTheme:()=>this._view.effectiveTheme});this._settings=i,t.radius!=null&&(this._radius=t.radius);let a=this._view.effectiveTheme.accentColor;this._materials={materialUnfocused:Zt(Ce(a,1,.25),A.Occlude),materialFocused:Zt(Ce(a,1,0),A.Occlude),materialOccludedUnfocused:Zt(Ce(a,.7,0),i.zManipulator.renderOccluded),materialOccludedFocused:Zt(Ce(a,.85,0),i.zManipulator.renderOccluded)},this._themeHandle=g(()=>this._view.effectiveTheme.accentColor,o=>{let s=Ce(o,1,.25),r=Ce(o,1,0),n=Ce(o,.7,0),l=Ce(o,.85,0),{materialUnfocused:c,materialFocused:u,materialOccludedUnfocused:d,materialOccludedFocused:m}=this._materials;c.setParameters({color:s}),u.setParameters({color:r}),d.setParameters({color:n}),m.setParameters({color:l})}),this._createManipulator(),this.forEachManipulator(o=>this._tool.manipulators.add(o))}destroy(){this._themeHandle=Vt(this._themeHandle),this._manipulator.applyObjectTransform=Vp,this.forEachManipulator(t=>{this._tool.manipulators.remove(t),t.destroy()})}forEachManipulator(t){t(this._manipulator,I.TRANSLATE_Z)}createManipulatedObjectDragPipeline(t,i,a){if(!i.operations)return j();let o=i.operations.data.spatialReference;return De(i,a,s=>this.createDragPipeline((r,n,l,c,u)=>({steps:n,cancel:l}=t(r,n,l,c,u),s(r,n,l)),o))}createDragPipeline(t,i){let a=this._view;return K(this._manipulator,(o,s,r,n,l)=>{let c=s.next(u=>x(v({},u),{manipulatorType:I.TRANSLATE_Z})).next(Vo(a,o.renderLocation,i)).next(Pt());t(o,c,r,n,l)})}get radius(){return this._radius}set radius(t){t!==this._radius&&(this._radius=t,this._updateManipulator())}_updateManipulator(){let t=this._settings,i=this._radius/70,a=t.zManipulator.height*i,o=t.zManipulator.coneHeight*i,s=t.zManipulator.coneWidth*i,r=t.zManipulator.width*i,n=[k(0,0,0),k(0,0,a)],l=[k(0,0,0),k(0,0,a+o)],c=(D=>{let T=vt();return ki(T,T,[0,0,a]),Gi(T,T,Math.PI/2),T})(),{materialUnfocused:u,materialFocused:d,materialOccludedUnfocused:m,materialOccludedFocused:f}=this._materials,_=kn(u,n,r/2,16,!1),S=Xi(u,o,s/2,16,!1);S.transformation=c,this._manipulator.renderObjects=[new b(S,M.Unfocused),new b(_,M.Unfocused),new b(S.instantiate({material:d}),M.Focused),new b(_.instantiate({material:d}),M.Focused),new b(S.instantiate({material:m}),M.Unfocused),new b(_.instantiate({material:m}),M.Unfocused),new b(S.instantiate({material:f}),M.Focused),new b(_.instantiate({material:f}),M.Focused)],this._manipulator.radius=r/2+2,this._manipulator.collisionType={type:"line",paths:[l]}}_createManipulator(){let t=this._view,i=new N({view:t,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});i.applyObjectTransform=a=>{let o=t.state.camera,s=Tl;t.renderCoordsHelper.toRenderCoords(this._manipulator.elevationAlignedLocation,s);let r=rr(o.eye,s),n=o.computeRenderPixelSizeAtDist(r),l=C(Ei,s,o.eye);At(l,l);let c=Hp;t.renderCoordsHelper.worldUpAtPosition(Tl,c);let u=Math.abs(he(l,c)),d=_t(Ei,l,c),m=_t(Ei,d,c),f=Vi(u,.01,1),_=1-Math.sqrt(1-f*f)/f/o.fullWidth,S=this._settings,D=this._radius/70,T=S.zManipulator.width*D;J(m,At(m,m),(1/_-1)*r+n*T),a[12]-=Ei[0],a[13]-=Ei[1],a[14]-=Ei[2]},this._manipulator=i,this._updateManipulator()}get test(){}};function Ce(e,t,i){let a=Tr(e,i);return a.a*=t,z.toUnitRGBA(a)}var Tl=O(),Ei=O(),Hp=O(),Vp=()=>{};var Lt=class extends jt{constructor(t){super(),this._handles=new Me,this._interactive=!0;let{tool:i,view:a,snapToScene:o,radius:s}=t;this._view=a,this.xyManipulation=new qo({tool:i,view:a,snapToScene:o,radius:s}),this.xyAxisManipulation=new Xo({tool:i,view:a,radius:s}),this.zManipulation=new $o({tool:i,view:a,radius:s}),this.xyManipulation.available=t.xyAvailable,this.xyAxisManipulation.available=t.xyAxisAvailable,this.zManipulation.available=t.zAvailable,this._autoHideXYAxis(),this.forEachManipulator(r=>this._handles.add(r.events.on("grab-changed",()=>this._updateManipulatorInteractivity())))}destroy(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}createManipulatedObjectDragPipeline(t,i,a){return Y([this.xyManipulation.createManipulatedObjectDragPipeline((o,s,r,n,l)=>t(V.XY,o,s,r,n,l),i,a),this.xyAxisManipulation.createManipulatedObjectDragPipeline((o,s,r,n,l)=>t(V.XY_AXIS,o,s,r,n,l),i,a),this.zManipulation.createManipulatedObjectDragPipeline((o,s,r,n,l)=>t(V.Z,o,s,r,n,l),i,a)])}createDragPipeline(t,i,a,o){return Y([this.xyManipulation.createDragPipeline((s,r,n,l,c)=>t(V.XY,s,r,n,l,c),i,a,o),this.xyAxisManipulation.createDragPipeline((s,r,n,l,c)=>t(V.XY_AXIS,s,r,n,l,c),i,a,o),this.zManipulation.createDragPipeline((s,r,n,l,c)=>t(V.Z,s,r,n,l,c),a)])}set snapToScene(t){this.xyManipulation.snapToScene=t}set angle(t){this.xyAxisManipulation.angle=t}set interactive(t){this._interactive!==t&&(this._interactive=t,this._updateManipulatorInteractivity())}set radius(t){this.xyAxisManipulation.radius=t,this.xyManipulation.radius=t,this.zManipulation.radius=t}set displayScale(t){this.xyManipulation.displayScale=t,this.xyAxisManipulation.displayScale=t}forEachManipulator(t){this.xyManipulation.forEachManipulator(i=>t(i,I.TRANSLATE_XY)),this.xyAxisManipulation.forEachManipulator(i=>t(i,I.TRANSLATE_XY)),this.zManipulation.forEachManipulator(i=>t(i,I.TRANSLATE_Z))}get _xyAxisVisible(){let t=this.xyManipulation.someManipulator(i=>i.focused)||this.xyAxisManipulation.someManipulator(i=>i.focused);return this._view.inputManager&&this._view.inputManager.latestPointerType==="touch"||t}_autoHideXYAxis(){let t=this.xyAxisManipulation,i=this.xyManipulation;if(lo("esri-mobile"))return;let a=[];i.forEachManipulator(s=>a.push(s)),t.forEachManipulator(s=>a.push(s));let o=()=>{let s=[];this._xyAxisVisible||t.forEachManipulator(r=>s.push(r.disableDisplay())),this._handles.remove(Ol),this._handles.add(s,Ol)};for(let s of a)this._handles.add(s.events.on("focus-changed",o));this._view.inputManager&&this._handles.add(Gt(()=>this._view.inputManager?.latestPointerType,o)),o()}_updateManipulatorInteractivity(){let t=this.grabbing;this.forEachManipulator(i=>{i.interactive=!t&&this._interactive||i.grabbing})}static radiusForSymbol(t){let i=t!=null&&t.type==="point-3d"&&t.symbolLayers;return i&&i.some(a=>a.type==="icon")?Uo:70}},Ol="disable-xy-axis-display",V;(function(e){e[e.XY=0]="XY",e[e.XY_AXIS=1]="XY_AXIS",e[e.Z=2]="Z"})(V||(V={}));var je=class extends jt{constructor(t){super(),this._view=t.view,this._tool=t.tool,this._object=t.object,this._manipulator=this._object.createManipulator?.({selectable:!0,cursor:"move"}),this.forEachManipulator(i=>this._tool.manipulators.add(i))}destroy(){this.forEachManipulator(t=>{this._tool.manipulators.remove(t),t.destroy()}),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(t){this._manipulator&&t(this._manipulator,I.TRANSLATE_XY)}createManipulatedObjectDragPipeline(t){return De(this._object,t,i=>this.createDragPipeline(i))}createDragPipeline(t){if(!this._manipulator)return j();let i=this._view;return K(this._manipulator,(a,o,s,r,n)=>{let l=this._object.operations?.data.spatialReference,c=o.next(u=>l?u:null).next(Xn(n,i,this._object,l)).next(me()).next(Pt());t(a,c,s,r,n)})}};var Le=class extends dt{constructor(e){super(e),this.type="translate-xy",this.distance=st}};p([h()],Le.prototype,"type",void 0),p([h()],Le.prototype,"distance",void 0),Le=p([w("esri.views.interactive.tooltip.infos.TranslateXYTooltipInfo")],Le);var ae=class extends dt{constructor(e){super(e),this.type="translate-z",this.distance=st}clear(){this.distance=st}};p([h()],ae.prototype,"type",void 0),p([h()],ae.prototype,"distance",void 0),ae=p([w("esri.views.interactive.tooltip.infos.TranslateZTooltipInfo")],ae);var Jo=class{constructor(t){this.objects=t,this.type="move-start"}},Qo=class{constructor(t,i,a){this.dx=t,this.dy=i,this.objects=a,this.type="move"}},eo=class{constructor(t){this.objects=t,this.type="move-stop"}},se=Symbol("manipulators"),El=Symbol("tooltips"),Ot=class extends Ae{constructor(e){super(e),this._infos=new Map,this.events=new q,this.objects=new Ks,this.enableZ=!0,this.sketchOptions=new Rt,this.type="move-3d",this._latestTooltipInfo=null,this._translateTooltipInfo=null,this._translateXYTooltipInfo=null,this._translateZTooltipInfo=null,this._updatingHandles=new we,this._moveManipulation=null}initialize(){let{view:e}=this;this.tooltip=new te({view:e}),this.addHandles([this.objects.on("change",i=>{i.removed.forEach(a=>this.removeHandles(a)),this._updateObjectInfos(i),this._setupFastTransformUpdates(i.added),this._refreshManipulators()}),this.objects.on("change",()=>this._connectTooltips())]);let t=this.objects.toArray();this._updateObjectInfos({added:t,removed:[]}),this._setupFastTransformUpdates(t),this._refreshManipulators(),this._connectTooltips(),this.finishToolCreation()}destroy(){this.tooltip=H(this.tooltip),this._moveManipulation=H(this._moveManipulation),this._set("view",null),this._updatingHandles.destroy()}onInputEvent(e){if(!this.destroyed&&!ci(e,this.tooltip))return super.onInputEvent(e)}get updating(){return this._updatingHandles.updating}get _shouldShowMovePointTooltip(){let{objects:e}=this;if(e.length!==1)return!1;let t=F(e.at(0))?.type;return t==="point"||t==="mesh"}get activeTooltipInfo(){return this._shouldShowMovePointTooltip?this._movePointTooltipInfo:this._latestTooltipInfo}reset(){}_updateObjectInfos({added:e,removed:t}){for(let i of e){if(hn(i)!==cn.SUPPORTED)continue;let a=new Ts(i);this._infos.set(i,a)}for(let i of t)this._infos.delete(i)}_setupFastTransformUpdates(e){for(let t of e){let i=this._infos.get(t);this.addHandles(bi(i.object),t)}}_refreshManipulators(){if(this.removeHandles(se),this._moveManipulation=H(this._moveManipulation),this.manipulators.removeAll(),this._infos.size===0)return;let e=Array.from(this._infos.values());this._createManipulators(e),this._createVisualElements(e),this._updateMoveManipulation(e)}_createManipulators(e){for(let t of e){let i=t.object;t.manipulationXY=new je({tool:this,view:this.view,object:i}),t.manipulationXY.forEachManipulator(a=>{this.addHandles([a.events.on("immediate-click",o=>{this.events.emit("immediate-click",x(v({},o),{object:i})),o.stopPropagation()}),a.events.on("grab-changed",({action:o})=>{o==="start"?this._showTooltip(V.XY):this._hideTooltip()})],se)}),this.addHandles(t.manipulationXY.createDragPipeline((a,o,s,r)=>this._buildDragEventPipeline(e,V.XY,a,o,s,r)),se)}this._createMoveManipulation(e)}_createMoveManipulation(e){let t=new Lt({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:e.length===1?Lt.radiusForSymbol(e[0].object.graphic?.symbol):70});this._moveManipulation=t,t.elevationInfo={mode:"absolute-height",offset:0},t.forEachManipulator(n=>{this.addHandles(n.events.on("immediate-click",l=>{let c=this.objects.at(0);!t.zManipulation.hasManipulator(n)&&this.objects.length===1&&c&&this.events.emit("immediate-click",x(v({},l),{object:c})),l.stopPropagation()}),se)});let i=n=>l=>{this.addHandles([l.events.on("focus-changed",({action:c})=>{c==="focus"?this._showTooltip(n):this._hideTooltip()}),l.events.on("grab-changed",()=>{this._latestTooltipInfo&&(this._latestTooltipInfo.distance=st)})],se)};this._moveManipulation.xyManipulation.forEachManipulator(i(V.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(i(V.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(i(V.Z));let a=()=>this._updateMoveManipulation(e);for(let n of e)this.addHandles([n.object.on("committed",a),g(()=>n.object.visible,a)],se);let o=e[e.length-1];this.addHandles(o.object.on("committed",()=>this._updateMoveManipulationAngle(o)),se);let{object:s}=o,{operations:r}=s;if(r){let n=s.graphic;this.addHandles(t.createDragPipeline((l,c,u,d,m)=>this._buildDragEventPipeline(e,l,c,u,d,m),s.elevationInfo,r.data.spatialReference,n),se)}this._updateMoveManipulationAngle(o)}_createVisualElements(e){for(let t of e){let i=t.object,a=Re({view:this.view,object:i,forEachManipulator:o=>{t.manipulationXY?.forEachManipulator(o),this._moveManipulation?.forEachManipulator(o)},onManipulatorsChanged:()=>j()});a!=null&&(t.geometryRepresentation=a.visualElement,t.geometryRepresentation instanceof yt&&this.addHandles([t.geometryRepresentation.events.on("attachment-origin-changed",()=>{t.object.isDraped||this._updateMoveManipulation(e)}),g(()=>t.object.isDraped,()=>this._updateMoveManipulation(e))],se),this.addHandles(a,se))}}_updateMoveManipulationAngle(e){this._moveManipulation&&(this._moveManipulation.angle=Ki(F(e.object)))}_updateMoveManipulation(e){let t=ue(0,0,0,this.view.spatialReference),i=0,a=!1,o=this._moveManipulation;if(o){for(let s of e){if(!s.object.visible)continue;this.enableZ&&Xt(s.object.operations,s.object.elevationInfo)&&(a=!0);let r=s.geometryRepresentation instanceof yt&&!s.object.isDraped?s.geometryRepresentation.attachmentOrigin:s.object.origin;if(r!=null){let{x:n,y:l,z:c}=r;t.x+=n,t.y+=l,c&&(t.z??=0,t.z+=c),i++}}i>0?(t.x/=i,t.y/=i,t.z??=0,t.z/=i,o.location=t,o.xyManipulation.available=!0,o.xyAxisManipulation.available=!0,o.zManipulation.available=a):o.available=!1}}_buildDragEventPipeline(e,t,i,a,o,s){let r=[],n=[],l=null,c=null,u=()=>{for(let d of r)d.dragging=!1;r.length=0,n.length=0,l=null,c=null,this._moveManipulation&&(this._moveManipulation.interactive=!0)};if(e.length===1&&t===V.XY){let d=e[0].object;({steps:a,cancel:o}=this._buildSnappingPipelineSteps(d,d.elevationInfo,a,o,s))}return o=o.next(d=>c?.(d)).next(()=>(n.length&&this.events.emit("move-stop",new eo(n)),this.destroyed||u(),null)),{steps:a=a.next(d=>{if(d.action==="start"){r.length=0,n.length=0;for(let m of e)m.dragging||!m.manipulationXY?.hasManipulator(i)&&m.manipulationXY?.grabbing||(r.push(m),n.push(m.object),m.dragging=!0);if(n.length!==0&&(this._moveManipulation&&(this._moveManipulation.interactive=!1),l=On(n),c=An(n),this._emitRecordUndo(),this.events.emit("move-start",new Jo(n)),this.destroyed))return null}return n.length!==0?d:null}).next(d=>l?.(d)).next(d=>(this._updateMoveTooltip(t,d),d)).next(d=>{switch(d.action){case"start":case"update":if(d.translationX||d.translationY||d.translationZ){let m=this.view.toScreen(d.mapStart),f=this.view.toScreen(d.mapEnd),_=f.x-m.x,S=f.y-m.y;if(this.events.emit("move",new Qo(_,S,n)),this.destroyed)return null}break;case"end":if(this.events.emit("move-stop",new eo(n)),this.destroyed)return null;u()}return null}),cancel:o}}_connectTooltips(){let e;if(this.removeHandles(El),this._shouldShowMovePointTooltip){let t=this.objects.at(0),{events:i}=this;this._movePointTooltipInfo??=new Fo({viewType:this.view.type,sketchOptions:this.sketchOptions});let a={onMoveStart:()=>{this._emitRecordUndo(),i.emit("move-start",new Jo([t]))},onMove:()=>i.emit("move",new Qo(0,0,[t])),onMoveStop:()=>i.emit("move-stop",new eo([t]))};e=No(this.tooltip,t,()=>({sketchOptions:this.sketchOptions,activeTooltipInfo:this._movePointTooltipInfo,callbacks:a}))}else e=g(()=>this.sketchOptions.tooltips.effectiveEnabled?this._latestTooltipInfo:null,t=>{this.tooltip.info=t},Ft);this.addHandles(e,El)}_showTooltip(e){this._shouldShowMovePointTooltip||this._updateMoveTooltip(e)}_hideTooltip(){this._shouldShowMovePointTooltip||(this.tooltip?.clear(),this._latestTooltipInfo=null)}_updateMoveTooltip(e,t){if(this._shouldShowMovePointTooltip)return;let{sketchOptions:i}=this;switch(e){case V.XY:this._latestTooltipInfo=this._translateTooltipInfo??=new vi({sketchOptions:i}),ws(this._latestTooltipInfo,t,(a,o)=>hi(a,o));break;case V.XY_AXIS:this._latestTooltipInfo=this._translateXYTooltipInfo??=new Le({sketchOptions:i}),ws(this._latestTooltipInfo,t,(a,o)=>Oo(hi(a,o),Yo(t)));break;case V.Z:this._latestTooltipInfo=this._translateZTooltipInfo??=new ae({sketchOptions:i}),ws(this._latestTooltipInfo,t,Ro)}this._latestTooltipInfo.sketchOptions=i}_emitRecordUndo(){let e=this.objects.toArray().map(t=>t.createUndoRecord?.()).filter(po);e.length>0&&this.events.emit("record-undo",{updates:e})}_buildSnappingPipelineSteps(e,t,i,a,o){let s=F(e);if(s==null||s.type!=="point"&&s.type!=="mesh")return{steps:i,cancel:a};let r=(s.type==="point"?s:s.anchor).clone(),n=new Xe({elevationInfo:t,pointer:o,editGeometryOperations:di.fromGeometry(r,this.view.state.viewingMode),visualizer:new fe,excludeFeature:e.graphic}),l=this.snappingManager,{snappingStep:c,cancelSnapping:u}=We({snappingContext:n,snappingManager:l,updatingHandles:this._updatingHandles});return a=a.next(u),{steps:i=i.next(d=>(r.z=Lr(this.view,r,e.elevationInfo,{mode:"absolute-height",offset:0}),x(v({},d),{snapOrigin:n.coordinateHelper.pointToVector(r)}))).next(...c),cancel:a}}};p([h({constructOnly:!0,nonNullable:!0})],Ot.prototype,"view",void 0),p([h()],Ot.prototype,"objects",void 0),p([h({constructOnly:!0,nonNullable:!0})],Ot.prototype,"enableZ",void 0),p([h({constructOnly:!0,type:Rt})],Ot.prototype,"sketchOptions",void 0),p([h({constructOnly:!0})],Ot.prototype,"snappingManager",void 0),p([h()],Ot.prototype,"type",void 0),p([h()],Ot.prototype,"updating",null),p([h()],Ot.prototype,"_latestTooltipInfo",void 0),p([h()],Ot.prototype,"_shouldShowMovePointTooltip",null),p([h()],Ot.prototype,"activeTooltipInfo",null),Ot=p([w("esri.views.3d.interactive.editingTools.move.MoveTool3D")],Ot);var Ts=class{constructor(t){this.object=t,this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1}};function ws(e,t,i){if(t==null||t.action==="end")return void(e.distance=st);let{mapStart:a,mapEnd:o}=t,s=i(a,o);e.distance=s??st}function Os(e,t,i){let a=i.mode==="on-the-ground"?qa.XY:qa.XYZ;return new xn(e,a,t,0)}function Es(e,t,i){let a=O();if(!e.renderCoordsHelper.toRenderCoords(t,a))return null;let o=Al(e,t,i.plane),s=Al(e,t,i.edgeDirection);if(o==null||s==null)return null;let r=_t(O(),o,s);return ri(a,r,si())}function Al(e,t,i){let a=ue(t.x+i[0],t.y+i[1],t.z+i[2],t.spatialReference),o=O(),s=O();return e.renderCoordsHelper.toRenderCoords(t,o)&&e.renderCoordsHelper.toRenderCoords(a,s)?xa(s,o,s):null}function Rl(e,t,i){let a=e,o=xa(O(),t,i),s=_t(O(),o,a),r=_t(O(),o,s);return Mr(o[0],o[1],o[2],0,s[0],s[1],s[2],0,r[0],r[1],r[2],0,0,0,0,1)}function Pl(e,t,i){let a=i.projectToRenderScreen(e,wa()),o=i.projectToRenderScreen(t,wa());return a!=null&&o!=null?Sa(C(a,a,o)):0}var ze=class extends dt{constructor(e){super(e),this.type="reshape-edge-offset",this.distance=st,this.area=null,this.totalLength=null}};p([h()],ze.prototype,"type",void 0),p([h()],ze.prototype,"distance",void 0),p([h()],ze.prototype,"area",void 0),p([h()],ze.prototype,"totalLength",void 0),ze=p([w("esri.views.interactive.tooltip.infos.ReshapeEdgeOffsetTooltipInfo")],ze);function Dl(e,t){let i=t?.type;return{edgeOffset:new ze({sketchOptions:e,viewType:i}),movePoint:new Fo({sketchOptions:e,viewType:i}),selectedVertex:new Qn({sketchOptions:e,viewType:i}),translate:new vi({sketchOptions:e,viewType:i}),translateXY:new Le({sketchOptions:e,viewType:i}),translateZ:new ae({sketchOptions:e,viewType:i})}}function Cl(e,t,i){function a(){let r=i(),n=r.sketchOptions.tooltips.effectiveEnabled?r.activeTooltipInfo:null;return x(v({},r),{activeTooltipInfo:n})}let o=!1;function s(r){o=!0,Fp(t,r),e.info=r.activeTooltipInfo,o=!1}return Y([g(a,s,Ft),g(()=>{let r=a(),{activeTooltipInfo:n}=r;if(n&&"key"in n)return{context:r,activeTooltipInfo:n,key:n.key,geometry:F(t)}},(r,n)=>{r&&!o&&n&&n.key!==r.key&&kp(r.activeTooltipInfo,t,r.context)},le),t.on("committed",()=>s(a())),Ao(e)])}function kp(e,t,{selectedVertexManipulatorInfo:i,callbacks:a}){let o=F(t);switch(o?.type){case"mesh":e.type==="move-point"&&to(e,o.origin,t,a);break;case"point":e.type==="move-point"&&to(e,o,t,a);break;case"polyline":case"polygon":e.type==="selected-vertex"&&Gp(e,i,t,a)}}function Gp(e,t,i,a){if(t?.type!=="vertex")return;let{dx:o,dy:s,dz:r}=Eo(e,t.manipulator.location);o===0&&s===0&&r===0||(a.onReshapeStart?.(),i.operations?.moveVertices([t.handle],o,s,r,nt.NEW_STEP),a.onReshape?.(),a.onReshapeStop?.())}function Fp(e,{activeTooltipInfo:t,selectedVertexManipulatorInfo:i,sketchOptions:a}){if(t)switch(t.sketchOptions=a,t?.type){case"move-point":hs(t,e);break;case"selected-vertex":Np(t,i,e)}}function Np(e,t,i){if(!e||e.type!=="selected-vertex")return;let a=t?.manipulator.location;e.setLocationFromPoint(a),ds(e,a,i);let o=i.operations?.data.geometry;switch(o?.type){case"polygon":e.geometryType="polygon",e.totalLength.visible=!1,e.area.actual=Xa(o);break;case"polyline":e.geometryType="polyline",e.totalLength.actual=Wa(o),e.area.visible=!1}}function jl(e,t,{sketchOptions:i,tooltipInfos:a}){let o=null;switch(e){case V.XY:o=a.translate,As(o,t,(s,r)=>hi(s,r));break;case V.XY_AXIS:o=a.translateXY,As(o,t,(s,r)=>Oo(hi(s,r),Yo(t)));break;case V.Z:o=a.translateZ,As(o,t,Ro)}return o.sketchOptions=i,o}function As(e,t,i){if(t!=null&&t.action!=="end"){let{mapStart:a,mapEnd:o}=t,s=i(a,o);e.distance=s??st}else e.distance=st}function Ll(e,t,{sketchOptions:i,tooltipInfos:a}){let o=a.edgeOffset;if(o.distance=st,t!=null&&t.action!=="end"){let r=e.operations,{mapEnd:n,signedDistance:l,operation:c}=t;if(l!=null&&r!=null){let u=r.data.coordinateHelper,d=l*c.selectedArrow;o.distance=Up(e.isDraped,d,n,c.plane,u)}}let s=e.operations?.data.geometry;return o.area=s?.type==="polygon"?Xa(s):null,o.totalLength=s?.type==="polyline"?Wa(s):null,o.sketchOptions=i,o}function Up(e,t,i,a,o){if(e){let s=o.toXYZ(o.pointToVector(i)),r=Ar(a,s,y.get()),n=mn(r,s,o.spatialReference);if(n!=null)return pi(n.value*Math.sign(t),n.unit)}return pi(t*zi(i.spatialReference),"meters")}var zl=Symbol(),U=class extends pt{get grabbingOrDragging(){return this._numGrabbing+this._numDragging>0}get _operations(){return this.object.operations}constructor(e){super(e),this._selectedIndex=0,this._manipulatorHandles=new Me,this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0,this._reshapeEventState=Z.NONE,this._updatingHandles=new we,this._recreatingManipulators=!1,this._settings=new at({getTheme:()=>this.view.effectiveTheme}),this.events=new q,this.activeTooltipInfo=null,this._vertexLaserLineVisualElement=null}initialize(){let{view:e}=this,t=this._settings.manipulators,i=t.vertex;this.tooltipInfos=Dl(this._sketchOptions,e),this._vertexManipulatorMaterial=Zt(B(i.color),i.renderOccluded),this._vertexManipulatorOutlineMaterial=_i(B(i.outlineColor),i.renderOccluded),this._vertexManipulatorHoverOutlineMaterial=_i(B(i.hoverOutlineColor),i.renderOccluded);let a=t.edge;this._edgeManipulatorMaterial=Zt(B(a.color),a.renderOccluded),this._edgeManipulatorOutlineMaterial=_i(B(a.outlineColor),a.renderOccluded);let o=t.edgeOffset;this._edgeOffsetManipulatorMaterial=Zt(B(o.color),o.renderOccluded,!1),this._edgeOffsetManipulatorHoverMaterial=Zt(B(o.hoverColor),o.renderOccluded,!1);let s=t.selected;this._selectedManipulatorMaterial=Zt(B(s.color),s.renderOccluded),this._selectedManipulatorOutlineMaterial=_i(B(s.outlineColor),s.renderOccluded),this._selectedManipulatorHoverOutlineMaterial=_i(B(s.hoverOutlineColor),s.renderOccluded),this.tooltip=new te({view:e}),this.addHandles([g(()=>{let r=this._settings.manipulators;return{vertexSettings:r.vertex,edgeSettings:r.edge,edgeOffsetSettings:r.edgeOffset,selectedSettings:r.selected}},({vertexSettings:r,edgeSettings:n,edgeOffsetSettings:l,selectedSettings:c})=>{r.applyColor(this._vertexManipulatorMaterial),r.applyOutline(this._vertexManipulatorOutlineMaterial),r.applyHoverOutline(this._vertexManipulatorHoverOutlineMaterial),n.applyColor(this._edgeManipulatorMaterial),n.applyOutline(this._edgeManipulatorOutlineMaterial),l.applyColor(this._edgeOffsetManipulatorMaterial),l.applyHover(this._edgeOffsetManipulatorHoverMaterial),c.applyColor(this._selectedManipulatorMaterial),c.applyOutline(this._selectedManipulatorOutlineMaterial),c.applyHoverOutline(this._selectedManipulatorHoverOutlineMaterial)}),g(()=>this.object.visible,r=>{for(let n of this._manipulatorInfos)n.manipulator.available=r,n.type==="edge"&&"edgeManipulator"in n&&(n.edgeManipulator.available=r)}),g(()=>this._numGrabbing+this._numDragging===0,r=>this._toggleAutoHideManipulators(r)),g(()=>({labels:this._segmentLabels,enabled:this._sketchOptions.labels.enabled,edgeOffsetEnabled:this.enableEdgeOffset}),({labels:r,enabled:n,edgeOffsetEnabled:l})=>{r!=null&&(r.visible=n,r.edgeDistance=l?"far":"default")},R),Cl(this.tooltip,this.object,()=>this._tooltipsContext),Se(()=>this._operations,"vertex-update",r=>{this._updateManipulatorPositions(r.vertices)},{onListenerAdd:()=>this._recreateManipulators()}),Se(()=>this._operations?.data,"change",r=>{r.operation!=="undo"&&r.operation!=="redo"||this._recreateManipulators()})])}destroy(){this._segmentLabels=H(this._segmentLabels),this.tooltip=H(this.tooltip),this._removeManipulators(),this._updatingHandles.destroy()}get updating(){return this._updatingHandles.updating}get manipulators(){return this.tool.manipulators}get view(){return this.tool.view}get object(){return this.tool.object}get enableZShape(){return this.tool.enableZShape}get enableDeleteVertices(){return this.tool.enableDeleteVertices}get enableZVertex(){return this.tool.enableZVertex}get autoHideManipulators(){return this.tool.autoHideManipulators}get enableMoveObject(){return this.tool.enableMoveObject}get enableMidpoints(){return this.tool.enableMidpoints}get enableEdgeOffset(){return this.tool.enableEdgeOffset}get _sketchOptions(){return this.tool.sketchOptions}get _accentColor(){return this.view.effectiveTheme.accentColor}removeSelectedVertices(){let e=this._manipulatorInfos.filter(t=>t.manipulator.selected&&t.type==="vertex");return this._removeVertices(e),e.length}onManipulatorSelectionChanged(){this.events.emit("manipulators-changed")}_removeManipulators(){this._manipulatorHandles.removeAll(),this._moveManipulation=H(this._moveManipulation),this._objectMoveManipulation=H(this._objectMoveManipulation),this.manipulators.removeAll(),this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0}_createManipulators(e){if(this._operations==null)return;let t=this.object.elevationInfo;for(let i of this._operations.data.components){let a=e?.byComponentIndex.get(i.index);for(let o of i.vertices){let s=a?.has(o.index);this._createVertexOrEdgeManipulator(o,t,s)}for(let o of i.edges)this._createVertexOrEdgeManipulator(o,t)}this._createObjectMoveManipulation(),this._createMoveManipulation(t),this._createVisualElements()}get canRedo(){return this._operations!=null&&this._operations.canRedo}get canUndo(){return this._operations!=null&&this._operations.canUndo}redo(){return this._operations?.redo()}undo(){return this.events.emit("undo"),this._operations?.undo()}_recreateManipulators(){if(!this._recreatingManipulators){if(this._recreatingManipulators=!0,this._removeManipulators(),this._resetTooltip(),this._operations&&this._segmentLabels?.context?.editGeometryOperations===this._operations||(this._segmentLabels=H(this._segmentLabels)),this._createManipulators(),!this._segmentLabels&&this._operations){let e=this._sketchOptions.labels;this._segmentLabels=new yi({context:{view:this.view,editGeometryOperations:this._operations,elevationInfo:this.object.elevationInfo,labelOptions:e},visible:e.enabled})}this._recreatingManipulators=!1}}_perObjectManipulatorDragAction(e,t){if(t.action==="end")return t;let i=0,a=[],o=this._manipulatorInfos.some(r=>r.type==="vertex"&&r.manipulator.selected),s=e===Ai.SELECTED_OR_ALL&&o;for(let r of this._manipulatorInfos)r.type==="vertex"&&(r.manipulator.grabbing||s&&!r.manipulator.selected||a.push(r),i++);if(this._moveVertices(a,t),a.length===i){if(this._updateEventState(Z.MOVING),this.destroyed)return t;this.events.emit("move",{type:"move",dx:t.screenDeltaX,dy:t.screenDeltaY,object:this.object})}else{if(this._updateEventState(Z.RESHAPING),this.destroyed)return t;this.events.emit("reshape",{type:"reshape",object:this.object})}return t}_toggleAutoHideManipulators(e){this.autoHideManipulators&&(e?this.removeHandles(zl):this.tool.manipulators.forEach(({manipulator:t})=>{let i=t.disableDisplay?.();i&&this.addHandles(i,zl)}))}_isMultiVertexSelection(){return this._manipulatorInfos.reduce((e,t)=>t.type==="vertex"&&t.manipulator.selected?e+1:e,0)>1}_perVertexManipulatorDragAction(e){if(this._updateEventState(Z.RESHAPING),this.destroyed)return;let{mapDeltaX:t,mapDeltaY:i,mapDeltaZ:a}=e;if(!t&&!i&&!a)return;let o=[];for(let s of this._manipulatorInfos)s.type==="vertex"&&(s.manipulator.selected&&!s.manipulator.grabbing||s===e.info)&&o.push(s);this._moveVertices(o,e,nt.ACCUMULATE_STEPS),this.events.emit("reshape",{type:"reshape",object:this.object})}_updateEventState(e){if(e===this._reshapeEventState)return!1;switch(e){case Z.NONE:if(this._numGrabbing!==0||this._numDragging!==0)return!1;switch(this._reshapeEventState){case Z.MOVING:this.events.emit("move",{type:"move-stop",dx:0,dy:0,object:this.object});break;case Z.RESHAPING:this.events.emit("reshape",{type:"reshape-stop",object:this.object})}break;case Z.MOVING:switch(this._reshapeEventState){case Z.NONE:this.events.emit("move",{type:"move-start",dx:0,dy:0,object:this.object});break;case Z.RESHAPING:this.events.emit("reshape",{type:"reshape-stop",object:this.object}),this.destroyed||this.events.emit("move",{type:"move-start",dx:0,dy:0,object:this.object})}break;case Z.RESHAPING:switch(this._reshapeEventState){case Z.NONE:this.events.emit("reshape",{type:"reshape-start",object:this.object});break;case Z.MOVING:this.events.emit("move",{type:"move-stop",dx:0,dy:0,object:this.object}),this.destroyed||this.events.emit("reshape",{type:"reshape-start",object:this.object})}}if(this.destroyed)return!1;let t=this._reshapeEventState!==e;return this._reshapeEventState=e,t}_createObjectMoveManipulation(){let{tool:e,view:t,object:i,_operations:a}=this;if(a){if(this._objectMoveManipulation=new je({tool:e,view:t,object:i}),this.enableMoveObject){let o=null;this._manipulatorHandles.add(this._objectMoveManipulation.createDragPipeline((s,r,n)=>{r.next(l=>this._trackNumDragging(l)).next(l=>(l.action==="start"&&(o=a.createUndoGroup()),l)).next(l=>this._perObjectManipulatorDragAction(Ai.ALL,l)).next(l=>(this._updateTranslateObjectTooltip(V.XY,l),l)).next(l=>{l.action==="end"&&(this._resetTooltip(),o=Vt(o))}),n.next(()=>this._onDragCancel(!0,()=>o=Vt(o)))})),this._objectMoveManipulation.forEachManipulator(s=>this._manipulatorHandles.add(this._watchAndUpdateGrabState(s,!1)))}else this._objectMoveManipulation.forEachManipulator(o=>{o.grabbable=!1,o.cursor=null});this._objectMoveManipulation.forEachManipulator(o=>this._manipulatorHandles.add(o.events.on("immediate-click",s=>{this._manipulatorInfos.some(r=>r.manipulator.selected)?this._clearSelection():this.events.emit("immediate-click",x(v({},s),{object:this.object})),s.stopPropagation()})))}}_createMoveManipulation(e){let{object:t,tool:i,view:a,_operations:o}=this;if(!o)return;this._moveManipulation=new Lt({tool:i,view:a,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZShape&&Xt(t.operations,t.elevationInfo),snapToScene:!1,radius:Lt.radiusForSymbol(t.graphic?.symbol)}),this._moveManipulation.forEachManipulator(n=>this.addHandles([n.events.on("immediate-click",l=>{this._moveManipulation.zManipulation.hasManipulator(n)||this._manipulatorInfos.some(c=>c.manipulator.selected)||this.events.emit("immediate-click",x(v({},l),{object:this.object})),l.stopPropagation()}),this._watchAndUpdateGrabState(n,!1)]));let s=n=>l=>{this.addHandles(l.events.on("focus-changed",({action:c})=>{c==="focus"?this._updateTranslateTooltip(n):this._resetTooltip()}))};this._moveManipulation.xyManipulation.forEachManipulator(s(V.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(s(V.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(s(V.Z)),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};let r=o.data.spatialReference;this.addHandles([this._moveManipulation.createDragPipeline((n,l,c,u,d)=>{let{snappingStep:m,cancelSnapping:f}=We({predicate:_=>!!_.info,snappingManager:i.snappingManager,snappingContext:new Xe({editGeometryOperations:o,elevationInfo:e,pointer:d,excludeFeature:t.graphic,visualizer:new fe}),updatingHandles:this._updatingHandles,useZ:!1});return u=u.next(_=>(this._onDragCancel(),_)).next(f),{steps:c=c.next(_=>this._trackNumDragging(_)).next(_=>{let S=this._manipulatorInfos.filter(D=>D.type==="vertex"&&D.manipulator.selected);return _.manipulatorType===I.TRANSLATE_XY&&S.length===1?x(v({},_),{info:S[0],snapOrigin:S[0].handle.pos}):_}).next($a(this.view,e,t.graphic??void 0)).next(...m).next(me()).next(_=>this._perObjectManipulatorDragAction(Ai.SELECTED_OR_ALL,_)).next(_=>(this._updateTranslateTooltip(n,_),_)),cancel:u}},e,r,t.graphic),g(()=>t.visible,()=>this._updateMoveManipulationPosition(),R),t.on("committed",()=>{this._recreatingManipulators||this._updateMoveManipulationPosition()}),g(()=>t.isDraped,n=>{this._updateMoveManipulationPosition();let l="align-move-manipulation";n?this.addHandles(this.view.elevationProvider.on("elevation-change",()=>this._updateMoveManipulationPosition()),l):this.removeHandles(l)},R)])}_createVisualElements(){let{object:e,view:t}=this,i=Re({view:t,object:e,forEachManipulator:o=>{if(!this.destroyed&&!this._recreatingManipulators){this._objectMoveManipulation.forEachManipulator(o),this._moveManipulation.forEachManipulator(o);for(let s of this._manipulatorInfos)o(s.manipulator,I.TRANSLATE_XY)}},onManipulatorsChanged:o=>this.events.on("manipulators-changed",o)});i!=null&&(this._outlineVisualElement=i.visualElement instanceof yt?i.visualElement:null);let a=this._outlineVisualElement;if(a!=null){let o=()=>{e.isDraped||this._updateMoveManipulationPosition()};this._manipulatorHandles.add(Se(()=>a.events,"attachment-origin-changed",o,{onListenerAdd:o}))}this._manipulatorHandles.add(i)}_createEdgeOffsetManipulator(e,t=this.object.elevationInfo){let i=this._operations;if(e.component.vertices.length<=2||!i)return null;let a=this._settings.manipulators.edgeOffset,o=a.size/2,s=o+a.collisionPadding,r=o/s,n=r*Math.sqrt(3)/2;this._edgeOffsetManipulatorGeometryInside==null&&(this._edgeOffsetManipulatorGeometryInside=Je(this._edgeOffsetManipulatorMaterial,n,r/2,r/2,a.height,a.offset)),this._edgeOffsetManipulatorGeometryOutside==null&&(this._edgeOffsetManipulatorGeometryOutside=Je(this._edgeOffsetManipulatorMaterial,-n,r/2,r/2,a.height,-a.offset));let l=[new b(this._edgeOffsetManipulatorGeometryInside.instantiate(),M.Unfocused),new b(this._edgeOffsetManipulatorGeometryInside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),M.Focused),new b(this._edgeOffsetManipulatorGeometryOutside.instantiate(),M.Unfocused),new b(this._edgeOffsetManipulatorGeometryOutside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),M.Focused)],c=new N({view:this.view,renderObjects:l,elevationInfo:t.mode!=="on-the-ground"||Ua(this.object.graphic?.symbol)?{mode:"absolute-height",offset:0}:t,worldOriented:!1,focusMultiplier:1,radius:s,available:this.object.visible,collisionType:{type:"disc",direction:k(0,0,1)},collisionPriority:1,metadata:{deleting:!1}}),u=new N({view:this.view,worldSized:!0,worldOriented:!1,available:this.object.visible,collisionPriority:-10,cursor:this.enableMoveObject?"move":"default",metadata:{deleting:!1}}),d={manipulator:c,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0,edgeManipulator:u,elevationInfo:t,visibilityHandle:null};this._autoHideEdgeOffsetManipulator(d,a.minSquaredEdgeLength),this._updateEdgeOffsetManipulator(d);let m=[];for(let _ of[e.leftVertex,e.rightVertex]){let S=this._getManipulatorInfoFromHandle(_);S!=null&&m.push(S.manipulator.events.on("location-update",()=>this._updateEdgeOffsetManipulator(d)))}d.locationUpdateHandle=Y(m),this._manipulatorHandles.add(d.locationUpdateHandle,c),this._manipulatorHandles.add([this._watchAndUpdateGrabState(c,!0),this._watchAndUpdateGrabState(u,!0)],c),this._manipulatorHandles.add(K(c,this._createEdgeOffsetPipeline(d,t)),c),this._manipulatorHandles.add(K(u,(_,S,D,T)=>{if(T==="touch")this._createEdgeOffsetPipeline(d,t)(_,S,D);else if(this.enableMoveObject){let E=this.object.graphic,$=i.data.spatialReference;S.next(et=>this._trackNumDragging(et)).next(Ie(this.view,_.elevationAlignedLocation)).next(Qe(this.view,_.elevationAlignedLocation,t,$,E)).next(Pt()).next(me()).next(et=>this._perObjectManipulatorDragAction(Ai.ALL,et)).next(et=>(this._updateTranslateObjectTooltip(V.XY,et),et)).next(et=>{et.action==="end"&&this._resetTooltip()}),D.next(()=>this._onDragCancel(!_.metadata.deleting))}}),c);let f=_=>{this._manipulatorInfos.some(S=>S.manipulator.selected)?this._clearSelection():this.events.emit("immediate-click",x(v({},_),{object:this.object})),_.stopPropagation()};return this._manipulatorHandles.add([c.events.on("immediate-click",f),u.events.on("immediate-click",f),c.events.on("focus-changed",({action:_})=>{_==="focus"?this._updateEdgeOffsetTooltip(null):this._resetTooltip()})],c),this._manipulatorInfos.push(d),this.manipulators.add(c),this.manipulators.add(u),this.events.emit("manipulators-changed"),d}_autoHideEdgeOffsetManipulator(e,t){let i=e.manipulator,a=e.edgeManipulator,o=()=>{e.visibilityHandle=Vt(e.visibilityHandle);let s=this._getManipulatorInfoFromHandle(e.handle.leftVertex),r=this._getManipulatorInfoFromHandle(e.handle.rightVertex),n=s!=null&&r!=null&&Pl(s.manipulator.renderLocation,r.manipulator.renderLocation,this.view.state.camera)<t;(!i.focused&&!a.focused||n)&&(i.grabbable=!n,a.grabbable=!n,e.visibilityHandle=Y([i.disableDisplay(),j(()=>{i.grabbable=!0,a.grabbable=this.enableMoveObject})]))};this._manipulatorHandles.add([i.events.on("focus-changed",o),a.events.on("focus-changed",o),j(()=>{Vt(e.visibilityHandle),a.metadata.deleting=!0,this.manipulators.remove(a)})],i),o()}_updateEdgeOffsetManipulator(e){if(!this._operations)return;this._updateManipulatorPosition(e);let{coordinateHelper:t}=this._operations.data,i=Es(this.view,e.manipulator.elevationAlignedLocation,Os(t,e.handle,e.manipulator.elevationInfo)),a=this._getManipulatorInfoFromHandle(e.handle.leftVertex),o=this._getManipulatorInfoFromHandle(e.handle.rightVertex);if(a==null||o==null)return;let s=a.manipulator.renderLocation,r=o.manipulator.renderLocation,n=i!=null?Rl(i,s,r):Sr;e.manipulator.modelTransform=n,e.edgeManipulator.elevationAlignedLocation=e.manipulator.elevationAlignedLocation,e.edgeManipulator.modelTransform=n;let l=gt(C(Ko,s,r))/2;e.edgeManipulator.collisionType={type:"line",paths:[[[-l,0,0],[l,0,0]]]}}_createEdgeOffsetPipeline(e,t){return(i,a,o)=>{let s=this._operations;if(!s)return;this._clearSelection();let{step:r,cleanup:n}=this._initializeEdgeOffset(e,t,s);a.next(l=>this._trackNumDragging(l)).next(Ie(this.view,i.elevationAlignedLocation)).next(r).next(Yn(this.view)).next(Wn(this.view,s.data.spatialReference)).next(me()).next(Bp()).next(this._applyEdgeOffsetStep(e)).next(this._showEdgeOffsetTooltip()).next(l=>{l.action==="end"&&n()}),o.next(()=>{i.metadata.deleting||(n(),this._onDragCancel())})}}_initializeEdgeOffset(e,t,i){let{view:a}=this,o=Os(i.data.coordinateHelper,e.handle,t),s=i.createUndoGroup(),r=Es(a,e.manipulator.elevationAlignedLocation,o);if(o.requiresSplitEdgeLeft){let f=this._getManipulatorInfoFromHandle(e.handle.leftVertex.leftEdge);f!=null&&this._splitEdgeManipulator(f,1)}if(o.requiresSplitEdgeRight){let f=this._getManipulatorInfoFromHandle(e.handle.rightVertex.rightEdge);f!=null&&this._splitEdgeManipulator(f,0)}let n=()=>new nr({paths:[[e.handle.leftVertex.pos,e.handle.rightVertex.pos]],spatialReference:i.data.spatialReference}),l=this._settings,c=new yt({view:a,isDraped:this.object.isDraped,geometry:n(),elevationInfo:e.elevationInfo,width:l.visualElements.lineObjects.outline.width,attached:!1,isDecoration:!0}),u,d=()=>{this._cleanEdgeOffsetCollapsedEdges(e),u=Vt(u)},m=this.events.on("undo",d);return u=Y([g(()=>B(this._accentColor),f=>c.color=f,R),kt(c),g(()=>this.object.isDraped,f=>c.isDraped=f),this.object.on("committed",()=>c.geometry=n()),s,m]),c.attached=!0,{step:f=>o==null||r==null?(d(),null):x(v({},f),{operation:o,plane:r}),cleanup:d}}_applyEdgeOffsetStep(e){return t=>{if(this.destroyed||t.operation==null)return t;this._updateEventState(Z.RESHAPING);let{mapDeltaX:i,mapDeltaY:a,mapDeltaZ:o}=t;return(i||a||o)&&(this._offsetEdge(e,t),this.events.emit("reshape",{type:"reshape",object:this.object})),t}}_showEdgeOffsetTooltip(){return e=>(e.signedDistance!=null&&this.object.operations?this._updateEdgeOffsetTooltip(e):this._resetTooltip(),e)}_cleanEdgeOffsetCollapsedEdges(e){if(!this._operations)return;let t=e.handle.leftVertex.leftEdge?.leftVertex,i=e.handle.leftVertex,a=e.handle.rightVertex.rightEdge?.rightVertex,o=e.handle.rightVertex,s=this._operations.data.coordinateHelper,r=[];if(t&&s.distance(t.pos,i.pos)<Is){let n=this._getManipulatorInfoFromHandle(i);n!=null&&r.push(n)}if(s.distance(i.pos,o.pos)<Is||a&&s.distance(a.pos,o.pos)<Is){let n=this._getManipulatorInfoFromHandle(o);n!=null&&r.push(n)}r.length&&this._removeVertices(r)}_createVertexOrEdgeManipulator(e,t=this.object.elevationInfo,i=!1){let{view:a,_operations:o}=this;if(!o)return null;let s=this._settings;if(e.type==="edge"){if(this.enableEdgeOffset)return this._createEdgeOffsetManipulator(e,t);if(!this.enableMidpoints)return null}if(this._vertexManipulatorGeometry==null||this._vertexManipulatorOutlineGeometry==null){let{size:d,outlineSize:m}=Hl(s.manipulators.vertex);this._vertexManipulatorGeometry=$e(this._vertexManipulatorMaterial,d,16,16),this._vertexManipulatorOutlineGeometry=$e(this._vertexManipulatorOutlineMaterial,m,16,16)}if(this._edgeManipulatorGeometry==null||this._edgeManipulatorOutlineGeometry==null){let{size:d,outlineSize:m}=Hl(s.manipulators.edge);this._edgeManipulatorGeometry=$e(this._edgeManipulatorMaterial,d,16,16),this._edgeManipulatorOutlineGeometry=$e(this._edgeManipulatorOutlineMaterial,m,16,16)}let r=this._operations?.data.type,n=r==="point"||r==="mesh"?[]:[new b(this._vertexManipulatorGeometry.instantiate(),qt.Vertex|M.Unselected),new b(this._vertexManipulatorOutlineGeometry.instantiate(),qt.Vertex|M.Unfocused|M.Unselected),new b(this._vertexManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),qt.Vertex|M.Focused|M.Unselected),new b(this._vertexManipulatorGeometry.instantiate({material:this._selectedManipulatorMaterial}),M.Selected),new b(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorOutlineMaterial}),M.Selected|M.Unfocused),new b(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorHoverOutlineMaterial}),M.Selected|M.Focused)];this.enableMidpoints&&n.push(new b(this._edgeManipulatorGeometry.instantiate({material:this._vertexManipulatorMaterial}),qt.Edge|M.Focused|M.Unselected),new b(this._edgeManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),qt.Edge|M.Focused|M.Unselected),new b(this._edgeManipulatorGeometry.instantiate(),qt.Edge|M.Unfocused|M.Unselected),new b(this._edgeManipulatorOutlineGeometry.instantiate(),qt.Edge|M.Unfocused|M.Unselected));let l=new N({view:a,renderObjects:n,elevationInfo:t,focusMultiplier:1,touchMultiplier:1,available:this.object.visible,metadata:{deleting:!1}});l.selected=i,this._setTypeSpecificManipulatorSettings(l,e,t);let c=e.type==="edge"?{manipulator:l,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:l,handle:e,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(c),this.manipulators.add(l),this._updateManipulatorPosition(c),c.type==="edge"){let d=[];for(let m of[c.handle.leftVertex,c.handle.rightVertex]){let f=this._getManipulatorInfoFromHandle(m);f!=null&&d.push(f.manipulator.events.on("location-update",()=>this._updateManipulatorPosition(c)))}c.locationUpdateHandle=Y(d),this._manipulatorHandles.add(c.locationUpdateHandle,l)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(l,!0),l);let u=K(l,(d,m,f,_)=>{let S=null,{snappingStep:D,cancelSnapping:T}=We({predicate:()=>!this._isMultiVertexSelection(),snappingManager:this.tool.snappingManager,snappingContext:new Xe({editGeometryOperations:o,elevationInfo:t,pointer:_,excludeFeature:this.object.graphic,visualizer:new fe}),updatingHandles:this._updatingHandles,useZ:!1});f=f.next(E=>(this._onDragCancel(!d.metadata.deleting,()=>S=Vt(S)),E)).next(T),m.next(E=>this._trackNumDragging(E)).next(E=>{if(E.action==="start"&&this._operations&&(S=this._operations.createUndoGroup()),c.type==="edge"){let $=this._splitEdgeManipulator(c);return x(v({},E),{info:$,snapOrigin:$.handle.pos})}return x(v({},E),{info:c,snapOrigin:c.handle.pos})}).next(Ie(this.view,d.elevationAlignedLocation)).next(Qe(this.view,d.elevationAlignedLocation,this.object.elevationInfo,d.location.spatialReference,this.object.graphic)).next($a(this.view,t,this.object.graphic??void 0)).next(...D).next(me()).next(E=>{this._perVertexManipulatorDragAction(E),E.action==="end"&&(S=Vt(S)),this._resetTooltip()})});return this._manipulatorHandles.add([u,l.events.on("immediate-click",d=>this._manipulatorClickCallback(d,c)),l.events.on("select-changed",()=>{c.selectedIndex=++this._selectedIndex,this._updateMoveManipulationPosition(),this._resetTooltip()}),l.events.on("focus-changed",()=>{this._resetTooltip()})],l),this.events.emit("manipulators-changed"),c}_trackNumDragging(e){switch(e.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return e}_onDragCancel(e=!0,t){switch(this._numDragging--,e&&this.undo(),this.tool.snappingManager!=null&&this.tool.snappingManager.doneSnapping(),this._resetTooltip(),this._reshapeEventState){case Z.NONE:break;case Z.MOVING:this.events.emit("move",{type:"move",dx:0,dy:0,object:this.object});break;case Z.RESHAPING:this.events.emit("reshape",{type:"reshape",object:this.object})}t&&t(),this.destroyed||this._updateEventState(Z.NONE)}_setTypeSpecificManipulatorSettings(e,t,i){let a=this._settings;switch(t.type){case"vertex":{e.state=qt.Vertex,e.selectable=!0,e.cursor="move",e.collisionPriority=2;let{size:o,collisionPadding:s}=a.manipulators.vertex;e.radius=o/2+s,e.elevationInfo=i;let r=this._operations?.data.type;e.interactive=r!=null&&r!=="point"&&r!=="mesh";break}case"edge":{e.state=qt.Edge,e.selectable=!1,e.cursor="copy",e.collisionPriority=-1;let{size:o,collisionPadding:s}=a.manipulators.edge;e.radius=o/2+s,e.elevationInfo=i.mode!=="on-the-ground"||Ua(this.object.graphic?.symbol)?{mode:"absolute-height",offset:0}:i;break}}}_watchAndUpdateGrabState(e,t){return e.events.on("grab-changed",i=>this._onGrabStateChanged(e,t,i.action,i.pointerType))}_onGrabStateChanged(e,t,i,a="mouse"){if(!this._recreatingManipulators){if(i==="start")t&&this._updateSelection(e),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(Z.NONE),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing,(a!=="touch"||this.enableEdgeOffset)&&(this._manipulatorInfos.forEach(o=>{let{manipulator:s}=o,r=this._operations?.data.type;s.interactive=s.grabbing||!this._numGrabbing&&r!=null&&r!=="point"&&r!=="mesh","edgeManipulator"in o&&(o.edgeManipulator.interactive=o.edgeManipulator.grabbing||!this._numGrabbing)}),this._objectMoveManipulation.forEachManipulator(o=>{o.interactive=o.grabbing||!this._numGrabbing}))}}_clearSelection(){for(let e of this._manipulatorInfos)e.manipulator.grabbing||(e.manipulator.selected=!1)}_updateSelection(e){e.grabbing&&!e.selected&&e.selectable&&(this._clearSelection(),e.selected=!0,this.events.emit("manipulators-changed"))}_removeManipulator(e){e!=null&&(e.manipulator.metadata.deleting=!0,this.manipulators.remove(e.manipulator),this._manipulatorHandles.remove(e.manipulator),Zs(this._manipulatorInfos,e),this.events.emit("manipulators-changed"),this._resetTooltip())}_getManipulatorInfoFromHandle(e){if(e){for(let t of this._manipulatorInfos)if(e===t.handle)return t}return null}_updateManipulatorPositions(e){for(let t of e)this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(t))}_updateManipulatorPosition(e){let t=this._operations;if(e!=null&&t){if(e.type==="vertex")e.manipulator.location=t.data.coordinateHelper.vectorToDehydratedPoint(e.handle.pos,io),e.manipulator.grabbing&&this._vertexLaserLineVisualElement!=null&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=e.manipulator.renderLocation);else if(e.type==="edge"){let i=this._getManipulatorInfoFromHandle(e.handle.leftVertex),a=this._getManipulatorInfoFromHandle(e.handle.rightVertex);if(i==null||a==null)return;let o=i.manipulator,s=a.manipulator;if(e.manipulator.elevationInfo!=null&&e.manipulator.elevationInfo.mode==="on-the-ground"){let r=o.location,n=s.location,l=.5,c=r.x+l*(n.x-r.x),u=r.y+l*(n.y-r.y),d=r.hasZ&&n.hasZ?0:void 0;e.manipulator.location=ue(c,u,d,t.data.spatialReference)}else de(Ko,o.renderLocation,s.renderLocation,.5),e.manipulator.renderLocation=Ko}}}_splitEdgeManipulator(e,t=.5){let i=this._operations,a=i.splitEdge(e.handle,t).createdVertex;e.locationUpdateHandle=Vt(e.locationUpdateHandle);let o=this.object.elevationInfo,s;this.enableEdgeOffset?(this._removeManipulator(e),s=this._createVertexOrEdgeManipulator(a)):(s=e,s.handle=a,s.type="vertex",this._setTypeSpecificManipulatorSettings(e.manipulator,e.handle,o)),a.leftEdge&&this._createVertexOrEdgeManipulator(a.leftEdge),a.rightEdge&&this._createVertexOrEdgeManipulator(a.rightEdge),this._updateManipulatorPosition(s),this.enableEdgeOffset||this._resetTooltip(),this._updateSelection(e.manipulator);let r=this._updateEventState(Z.RESHAPING),n=i.data.coordinateHelper.vectorToArray(s.handle.pos),l=i.data.components.indexOf(a.component);return this.events.emit("vertex-add",{type:"vertex-add",object:this.object,vertices:[{coordinates:n,componentIndex:l,vertexIndex:a.index}],added:n}),r&&this._updateEventState(Z.NONE),s}_updateMoveManipulationPosition(){let e=G(Ko,0,0,0),t=0,i=!1,a=null,o=null;for(let n of this._manipulatorInfos)n.type==="vertex"&&(n.manipulator.selected?(t++,W(e,e,n.manipulator.renderLocation),a==null||n.selectedIndex>a.selectedIndex?(o=a,a=n):(o==null||n.selectedIndex>o.selectedIndex)&&(o=n)):i=!0);let s=this.object,r=this._operations?.data.geometry;if(t===0){let n=s.visible&&this.enableMoveObject;this._moveManipulation.xyManipulation.available=n,this._moveManipulation.xyAxisManipulation.available=n,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=n,this._moveManipulation.zManipulation.available=n&&this.enableZShape&&Xt(this._operations,s.elevationInfo),this._moveManipulation.angle=Ki(r),this._moveManipulation.radius=Lt.radiusForSymbol(s.graphic?.symbol)}else{let n=s.visible;this._moveManipulation.xyManipulation.available=n,this._moveManipulation.xyAxisManipulation.available=n,this._moveManipulation.zManipulation.available=n&&this.enableZVertex&&Xt(this._operations,this.object.elevationInfo),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=n&&t!==1;let l=0;if(a!=null){let c=a.handle.pos,u=o!=null?o.handle.pos:a.handle.leftEdge?.leftVertex?a.handle.leftEdge.leftVertex.pos:null,d=o==null&&a.handle.rightEdge?.rightVertex?a.handle.rightEdge.rightVertex.pos:null;u&&d?this._moveManipulation.xyAxisManipulation.available=!1:u?l=Vl(u,c):d&&(l=Vl(c,d))}this._moveManipulation.angle=l,this._moveManipulation.radius=Uo}t!==0&&i?(J(e,e,1/t),io.spatialReference=this._operations.data.spatialReference,io.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(e,io),this._moveManipulation.elevationAlignedLocation=io):this._outlineVisualElement==null||this.object.isDraped||this._outlineVisualElement.attachmentOrigin==null?Go(this._moveManipulation,this.object):this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin}_removeVertices(e){let t=new Array,i=this._operations;if(i){for(let a of e){let o=a.handle.component;if(a.type==="vertex"&&i.canRemoveVertex(o)){t.push(a.handle),this._removeManipulator(a),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.leftEdge)),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.rightEdge));let s=i.removeVertices([a.handle]),r=s.removedVertices?.[0].createdEdge;r?this._createVertexOrEdgeManipulator(r):this.enableEdgeOffset&&o.vertices.length<=2&&this._removeManipulator(this._getManipulatorInfoFromHandle(o.edges[0]))}}if(t.length>0){let a=t.map(s=>{let r=i.data.components.indexOf(s.component);return{coordinates:i.data.coordinateHelper.vectorToArray(s.pos),componentIndex:r,vertexIndex:s.index}}),o=this._updateEventState(Z.RESHAPING);if(this.destroyed||(this.events.emit("vertex-remove",{type:"vertex-remove",object:this.object,removed:a.map(s=>s.coordinates),vertices:a}),this.destroyed)||o&&(this._updateEventState(Z.NONE),this.destroyed))return;this._updateMoveManipulationPosition()}}}_moveVertices(e,t,i=t.action==="start"?nt.NEW_STEP:nt.ACCUMULATE_STEPS){let a=this._operations;if(a){e.length>0&&a.moveVertices(e.map(o=>o.handle),t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,i);for(let o of e)this._updateManipulatorPosition(o)}}_offsetEdge(e,t){if(t.operation==null||t.signedDistance==null)return;let i=this._operations;if(!i)return;let a=t.operation.clone();a.distance=t.signedDistance,i.updateVertices([e.handle.leftVertex,e.handle.rightVertex],a),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.leftVertex)),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.rightVertex))}_manipulatorClickCallback(e,t){e.shiftKey||this._clearSelection(),t.type==="vertex"&&(t.manipulator.selected=!t.manipulator.selected,this.enableDeleteVertices&&e.button===Ba.Right&&this._removeVertices([t])),t.type==="edge"&&e.button===Ba.Left&&this._splitEdgeManipulator(t),e.stopPropagation()}_updateTranslateTooltip(e,t){this._defaultTooltipInfo!=null?this._resetTooltip():this._updateTranslateObjectTooltip(e,t)}_updateTranslateObjectTooltip(e,t){this.activeTooltipInfo=jl(e,t,this._tooltipsContext)}_updateEdgeOffsetTooltip(e){this.activeTooltipInfo=Ll(this.object,e,this._tooltipsContext)}_resetTooltip(){this.activeTooltipInfo=this._defaultTooltipInfo}get _defaultTooltipInfo(){switch(this._operations?.data.type){case"polyline":case"polygon":return this._selectedVertexManipulatorInfo?this.tooltipInfos.selectedVertex:null;case"point":case"mesh":return this.tooltipInfos.movePoint;default:return null}}get _selectedVertexManipulatorInfo(){let e=this._manipulatorInfos.filter(t=>t.type==="vertex"&&t.manipulator.selected);return e.length===1?e[0]:null}get _tooltipsContext(){let{events:e}=this;return{sketchOptions:this._sketchOptions,tooltipInfos:this.tooltipInfos,activeTooltipInfo:this.activeTooltipInfo,selectedVertexManipulatorInfo:this._selectedVertexManipulatorInfo,callbacks:{onReshapeStart:()=>e.emit("reshape",{type:"reshape-start",object:this.object}),onReshape:()=>e.emit("reshape",{type:"reshape",object:this.object}),onReshapeStop:()=>e.emit("reshape",{type:"reshape-stop",object:this.object}),onMoveStart:()=>e.emit("move",{type:"move-start",object:this.object,dx:0,dy:0}),onMove:()=>e.emit("move",{type:"move",object:this.object,dx:0,dy:0}),onMoveStop:()=>e.emit("move",{type:"move-stop",object:this.object,dx:0,dy:0})}}}get test(){}};function Bp(){return e=>{let{operation:t,mapEnd:i}=e;return t==null||i==null?e:(e.action==="start"&&t.selectArrowFromStartPoint(i),x(v({},e),{signedDistance:t.signedDistanceToPoint(i)}))}}function Hl(e){let t=e.size/2,i=t+e.collisionPadding;return{size:t/i,outlineSize:(t+e.outlineSize)/i}}function Vl(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI/2}p([h()],U.prototype,"_numGrabbing",void 0),p([h()],U.prototype,"_numDragging",void 0),p([h()],U.prototype,"grabbingOrDragging",null),p([h()],U.prototype,"_operations",null),p([h()],U.prototype,"_segmentLabels",void 0),p([h({constructOnly:!0})],U.prototype,"tool",void 0),p([h()],U.prototype,"tooltip",void 0),p([h()],U.prototype,"activeTooltipInfo",void 0),p([h({readOnly:!0})],U.prototype,"updating",null),p([h()],U.prototype,"manipulators",null),p([h()],U.prototype,"view",null),p([h()],U.prototype,"object",null),p([h()],U.prototype,"enableZShape",null),p([h()],U.prototype,"enableDeleteVertices",null),p([h()],U.prototype,"enableZVertex",null),p([h()],U.prototype,"autoHideManipulators",null),p([h()],U.prototype,"enableMoveObject",null),p([h()],U.prototype,"enableMidpoints",null),p([h()],U.prototype,"enableEdgeOffset",null),p([h()],U.prototype,"_sketchOptions",null),p([h()],U.prototype,"_accentColor",null),p([h()],U.prototype,"_tooltipsContext",null),U=p([w("esri.views.3d.interactive.editingTools.reshape.ReshapeOperation")],U);var io=ue(0,0,void 0,Ma.WGS84),Ko=O(),Is=1e-6,qt,Z,Ai;(function(e){e.Vertex=ht.Custom1,e.Edge=ht.Custom2})(qt||(qt={})),function(e){e[e.NONE=0]="NONE",e[e.MOVING=1]="MOVING",e[e.RESHAPING=2]="RESHAPING"}(Z||(Z={})),function(e){e[e.ALL=0]="ALL",e[e.SELECTED_OR_ALL=1]="SELECTED_OR_ALL"}(Ai||(Ai={}));var tt=class extends Ae{constructor(e){super(e),this.events=new q,this.enableZShape=!0,this.enableZVertex=!0,this.enableMoveObject=!0,this.enableDeleteVertices=!0,this.autoHideManipulators=!1,this.enableMidpoints=!0,this.enableEdgeOffset=!1,this.type="reshape-3d",this.sketchOptions=new Rt,this.snappingManager=null,this.automaticManipulatorSelection=!1}initialize(){let e=this._reshapeOperation=new U({tool:this});this.addHandles([e.events.on("reshape",t=>this.events.emit("reshape",t)),e.events.on("move",t=>this.events.emit("move",t)),e.events.on("vertex-add",t=>this.events.emit("vertex-add",t)),e.events.on("vertex-remove",t=>this.events.emit("vertex-remove",t)),e.events.on("immediate-click",t=>this.events.emit("immediate-click",x(v({},t),{object:this.object}))),this.view.on("pointer-down",["Shift"],t=>t.stopPropagation())]),this.finishToolCreation()}destroy(){this._reshapeOperation=H(this._reshapeOperation)}get updating(){return((this.object.updating??!1)||this._reshapeOperation?.updating)??!1}get activeTooltipInfo(){return this._reshapeOperation?.activeTooltipInfo??null}get tooltip(){return this._reshapeOperation?.tooltip??null}onManipulatorSelectionChanged(){this._reshapeOperation&&this._reshapeOperation.onManipulatorSelectionChanged()}get canUndo(){return this._reshapeOperation.canUndo??!1}undo(){this.snappingManager!=null&&this.snappingManager.doneSnapping(),this._reshapeOperation.undo()}get canRedo(){return this._reshapeOperation.canRedo??!1}redo(){this.snappingManager!=null&&this.snappingManager.doneSnapping(),this._reshapeOperation.redo()}onInputEvent(e){let t=this._reshapeOperation;(!t||t.grabbingOrDragging||!ci(e,t.tooltip))&&this.enableDeleteVertices&&e.type==="key-down"&&dn.delete.includes(e.key)&&this._reshapeOperation.removeSelectedVertices()>0&&e.stopPropagation()}reset(){}get test(){}};p([h()],tt.prototype,"_reshapeOperation",void 0),p([h()],tt.prototype,"view",void 0),p([h({constructOnly:!0})],tt.prototype,"object",void 0),p([h()],tt.prototype,"enableZShape",void 0),p([h()],tt.prototype,"enableZVertex",void 0),p([h()],tt.prototype,"enableMoveObject",void 0),p([h()],tt.prototype,"enableDeleteVertices",void 0),p([h()],tt.prototype,"autoHideManipulators",void 0),p([h()],tt.prototype,"enableMidpoints",void 0),p([h()],tt.prototype,"enableEdgeOffset",void 0),p([h()],tt.prototype,"type",void 0),p([h({type:Rt})],tt.prototype,"sketchOptions",void 0),p([h()],tt.prototype,"snappingManager",void 0),p([h()],tt.prototype,"updating",null),p([h()],tt.prototype,"activeTooltipInfo",null),p([h()],tt.prototype,"tooltip",null),p([h()],tt.prototype,"automaticManipulatorSelection",void 0),tt=p([w("esri.views.3d.interactive.editingTools.reshape.ReshapeTool3D")],tt);var Mt=class extends pt{constructor(e){super(e),this._interactionState=null}initialize(){this.addHandles([Gt(()=>{let e=this._interactionState;return e&&e.angle!==e.previousAngle?{interactionState:e,angle:e.state.angle}:null},({interactionState:e})=>{this._updateMeshRotation(e)},le),Gt(()=>{let e=this._interactionState;return e&&e.scale!==e.previousScale?{interactionState:e,scale:e.state.scale}:null},({interactionState:e})=>{this._updateMeshSize(e)},le)])}get initialAngle(){return this._interactionState?.initialAngle??0}get angle(){let e=this.geometry.transform;if(e==null)return this._interactionState?.angle??0;let t=e.rotation[2];return Math.abs(t)>.999999?ct(Er(e.rotation))*Math.sign(t):0}get angleClockwise(){return-this.angle}get relativeAngle(){return this.angle-this.initialAngle}get relativeAngleClockwise(){return-this.relativeAngle}get scale(){return this._interactionState?.scale??1}startInteraction(){let e=new ge({angle:this.angle});this._interactionState=e;let t=()=>{this._interactionState=null};return{state:e,done:t,cancel:()=>{e.cancel(),t()}}}createUndoRecord(){return this.object.createUndoRecord()}_updateMeshRotation(e){let{angle:t,previousAngle:i}=e;e.previousAngle=t;let a=Nt(t-i);this.geometry.rotate(0,0,a,{origin:this.geometry.anchor})}_updateMeshSize(e){let{scale:t,previousScale:i}=e;e.previousScale=t;let a=t/i,o=this.geometry.anchor;this.geometry.scale(a,{origin:o})}};p([h({constructOnly:!0})],Mt.prototype,"object",void 0),p([h({constructOnly:!0})],Mt.prototype,"geometry",void 0),p([h({constructOnly:!0})],Mt.prototype,"viewingMode",void 0),p([h()],Mt.prototype,"initialAngle",null),p([h()],Mt.prototype,"angle",null),p([h()],Mt.prototype,"angleClockwise",null),p([h()],Mt.prototype,"relativeAngle",null),p([h()],Mt.prototype,"relativeAngleClockwise",null),p([h()],Mt.prototype,"scale",null),p([h()],Mt.prototype,"_interactionState",void 0),Mt=p([w("esri.views.3d.interactive.editingTools.transform.ScaleRotateMeshAdapter")],Mt);var ge=class extends pt{get state(){let{angle:e,scale:t}=this;return{angle:e,scale:t}}constructor(e){super(e),this.angle=0,this.initialAngle=0,this.previousAngle=0,this.previousScale=1,this.scale=1,this.initialAngle=e.angle,this.previousAngle=e.angle}cancel(){this.angle=this.initialAngle,this.scale=1}};p([h()],ge.prototype,"angle",void 0),p([h()],ge.prototype,"initialAngle",void 0),p([h()],ge.prototype,"previousAngle",void 0),p([h()],ge.prototype,"previousScale",void 0),p([h()],ge.prototype,"scale",void 0),p([h()],ge.prototype,"state",null),ge=p([w("esri.views.3d.interactive.editingTools.transform.ScaleRotateMeshAdapter.InteractionState")],ge);var Q=class extends pt{constructor(e){super(e),this.sizeAxis=null,this._interactionState=null}initialize(){this.addHandles(Gt(()=>this._interactionState!=null?this._interactionState.state:null,e=>{this._updateSymbol(e)},le))}get initialAngle(){return this._interactionState?.initialAngle??0}get angle(){return this._interactionState!=null?this._interactionState.angle:this._orientationReferenceSymbolLayer!=null?Zp(this._orientationReferenceSymbolLayer.heading??0):0}get angleClockwise(){return-this.angle}get orientation(){return this.angle}get orientationClockwise(){return this.angleClockwise}get relativeAngle(){return this.angle-this.initialAngle}get relativeAngleClockwise(){return-this.relativeAngle}get scale(){return this._interactionState?.scale??1}get size(){let e=this._sizeReferenceSymbolLayer;if(e==null)return null;let t=this.findLayerView(),i=this._graphicSymbol;if(t==null||i==null||i.type!=="point-3d")return null;let a=t.getSymbolLayerSize(i,e);if("size"in a&&a.size!=null)return a.size;let o=this.sizeAxis;return!("width"in a)||a.width==null||o!=null&&o!=="width"&&o!=="all"&&o!=="width-and-depth"?!("depth"in a)||e.depth==null||o!=null&&o!=="depth"&&o!=="all"&&o!=="width-and-depth"?!("height"in a)||e.height==null||o!=null&&o!=="height"&&o!=="all"?null:a.height:a.depth:a.width}get _sizeReferenceSymbolLayer(){let e=this._graphicSymbol;return e==null||e.symbolLayers.length===0?null:e.symbolLayers.find(t=>t.type==="object")}get _orientationReferenceSymbolLayer(){let e=this._graphicSymbol;return e==null||e.symbolLayers.length===0?null:e.symbolLayers.find(t=>t.type==="object"&&t.heading!=null)}get _graphicSymbol(){return this.graphic?.symbol!=null&&this.graphic.symbol.type==="point-3d"?this.graphic.symbol:null}set _graphicSymbol(e){this.graphic.symbol=e}startInteraction(){let e=this._graphicSymbol,t=this.findLayerView();if(this._interactionState!=null||e==null||t==null)return Yp;let i=e.symbolLayers.map(n=>n.type==="object"?t.getSymbolLayerSize(e,n):null).toArray(),a=e.clone(),o=this.angle,s=new _e({originalSymbol:a,angle:o,initialSizes:i});this._interactionState=s;let r=()=>{this._interactionState=null};return{state:s,done:r,cancel:()=>{this._graphicSymbol=a,r()}}}createUndoRecord(){let e=this.graphic.symbol,t=null;return{undo:i=>{t=i.symbol,i.symbol=e},redo:i=>{e=i.symbol,i.symbol=t}}}_updateSymbol({scale:e,angle:t,originalSymbol:i,initialSizes:a}){let o=this._graphicSymbol;if(o==null||o.type!=="point-3d")return;let s=o.clone(),r=-Nt(t-this.initialAngle),n=!1;this._forEachObjectSymbolLayerPair(i,s,(l,c,u)=>{let d=(l.heading??0)+r;c.heading!==d&&(c.heading=d,n=!0);let m=a[u];if(m!=null&&"width"in m){m.width=this.sizeFilter(m.width),m.height=this.sizeFilter(m.height),m.depth=this.sizeFilter(m.depth);let f=m.width*e;c.width!==f&&(c.width=f,n=!0);let _=m.depth*e;c.depth!==_&&(c.depth=_,n=!0);let S=m.height*e;c.height!==S&&(c.height=S,n=!0)}}),n&&(this._graphicSymbol=s)}_forEachObjectSymbolLayerPair(e,t,i){e.symbolLayers.forEach((a,o)=>{let s=t.symbolLayers.at(o);a.type==="object"&&s.type==="object"&&i(a,s,o)})}};function Zp(e){return-ct(e)}p([h()],Q.prototype,"initialAngle",null),p([h()],Q.prototype,"angle",null),p([h()],Q.prototype,"angleClockwise",null),p([h()],Q.prototype,"orientation",null),p([h()],Q.prototype,"orientationClockwise",null),p([h()],Q.prototype,"relativeAngle",null),p([h()],Q.prototype,"relativeAngleClockwise",null),p([h()],Q.prototype,"scale",null),p([h()],Q.prototype,"size",null),p([h()],Q.prototype,"sizeAxis",void 0),p([h({constructOnly:!0})],Q.prototype,"graphic",void 0),p([h()],Q.prototype,"_interactionState",void 0),p([h({constructOnly:!0})],Q.prototype,"findLayerView",void 0),p([h({constructOnly:!0})],Q.prototype,"sizeFilter",void 0),p([h()],Q.prototype,"_sizeReferenceSymbolLayer",null),p([h()],Q.prototype,"_orientationReferenceSymbolLayer",null),p([h()],Q.prototype,"_graphicSymbol",null),Q=p([w("esri.views.3d.interactive.editingTools.transform.ScaleRotateObjectSymbol3DAdapter")],Q);var Yp={state:{angle:0,scale:0},done:()=>{},cancel:()=>{}},_e=class extends pt{get state(){let{originalSymbol:e,angle:t,initialAngle:i,scale:a,initialSizes:o}=this;return{originalSymbol:e,angle:t,initialAngle:i,scale:a,initialSizes:o}}constructor(e){super(e),this.angle=0,this.initialAngle=0,this.scale=1,this.initialAngle=e.angle}};p([h()],_e.prototype,"originalSymbol",void 0),p([h()],_e.prototype,"angle",void 0),p([h()],_e.prototype,"initialAngle",void 0),p([h()],_e.prototype,"initialSizes",void 0),p([h()],_e.prototype,"scale",void 0),p([h()],_e.prototype,"state",null),_e=p([w("esri.views.3d.interactive.editingTools.transform.ScaleRotateObjectSymbol3DAdapter.InteractionState")],_e);var $t=class extends dt{constructor(e){super(e),this.type="transform-absolute",this.orientation=null,this.orientationPrecision=null,this.rotationType="geographic",this.size=null,this.sizePrecision=null,this.sizeUnit=null}};p([h()],$t.prototype,"type",void 0),p([h()],$t.prototype,"orientation",void 0),p([h()],$t.prototype,"orientationPrecision",void 0),p([h()],$t.prototype,"rotationType",void 0),p([h()],$t.prototype,"size",void 0),p([h()],$t.prototype,"sizePrecision",void 0),p([h()],$t.prototype,"sizeUnit",void 0),$t=p([w("esri.views.interactive.tooltip.infos.TransformAbsoluteTooltipInfo")],$t);var re=class extends dt{constructor(e){super(e),this.type="transform-rotate",this.rotation=null,this.rotationPrecision=null,this.orientation=null,this.orientationPrecision=null,this.rotationType="geographic"}};p([h()],re.prototype,"type",void 0),p([h()],re.prototype,"rotation",void 0),p([h()],re.prototype,"rotationPrecision",void 0),p([h()],re.prototype,"orientation",void 0),p([h()],re.prototype,"orientationPrecision",void 0),p([h()],re.prototype,"rotationType",void 0),re=p([w("esri.views.interactive.tooltip.infos.TransformRotateTooltipInfo")],re);var ve=class extends dt{constructor(e){super(e),this.type="transform-scale",this.size=null,this.sizeUnit=null,this.sizePrecision=null}};p([h()],ve.prototype,"type",void 0),p([h()],ve.prototype,"scale",void 0),p([h()],ve.prototype,"size",void 0),p([h()],ve.prototype,"sizeUnit",void 0),p([h()],ve.prototype,"sizePrecision",void 0),ve=p([w("esri.views.interactive.tooltip.infos.TransformScaleTooltipInfo")],ve);var L;(function(e){e.ScaleIn=ht.Custom2,e.ScaleOut=ht.Custom3,e.RotateLeft=ht.Custom4,e.RotateRight=ht.Custom5,e.Unlocked=ht.Custom7,e.DelayedFocused=ht.Custom8,e.TouchInput=ht.Custom12})(L||(L={}));var zt=class extends pt{get angle(){return this.adapter.angle}get scale(){return this.adapter.scale}set location(e){this._ringManipulator.location=e}set elevationAlignedLocation(e){this._ringManipulator.elevationAlignedLocation=e}get grabbing(){return this._ringManipulator.grabbing}set interactive(e){this._ringManipulator.interactive=e}get updating(){return!!this._activeAnimation}get tooltipEffectiveEnabled(){return this.sketchOptions.tooltips.effectiveEnabled&&this.tooltipEnabled}constructor(e){super(e),this.mode=null,this.tooltipEnabled=!0,this._scaleRotateDragData=null,this._activeAnimation=null,this._ringIndicatorDelayMs=Sl,this._absoluteTooltipInfo=null,this._scaleTooltipInfo=null,this._rotateTooltipInfo=null,this.events=new q,this.getFocused=()=>this._ringManipulator.focused,this.getScale=()=>this._scaleRotateDragData?.mode==="scale"?this.adapter.scale:1}initialize(){this.tooltip=new te({view:this.tool.view}),this._createManipulator(),this._updateDragState(),this._updateManipulatorTransform(),this.addHandles([Gt(()=>!this.tooltipEffectiveEnabled,()=>this.tooltip.clear(),R),g(()=>{let{adapter:e}=this,{info:t}=this.tooltip;return t===this._absoluteTooltipInfo&&this.getFocused()?[t,e.size,e.orientationClockwise]:[null]},([e])=>{e&&this._updateFocusTooltip()}),g(()=>{let{adapter:e}=this;return[e.angle,e.scale]},()=>this._updateManipulatorTransform())])}destroy(){this._activeAnimation?.frameTask.remove(),this._activeAnimation=null,this.tool.manipulators.remove(this._ringManipulator),this._ringManipulator=null,this.tooltip=H(this.tooltip)}startAnimation(e){this.cancelActiveAnimation(),e.start();let t=Ws({update:({deltaTime:i})=>{e.update(i)&&this.cancelActiveAnimation()}});this._activeAnimation=x(v({},e),{frameTask:t})}cancelActiveAnimation(){this._activeAnimation?.frameTask.remove(),this._activeAnimation=H(this._activeAnimation)}forEachManipulator(e){e(this._ringManipulator,I.SCALE_ROTATE)}_createManipulator(){let e=this._createRingManipulator();this._ringManipulator=e,this.tool.manipulators.add(e);let t=this.tool.object,i=K(e,(a,o,s)=>{this._scaleRotateDragData=null;let r=this.adapter.startInteraction(),n={mode:"none",origin:pe(a.renderLocation),initialAngle:this.adapter.angle,angle:0,angleDir:0,scaleDir:0};this._scaleRotateDragData=n,this._updateDragState();let l=y.get();this.tool.view.renderCoordsHelper.worldUpAtPosition(a.renderLocation,l),o.next(gi(this.tool.view,ri(a.renderLocation,l,si()))).next(c=>{let u=c.plane,d=ko(c.renderStart,c.renderEnd,n.origin,u),m=Vr.shortestSignedDiff(n.angle,d);n.angleDir=Vi(n.angleDir+m,-Ms,Ms),n.angle=d;let f=Xp(n,c),_=f-this.adapter.scale;if(n.scaleDir=Vi(n.scaleDir+_,-bs,bs),this._onScaleChanged(),n.mode==="none"){let S=this.mode||Wp(c,c.plane,n.origin,this.tool.view.state.camera);if(S!=null){switch(S){case"rotate":this.tool.events.emit("rotate-start",{object:t,angle:0}),this.tool.events.emit("record-undo",{updates:[this.adapter.createUndoRecord()]});break;case"scale":this.tool.events.emit("scale-start",{object:t,xScale:1,yScale:1}),this.tool.events.emit("record-undo",{updates:[this.adapter.createUndoRecord()]})}n.mode=S}}switch(n.mode){case"rotate":r.state.angle=n.initialAngle+d;break;case"scale":r.state.scale=f,this._onScaleChanged()}switch(this._updateDragState(),this._updateManipulatorTransform(),c.action){case"start":case"update":switch(n.mode){case"rotate":this.tool.events.emit("rotate",{object:t,angle:Nt(n.angle)});break;case"scale":this.tool.events.emit("scale",{object:t,xScale:f,yScale:f})}break;case"end":switch(n.mode){case"rotate":this.tool.events.emit("rotate-stop",{object:t,angle:Nt(n.angle)});break;case"scale":this.tool.events.emit("scale-stop",{object:t,xScale:f,yScale:f})}}return c.action==="end"&&(this.startAnimation(kl(this,()=>this._onScaleChanged())),this._scaleRotateDragData=null,this._updateDragState(),r.done()),c}).next(this._updateTooltipPipelineStep(n)),s.next(()=>{if(r.cancel(),this._scaleRotateDragData!=null){switch(this._scaleRotateDragData.mode){case"none":break;case"rotate":this.tool.events.emit("rotate-stop",{object:t,angle:0});break;case"scale":this.tool.events.emit("scale-stop",{object:t,xScale:1,yScale:1})}this.startAnimation(kl(this,()=>this._onScaleChanged())),this._scaleRotateDragData=null,this._updateDragState()}this._updateFocusTooltip()})});this.addHandles([i,e.events.on("focus-changed",a=>{a.action==="focus"?this.startAnimation(qp(this,()=>this._updateDelayedFocusedState(),{delayMs:this._ringIndicatorDelayMs})):this._updateDelayedFocusedState()}),e.events.on("immediate-click",a=>{a.stopPropagation()}),g(()=>this.tool.object.visible,a=>this._ringManipulator.available=a,R)])}_updateTooltipPipelineStep(e){return t=>{let{sketchOptions:i}=this,{visualVariables:a}=i.tooltips;if(!this.tooltipEffectiveEnabled)return t;if(t.action==="end")return this._updateFocusTooltip(),t;let{tooltip:o}=this;switch(e.mode){case"scale":{o.info=this._scaleTooltipInfo??=new ve({sketchOptions:i});let{size:s,scale:r}=this.adapter,n=a?.size,l=o.info;l.sketchOptions=i,l.scale=nn(r),l.size=s!=null?pi(s,"meters"):void 0,l.sizePrecision=ea(n?.valueType),l.sizeUnit=n?.unit;break}case"rotate":{o.info=this._rotateTooltipInfo??=new re({sketchOptions:i});let{orientationClockwise:s,relativeAngleClockwise:r}=this.adapter,n=a?.rotation,l=ea(n?.valueType),c=o.info;c.sketchOptions=i,c.rotation=r!=null?To(r,"radians","geographic"):void 0,c.rotationPrecision=l,c.rotationType=n?.rotationType??"geographic",c.orientation=s!=null?To(s,"radians","geographic"):void 0,c.orientationPrecision=l;break}}return t}}_updateFocusTooltip(){let{sketchOptions:e,tooltip:t}=this,{visualVariables:i}=e.tooltips;if(this.tooltipEffectiveEnabled)if(this.getFocused()){let a=i?.rotation,o=i?.size,s=this.mode,{size:r,orientationClockwise:n}=this.adapter,l=n!=null&&(s==null||s==="rotate"),c=r!=null&&(s==null||s==="scale");t.info=this._absoluteTooltipInfo??=new $t({sketchOptions:e});let u=t.info;u.sketchOptions=e,u.orientation=l?To(n,"radians","geographic"):void 0,u.orientationPrecision=ea(a?.valueType),u.rotationType=a?.rotationType??"geographic",u.size=c?pi(r,"meters"):void 0,u.sizeUnit=o?.unit,u.sizePrecision=ea(o?.valueType)}else t.clear()}_onScaleChanged(){this.events.emit("scale-changed"),this._updateManipulatorTransform()}_updateDelayedFocusedState(){this._ringManipulator.updateStateEnabled(L.DelayedFocused,this.getFocused()),this._updateFocusTooltip()}_updateDragState(){if(this._ringManipulator.updateStateEnabled(L.Unlocked,!(this._scaleRotateDragData!=null&&this._scaleRotateDragData?.mode!=="none")),this._scaleRotateDragData!=null)switch(this._scaleRotateDragData.mode){case"rotate":this._ringManipulator.updateStateEnabled(L.ScaleIn|L.ScaleOut,!1),this._ringManipulator.updateStateEnabled(L.RotateLeft,this._scaleRotateDragData.angleDir<0),this._ringManipulator.updateStateEnabled(L.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this._ringManipulator.updateStateEnabled(L.RotateLeft|L.RotateRight,!1),this._ringManipulator.updateStateEnabled(L.ScaleIn,this._scaleRotateDragData.scaleDir<0),this._ringManipulator.updateStateEnabled(L.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this._ringManipulator.updateStateEnabled(L.ScaleIn|L.ScaleOut|L.RotateLeft|L.RotateRight,!1)}_updateManipulatorTransform(){let e=mo(X.get(),this.adapter.angle,k(0,0,1));if(e==null)return;let t=this.getScale(),i=Ne(X.get(),G(y.get(),t,t,t));this._ringManipulator.modelTransform=Ut(X.get(),i,e)}_createRingManipulator(){let e=(P,it,ft)=>{let ye=[],be=Math.ceil(128*(it-P)/(2*Math.PI));for(let lt=0;lt<be+1;lt++){let ji=P+lt*(it-P)/be;ye.push(k(ft*Math.cos(ji),ft*Math.sin(ji),0))}return ye},t=P=>e(0,2*Math.PI,P),i=P=>[[-P/2,0],[P/2,0],[P/2,Bo/2],[-P/2,Bo/2]],a=this._createMaterial(1),o=(P,it,ft=a)=>Co(ft,i(it),P,[],[],!1),s=t(Pe),r=o(s,Zo),n={left:new Array,right:new Array},l=[];for(let P=0;P<2;P++){let it=P*Math.PI-Math.PI/4,ft=Math.PI/2-bl,ye=it+ft,be=it+Math.PI/2-ft,lt=e(ye,be,_l),ji=o(lt,ei);l.push(lt),l.push(e(ye,be,fs-Zo/2)),n.left.push(ji),n.right.push(ji.instantiate());for(let _a=0;_a<2;_a++){let Ns=_a===0,xt=vt();if(Ns){oi(xt,xt,[1,-1,1]),Oa(xt,xt,-ye,[0,0,1]);let ke=Math.round(_s*(lt.length-1));xt[12]=lt[ke][0],xt[13]=lt[ke][1],xt[14]=lt[ke][2]}else{Oa(xt,xt,be,[0,0,1]);let ke=Math.round((1-_s)*(lt.length-1));xt[12]=lt[ke][0],xt[13]=lt[ke][1],xt[14]=lt[ke][2]}let Us=Je(a,vl,0,yl,Bo);jo(Us,xt),(Ns?n.left:n.right).push(Us)}}let c=[];for(let P=0;P<2;P++){let it=P*Math.PI-Math.PI/4,ft=Math.PI/2-Ml,ye=it+ft,be=it+Math.PI/2-ft,lt=e(ye,be,fs);c.push(o(lt,ei))}let u=this._createMaterial(.66),d=this._createMaterial(.5),m=this._createMaterial(.33),f=t(Pe+vs),_=t(Pe+ys),S=o(f,ei,u),D=o(_,ei,m),T=t(Pe-vs),E=t(Pe-ys),$=o(T,ei,u),et=o(E,ei,m),Et=[new b(r,L.DelayedFocused),new b(r.instantiate({material:d}),M.None)];this.mode&&this.mode!=="scale"||(Et=Et.concat([...c.map(P=>new b(P,L.DelayedFocused|L.Unlocked)),new b(S,L.DelayedFocused|L.ScaleIn),new b(D,L.DelayedFocused|L.ScaleIn),new b($,L.DelayedFocused|L.ScaleOut),new b(et,L.DelayedFocused|L.ScaleOut)])),this.mode&&this.mode!=="rotate"||(Et=Et.concat([...n.right.map(P=>new b(P.instantiate(),L.DelayedFocused|L.Unlocked)),...n.left.map(P=>new b(P,L.DelayedFocused|L.RotateLeft)),...n.right.map(P=>new b(P,L.DelayedFocused|L.RotateRight))]));let Ht=[s,...l];return new N({view:this.tool.view,renderObjects:Et,autoScaleRenderObjects:!1,worldOriented:!0,radius:Zo,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:this.tool.object.elevationInfo,collisionType:{type:"ribbon",paths:Ht,direction:k(0,0,1)}})}_createMaterial(e){let t=new Bt({cullFace:ot.Back,renderOccluded:A.Transparent,isDecoration:!0});return this.addHandles(g(()=>({color:Pa(this.tool.view.effectiveTheme.accentColor,e)}),i=>t.setParameters(i),R)),t}get test(){}};function Xp(e,t){let i=C(y.get(),t.renderStart,e.origin),a=C(y.get(),t.renderEnd,e.origin),o=gt(i),s=gt(a);return o===0?0:s/o}function Wp(e,t,i,a){let{renderStart:o,renderEnd:s}=e,r=ta(o,a,y.get()),n=ta(s,a,y.get());if(ar(r,n)<gs*gs)return null;let l=C(y.get(),o,i),c=_t(y.get(),l,t),u=o,d=W(y.get(),u,c),m=ta(i,a,y.get()),f=r,_=ta(d,a,y.get()),S=C(y.get(),_,f),D=C(y.get(),r,m),T=za(f,S),E=za(m,D);return Ha(T,n)<Ha(E,n)?"rotate":"scale"}function ta(e,t,i){return t.projectToScreen(e,Rs),G(i,Rs[0],Rs[1],0)}var Ii;function kl(e,t){let i=null,a=1,o=()=>a;return{start:()=>{a=e.getScale(),i=e.getScale,e.getScale=o,t()},update:s=>(a+=((a+1)/2-a)*Math.min(s*xl,1),t(),Math.abs(a-1)<.01?Ii.STOP:Ii.CONTINUE),destroy:()=>{i&&(e.getScale=i),t()}}}function qp(e,t,i){let a=0,o=null,s=()=>!1;return{start:()=>{o=e.getFocused,e.getFocused=s,a=0,t()},update:r=>(a+=r,!o?.()||a>=i.delayMs?Ii.STOP:Ii.CONTINUE),destroy:()=>{o&&(e.getFocused=o),t()}}}function ea(e){switch(e){case"integer":case"long":return 0;default:return null}}p([h({constructOnly:!0})],zt.prototype,"tool",void 0),p([h({constructOnly:!0})],zt.prototype,"adapter",void 0),p([h({constructOnly:!0})],zt.prototype,"sketchOptions",void 0),p([h()],zt.prototype,"mode",void 0),p([h()],zt.prototype,"tooltipEnabled",void 0),p([h()],zt.prototype,"_activeAnimation",void 0),p([h()],zt.prototype,"updating",null),p([h()],zt.prototype,"tooltipEffectiveEnabled",null),zt=p([w("esri.views.3d.interactive.editingTools.transform.ScaleRotateTransform")],zt),function(e){e[e.CONTINUE=0]="CONTINUE",e[e.STOP=1]="STOP"}(Ii||(Ii={}));var Rs=Fe();var Ri=class extends Io(dt){constructor(e){super(e),this.type="transform-mesh",this.orientation=_n({actual:null,lockable:!1}),this.scale=vn({actual:null,lockable:!1}),this.allFields.forEach(t=>{t.lockable=!1,t.setActual(null)})}get key(){return{longitude:this.longitude.actual,latitude:this.latitude.actual,x:this.x.actual,y:this.y.actual,elevation:this.elevation.actual,geographic:this.geographic,orientation:this.orientation.actual,scale:this.scale.actual}}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}};p([h()],Ri.prototype,"key",null),p([h()],Ri.prototype,"allFields",null),Ri=p([w("esri.views.interactive.tooltip.infos.TransformMeshTooltipInfo")],Ri);var oo=class extends Io(dt){constructor(e){super(e),this.type="transform-point",this.allFields.forEach(t=>{t.lockable=!1,t.setActual(null)})}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};p([h()],oo.prototype,"allFields",null),oo=p([w("esri.views.interactive.tooltip.infos.TransformPointTooltipInfo")],oo);var St=class extends Ae{constructor(e){super(e),this.events=new q,this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.sketchOptions=new Rt,this.type="transform-3d",this._updatingHandles=new we,this._scaleRotate=null}initialize(){let{events:e,object:t,view:i}=this;this.tooltip=new te({view:i}),this._moveManipulation=new Lt({tool:this,view:i,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&Xt(t.operations,t.elevationInfo),radius:Lt.radiusForSymbol(t.graphic?.symbol)}),this._moveManipulation.forEachManipulator(l=>this.addHandles(l.events.on("immediate-click",c=>{e.emit("immediate-click",x(v({},c),{object:this.object})),c.stopPropagation()})));let a=t.elevationInfo;if(this._moveManipulation.elevationInfo=a,this.addHandles(bi(t)),this._moveManipulation.createManipulatedObjectDragPipeline((l,c,u,d,m)=>{if(l===V.XY){let{snappingStep:f,cancelSnapping:_}=We({snappingContext:new Xe({elevationInfo:a,pointer:m,editGeometryOperations:di.fromGeometry(new Hi({spatialReference:t.operations?.data.spatialReference}),i.state.viewingMode),visualizer:new fe,excludeFeature:t.graphic}),snappingManager:this.snappingManager,updatingHandles:this._updatingHandles,useZ:!1});d=d.next(_),u=u.next(In(this.view,a)).next(...f)}return{steps:u,cancel:d}},t,l=>{let{action:c,object:u,dxScreen:d,dyScreen:m}=l,f={object:u,dxScreen:d,dyScreen:m};switch(c){case"start":this._emitRecordUndo(),e.emit("translate-start",f);break;case"update":e.emit("translate",f);break;case"end":e.emit("translate-stop",f)}}),this._moveManipulation.angle=this._scaleRotate!=null?this._scaleRotate.angle:0,this._scaleRotateAdapter=this._createScaleRotateAdapter(),this.addHandles(g(()=>this._scaleRotateAdapter.angle,()=>this._updateMoveAngle())),this.enableScaling||this.enableRotation){let l=this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate";this._scaleRotate=new zt({tool:this,mode:l,adapter:this._scaleRotateAdapter,sketchOptions:this.sketchOptions,tooltipEnabled:F(t)?.type!=="mesh"}),this.addHandles(this._scaleRotate.events.on("scale-changed",()=>this._onScaleChanged()))}this.addHandles([Re({view:this.view,object:t,forEachManipulator:l=>this._forEachManipulator(l),onManipulatorsChanged:()=>j()}),t.on("committed",()=>this._onGeometryChanged()),this._hideManipulatorsForObjectState(),g(()=>i.scale,()=>this._updateMoveAngle())].filter(po)),this._onGeometryChanged(),this._updateMoveAngle(),this._forEachManipulator(l=>{l instanceof N&&this.addHandles(l.events.on("grab-changed",()=>this._updateManipulatorsInteractive()))});let o=i?.type,{sketchOptions:s}=this;this._meshTooltipInfo=new Ri({viewType:o,sketchOptions:s}),this._pointTooltipInfo=new oo({viewType:o,sketchOptions:s});let r={object:t,dxScreen:0,dyScreen:0},n={onMoveStart:()=>{this._emitRecordUndo(),e.emit("translate-start",v({},r))},onMove:()=>e.emit("translate",v({},r)),onMoveStop:()=>e.emit("translate-stop",v({},r)),onRotateStart:l=>{this._emitRecordUndo(),e.emit("rotate-start",{object:t,angle:l})},onRotate:l=>e.emit("rotate",{object:t,angle:l}),onRotateStop:l=>e.emit("rotate-stop",{object:t,angle:l}),onScaleStart:(l,c)=>{this._emitRecordUndo(),e.emit("scale-start",{object:t,xScale:l,yScale:c})},onScale:(l,c)=>e.emit("scale",{object:t,xScale:l,yScale:c}),onScaleStop:(l,c)=>e.emit("scale-stop",{object:t,xScale:l,yScale:c})};this.addHandles(No(this.tooltip,this.object,()=>({sketchOptions:this.sketchOptions,activeTooltipInfo:this.activeTooltipInfo,callbacks:n}))),this.finishToolCreation()}destroy(){this.tooltip.destroy(),this._moveManipulation.destroy(),this._scaleRotate=H(this._scaleRotate),this._scaleRotateAdapter=H(this._scaleRotateAdapter),this._updatingHandles.destroy(),this._set("view",null),this._set("object",null)}onInputEvent(e){if(!this.destroyed&&!ci(e,this.tooltip))return super.onInputEvent(e)}_updateManipulatorsInteractive(){this._scaleRotate!=null&&(this._scaleRotate.interactive=!this._moveManipulation.grabbing,this._moveManipulation.interactive=!this._scaleRotate.grabbing)}_createScaleRotateAdapter(){let e=F(this.object);return e?.type==="mesh"?new Mt({object:this.object,geometry:e,viewingMode:this.view.state.viewingMode}):new Q({graphic:this.object.graphic,sizeFilter:t=>this._enforceNonZeroSize(t),findLayerView:()=>this.view.allLayerViews.find(t=>t.layer===this.object.graphic?.layer),sizeAxis:this.sketchOptions?.tooltips?.visualVariables?.size?.axis??null})}_forEachManipulator(e){this._moveManipulation?.forEachManipulator(e),this._scaleRotate?.forEachManipulator(e)}_hideManipulatorsForObjectState(){return g(()=>this.object.visible,e=>{this._forEachManipulator(t=>t.available=e),this._moveManipulation.zManipulation.available=e&&this.enableZ&&Xt(this.object.operations,this.object.elevationInfo)})}_emitRecordUndo(){this.events.emit("record-undo",{updates:[this.object.createUndoRecord()]})}set snapToScene(e){this._moveManipulation&&(this._moveManipulation.snapToScene=e),this._set("snapToScene",e)}get updating(){return this._updatingHandles.updating||!!this._scaleRotate?.updating}get activeTooltipInfo(){return this._scaleRotate?.tooltip?.info!=null?null:F(this.object)?.type==="mesh"?this._meshTooltipInfo:this._pointTooltipInfo}set location(e){this._moveManipulation.location=e,this._scaleRotate&&(this._scaleRotate.location=e)}set elevationAlignedLocation(e){this._moveManipulation.elevationAlignedLocation=e,this._scaleRotate&&(this._scaleRotate.elevationAlignedLocation=e)}reset(){}onHide(){this._scaleRotate?.cancelActiveAnimation()}_onScaleChanged(){this._scaleRotate!=null&&(this._moveManipulation.displayScale=this._scaleRotate.getScale())}_updateMoveAngle(){let{view:e}=this,t=e.state.viewingMode===ja.Local||e.scale<wl;this._moveManipulation.angle=t?this._scaleRotateAdapter.angle:0}_onGeometryChanged(){Go(this,this.object)}_enforceNonZeroSize(e){return e||this.view.state.camera.computeRenderPixelSizeAt(this._moveManipulation.renderLocation)}get test(){}};p([h({constructOnly:!0,nonNullable:!0})],St.prototype,"view",void 0),p([h({constructOnly:!0,nonNullable:!0})],St.prototype,"object",void 0),p([h({constructOnly:!0,nonNullable:!0})],St.prototype,"enableZ",void 0),p([h()],St.prototype,"enableRotation",void 0),p([h()],St.prototype,"enableScaling",void 0),p([h({constructOnly:!0,type:Rt})],St.prototype,"sketchOptions",void 0),p([h({value:!1})],St.prototype,"snapToScene",null),p([h({constructOnly:!0})],St.prototype,"snappingManager",void 0),p([h({readOnly:!0})],St.prototype,"type",void 0),p([h({readOnly:!0})],St.prototype,"updating",null),p([h()],St.prototype,"activeTooltipInfo",null),St=p([w("esri.views.3d.interactive.editingTools.transform.TransformTool3D")],St);var He=class extends br($s){constructor(e){super(e),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}equals(e){return this.heading===e.heading&&this.tilt===e.tilt&&Ys(this.position,e.position)&&this.width===e.width&&this.height===e.height}};p([h({readOnly:!0,json:{read:!1,write:!0}})],He.prototype,"type",void 0),p([h({type:Hi}),li()],He.prototype,"position",void 0),p([h({type:Number,nonNullable:!0,range:{min:0,max:360}}),li(),ya(e=>Fa.normalize(va(e),0,!0))],He.prototype,"heading",void 0),p([h({type:Number,nonNullable:!0,range:{min:0,max:360}}),li(),ya(e=>Fa.normalize(va(e),0,!0))],He.prototype,"tilt",void 0),p([h({type:Number,nonNullable:!0}),li()],He.prototype,"width",void 0),p([h({type:Number,nonNullable:!0}),li()],He.prototype,"height",void 0),He=p([w("esri.analysis.SlicePlane")],He);var $p=Fi(0,0,0,.04);var QS=lo("mac")?"Meta":"Control";var Gl=2,Fl=1.15,Nl=1.15;var Jp=Math.cos(ct(45)),Qp=Math.cos(ct(5));var Ul=3,Ps=11,ia=22.5,ao=40,Ds=48,Bl=2.25,Zl=4,Cs=1,Yl=.3,Xl=6,Wl=4;var _0=vt();var oa=class e extends xo{initializeProgram(t){return new wo(t.rctx,e.shader.get().build(this.configuration),Nr)}initializePipeline(){return Mo({blending:Zr(xe.ONE,xe.ONE,xe.ONE_MINUS_SRC_ALPHA,xe.ONE_MINUS_SRC_ALPHA),depthTest:{func:yr.LESS},colorWrite:bo})}};oa.shader=new So(Kn,()=>import("./chunk-3PSUJ62S.js"));var cx=2**50;var hx=O();var dx=O();function Kl(e,t){return $n(e.basis1,e.basis2,e.origin,t)}function tp(e,t,i,a){let o=t.worldUpAtPosition(e.origin,y.get()),s=y.get();switch(i){case Pi.HEADING:Jt(s,o);break;case Pi.TILT:Jt(s,e.basis1)}return ri(e.origin,s,a)}function ep(e,t,i,a){let o=gt(a.basis1),s=gt(a.basis2),r=ip(a),n=aa(a),l=G(y.get(),0,0,0);W(l,J(y.get(),a.basis1,t.direction[0]),J(y.get(),a.basis2,t.direction[1])),W(l,a.origin,l);let c=0,u=1;if(ii(t))t.direction[0]===1&&t.direction[1]===-1?c=Ql:t.direction[0]===1&&t.direction[1]===1?c=Math.PI:t.direction[0]===-1&&t.direction[1]===1&&(c=3*Math.PI/2),u=n;else{let m=t.direction[0]!==0?1:2;c=m===1?Ql:0,u=(m===1?s:o)-r}let d=fo(X.get(),c);oi(d,d,G(y.get(),u,u,u)),Ut(d,i,d),d[12]=0,d[13]=0,d[14]=0,e.modelTransform=d,e.renderLocation=l}var $l;function ip(e){let t=gt(e.basis1),i=gt(e.basis2);return Yl*Math.min(t,i)}function aa(e){return ip(e)}function ii(e){return e.direction[0]!==0&&e.direction[1]!==0}(function(e){e[e.POSITIVE_X=0]="POSITIVE_X",e[e.POSITIVE_Y=1]="POSITIVE_Y",e[e.NEGATIVE_X=2]="NEGATIVE_X",e[e.NEGATIVE_Y=3]="NEGATIVE_Y"})($l||($l={}));var ne=ht.Custom1,Pi,Jl;(function(e){e[e.HEADING=1]="HEADING",e[e.TILT=2]="TILT"})(Pi||(Pi={})),function(e){e[e.HORIZONTAL_OR_VERTICAL=0]="HORIZONTAL_OR_VERTICAL",e[e.HORIZONTAL=1]="HORIZONTAL",e[e.VERTICAL=2]="VERTICAL",e[e.TILTED=3]="TILTED"}(Jl||(Jl={}));var so=ht.Custom2,kw=Ir(),Ql=Math.PI/2,Di=ht.Custom1,sa=ht.Custom2;var ro;(function(e){e[e.CENTER_ON_CALLOUT=0]="CENTER_ON_CALLOUT",e[e.CENTER_ON_ARROW=1]="CENTER_ON_ARROW"})(ro||(ro={}));var ra=class extends N{constructor(t,i){let a=new Dt({width:1,renderOccluded:A.OccludeAndTransparent,isDecoration:!0}),o=new Bt({cullFace:ot.Back,renderOccluded:A.Opaque,isDecoration:!0}),s=new Bt({cullFace:ot.Back,renderOccluded:A.Opaque,isDecoration:!0}),r=new Bt({cullFace:ot.Back,renderOccluded:A.Opaque,isDecoration:!0}),n=new Bt({writeDepth:!1,cullFace:ot.Front,renderOccluded:A.Transparent,isDecoration:!0});super(v({view:t},sc({offsetMode:i,tubeMaterial:o,tipMaterial:s,capMaterial:r,outlineMaterial:n,calloutMaterial:a}))),this._themeHandle=g(()=>t.effectiveTheme.accentColor,l=>{let c=Te(l),u=z.toUnitRGBA(l),d=z.toUnitRGBA(c),m=z.toUnitRGBA(z.blendColors(c,l,.4)),f=z.toUnitRGBA(z.blendColors(c,l,.14));a.setParameters({color:u}),o.setParameters({color:f}),s.setParameters({color:d}),r.setParameters({color:m}),n.setParameters({color:u})},R)}destroy(){this._themeHandle.remove(),super.destroy()}};function sc({offsetMode:e,tubeMaterial:t,tipMaterial:i,capMaterial:a,outlineMaterial:o,calloutMaterial:s}){let r=e===ro.CENTER_ON_CALLOUT?ao:0,n=[k(r,0,-Ds/2),k(r,0,Ds/2)],l=nc(n),c=op({vertices:n,padding:0,materials:{tube:t,tip:i,cap:a}}),u=op({vertices:n,padding:Bl,materials:{tube:o,tip:o,cap:o}}),d=ee(s,[[r,0,0],[r-ao,0,0]]),m=ee(s,[[r,0,0],[r-ao,0,0]]);return{renderObjects:[...c.normal.map(f=>new b(f,M.Unfocused|ne)),...u.normal.map(f=>new b(f,M.Unfocused|ne)),new b(d,M.Unfocused|ne|so),...c.focused.map(f=>new b(f,M.Focused|ne)),...u.focused.map(f=>new b(f,M.Focused|ne)),new b(m,M.Focused|ne|so)],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[l]},collisionPriority:1,radius:Ps,state:ne}}function op({vertices:e,padding:t,materials:i}){let a=o=>{let s=e.slice(0),r=C(y.get(),s[0],s[1]);At(r,r);let n=C(y.get(),s[s.length-1],s[s.length-2]);if(At(n,n),t>0){let P=J(O(),n,-t);s[s.length-1]=W(P,P,s[s.length-1]);let it=J(O(),r,-t);s[0]=W(it,it,s[0])}let l=o?Nl:1,c=ia*l,u=Ps*l,d=Ta(X.get());if(t>0){let P=c/4,it=G(y.get(),0,P,0),ft=1+t/P;ki(d,d,it),oi(d,d,G(y.get(),ft,ft,ft)),ki(d,d,J(it,it,-1/ft))}let m=Ta(vt()),f=k(0,1,0),_=Aa(vt(),Da(Ca.get(),f,n));_[12]=s[s.length-1][0],_[13]=s[s.length-1][1],_[14]=s[s.length-1][2],Ut(_,_,d);let S=i.tube,D=rc(Ul*(o?Fl:1)+t,s,S);D.transformation=m;let T=[D],E=i.tip,$=Xi(E,c,u,24,!1,!1,!0);$.transformation=_,T.push($);let et=i.cap,Et=Xi(et,c,u,24,!1,!0,!1);Et.transformation=_,T.push(Et);let Ht=Aa(vt(),Da(Ca.get(),f,r));return Ht[12]=s[0][0],Ht[13]=s[0][1],Ht[14]=s[0][2],Ut(Ht,Ht,d),T.push($.instantiate({transformation:Ht})),T.push(Et.instantiate({transformation:Ht})),T};return{normal:a(!1),focused:a(!0)}}function rc(e,t,i){let a=[];for(let s=0;s<12;s++){let r=s/12*2*Math.PI;a.push([Math.cos(r)*e,Math.sin(r)*e])}return Co(i,a,t,[],[],!1)}function nc(e,t){let i=C(O(),e[e.length-1],e[e.length-2]);At(i,i),J(i,i,ia),W(i,i,e[e.length-1]);{let a=C(O(),e[0],e[1]);return At(a,a),J(a,a,ia),W(a,a,e[0]),[a,...e,i]}}var na=class{get _object(){return this._tool.object}get _operations(){return this._object.operations}constructor(t,i){this._tool=t,this._bounds=i,this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null;let a=this._tool,o=a.view;this.moveXYObjectManipulation=new je({view:o,tool:a,object:this._object}),a.addHandles(this._createMoveXYObjectDragPipeline()),this.moveZManipulator=new ra(o,ro.CENTER_ON_CALLOUT),this.moveZManipulator.state|=so,a.manipulators.add(this.moveZManipulator),a.addHandles([this._createMoveZDragPipeline()]),a.addHandles([a.events.on("translate-stop",()=>{this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null})])}destroy(){this.moveXYObjectManipulation.destroy(),this._tool.manipulators.remove(this.moveZManipulator),this.moveZManipulator.destroy()}forEachManipulator(t){this.moveXYObjectManipulation.forEachManipulator(t),t(this.moveZManipulator,I.TRANSLATE_Z)}updateManipulators(t,i){let a=this.moveZManipulator,o=Ea(X.get(),t,Math.PI);o[12]=0,o[13]=0,o[14]=0,a.modelTransform=o,a.renderLocation=C(y.get(),i.origin,i.basis1)}getUpdatedTooltipInfo(){return this.moveXYObjectManipulation.grabbing||this.moveXYObjectManipulation.dragging?this._computeMoveXYTooltipInfo():this.moveZManipulator.focused?this._computeMoveZTooltipInfo():null}_computeMoveXYTooltipInfo(){let t=this._tool,i=this._moveXYTooltipInfo??=new vi({sketchOptions:t.sketchOptions});if(this.moveXYObjectManipulation.dragging){let a=this._bounds,o=a.mapBoundsStart.origin,s=a.mapBounds.origin,{renderSpatialReference:r}=t.view;if(!r)return null;let n=Po(o,s,r);if(n==null)return null;i.distance=n}else i.distance=st;return i}_computeMoveZTooltipInfo(){let t=this._tool,i=this._moveZTooltipInfo??=new ae({sketchOptions:t.sketchOptions});if(this.moveZManipulator.dragging){let a=this._bounds,o=a.mapBoundsStart.origin,s=a.mapBounds.origin,{renderSpatialReference:r}=t.view;if(!r)return null;let n=bn(o,s,r);if(n==null)return null;i.distance=n}else i.distance=st;return i}_createMoveXYObjectDragPipeline(){return this.moveXYObjectManipulation.createDragPipeline((t,i,a)=>this._applyObjectMoveSteps(i,a))}_createMoveZDragPipeline(){if(!this._operations)return j();let t=this._operations.data.spatialReference;return K(this.moveZManipulator,(i,a,o)=>{let s=pe(i.renderLocation),r=a.next(Vo(this._tool.view,s,t)).next(Pt());this._applyObjectMoveSteps(r,o)})}_applyObjectMoveSteps(t,i){let{_tool:a,_object:o}=this,s=t.next(r=>(r.action==="start"&&(a.inputState={type:"move"},this._bounds.backupMapBounds(),a.events.emit("translate-start",{object:o,dxScreen:r.screenDeltaX,dyScreen:r.screenDeltaY})),r)).next(me()).next(this._moveDragUpdateGeometry()).next(r=>{let n={object:o,dxScreen:r.screenDeltaX,dyScreen:r.screenDeltaY};switch(r.action){case"start":case"update":(r.mapEnd.x-r.mapStart.x||r.mapEnd.y-r.mapStart.y||(r.mapEnd.z??0)-(r.mapStart.z??0))&&a.events.emit("translate",n);break;case"end":a.inputState=null,a.events.emit("translate-stop",n)}return r});return i.next(()=>{a.inputState!=null&&a.events.emit("translate-stop",{object:o,dxScreen:0,dyScreen:0}),a.cancel()}),s}_moveDragUpdateGeometry(){let t=this._tool;return i=>{if(t.inputState==null||t.inputState.type!=="move")return i;let a=i.action==="start"?nt.NEW_STEP:nt.ACCUMULATE_STEPS;if(this._operations){let o=this._operations.move(i.mapDeltaX,i.mapDeltaY,i.mapDeltaZ,a);this._bounds.updateMapBoundsFromOperation(o)}return i}}};var lc="theme-style";function ap(e,t){return dc(hc(pc(cc(e),t)),t.size)}function pc(e,{accentColor:t,contrastColor:i}){let a=t.toHex(),o=t.a,s=i.toHex(),r=i.a,n=e.getElementsByTagNameNS("http://www.w3.org/2000/svg","style").namedItem(lc);return n&&(n.innerHTML=`
      .contrast-fill { fill: ${s}; fill-opacity: ${r}; }
      .contrast-stroke { stroke: ${s}; stroke-opacity: ${r};  }
      .accent-fill { fill: ${a}; fill-opacity: ${o}; }
      .accent-stroke { stroke: ${a}; stroke-opacity:  ${o}; }`),e}function cc(e){let t=e.split(",")[1],i=atob(t);return new DOMParser().parseFromString(i,"image/svg+xml")}function hc(e){let t=new XMLSerializer().serializeToString(e);return`data:image/svg+xml;base64,${btoa(t)}`}function dc(e,t){let i=new Image(t,t);return i.src=e,i}var sp="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NiIgaGVpZ2h0PSI1NiIgZmlsbD0ibm9uZSIgdmVyc2lvbj0iMi4wIj48c3R5bGUgaWQ9InRoZW1lLXN0eWxlIj4uY29udHJhc3QtZmlsbHtmaWxsOiNmZmZ9LmNvbnRyYXN0LXN0cm9rZXtzdHJva2U6I2ZmZn0uYWNjZW50LWZpbGx7ZmlsbDojZmY3ZjAwO2ZpbGwtb3BhY2l0eTouNX08L3N0eWxlPjxwYXRoIGQ9Ik0yOCAwYTI4IDI4IDAgMSAxIDAgNTYgMjggMjggMCAwIDEgMC01NiIgY2xhc3M9ImFjY2VudC1maWxsIi8+PHBhdGggc3Ryb2tlLXdpZHRoPSI0Ljk5IiBkPSJNMjAuMDUgNDAuODZhMTUuMDUgMTUuMDUgMCAwIDAgMTcuMTQtMS41IDE1LjA1IDE1LjA1IDAgMCAwIDQuNDctMTYuNjUgMTUuMDUgMTUuMDUgMCAwIDAtMjIuNzItNy4xNSAxNS4wNSAxNS4wNSAwIDAgMC01LjUgNy4xNSIgY2xhc3M9ImNvbnRyYXN0LXN0cm9rZSIvPjxwYXRoIGQ9Im0xMC45NyAzNS41NyA1LjM4IDEyLjA3IDcuNzktMTMuNDd6IiBjbGFzcz0iY29udHJhc3QtZmlsbCIvPjwvc3ZnPg==";var rp=64;function np(e,t){let{accentColor:i,contrastColor:a,preMultiplyAlpha:o}=t;return e.fromData(`heading-rotate:[accent:${i},contrast:${a},size:${rp}]`,()=>new Gr(ap(sp,{accentColor:i,contrastColor:a,size:rp}),{mipmap:!0,reloadable:!0,preMultiplyAlpha:o}))}var no=class e extends xo{initializeProgram(t){return new wo(t.rctx,e.shader.get().build(this.configuration),js)}_setPipelineState(t,i){let a=this.configuration,o=t===Zi.NONE,s=t===Zi.FrontFace;return Mo({blending:a.output===Ye.Color&&a.transparent?o?uc:Wr(t):null,culling:Yr(a.cullFace),depthTest:{func:Qr(t)},depthWrite:o?a.writeDepth?Xr:null:qr(t),drawBuffers:Kr(t),colorWrite:bo,stencilWrite:a.hasOccludees?on:null,stencilTest:a.hasOccludees?i?sn:an:null,polygonOffset:o||s?null:Jr(a.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipeline(t){return t?this._occludeePipelineState:super.getPipeline()}};no.shader=new So(tl,()=>import("./chunk-U4CBJV54.js"));var uc=Br(xe.ONE,xe.ONE_MINUS_SRC_ALPHA),ut=class extends rn{constructor(){super(...arguments),this.output=Ye.Color,this.cullFace=ot.None,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=Zi.NONE,this.multipassEnabled=!1,this.cullAboveGround=!1,this.perspectiveInterpolation=!0}};p([wt({count:Ye.COUNT})],ut.prototype,"output",void 0),p([wt({count:ot.COUNT})],ut.prototype,"cullFace",void 0),p([wt()],ut.prototype,"hasSlicePlane",void 0),p([wt()],ut.prototype,"transparent",void 0),p([wt()],ut.prototype,"enableOffset",void 0),p([wt()],ut.prototype,"writeDepth",void 0),p([wt()],ut.prototype,"hasOccludees",void 0),p([wt({count:Zi.COUNT})],ut.prototype,"transparencyPassType",void 0),p([wt()],ut.prototype,"multipassEnabled",void 0),p([wt()],ut.prototype,"cullAboveGround",void 0),p([wt()],ut.prototype,"perspectiveInterpolation",void 0),p([wt({constValue:!1})],ut.prototype,"occlusionPass",void 0);var js=new Map([[It.POSITION,0],[It.UV0,2],[It.PERSPECTIVEDIVIDE,3]]);var la=class extends Qa{constructor(t){super(t,new Hs),this.supportsEdges=!0,this.produces=new Map([[ni.OPAQUE_MATERIAL,i=>Va(i)||Bi(i)&&!this.parameters.transparent],[ni.TRANSPARENT_MATERIAL,i=>Bi(i)&&this.parameters.transparent&&this.parameters.writeDepth],[ni.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,i=>Bi(i)&&this.parameters.transparent&&!this.parameters.writeDepth],[ni.DRAPED_MATERIAL,i=>Bi(i)||Va(i)]]),this._vertexAttributeLocations=js,this._configuration=new ut}getConfiguration(t,i){return this._configuration.output=t,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<$r,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration.perspectiveInterpolation=this.parameters.perspectiveInterpolation,this._configuration}createGLMaterial(t){return new Ls(t)}createBufferWriter(){let t=es.clone();return this.parameters.perspectiveInterpolation&&t.f32(It.PERSPECTIVEDIVIDE),new zs(t)}},Ls=class extends Fr{constructor(t){super(v(v({},t),t.material.parameters))}_updateParameters(t){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(no,t)}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&(this._material.setParameters({hasOccludees:t.hasOccludees}),this._updateParameters(t))}beginSlot(t){return this._output===Ye.Color&&this._updateOccludeeState(t),this._updateParameters(t)}},zs=class extends Na{write(t,i,a,o,s){for(let r of this.vertexBufferLayout.fields.keys()){let n=a.attributes.get(r);if(n)if(r===It.PERSPECTIVEDIVIDE){vr(n.size===1);let l=o.getField(r,gr);l&&tn(n,l,s)}else en(r,n,t,i,o,s)}}},Hs=class extends Ur{constructor(){super(...arguments),this.transparent=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=ot.None,this.hasOccludees=!1,this.opacity=1,this.textureId=null,this.initTextureTransparent=!0,this.perspectiveInterpolation=!1}};var pa=class extends N{constructor(t,i){let a=new la({transparent:!0,writeDepth:!1,renderOccluded:A.Opaque,isDecoration:!0}),o=ts.calloutWidth,s=new Dt({width:o,renderOccluded:A.OccludeAndTransparent,isDecoration:!0});super(v({view:t},mc({imageMaterial:a,calloutMaterial:s}))),this._currentTexture=null,this._themeHandle=g(()=>t.effectiveTheme.accentColor,r=>{let n=Kt(r,.5),l=Te(r),c=this._currentTexture,u=i(n,l);a.setParameters({textureId:u.texture.id}),s.setParameters({color:z.toUnitRGBA(r)}),this._currentTexture=u,c?.release()},R)}destroy(){this._themeHandle.remove(),this._currentTexture?.release(),super.destroy()}};function mc({imageMaterial:e,calloutMaterial:t}){let{focusMultiplier:i,calloutLength:a,discRadius:o}=ts,s=o*i,r=(u,d)=>{let m=[0,1,2,2,3,0];return new kr(d,[[It.POSITION,new La([a-u,-u,0,a+u,-u,0,a+u,u,0,a-u,u,0],m,3,!0)],[It.UV0,new La([0,0,1,0,1,1,0,1],m,2,!0)]])},n=ee(t,[[0,0,0],[a-o,0,0]]),l=ee(t,[[0,0,0],[a-s,0,0]]),c=ne;return{autoScaleRenderObjects:!1,collisionPriority:1,collisionType:{type:"disc",direction:[0,0,1],offset:[a,0,0]},focusMultiplier:i,radius:o,renderObjects:[new b(r(o,e),M.Unfocused|c),new b(n,M.Unfocused|c),new b(r(s,e),M.Focused|c),new b(l,M.Focused|c)],state:c}}var ca=class{get _object(){return this._tool.object}get _operations(){return this._object.operations}constructor(t,i,a){this._tool=t,this._bounds=i,this._snapRotation=a,this._rotateTooltipInfo=null,this._startAngle=0,this._endAngle=0;let o=this._tool,s=o.view,r=!s._stage?.renderView.renderingContext.driverTest.svgPremultipliesAlpha.result;this.rotateManipulator=new pa(s,(n,l)=>np(s.textures,{accentColor:n,contrastColor:l,preMultiplyAlpha:r})),o.addHandles([this.rotateManipulator.events.on("grab-changed",n=>this._onRotateGrab(n)),this._createRotateDragPipeline(this.rotateManipulator)]),o.manipulators.add(this.rotateManipulator),o.addHandles([o.events.on("rotate-start",n=>this._startAngle=n.angle),o.events.on("rotate",n=>this._endAngle=n.angle),o.events.on("rotate-stop",()=>{this._startAngle=0,this._endAngle=0})])}destroy(){this._tool.manipulators.remove(this.rotateManipulator),this.rotateManipulator.destroy()}forEachManipulator(t){t(this.rotateManipulator,I.ROTATE)}updateManipulators(t,i){let a=this._bounds.mapBounds.plane[2]<0?Math.PI:0,o=Gi(X.get(),t,a);o[12]=0,o[13]=0,o[14]=0,this.rotateManipulator.modelTransform=o,this.rotateManipulator.renderLocation=W(y.get(),i.origin,i.basis1)}getUpdatedTooltipInfo(){return this.rotateManipulator.focused?this._computeRotateTooltipInfo():null}_computeRotateTooltipInfo(){let t=this._rotateTooltipInfo??=new el({sketchOptions:this._tool.sketchOptions});return t.angle=this._startAngle-this._endAngle,t}_onRotateGrab({action:t,screenPoint:i}){let a=this._tool,o=this._bounds;if(t!=="start"||!i)return;let s=tp(o.displayBounds,a.view.renderCoordsHelper,Pi.HEADING,si()),r=Ho(a.view.state.camera,i);Ui(s,r,y.get())&&(o.backupMapBounds(),a.inputState={type:"rotate",rotatePlane:s})}_createRotateDragPipeline(t){let{_tool:i,_object:a}=this;return K(t,(o,s,r)=>{let n=i.inputState;n!=null&&(s.next(l=>(l.action==="start"&&i.events.emit("rotate-start",{object:a,angle:0}),l)).next(gi(i.view,n.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(n)).next(...this._snapRotation()).next(this._rotateDragUpdateGeometry()).next(l=>{let c={object:a,angle:Nt(l.rotateAngle)};switch(l.action){case"start":case"update":i.events.emit("rotate",c);break;case"end":i.inputState=null,i.events.emit("rotate-stop",c)}return l}),r.next(()=>{i.inputState!=null&&i.events.emit("rotate-stop",{object:a,angle:0}),i.cancel()}))})}_rotateDragRenderPlaneToRotate(t){return i=>{let a=t.rotatePlane,o=ko(i.renderStart,i.renderEnd,this._bounds.displayBounds.origin,a);return x(v({},i),{rotateAxis:a,rotateAngle:o})}}_rotateDragUpdateGeometry(){let t=this._bounds;return i=>{let a=Jt(O(),t.mapBoundsStart.origin),o=i.action==="start"?nt.NEW_STEP:nt.ACCUMULATE_STEPS;if(this._operations){let s=this._operations.rotate(a,i.rotateAngle,o,Do.REPLACE);Ee(t.mapBoundsStart,t.mapBounds),t.updateMapBoundsFromOperation(s)}return i}}};var ha=class extends N{constructor(t,i){let a=ii(i),o=a?Zl:Cs,s=o*Gl,r=Cs,n={renderOccluded:A.OccludeAndTransparent,isDecoration:!0},l=new Dt(x(v({},n),{width:o})),c=new Dt(x(v({},n),{width:s})),u=new Dt(x(v({},n),{width:r}));super(v(v({view:t},qn),fc({isCorner:a,unfocusedMaterial:l,focusedMaterial:c,outlineMaterial:u}))),this._themeHandle=g(()=>t.effectiveTheme.accentColor,d=>{let m=z.toUnitRGBA(d);l.setParameters({color:m}),c.setParameters({color:m}),u.setParameters({color:m})},R)}destroy(){this._themeHandle.remove(),super.destroy()}};function fc({isCorner:e,unfocusedMaterial:t,focusedMaterial:i,outlineMaterial:a}){let o=e?[k(1,0,0),k(0,0,0),k(0,1,0)]:[k(1,0,0),k(-1,0,0)];return{renderObjects:[new b(ee(t,o),M.Unfocused|Di),new b(ee(i,o),M.Focused|Di),new b(ee(a,o),sa)],collisionType:{type:"line",paths:[o]},radius:e?Xl:Wl,state:Di}}var ua=class{constructor(t,i){this._tool=t,this.mapBounds=Oe(),this.mapBoundsStart=Oe(),this.displayBounds=Oe(),t.addHandles(Se(()=>t.object,"modified-externally",()=>this._resetMapBounds(),{onListenerAdd:()=>this._resetMapBounds()})),this._onDisplayBoundsChanged=i}get displayBoundsMargin(){let{view:t,object:i}=this._tool,a=F(i),o=t.pointsOfInterest?.centerOnSurfaceFrequent.location??a?.extent?.center;return o?gc*t.pixelSizeAt(o):0}backupMapBounds(){Ee(this.mapBounds,this.mapBoundsStart)}updateDisplayBounds(){this._calculateDisplayBounds(),this._onDisplayBoundsChanged?.()}updateMapBoundsFromOperation(t){jn(t,this.mapBounds),this.updateDisplayBounds()}updateMapBoundsFromOperationInverse(t){Ln(t,this.mapBounds),this.updateDisplayBounds()}_resetMapBounds(){this._calculateMapBounds(),this.updateDisplayBounds()}_calculateMapBounds(){let{view:t,attachmentOrigin:i,object:a}=this._tool,o=a.operations?.data;if(!o)return;let s=o.geometry;this.spatialReference=s.spatialReference;let r=ml(s);go(r,r,-1);let n=t.spatialReference,l=s.spatialReference,c=i?t.pixelSizeAt(i)*ba(n)/zi(l):0;zn(r,o,_c*c,this.mapBounds)}_calculateDisplayBounds(){let{view:t,attachmentOrigin:i}=this._tool,a=i?.z??fi(this.mapBounds.origin,t.elevationProvider,ie.fromElevationInfo(this._tool.object.elevationInfo),t.renderCoordsHelper),o=Ee(this.mapBounds);o.origin[2]=a??0,vc(o,t.renderCoordsHelper,this.spatialReference,this.displayBoundsMargin,this.displayBounds)}},gc=10,_c=80;function vc(e,t,i,a=0,o){o||(o=Oe()),t.toRenderCoords(e.origin,i,o.origin);let s=y.get();W(s,e.origin,e.basis1),W(s,s,e.basis2),t.toRenderCoords(s,i,s);let r=y.get();W(r,e.origin,e.basis1),C(r,r,e.basis2),t.toRenderCoords(r,i,r);let n=y.get();C(n,e.origin,e.basis1),C(n,n,e.basis2),t.toRenderCoords(n,i,n);let l=y.get();C(l,e.origin,e.basis1),W(l,l,e.basis2),t.toRenderCoords(l,i,l);let c=de(y.get(),s,r,.5);C(c,c,o.origin);let u=de(y.get(),n,l,.5);C(u,o.origin,u),de(o.basis1,c,u,.5);let d=de(y.get(),l,s,.5);C(d,d,o.origin);let m=de(y.get(),r,n,.5);C(m,o.origin,m),de(o.basis2,d,m,.5);let f=_t(y.get(),o.basis1,o.basis2),_=_t(f,f,o.basis1);return At(_,_),J(o.basis2,_,he(o.basis2,_)),J(o.basis1,o.basis1,1+a/gt(o.basis1)),J(o.basis2,o.basis2,1+a/gt(o.basis2)),Ya(o),o}function Gs(e,t,i){return C(Ci,C(Ci,e.origin,e.basis1),e.basis2),ce(da,Ci,e.basis1,2),ce(ks,da,e.basis2,2),ce(Vs,Ci,e.basis2,2),Ci[2]=da[2]=ks[2]=Vs[2]=t,il({topLeft:Vs,topRight:ks,bottomRight:da,bottomLeft:Ci,spatialReference:i})}var Vs=O(),ks=O(),da=O(),Ci=O();var ma=class{get _object(){return this._tool.object}get _operations(){return this._object.operations}get zMax(){if(!this._zMaxDirty||!this._operations)return this._zMax;let t=this._operations.data;if(t.geometry.hasZ){let i=t.coordinateHelper;this._zMax=Number.NEGATIVE_INFINITY;for(let a of t.components)for(let o of a.vertices){let s=i.getZ(o.pos)??0;this._zMax=Math.max(s,this._zMax)}}else this._zMax=0;return this._zMaxDirty=!1,this._zMax}constructor(t,i,a){this._tool=t,this._bounds=i,this._preserveAspectRatioStep=a,this._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],this._scaleTooltipInfo=null,this._displayBoundsStart=Oe(),this._displayBoundsMarginStart=0,this._startScale=Ze(),this._endScale=Ze(),this._sizeStart=null,this._zMax=0,this._zMaxDirty=!0;let o=this._tool,s=o.view;this.resizeManipulators=this._resizeHandles.map(r=>{let n=new ha(s,r);return o.addHandles([n.events.on("grab-changed",l=>this._onResizeGrab(l)),this._createResizeDragPipeline(n,r)]),n}),o.manipulators.addMany(this.resizeManipulators),o.addHandles([o.events.on("scale-start",r=>{Qt(this._startScale,r.xScale,r.yScale),Qt(this._endScale,r.xScale,r.yScale)}),o.events.on("scale",r=>{Qt(this._endScale,r.xScale,r.yScale)}),o.events.on("scale-stop",()=>{Qt(this._startScale,0,0),Qt(this._endScale,0,0)})]),this._operations&&o.addHandles(this._operations.data.on("change",()=>{o.inputState?.type!=="resize"&&(this._zMaxDirty=!0)}))}destroy(){this.forEachManipulator(t=>{this._tool.manipulators.remove(t),t.destroy()})}forEachManipulator(t){this.resizeManipulators.forEach(i=>t(i,I.SCALE))}updateManipulators(t,i){this.resizeManipulators.forEach((a,o)=>{ep(a,this._resizeHandles[o],t,i)})}getUpdatedTooltipInfo(){return this.resizeManipulators.some(t=>t.focused)?this._computeScaleTooltipInfo():null}_computeScaleTooltipInfo(){let t=this._tool,i=this._scaleTooltipInfo??=new ol({sketchOptions:t.sketchOptions}),a=Gs(this._bounds.mapBounds,this.zMax,this._bounds.spatialReference);return a==null?null:(i.xSize=a.xSize,i.ySize=a.ySize,this._sizeStart!=null&&this.resizeManipulators.some(o=>o.dragging)?(i.xScale=a.xSize.value/this._sizeStart.xSize.value,i.yScale=a.ySize.value/this._sizeStart.ySize.value):(i.xScale=1,i.yScale=1),i)}_onResizeGrab({action:t,screenPoint:i}){let a=this._tool,o=this._bounds;if(t!=="start"||!i)return;let s=Ho(a.view.state.camera,i);Ui(o.displayBounds.plane,s,y.get())&&(o.backupMapBounds(),Ee(o.displayBounds,this._displayBoundsStart),this._displayBoundsMarginStart=o.displayBoundsMargin,this._sizeStart=Gs(o.mapBoundsStart,this.zMax,o.spatialReference),a.inputState={type:"resize"})}_createResizeDragPipeline(t,i){let{_tool:a,_object:o}=this;return K(t,(s,r,n)=>{a.inputState!=null&&(r.next(l=>(l.action==="start"&&a.events.emit("scale-start",{object:o,xScale:1,yScale:1}),l)).next(gi(a.view,this._displayBoundsStart.plane)).next(l=>x(v({},l),{handle:i})).next(this._resizeDragRenderPlaneToFactors()).next(...this._preserveAspectRatioStep()).next(this._resizeDragUpdateGeometry()).next(l=>{let c={object:o,xScale:l.factor1,yScale:l.factor2};switch(l.action){case"start":case"update":a.events.emit("scale",c);break;case"end":a.inputState=null,a.events.emit("scale-stop",c)}return l}),n.next(()=>{a.inputState!=null&&a.events.emit("scale-stop",{object:o,xScale:1,yScale:1}),a.cancel()}))})}_resizeDragRenderPlaneToFactors(){let t=this._bounds;return i=>{let a=this._displayBoundsStart,o=i.handle.direction,s=t.displayBoundsMargin,r=this._displayBoundsMarginStart,n=Jt(y.get(),a.origin);ce(n,n,a.basis1,-o[0]),ce(n,n,a.basis2,-o[1]);let l=C(y.get(),i.renderEnd,n),c=C(y.get(),i.renderStart,n),u=ii(i.handle),d=aa(a),m=aa(t.displayBounds)/d,f=(_,S)=>{if(_===0)return 1;let D=gt(S),T=.5*_*he(S,l)/D,E=T<0?-1:1;u&&(T+=(D-.5*_*he(S,c)/D)*E*m);let $=D<1.5*r?1:lp;return D=Math.max(D-r,lp),E>0&&(T-=s),E*Math.max(E*(T/D),$)};return x(v({},i),{factor1:f(o[0],a.basis1),factor2:f(o[1],a.basis2)})}}_resizeDragUpdateGeometry(){let t=this._bounds;return i=>{let a=Jt(O(),t.mapBoundsStart.origin);ce(a,a,t.mapBoundsStart.basis1,-i.handle.direction[0]),ce(a,a,t.mapBoundsStart.basis2,-i.handle.direction[1]);let o=Qt(Ze(),t.mapBoundsStart.basis1[0],t.mapBoundsStart.basis1[1]);_o(o,o);let s=i.action==="start"?nt.NEW_STEP:nt.ACCUMULATE_STEPS;if(this._operations){let r=this._operations.scale(a,o,i.factor1,i.factor2,s,Do.REPLACE);Ee(t.mapBoundsStart,t.mapBounds),t.updateMapBoundsFromOperation(r)}return i}}},lp=1e-6;var fa=class{constructor(){this._lastDragEvent=null,this._next=null,this._enabled=!1}get enabled(){return this._enabled}set enabled(t){if(this._enabled!==t&&this._lastDragEvent!=null&&this._next!=null){let i=x(v({},this._lastDragEvent),{action:"update"});t&&pp(i),this._next.execute(i)}this._enabled=t}createDragEventPipelineStep(){this._lastDragEvent=null;let t=new ui;return this._next=t,[i=>(this._lastDragEvent=i.action!=="end"?v({},i):null,this._enabled&&pp(i),i),t]}get test(){}};function pp(e){let t=ii(e.handle)?Math.max(Math.abs(e.factor1),Math.abs(e.factor2)):e.handle.direction[0]===0?Math.abs(e.factor2):Math.abs(e.factor1);e.factor1=e.factor1<0?-t:t,e.factor2=e.factor2<0?-t:t}var ga=class{constructor(){this._lastDragEvent=null,this._next=null,this.incrementRadians=ct(5),this._enabled=!1}get enabled(){return this._enabled}set enabled(t){if(this._enabled!==t&&this._lastDragEvent!=null&&this._next!=null){let i=x(v({},this._lastDragEvent),{action:"update"});t&&this._adjustRotation(i),this._next.execute(i)}this._enabled=t}createDragEventPipelineStep(){this._lastDragEvent=null;let t=new ui;return this._next=t,[i=>(this._lastDragEvent=i.action!=="end"?v({},i):null,this._enabled&&this._adjustRotation(i),i),t]}_adjustRotation(t){t.rotateAngle=Math.round(t.rotateAngle/this.incrementRadians)*this.incrementRadians}};var mt=class extends Ae{get updating(){return!!this.object.updating}constructor(e){super(e),this.events=new q,this.enableZ=!0,this.enableScaling=!0,this.enableRotation=!0,this.sketchOptions=new Rt,this._preserveAspectRatio=new fa,this._snapRotation=new ga,this.grabbing=!1,this.inputState=null,this._attachmentOrigin=null,this.type="transform-3d",this._outlineVisualElement=null}initialize(){let{view:e,object:t}=this,i=this._bounds=new ua(this,()=>this._updateManipulators());this._extentMove=new na(this,i),this._extentScale=new ma(this,i,()=>this._preserveAspectRatio.createDragEventPipelineStep()),this._extentRotate=new ca(this,i,()=>this._snapRotation.createDragEventPipelineStep()),this.addHandles([g(()=>this.enableZ,()=>this._updateManipulatorAvailability(this._extentMove.moveZManipulator,I.TRANSLATE_Z)),g(()=>this.enableScaling,()=>this._extentScale.forEachManipulator(r=>this._updateManipulatorAvailability(r,I.SCALE))),g(()=>this.enableRotation,()=>this._updateManipulatorAvailability(this._extentRotate.rotateManipulator,I.ROTATE))]),this._updateManipulators(),this._updateAllManipulatorAvailability();let a=Re({view:e,object:t,forEachManipulator:r=>this._forEachManipulator(r),onManipulatorsChanged:()=>j()});if(a!=null){let{visualElement:r}=a;r instanceof yt&&(this._outlineVisualElement=r,this.addHandles(r.events.on("attachment-origin-changed",()=>this._bounds.updateDisplayBounds()))),this.addHandles(a)}this.addHandles([t.on("committed",()=>this._onGeometryChanged()),g(()=>this.object.visible,()=>this._updateAllManipulatorAvailability()),g(()=>this.object.isDraped,()=>this._graphicDrapedChanged(),R),g(()=>e.pointsOfInterest?.centerOnSurfaceFrequent.location,()=>i.updateDisplayBounds())]);let o=r=>{this.addHandles(r.events.on("grab-changed",()=>{this.grabbing=r.grabbing,this._updateAllManipulatorAvailability()}))};this._forEachManipulator(o);let s=(r,n)=>{this.addHandles(r.events.on("immediate-click",l=>{n===I.TRANSLATE_XY&&this.events.emit("immediate-click",x(v({},l),{object:t})),l.stopPropagation()}))};this._forEachManipulator(s),this._initializeTooltip(),this.finishToolCreation()}destroy(){this._extentMove.destroy(),this._extentScale.destroy(),this._extentRotate.destroy(),this.tooltip.destroy(),this._set("view",null),this._set("object",null)}_initializeTooltip(){let{view:e}=this,t=this.tooltip=new te({view:e}),i=()=>{t.info=this._getUpdatedTooltipInfo()};this.addHandles([g(()=>this.sketchOptions.tooltips.effectiveEnabled,i),this.events.on("translate-start",i),this.events.on("translate",i),this.events.on("translate-stop",()=>this.tooltip.clear()),this.events.on("rotate-start",i),this.events.on("rotate",i),this.events.on("rotate-stop",i),this.events.on("scale-start",i),this.events.on("scale",i),this.events.on("scale-stop",i)]),this._forEachManipulator(a=>{this.addHandles([a.events.on("focus-changed",i),a.events.on("grab-changed",i),a.events.on("drag",o=>{o.action==="cancel"?this.tooltip.clear():i()})])})}_getUpdatedTooltipInfo(){return this.sketchOptions.tooltips.effectiveEnabled?this._extentMove.getUpdatedTooltipInfo()??this._extentScale.getUpdatedTooltipInfo()??this._extentRotate.getUpdatedTooltipInfo():null}_onGeometryChanged(){this._bounds.updateDisplayBounds()}_graphicDrapedChanged(){this.removeHandles(cp),this._bounds.updateDisplayBounds(),this.object.isDraped&&this.addHandles(this.view.elevationProvider.on("elevation-change",e=>{this._attachmentOrigin!=null&&ho(e.extent,this._attachmentOrigin.x,this._attachmentOrigin.y)&&this._bounds.updateDisplayBounds()}),cp)}_updateManipulators(){if(!this.visible)return;let e=this._bounds.displayBounds,t=Kl(e,X.get());this._extentMove.updateManipulators(t,e),this._extentScale.updateManipulators(t,e),this._extentRotate.updateManipulators(t,e)}_updateAllManipulatorAvailability(){this._forEachManipulator((e,t)=>this._updateManipulatorAvailability(e,t))}_updateManipulatorAvailability(e,t){let i=this.grabbing&&!e.grabbing;if(e.interactive=!i,e instanceof N){let a=this.object.visible,o=this.enableZ&&Xt(this.object.operations,this.object.elevationInfo);switch(t){case I.ROTATE:e.available=a&&this.enableRotation;break;case I.SCALE:e.available=a&&(this.enableScaling||this.enableRotation||o),e.interactive=!i&&this.enableScaling,e.state=this.enableScaling?Di:sa;break;case I.TRANSLATE_Z:e.available=a&&o;break;default:e.available=a}}}_forEachManipulator(e){this._extentMove.forEachManipulator(e),this._extentScale.forEachManipulator(e),this._extentRotate.forEachManipulator(e)}get preserveAspectRatio(){return this._preserveAspectRatio.enabled}set preserveAspectRatio(e){this._preserveAspectRatio.enabled=e,this._set("preserveAspectRatio",e)}get snapRotation(){return this._snapRotation.enabled}set snapRotation(e){this._snapRotation.enabled=e,this._set("snapRotation",e)}get attachmentOrigin(){let e=this.object.isDraped?null:this._outlineVisualElement?.attachmentOrigin;return this._attachmentOrigin=e??this.object.origin??F(this.object)?.extent?.center,this._attachmentOrigin}reset(){}cancel(){if(this.canUndo){let e=this.object.operations?.undo();e&&this._bounds.updateMapBoundsFromOperationInverse(e)}this.inputState=null}get canUndo(){return!!this.object.operations?.canUndo}undo(){if(this.inputState!=null)this.view.activeTool=null;else if(this.canUndo){let e=this.object.operations?.undo();e&&this._bounds.updateMapBoundsFromOperationInverse(e)}}get canRedo(){return!!this.object.operations?.canRedo}redo(){if(this.canRedo){let e=this.object.operations?.redo();e&&this._bounds.updateMapBoundsFromOperation(e)}}get test(){}};p([h()],mt.prototype,"updating",null),p([h({constructOnly:!0,nonNullable:!0})],mt.prototype,"view",void 0),p([h({constructOnly:!0,nonNullable:!0})],mt.prototype,"object",void 0),p([h()],mt.prototype,"enableZ",void 0),p([h()],mt.prototype,"enableScaling",void 0),p([h()],mt.prototype,"enableRotation",void 0),p([h({constructOnly:!0,type:Rt})],mt.prototype,"sketchOptions",void 0),p([h()],mt.prototype,"preserveAspectRatio",null),p([h()],mt.prototype,"snapRotation",null),p([h()],mt.prototype,"grabbing",void 0),p([h()],mt.prototype,"inputState",void 0),p([h({readOnly:!0})],mt.prototype,"type",void 0),p([h()],mt.prototype,"tooltip",void 0),mt=p([w("esri.views.3d.interactive.editingTools.transform.ExtentTransformTool")],mt);var cp="draped-elevation-changes";function hp(e){return e!=null&&e.type==="mesh"?yc(e):bc(e)}function yc(e){return xr(e.vertexSpace)?Mc(e,e.transform,e.vertexSpace):Sc(e)}function bc(e){let t=e,i=null;return{undo(a){i=a.geometry,a.geometry=t},redo(a){t=a.geometry,a.geometry=i}}}function Mc(e,t,i){let a=t?.clone(),o=pe(i.origin),s=null,r=null;return{undo:()=>{s=e.transform?.clone(),r=pe(i.origin),e.transform=a,e.vertexSpace.origin=o},redo:()=>{a=e.transform?.clone(),o=pe(i.origin),e.transform=s,e.vertexSpace.origin=r}}}function Sc(e){let t,i=e.vertexAttributes.clonePositional();return{undo:()=>{t=e.vertexAttributes.clonePositional(),e.vertexAttributes=i},redo:()=>{i=e.vertexAttributes.clonePositional(),e.vertexAttributes=t}}}var Fs=Symbol(),Ve=class extends q.EventedAccessor{get operations(){return this._operations}get updating(){return this._updatingHandles.updating}get elevationInfo(){return Dr(this.graphic)}get visible(){return this._graphicState.displaying}get isDraped(){return this._graphicState.isDraped}get origin(){return Jn(this.view,this.graphic)}constructor(e){super(e),this._updatingHandles=new we}destroy(){this._operations=H(this._operations),this._updatingHandles.destroy()}initialize(){this._graphicState=new oe({graphic:this.graphic}),this._graphicState.on("changed",()=>this.emit("committed")),this.addHandles(this.view.trackGraphicState(this._graphicState)),this.addHandles(this._updatingHandles.add(()=>this.graphic.geometry,e=>{let t=this._operations?.data.geometry;if(e!==t){if(!e||e?.type==="multipoint"||e?.type==="extent")return H(this._operations),this.removeHandles(Fs),void(this._operations=null);if(this._operations?.trySetGeometry(e))this.emit("modified-externally");else{H(this._operations),this.removeHandles(Fs);let i=di.fromGeometry(e,this.view.state.viewingMode);this._operations=i,this.addHandles(i.data.on("change",()=>this.graphic.geometry=i.data.geometry),Fs)}}},R))}createManipulator(e){return new Cn(v({view:this.view,graphic:this.graphic},e))}maskOccludee(){return this.view.maskOccludee(this.graphic)}endInteraction(){this.graphic.geometry?.type==="mesh"&&this.graphic.notifyMeshTransformChanged({action:Wi.UpdateFastLocalOrigin})}toMap(e){return this.view.toMap(e,{include:[this.graphic]})}createUndoRecord(){let{graphic:{geometry:e}}=this;return hp(e)}};p([h({constructOnly:!0})],Ve.prototype,"view",void 0),p([h({constructOnly:!0})],Ve.prototype,"graphic",void 0),p([h()],Ve.prototype,"_operations",void 0),p([h()],Ve.prototype,"operations",null),p([h()],Ve.prototype,"updating",null),Ve=p([w("esri.views.3d.interactive.editingTools.ManipulatedObject3DGraphic")],Ve);export{Ke as DrawGraphicTool3D,mt as ExtentTransformTool,Ve as ManipulatedObject3DGraphic,Ot as MoveTool3D,tt as ReshapeTool3D,St as TransformTool3D};
