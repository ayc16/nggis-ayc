import{d as k,e as nn}from"./chunk-JVY3X3AX.js";import{e as en,f as rn,g as on,p as lt,q as ct}from"./chunk-XFFRGEY6.js";import{b as Z,c as Ut,h as qe,i as F,l as Wt}from"./chunk-4DOINYTW.js";import{a as jt}from"./chunk-4OC4J3KU.js";import{b as Xe,d as Ye,e as Ke,f as Je,i as Lt,j as Qe,k as Nt,l as $e,t as tn}from"./chunk-BY64D2AL.js";import{b as H,h as Mt,j as Be}from"./chunk-GLDWQ77T.js";import{e as Ne,g as je}from"./chunk-R4SFVOZO.js";import{a as We}from"./chunk-BWK3LBHF.js";import{b as Ge,d as Ue,f as at}from"./chunk-O73QQ7Z7.js";import{a as Gt,b as Le}from"./chunk-WBPLJNRU.js";import{b as Fe,l as Y,m as kt,o as He,w as ke}from"./chunk-VIK3ZB6O.js";import{f as ze,o as Ze}from"./chunk-KYPWFZ3A.js";import{c as Ie}from"./chunk-E2J2V7JN.js";import{a as st}from"./chunk-32VQE3PR.js";import{a as ot}from"./chunk-NIYDRLW4.js";import{a as Ae}from"./chunk-XHOTVM3O.js";import{d as Oe}from"./chunk-JD3KGBGX.js";import{d as De,i as Ve}from"./chunk-NYOCZ43I.js";import{a as Ht}from"./chunk-IFFYADB3.js";import{c as Ee}from"./chunk-47MSGR2H.js";import{a as Re}from"./chunk-47Q3ZDMA.js";import{a as X,b as bt}from"./chunk-KQMHXU66.js";import{c as xt,e as St}from"./chunk-OJB2TSJ7.js";import{h as rt}from"./chunk-IISBSAYJ.js";import{a as V,h as yt}from"./chunk-4XUOIGFO.js";import{d as B,e as Te}from"./chunk-AM3VOA32.js";import{a as ge,p as q,q as Pe}from"./chunk-M76YZBV5.js";import{i as ye,l as zt,m as ve}from"./chunk-HXQMOXFX.js";import{a as vt}from"./chunk-BCREO4Q5.js";import{b as Ft}from"./chunk-76YVRX2R.js";import{b as _e,d as xe,e as _t,l as Se,s as be,t as Me,u as we,v as Ce,y as Zt}from"./chunk-OZF6BMOL.js";import{a as T}from"./chunk-GJP6PTKT.js";import{b as re}from"./chunk-SF6Z2K5H.js";import{a as gt}from"./chunk-GBTN5LIS.js";import{h as me,i as fe,l as P}from"./chunk-2KZICFRS.js";import{b as j}from"./chunk-D2RUV6O4.js";import{A as At,I as se,O as ae,Y as le,aa as ce,ba as pe,ea as ue,fa as he,ha as de,k as oe}from"./chunk-4JWMB5SM.js";import{L as p,O as N}from"./chunk-AUTL5LCV.js";import{S as D}from"./chunk-KUJG22IX.js";import{a as c}from"./chunk-W3WDPWBE.js";import{B as ft,C as ie,t as it}from"./chunk-GISCFF3Z.js";import{b as dt,d as mt,e as nt,g as ne}from"./chunk-MLSR6YE6.js";import{b as L}from"./chunk-HQMV3KQV.js";import{g as ee,q as I}from"./chunk-CRMMDK2Z.js";import{a as v,b,h as W}from"./chunk-EAH6BNBL.js";var R,sn,an;(function(t){t[t.USER=0]="USER",t[t.MANAGER=1]="MANAGER"})(R||(R={})),function(t){t[t.None=0]="None",t[t.Unfocused=1]="Unfocused",t[t.Focused=2]="Focused",t[t.Unselected=4]="Unselected",t[t.Selected=8]="Selected",t[t.All=15]="All"}(sn||(sn={})),function(t){t[t.None=0]="None",t[t.Custom1=16]="Custom1",t[t.Custom2=32]="Custom2",t[t.Custom3=64]="Custom3",t[t.Custom4=128]="Custom4",t[t.Custom5=256]="Custom5",t[t.Custom6=512]="Custom6",t[t.Custom7=1024]="Custom7",t[t.Custom8=2048]="Custom8",t[t.Custom9=4096]="Custom9",t[t.Custom10=8192]="Custom10",t[t.Custom11=16384]="Custom11",t[t.Custom12=32768]="Custom12",t[t.All=65520]="All"}(an||(an={}));var G;(function(t){t[t.WhenToolEditable=0]="WhenToolEditable",t[t.WhenToolNotEditable=1]="WhenToolNotEditable",t[t.Always=2]="Always"})(G||(G={}));var wt=class{constructor(){this._isToolEditable=!0,this._manipulators=new re,this._resourceContexts={manipulator3D:{}},this._attached=!1}set isToolEditable(e){this._isToolEditable=e}get length(){return this._manipulators.length}add(e,n=G.WhenToolEditable){this.addMany([e],n)}addMany(e,n=G.WhenToolEditable){for(let i of e){let r={manipulator:i,visibilityPredicate:n,attached:!1};this._manipulators.add(r),this._attached&&this._updateManipulatorAttachment(r)}}remove(e){for(let n=0;n<this._manipulators.length;n++)if(this._manipulators.at(n).manipulator===e){let i=this._manipulators.splice(n,1)[0];this._detachManipulator(i);break}}removeAll(){this._manipulators.forEach(e=>{this._detachManipulator(e)}),this._manipulators.removeAll()}attach(){this._manipulators.forEach(e=>{this._updateManipulatorAttachment(e)}),this._attached=!0}detach(){this._manipulators.forEach(e=>{this._detachManipulator(e)}),this._attached=!1}destroy(){this.detach(),this._manipulators.forEach(({manipulator:e})=>e.destroy()),this._manipulators.destroy(),this._resourceContexts=null}on(e,n){return this._manipulators.on(e,i=>{n(i)})}forEach(e){for(let n of this._manipulators.items)e(n)}some(e){return this._manipulators.items.some(e)}toArray(){let e=[];return this.forEach(n=>e.push(n.manipulator)),e}intersect(e,n){let i=null,r=Number.MAX_VALUE;return this._manipulators.forEach(({manipulator:o,attached:s})=>{if(!s||!o.interactive)return;let a=o.intersectionDistance(e,n);a!=null&&a<r&&(r=a,i=o)}),i}_updateManipulatorAttachment(e){this._isManipulatorItemVisible(e)?this._attachManipulator(e):this._detachManipulator(e)}_attachManipulator(e){e.attached||(e.manipulator.attach&&e.manipulator.attach(this._resourceContexts),e.attached=!0)}_detachManipulator(e){if(!e.attached)return;let n=e.manipulator;n.grabbing=!1,n.dragging=!1,n.hovering=!1,n.selected=!1,n.detach&&n.detach(this._resourceContexts),e.attached=!1}_isManipulatorItemVisible(e){return e.visibilityPredicate===G.Always||(this._isToolEditable?e.visibilityPredicate===G.WhenToolEditable:e.visibilityPredicate===G.WhenToolNotEditable)}};var w=class extends N{constructor(t){super(t),this.manipulators=new wt,this.automaticManipulatorSelection=!0,this.hasGrabbedManipulators=!1,this.hasHoveredManipulators=!1,this.firstGrabbedManipulator=null,this.created=!1,this.removeIncompleteOnCancel=!0,this._editableFlags=new Map([[R.MANAGER,!0],[R.USER,!0]]),this._creationFinishedResolver=ie()}get active(){return this.view!=null&&this.view.activeTool===this}set visible(t){this._get("visible")!==t&&(this._set("visible",t),this._syncVisible())}get editable(){return this.getEditableFlag(R.USER)}set editable(t){this.setEditableFlag(R.USER,t)}get updating(){return!1}get cursor(){return null}get hasFocusedManipulators(){return this.hasGrabbedManipulators||this.hasHoveredManipulators}destroy(){this.manipulators.destroy(),this._set("view",null)}onAdd(){this._syncVisible()}activate(){this.view!=null&&(this.view.focus(),this.onActivate())}deactivate(){this.onDeactivate()}handleInputEvent(t){this.onInputEvent(t)}handleInputEventAfter(t){this.onInputEventAfter(t)}setEditableFlag(t,e){this._editableFlags.set(t,e),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),t===R.USER&&this.notifyChange("editable"),this.onEditableChange(),this.onManipulatorSelectionChanged()}getEditableFlag(t){return this._editableFlags.get(t)??!1}whenCreated(){return this._creationFinishedResolver.promise}onManipulatorSelectionChanged(){}onActivate(){}onDeactivate(){}onShow(){}onHide(){}onEditableChange(){}onInputEvent(t){}onInputEventAfter(t){}get internallyEditable(){return this.getEditableFlag(R.USER)&&this.getEditableFlag(R.MANAGER)}finishToolCreation(){this.created||this._creationFinishedResolver.resolve(this),this._set("created",!0)}_syncVisible(){if(this.initialized){if(this.visible)this._show();else if(this._hide(),this.active)return void(this.view.activeTool=null)}}_show(){this._updateManipulatorAttachment(),this.onShow()}_hide(){this._updateManipulatorAttachment(),this.onHide()}_updateManipulatorAttachment(){this.visible?this.manipulators.attach():this.manipulators.detach()}};c([p({constructOnly:!0})],w.prototype,"view",void 0),c([p({readOnly:!0})],w.prototype,"active",null),c([p({value:!0})],w.prototype,"visible",null),c([p({value:!0})],w.prototype,"editable",null),c([p({readOnly:!0})],w.prototype,"manipulators",void 0),c([p({readOnly:!0})],w.prototype,"updating",null),c([p()],w.prototype,"cursor",null),c([p({readOnly:!0})],w.prototype,"automaticManipulatorSelection",void 0),c([p()],w.prototype,"hasFocusedManipulators",null),c([p()],w.prototype,"hasGrabbedManipulators",void 0),c([p()],w.prototype,"hasHoveredManipulators",void 0),c([p()],w.prototype,"firstGrabbedManipulator",void 0),c([p({readOnly:!0})],w.prototype,"created",void 0),c([p({readOnly:!0})],w.prototype,"removeIncompleteOnCancel",void 0),w=c([D("esri.views.interactive.InteractiveToolBase")],w);function An(t,e){let n=null,i=null;return r=>{if(r.action==="cancel")return void(i!=null&&(i.execute({action:"cancel"}),n=null,i=null));let o={action:r.action,screenStart:r.start,screenEnd:r.screenPoint};r.action==="start"&&n==null&&(n=new K,i=new K,e(t,n,i,r.pointerType,o)),n?.execute(o),r.action==="end"&&n!=null&&(n=null,i=null)}}function Ct(t,e){return t.events.on("drag",An(t,e))}function wi(t,e){let n=[t.x,t.y,t.z??0],i=e,r=[Math.cos(i),Math.sin(i)],o=Math.sqrt(r[0]*r[0]+r[1]*r[1]);if(o===0)return null;r[0]/=o,r[1]/=o;let s=a=>{let l=(a.x-n[0])*r[0]+(a.y-n[1])*r[1];a.x=n[0]+l*r[0],a.y=n[1]+l*r[1]};return a=>(s(a.mapStart),s(a.mapEnd),b(v({},a),{axis:r}))}function zn(t){let e=null;return n=>{if(n.action==="start"&&(e=Zn(t,n.mapStart.spatialReference)),e==null)return null;let i=n.mapEnd.x-n.mapStart.x,r=n.mapEnd.y-n.mapStart.y,o=(n.mapEnd.z??0)-(n.mapStart.z??0);return e.move(i,r,o,n.action),b(v({},n),{translationX:i,translationY:r,translationZ:o})}}function ln(t,e){return t==null?null:t.spatialReference.equals(e)?t.clone():rt(t,e)}function Zn(t,e){let n=t.operations;if(!n)return null;let i=n.data.geometry,r=nn(e);if(i.spatialReference.equals(r))return qt(t,n,()=>{});if(i.type!=="mesh"){let o=ln(i,r);if(o==null)return null;let s=i.spatialReference;return qt(t,lt.fromGeometry(o,n.viewingMode),()=>{let a=rt(i,s);n.trySetGeometry(a)})}if(Ee(i)){let o=ln(i.origin,r);if(!o)return null;let s=i.spatialReference,a=lt.fromGeometry(o,n.viewingMode);return qt(t,n,()=>{let l=rt(a.data.geometry,s),u=l.x-i.origin.x,h=l.y-i.origin.y,g=(l.z??0)-(i.origin.z??0);n.move(u,h,g)})}return null}function qt(t,e,n){let i=0,r=0,o=0;return{move:(s,a,l,u)=>{u==="start"&&(i=0,r=0,o=0);let h=s-i,g=a-r,S=l-o;e.move(h,g,S),i+=h,r+=g,o+=S,n(),u==="end"&&t.endInteraction?.()}}}function Ci(t,e=null,n){let i=null,r=e==null||t.spatialReference?.equals(e)?s=>s:s=>s!=null?rt(s,e):s,o=v({exclude:[]},n);return s=>{if(s.action==="start"&&(i=r(t.toMap(s.screenStart,o))),i==null)return null;let a=r(t.toMap(s.screenEnd,o));return a!=null?b(v({},s),{mapStart:i,mapEnd:a}):null}}function Pi(t){let e=t.map(n=>zn(n)).filter(I);return n=>{let i=n.mapEnd.x-n.mapStart.x,r=n.mapEnd.y-n.mapStart.y,o=n.mapEnd.z-n.mapStart.z;return e.forEach(s=>s(n)),b(v({},n),{translationX:i,translationY:r,translationZ:o})}}function Fn(t){let e=t.operations?.createResetState();return n=>(e?.remove(),n)}function Ti(t){let e=t.map(n=>Fn(n)).filter(n=>n!=null);return n=>(e.forEach(i=>i(n)),n)}function Ei(){let t=0,e=0,n=0;return i=>{i.action==="start"&&(t=i.mapStart.x,e=i.mapStart.y,n=i.mapStart.z);let r=i.mapEnd.x-t,o=i.mapEnd.y-e,s=i.mapEnd.z-n;return t=i.mapEnd.x,e=i.mapEnd.y,n=i.mapEnd.z,b(v({},i),{mapDeltaX:r,mapDeltaY:o,mapDeltaZ:s,mapDeltaSpatialReference:i.mapStart.spatialReference})}}function Ri(){let t=0,e=0;return n=>{n.action==="start"&&(t=n.screenStart.x,e=n.screenStart.y);let i=n.screenEnd.x-t,r=n.screenEnd.y-e;return t=n.screenEnd.x,e=n.screenEnd.y,b(v({},n),{screenDeltaX:i,screenDeltaY:r})}}function Oi(t,e){let n=null,i=0,r=0;return o=>{if(o.action==="start"&&(n=t.toScreen?.(e),n!=null&&(n.x<0||n.x>t.width||n.y<0||n.y>t.height?n=null:(i=o.screenStart.x-n.x,r=o.screenStart.y-n.y))),n==null)return null;let s=Ft(o.screenEnd.x-i,0,t.width),a=Ft(o.screenEnd.y-r,0,t.height),l=B(s,a);return o.screenStart=n,o.screenEnd=l,o}}var Hn=()=>{},K=class t{constructor(){this.execute=Hn}next(e,n=new t){return e!=null&&(this.execute=i=>{let r=e(i);r!=null&&n.execute(r)}),n}};function pn(t,e,n=[]){if(t.type==="2d")return r=>r;let i=null;return r=>{r.action==="start"&&(i=t.toMap(r.screenStart,{exclude:n}),i!=null&&(i.z=Y(i,t,e)));let o=t.toMap(r.screenEnd,{exclude:n});o!=null&&(o.z=Y(o,t,e));let s=i!=null&&o!=null?{sceneStart:i,sceneEnd:o}:null;return b(v({},r),{scenePoints:s})}}function cn(t,e,n){let i=e.elevationProvider.getElevation(t.x,t.y,t.z??0,t.spatialReference,"scene")??0,r=k(t);return r.z=i,r.hasZ=!0,r.z=Y(r,e,n),r}function Ii(t,e){if(t.type==="2d")return i=>i;let n=null;return i=>{i.action==="start"&&(n=cn(i.mapStart,t,e));let r=cn(i.mapEnd,t,e),o=n!=null&&r!=null?{sceneStart:n,sceneEnd:r}:null;return b(v({},i),{scenePoints:o})}}function hn({predicate:t=()=>!0,snappingManager:e,snappingContext:n,updatingHandles:i,useZ:r=!0}){let o=new K;if(e==null)return{snappingStep:[un,o],cancelSnapping:un};let s,a=null,l=null,u=null,h=()=>{a=nt(a),e.doneSnapping(),l?.frameTask.remove(),l=null,s=mt(s),u=null},g=kn(e,r,o),S=null,_=null,y=null;return{snappingStep:[m=>{if(!t(m))return m;let{action:C}=m;if(C==="start"){let{info:x}=m,M=Gn(e.view);if(l=Un(n,m,M),l.context.selfSnappingZ=null,!r&&x!=null){let O=Ln(n.coordinateHelper,x.handle.component);O!=null&&(l.context.selfSnappingZ={value:O,elevationInfo:n.elevationInfo??ke})}}if(l!=null){let{context:x,originalScenePos:M,originalPos:O}=l,{mapEnd:$,mapStart:tt,scenePoints:E}=m,et=dn(O,Bt($,tt)),ht=Bt(tt,O),On=b(v({},m),{action:"update"}),In=l.context,Vt=Wn(M,E),te=e.update({point:et,scenePoint:Vt,context:x});if(y=te,mn($,te,ht,r),S=et,_=Vt,C!=="end"){let{frameTask:Dn}=l;a==null&&(a=new AbortController),u=Vn=>{i.addPromise(it(g({frameTask:Dn,event:On,context:In,point:et,scenePoint:Vt,delta:ht,getLastState:()=>({point:S,scenePoint:_,updatePoint:Vn.forceUpdate?null:y})},a.signal)))},u({forceUpdate:!1}),s==null&&(s=V(()=>e.options.effectiveEnabled,()=>u?.({forceUpdate:!0})))}}return C==="end"&&h(),m},o],cancelSnapping:m=>(h(),m)}}function kn(t,e,n){return ft((g,S)=>W(this,[g,S],function*({frameTask:i,point:r,scenePoint:o,context:s,event:a,delta:l,getLastState:u},h){let _=yield i.schedule(()=>t.snap({point:r,scenePoint:o,context:s,signal:h}),h);if(_.valid){let y=yield i.schedule(()=>_.apply(),h),m=u();m.point!=null&&r!==m.point&&(y=t.update({point:m.point,scenePoint:m.scenePoint,context:s})),m.updatePoint!=null&&X(y,m.updatePoint)||(mn(a.mapEnd,y,l,e),n.execute(a))}}))}function Gn(t){return t.type==="3d"?t.resourceController.scheduler.registerTask(xt.SNAPPING):St}function Un(t,e,n){return{context:new ct({editGeometryOperations:t.editGeometryOperations,elevationInfo:t.elevationInfo,pointer:t.pointer,vertexHandle:e.info!=null?e.info.handle:null,excludeFeature:t.excludeFeature,feature:t.feature,visualizer:t.visualizer}),originalPos:e.snapOrigin!=null?t.coordinateHelper.vectorToDehydratedPoint(e.snapOrigin):e.mapStart,originalScenePos:e.scenePoints!=null?e.scenePoints.sceneStart:null,frameTask:n}}function dn(t,[e,n,i]){let r=k(t);return r.x+=e,r.y+=n,r.hasZ&&(r.z+=i),r}function Wn(t,e){return t==null||e==null?null:dn(t,Bt(e.sceneEnd,e.sceneStart))}function Bt(t,e){let n=t.hasZ&&e.hasZ?t.z-e.z:0;return[t.x-e.x,t.y-e.y,n]}function mn(t,e,[n,i,r],o){t.x=e.x+n,t.y=e.y+i,o&&t.hasZ&&e.hasZ&&(t.z=e.z+r)}function Ln(t,e){if(!t.hasZ())return null;let n=e.vertices,i=null;for(let r of n){let o=t.getZ(r.pos);if(i!=null&&o!=null&&Math.abs(o-i)>1e-6)return null;i==null&&(i=o)}return i}function un(t){return t}var Xt="click";var Pt=class{constructor({consumesClicks:e,grabbableForEvent:n}){this.events=new gt,this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0,this.consumesClicks=e,this.grabbableForEvent=n}destroy(){}intersectionDistance(e,n){return 0}attach(){}detach(){}onElevationChange(){}onViewChange(){}};function sr(t,e,n,i,r,o){let s="geodesic",a=je(n),l=H();return Mt(t,e,i,l),l[2]=0,a&&st(l,n,l,a)||(s="euclidean",a=n),{mode:s,view:e,elevationInfo:i,hasZ:r,directionMode:o,spatialReference:t.spatialReference,measurementSR:a,origin:l}}function Nn(t,e,n){if(e==null||t==null)return;let i=ue(n.measurementSR);if(i==null)return;let r=ut(t,n);if(r==null)return;let o=at(e,i);return new Ye(r,o)}function jn(t,e,n,i){if(n==null||t==null)return;let r=ut(t,i);if(r==null)return;let o=F(n),s=10,a=u=>{if(u==null)return;let h=H(),g=Ue(u,"degrees","geographic");return qe(h,r,i.measurementSR,s,g,i.mode)?new Je(r,h):void 0},l=()=>{if(e!=null&&t!=null)return F(Ut(e,t))};switch(i.directionMode){case Z.Absolute:return a(o);case Z.Relative:{let u=l();return u==null?void 0:a(u+o)}case Z.RelativeBilateral:{let u=l();return u==null?void 0:Nt([a(u+o),a(u-o)])}}}function gn(t,e){let n=Xn(t,e);return n!=null?new Ke(n):void 0}function yn(t,e,n){let{context:i,longitude:r,latitude:o,direction:s,distance:a,elevation:l}=n;if(r!=null||o!=null||a!=null||l!=null||s!=null){if(r!=null||o!=null){let u=F(r),h=F(o),g=Yt(l,i);return new Lt(u,h,g)}return qn(t,e,n)}}function qn(t,e,{context:n,direction:i,distance:r,elevation:o}){if(e==null)return gn(o,n);let{view:s,elevationInfo:a,measurementSR:l}=n,u=Mt(e,s,a);if(!l||!st(u,e.spatialReference,fn,l))return;let[h,g]=fn,S=r!=null?at(r,"meters"):void 0,_=F(i),y=Yt(o,n),m=x=>{let M=new Qe([h,g],l,S,y,x);return S==null||x==null||y==null&&n.hasZ?M:new Xe(M.closestTo(u))};if(_==null)return m(void 0);let C=()=>{if(t!=null&&e!=null)return F(Ut(t,e))};switch(n.directionMode){case Z.Absolute:return m(_);case Z.Relative:{let x=C();return x==null?void 0:m(x+_)}case Z.RelativeBilateral:{let x=C();return x==null?void 0:Nt([m(x+_),m(x-_)])}}}function vn(t){return t.context.mode==="geodesic"?yn(null,null,t):xn(t)}function _n(t,e,n){let{context:i,x:r,y:o,distance:s,direction:a,elevation:l}=n;return i.mode==="geodesic"?yn(e,t,n):r!=null||o!=null?xn(n):Bn([Nn(t,s,i),jn(t,e,a,i),gn(l,i)])}function xn({x:t,y:e,elevation:n,context:i}){Tt.x=t?.value??0,Tt.y=e?.value??0,Tt.spatialReference=i.spatialReference;let r=ut(Tt,i,Yn);return new Lt(t!=null&&r!=null?r[0]:void 0,e!=null&&r!=null?r[1]:void 0,Yt(n,i))}function Bn(t){let e;for(let n of t)n&&(e=e?.intersect(n)??n);return e}function ut(t,e,n=H()){let{view:i,elevationInfo:r,measurementSR:o,origin:s,mode:a}=e;if(Mt(t,i,r,n),st(n,t.spatialReference,n,o))return a!=="geodesic"&&_t(n,n,s),n}function Sn(t,e,n,i){let{view:r,measurementSR:o,spatialReference:s,origin:a,mode:l}=n;if(l==="geodesic"?_e(pt,t):xe(pt,t,a),st(pt,o,pt,s))return Be(pt,r,e,n,i)}function Xn(t,e){return bn(t,e)?.value??void 0}function Yt(t,e){let n=bn(t,e);return n!=null?at(n,"meters"):void 0}function bn(t,{view:e,origin:n,elevationInfo:i,hasZ:r,measurementSR:o}){if(t==null||!r)return;let s=he(o);if(s==null)return;let[a,l]=n,u=at(t,s),h=e?.type==="3d"?He(e,a,l,u,o,i):u;return h!=null?Ge(h,s):void 0}var fn=H(),Yn=H(),pt=H(),Tt=ot(0,0,0,j.WGS84);var A=class extends N{constructor(t){super(t),this.constrainResult=e=>e,this._snapPoints=null,this._frameTask=null,this._abortController=null,this._stagedPoint=null,this._snap=ft((e,n,i,r)=>W(this,null,function*(){let o=this._frameTask;if(o==null)return;let s=yield o.schedule(()=>n.snap(b(v({},e),{context:i,signal:r})),r);s.valid&&(yield o.schedule(()=>{this.stagedPoint=s.apply(),e!==this._snapPoints&&this._snapPoints!=null&&(this.stagedPoint=n.update(b(v({},this._snapPoints),{context:i})))},r))}))}get stagedPoint(){return this._stagedPoint}set stagedPoint(t){this._stagedPoint=this.constrainResult(t)}initialize(){let t=this.view.type==="3d"?this.view?.resourceController?.scheduler:null;this._frameTask=t!=null?t.registerTask(xt.SNAPPING):St}destroy(){this._abortController=nt(this._abortController),this._frameTask=mt(this._frameTask)}update(t,e,n){this._snapPoints=t;let{point:i,scenePoint:r}=t,o=e.update({point:i,scenePoint:r,context:n});return this.stagedPoint=o,o}snap(t,e,n){return W(this,null,function*(){let{point:i,scenePoint:r}=t;return this.stagedPoint=e.update({point:i,scenePoint:r,context:n}),this._snapPoints=t,this._abortController==null&&(this._abortController=new AbortController),this._snap(t,e,n,this._abortController.signal)})}snapAgainNearPreviousMapPoint(t,e){return W(this,null,function*(){this._snapPoints!=null&&(yield this.snap(this._snapPoints,t,e))})}abort(){this._abortController=nt(this._abortController),this._snapPoints=null}};c([p({constructOnly:!0})],A.prototype,"view",void 0),c([p()],A.prototype,"stagedPoint",null),c([p()],A.prototype,"constrainResult",void 0),c([p()],A.prototype,"_stagedPoint",void 0),A=c([D("esri.views.interactive.snapping.SnappingOperation")],A);var Kn="crosshair",Jn="progress",Mn=Symbol(),wn=Symbol(),d=class extends gt.EventedMixin(N){constructor(t){super(t),this._createOperationCompleted=!1,this._hideDefaultCursor=!1,this._pointerDownStates=new We,this._stagedScreenPoint=null,this._stagedPointerType=null,this._updatingHandles=new Re,this._stagedPointerId=null,this.constraintsEnabled=!1,this.constraints=void 0,this._getPointConstraint=jt(vn),this._getPolylineOrPolygonConstraint=jt(_n),this.constraintZ=null,this.defaultZ=null,this.isDraped=!0,this.labelOptions=new Wt,this.cursor=null,this.loading=!1,this.snapToSceneEnabled=null,this.firstVertex=null,this.lastVertex=null,this.secondToLastVertex=null,t.elevationInfo==null&&(this.elevationInfo=Fe(!!t.hasZ))}initialize(){let{geometryType:t,view:e}=this,n=e.spatialReference,i="viewingMode"in e.state?e.state.viewingMode:Ae.Local,r=t==="segment"||t==="multipoint"?"polyline":t;this.coordinateHelper=en(this.hasZ,this.hasM,n),this._editGeometryOperations=new lt(new on(r,this.coordinateHelper),i),this._snappingOperation=new A({view:e}),this.addHandles([V(()=>({stagedPoint:this._snappingOperation.stagedPoint,constraint:this._constraint}),({stagedPoint:a,constraint:l},u)=>{let{snappingOptions:h}=this;if(h&&(h.forceDisabled=l!=null&&$e(l)),u!=null&&a===u.stagedPoint&&l!==u.constraint)return this._onKeyboardBasedChange();this._processCursor(a??this._screenToMap(this._stagedScreenPoint))},{equals:(a,l)=>a.stagedPoint===l.stagedPoint&&ne(a.constraint,l.constraint)}),V(()=>this.view.viewpoint,(a,l)=>{a&&l&&Oe(a,l)&&this._onKeyboardBasedChange()})]),this._activeComponent=new rn(n,i),this._editGeometryOperations.data.components.push(this._activeComponent);let o=this.segmentLabels;o!=null&&(o.context={view:e,editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,labelOptions:this.labelOptions},this.addHandles(V(()=>this.labelOptions.enabled,a=>{o.visible=a},yt))),this.addHandles(this._editGeometryOperations.on(["vertex-add","vertex-update","vertex-remove"],a=>{let l=a.vertices.map(_=>({componentIndex:0,vertexIndex:_.index,coordinates:this.coordinateHelper.vectorToArray(_.pos)})),u=l.map(_=>_.coordinates),h=this.coordinateHelper.vectorToDehydratedPoint(this._activeComponent.getFirstVertex()?.pos)??null;X(h,this.firstVertex)||(this.firstVertex=h);let g=this.coordinateHelper.vectorToDehydratedPoint(this._activeComponent.getLastVertex()?.pos)??null;X(g,this.lastVertex)||(this.lastVertex=g);let S=this.coordinateHelper.vectorToDehydratedPoint(this._activeComponent.edges.at(-1)?.leftVertex?.pos)??null;switch(X(S,this.secondToLastVertex)||(this.secondToLastVertex=S),this._processCursor(this.cursorVertex),a.type){case"vertex-add":this.emit(a.type,b(v({},a),{added:u,vertices:l}));break;case"vertex-update":this.emit(a.type,b(v({},a),{updated:u,vertices:l}));break;case"vertex-remove":this.emit(a.type,b(v({},a),{removed:u,vertices:l}))}}));let s=this._manipulator=new Pt({consumesClicks:!1,grabbableForEvent:a=>this.drawingMode!=="click"||a.pointerType==="touch"&&this._snappingEnabled&&this._pointerDownStates.size===1});this.manipulators.add(s),s.grabbable=t!=="point",this.addHandles([s.events.on("immediate-click",a=>this._onImmediateClick(a)),s.events.on("immediate-double-click",a=>this._onImmediateDoubleClick(a)),V(()=>this.drawingMode,()=>{this.removeHandles(Mn),this.addHandles(this._createManipulatorDragPipeline(s),Mn)},yt),V(()=>({effectiveCursor:this.effectiveCursor}),({effectiveCursor:a})=>{s.cursor=a},yt)]),tn(this,()=>{let a=this.view.inputManager.latestPointerType??"mouse",l=this._getSnappingContext(a);if(this.snappingManager!=null){let u=this._snappingOperation.snapAgainNearPreviousMapPoint(this.snappingManager,l);this._updatingHandles.addPromise(it(u))}})}destroy(){dt(this.segmentLabels),dt(this._snappingOperation),this._editGeometryOperations=dt(this._editGeometryOperations),this._updatingHandles.destroy()}get _isDragging(){let{_stagedPointerId:t,_manipulator:e}=this;return t!=null&&this._pointerDownStates.has(t)||e.grabbing||!e.interactive}get _snappingEnabled(){return this.snappingManager!=null&&this.snappingManager.options.effectiveEnabled}get _requiresScenePoint(){let t=this._updateAndGetEffectiveDrawSurface();return this.view.type==="3d"&&this.drawSurface!==t}get canRedo(){return this._editGeometryOperations.canRedo}get canUndo(){return this._editGeometryOperations.canUndo}get committedVertices(){return this._activeComponent.vertices.map(t=>this.coordinateHelper.vectorToArray(t.pos))}get _constraint(){let{constraints:t,constraintsEnabled:e}=this;if(t&&e)switch(this.geometryType){case"point":return this._getPointConstraint(t);case"polygon":case"polyline":return this._getPolylineOrPolygonConstraint(this.lastVertex,this.secondToLastVertex,t)}}set drawingMode(t){this._set("drawingMode",t??Xt)}get effectiveCursor(){return this.loading?Jn:this._hideDefaultCursor?null:this.cursor||Kn}get interactive(){return this._manipulator.interactive}set interactive(t){this._manipulator.interactive=t}get isCompleted(){return this._createOperationCompleted}get numCommittedVertices(){return this._activeComponent.vertices.length}get snappingOptions(){return this.snappingManager!=null?this.snappingManager.options:null}get cursorVertex(){return this._get("cursorVertex")}get visualizationCursorVertex(){return this._stagedPointerType==="mouse"?this.cursorVertex:null}get committableVertex(){let{cursorVertex:t,lastVertex:e,firstVertex:n,geometryType:i}=this;return i==="polygon"&&bt(t,n)||bt(t,e)?null:t}get updating(){return this._updatingHandles.updating}get geometryIncludingUncommittedVertices(){let{committedVertices:t,committableVertex:e,coordinateHelper:n}=this,i=t.slice();return e!=null&&i.push(n.pointToArray(e)),i}cancel(){this.complete({aborted:!0})}commitStagedVertex(){this._snappingOperation.abort();let{committableVertex:t}=this;t!=null&&this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(t))}complete(t){let e=t?.aborted||!1;this._snappingOperation.abort(),this.snappingManager?.doneSnapping();let{geometryType:n,numCommittedVertices:i}=this,r=n==="multipoint"&&i===0||n==="polyline"&&i<2||n==="polygon"&&i<3;n!=="segment"&&n!=="point"||this.commitStagedVertex(),this._createOperationCompleted=!r,(this.isCompleted||e)&&(this._stagedScreenPoint=null,this._stagedPointerId=null,this._stagedPointerType=null,this._processCursor(null),this.emit("complete",{vertices:this.committedVertices.map((o,s)=>({componentIndex:0,vertexIndex:s,coordinates:o})),aborted:e,type:"complete"}))}onInputEvent(t){switch(t.type){case"pointer-down":this._pointerDownStates.add(t.pointerId);break;case"pointer-up":this._pointerDownStates.delete(t.pointerId)}switch(t.type){case"pointer-move":return this._onPointerMove(t);case"hold":return this._onHold(t)}}redo(){this._editGeometryOperations.redo()}undo(){this.snappingManager!=null&&this.snappingManager.doneSnapping(),this._editGeometryOperations.undo()}_processCursor(t){let e=L(this.cursorVertex),n=L(t),i=n&&(this._updateAndGetEffectiveDrawSurface()?.constrainZ(n)??n),r=this._snapToClosingVertex(i),o=this._applyConstraints(r);bt(e,o)||(this._set("cursorVertex",o),this.segmentLabels?.set("stagedVertex",o!=null?this.coordinateHelper.pointToVector(o):null),o==null||this._stagedPointerType!=="mouse"?this.emit("cursor-remove"):this.emit("cursor-update",{updated:null,vertices:[{componentIndex:0,vertexIndex:this._activeComponent.vertices.length,coordinates:this.coordinateHelper.pointToArray(o)}],operation:"apply",type:"vertex-update"}))}_snapToClosingVertex(t){if(t==null||this._isDragging||this.geometryType!=="polygon"||this.numCommittedVertices<=2)return t;let e=this._mapToScreen(t);if(!e)return t;let n=this._activeComponent;return this._vertexWithinPointerDistance(n.vertices[0].pos,e)?this.firstVertex:this._vertexWithinPointerDistance(n.vertices.at(-1).pos,e)?this.lastVertex:t}_createManipulatorDragPipeline(t){switch(this.drawingMode){case"click":return this._createManipulatorDragPipelineClick(t);case"freehand":return this._createManipulatorDragPipelineFreehand(t);case"hybrid":return this._createManipulatorDragPipelineHybrid(t)}}_createManipulatorDragPipelineClick(t){return Ct(t,(e,n,i,r)=>{let o=r==="touch"&&this._snappingEnabled;if(this.isCompleted||!o)return;let{snappingStep:s,cancelSnapping:a}=hn({predicate:()=>o,snappingManager:this.snappingManager,snappingContext:new ct({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,feature:this.graphic,pointer:r,visualizer:this.snappingVisualizer,drawConstraints:this.constraints}),updatingHandles:this._updatingHandles,useZ:!this._requiresScenePoint});i=i.next(l=>(o&&this.snappingManager!=null&&this.snappingManager.doneSnapping(),l)).next(a),n.next(this._screenToMapDragEventStep()).next(l=>(l.action==="start"&&(this._processCursor(l.mapStart),(this.geometryType==="segment"||o&&!this.numCommittedVertices)&&this.commitStagedVertex()),l)).next(pn(this.view,this.elevationInfo)).next(...s).next(l=>(o&&(this._processCursor(l.mapEnd),l.action==="end"&&this.commitStagedVertex()),l)).next(l=>(l.action==="end"&&(this._stagedPointerType!=="mouse"&&this._snappingOperation.abort(),this.geometryType!=="segment"&&this.geometryType!=="point"||this.complete()),l))})}_createManipulatorDragPipelineFreehand(t){return Ct(t,(e,n)=>{this.isCompleted||n.next(this._screenToMapDragEventStep()).next(i=>(i.action==="start"&&(this._snappingOperation.abort(),this.committableVertex==null&&this._processCursor(i.mapStart),this.geometryType==="segment"&&this.commitStagedVertex()),i)).next(i=>{switch(i.action){case"start":case"update":this._processCursor(i.mapEnd),this.geometryType!=="polygon"&&this.geometryType!=="polyline"||this.commitStagedVertex();break;case"end":this.complete()}return i})})}_createManipulatorDragPipelineHybrid(t){return Ct(t,(e,n)=>{this.isCompleted||n.next(this._screenToMapDragEventStep()).next(i=>(i.action==="start"&&(this._snappingOperation.abort(),this.addHandles(this._editGeometryOperations.createUndoGroup(),wn),this._processCursor(i.mapStart),this.commitStagedVertex()),i)).next(i=>{switch(i.action){case"start":case"update":this._processCursor(i.mapEnd),this.geometryType!=="polygon"&&this.geometryType!=="polyline"||this.commitStagedVertex();break;case"end":this._stagedPointerType!=="mouse"&&this._snappingOperation.abort(),this.removeHandles(wn),this.geometryType!=="segment"&&this.geometryType!=="point"||this.complete()}return i})})}get _drawAtFixedElevation(){let{constraintsEnabled:t,constraintZ:e,geometryType:n,numCommittedVertices:i}=this;return t?e!=null||n==="segment"&&i>0:(n==="segment"||n==="polygon")&&i>0}_updateAndGetEffectiveDrawSurface(){let{constraintsEnabled:t,coordinateHelper:e,drawSurface:n,elevationDrawSurface:i,snapToSceneEnabled:r}=this;if(i==null)return n;if(!this.hasZ)return i.defaultZ=null,i;let o=this.elevationInfo?.mode,s=this.defaultZ,a=t||o==="absolute-height";return r!=null&&(a=r),o==="on-the-ground"&&(a=!1),this._drawAtFixedElevation&&(s=(t?this.constraintZ:null)??e.getZ(this._activeComponent.vertices[0].pos),a=!1),a?n:(i.defaultZ=s,i)}_mapToScreen(t){return this._updateAndGetEffectiveDrawSurface()?.mapToScreen(t)}_onHold(t){this._snappingOperation.abort(),this.drawingMode==="click"&&t.pointerType==="touch"&&this._snappingEnabled&&this._processCursor(t.mapPoint),t.stopPropagation()}_onImmediateClick(t){if(!(t.pointerType==="mouse"&&t.button===2||this._manipulator.dragging))try{let{drawingMode:e,geometryType:n}=this;this._stagedPointerType=t.pointerType,this._stagedScreenPoint=t.screenPoint;let i=this._screenToMap(t.screenPoint);if(i==null||i==null||e==="freehand"&&n!=="point")return;if(this._snappingEnabled&&this.cursorVertex!=null||this._processCursor(i),this.committableVertex==null)return void this.complete();this.commitStagedVertex(),t.pointerType!=="mouse"&&this._processCursor(null),(e==="freehand"||n==="point"||n==="segment"&&this.numCommittedVertices===2||n==="segment"&&e==="hybrid"&&this.numCommittedVertices===1)&&this.complete()}finally{t.stopPropagation()}}_onImmediateDoubleClick(t){this._manipulator.dragging||this.geometryType==="point"||(this.complete(),t.stopPropagation())}_onPointerMove(t){let e=B(t.x,t.y);this._stagedScreenPoint=e,this._stagedPointerType=t.pointerType,this._stagedPointerId=t.pointerId,this._isDragging?this._snappingOperation.abort():(t.stopPropagation(),this._processCursorMovementRelativeToSurface(e,t.pointerType))}_onKeyboardBasedChange(){this._stagedPointerType==="mouse"&&this._stagedScreenPoint&&this._stagedPointerId!=null&&!this._isDragging?this._processCursorMovementRelativeToSurface(this._stagedScreenPoint,this._stagedPointerType):this._snappingOperation.abort()}_processCursorMovementRelativeToSurface(t,e){let n=this._snappingOperation,i=this._screenToMap(t),r=this._requiresScenePoint?this.drawSurface?.screenToMap(t):null;if(i==null)return this._hideDefaultCursor=!0,this._processCursor(null),void n.abort();this._hideDefaultCursor=!1;let o=this.snappingManager;if(o==null)return this._processCursor(i),void n.abort();let s=this._getSnappingContext(e);this._updatingHandles.addPromise(it(n.snap({point:i,scenePoint:r},o,s)))}_applyConstraints(t){let{_constraint:e,constraints:n}=this;if(!t||!n||!e)return t;let{context:i}=n,r=ut(t,i),o=r?e.closestTo(r):void 0;if(!o)return t;let s=Sn(o,t,i),a=this.view.type==="2d"||i.elevationInfo.mode!=="absolute-height";return s!=null&&a&&this.constraintZ!=null&&this.hasZ&&(s.z=this.constraintZ),s}_screenToMap(t){return t?this._updateAndGetEffectiveDrawSurface()?.screenToMap(t):null}_screenToMapDragEventStep(){let t=null;return e=>{if(e.action==="start"&&(t=this._screenToMap(e.screenStart)),t==null)return null;let n=this._screenToMap(e.screenEnd);return n!=null?b(v({},e),{mapStart:t,mapEnd:n}):null}}_vertexWithinPointerDistance(t,e){let i=this._mapToScreen(this.coordinateHelper.vectorToDehydratedPoint(t));return i!=null&&Qn(i,e,25)}_getSnappingContext(t){let e=this._drawAtFixedElevation?this.elevationDrawSurface?.defaultZ:null;return new ct({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:t,feature:this.graphic,visualizer:this.snappingVisualizer,selfSnappingZ:e!=null?{value:e,elevationInfo:this.elevationInfo}:null,drawConstraints:this.constraints})}};function Qn(t,e,n){let i=t.x-e.x,r=t.y-e.y;return i*i+r*r<=n}c([p()],d.prototype,"_hideDefaultCursor",void 0),c([p()],d.prototype,"_stagedPointerId",void 0),c([p()],d.prototype,"_isDragging",null),c([p()],d.prototype,"_snappingOperation",void 0),c([p()],d.prototype,"_snappingEnabled",null),c([p({constructOnly:!0})],d.prototype,"graphic",void 0),c([p()],d.prototype,"constraintsEnabled",void 0),c([p()],d.prototype,"constraints",void 0),c([p()],d.prototype,"_constraint",null),c([p()],d.prototype,"constraintZ",void 0),c([p()],d.prototype,"defaultZ",void 0),c([p()],d.prototype,"isDraped",void 0),c([p({value:Xt})],d.prototype,"drawingMode",null),c([p({constructOnly:!0})],d.prototype,"elevationDrawSurface",void 0),c([p({constructOnly:!0})],d.prototype,"elevationInfo",void 0),c([p({constructOnly:!0,type:Wt})],d.prototype,"labelOptions",void 0),c([p({constructOnly:!0})],d.prototype,"geometryType",void 0),c([p({constructOnly:!0})],d.prototype,"hasM",void 0),c([p({constructOnly:!0})],d.prototype,"hasZ",void 0),c([p()],d.prototype,"cursor",void 0),c([p()],d.prototype,"effectiveCursor",null),c([p()],d.prototype,"loading",void 0),c([p({constructOnly:!0})],d.prototype,"manipulators",void 0),c([p({constructOnly:!0})],d.prototype,"drawSurface",void 0),c([p({constructOnly:!0})],d.prototype,"segmentLabels",void 0),c([p({constructOnly:!0})],d.prototype,"snappingManager",void 0),c([p({constructOnly:!0})],d.prototype,"snappingVisualizer",void 0),c([p()],d.prototype,"snapToSceneEnabled",void 0),c([p({readOnly:!0})],d.prototype,"cursorVertex",null),c([p({readOnly:!0})],d.prototype,"visualizationCursorVertex",null),c([p()],d.prototype,"committableVertex",null),c([p()],d.prototype,"firstVertex",void 0),c([p()],d.prototype,"lastVertex",void 0),c([p()],d.prototype,"secondToLastVertex",void 0),c([p()],d.prototype,"updating",null),c([p({constructOnly:!0})],d.prototype,"view",void 0),d=c([D("esri.views.draw.DrawOperation")],d);var Cn=class{constructor(e,n,i,r=null){this._elevationInfo=e,this.defaultZ=n,this._view=i,this._excludeGraphics=r}screenToMap(e){let{defaultZ:n,_view:i}=this,r=i.sceneIntersectionHelper.intersectElevationFromScreen(Te(e.x,e.y),this._elevationInfo,n??0,this._excludeGraphics);return n==null&&r!=null&&(r.z=void 0),r}mapToScreen(e){let n=ot(e.x,e.y,kt(this._view,e,this._elevationInfo),e.spatialReference);return this._view.toScreen(n)}constrainZ(e){let{defaultZ:n}=this;return n!=null&&e.z!==n&&((e=k(e)).z=n),e}},Pn=class{constructor(e,n,i=[]){this.view=e,this.elevationInfo=n,this.exclude=i}screenToMap(e){let n=this.view.toMap(e,{exclude:this.exclude,excludeHud:!0});return n!=null&&(n.z=Y(n,this.view,this.elevationInfo)),n}mapToScreen(e){let n=e;return this.elevationInfo!=null&&(n=ot(e.x,e.y,kt(this.view,e,this.elevationInfo),e.spatialReference)),this.view.toScreen(n)}constrainZ(e){return e}},Tn=class{constructor(e,n=!1,i=0){this.view=e,this.hasZ=n,this.defaultZ=i,this.mapToScreen=r=>e.toScreen(r),this.screenToMap=n?r=>{let o=e.toMap(r);return o.z=i,o}:r=>e.toMap(r)}constrainZ(e){let{defaultZ:n}=this;return this.hasZ&&e.z!==n&&((e=k(e)).z=n),e}},Kt=class t{screenToMap(e){let{x:n,y:i}=e;return new P({x:n,y:i,spatialReference:t.spatialReference})}mapToScreen(e){return B(e.x,e.y)}constrainZ(e){return e}};Kt.spatialReference=new j;function Et(t,e,n=null){return n!=null?[t,e,n]:[t,e]}function f(t,e,n=null){return n!=null?{x:t,y:e,z:n}:{x:t,y:e}}var Rt=class{constructor(e){this.spatialReference=e}mapToLocalMultiple(e){return e.map(n=>this.mapToLocal(n)).filter(I)}get doUnnormalization(){return!1}},Jt=class extends Rt{constructor(e,n,i=null){super(n),this._defaultZ=i,this.transform=Gt(),this.transformInv=Gt(),this.transform=Le(e),Ie(this.transformInv,this.transform)}makeMapPoint(e,n){return Et(e,n,this._defaultZ)}mapToLocal(e){return f(this.transform[0]*e[0]+this.transform[2]*e[1]+this.transform[4],this.transform[1]*e[0]+this.transform[3]*e[1]+this.transform[5])}localToMap(e){return Et(this.transformInv[0]*e.x+this.transformInv[2]*e.y+this.transformInv[4],this.transformInv[1]*e.x+this.transformInv[3]*e.y+this.transformInv[5],this._defaultZ)}},Qt=class extends Rt{constructor(e,n){super(e.spatialReference),this.view=e,this.defaultZ=null,this.pWS=T(),this.tangentFrameUpWS=T(),this.tangentFrameRightWS=T(),this.tangentFrameForwardWS=T(),this.localFrameRightWS=T(),this.localFrameUpWS=T(),this.worldToLocalTransform=Ht(),this.localToWorldTransform=Ht(),this.scale=1,this.scale=e.resolution,this.referenceMapPoint=n,this.defaultZ=n.hasZ?n.z:null;let i=e.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,vt.X,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,vt.Y,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,vt.Z,this.tangentFrameForwardWS);let r=T();Se(r,this.tangentFrameForwardWS,Me(i,this.tangentFrameForwardWS)),_t(this.localFrameRightWS,i,r),be(this.localFrameRightWS,this.localFrameRightWS),we(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),Ve(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),De(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return this.view.viewingMode==="global"}makeMapPoint(e,n){return Et(e,n,this.defaultZ)}mapToLocal(e){let n=T();this.view.renderCoordsHelper.toRenderCoords(new P({x:e[0],y:e[1],spatialReference:this.spatialReference}),n),Zt(n,n,this.worldToLocalTransform);let i=this.view.renderCoordsHelper.fromRenderCoords(n,new P({spatialReference:this.view.spatialReference}));return i!=null?f(i.x/this.scale,i.y/this.scale):null}localToMap(e){let n=T();this.view.renderCoordsHelper.toRenderCoords(new P({x:e.x*this.scale,y:e.y*this.scale,spatialReference:this.spatialReference}),n),Zt(n,n,this.localToWorldTransform);let i=this.view.renderCoordsHelper.fromRenderCoords(n,new P({spatialReference:this.view.spatialReference}));return i!=null?Et(i.x,i.y,this.defaultZ):null}};function So(t,e){if(t.type==="2d")return new Jt(t.state.transform,t.spatialReference,e.length>2?e[2]:null);if(t.type==="3d"){let n=e.length>2?new P({x:e[0],y:e[1],z:e[2],spatialReference:t.spatialReference}):new P({x:e[0],y:e[1],spatialReference:t.spatialReference});return new Qt(t,n)}return null}var $t,z=$t=class extends q{constructor(...t){super(...t),this.center=null,this.geodesic=!1,this.numberOfPoints=60,this.radius=1e3,this.radiusUnit="meters"}normalizeCtorArgs(t,e){let n;if(t?.center)n=t;else{if(t?.rings)return super.normalizeCtorArgs(t,e);n={center:t}}return v(v(v({},super.normalizeCtorArgs()),n),e)}initialize(){let t=this.center,e=this.numberOfPoints;if(this.hasZ=t?.hasZ??!1,this.rings.length!==0||!t)return;let n=ae(this.radius,this.radiusUnit,"meters"),i=t.spatialReference,r,o="geographic";if(i.isWebMercator?o="webMercator":((i.wkid&&oe[i.wkid])!=null||(i.wkt2||i.wkt)&&de(i.wkt2||i.wkt))&&(o="projected"),this.geodesic){let s;switch(o){case"webMercator":s=fe(t);break;case"projected":console.error("Creating a geodesic circle requires the center to be specified in web mercator or geographic coordinate system");break;case"geographic":s=t}r=this._createGeodesicCircle(s,n,e),o==="webMercator"&&(r=me(r))}else{let s;o==="webMercator"||o==="projected"?s=n/pe(t.spatialReference):o==="geographic"&&(s=le(n,"meters",se(t.spatialReference).radius)),r=this._createPlanarCircle(t,s,e)}this.spatialReference=r.spatialReference,this.addRing(r.rings[0])}clone(){let{center:t,numberOfPoints:e,radius:n,radiusUnit:i,geodesic:r}=this;return new $t({center:t?.clone(),numberOfPoints:e,radius:n,radiusUnit:i,geodesic:r})}_createGeodesicCircle(t,e,n){let i=0,r=[];for(;i<360;){let o=[0,0],s=[t.x,t.y];Ne(o,s,i,e,j.WGS84),this.hasZ&&o.push(t.z),r.push(o),i+=360/n}return r.push(r[0]),new q(r)}_createPlanarCircle(t,e,n){let i=[],r=2*Math.PI/n;for(let o=0;o<n;++o){let s=r*o,a=[t.x+Math.cos(-s)*e,t.y+Math.sin(-s)*e];this.hasZ&&a.push(t.z),i.push(a)}return i.push(i[0]),new q({spatialReference:t.spatialReference,rings:[i]})}};c([p({type:P})],z.prototype,"center",void 0),c([p()],z.prototype,"geodesic",void 0),c([p()],z.prototype,"numberOfPoints",void 0),c([p()],z.prototype,"radius",void 0),c([p()],z.prototype,"radiusUnit",void 0),z=$t=c([D("esri.geometry.Circle")],z);var En=z;function U(t,e){let n=new P({x:t[0],y:t[1],spatialReference:e});return t.length>2&&(n.z=t[2]),n}function es(t,e){return new ge({points:t,spatialReference:e})}function ns(t,e,n){let i=new Pe({paths:t,spatialReference:e});return n&&zt(i),i}function Dt(t,e,n,i=!0){let r=L(t);r.forEach(s=>{let a=s[0],l=s[s.length-1];ee(a,l)&&s.length!==1||s.push(s[0])});let o=new q({rings:r,spatialReference:e});return o.rings.forEach(s=>{ye(s)||s.reverse()}),n&&zt(o),i&&o.isSelfIntersecting&&At(e)&&(o=Ze(o)),o}function is(t,e,n){let i=e.mapToLocalMultiple(t),r=[],o={x:i[0].x,y:i[0].y},s={x:i[1].x,y:i[1].y},a=Math.round(s.x-o.x),l=Math.round(s.y-o.y),u=Math.max(Math.abs(a),Math.abs(l));if(n){let h={x:o.x+u,y:o.y+u},g={x:o.x-u,y:o.y-u};r.push(f(h.x,g.y),f(g.x,g.y),f(g.x,h.y),f(h.x,h.y))}else{let h={x:a>0?o.x+u:o.x-u,y:l>0?o.y+u:o.y-u};r.push(f(o.x,o.y),f(h.x,o.y),f(h.x,h.y),f(o.x,h.y))}return Rn(Dt([r.map(h=>e.localToMap(h)).filter(I)],e.spatialReference,e.doUnnormalization,!0),r,e)}function rs(t,e,n){let i=e.mapToLocalMultiple(t);if(i.length===1){let l=i[0];i=[f(l.x-48,l.y+48),f(l.x+48,l.y-48),f(l.x+48,l.y-48),f(l.x-48,l.y+48)]}let r=[],o={x:i[0].x,y:i[0].y},s={x:i[1].x,y:i[1].y};if(n){let a=Math.round(s.x-o.x),l=Math.round(s.y-o.y);r.push(f(o.x-a,o.y-l),f(s.x,o.y-l),f(s.x,s.y),f(o.x-a,s.y))}else r.push(f(o.x,o.y),f(s.x,o.y),f(s.x,s.y),f(o.x,s.y));return Rn(Dt([r.map(a=>e.localToMap(a)).filter(I)],e.spatialReference,e.doUnnormalization,!0),r,e)}function Rn(t,e,n){let i=Ot(e[3],e[2],n),r=Ot(e[1],e[2],n),o=Ot(e[0],e[1],n),s=Ot(e[0],e[3],n);return{geometry:t,midpoints:i!=null&&r!=null&&o!=null&&s!=null?{top:i,right:r,bottom:o,left:s}:null}}function Ot(t,e,n){J[0]=t.x,J[1]=t.y,J[2]=0,Q[0]=e.x,Q[1]=e.y,Q[2]=0,Ce(J,J,Q,.5),It.x=J[0],It.y=Q[1],It.z=Q[2];let i=n.localToMap(It);return i!=null?U(i,n.spatialReference):null}var It=f(0,0,0),J=T(),Q=T();function os(t,e,n,i){let r=e.mapToLocalMultiple(t),o=null,s=null;if(n)o=r[0],s=r[1];else{let y=r[0],m=r[1],C=Math.round(m.x-y.x),x=Math.round(m.y-y.y),M=Math.max(Math.abs(C),Math.abs(x));o=f(C>0?y.x+M/2:y.x-M/2,x>0?y.y+M/2:y.y-M/2),s=f(Math.abs(C)>Math.abs(x)?o.x-M/2:o.x,Math.abs(C)>Math.abs(x)?o.y:o.y-M/2)}let a=e.localToMap(o),l=e.localToMap(s);if(a==null||l==null)return null;e.doUnnormalization&&ve([[a,l]],e.spatialReference);let u=U(a,e.spatialReference),h=U(l,e.spatialReference),g=ce(e.spatialReference),S=0;if(At(e.spatialReference))S=g*ze(u,h,null);else{let y=o.x-s.x,m=o.y-s.y;S=g*Math.sqrt(y*y+m*m)*(i||1)}let _=new En({center:u,radius:S,radiusUnit:"meters",spatialReference:e.spatialReference});return{geometry:Dt(_.rings,_.spatialReference,!1),center:u,edge:h}}function ss(t,e,n){let i=e.mapToLocalMultiple(t),r=i[0],o=i[1],s=Math.round(o.x-r.x),a=Math.round(o.y-r.y),l=f(n?r.x:r.x+s/2,n?r.y:r.y+a/2),u=n?s:s/2,h=n?a:a/2,g=60,S=[],_=2*Math.PI/g;function y(E){let et=Math.cos(E),ht=Math.sin(E);return f(u*et+l.x,h*ht+l.y)}for(let E=0;E<g;E++)S.push(y(E*_));S.push(S[0]);let{spatialReference:m,doUnnormalization:C}=e,x=Dt([S.map(E=>e.localToMap(E)).filter(I)],m,C,!1),M=e.localToMap(y(Math.PI/2)),O=e.localToMap(y(0)),$=e.localToMap(y(-Math.PI/2)),tt=e.localToMap(y(Math.PI));return{geometry:x,midpoints:M!=null&&O!=null&&$!=null&&tt!=null?{top:U(M,m),right:U(O,m),bottom:U($,m),left:U(tt,m)}:null}}export{R as a,sn as b,an as c,Jt as d,So as e,es as f,ns as g,Dt as h,is as i,rs as j,os as k,ss as l,sr as m,w as n,Ct as o,wi as p,zn as q,Ci as r,Pi as s,Fn as t,Ti as u,Ei as v,Ri as w,Oi as x,K as y,pn as z,Ii as A,hn as B,d as C,Cn as D,Pn as E,Tn as F,Kt as G};
