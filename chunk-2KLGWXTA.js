import{c as G,e as H,f as ee,g as te,h as E,s as I,t as ne,w as re}from"./chunk-K3Q25RT2.js";import{a as y}from"./chunk-TNPL7MIN.js";import{a as T}from"./chunk-FYZRIMPP.js";import{b as oe}from"./chunk-NSEXRUGB.js";import{i as j,r as ie,t as se}from"./chunk-IISBSAYJ.js";import{a as f,d as K,e as g,f as X,g as $}from"./chunk-SJW4NR3T.js";import{n as Y}from"./chunk-M76YZBV5.js";import{d as b,f as V,g as W,m as Q,n as B,q as L,u as D}from"./chunk-2KZICFRS.js";import{A as h,B as v,da as k,l as R,o as J,t as S}from"./chunk-4JWMB5SM.js";import{a as Z}from"./chunk-J7M5V2SQ.js";import{C as U}from"./chunk-GISCFF3Z.js";import{t as M}from"./chunk-HQMV3KQV.js";import{q as A}from"./chunk-CRMMDK2Z.js";import{h as m}from"./chunk-EAH6BNBL.js";var N=[0,0];function le(e,t){if(!t)return null;if("x"in t){let n={x:0,y:0};return[n.x,n.y]=e(t.x,t.y,N),t.z!=null&&(n.z=t.z),t.m!=null&&(n.m=t.m),n}if("xmin"in t){let n={xmin:0,ymin:0,xmax:0,ymax:0};return[n.xmin,n.ymin]=e(t.xmin,t.ymin,N),[n.xmax,n.ymax]=e(t.xmax,t.ymax,N),t.hasZ&&(n.zmin=t.zmin,n.zmax=t.zmax,n.hasZ=!0),t.hasM&&(n.mmin=t.mmin,n.mmax=t.mmax,n.hasM=!0),n}return"rings"in t?{rings:ae(t.rings,e),hasM:t.hasM,hasZ:t.hasZ}:"paths"in t?{paths:ae(t.paths,e),hasM:t.hasM,hasZ:t.hasZ}:"points"in t?{points:ue(t.points,e),hasM:t.hasM,hasZ:t.hasZ}:null}function ae(e,t){let n=[];for(let r of e)n.push(ue(r,t));return n}function ue(e,t){let n=[];for(let r of e){let i=t(r[0],r[1],[0,0]);n.push(i),r.length>2&&i.push(r[2]),r.length>3&&i.push(r[3])}return n}function x(e,t){return m(this,null,function*(){if(!e||!t)return;let n=Array.isArray(e)?e.map(r=>r.geometry!=null?r.geometry.spatialReference:null).filter(A):[e];yield se(n.map(r=>({source:r,dest:t})))})}var ce=le.bind(null,V),me=le.bind(null,W);function z(e,t,n,r){if(!e||(n||(n=t,t=e.spatialReference),!h(t)||!h(n)||R(t,n)))return e;if(b(t,n)){let i=S(n)?ce(e):me(e);return i.spatialReference=n,i}return j(T,[e],t,n,null,r)[0]}var _=class{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}push(t,n,r,i){return m(this,null,function*(){if(!t?.length||!n||!r||R(n,r))return t;let s={geometries:t,inSpatialReference:n,outSpatialReference:r,geographicTransformation:i,resolve:U()};return this._jobs.push(s),this._timer??=setTimeout(this._process,10),s.resolve.promise})}_process(){this._timer=null;let t=this._jobs.shift();if(!t)return;let{geometries:n,inSpatialReference:r,outSpatialReference:i,resolve:s,geographicTransformation:o}=t;b(r,i)?S(i)?s(n.map(ce)):s(n.map(me)):s(j(T,n,r,i,o,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}},Me=new _;function Qe(e,t,n,r){return Me.push(e,t,n,r)}var pe=new y,Ge=new y,F=new y,C={esriGeometryPoint:G,esriGeometryPolyline:ee,esriGeometryPolygon:te,esriGeometryMultipoint:H};function Ke(e,t,n,r=e.hasZ,i=e.hasM){if(t==null)return null;let s=e.hasZ&&r,o=e.hasM&&i;if(n){let a=I(F,t,e.hasZ,e.hasM,"esriGeometryPoint",n,r,i);return G(a,s,o)}return G(t,s,o)}function d(e,t,n,r,i,s,o=t,a=n){let u=t&&o,l=n&&a,c=r!=null?"coords"in r?r:r.geometry:null;if(c==null)return null;if(i){let p=ne(Ge,c,t,n,e,i,o,a);return s&&(p=I(F,p,u,l,e,s)),C[e]?.(p,u,l)??null}if(s){let p=I(F,c,t,n,e,s,o,a);return C[e]?.(p,u,l)??null}return re(pe,c,t,n,o,a),C[e]?.(pe,u,l)??null}function Xe(e){return e&&fe in e?JSON.parse(JSON.stringify(e,Ie)):e}var fe="_geVersion",Ie=(e,t)=>e!==fe?t:void 0;var we=new Z({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),ye=Object.freeze({});function at(e,t,n){return m(this,null,function*(){let{outFields:r,orderByFields:i,groupByFieldsForStatistics:s,outStatistics:o}=e;if(r)for(let a=0;a<r.length;a++)r[a]=r[a].trim();if(i)for(let a=0;a<i.length;a++)i[a]=i[a].trim();if(s)for(let a=0;a<s.length;a++)s[a]=s[a].trim();if(o)for(let a=0;a<o.length;a++)o[a].onStatisticField&&(o[a].onStatisticField=o[a].onStatisticField.trim());return e.geometry&&!e.outSR&&(e.outSR=e.geometry.spatialReference),ve(e,t,n)})}function ve(e,t,n){return m(this,null,function*(){if(!e)return null;let{where:r}=e;if(e.where=r=r?.trim(),(!r||/^1 *= *1$/.test(r)||t&&t===r)&&(e.where=null),!e.geometry)return e;let i=yield Ee(e);if(e.distance=0,e.units=null,e.spatialRel==="esriSpatialRelEnvelopeIntersects"){let{spatialReference:s}=e.geometry;i=Y(i),i.spatialReference=s}if(i){yield x(i.spatialReference,n),i=be(i,n);let s=(yield oe(X(i)))[0];if(s==null)throw ye;let o="quantizationParameters"in e&&e.quantizationParameters?.tolerance||"maxAllowableOffset"in e&&e.maxAllowableOffset||0,a=o&&he(i,n)?{densificationStep:8*o}:void 0,u=s.toJSON(),l=z(u,u.spatialReference,n,a);if(!l)throw ye;l.spatialReference=n,e.geometry=l}return e})}function he(e,t){if(!e)return!1;let n=e.spatialReference;return(f(e)||g(e)||K(e))&&!R(n,t)&&!ie(n,t)}function be(e,t){let n=e.spatialReference;return he(e,t)&&f(e)?{spatialReference:n,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}:e}function Ee(e){return m(this,null,function*(){let{distance:t,units:n}=e,r=e.geometry;if(t==null||"vertexAttributes"in r)return r;let i=r.spatialReference,s=n?we.fromJSON(n):k(i),o=i&&(J(i)||S(i))?r:yield x(i,v).then(()=>z(r,v));return(yield Te())(o.spatialReference,o,t,s)})}function Te(){return m(this,null,function*(){return(yield import("./chunk-PM74IUJK.js")).geodesicBuffer})}function ge(e){return e==="mesh"?L:D(e)}function Re(e,t){return e?t?4:3:t?3:2}function Se(e,t,n,r){return de(e,t,n,r.coords[0],r.coords[1])}function xe(e,t,n,r,i,s){let o=Re(i,s),{coords:a,lengths:u}=r;if(!u)return!1;for(let l=0,c=0;l<u.length;l++,c+=o)if(!de(e,t,n,a[c],a[c+1]))return!1;return!0}function de(e,t,n,r,i){if(!e)return!1;let s=Re(t,n),{coords:o,lengths:a}=e,u=!1,l=0;for(let c of a)u=je(u,o,s,l,c,r,i),l+=c*s;return u}function je(e,t,n,r,i,s,o){let a=e,u=r;for(let l=r,c=r+i*n;l<c;l+=n){u=l+n,u===c&&(u=r);let p=t[l],P=t[l+1],Pe=t[u],w=t[u+1];(P<o&&w>=o||w<o&&P>=o)&&p+(o-P)/(w-P)*(Pe-p)<s&&(a=!a)}return a}var O="unsupported-query",Ne={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},q={spatialRelationship:{esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},queryGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},layerGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1}};function _e(e){return e!=null&&q.spatialRelationship[e]===!0}function ze(e){return e!=null&&q.queryGeometry[$(e)]===!0}function Ce(e){return e!=null&&q.layerGeometry[e]===!0}function Fe(){return import("./chunk-PM74IUJK.js")}function jt(e,t,n,r,i){if(g(t)&&n==="esriGeometryPoint"&&(e==="esriSpatialRelIntersects"||e==="esriSpatialRelContains")){let s=E(new y,t,!1,!1);return Promise.resolve(o=>Se(s,!1,!1,o))}if(g(t)&&n==="esriGeometryMultipoint"){let s=E(new y,t,!1,!1);if(e==="esriSpatialRelContains")return Promise.resolve(o=>xe(s,!1,!1,o,r,i))}if(f(t)&&n==="esriGeometryPoint"&&(e==="esriSpatialRelIntersects"||e==="esriSpatialRelContains"))return Promise.resolve(s=>Q(t,d(n,r,i,s)));if(f(t)&&n==="esriGeometryMultipoint"&&e==="esriSpatialRelContains")return Promise.resolve(s=>B(t,d(n,r,i,s)));if(f(t)&&e==="esriSpatialRelIntersects"){let s=ge(n);return Promise.resolve(o=>s(t,d(n,r,i,o)))}return Fe().then(s=>{let o=s[Ne[e]].bind(null,t.spatialReference,t);return a=>o(d(n,r,i,a))})}function Nt(e,t,n){return m(this,null,function*(){let{spatialRel:r,geometry:i}=e;if(i){if(!_e(r))throw new M(O,"Unsupported query spatial relationship",{query:e});if(h(i.spatialReference)&&h(n)){if(!ze(i))throw new M(O,"Unsupported query geometry type",{query:e});if(!Ce(t))throw new M(O,"Unsupported layer geometry type",{query:e});if(e.outSR)return x(e.geometry?.spatialReference,e.outSR)}}})}function _t(e){if(f(e))return!0;if(g(e)){for(let t of e.rings)if(t.length!==5||t[0][0]!==t[1][0]||t[0][0]!==t[4][0]||t[2][0]!==t[3][0]||t[0][1]!==t[3][1]||t[0][1]!==t[4][1]||t[1][1]!==t[2][1])return!1;return!0}return!1}function Ft(e,t){return m(this,null,function*(){if(!e)return null;let n=t.featureAdapter,{startTimeField:r,endTimeField:i}=e,s=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;if(r&&i)yield t.forEach(a=>{let u=n.getAttribute(a,r),l=n.getAttribute(a,i);u==null||isNaN(u)||(s=Math.min(s,u)),l==null||isNaN(l)||(o=Math.max(o,l))});else{let a=r||i;yield t.forEach(u=>{let l=n.getAttribute(u,a);l==null||isNaN(l)||(s=Math.min(s,l),o=Math.max(o,l))})}return{start:s,end:o}})}function Ot(e,t,n){if(!t||!e)return null;let{startTimeField:r,endTimeField:i}=e;if(!r&&!i)return null;let{start:s,end:o}=t;if(s===null&&o===null)return null;if(s===void 0&&o===void 0)return Ae();let a=n.getAttributeAsTimestamp?.bind(n)??n.getAttribute.bind(n);return r&&i?Oe(a,r,i,s,o):qe(a,r||i,s,o)}function Oe(e,t,n,r,i){return r!=null&&i!=null?s=>{let o=e(s,t),a=e(s,n);return(o==null||o<=i)&&(a==null||a>=r)}:r!=null?s=>{let o=e(s,n);return o==null||o>=r}:i!=null?s=>{let o=e(s,t);return o==null||o<=i}:void 0}function qe(e,t,n,r){return n!=null&&r!=null&&n===r?i=>e(i,t)===n:n!=null&&r!=null?i=>{let s=e(i,t);return s!=null&&s>=n&&s<=r}:n!=null?i=>{let s=e(i,t);return s!=null&&s>=n}:r!=null?i=>{let s=e(i,t);return s!=null&&s<=r}:void 0}function Ae(){return()=>!1}export{Ke as a,d as b,Xe as c,x as d,z as e,Qe as f,ye as g,at as h,ve as i,jt as j,Nt as k,_t as l,Ft as m,Ot as n};
