import{a as We}from"./chunk-UZSTUBKI.js";import{a as b}from"./chunk-DRE2I74M.js";import{e as Ut,f as Dt}from"./chunk-SDUXSXKH.js";import{c as Ye,d as Nt,e as _t}from"./chunk-F7N72PQ7.js";import{a as W,b as N}from"./chunk-3MLEE2XK.js";import{a as De}from"./chunk-BPP5MIUB.js";import{a as Ue}from"./chunk-TCQOV56D.js";import{a as Pe,b as Re,c as Ot,d as Ge,e as k,f as G,g as Te,h as Me,i as Ie,j as Oe,k as je,l as Ce,p as jt,s as Ct,t as Et,u as Lt,v as kt}from"./chunk-6MTY3OXX.js";import{a as $e,b as Pt,c as Rt}from"./chunk-CGZE4C6W.js";import{a as $,b as Fe}from"./chunk-CLDJAOGN.js";import{a as It}from"./chunk-YIRBKWRK.js";import{a as Tt,c as Mt}from"./chunk-IFFYADB3.js";import{a as D}from"./chunk-BVW6ULEA.js";import{a as Ae}from"./chunk-7C6Z24SS.js";import{b as B,c as be,d as Ve,f as ze,g as Be}from"./chunk-C4XQ3IUU.js";import{a as Se,b as At}from"./chunk-T2INZTCD.js";import{a as wt,f as vt,q as St}from"./chunk-GUOR3BIM.js";import{a as Ft}from"./chunk-V5AJXD2Y.js";import{b as bt}from"./chunk-WXS2B4FF.js";import{a as at,c as st}from"./chunk-GNCG2SQP.js";import{d as xt,e as ge,g as xe,j as yt,l as ye,m as we,p as ve}from"./chunk-K5NHJTKR.js";import{o as _e}from"./chunk-F7PIPM6E.js";import{f as me}from"./chunk-FR6Q4MSQ.js";import{a as M}from"./chunk-BCREO4Q5.js";import{f as gt}from"./chunk-6FWNINU2.js";import{A as dt,E as de,F as re,a as S,c as fe,e as z,f as ft,l as U,m as ut,n as ue,u as ht,z as he}from"./chunk-ES7AH7WX.js";import{b as it}from"./chunk-G3LLBABP.js";import{a as ct}from"./chunk-JTJ3UVF7.js";import{a as nt}from"./chunk-5HLV7XP5.js";import{b as mt,j as R,t as te}from"./chunk-UI76XBLJ.js";import{S as lt,U as pt}from"./chunk-BE76S5KT.js";import{G as ot,q as rt}from"./chunk-CTGIUUCS.js";import{F as v,a as Je}from"./chunk-VWEBO6QK.js";import{S as pe}from"./chunk-KAAR5ZJN.js";import{a as x}from"./chunk-W3WDPWBE.js";import{g as Qe,h as ce,j as et,o as le,s as tt}from"./chunk-WKT5W7KT.js";import{p as T,r as L}from"./chunk-X3IDZTNG.js";import{a as ee,b as se,h as j}from"./chunk-EAH6BNBL.js";var Vt="Mesh must be loaded before applying operations",zt="Provided component is not part of the list of components",Bt="Expected polygon to be a Polygon instance",Y="Expected location to be a Point instance",oe=class extends L{constructor(){super("invalid-input:location",Y)}};function br(e,t,o,r){let n=(a=>!Array.isArray(a[0]))(t)?(a,s)=>t[3*a+s]:(a,s)=>t[a][s],i=r?pt(r)/lt(r):1;return Dt(e,(a,s)=>U(a,n(s,0)*i,n(s,1)*i,n(s,2)),o)}function Gt(e,t,o){let r=br($t,e,t,o)?$t:[0,0,1];return Math.abs(r[2])>Math.cos(gt(80))?M.Z:Math.abs(r[1])>Math.abs(r[0])?M.Y:M.X}var $t=Ut();function Wt(e){let t=Fr(e.rings,e.hasZ,Le.CCW_IS_HOLE,e.spatialReference),o=new Array,r=0,n=0;for(let s of t.polygons){let l=s.count,c=s.index,p=Rt(t.position,3*c,3*l),u=s.holeIndices.map(m=>m-c),f=Ue(We(p,u,3));o.push({position:p,faces:f}),r+=p.length,n+=f.length}let i=Ar(o,r,n),a=Array.isArray(i.position)?De(i.position,3,{originalIndices:i.faces}):De(i.position.buffer,6,{originalIndices:i.faces});return i.position=Pt(new Float64Array(a.buffer)),i.faces=a.indices,i}function Ar(e,t,o){if(e.length===1)return e[0];let r=$e(t),n=new Array(o),i=0,a=0,s=0;for(let l of e){for(let c=0;c<l.position.length;c++)r[i++]=l.position[c];for(let c of l.faces)n[a++]=c+s;s=i/3}return{position:r,faces:Ue(n)}}function Fr(e,t,o,r){let n=e.length,i=new Array(n),a=new Array(n),s=new Array(n),l=0,c=0,p=0,u=0;for(let h=0;h<n;++h)u+=e[h].length;let f=$e(3*u),m=0;for(let h=n-1;h>=0;h--){let d=e[h],F=o===Le.CCW_IS_HOLE&&Pr(d,t,r);if(F&&n!==1)i[l++]=d;else{let O=d.length;for(let g=0;g<l;++g)O+=i[g].length;let w={index:m,pathLengths:new Array(l+1),count:O,holeIndices:new Array(l)};w.pathLengths[0]=d.length,d.length>0&&(s[p++]={index:m,count:d.length}),m=F?Ee(d,d.length-1,-1,f,m,d.length,t):Ee(d,0,1,f,m,d.length,t);for(let g=0;g<l;++g){let P=i[g];w.holeIndices[g]=m,w.pathLengths[g+1]=P.length,P.length>0&&(s[p++]={index:m,count:P.length}),m=Ee(P,0,1,f,m,P.length,t)}l=0,w.count>0&&(a[c++]=w)}}for(let h=0;h<l;++h){let d=i[h];d.length>0&&(s[p++]={index:m,count:d.length}),m=Ee(d,0,1,f,m,d.length,t)}return a.length=c,s.length=p,{position:f,polygons:a,outlines:s}}function Ee(e,t,o,r,n,i,a){n*=3;for(let s=0;s<i;++s){let l=e[t];r[n++]=l[0],r[n++]=l[1],r[n++]=a?l[2]:0,t+=o}return n/3}function Pr(e,t,o){if(t){let r=e.length-1,n=Gt(e,r,o);if(n===M.X)return!me(e,M.Y,M.Z);if(n===M.Y)return!me(e,M.X,M.Z)}return!me(e,M.X,M.Y)}var Le;(function(e){e[e.NONE=0]="NONE",e[e.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(Le||(Le={}));function Zt([e,t,o,r,n,i],a,s,l){Yt??=new Float64Array(24);let c=Yt;return c[0]=e,c[1]=t,c[2]=o,c[3]=e,c[4]=n,c[5]=o,c[6]=r,c[7]=n,c[8]=o,c[9]=r,c[10]=t,c[11]=o,c[12]=e,c[13]=t,c[14]=i,c[15]=e,c[16]=n,c[17]=i,c[18]=r,c[19]=n,c[20]=i,c[21]=r,c[22]=t,c[23]=i,Ct({positions:c,transform:a,vertexSpace:s,inSpatialReference:l,outSpatialReference:l,outPositions:c}),He(c,l)}var Yt=null;function Ze(e){if(e.length===0)return St;let t=wt([Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,-Number.POSITIVE_INFINITY,-Number.POSITIVE_INFINITY,-Number.POSITIVE_INFINITY]);return vt(t,e),t}function He(e,t){let[o,r,n,i,a,s]=Ze(e);return new te({xmin:o,ymin:r,zmin:n,xmax:i,ymax:a,zmax:s,spatialReference:t})}var ne="esri.geometry.support.meshUtils.centerAt";function Ht(e,t,o){if(!e.vertexAttributes?.position)return;let{vertexSpace:r}=e,n=o?.origin??e.anchor,i=o?.geographic,a=G(ne,r,n.spatialReference,i);B(r)?Rr(e,t,n):a?Tr(e,t,n):Mr(e,t,n)}function Rr(e,t,o){let{vertexSpace:r}=e;if(!B(r))return;let n=Xt,i=qt;if(!b(t,i,e.spatialReference))return void T.getLogger(ne).error(`Failed to project centerAt location (wkid:${t.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid}). Projection may be possible after calling projection.load().`);if(!b(o,n,e.spatialReference)){let s=e.origin;n[0]=s.x,n[1]=s.y,n[2]=s.z,T.getLogger(ne).error(`Failed to project specified origin (wkid:${o.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid}). Projection may be possible after calling projection.load().`)}let a=ue(Or,i,n);r.origin=ut(S(),r.origin,a)}function Tr(e,t,o){let r=Lt(e.vertexAttributes,o),{position:n,normal:i,tangent:a}=Et(r,t,!1);e.vertexAttributes.position=n,e.vertexAttributes.normal=i,e.vertexAttributes.tangent=a,e.vertexAttributesChanged()}function Mr(e,t,o){let r=Xt,n=qt;if(b(t,n,e.spatialReference)){if(!b(o,r,e.spatialReference)){let i=e.origin;r[0]=i.x,r[1]=i.y,r[2]=i.z,T.getLogger(ne).error(`Failed to project specified origin (wkid:${o.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid}). Projection may be possible after calling projection.load().`)}Ir(e.vertexAttributes.position,n,r),e.vertexAttributesChanged()}else T.getLogger(ne).error(`Failed to project centerAt location (wkid:${t.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid}). Projection may be possible after calling projection.load().`)}function Ir(e,t,o){if(e)for(let r=0;r<e.length;r+=3)for(let n=0;n<3;n++)e[r+n]+=t[n]-o[n]}var qt=S(),Xt=S(),Or=S();function Kt(e,t,o){return j(this,null,function*(){let{source:r}=t,{loadGLTFMesh:n}=yield le(import("./chunk-GUAOHPBI.js"),o),i=yield Cr(r,o);ce(o);let a=n(new R({x:0,y:0,z:0,spatialReference:e.spatialReference}),i.url,{resolveFile:jr(i),signal:o?.signal,expectedType:i.type});a.then(()=>i.dispose(),()=>i.dispose());let{vertexAttributes:s,components:l}=yield a;e.vertexAttributes=s,e.components=l})}function jr(e){let t=ot(e.url);return o=>{let r=rt(o,t,t),n=r?r.replace(/^ *\.\//,""):null;return(n?e.files.get(n):null)??o}}function Cr(e,t){return j(this,null,function*(){if(Array.isArray(e)){if(!e.length)throw new L("mesh-load-external:missing-assets","There must be at least one file to load");return e[0]instanceof File?Lr(e):kr(e,t)}return Jt(e)})}function Er(e,t){return j(this,null,function*(){let{parts:o,assetMimeType:r,assetName:n}=e;if(o.length===1)return new Z(o[0].partUrl);let i=yield e.toBlob(t);return ce(t),Z.fromBlob(i,rr(n,r))})}function Jt(e){return Z.fromBlob(e,rr(e.name,e.type))}function Lr(e){return tr(e.map(t=>({name:t.name,mimeType:t.type,source:Jt(t)})))}function kr(e,t){return j(this,null,function*(){let o=yield tt(e.map(r=>j(this,null,function*(){let n=yield Er(r);return ce(t),{name:r.assetName,mimeType:r.assetMimeType,source:n}})));if(et(t))throw o.forEach(r=>r.source.dispose()),Qe();return tr(o)})}var Qt=/^model\/gltf\+json$/,er=/^model\/gltf-binary$/,qe=/\.gltf$/i,Nr=/\.glb$/i;function tr(e){let t=new Map,o,r=null;for(let{name:n,mimeType:i,source:a}of e)r===null&&(Qt.test(i)||qe.test(n)?(r=a.url,o="gltf"):(er.test(i)||Nr.test(n))&&(r=a.url,o="glb")),t.set(n,a.url),a.files.forEach((s,l)=>t.set(l,s));if(r==null)throw new L("mesh-load-external:missing-files","Missing files to load external mesh source");return new Z(r,()=>e.forEach(({source:n})=>n.dispose()),t,o)}var Z=class e{constructor(t,o=()=>{},r=new Map,n){this.url=t,this.dispose=o,this.files=r,this.type=n}static fromBlob(t,o){let r=URL.createObjectURL(t);return new e(r,()=>URL.revokeObjectURL(r),void 0,o)}};function rr(e,t){return Qt.test(t)||qe.test(e)?"gltf":er.test(t)||qe.test(e)?"glb":void 0}var E=class extends bt{constructor(){super(),this.externalSources=new it,this._explicitDisplaySource=null,this.addHandles(st(()=>this.externalSources,"after-remove",({item:e})=>{e===this._explicitDisplaySource&&(this._explicitDisplaySource=null)},{sync:!0,onListenerRemove:()=>this._explicitDisplaySource=null}))}get displaySource(){return this._explicitDisplaySource??this._implicitDisplaySource}set displaySource(e){if(e!=null&&!Ye(e))throw new Error("Cannot use this source for display: it is not in a supported format.");this._explicitDisplaySource=e,e&&this.externalSources.every(t=>!_t(t,e))&&this.externalSources.add(e)}clearSources(){this.externalSources.removeAll()}getExternalSourcesOnService(e){return this.externalSources.items.filter(t=>Nt(t,e))}get _implicitDisplaySource(){return this.externalSources.find(Ye)}};x([v()],E.prototype,"externalSources",void 0),x([v()],E.prototype,"displaySource",null),x([v()],E.prototype,"_implicitDisplaySource",null),x([v()],E.prototype,"_explicitDisplaySource",void 0),E=x([pe("esri.geometry.support.meshUtils.Metadata")],E);function or(){let{faceDescriptions:e,faceVertexOffsets:t,uvScales:o}=Vr,r=4*e.length,n=new Float64Array(3*r),i=new Float32Array(3*r),a=new Float32Array(2*r),s=new Uint32Array(2*e.length*3),l=0,c=0,p=0,u=0;for(let f=0;f<e.length;f++){let m=e[f],h=l/3;for(let F of t)s[u++]=h+F;let d=m.corners;for(let F=0;F<4;F++){let O=d[F],w=0;a[p++]=.25*o[F][0]+m.uvOrigin[0],a[p++]=m.uvOrigin[1]-.25*o[F][1];for(let g=0;g<3;g++)m.axis[g]!==0?(n[l++]=.5*m.axis[g],i[c++]=m.axis[g]):(n[l++]=.5*O[w++],i[c++]=0)}}return{position:n,normal:i,uv:a,faces:s}}function nr(e,t){let o=e.components[0],r=o.faces,n=zr[t],i=6*n,a=new Array(6),s=new Array(r.length-6),l=0,c=0;for(let p=0;p<r.length;p++)p>=i&&p<i+6?a[l++]=r[p]:s[c++]=r[p];if(e.vertexAttributes.uv!=null){let p=new Float32Array(e.vertexAttributes.uv),u=4*n*2,f=[0,1,1,1,1,0,0,0];for(let m=0;m<f.length;m++)p[u+m]=f[m];e.vertexAttributes.uv=p}return e.components=[new N({faces:a,material:o.material}),new N({faces:s})],e}function ir(e=0){let t=Math.round(8*2**e),o=2*t,r=(t-1)*(o+1)+2*o,n=new Float64Array(3*r),i=new Float32Array(3*r),a=new Float32Array(2*r),s=new Uint32Array(3*((t-1)*o*2)),l=0,c=0,p=0,u=0;for(let f=0;f<=t;f++){let m=f/t*Math.PI+.5*Math.PI,h=Math.cos(m),d=Math.sin(m);y[2]=d;let F=f===0||f===t,O=F?o-1:o;for(let w=0;w<=O;w++){let g=w/O*2*Math.PI;y[0]=-Math.sin(g)*h,y[1]=Math.cos(g)*h;for(let P=0;P<3;P++)n[l]=.5*y[P],i[l]=y[P],++l;a[c++]=(w+(F?.5:0))/o,a[c++]=f/t,f!==0&&w!==o&&(f!==t&&(s[p++]=u,s[p++]=u+1,s[p++]=u-o),f!==1&&(s[p++]=u,s[p++]=u-o,s[p++]=u-o-1)),u++}}return{position:n,normal:i,uv:a,faces:s}}function ar(e=0){let o=Math.round(16*2**e),r=4*(o+1)+2*o,n=new Float64Array(3*r),i=new Float32Array(3*r),a=new Float32Array(2*r),s=new Uint32Array(3*(4*o)),l=0,c=0,p=0,u=0,f=0;for(let m=0;m<=5;m++){let h=m===0||m===5,d=m<=1||m>=4,F=m===2||m===4,O=h?o-1:o;for(let w=0;w<=O;w++){let g=w/O*2*Math.PI,P=h?0:.5;y[0]=P*Math.sin(g),y[1]=P*-Math.cos(g),y[2]=m<=2?.5:-.5;for(let V=0;V<3;V++)n[l++]=y[V],i[c++]=d?V===2?m<=1?1:-1:0:V===2?0:y[V]/P;a[p++]=(w+(h?.5:0))/o,a[p++]=m<=1?1*m/3:m<=3?1*(m-2)/3+1/3:1*(m-4)/3+2/3,F||m===0||w===o||(m!==5&&(s[u++]=f,s[u++]=f+1,s[u++]=f-o),m!==1&&(s[u++]=f,s[u++]=f-o,s[u++]=f-o-1)),f++}}return{position:n,normal:i,uv:a,faces:s}}function sr(e,t){let o=typeof t=="number"?t:t!=null?t.width:1,r=typeof t=="number"?t:t!=null?t.height:1;switch(e){case"up":case"down":return{width:o,depth:r};case"north":case"south":return{width:o,height:r};case"east":case"west":return{depth:o,height:r}}}function cr(e){let t=ie.facingAxisOrderSwap[e],o=ie.position,r=ie.normal,n=new Float64Array(o.length),i=new Float32Array(r.length),a=0;for(let s=0;s<4;s++){let l=a;for(let c=0;c<3;c++){let p=t[c],u=Math.abs(p)-1,f=p>=0?1:-1;n[a]=o[l+u]*f,i[a]=r[l+u]*f,a++}}return{position:n,normal:i,uv:new Float32Array(ie.uv),faces:new Uint32Array(ie.faces),isPlane:!0}}var H=1,q=2,X=3,ie={position:[-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0],normal:[0,0,1,0,0,1,0,0,1,0,0,1],uv:[0,1,1,1,1,0,0,0],faces:[0,1,2,0,2,3],facingAxisOrderSwap:{east:[X,H,q],west:[-X,-H,q],north:[-H,X,q],south:[H,-X,q],up:[H,q,X],down:[H,-q,-X]}};function ae(e,t,o){e.isPlane||_r(e),Dr(e,Ur(o?.size,o?.unit,t.spatialReference));let{vertexAttributes:r,vertexSpace:n,transform:i}=jt(e,t,{vertexSpace:o?.vertexSpace,geographic:o?.geographic});return{vertexAttributes:new W(se(ee({},r),{uv:e.uv})),vertexSpace:n,transform:i,components:[new N({faces:e.faces,material:o?.material||null})],spatialReference:t.spatialReference}}function _r(e){for(let t=0;t<e.position.length;t+=3)e.position[t+2]+=.5}function Ur(e,t,o){let r=kt(t,o);if(e==null&&r===1)return null;if(e==null)return[r,r,r];if(typeof e=="number"){let n=e*r;return[n,n,n]}return[e.width!=null?e.width*r:r,e.depth!=null?e.depth*r:r,e.height!=null?e.height*r:r]}function Dr(e,t){if(t!=null){_[0]=t[0],_[4]=t[1],_[8]=t[2];for(let o=0;o<e.position.length;o+=3){for(let r=0;r<3;r++)y[r]=e.position[o+r];re(y,y,_);for(let r=0;r<3;r++)e.position[o+r]=y[r]}if(t[0]!==t[1]||t[1]!==t[2]){_[0]=1/t[0],_[4]=1/t[1],_[8]=1/t[2];for(let o=0;o<e.normal.length;o+=3){for(let r=0;r<3;r++)y[r]=e.normal[o+r];re(y,y,_),dt(y,y);for(let r=0;r<3;r++)e.normal[o+r]=y[r]}}}}var Vr={faceDescriptions:[{axis:[0,-1,0],uvOrigin:[0,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[1,0,0],uvOrigin:[.25,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,1,0],uvOrigin:[.5,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[-1,0,0],uvOrigin:[.75,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[0,0,1],uvOrigin:[0,.375],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,0,-1],uvOrigin:[0,.875],corners:[[-1,1],[1,1],[1,-1],[-1,-1]]}],uvScales:[[0,0],[1,0],[1,1],[0,1]],faceVertexOffsets:[0,1,2,0,2,3]},zr={south:0,east:1,north:2,west:3,up:4,down:5},y=S(),_=Ae();function ke(e,t,{vertexSpace:o,spatialReference:r}){if(o.type==="georeferenced"){let c=e;if(!b(t,c,r))return!1;let{origin:p}=o;return ue(e,c,p),!0}let n=$(r),i=e;if(!b(t,i,n))return!1;let{origin:a}=o,s=lr;if(!Fe(r,a,s,n))return!1;let l=xt(lr,s);return l!=null&&(de(e,i,l),!0)}var lr=D();var Xe="esri.geometry.support.meshUtils.rotate";function hr(e,t,o){if(!e.vertexAttributes?.position||t[3]===0)return;let{spatialReference:r,vertexSpace:n}=e,i=o?.origin??e.anchor,a=o?.geographic,s=G(Xe,n,r,a);be(e)?Br(e,t,i):s?$r(e,t,i):Gr(e,t,i)}function Br(e,t,o){e.transform??=new k;let{vertexSpace:r,transform:n,spatialReference:i}=e,[a,s,l]=r.origin,c=new R({x:a,y:s,z:l,spatialReference:i}),p=K;if(c.equals(o))U(p,0,0,0);else if(!ke(p,o,e))return void T.getLogger(Xe).error(`Failed to project specified origin (wkid:${o.spatialReference.wkid}) to mesh (wkid:${i.wkid}) ${r.type} vertex space. Projection may be possible after calling projection.load().`);It(ur,t,Ge(t));let u=ve(pr,ur,z,ft,p),{localMatrix:f}=n,m=ge(pr,u,f);n.scale=we(S(),m),xe(m,m,he(K,n.scale)),n.rotation=Re(m),n.translation=ye(S(),m)}function $r(e,t,o){let r=e.spatialReference,n=$(r),i=dr;b(o,i,n)||b(e.origin,i,n);let a=e.vertexAttributes.position,s=e.vertexAttributes.normal,l=e.vertexAttributes.tangent,c=new Float64Array(a.length),p=s!=null?new Float32Array(s.length):null,u=l!=null?new Float32Array(l.length):null;Fe(n,i,Ne,n),Ft(fr,Ne);let f=mr;re(mr,t,fr),f[3]=t[3],Ie(a,r,c),s!=null&&p!=null&&Te(s,a,c,r,p),l!=null&&u!=null&&je(l,a,c,r,u),J(c,f,3,i),Oe(c,a,r),s!=null&&p!=null&&(J(p,f,3),Me(p,a,c,r,s)),l!=null&&u!=null&&(J(u,f,4),Ce(u,a,c,r,l)),e.vertexAttributesChanged()}function Gr(e,t,o){let r=dr;if(!b(o,r,e.spatialReference)){let n=e.origin;r[0]=n.x,r[1]=n.y,r[2]=n.z,T.getLogger(Xe).error(`Failed to project specified origin (wkid:${o.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid}). Projection may be possible after calling projection.load().`)}J(e.vertexAttributes.position,t,3,r),J(e.vertexAttributes.normal,t,3),J(e.vertexAttributes.tangent,t,4),e.vertexAttributesChanged()}function J(e,t,o,r=z){if(e!=null){yt(Ne,Ge(t),t);for(let n=0;n<e.length;n+=o){for(let i=0;i<3;i++)K[i]=e[n+i]-r[i];de(K,K,Ne);for(let i=0;i<3;i++)e[n+i]=K[i]+r[i]}}}var K=S(),pr=D(),mr=Pe(),Ne=D(),fr=Ae(),dr=S(),ur=Tt();var Ke="esri.geometry.support.meshUtils.scale";function xr(e,t,o){if(!e.vertexAttributes?.position)return;let{vertexSpace:r,spatialReference:n}=e,i=o?.origin??e.anchor,a=o?.geographic,s=G(Ke,r,n,a);be(e)?Wr(e,t,i):s?Yr(e,t,i):Zr(e,t,i)}function Wr(e,t,o){e.transform??=new k;let{vertexSpace:r,transform:n,spatialReference:i}=e,[a,s,l]=r.origin,c=new R({x:a,y:s,z:l,spatialReference:i}),p=Q;if(c.equals(o))U(p,0,0,0);else if(!ke(p,o,e))return void T.getLogger(Ke).error(`Failed to project specified origin (wkid:${o.spatialReference.wkid}) to mesh (wkid:${i.wkid}) ${r.type} vertex space. Projection may be possible after calling projection.load().`);let u=U(Hr,t,t,t),f=ve(gr,Mt,z,u,p),{localMatrix:m}=n,h=ge(gr,f,m);n.scale=we(S(),h),xe(h,h,he(Q,n.scale)),n.rotation=Re(h),n.translation=ye(S(),h)}function Yr(e,t,o){let r=e.spatialReference,n=$(r),i=wr;b(o,i,n)||b(e.origin,i,n);let a=e.vertexAttributes.position,s=e.vertexAttributes.normal,l=e.vertexAttributes.tangent,c=new Float64Array(a.length),p=s!=null?new Float32Array(s.length):null,u=l!=null?new Float32Array(l.length):null;Ie(a,r,c),s!=null&&p!=null&&Te(s,a,c,r,p),l!=null&&u!=null&&je(l,a,c,r,u),yr(c,t,i),Oe(c,a,r),s!=null&&p!=null&&Me(p,a,c,r,s),l!=null&&u!=null&&Ce(u,a,c,r,l),e.vertexAttributesChanged()}function Zr(e,t,o){let r=wr;if(!b(o,r,e.spatialReference)){let n=e.origin;r[0]=n.x,r[1]=n.y,r[2]=n.z,T.getLogger(Ke).error(`Failed to project specified origin (wkid:${o.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid}). Projection may be possible after calling projection.load().`)}yr(e.vertexAttributes.position,t,r),e.vertexAttributesChanged()}function yr(e,t,o=z){if(e)for(let r=0;r<e.length;r+=3){for(let n=0;n<3;n++)Q[n]=e[r+n]-o[n];ht(Q,Q,t);for(let n=0;n<3;n++)e[r+n]=Q[n]+o[n]}}var Q=S(),Hr=S(),gr=D(),wr=S();var I,Sr="esri.geometry.Mesh";function C(){return T.getLogger(Sr)}var qr={base:null,key:"type",defaultKeyValue:"georeferenced",typeMap:{georeferenced:Se,local:At}},A=I=class extends ct.LoadableMixin(nt(mt)){constructor(e){super(e),this.components=null,this.vertexSpace=new Se,this.transform=null,this.metadata=new E,this.hasZ=!0,this.hasM=!1,this.vertexAttributes=new W,this.type="mesh"}initialize(){(this.metadata.externalSources.length===0||this.vertexAttributes.position.length)&&(this.loadStatus="loaded"),this.when(()=>{this.addHandles(at(()=>({vertexAttributes:this.vertexAttributes,components:this.components?.map(e=>e.clone())}),()=>this._clearSources(),{once:!0,sync:!0}))})}get hasExtent(){return this.loaded?this.vertexAttributes.position.length>0&&(!this.components||this.components.length>0):this.metadata.displaySource?.extent!=null}get _transformedExtent(){let{components:e,spatialReference:t,vertexAttributes:o,vertexSpace:r}=this,n=o.position;if(n.length===0||e&&e.length===0)return new te({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:t});if(B(r)){let{_untransformedBounds:i,transform:a}=this;return Zt(i,a,r,t)}return He(n,t)}get _untransformedBounds(){return Ze(this.vertexAttributes.position)}get anchor(){let e=Ve(this.vertexSpace,this.spatialReference);if(e!=null)return e;let{center:t,zmin:o}=this._transformedExtent;return new R({x:t.x,y:t.y,z:o,spatialReference:this.spatialReference})}get origin(){let e=Ve(this.vertexSpace,this.spatialReference);return e??this._transformedExtent.center}get extent(){return this.loaded||this.metadata?.displaySource?.extent==null?this._transformedExtent:this.metadata.displaySource.extent.clone()}addComponent(e){this._checkIfLoaded("addComponent()")&&(this.components||(this.components=[]),this.components.push(N.from(e)),this.notifyChange("components"))}removeComponent(e){if(this._checkIfLoaded("removeComponent()")){if(this.components){let t=this.components.indexOf(e);if(t!==-1)return this.components.splice(t,1),void this.notifyChange("components")}C().error("removeComponent()",zt)}}rotate(e,t,o,r){return Ot(e,t,o,vr),hr(this,vr,r),this}offset(e,t,o){if(!this._checkIfLoaded("offset()"))return this;let{vertexSpace:r,vertexAttributes:n}=this,i=n?.position;if(!i)return this;if(B(r)){let[a,s,l]=r.origin;r.origin=fe(a+e,s+t,l+o)}else{for(let a=0;a<i.length;a+=3)i[a]+=e,i[a+1]+=t,i[a+2]+=o;this.vertexAttributesChanged()}return this}scale(e,t){return this._checkIfLoaded("scale()")?(xr(this,e,t),this):this}centerAt(e,t){return this._checkIfLoaded("centerAt()")?(Ht(this,e,t),this):this}load(e){let{metadata:{displaySource:t}}=this;return t&&this.addResolvingPromise(Kt(this,t,e)),Promise.resolve(this)}addExternalSources(e){this.metadata.externalSources.addMany(e)}updateDisplaySource(e){this.metadata.displaySource=e}clone(){return this.cloneWithVertexSpace(this.vertexSpace.clone())}cloneWithVertexSpace(e){let t=null;if(this.components){let r=new Map,n=new Map;t=this.components.map(i=>i.cloneWithDeduplication(r,n))}let o={components:t,spatialReference:this.spatialReference,vertexAttributes:this.vertexAttributes.clone(),vertexSpace:e,transform:this.transform?.clone()??null,metadata:this.metadata.clone()};return new I(o)}cloneShallow(){return new I({components:this.components,spatialReference:this.spatialReference,vertexAttributes:this.vertexAttributes,vertexSpace:this.vertexSpace.clone(),transform:this.transform,metadata:this.metadata})}vertexAttributesChanged(){this.notifyChange("vertexAttributes")}toBinaryGLTF(e){return j(this,null,function*(){let t=import("./chunk-RJR243SX.js"),o=this.load(),r=yield Promise.all([t,o]),{toBinaryGLTF:n}=r[0];return n(this,e)})}get memoryUsage(){let e=0;if(e+=this.vertexAttributes.memoryUsage,this.components!=null)for(let t of this.components)e+=t.memoryUsage;return e}_clearSources(){this.metadata.clearSources()}_checkIfLoaded(e){return!!this.loaded||(C().error(e,Vt),!1)}static createBox(e,t){if(!(e instanceof R))return C().error(".createBox()",Y),null;let o=new I(ae(or(),e,t));return t?.imageFace&&t.imageFace!=="all"?nr(o,t.imageFace):o}static createSphere(e,t){return e instanceof R?new I(ae(ir(t?.densificationFactor||0),e,t)):(C().error(".createSphere()",Y),null)}static createCylinder(e,t){return e instanceof R?new I(ae(ar(t?.densificationFactor||0),e,t)):(C().error(".createCylinder()",Y),null)}static createPlane(e,t){if(!(e instanceof R))return C().error(".createPlane()",Y),null;let o=t?.facing??"up",r=sr(o,t?.size);return new I(ae(cr(o),e,se(ee({},t),{size:r})))}static createFromPolygon(e,t){if(!(e instanceof _e))return C().error(".createFromPolygon()",Bt),null;let o=Wt(e);return new I({vertexAttributes:new W({position:o.position}),components:[new N({faces:o.faces,shading:"flat",material:t?.material??null})],spatialReference:e.spatialReference,vertexSpace:new Se})}static createFromGLTF(e,t,o){return j(this,null,function*(){if(!(e instanceof R)){let n=new oe;throw C().error(".createfromGLTF()",n.message),n}let{loadGLTFMesh:r}=yield le(import("./chunk-GUAOHPBI.js"),o);return new I(yield r(e,t,o))})}static createFromFiles(e,t,o){return j(this,null,function*(){Je(C(),"`Mesh.createFromFiles` is deprecated in favor of 'SceneLayer.convertMesh'",{replacement:"SceneLayer.convertMesh",version:"4.29"});let r=n=>C().error(".createFromFiles()",n.message);if(!(e instanceof R)){let n=new oe;throw r(n),n}if(!o?.layer)throw new L("invalid:no-layer","SceneLayer required for file to mesh conversion.");return o.layer.convertMesh(t,ee({location:e},o))})}static createWithExternalSource(e,t,o){let r=o?.extent??null,{x:n,y:i,z:a,spatialReference:s}=e,l=o?.transform?.clone()??new k,c=fe(n,i,a??0),p=Be(o?.vertexSpace??ze(s),c),u={source:t,extent:r},f=new E;return f.externalSources.push(u),new I({metadata:f,transform:l,vertexSpace:p,spatialReference:s})}static createIncomplete(e,t){let{x:o,y:r,z:n,spatialReference:i}=e,a=t?.transform?.clone()??new k,s=fe(o,r,n??0),l=Be(t?.vertexSpace??ze(i),s),c=new I({transform:a,vertexSpace:l,spatialReference:i});return c.addResolvingPromise(Promise.reject(new L("mesh-incomplete","Mesh resources are not complete"))),c}};x([v({type:[N],json:{write:!0}})],A.prototype,"components",void 0),x([v({nonNullable:!0,types:qr,constructOnly:!0,json:{write:!0}})],A.prototype,"vertexSpace",void 0),x([v({type:k,json:{write:!0}})],A.prototype,"transform",void 0),x([v({constructOnly:!0})],A.prototype,"metadata",void 0),x([v()],A.prototype,"hasExtent",null),x([v()],A.prototype,"_transformedExtent",null),x([v()],A.prototype,"_untransformedBounds",null),x([v()],A.prototype,"anchor",null),x([v()],A.prototype,"origin",null),x([v({readOnly:!0,json:{read:!1}})],A.prototype,"extent",null),x([v({readOnly:!0,json:{read:!1,write:!0,default:!0}})],A.prototype,"hasZ",void 0),x([v({readOnly:!0,json:{read:!1,write:!0,default:!1}})],A.prototype,"hasM",void 0),x([v({type:W,nonNullable:!0,json:{write:!0}})],A.prototype,"vertexAttributes",void 0),A=I=x([pe(Sr)],A);var vr=Pe(),Ni=A;export{Ni as a};
