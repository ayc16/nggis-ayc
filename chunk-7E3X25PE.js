import{b as Ee}from"./chunk-TXV2XM7Y.js";import{a as Me,b as nt}from"./chunk-3DDJTCET.js";import{a as lt}from"./chunk-UDMTFKLM.js";import{a as Le}from"./chunk-PTXLSCMJ.js";import{b as kt,e as Re}from"./chunk-AW3LMT4V.js";import{c as be,d as Ie}from"./chunk-KUOODJRB.js";import{e as Q,f as Oe}from"./chunk-OW7DVBQB.js";import{a as y}from"./chunk-NDZXQR2V.js";import{a as N}from"./chunk-UVJ5D37D.js";import{c as G,i as H,j as U,w as zt}from"./chunk-ZAQLF7TN.js";import{a as pe,d as de}from"./chunk-ZHUHFKYD.js";import{D as me,a as ue,b as he,c as Bt,d as Ct,p as wt}from"./chunk-I3DWOIS7.js";import{a as Te}from"./chunk-XHOTVM3O.js";import{g as Ft}from"./chunk-H3VY6XFU.js";import{a as fe,u as ce,v as le}from"./chunk-R4NNYEN7.js";import{n as Ae}from"./chunk-CF52RSJZ.js";import{a as mt,b as _e,d as Ut}from"./chunk-ALWV3RJ2.js";import{a as ge}from"./chunk-7C6Z24SS.js";import{D as Dt,E as Vt,a as vt,d as xt,f as oe,g as ae}from"./chunk-EBWCXIFH.js";import{E as $,F as re,a as W,b as _t,c as C,d as F,l as K,m as X,o as ne,s as yt,u as Nt,v as St,w as ht}from"./chunk-OZF6BMOL.js";import{a as M,b as se,c as ie}from"./chunk-GJP6PTKT.js";import{F as ee}from"./chunk-AUTL5LCV.js";import{a as te}from"./chunk-CPDJJRWA.js";import{A as $t,F as Zt,I as Jt}from"./chunk-CRMMDK2Z.js";import{a as At,b as gt}from"./chunk-EAH6BNBL.js";function Pe(e){if(e.length<Jt)return Array.from(e);if(Zt(e))return Float64Array.from(e);if(!("BYTES_PER_ELEMENT"in e))return Array.from(e);switch(e.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(e);case 2:return $t(e)?Uint16Array.from(e):Int16Array.from(e);case 4:return Float32Array.from(e);default:return Float64Array.from(e)}}var Ot=class e{constructor(t,i,s){this.primitiveIndices=t,this._numIndexPerPrimitive=i,this.position=s,this._children=void 0,y(t.length>=1),y(s.size===3||s.size===4);let{data:a,size:r,indices:o}=s;y(o.length%this._numIndexPerPrimitive==0),y(o.length>=t.length*this._numIndexPerPrimitive);let c=t.length,n=r*o[this._numIndexPerPrimitive*t[0]];rt.clear(),rt.push(n);let l=ie(a[n],a[n+1],a[n+2]),f=se(l);for(let O=0;O<c;++O){let I=this._numIndexPerPrimitive*t[O];for(let E=0;E<this._numIndexPerPrimitive;++E){n=r*o[I+E],rt.push(n);let m=a[n];l[0]=Math.min(m,l[0]),f[0]=Math.max(m,f[0]),m=a[n+1],l[1]=Math.min(m,l[1]),f[1]=Math.max(m,f[1]),m=a[n+2],l[2]=Math.min(m,l[2]),f[2]=Math.max(m,f[2])}}this.bbMin=l,this.bbMax=f;let u=St(M(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(f[0]-l[0],f[1]-l[1]),f[2]-l[2]);let g=this.radius*this.radius;for(let O=0;O<rt.length;++O){n=rt.at(O);let I=a[n]-u[0],E=a[n+1]-u[1],m=a[n+2]-u[2],D=I*I+E*E+m*m;if(D<=g)continue;let L=Math.sqrt(D),S=.5*(L-this.radius);this.radius=this.radius+S,g=this.radius*this.radius;let R=S/L;u[0]+=I*R,u[1]+=E*R,u[2]+=m*R}this.center=u,rt.clear()}getChildren(){if(this._children||ne(this.bbMin,this.bbMax)<=1)return this._children;let t=St(M(),this.bbMin,this.bbMax,.5),i=this.primitiveIndices.length,s=new Uint8Array(i),a=new Array(8);for(let f=0;f<8;++f)a[f]=0;let{data:r,size:o,indices:c}=this.position;for(let f=0;f<i;++f){let u=0,g=this._numIndexPerPrimitive*this.primitiveIndices[f],O=o*c[g],I=r[O],E=r[O+1],m=r[O+2];for(let D=1;D<this._numIndexPerPrimitive;++D){O=o*c[g+D];let L=r[O],S=r[O+1],R=r[O+2];L<I&&(I=L),S<E&&(E=S),R<m&&(m=R)}I<t[0]&&(u|=1),E<t[1]&&(u|=2),m<t[2]&&(u|=4),s[f]=u,++a[u]}let n=0;for(let f=0;f<8;++f)a[f]>0&&++n;if(n<2)return;let l=new Array(8);for(let f=0;f<8;++f)l[f]=a[f]>0?new Uint32Array(a[f]):void 0;for(let f=0;f<8;++f)a[f]=0;for(let f=0;f<i;++f){let u=s[f];l[u][a[u]++]=this.primitiveIndices[f]}this._children=new Array;for(let f=0;f<8;++f)l[f]!==void 0&&this._children.push(new e(l[f],this._numIndexPerPrimitive,this.position));return this._children}static prune(){rt.prune()}},rt=new te({deallocator:null});function ye(e,t){if(!e)return!1;let{size:i,data:s,indices:a}=e;C(t,0,0,0),C(k,0,0,0);let r=0,o=0;for(let c=0;c<a.length-2;c+=3){let n=a[c]*i,l=a[c+1]*i,f=a[c+2]*i;C(w,s[n],s[n+1],s[n+2]),C(Y,s[l],s[l+1],s[l+2]),C(Tt,s[f],s[f+1],s[f+2]);let u=Ee(w,Y,Tt);u?(F(w,w,Y),F(w,w,Tt),K(w,w,1/3*u),F(t,t,w),r+=u):(F(k,k,w),F(k,k,Y),F(k,k,Tt),o+=3)}return(o!==0||r!==0)&&(r!==0?(K(t,t,1/r),!0):o!==0&&(K(t,k,1/o),!0))}function Ne(e,t){if(!e)return!1;let{size:i,data:s,indices:a}=e;C(t,0,0,0);let r=-1,o=0;for(let c=0;c<a.length;c++){let n=a[c]*i;r!==n&&(t[0]+=s[n],t[1]+=s[n+1],t[2]+=s[n+2],o++),r=n}return o>1&&K(t,t,1/o),o>0}function Se(e,t,i){if(!e)return!1;C(i,0,0,0),C(k,0,0,0);let s=0,a=0,{size:r,data:o,indices:c}=e,n=c.length-1,l=n+(t?2:0);for(let f=0;f<l;f+=2){let u=f<n?f+1:0,g=c[f<n?f:n]*r,O=c[u]*r;w[0]=o[g],w[1]=o[g+1],w[2]=o[g+2],Y[0]=o[O],Y[1]=o[O+1],Y[2]=o[O+2],K(w,F(w,w,Y),.5);let I=re(w,Y);I>0?(F(i,i,K(w,w,I)),s+=I):s===0&&(F(k,k,w),a++)}return s!==0?(K(i,i,1/s),!0):a!==0&&(K(i,k,1/a),!0)}var w=M(),Y=M(),Tt=M(),k=M();var bt=class{constructor(t){this.channel=t,this.id=ee()}};function ve(e,t){return e==null&&(e=[]),e.push(t),e}function xe(e,t){if(e==null)return null;let i=e.filter(s=>s!==t);return i.length===0?null:i}function Ds(e,t,i,s,a){It[0]=e.get(t,0),It[1]=e.get(t,1),It[2]=e.get(t,2),Le(It,ot,3),i.set(a,0,ot[0]),s.set(a,0,ot[1]),i.set(a,1,ot[2]),s.set(a,1,ot[3]),i.set(a,2,ot[4]),s.set(a,2,ot[5])}var It=M(),ot=new Float32Array(6);var De=class e extends Me{constructor(t,i,s=null,a=nt.Mesh,r=null,o=-1){super(),this.material=t,this.mapPositions=s,this.type=a,this.objectAndLayerIdColor=r,this.edgeIndicesLength=o,this.visible=!0,this._attributes=new Map,this._boundingInfo=null;for(let[c,n]of i)this._attributes.set(c,gt(At({},n),{indices:pe(n.indices)})),c===N.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._attributes.get(c).indices.length:this.edgeIndicesLength)}instantiate(t={}){let i=new e(t.material||this.material,[],this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._attributes.forEach((s,a)=>{s.exclusive=!1,i._attributes.set(a,s)}),i._boundingInfo=this._boundingInfo,i.transformation=t.transformation||this.transformation,i}get attributes(){return this._attributes}getMutableAttribute(t){let i=this._attributes.get(t);return i&&!i.exclusive&&(i=gt(At({},i),{exclusive:!0,data:Pe(i.data)}),this._attributes.set(t,i)),i}setAttributeData(t,i){let s=this._attributes.get(t);s&&this._attributes.set(t,gt(At({},s),{exclusive:!0,data:i}))}get indexCount(){return this._attributes.values().next().value.indices?.length??0}get faceCount(){return this.indexCount/3}get boundingInfo(){return this._boundingInfo==null&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(t){return!!(this.type===nt.Mesh?this._computeAttachmentOriginTriangles(t):this.type===nt.Line?this._computeAttachmentOriginLines(t):this._computeAttachmentOriginPoints(t))&&(this._transformation!=null&&ht(t,t,this._transformation),!0)}_computeAttachmentOriginTriangles(t){let i=this.attributes.get(N.POSITION);return ye(i,t)}_computeAttachmentOriginLines(t){let i=this.attributes.get(N.POSITION);return Se(i,Ke(this.material.parameters,i),t)}_computeAttachmentOriginPoints(t){let i=this.attributes.get(N.POSITION);return Ne(i,t)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){let t=this.attributes.get(N.POSITION);if(!t||t.indices.length===0)return null;let i=this.type===nt.Mesh?3:1;y(t.indices.length%i==0,"Indexing error: "+t.indices.length+" not divisible by "+i);let s=de(t.indices.length/i);return new Ot(s,i,t)}get transformation(){return this._transformation??Ut}set transformation(t){this._transformation=t&&t!==Ut?_e(t):null}addHighlight(){let t=new bt(Oe.Highlight);return this.highlights=ve(this.highlights,t),t}removeHighlight(t){this.highlights=xe(this.highlights,t)}};function Ke(e,t){return!(!("isClosed"in e)||!e.isClosed)&&t.indices.length>2}var Js=kt(G.SRC_ALPHA,G.ONE,G.ONE_MINUS_SRC_ALPHA,G.ONE_MINUS_SRC_ALPHA),Ge=kt(G.ONE,G.ZERO,G.ONE,G.ONE_MINUS_SRC_ALPHA);function ti(e){return e===lt.FrontFace?null:Ge}function ei(e){return e===lt.FrontFace?Re:null}var si=5e5,Qe={factor:-1,units:-2};function ii(e){return e?Qe:null}function ni(e,t=H.LESS){return e===lt.NONE||e===lt.FrontFace?t:H.LEQUAL}function ri(e){return e===lt.ColorAlpha?{buffers:[zt.COLOR_ATTACHMENT0,zt.COLOR_ATTACHMENT1]}:null}var jt=class{constructor(t=!1,i=!0){this.isVerticalRay=t,this.normalRequired=i}},Mt=fe();function mi(e,t,i,s,a,r){if(!e.visible)return;let o=$(Ce,s,i),c=(l,f,u)=>{r(l,u,f,!1)},n=new jt(!1,t.options.normalRequired);if(e.boundingInfo){y(e.type===nt.Mesh);let l=t.tolerance;Ve(e.boundingInfo,i,o,l,a,n,c)}else{let l=e.attributes.get(N.POSITION),f=l.indices;Be(i,o,0,f.length/3,f,l.data,l.stride,a,n,c)}}var Ye=M();function Ve(e,t,i,s,a,r,o){if(e==null)return;let c=ss(i,Ye);if(ce(Mt,e.bbMin),le(Mt,e.bbMax),a?.applyToAabb(Mt),is(Mt,t,c,s)){let{primitiveIndices:n,position:l}=e,f=n?n.length:l.indices.length/3;if(f>rs){let u=e.getChildren();if(u!==void 0){for(let g of u)Ve(g,t,i,s,a,r,o);return}}Xe(t,i,0,f,l.indices,l.data,l.stride,n,a,r,o)}}var pt=M();function pi(e,t,i,s,a,r,o,c,n){let{data:l,stride:f}=r;Be(e,$(Ce,t,e),i,s,a,l,f,o,c,n)}function Xe(e,t,i,s,a,r,o,c,n,l,f){let u=e[0],g=e[1],O=e[2],I=t[0],E=t[1],m=t[2],{normalRequired:D}=l;for(let L=i;L<s;++L){let S=c[L],R=3*S,V=o*a[R],v=r[V],d=r[V+1],p=r[V+2],T=o*a[R+1],b=r[T],h=r[T+1],A=r[T+2],_=o*a[R+2],P=r[_],x=r[_+1],B=r[_+2];n!=null&&([v,d,p]=n.applyToVertex(v,d,p,L),[b,h,A]=n.applyToVertex(b,h,A,L),[P,x,B]=n.applyToVertex(P,x,B,L));let z=b-v,Z=h-d,J=A-p,tt=P-v,et=x-d,q=B-p,st=E*q-et*m,it=m*tt-q*I,at=I*et-tt*E,j=z*st+Z*it+J*at;if(Math.abs(j)<=os)continue;let ft=u-v,Rt=g-d,Pt=O-p,ct=ft*st+Rt*it+Pt*at;if(j>0){if(ct<0||ct>j)continue}else if(ct>0||ct<j)continue;let Gt=Rt*J-Z*Pt,Qt=Pt*z-J*ft,Yt=ft*Z-z*Rt,dt=I*Gt+E*Qt+m*Yt;if(j>0){if(dt<0||ct+dt>j)continue}else if(dt>0||ct+dt<j)continue;let Xt=(tt*Gt+et*Qt+q*Yt)/j;Xt>=0&&f(Xt,S,D?ts(z,Z,J,tt,et,q,pt):null)}}function Be(e,t,i,s,a,r,o,c,n,l){let f=t,u=as,g=Math.abs(f[0]),O=Math.abs(f[1]),I=Math.abs(f[2]),E=g>=O?g>=I?0:2:O>=I?1:2,m=E,D=f[m]<0?2:1,L=(E+D)%3,S=(E+(3-D))%3,R=f[L]/f[m],V=f[S]/f[m],v=1/f[m],d=$e,p=Ze,T=Je,{normalRequired:b}=n;for(let h=i;h<s;++h){let A=3*h,_=o*a[A];C(u[0],r[_+0],r[_+1],r[_+2]);let P=o*a[A+1];C(u[1],r[P+0],r[P+1],r[P+2]);let x=o*a[A+2];C(u[2],r[x+0],r[x+1],r[x+2]),c&&(_t(u[0],c.applyToVertex(u[0][0],u[0][1],u[0][2],h)),_t(u[1],c.applyToVertex(u[1][0],u[1][1],u[1][2],h)),_t(u[2],c.applyToVertex(u[2][0],u[2][1],u[2][2],h))),$(d,u[0],e),$(p,u[1],e),$(T,u[2],e);let B=d[L]-R*d[m],z=d[S]-V*d[m],Z=p[L]-R*p[m],J=p[S]-V*p[m],tt=T[L]-R*T[m],et=T[S]-V*T[m],q=tt*J-et*Z,st=B*et-z*tt,it=Z*z-J*B;if((q<0||st<0||it<0)&&(q>0||st>0||it>0))continue;let at=q+st+it;if(at===0)continue;let j=q*(v*d[m])+st*(v*p[m])+it*(v*T[m]);if(j*Math.sign(at)<0)continue;let ft=j/at;ft>=0&&l(ft,h,b?es(u):null)}}var $e=M(),Ze=M(),Je=M();function ts(e,t,i,s,a,r,o){return C(Et,e,t,i),C(Lt,s,a,r),Nt(o,Et,Lt),yt(o,o),o}function es(e){return $(Et,e[1],e[0]),$(Lt,e[2],e[0]),Nt(pt,Et,Lt),yt(pt,pt),pt}var Et=M(),Lt=M();function ss(e,t){return C(t,1/e[0],1/e[1],1/e[2])}function is(e,t,i,s){return ns(e,t,i,s,1/0)}function ns(e,t,i,s,a){let r=(e[0]-s-t[0])*i[0],o=(e[3]+s-t[0])*i[0],c=Math.min(r,o),n=Math.max(r,o),l=(e[1]-s-t[1])*i[1],f=(e[4]+s-t[1])*i[1];if(n=Math.min(n,Math.max(l,f)),n<0||(c=Math.max(c,Math.min(l,f)),c>n))return!1;let u=(e[2]-s-t[2])*i[2],g=(e[5]+s-t[2])*i[2];return n=Math.min(n,Math.max(u,g)),!(n<0)&&(c=Math.max(c,Math.min(u,g)),!(c>n)&&c<a)}var rs=1e3,os=1e-7,Ce=M(),as=[M(),M(),M()];var we;(function(e){e[e.INTEGRATED_MESH=0]="INTEGRATED_MESH",e[e.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",e[e.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",e[e.OPAQUE_NO_SSAO_DEPTH=3]="OPAQUE_NO_SSAO_DEPTH",e[e.TRANSPARENT_MATERIAL=4]="TRANSPARENT_MATERIAL",e[e.TRANSPARENT_NO_SSAO_DEPTH=5]="TRANSPARENT_NO_SSAO_DEPTH",e[e.TRANSPARENT_TERRAIN=6]="TRANSPARENT_TERRAIN",e[e.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=7]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",e[e.OCCLUDED_TERRAIN=8]="OCCLUDED_TERRAIN",e[e.OCCLUDER_MATERIAL=9]="OCCLUDER_MATERIAL",e[e.TRANSPARENT_OCCLUDER_MATERIAL=10]="TRANSPARENT_OCCLUDER_MATERIAL",e[e.OCCLUSION_PIXELS=11]="OCCLUSION_PIXELS",e[e.OPAQUE_ENVIRONMENT=12]="OPAQUE_ENVIRONMENT",e[e.TRANSPARENT_ENVIRONMENT=13]="TRANSPARENT_ENVIRONMENT",e[e.LASERLINES=14]="LASERLINES",e[e.LASERLINES_CONTRAST_CONTROL=15]="LASERLINES_CONTRAST_CONTROL",e[e.HUD_MATERIAL=16]="HUD_MATERIAL",e[e.LABEL_MATERIAL=17]="LABEL_MATERIAL",e[e.LINE_CALLOUTS=18]="LINE_CALLOUTS",e[e.LINE_CALLOUTS_HUD_DEPTH=19]="LINE_CALLOUTS_HUD_DEPTH",e[e.DRAPED_MATERIAL=20]="DRAPED_MATERIAL",e[e.DRAPED_WATER=21]="DRAPED_WATER",e[e.VIEWSHED=22]="VIEWSHED",e[e.VOXEL=23]="VOXEL",e[e.MAX_SLOTS=24]="MAX_SLOTS"})(we||(we={}));var ze=class{constructor(){this._transform=mt(),this._transformInverse=new ut({value:this._transform},oe,mt),this._transformInverseTranspose=new ut(this._transformInverse,xt,mt),this._transformTranspose=new ut({value:this._transform},xt,mt),this._transformInverseRotation=new ut({value:this._transform},Ae,ge)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(t){vt(this._transform,t)}multiplyTransform(t){ae(this._transform,this._transform,t)}set(t){vt(this._transform,t),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(t,i){this.setTransformMatrix(t),this.multiplyTransform(i),this._invalidateLazyTransforms()}},ut=class{constructor(t,i,s){this._original=t,this._update=i,this._dirty=!0,this._transform=s()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}},Ht=class{constructor(t=0){this.offset=t,this.tmpVertex=M()}applyToVertex(t,i,s){let a=C(Kt,t,i,s),r=F(Fe,a,this.localOrigin),o=this.offset/W(r);return X(this.tmpVertex,a,r,o),this.tmpVertex}applyToAabb(t){let i=fs,s=cs,a=ls;for(let n=0;n<3;++n)i[n]=t[0+n]+this.localOrigin[n],s[n]=t[3+n]+this.localOrigin[n],a[n]=i[n];let r=this.applyToVertex(i[0],i[1],i[2]);for(let n=0;n<3;++n)t[n]=r[n],t[n+3]=r[n];let o=n=>{let l=this.applyToVertex(n[0],n[1],n[2]);for(let f=0;f<3;++f)t[f]=Math.min(t[f],l[f]),t[f+3]=Math.max(t[f+3],l[f])};for(let n=1;n<8;++n){for(let l=0;l<3;++l)a[l]=n&1<<l?s[l]:i[l];o(a)}let c=0;for(let n=0;n<3;++n)i[n]*s[n]<0&&(c|=1<<n);if(c!==0&&c!==7){for(let n=0;n<8;++n)if(!(c&n)){for(let l=0;l<3;++l)a[l]=c&1<<l?0:n&1<<l?i[l]:s[l];o(a)}}for(let n=0;n<3;++n)t[n]-=this.localOrigin[n],t[n+3]-=this.localOrigin[n];return t}},qt=class{constructor(t=0){this.componentLocalOriginLength=0,this._totalOffset=0,this._offset=0,this._tmpVertex=M(),this._tmpMbs=Ft(),this._tmpObb=new be,this._resetOffset(t)}_resetOffset(t){this._offset=t,this._totalOffset=t}set offset(t){this._resetOffset(t)}get offset(){return this._offset}set componentOffset(t){this._totalOffset=this._offset+t}set localOrigin(t){this.componentLocalOriginLength=W(t)}applyToVertex(t,i,s){let a=C(Kt,t,i,s),r=C(Fe,t,i,s+this.componentLocalOriginLength),o=this._totalOffset/W(r);return X(this._tmpVertex,a,r,o),this._tmpVertex}applyToAabb(t){let i=this.componentLocalOriginLength,s=t[0],a=t[1],r=t[2]+i,o=t[3],c=t[4],n=t[5]+i,l=Math.abs(s),f=Math.abs(a),u=Math.abs(r),g=Math.abs(o),O=Math.abs(c),I=Math.abs(n),E=.5*(1+Math.sign(s*o))*Math.min(l,g),m=.5*(1+Math.sign(a*c))*Math.min(f,O),D=.5*(1+Math.sign(r*n))*Math.min(u,I),L=Math.max(l,g),S=Math.max(f,O),R=Math.max(u,I),V=Math.sqrt(E*E+m*m+D*D),v=Math.sign(l+s),d=Math.sign(f+a),p=Math.sign(u+r),T=Math.sign(g+o),b=Math.sign(O+c),h=Math.sign(I+n),A=this._totalOffset;if(V<A)return t[0]-=(1-v)*A,t[1]-=(1-d)*A,t[2]-=(1-p)*A,t[3]+=T*A,t[4]+=b*A,t[5]+=h*A,t;let _=A/Math.sqrt(L*L+S*S+R*R),P=A/V,x=P-_,B=-x;return t[0]+=s*(v*B+P),t[1]+=a*(d*B+P),t[2]+=r*(p*B+P),t[3]+=o*(T*x+_),t[4]+=c*(b*x+_),t[5]+=n*(h*x+_),t}applyToMbs(t){let i=W(t),s=this._totalOffset/i;return X(this._tmpMbs,t,t,s),this._tmpMbs[3]=t[3]+t[3]*this._totalOffset/i,this._tmpMbs}applyToObb(t){return Ie(t,this._totalOffset,this._totalOffset,Te.Global,this._tmpObb),this._tmpObb}},Wt=class{constructor(t=0){this.offset=t,this.sphere=Ft(),this.tmpVertex=M()}applyToVertex(t,i,s){let a=this.objectTransform.transform,r=C(Kt,t,i,s),o=ht(r,r,a),c=this.offset/W(o);X(o,o,o,c);let n=this.objectTransform.inverse;return ht(this.tmpVertex,o,n),this.tmpVertex}applyToMinMax(t,i){let s=this.offset/W(t);X(t,t,t,s);let a=this.offset/W(i);X(i,i,i,a)}applyToAabb(t){let i=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*i,t[1]+=t[1]*i,t[2]+=t[2]*i;let s=this.offset/Math.sqrt(t[3]*t[3]+t[4]*t[4]+t[5]*t[5]);return t[3]+=t[3]*s,t[4]+=t[4]*s,t[5]+=t[5]*s,t}applyToBoundingSphere(t){let i=W(t),s=this.offset/i;return X(this.sphere,t,t,s),this.sphere[3]=t[3]+t[3]*this.offset/i,this.sphere}},Ue=new Wt;function Pi(e){return e!=null?(Ue.offset=e,Ue):null}var yi=new qt;var Ni=new Ht;var Si="terrain",Kt=M(),Fe=M(),fs=M(),cs=M(),ls=M();function Ci(e,t,i,s=1){let{data:a,indices:r}=e,o=t.typedBuffer,c=t.typedBufferStride,n=r.length;if(i*=c,s===1)for(let l=0;l<n;++l)o[i]=a[r[l]],i+=c;else for(let l=0;l<n;++l){let f=a[r[l]];for(let u=0;u<s;u++)o[i]=f,i+=c}}function ke(e,t,i){let{data:s,indices:a}=e,r=t.typedBuffer,o=t.typedBufferStride,c=a.length;i*=o;for(let n=0;n<c;++n){let l=2*a[n];r[i]=s[l],r[i+1]=s[l+1],i+=o}}function je(e,t,i,s){let{data:a,indices:r}=e,o=t.typedBuffer,c=t.typedBufferStride,n=r.length;if(i*=c,s==null||s===1)for(let l=0;l<n;++l){let f=3*r[l];o[i]=a[f],o[i+1]=a[f+1],o[i+2]=a[f+2],i+=c}else for(let l=0;l<n;++l){let f=3*r[l];for(let u=0;u<s;++u)o[i]=a[f],o[i+1]=a[f+1],o[i+2]=a[f+2],i+=c}}function He(e,t,i,s=1){let{data:a,indices:r}=e,o=t.typedBuffer,c=t.typedBufferStride,n=r.length;if(i*=c,s===1)for(let l=0;l<n;++l){let f=4*r[l];o[i]=a[f],o[i+1]=a[f+1],o[i+2]=a[f+2],o[i+3]=a[f+3],i+=c}else for(let l=0;l<n;++l){let f=4*r[l];for(let u=0;u<s;++u)o[i]=a[f],o[i+1]=a[f+1],o[i+2]=a[f+2],o[i+3]=a[f+3],i+=c}}function wi(e,t,i){let s=e.typedBuffer,a=e.typedBufferStride;t*=a;for(let r=0;r<i;++r)s[t]=0,s[t+1]=0,s[t+2]=0,s[t+3]=0,t+=a}function us(e,t,i,s,a=1){if(!t)return void je(e,i,s,a);let{data:r,indices:o}=e,c=i.typedBuffer,n=i.typedBufferStride,l=o.length,f=t[0],u=t[1],g=t[2],O=t[4],I=t[5],E=t[6],m=t[8],D=t[9],L=t[10],S=t[12],R=t[13],V=t[14];s*=n;let v=0,d=0,p=0,T=Vt(t)?b=>{v=r[b]+S,d=r[b+1]+R,p=r[b+2]+V}:b=>{let h=r[b],A=r[b+1],_=r[b+2];v=f*h+O*A+m*_+S,d=u*h+I*A+D*_+R,p=g*h+E*A+L*_+V};if(a===1)for(let b=0;b<l;++b)T(3*o[b]),c[s]=v,c[s+1]=d,c[s+2]=p,s+=n;else for(let b=0;b<l;++b){T(3*o[b]);for(let h=0;h<a;++h)c[s]=v,c[s+1]=d,c[s+2]=p,s+=n}}function hs(e,t,i,s,a=1){if(!t)return void je(e,i,s,a);let{data:r,indices:o}=e,c=t,n=i.typedBuffer,l=i.typedBufferStride,f=o.length,u=c[0],g=c[1],O=c[2],I=c[4],E=c[5],m=c[6],D=c[8],L=c[9],S=c[10],R=!Dt(c),V=1e-6,v=1-V;s*=l;let d=0,p=0,T=0,b=Vt(c)?h=>{d=r[h],p=r[h+1],T=r[h+2]}:h=>{let A=r[h],_=r[h+1],P=r[h+2];d=u*A+I*_+D*P,p=g*A+E*_+L*P,T=O*A+m*_+S*P};if(a===1)if(R)for(let h=0;h<f;++h){b(3*o[h]);let A=d*d+p*p+T*T;if(A<v&&A>V){let _=1/Math.sqrt(A);n[s]=d*_,n[s+1]=p*_,n[s+2]=T*_}else n[s]=d,n[s+1]=p,n[s+2]=T;s+=l}else for(let h=0;h<f;++h)b(3*o[h]),n[s]=d,n[s+1]=p,n[s+2]=T,s+=l;else for(let h=0;h<f;++h){if(b(3*o[h]),R){let A=d*d+p*p+T*T;if(A<v&&A>V){let _=1/Math.sqrt(A);d*=_,p*=_,T*=_}}for(let A=0;A<a;++A)n[s]=d,n[s+1]=p,n[s+2]=T,s+=l}}function ms(e,t,i,s,a=1){if(!t)return void He(e,i,s,a);let{data:r,indices:o}=e,c=t,n=i.typedBuffer,l=i.typedBufferStride,f=o.length,u=c[0],g=c[1],O=c[2],I=c[4],E=c[5],m=c[6],D=c[8],L=c[9],S=c[10],R=!Dt(c),V=1e-6,v=1-V;if(s*=l,a===1)for(let d=0;d<f;++d){let p=4*o[d],T=r[p],b=r[p+1],h=r[p+2],A=r[p+3],_=u*T+I*b+D*h,P=g*T+E*b+L*h,x=O*T+m*b+S*h;if(R){let B=_*_+P*P+x*x;if(B<v&&B>V){let z=1/Math.sqrt(B);_*=z,P*=z,x*=z}}n[s]=_,n[s+1]=P,n[s+2]=x,n[s+3]=A,s+=l}else for(let d=0;d<f;++d){let p=4*o[d],T=r[p],b=r[p+1],h=r[p+2],A=r[p+3],_=u*T+I*b+D*h,P=g*T+E*b+L*h,x=O*T+m*b+S*h;if(R){let B=_*_+P*P+x*x;if(B<v&&B>V){let z=1/Math.sqrt(B);_*=z,P*=z,x*=z}}for(let B=0;B<a;++B)n[s]=_,n[s+1]=P,n[s+2]=x,n[s+3]=A,s+=l}}function ps(e,t,i,s,a=1){let{data:r,indices:o}=e,c=i.typedBuffer,n=i.typedBufferStride,l=o.length;if(s*=n,t!==r.length||t!==4)if(a!==1)if(t!==4)for(let f=0;f<l;++f){let u=3*o[f];for(let g=0;g<a;++g)c[s]=r[u],c[s+1]=r[u+1],c[s+2]=r[u+2],c[s+3]=255,s+=n}else for(let f=0;f<l;++f){let u=4*o[f];for(let g=0;g<a;++g)c[s]=r[u],c[s+1]=r[u+1],c[s+2]=r[u+2],c[s+3]=r[u+3],s+=n}else{if(t===4){for(let f=0;f<l;++f){let u=4*o[f];c[s]=r[u],c[s+1]=r[u+1],c[s+2]=r[u+2],c[s+3]=r[u+3],s+=n}return}for(let f=0;f<l;++f){let u=3*o[f];c[s]=r[u],c[s+1]=r[u+1],c[s+2]=r[u+2],c[s+3]=255,s+=n}}else{c[s]=r[0],c[s+1]=r[1],c[s+2]=r[2],c[s+3]=r[3];let f=new Uint32Array(i.typedBuffer.buffer,i.start),u=n/4,g=f[s/=4];s+=u;let O=l*a;for(let I=1;I<O;++I)f[s]=g,s+=u}}function ds(e,t,i){let{data:s,indices:a}=e,r=t.typedBuffer,o=t.typedBufferStride,c=a.length,n=s[0];i*=o;for(let l=0;l<c;++l)r[i]=n,i+=o}function As(e,t,i,s,a=1){let r=t.typedBuffer,o=t.typedBufferStride;if(s*=o,a===1)for(let c=0;c<i;++c)r[s]=e[0],r[s+1]=e[1],r[s+2]=e[2],r[s+3]=e[3],s+=o;else for(let c=0;c<i;++c)for(let n=0;n<a;++n)r[s]=e[0],r[s+1]=e[1],r[s+2]=e[2],r[s+3]=e[3],s+=o}function qe(e,t,i,s,a,r){for(let o of t.fields.keys()){let c=e.attributes.get(o),n=c?.indices;if(c&&n)gs(o,c,i,s,a,r);else if(o===N.OBJECTANDLAYERIDCOLOR&&e.objectAndLayerIdColor!=null){let l=e.attributes.get(N.POSITION)?.indices;if(l){let f=l.length,u=a.getField(o,wt);As(e.objectAndLayerIdColor,u,f,r)}}}}function gs(e,t,i,s,a,r){switch(e){case N.POSITION:{y(t.size===3);let o=a.getField(e,Bt);y(!!o,`No buffer view for ${e}`),o&&us(t,i,o,r);break}case N.NORMAL:{y(t.size===3);let o=a.getField(e,Bt);y(!!o,`No buffer view for ${e}`),o&&hs(t,s,o,r);break}case N.NORMALCOMPRESSED:{y(t.size===2);let o=a.getField(e,me);y(!!o,`No buffer view for ${e}`),o&&ke(t,o,r);break}case N.UV0:{y(t.size===2);let o=a.getField(e,he);y(!!o,`No buffer view for ${e}`),o&&ke(t,o,r);break}case N.COLOR:case N.SYMBOLCOLOR:{let o=a.getField(e,wt);y(!!o,`No buffer view for ${e}`),y(t.size===3||t.size===4),!o||t.size!==3&&t.size!==4||ps(t,t.size,o,r);break}case N.COLORFEATUREATTRIBUTE:{let o=a.getField(e,ue);y(!!o,`No buffer view for ${e}`),y(t.size===1),o&&t.size===1&&ds(t,o,r);break}case N.TANGENT:{y(t.size===4);let o=a.getField(e,Ct);y(!!o,`No buffer view for ${e}`),o&&ms(t,i,o,r);break}case N.PROFILERIGHT:case N.PROFILEUP:case N.PROFILEVERTEXANDNORMAL:case N.FEATUREVALUE:{y(t.size===4);let o=a.getField(e,Ct);y(!!o,`No buffer view for ${e}`),o&&He(t,o,r)}}}var We=class{constructor(t){this.vertexBufferLayout=t}elementCount(t){return t.attributes.get(N.POSITION).indices.length}write(t,i,s,a,r){qe(s,this.vertexBufferLayout,t,i,a,r)}};var qi={func:H.LESS},Wi={func:H.ALWAYS},Ki={mask:255},Gi={mask:0};var Qi={function:{func:H.ALWAYS,ref:Q.OutlineVisualElementMask,mask:Q.OutlineVisualElementMask},operation:{fail:U.KEEP,zFail:U.KEEP,zPass:U.ZERO}},Yi={function:{func:H.ALWAYS,ref:Q.OutlineVisualElementMask,mask:Q.OutlineVisualElementMask},operation:{fail:U.KEEP,zFail:U.KEEP,zPass:U.REPLACE}},Xi={function:{func:H.EQUAL,ref:Q.OutlineVisualElementMask,mask:Q.OutlineVisualElementMask},operation:{fail:U.KEEP,zFail:U.KEEP,zPass:U.KEEP}},$i={function:{func:H.NOTEQUAL,ref:Q.OutlineVisualElementMask,mask:Q.OutlineVisualElementMask},operation:{fail:U.KEEP,zFail:U.KEEP,zPass:U.KEEP}};export{bt as a,ve as b,xe as c,Ds as d,De as e,Js as f,ti as g,ei as h,si as i,Qe as j,ii as k,ni as l,ri as m,jt as n,mi as o,pi as p,is as q,we as r,ze as s,Pi as t,Si as u,Ci as v,He as w,wi as x,us as y,hs as z,ps as A,As as B,qe as C,gs as D,We as E,qi as F,Wi as G,Ki as H,Gi as I,Qi as J,Yi as K,Xi as L,$i as M};
