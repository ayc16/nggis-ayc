import{a as L,b as st}from"./chunk-KWPZPKEZ.js";import{a as rt}from"./chunk-GEDCZS6Y.js";import{a as F}from"./chunk-WB63P7CN.js";import{e as nt}from"./chunk-ZREXZJBZ.js";import{a as v}from"./chunk-I46GU3Q4.js";import{a as w}from"./chunk-H5IJXG2U.js";import{a as tt,c as et}from"./chunk-TCQOV56D.js";import{b as it,c as k}from"./chunk-BVW6ULEA.js";import{C as X,D as V,E as Z,K as $,a as g,b as S,c as K,j as Q,l as O,m as _,n as U,u as x,x as W}from"./chunk-ES7AH7WX.js";import{z as J}from"./chunk-VWEBO6QK.js";import{s as G}from"./chunk-KAAR5ZJN.js";import{D as Y,G as q,y as R}from"./chunk-IQJU4QT3.js";import{a as E,b as C}from"./chunk-EAH6BNBL.js";function at(n){if(n.length<q)return Array.from(n);if(Y(n))return Float64Array.from(n);if(!("BYTES_PER_ELEMENT"in n))return Array.from(n);switch(n.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(n);case 2:return R(n)?Uint16Array.from(n):Int16Array.from(n);case 4:return Float32Array.from(n);default:return Float64Array.from(n)}}var z=class n{constructor(t,i,s){this.primitiveIndices=t,this._numIndexPerPrimitive=i,this.position=s,this._children=void 0,v(t.length>=1),v(s.size===3||s.size===4);let{data:a,size:c,indices:o}=s;v(o.length%this._numIndexPerPrimitive==0),v(o.length>=t.length*this._numIndexPerPrimitive);let h=t.length,r=c*o[this._numIndexPerPrimitive*t[0]];y.clear(),y.push(r);let u=K(a[r],a[r+1],a[r+2]),e=S(u);for(let f=0;f<h;++f){let p=this._numIndexPerPrimitive*t[f];for(let I=0;I<this._numIndexPerPrimitive;++I){r=c*o[p+I],y.push(r);let d=a[r];u[0]=Math.min(d,u[0]),e[0]=Math.max(d,e[0]),d=a[r+1],u[1]=Math.min(d,u[1]),e[1]=Math.max(d,e[1]),d=a[r+2],u[2]=Math.min(d,u[2]),e[2]=Math.max(d,e[2])}}this.bbMin=u,this.bbMax=e;let m=V(g(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(e[0]-u[0],e[1]-u[1]),e[2]-u[2]);let A=this.radius*this.radius;for(let f=0;f<y.length;++f){r=y.at(f);let p=a[r]-m[0],I=a[r+1]-m[1],d=a[r+2]-m[2],M=p*p+I*I+d*d;if(M<=A)continue;let j=Math.sqrt(M),T=.5*(j-this.radius);this.radius=this.radius+T,A=this.radius*this.radius;let D=T/j;m[0]+=p*D,m[1]+=I*D,m[2]+=d*D}this.center=m,y.clear()}getChildren(){if(this._children||W(this.bbMin,this.bbMax)<=1)return this._children;let t=V(g(),this.bbMin,this.bbMax,.5),i=this.primitiveIndices.length,s=new Uint8Array(i),a=new Array(8);for(let e=0;e<8;++e)a[e]=0;let{data:c,size:o,indices:h}=this.position;for(let e=0;e<i;++e){let m=0,A=this._numIndexPerPrimitive*this.primitiveIndices[e],f=o*h[A],p=c[f],I=c[f+1],d=c[f+2];for(let M=1;M<this._numIndexPerPrimitive;++M){f=o*h[A+M];let j=c[f],T=c[f+1],D=c[f+2];j<p&&(p=j),T<I&&(I=T),D<d&&(d=D)}p<t[0]&&(m|=1),I<t[1]&&(m|=2),d<t[2]&&(m|=4),s[e]=m,++a[m]}let r=0;for(let e=0;e<8;++e)a[e]>0&&++r;if(r<2)return;let u=new Array(8);for(let e=0;e<8;++e)u[e]=a[e]>0?new Uint32Array(a[e]):void 0;for(let e=0;e<8;++e)a[e]=0;for(let e=0;e<i;++e){let m=s[e];u[m][a[m]++]=this.primitiveIndices[e]}this._children=new Array;for(let e=0;e<8;++e)u[e]!==void 0&&this._children.push(new n(u[e],this._numIndexPerPrimitive,this.position));return this._children}static prune(){y.prune()}},y=new G({deallocator:null});function gt(n){return n?{p0:S(n.p0),p1:S(n.p1),p2:S(n.p2)}:{p0:g(),p1:g(),p2:g()}}function ct(n,t,i){return U(H,t,n),U(ot,i,n),.5*Q(X(H,H,ot))}var Ct=new F(rt),zt=new F(()=>gt()),H=g(),ot=g();function ht(n,t){if(!n)return!1;let{size:i,data:s,indices:a}=n;O(t,0,0,0),O(b,0,0,0);let c=0,o=0;for(let h=0;h<a.length-2;h+=3){let r=a[h]*i,u=a[h+1]*i,e=a[h+2]*i;O(l,s[r],s[r+1],s[r+2]),O(P,s[u],s[u+1],s[u+2]),O(N,s[e],s[e+1],s[e+2]);let m=ct(l,P,N);m?(_(l,l,P),_(l,l,N),x(l,l,1/3*m),_(t,t,l),c+=m):(_(b,b,l),_(b,b,P),_(b,b,N),o+=3)}return(o!==0||c!==0)&&(c!==0?(x(t,t,1/c),!0):o!==0&&(x(t,b,1/o),!0))}function ut(n,t){if(!n)return!1;let{size:i,data:s,indices:a}=n;O(t,0,0,0);let c=-1,o=0;for(let h=0;h<a.length;h++){let r=a[h]*i;c!==r&&(t[0]+=s[r],t[1]+=s[r+1],t[2]+=s[r+2],o++),c=r}return o>1&&x(t,t,1/o),o>0}function mt(n,t,i){if(!n)return!1;O(i,0,0,0),O(b,0,0,0);let s=0,a=0,{size:c,data:o,indices:h}=n,r=h.length-1,u=r+(t?2:0);for(let e=0;e<u;e+=2){let m=e<r?e+1:0,A=h[e<r?e:r]*c,f=h[m]*c;l[0]=o[A],l[1]=o[A+1],l[2]=o[A+2],P[0]=o[f],P[1]=o[f+1],P[2]=o[f+2],x(l,_(l,l,P),.5);let p=$(l,P);p>0?(_(i,i,x(l,l,p)),s+=p):s===0&&(_(b,b,l),a++)}return s!==0?(x(i,i,1/s),!0):a!==0&&(x(i,b,1/a),!0)}var l=g(),P=g(),N=g(),b=g();var B=class{constructor(t){this.channel=t,this.id=J()}};function lt(n,t){return n==null&&(n=[]),n.push(t),n}function ft(n,t){if(n==null)return null;let i=n.filter(s=>s!==t);return i.length===0?null:i}var Gt=g(),Jt=new Float32Array(6);var dt=class n extends st{constructor(t,i,s=null,a=L.Mesh,c=null,o=-1){super(),this.material=t,this.mapPositions=s,this.type=a,this.objectAndLayerIdColor=c,this.edgeIndicesLength=o,this.visible=!0,this._attributes=new Map,this._boundingInfo=null;for(let[h,r]of i)this._attributes.set(h,C(E({},r),{indices:tt(r.indices)})),h===w.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._attributes.get(h).indices.length:this.edgeIndicesLength)}instantiate(t={}){let i=new n(t.material||this.material,[],this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._attributes.forEach((s,a)=>{s.exclusive=!1,i._attributes.set(a,s)}),i._boundingInfo=this._boundingInfo,i.transformation=t.transformation||this.transformation,i}get attributes(){return this._attributes}getMutableAttribute(t){let i=this._attributes.get(t);return i&&!i.exclusive&&(i=C(E({},i),{exclusive:!0,data:at(i.data)}),this._attributes.set(t,i)),i}setAttributeData(t,i){let s=this._attributes.get(t);s&&this._attributes.set(t,C(E({},s),{exclusive:!0,data:i}))}get indexCount(){return this._attributes.values().next().value.indices?.length??0}get faceCount(){return this.indexCount/3}get boundingInfo(){return this._boundingInfo==null&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(t){return!!(this.type===L.Mesh?this._computeAttachmentOriginTriangles(t):this.type===L.Line?this._computeAttachmentOriginLines(t):this._computeAttachmentOriginPoints(t))&&(this._transformation!=null&&Z(t,t,this._transformation),!0)}_computeAttachmentOriginTriangles(t){let i=this.attributes.get(w.POSITION);return ht(i,t)}_computeAttachmentOriginLines(t){let i=this.attributes.get(w.POSITION);return mt(i,pt(this.material.parameters,i),t)}_computeAttachmentOriginPoints(t){let i=this.attributes.get(w.POSITION);return ut(i,t)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){let t=this.attributes.get(w.POSITION);if(!t||t.indices.length===0)return null;let i=this.type===L.Mesh?3:1;v(t.indices.length%i==0,"Indexing error: "+t.indices.length+" not divisible by "+i);let s=et(t.indices.length/i);return new z(s,i,t)}get transformation(){return this._transformation??k}set transformation(t){this._transformation=t&&t!==k?it(t):null}addHighlight(){let t=new B(nt.Highlight);return this.highlights=lt(this.highlights,t),t}removeHighlight(t){this.highlights=ft(this.highlights,t)}};function pt(n,t){return!(!("isClosed"in n)||!n.isClosed)&&t.indices.length>2}export{dt as a};
