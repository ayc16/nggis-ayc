import{d as w,e as rt}from"./chunk-5NHMASEK.js";import{p as D,q as st}from"./chunk-3K3SLH5Z.js";import{l as A,w as ot}from"./chunk-CDCW33GU.js";import{c as at}from"./chunk-LQWMDYLF.js";import{a as it}from"./chunk-J7IKN4ZN.js";import{c as et,e as nt}from"./chunk-OJB2TSJ7.js";import{h as C}from"./chunk-7G4KK3KW.js";import{a as $}from"./chunk-4XUOIGFO.js";import{d as tt}from"./chunk-AM3VOA32.js";import{b as O}from"./chunk-76YVRX2R.js";import{b as Q}from"./chunk-SF6Z2K5H.js";import{L as d,O as K}from"./chunk-AUTL5LCV.js";import{S as J}from"./chunk-KUJG22IX.js";import{a as c}from"./chunk-W3WDPWBE.js";import{B as Y,C as B,t as X}from"./chunk-GISCFF3Z.js";import{d as L,e as q}from"./chunk-MLSR6YE6.js";import{b as V}from"./chunk-HQMV3KQV.js";import{q as j}from"./chunk-CRMMDK2Z.js";import{a as h,b as v,h as W}from"./chunk-EAH6BNBL.js";var y,lt,ut;(function(t){t[t.USER=0]="USER",t[t.MANAGER=1]="MANAGER"})(y||(y={})),function(t){t[t.None=0]="None",t[t.Unfocused=1]="Unfocused",t[t.Focused=2]="Focused",t[t.Unselected=4]="Unselected",t[t.Selected=8]="Selected",t[t.All=15]="All"}(lt||(lt={})),function(t){t[t.None=0]="None",t[t.Custom1=16]="Custom1",t[t.Custom2=32]="Custom2",t[t.Custom3=64]="Custom3",t[t.Custom4=128]="Custom4",t[t.Custom5=256]="Custom5",t[t.Custom6=512]="Custom6",t[t.Custom7=1024]="Custom7",t[t.Custom8=2048]="Custom8",t[t.Custom9=4096]="Custom9",t[t.Custom10=8192]="Custom10",t[t.Custom11=16384]="Custom11",t[t.Custom12=32768]="Custom12",t[t.All=65520]="All"}(ut||(ut={}));var E;(function(t){t[t.WhenToolEditable=0]="WhenToolEditable",t[t.WhenToolNotEditable=1]="WhenToolNotEditable",t[t.Always=2]="Always"})(E||(E={}));var T=class{constructor(){this._isToolEditable=!0,this._manipulators=new Q,this._resourceContexts={manipulator3D:{}},this._attached=!1}set isToolEditable(n){this._isToolEditable=n}get length(){return this._manipulators.length}add(n,e=E.WhenToolEditable){this.addMany([n],e)}addMany(n,e=E.WhenToolEditable){for(let a of n){let i={manipulator:a,visibilityPredicate:e,attached:!1};this._manipulators.add(i),this._attached&&this._updateManipulatorAttachment(i)}}remove(n){for(let e=0;e<this._manipulators.length;e++)if(this._manipulators.at(e).manipulator===n){let a=this._manipulators.splice(e,1)[0];this._detachManipulator(a);break}}removeAll(){this._manipulators.forEach(n=>{this._detachManipulator(n)}),this._manipulators.removeAll()}attach(){this._manipulators.forEach(n=>{this._updateManipulatorAttachment(n)}),this._attached=!0}detach(){this._manipulators.forEach(n=>{this._detachManipulator(n)}),this._attached=!1}destroy(){this.detach(),this._manipulators.forEach(({manipulator:n})=>n.destroy()),this._manipulators.destroy(),this._resourceContexts=null}on(n,e){return this._manipulators.on(n,a=>{e(a)})}forEach(n){for(let e of this._manipulators.items)n(e)}some(n){return this._manipulators.items.some(n)}toArray(){let n=[];return this.forEach(e=>n.push(e.manipulator)),n}intersect(n,e){let a=null,i=Number.MAX_VALUE;return this._manipulators.forEach(({manipulator:o,attached:r})=>{if(!r||!o.interactive)return;let s=o.intersectionDistance(n,e);s!=null&&s<i&&(i=s,a=o)}),a}_updateManipulatorAttachment(n){this._isManipulatorItemVisible(n)?this._attachManipulator(n):this._detachManipulator(n)}_attachManipulator(n){n.attached||(n.manipulator.attach&&n.manipulator.attach(this._resourceContexts),n.attached=!0)}_detachManipulator(n){if(!n.attached)return;let e=n.manipulator;e.grabbing=!1,e.dragging=!1,e.hovering=!1,e.selected=!1,e.detach&&e.detach(this._resourceContexts),n.attached=!1}_isManipulatorItemVisible(n){return n.visibilityPredicate===E.Always||(this._isToolEditable?n.visibilityPredicate===E.WhenToolEditable:n.visibilityPredicate===E.WhenToolNotEditable)}};var p=class extends K{constructor(t){super(t),this.manipulators=new T,this.automaticManipulatorSelection=!0,this.hasGrabbedManipulators=!1,this.hasHoveredManipulators=!1,this.firstGrabbedManipulator=null,this.created=!1,this.removeIncompleteOnCancel=!0,this._editableFlags=new Map([[y.MANAGER,!0],[y.USER,!0]]),this._creationFinishedResolver=B()}get active(){return this.view!=null&&this.view.activeTool===this}set visible(t){this._get("visible")!==t&&(this._set("visible",t),this._syncVisible())}get editable(){return this.getEditableFlag(y.USER)}set editable(t){this.setEditableFlag(y.USER,t)}get updating(){return!1}get cursor(){return null}get hasFocusedManipulators(){return this.hasGrabbedManipulators||this.hasHoveredManipulators}destroy(){this.manipulators.destroy(),this._set("view",null)}onAdd(){this._syncVisible()}activate(){this.view!=null&&(this.view.focus(),this.onActivate())}deactivate(){this.onDeactivate()}handleInputEvent(t){this.onInputEvent(t)}handleInputEventAfter(t){this.onInputEventAfter(t)}setEditableFlag(t,n){this._editableFlags.set(t,n),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),t===y.USER&&this.notifyChange("editable"),this.onEditableChange(),this.onManipulatorSelectionChanged()}getEditableFlag(t){return this._editableFlags.get(t)??!1}whenCreated(){return this._creationFinishedResolver.promise}onManipulatorSelectionChanged(){}onActivate(){}onDeactivate(){}onShow(){}onHide(){}onEditableChange(){}onInputEvent(t){}onInputEventAfter(t){}get internallyEditable(){return this.getEditableFlag(y.USER)&&this.getEditableFlag(y.MANAGER)}finishToolCreation(){this.created||this._creationFinishedResolver.resolve(this),this._set("created",!0)}_syncVisible(){if(this.initialized){if(this.visible)this._show();else if(this._hide(),this.active)return void(this.view.activeTool=null)}}_show(){this._updateManipulatorAttachment(),this.onShow()}_hide(){this._updateManipulatorAttachment(),this.onHide()}_updateManipulatorAttachment(){this.visible?this.manipulators.attach():this.manipulators.detach()}};c([d({constructOnly:!0})],p.prototype,"view",void 0),c([d({readOnly:!0})],p.prototype,"active",null),c([d({value:!0})],p.prototype,"visible",null),c([d({value:!0})],p.prototype,"editable",null),c([d({readOnly:!0})],p.prototype,"manipulators",void 0),c([d({readOnly:!0})],p.prototype,"updating",null),c([d()],p.prototype,"cursor",null),c([d({readOnly:!0})],p.prototype,"automaticManipulatorSelection",void 0),c([d()],p.prototype,"hasFocusedManipulators",null),c([d()],p.prototype,"hasGrabbedManipulators",void 0),c([d()],p.prototype,"hasHoveredManipulators",void 0),c([d()],p.prototype,"firstGrabbedManipulator",void 0),c([d({readOnly:!0})],p.prototype,"created",void 0),c([d({readOnly:!0})],p.prototype,"removeIncompleteOnCancel",void 0),p=c([J("esri.views.interactive.InteractiveToolBase")],p);function bt(t,n){let e=null,a=null;return i=>{if(i.action==="cancel")return void(a!=null&&(a.execute({action:"cancel"}),e=null,a=null));let o={action:i.action,screenStart:i.start,screenEnd:i.screenPoint};i.action==="start"&&e==null&&(e=new S,a=new S,n(t,e,a,i.pointerType,o)),e?.execute(o),i.action==="end"&&e!=null&&(e=null,a=null)}}function ee(t,n){return t.events.on("drag",bt(t,n))}function ne(t,n){let e=[t.x,t.y,t.z??0],a=n,i=[Math.cos(a),Math.sin(a)],o=Math.sqrt(i[0]*i[0]+i[1]*i[1]);if(o===0)return null;i[0]/=o,i[1]/=o;let r=s=>{let l=(s.x-e[0])*i[0]+(s.y-e[1])*i[1];s.x=e[0]+l*i[0],s.y=e[1]+l*i[1]};return s=>(r(s.mapStart),r(s.mapEnd),v(h({},s),{axis:i}))}function St(t){let n=null;return e=>{if(e.action==="start"&&(n=Mt(t,e.mapStart.spatialReference)),n==null)return null;let a=e.mapEnd.x-e.mapStart.x,i=e.mapEnd.y-e.mapStart.y,o=(e.mapEnd.z??0)-(e.mapStart.z??0);return n.move(a,i,o,e.action),v(h({},e),{translationX:a,translationY:i,translationZ:o})}}function ct(t,n){return t==null?null:t.spatialReference.equals(n)?t.clone():C(t,n)}function Mt(t,n){let e=t.operations;if(!e)return null;let a=e.data.geometry,i=rt(n);if(a.spatialReference.equals(i))return G(t,e,()=>{});if(a.type!=="mesh"){let o=ct(a,i);if(o==null)return null;let r=a.spatialReference;return G(t,D.fromGeometry(o,e.viewingMode),()=>{let s=C(a,r);e.trySetGeometry(s)})}if(at(a)){let o=ct(a.origin,i);if(!o)return null;let r=a.spatialReference,s=D.fromGeometry(o,e.viewingMode);return G(t,e,()=>{let l=C(s.data.geometry,r),m=l.x-a.origin.x,f=l.y-a.origin.y,g=(l.z??0)-(a.origin.z??0);e.move(m,f,g)})}return null}function G(t,n,e){let a=0,i=0,o=0;return{move:(r,s,l,m)=>{m==="start"&&(a=0,i=0,o=0);let f=r-a,g=s-i,M=l-o;n.move(f,g,M),a+=f,i+=g,o+=M,e(),m==="end"&&t.endInteraction?.()}}}function ae(t,n=null,e){let a=null,i=n==null||t.spatialReference?.equals(n)?r=>r:r=>r!=null?C(r,n):r,o=h({exclude:[]},e);return r=>{if(r.action==="start"&&(a=i(t.toMap(r.screenStart,o))),a==null)return null;let s=i(t.toMap(r.screenEnd,o));return s!=null?v(h({},r),{mapStart:a,mapEnd:s}):null}}function ie(t){let n=t.map(e=>St(e)).filter(j);return e=>{let a=e.mapEnd.x-e.mapStart.x,i=e.mapEnd.y-e.mapStart.y,o=e.mapEnd.z-e.mapStart.z;return n.forEach(r=>r(e)),v(h({},e),{translationX:a,translationY:i,translationZ:o})}}function oe(t,n){let e=new Map;for(let a of n)e.set(a,V(t[a]));return a=>(e.forEach((i,o)=>{t[o]=i}),a)}function xt(t){let n=t.operations?.createResetState();return e=>(n?.remove(),e)}function re(t){let n=t.map(e=>xt(e)).filter(e=>e!=null);return e=>(n.forEach(a=>a(e)),e)}function se(){let t=0,n=0,e=0;return a=>{a.action==="start"&&(t=a.mapStart.x,n=a.mapStart.y,e=a.mapStart.z);let i=a.mapEnd.x-t,o=a.mapEnd.y-n,r=a.mapEnd.z-e;return t=a.mapEnd.x,n=a.mapEnd.y,e=a.mapEnd.z,v(h({},a),{mapDeltaX:i,mapDeltaY:o,mapDeltaZ:r,mapDeltaSpatialReference:a.mapStart.spatialReference})}}function le(){let t=0,n=0;return e=>{e.action==="start"&&(t=e.screenStart.x,n=e.screenStart.y);let a=e.screenEnd.x-t,i=e.screenEnd.y-n;return t=e.screenEnd.x,n=e.screenEnd.y,v(h({},e),{screenDeltaX:a,screenDeltaY:i})}}function ue(t,n){let e=null,a=0,i=0;return o=>{if(o.action==="start"&&(e=t.toScreen?.(n),e!=null&&(e.x<0||e.x>t.width||e.y<0||e.y>t.height?e=null:(a=o.screenStart.x-e.x,i=o.screenStart.y-e.y))),e==null)return null;let r=O(o.screenEnd.x-a,0,t.width),s=O(o.screenEnd.y-i,0,t.height),l=tt(r,s);return o.screenStart=e,o.screenEnd=l,o}}var _t=()=>{},S=class t{constructor(){this.execute=_t}next(n,e=new t){return n!=null&&(this.execute=a=>{let i=n(a);i!=null&&e.execute(i)}),e}};function ce(t,n,e=[]){if(t.type==="2d")return i=>i;let a=null;return i=>{i.action==="start"&&(a=t.toMap(i.screenStart,{exclude:e}),a!=null&&(a.z=A(a,t,n)));let o=t.toMap(i.screenEnd,{exclude:e});o!=null&&(o.z=A(o,t,n));let r=a!=null&&o!=null?{sceneStart:a,sceneEnd:o}:null;return v(h({},i),{scenePoints:r})}}function pt(t,n,e){let a=n.elevationProvider.getElevation(t.x,t.y,t.z??0,t.spatialReference,"scene")??0,i=w(t);return i.z=a,i.hasZ=!0,i.z=A(i,n,e),i}function pe(t,n){if(t.type==="2d")return a=>a;let e=null;return a=>{a.action==="start"&&(e=pt(a.mapStart,t,n));let i=pt(a.mapEnd,t,n),o=e!=null&&i!=null?{sceneStart:e,sceneEnd:i}:null;return v(h({},a),{scenePoints:o})}}function xe({predicate:t=()=>!0,snappingManager:n,snappingContext:e,updatingHandles:a,useZ:i=!0}){let o=new S;if(n==null)return{snappingStep:[dt,o],cancelSnapping:dt};let r,s=null,l=null,m=null,f=()=>{s=q(s),n.doneSnapping(),l?.frameTask.remove(),l=null,r=L(r),m=null},g=Ct(n,i,o),M=null,x=null,b=null;return{snappingStep:[u=>{if(!t(u))return u;let{action:R}=u;if(R==="start"){let{info:P}=u,z=Pt(n.view);if(l=At(e,u,z),l.context.selfSnappingZ=null,!i&&P!=null){let _=Tt(e.coordinateHelper,P.handle.component);_!=null&&(l.context.selfSnappingZ={value:_,elevationInfo:e.elevationInfo??ot})}}if(l!=null){let{context:P,originalScenePos:z,originalPos:_}=l,{mapEnd:Z,mapStart:N,scenePoints:ft}=u,F=ht(_,U(Z,N)),k=U(N,_),vt=v(h({},u),{action:"update"}),yt=l.context,I=wt(z,ft),H=n.update({point:F,scenePoint:I,context:P});if(b=H,mt(Z,H,k,i),M=F,x=I,R!=="end"){let{frameTask:Et}=l;s==null&&(s=new AbortController),m=gt=>{a.addPromise(X(g({frameTask:Et,event:vt,context:yt,point:F,scenePoint:I,delta:k,getLastState:()=>({point:M,scenePoint:x,updatePoint:gt.forceUpdate?null:b})},s.signal)))},m({forceUpdate:!1}),r==null&&(r=$(()=>n.options.effectiveEnabled,()=>m?.({forceUpdate:!0})))}}return R==="end"&&f(),u},o],cancelSnapping:u=>(f(),u)}}function Ct(t,n,e){return Y((g,M)=>W(this,[g,M],function*({frameTask:a,point:i,scenePoint:o,context:r,event:s,delta:l,getLastState:m},f){let x=yield a.schedule(()=>t.snap({point:i,scenePoint:o,context:r,signal:f}),f);if(x.valid){let b=yield a.schedule(()=>x.apply(),f),u=m();u.point!=null&&i!==u.point&&(b=t.update({point:u.point,scenePoint:u.scenePoint,context:r})),u.updatePoint!=null&&it(b,u.updatePoint)||(mt(s.mapEnd,b,l,n),e.execute(s))}}))}function Pt(t){return t.type==="3d"?t.resourceController.scheduler.registerTask(et.SNAPPING):nt}function At(t,n,e){return{context:new st({editGeometryOperations:t.editGeometryOperations,elevationInfo:t.elevationInfo,pointer:t.pointer,vertexHandle:n.info!=null?n.info.handle:null,excludeFeature:t.excludeFeature,feature:t.feature,visualizer:t.visualizer}),originalPos:n.snapOrigin!=null?t.coordinateHelper.vectorToDehydratedPoint(n.snapOrigin):n.mapStart,originalScenePos:n.scenePoints!=null?n.scenePoints.sceneStart:null,frameTask:e}}function ht(t,[n,e,a]){let i=w(t);return i.x+=n,i.y+=e,i.hasZ&&(i.z+=a),i}function wt(t,n){return t==null||n==null?null:ht(t,U(n.sceneEnd,n.sceneStart))}function U(t,n){let e=t.hasZ&&n.hasZ?t.z-n.z:0;return[t.x-n.x,t.y-n.y,e]}function mt(t,n,[e,a,i],o){t.x=n.x+e,t.y=n.y+a,o&&t.hasZ&&n.hasZ&&(t.z=n.z+i)}function Tt(t,n){if(!t.hasZ())return null;let e=n.vertices,a=null;for(let i of e){let o=t.getZ(i.pos);if(a!=null&&o!=null&&Math.abs(o-a)>1e-6)return null;a==null&&(a=o)}return a}function dt(t){return t}export{y as a,lt as b,ut as c,T as d,p as e,ee as f,ne as g,St as h,ae as i,ie as j,oe as k,xt as l,re as m,se as n,le as o,ue as p,S as q,ce as r,pe as s,xe as t};
