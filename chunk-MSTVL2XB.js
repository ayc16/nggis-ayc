import{B as Ui,G as ue,L as Ce,N as gt,Q as Bi,a as xi,b as he,ba as ki,c as tr,ca as Yi,e as X,ea as Me,f as xe,fa as Qi,g as Ae,h as Ai,i as Ci,k as Vi,l as Fi,n as H,p as Ni,q as Hi,s as Wi,v as de}from"./chunk-QRTF6HWT.js";import{b as Zi}from"./chunk-L4N7O64W.js";import{a as Oi}from"./chunk-QJKE5PUA.js";import{b as Mi}from"./chunk-FVCRK5IX.js";import{a as ji,c as Gi}from"./chunk-6W67IVZS.js";import{f as Ii,g as zi,h as qi}from"./chunk-DRX336HH.js";import{a as vi,b as We}from"./chunk-I2LACOYT.js";import{C as yi,e as si,f as ui,g as pi,h as mi,j as _i,m as fi,o as Xt,r as ce,u as Jt,y as gi}from"./chunk-7E3X25PE.js";import{d as Ri}from"./chunk-PJBIIWFF.js";import{a as we,b as Te,c as Le}from"./chunk-JAXR3ZUJ.js";import{d as ni}from"./chunk-XN46SLSO.js";import{a as bi,b as R}from"./chunk-XSJRPCD6.js";import{b as N,d as ai,i as oi,k as li,l as b,m as ci}from"./chunk-3DDJTCET.js";import{a as Ne}from"./chunk-UDMTFKLM.js";import{a as _t,d as hi,e as di,f as De,g as Oe}from"./chunk-AW3LMT4V.js";import{a as Br}from"./chunk-ADDH3SWI.js";import{a as lt,b as ct,c as ht,d as dt,h as ut}from"./chunk-DL3OPG77.js";import{a as q,b as Se,c as Jr,d as Ee,e as Kr,g as le,i as $r}from"./chunk-RBP2Z7C6.js";import{a as Pe,h as mt}from"./chunk-DOFADBK3.js";import{a as ti}from"./chunk-GMW3QDVG.js";import{b as Xr}from"./chunk-KUOODJRB.js";import{a as z}from"./chunk-OW7DVBQB.js";import{a as Nr}from"./chunk-LAXYP2KV.js";import{b as st}from"./chunk-TIXZ4OWB.js";import{a as Ir}from"./chunk-NDZXQR2V.js";import{a as p}from"./chunk-UVJ5D37D.js";import{b as zr,c as Re,i as nt,r as qr}from"./chunk-ZAQLF7TN.js";import{a as Ur}from"./chunk-SKXQUOOX.js";import{a as Wr}from"./chunk-6HNTTYFF.js";import{c as Fr}from"./chunk-I3DWOIS7.js";import{a as Di}from"./chunk-OQUBYVYT.js";import{b as A,c as He,q as Li}from"./chunk-RAMEUAPV.js";import{c as wi,d as er,e as Ti}from"./chunk-5NHMASEK.js";import{a as w}from"./chunk-3K3SLH5Z.js";import{p as ft}from"./chunk-CXJNPJ3A.js";import{f as Si,i as Kt,k as Ei,l as Pi,s as $t}from"./chunk-QU6JU243.js";import{k as ri,l as ii,w as Zt,x as Qt}from"./chunk-CDCW33GU.js";import{a as qe}from"./chunk-4QS7PGAF.js";import{a as pt}from"./chunk-NIYDRLW4.js";import{a as Qr}from"./chunk-XHOTVM3O.js";import{a as Q,b as ei,d as ot}from"./chunk-H3VY6XFU.js";import{j as kr,o as kt}from"./chunk-H63LVRK7.js";import{a as Yr,d as Yt,e as y,g as Zr,l as at,p as ze,x as ve}from"./chunk-SJTQM4NH.js";import{a as Er}from"./chunk-IY6MAS3P.js";import{a as Bt}from"./chunk-UJ6V7JUK.js";import{g as Tr,n as Lr,s as xr}from"./chunk-R4NNYEN7.js";import{a as it}from"./chunk-PDBA6QOJ.js";import{a as Ut}from"./chunk-CF52RSJZ.js";import{a as I}from"./chunk-ALWV3RJ2.js";import{a as Hr}from"./chunk-7C6Z24SS.js";import{r as Cr,v as Fe}from"./chunk-7G4KK3KW.js";import{f as Ar}from"./chunk-KYNKUTEO.js";import{a as Wt,b as Mr,c as Ie,d as Vr,g as rt,j as jr,n as Gr}from"./chunk-2ETHV3H2.js";import{a as k,g as _r}from"./chunk-4XUOIGFO.js";import{e as x,g as Pr,h as Z}from"./chunk-AM3VOA32.js";import{c as F}from"./chunk-M2GLXRA2.js";import{a as tt,b as Dr,c as Or,f as wr,g as qt,i as Nt,n as Ht}from"./chunk-EBWCXIFH.js";import{n as Sr}from"./chunk-VPMDQK57.js";import{a as L,l as G}from"./chunk-ZVHU7VE3.js";import{b as vr,f as Ge}from"./chunk-76YVRX2R.js";import{B as j,a as Ft,b as g,c as D,d as P,e as v,l as oe,n as It,o as gr,q as yr,s as O,t as br,u as be,v as Rr,w as Y,x as zt}from"./chunk-OZF6BMOL.js";import{a as c,b as Gt,c as ae,e as je}from"./chunk-GJP6PTKT.js";import{a as mr}from"./chunk-GBTN5LIS.js";import{l as V}from"./chunk-SA4OMQAD.js";import{I as fr}from"./chunk-JDDD6VJ4.js";import{L as M,O as pr}from"./chunk-AUTL5LCV.js";import{S as et}from"./chunk-KUJG22IX.js";import{a as _}from"./chunk-W3WDPWBE.js";import{a as ur,e as ye}from"./chunk-GISCFF3Z.js";import{b as hr,c as dr,f as jt}from"./chunk-MLSR6YE6.js";import{a as se,b as ne}from"./chunk-EAH6BNBL.js";var yt=class{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1,this._renderGroup=he.Outline}destroy(){this._destroyResources()}get resources(){return this._resources!=null?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}get renderGroup(){return this._renderGroup}set renderGroup(e){this._renderGroup=e;let t=this._resources?.layerView;t&&(t.renderGroup=e)}recreate(){this.attached&&this._createResources()}recreateGeometry(){this._resourceFactory.recreateGeometry?this._resources!=null&&(this._ensureRenderGeometriesRemoved(),this._resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}_createOrDestroyResources(){this._attached?this._resources==null&&this._createResources():this._destroyResources()}_createResources(){this._destroyResources();let e=this._resourceFactory.createResources(),t=new pe({view:this._resourceFactory.view,renderGroup:this._renderGroup}),r=this._resourceFactory.view.basemapTerrain?.overlayManager;this._resources={layerView:new pe({view:this._resourceFactory.view,renderGroup:this._renderGroup}),external:e,geometriesAdded:!1},r&&(this._resources.drapeSourceRenderer=r.registerGeometryDrapeSource(t)),this._syncGeometriesToRenderer()}_destroyResources(){if(this._resources==null)return;this._ensureRenderGeometriesRemoved();let e=this._resourceFactory.view.basemapTerrain?.overlayManager;e&&e.unregisterDrapeSource(this._resources.layerView),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncGeometriesToRenderer(){this._visible?this._ensureRenderGeometriesAdded():this._ensureRenderGeometriesRemoved()}_ensureRenderGeometriesRemoved(){this._resources?.drapeSourceRenderer!=null&&this._resources.geometriesAdded&&(this._resources.drapeSourceRenderer.removeGeometries(this._resources.external.geometries,tr.UPDATE),this._resources.geometriesAdded=!1)}_ensureRenderGeometriesAdded(){this._resources?.drapeSourceRenderer!=null&&(this._resources.geometriesAdded||(this._resources.drapeSourceRenderer.addGeometries(this._resources.external.geometries,tr.UPDATE),this._resources.geometriesAdded=!0))}},pe=class extends Er(pr){constructor(i){super(i),this.drapeSourceType=xi.Features,this.updatePolicy=X.SYNC,this.renderGroup=he.Outline}};_([M({constructOnly:!0})],pe.prototype,"view",void 0),_([M({readOnly:!0})],pe.prototype,"drapeSourceType",void 0),_([M()],pe.prototype,"renderGroup",void 0),pe=_([et("esri.views.3d.interactive.visualElements.DrapedVisualElementResources")],pe);var J=class{get isDecoration(){return this._isDecoration}set isDecoration(e){this._isDecoration=e}constructor(e){this._isDecoration=!1,this._attached=!1,this._resourcesCreated=!1,this._visible=!0,this.view=e.view,this._handle=k(()=>e.view.ready,t=>{this._resourcesCreated&&(t?this._createResources():this._destroyResources())})}applyProperties(e){let t=!1;for(let r in e)r in this&&(r==="attached"?t=e[r]:this[r]=e[r]);this.attached=t}destroy(){this.attached=!1,this._handle.remove()}get attached(){return this._attached}set attached(e){e!==this._attached&&this.view._stage&&(this._attached=e,this._attached&&!this._resourcesCreated?this._createResources():!this._attached&&this._resourcesCreated&&this._destroyResources(),this.onAttachedChange(e))}onAttachedChange(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.attached&&this.updateVisibility(e))}_createResources(){this.createResources(),this._resourcesCreated=!0,this.updateVisibility(this.visible)}_destroyResources(){this.destroyResources(),this._resourcesCreated=!1}};var bt=class{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get object(){return this._resources!=null?this._resources.object:null}get resources(){return this._resources!=null?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncVisible())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(!this._resourceFactory.recreateGeometry)return void this.recreate();let e=this._resourceFactory.view._stage;if(this._resources==null||!e)return;let t=this._resources.object;this._resources.external.forEach(r=>{r.type!==N.Mesh&&r.type!==N.Line&&r.type!==N.Point||e.remove(r)}),t.removeAllGeometries(),this._resourceFactory.recreateGeometry(this._resources.external,t,this._resources.layer),this._resources.external.forEach(r=>{r.type!==N.Mesh&&r.type!==N.Line&&r.type!==N.Point||e.add(r)})}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();let e=this._resourceFactory,t=e.view,r=t._stage;if(!r)return;let s=new Ae(r,{pickable:!1,updatePolicy:X.SYNC}),n=new xe({castShadow:!1}),a=e.createResources(n,s);a.forEach(h=>{r.add(h),h.type===N.Texture&&h.load(r.renderView.renderingContext)}),r.add(n),s.add(n);let o=e.cameraChanged,l=o?k(()=>t.state.camera,h=>o(h),_r):null;this._resources={layer:s,object:n,external:a,cameraHandle:l},this._syncVisible()}_destroyResources(){if(this._resources==null)return;let e=this._resourceFactory.view._stage;e&&(e.remove(this._resources.object),this._resources.layer.destroy(),this._resources.external.forEach(t=>{e.remove(t),t.type===N.Texture&&t.unload()})),this._resources.object.dispose(),this._resources.cameraHandle?.remove(),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncVisible(){this._resources!=null&&(this._resources.object.visible=this._visible)}};var K=class extends J{constructor(e){super(e),this._isDraped=!1,this.object3dResources=new bt(this.createObject3DResourceFactory(e.view)),this.drapedResources=new yt(this.createDrapedResourceFactory(e.view)),this.isDraped=e.isDraped??!1}get isDraped(){return this._isDraped}set isDraped(e){e!==this._isDraped&&(this._isDraped=e,this.object3dResources.attached=this.attached&&!e,this.drapedResources.attached=this.attached&&e)}get renderGroup(){return this.drapedResources.renderGroup}set renderGroup(e){this.drapedResources.renderGroup=e}createResources(){this.object3dResources.attached=!this._isDraped,this.drapedResources.attached=this._isDraped}destroyResources(){this.object3dResources.attached=!1,this.drapedResources.attached=!1}recreate(){this.object3dResources.recreate(),this.drapedResources.recreate()}recreateGeometry(){this.object3dResources.recreateGeometry(),this.drapedResources.recreateGeometry()}destroy(){this.object3dResources.destroy(),this.drapedResources.destroy(),super.destroy()}updateVisibility(e){this.object3dResources.visible=e,this.drapedResources.visible=e}};var Ue=class i extends Te{initializeProgram(e){return new Le(e.rctx,i.shader.get().build(this.configuration),rr)}initializePipeline(){return Oe({blending:_t(Re.ONE,Re.ONE_MINUS_SRC_ALPHA),colorWrite:De})}};Ue.shader=new we(Mi,()=>import("./chunk-KDLEZR2U.js"));var rr=new Map([[p.START,0],[p.END,1],[p.UP,2],[p.EXTRUDE,3]]);var Be=class{constructor(e){this._renderCoordsHelper=e,this._buffers=null,this._origin=c(),this._dirty=!1,this._count=0,this._vao=null}set vertices(e){let t=Ur(3*e.length),r=0;for(let s of e)t[r++]=s[0],t[r++]=s[1],t[r++]=s[2];this.buffers=[t]}set buffers(e){if(this._buffers=e,this._buffers.length>0){let t=this._buffers[0],r=3*Math.floor(t.length/3/2);D(this._origin,t[r],t[r+1],t[r+2])}else D(this._origin,0,0,0);this._dirty=!0}get origin(){return this._origin}draw(e){let t=this._ensureVAO(e);t!=null&&(e.bindVAO(t),e.drawArrays(zr.TRIANGLES,0,this._count))}dispose(){this._vao!=null&&this._vao.dispose()}_ensureVAO(e){return this._buffers==null?null:(this._vao==null&&(this._vao=this._createVAO(e,this._buffers)),this._ensureVertexData(this._vao,this._buffers),this._vao)}_createVAO(e,t){let r=this._createDataBuffer(t);return this._dirty=!1,new Vi(e,rr,{data:Nr(Ki)},{data:Br.createVertex(e,qr.STATIC_DRAW,r)})}_ensureVertexData(e,t){if(!this._dirty)return;let r=this._createDataBuffer(t);e.vertexBuffers.data?.setData(r),this._dirty=!1}_createDataBuffer(e){let t=e.reduce((o,l)=>o+Xi(l),0);this._count=t;let r=Ki.createBuffer(t),s=this._origin,n=0,a=0;for(let o of e){for(let l=0;l<o.length;l+=3){let h=D(Ji,o[l],o[l+1],o[l+2]);l===0?a=this._renderCoordsHelper.getAltitude(h):this._renderCoordsHelper.setAltitude(h,a);let d=this._renderCoordsHelper.worldUpAtPosition(h,Es),u=n+2*l,m=v(Ji,h,s);if(l<o.length-3){r.up.setVec(u,d),r.up.setVec(u+3,d),r.up.setVec(u+5,d);for(let f=0;f<6;f++)r.start.setVec(u+f,m);r.extrude.setValues(u,0,-1),r.extrude.setValues(u+1,1,-1),r.extrude.setValues(u+2,1,1),r.extrude.setValues(u+3,0,-1),r.extrude.setValues(u+4,1,1),r.extrude.setValues(u+5,0,1)}if(l>0){r.up.setVec(u-2,d),r.up.setVec(u-4,d),r.up.setVec(u-5,d);for(let f=-6;f<0;f++)r.end.setVec(u+f,m)}}n+=Xi(o)}return r.buffer}};function Xi(i){return 3*(2*(i.length/3-1))}var Es=c(),Ji=c(),Ki=st().vec3f(p.START).vec3f(p.END).vec3f(p.UP).vec2f(p.EXTRUDE);var me=class extends bi{constructor(){super(...arguments),this.contrastControlEnabled=!1}};_([R()],me.prototype,"contrastControlEnabled",void 0);var Rt=class extends ti{constructor(){super(...arguments),this.innerColor=ae(1,1,1),this.innerWidth=1,this.glowColor=ae(1,.5,0),this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=.75,this.globalAlphaContrastBoost=2,this.angleCutoff=Ge(6),this.pointDistanceOrigin=c(),this.pointDistanceTarget=c(),this.lineVerticalPlaneSegment=q(),this.intersectsLineSegment=q(),this.intersectsLineRadius=3,this.heightManifoldTarget=c(),this.lineStartWorld=c(),this.lineEndWorld=c()}},ke=class i extends Te{initializeProgram(e){return new Le(e.rctx,i.shader.get().build(this.configuration),ai)}initializePipeline(){return Oe({blending:_t(Re.ONE,Re.ONE_MINUS_SRC_ALPHA),colorWrite:De})}};ke.shader=new we(Gi,()=>import("./chunk-A5IN6IFG.js"));var W=class extends me{constructor(){super(...arguments),this.heightManifoldEnabled=!1,this.pointDistanceEnabled=!1,this.lineVerticalPlaneEnabled=!1,this.intersectsLineEnabled=!1,this.spherical=!1}};_([R()],W.prototype,"heightManifoldEnabled",void 0),_([R()],W.prototype,"pointDistanceEnabled",void 0),_([R()],W.prototype,"lineVerticalPlaneEnabled",void 0),_([R()],W.prototype,"intersectsLineEnabled",void 0),_([R()],W.prototype,"spherical",void 0);var $=class extends Ci{constructor(i){super(i),this._technique=null,this._heightManifoldEnabled=!1,this._pointDistanceEnabled=!1,this._lineVerticalPlaneEnabled=!1,this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._pathVerticalPlaneEnabled=!1,this._pathVerticalPlaneData=null,this._pathTechnique=null,this._passParameters=new Rt,this.produces=new Map([[ce.LASERLINES,()=>!this.contrastControlEnabled],[ce.LASERLINES_CONTRAST_CONTROL,()=>this.contrastControlEnabled]])}initialize(){this._passParameters.renderCoordsHelper=this.renderCoordsHelper}consumes(){return Ai}get isDecoration(){return this._isDecoration}get heightManifoldEnabled(){return this._heightManifoldEnabled}set heightManifoldEnabled(i){this._heightManifoldEnabled!==i&&(this._heightManifoldEnabled=i,this._requestRender())}get heightManifoldTarget(){return this._passParameters.heightManifoldTarget}set heightManifoldTarget(i){g(this._passParameters.heightManifoldTarget,i),this._requestRender()}get pointDistanceEnabled(){return this._pointDistanceEnabled}set pointDistanceEnabled(i){i!==this._pointDistanceEnabled&&(this._pointDistanceEnabled=i,this._requestRender())}get pointDistanceTarget(){return this._passParameters.pointDistanceTarget}set pointDistanceTarget(i){g(this._passParameters.pointDistanceTarget,i),this._requestRender()}get pointDistanceOrigin(){return this._passParameters.pointDistanceOrigin}set pointDistanceOrigin(i){g(this._passParameters.pointDistanceOrigin,i),this._requestRender()}get lineVerticalPlaneEnabled(){return this._lineVerticalPlaneEnabled}set lineVerticalPlaneEnabled(i){i!==this._lineVerticalPlaneEnabled&&(this._lineVerticalPlaneEnabled=i,this._requestRender())}get lineVerticalPlaneSegment(){return this._passParameters.lineVerticalPlaneSegment}set lineVerticalPlaneSegment(i){Se(i,this._passParameters.lineVerticalPlaneSegment),this._requestRender()}get intersectsLineEnabled(){return this._intersectsLineEnabled}set intersectsLineEnabled(i){i!==this._intersectsLineEnabled&&(this._intersectsLineEnabled=i,this._requestRender())}get intersectsLineSegment(){return this._passParameters.intersectsLineSegment}set intersectsLineSegment(i){Se(i,this._passParameters.intersectsLineSegment),this._requestRender()}get intersectsLineRadius(){return this._passParameters.intersectsLineRadius}set intersectsLineRadius(i){i!==this._passParameters.intersectsLineRadius&&(this._passParameters.intersectsLineRadius=i,this._requestRender())}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(i){i!==this._intersectsLineInfinite&&(this._intersectsLineInfinite=i,this._requestRender())}get pathVerticalPlaneEnabled(){return this._pathVerticalPlaneEnabled}set pathVerticalPlaneEnabled(i){i!==this._pathVerticalPlaneEnabled&&(this._pathVerticalPlaneEnabled=i,this._pathVerticalPlaneData!=null&&this._requestRender())}set pathVerticalPlaneVertices(i){this._pathVerticalPlaneData==null&&(this._pathVerticalPlaneData=new Be(this._passParameters.renderCoordsHelper)),this._pathVerticalPlaneData.vertices=i,this.pathVerticalPlaneEnabled&&this._requestRender()}set pathVerticalPlaneBuffers(i){this._pathVerticalPlaneData==null&&(this._pathVerticalPlaneData=new Be(this._passParameters.renderCoordsHelper)),this._pathVerticalPlaneData.buffers=i,this.pathVerticalPlaneEnabled&&this._requestRender()}setParameters(i){oi(this._passParameters,i)&&this._requestRender()}initializeRenderContext(i){this._context=i,this._techniques=i.techniques,this._techniqueConfig=new W;let e=new me;e.contrastControlEnabled=this.contrastControlEnabled,this._pathTechnique=this._techniques.acquire(Ue,e)}uninitializeRenderContext(){this._technique=jt(this._technique),this._pathVerticalPlaneData=dr(this._pathVerticalPlaneData),this._pathTechnique=jt(this._pathTechnique)}prepareTechnique(){return this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled?(this._techniqueConfig.heightManifoldEnabled=this.heightManifoldEnabled,this._techniqueConfig.lineVerticalPlaneEnabled=this.lineVerticalPlaneEnabled,this._techniqueConfig.pointDistanceEnabled=this.pointDistanceEnabled,this._techniqueConfig.intersectsLineEnabled=this.intersectsLineEnabled,this._techniqueConfig.contrastControlEnabled=this.contrastControlEnabled,this._techniqueConfig.spherical=this.viewingMode===Qr.Global,this._technique=this._techniques.releaseAndAcquire(ke,this._techniqueConfig,this._technique),this._technique):this._pathTechnique}renderNode(i,e,t){let r=t?.get("normals")?.getTexture();r&&(this._passParameters.normals=r,(this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled)&&this._renderUnified(i,e),this.pathVerticalPlaneEnabled&&this._renderPath(i))}_renderUnified(i,e){let t=i.rctx;this._updatePassParameters(i),t.bindTechnique(e,i.bindParameters,this._passParameters),t.screen.draw()}_renderPath(i){if(this._pathVerticalPlaneData==null||this._pathTechnique==null)return;let e=i.rctx,t=this._pathTechnique;e.bindTechnique(t,i.bindParameters,ne(se({},this._passParameters),{origin:this._pathVerticalPlaneData.origin})),this._pathVerticalPlaneData.draw(i.rctx)}_updatePassParameters(i){if(!this._intersectsLineEnabled)return;let e=i.bindParameters.camera;if(this._intersectsLineInfinite){if(ct(ei(this._passParameters.intersectsLineSegment.origin,this._passParameters.intersectsLineSegment.vector),Ye),Ye.c0=-Number.MAX_VALUE,!ut(e.frustum,Ye))return;ht(Ye,this._passParameters.lineStartWorld),dt(Ye,this._passParameters.lineEndWorld)}else g(this._passParameters.lineStartWorld,this._passParameters.intersectsLineSegment.origin),P(this._passParameters.lineEndWorld,this._passParameters.intersectsLineSegment.origin,this._passParameters.intersectsLineSegment.vector)}_requestRender(){this._context&&this._context.requestRender()}get test(){}};_([M({constructOnly:!0})],$.prototype,"viewingMode",void 0),_([M({constructOnly:!0})],$.prototype,"contrastControlEnabled",void 0),_([M({constructOnly:!0})],$.prototype,"_isDecoration",void 0),_([M({constructOnly:!0})],$.prototype,"renderCoordsHelper",void 0),$=_([et("esri.views.3d.webgl-engine.effects.laserlines.LaserLineRenderer")],$);var Ye=lt();var vt=class extends J{constructor(e){super(e),this._angleCutoff=ji,this._style={},this._heightManifoldTarget=c(),this._heightManifoldEnabled=!1,this._intersectsLine=q(),this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._lineVerticalPlaneSegment=null,this._pathVerticalPlaneBuffers=null,this._pointDistanceLine=null,this.applyProperties(e)}get testData(){}createResources(){this._ensureRenderer()}destroyResources(){this._disposeRenderer()}updateVisibility(){this._syncRenderer(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance()}get angleCutoff(){return this._angleCutoff}set angleCutoff(e){this._angleCutoff!==e&&(this._angleCutoff=e,this._syncAngleCutoff())}get style(){return this._style}set style(e){this._style=e,this._syncStyle()}get heightManifoldTarget(){return this._heightManifoldEnabled?this._heightManifoldTarget:null}set heightManifoldTarget(e){e!=null?(g(this._heightManifoldTarget,e),this._heightManifoldEnabled=!0):this._heightManifoldEnabled=!1,this._syncRenderer(),this._syncHeightManifold()}set intersectsWorldUpAtLocation(e){if(e==null)return void(this.intersectsLine=null);let t=this.view.renderCoordsHelper.worldUpAtPosition(e,Ps);this.intersectsLine=Jr(e,t),this.intersectsLineInfinite=!0}get intersectsLine(){return this._intersectsLineEnabled?this._intersectsLine:null}set intersectsLine(e){e!=null?(Se(e,this._intersectsLine),this._intersectsLineEnabled=!0):this._intersectsLineEnabled=!1,this._syncIntersectsLine(),this._syncRenderer()}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(e){this._intersectsLineInfinite=e,this._syncIntersectsLineInfinite()}get lineVerticalPlaneSegment(){return this._lineVerticalPlaneSegment}set lineVerticalPlaneSegment(e){this._lineVerticalPlaneSegment=e!=null?Se(e):null,this._syncLineVerticalPlane(),this._syncRenderer()}get pathVerticalPlane(){return this._pathVerticalPlaneBuffers}set pathVerticalPlane(e){this._pathVerticalPlaneBuffers=e,this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncRenderer()}get pointDistanceLine(){return this._pointDistanceLine}set pointDistanceLine(e){this._pointDistanceLine=e!=null?{origin:Gt(e.origin),target:e.target?Gt(e.target):null}:null,this._syncPointDistance(),this._syncRenderer()}_syncRenderer(){this.attached&&this.visible&&(this._intersectsLineEnabled||this._heightManifoldEnabled||this._pointDistanceLine!=null||this._pathVerticalPlaneBuffers!=null)?this._ensureRenderer():this._disposeRenderer()}_ensureRenderer(){this._renderer==null&&(this._renderer=new $({renderCoordsHelper:this.view.renderCoordsHelper,contrastControlEnabled:!0,_isDecoration:this.isDecoration,viewingMode:this.view.state.viewingMode}),this._syncStyle(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncIntersectsLineInfinite(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncAngleCutoff(),this.view._stage&&this.view._stage.addRenderPlugin(this._renderer))}_syncStyle(){this._renderer!=null&&(this._renderer.setParameters(this._style),this._style.intersectsLineRadius!=null&&(this._renderer.intersectsLineRadius=this._style.intersectsLineRadius))}_syncAngleCutoff(){this._renderer!=null&&this._renderer.setParameters({angleCutoff:this._angleCutoff})}_syncHeightManifold(){this._renderer!=null&&(this._renderer.heightManifoldEnabled=this._heightManifoldEnabled&&this.visible,this._heightManifoldEnabled&&(this._renderer.heightManifoldTarget=this._heightManifoldTarget))}_syncIntersectsLine(){this._renderer!=null&&(this._renderer.intersectsLineEnabled=this._intersectsLineEnabled&&this.visible,this._intersectsLineEnabled&&(this._renderer.intersectsLineSegment=this._intersectsLine))}_syncIntersectsLineInfinite(){this._renderer!=null&&(this._renderer.intersectsLineInfinite=this._intersectsLineInfinite)}_syncPathVerticalPlane(){this._renderer!=null&&(this._renderer.pathVerticalPlaneEnabled=this._pathVerticalPlaneBuffers!=null&&this.visible,this._pathVerticalPlaneBuffers!=null&&(this._renderer.pathVerticalPlaneBuffers=this._pathVerticalPlaneBuffers))}_syncLineVerticalPlane(){this._renderer!=null&&(this._renderer.lineVerticalPlaneEnabled=this._lineVerticalPlaneSegment!=null&&this.visible,this._lineVerticalPlaneSegment!=null&&(this._renderer.lineVerticalPlaneSegment=this._lineVerticalPlaneSegment))}_syncPointDistance(){if(this._renderer==null)return;let e=this._pointDistanceLine,t=e!=null;this._renderer.pointDistanceEnabled=t&&e.target!=null&&this.visible,t&&(this._renderer.pointDistanceOrigin=e.origin,e.target!=null&&(this._renderer.pointDistanceTarget=e.target))}_disposeRenderer(){this._renderer!=null&&this.view._stage&&(this.view._stage.removeRenderPlugin(this._renderer),this._renderer=null)}},Ps=c();var St=class extends K{constructor(e){super(e),this._ray=Q(),this._isWorldDown=!1,this._start=c(),this._end=ae(1,0,0),this._width=1,this._color=We(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=We(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._falloff=0,this._extensionType=T.LINE,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=b.OccludeAndTransparent,this._fadedExtensions=rs,this._laserline=new vt({view:this.view,isDecoration:e.isDecoration}),this.applyProperties(e)}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(e){return{view:e,createResources:t=>this._createObject3DResources(t),destroyResources:$i,recreateGeometry:(t,r)=>this._recreateObject3DGeometry(t,r),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:$i,recreateGeometry:t=>this._recreateDrapedGeometry(t)}}updateVisibility(e){super.updateVisibility(e),this._laserline.visible=e}onAttachedChange(){this._laserline.attached=this._laserlineAttached}setStartEndFromWorldDownAtLocation(e){this._isWorldDown=!0,g(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),v(this._end,e,this._end),ot(this._start,this._end,this._ray),this._updateGeometry()}get start(){return this._start}set start(e){this._isWorldDown=!1,j(this._start,e)||(g(this._start,e),ot(this._start,this._end,this._ray),this._updateGeometry())}get end(){return this._end}set end(e){this._isWorldDown=!1,j(this._end,e)||(g(this._end,e),ot(this._start,this._end,this._ray),this._updateGeometry())}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){G(e,this._color)||(L(this._color,e),this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){G(e,this._innerColor)||(L(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){let t=e!=null!=(this._stipplePattern!=null);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){e!=null&&this._stippleOffColor!=null&&G(e,this._stippleOffColor)||(this._stippleOffColor=e!=null?vi(e):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(e){e!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=e,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get extensionType(){return this._extensionType}set extensionType(e){e!==this._extensionType&&(this._extensionType=e,this.recreateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&this._laserlineStyle!=null&&this.attached&&!this.isDraped}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,e!=null&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===b.OccludeAndTransparentStencil?b.OccludeAndTransparent:this._renderOccluded}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(e){this._fadedExtensions=e??rs,this.recreateGeometry()}_updateMaterial(){let{materialParameters:e}=this;this.object3dResources.resources?.material.setParameters(e),this.drapedResources.resources?.material.setParameters(e)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,hasPolygonOffset:this._polygonOffset,renderOccluded:this._normalizedRenderOccluded,isDecoration:this.isDecoration,writeDepth:this._writeDepthEnabled}}_createObject3DResources(e){let t=new H(this.materialParameters),r=new Array;return this._createObject3DGeometry(t,e,r),{material:t,geometries:r,forEach:s=>{s(t),r.forEach(s)}}}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,r){let s=this._createGeometry(e);r.push(s),t.addGeometry(s),this._updateVerticesObject3D(t)}_createDrapedResources(){let e=new H(this.materialParameters);return{material:e,geometries:[this._createDrapedGeometry(e)]}}_recreateDrapedGeometry(e){e.geometries=[this._createDrapedGeometry(e.material)]}_createDrapedGeometry(e){let t=this._createGeometry(e);return this._updateVerticesDraped(t),new Ce(t)}_createGeometry(e){let t=this.extensionType===T.FADED,r=t?[c(),c(),c(),c()]:[c(),c()];return ue(e,r,null,t?[1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]:null)}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{let e=this.object3dResources.object;e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){let t=this._lineSegment;this._updateVertexAttributesObject3D(e,t),this._laserline.intersectsLine=t}_updateVerticesDraped(e){this._updateVertexAttributesDraped(e,this._lineSegment)}get _lineSegment(){return this._extensionType===T.FADED?this._updateLineSegmentFinite(es):this._updateLineSegmentInfinite(this._extensionType,es)}_updateLineSegmentFinite(e){return Ee(this._start,this._end,e)}_updateLineSegmentInfinite(e,t){let r=this.view.state.camera;switch(ct(this._ray,ee),e){case T.LINE:ee.c0=-Number.MAX_VALUE;break;case T.RAY:case T.GROUND_RAY:{let a=this._ray.origin,o=this.view.elevationProvider.getElevation(a[0],a[1],a[2],this.view.renderCoordsHelper.spatialReference,"ground")??0,l=this.view.renderCoordsHelper.getAltitude(a);this._isWorldDown&&l<o&&yr(ee.ray.direction,ee.ray.direction),this._extensionType===T.GROUND_RAY&&o!=null&&(ee.c1=Math.abs(l-o));break}}if(!ut(r.frustum,ee))return this._updateLineSegmentFinite(t);let s=ht(ee,_e),n=dt(ee,Ds);return Ee(s,n,t)}_updateVertexAttributesObject3D(e,t){let r=e.geometries[0].getMutableAttribute(p.POSITION)?.data;if(!r)return;let s=0;for(let n of this._lineVertices(t))r[s++]=n[0],r[s++]=n[1],r[s++]=n[2];e.geometryVertexAttributeUpdated(e.geometries[0],p.POSITION)}_updateVertexAttributesDraped(e,t){let r=e.getMutableAttribute(p.POSITION)?.data;if(!r)return;let s=0;for(let n of this._lineVertices(t))r[s++]=n[0],r[s++]=n[1],r[s++]=de;e.invalidateBoundingInfo()}*_lineVertices(e){this.extensionType===T.FADED?(yield le(e,-this.fadedExtensions.start,_e),yield le(e,0,_e),yield le(e,1,_e),yield le(e,1+this.fadedExtensions.end,_e)):(yield le(e,0,_e),yield le(e,1,_e))}};function $i(i){i.geometries=[]}var ee=lt(),_e=c(),Ds=c(),es=q(),T;(function(i){i[i.LINE=0]="LINE",i[i.RAY=1]="RAY",i[i.GROUND_RAY=2]="GROUND_RAY",i[i.FADED=3]="FADED"})(T||(T={}));var ts=1/3,rs={start:ts,end:ts};var Dt=class extends K{constructor(e){super(e),this._location=c(),this._direction=ae(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=We(1,0,1,1),this._renderOccluded=b.OccludeAndTransparent,this.applyProperties(e)}createObject3DResourceFactory(e){return{view:e,createResources:t=>this._createObject3DResources(t),destroyResources:ws,recreateGeometry:(t,r)=>this._recreateObject3DGeometry(t,r),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:Ts,recreateGeometry:t=>this._recreateDrapedGeometry(t)}}get location(){return this._location}set location(e){j(this._location,e)||(g(this._location,e),this._updateGeometry())}get direction(){return this._direction}set direction(e){j(this._direction,e)||(g(this._direction,e),this._updateGeometry())}setDirectionFromPoints(e,t){O(this._direction,v(this._direction,t,e)),this._updateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get offset(){return this._offset}set offset(e){e!==this._offset&&(this._offset=e,this._updateGeometry())}get length(){return this._length}set length(e){e!==this._length&&(this._length=e,this._updateGeometry())}get color(){return this._color}set color(e){G(e,this._color)||(L(this._color,e),this._updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}_createObject3DResources(e){let t=new H(this.materialParameters),r=new Array;return this._createObject3DGeometry(t,e,r),{material:t,geometries:r,forEach:s=>{s(t),r.forEach(s)}}}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,r){let[s,n]=is(e);t.addGeometry(s),t.addGeometry(n),r.push(s),r.push(n),this._updateVerticesObject3D(t)}_createDrapedResources(){let e=new H(this.materialParameters),t=k(()=>this.view.state.contentPixelRatio,()=>{this.drapedResources.recreateGeometry()});return{material:e,geometries:this._createDrapedGeometry(e),pixelRatioHandle:t}}_recreateDrapedGeometry(e){e.geometries=this._createDrapedGeometry(e.material)}_createDrapedGeometry(e){let t=is(e);return this._updateVerticesDraped(t),t.map(r=>new Ce(r))}_updateMaterial(){let{materialParameters:e}=this;this.object3dResources.resources?.material.setParameters(e),this.drapedResources.resources?.material.setParameters(e)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{let e=this.object3dResources.object;e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){let t=this.view.state.camera;t.projectToScreen(this.location,Pt),P(C,this.location,this.direction),t.projectToScreen(C,Ve),Gr(Ve,Vr(Ve,Ve,Pt)),this._updateVertexAttributesObject3D(t,e,0,Pt,Ve,1),this._updateVertexAttributesObject3D(t,e,1,Pt,Ve,-1)}_updateVertexAttributesObject3D(e,t,r,s,n,a){let o=t.geometries[r],l=o.getMutableAttribute(p.POSITION)?.data;if(!l)return;let{start:h,end:d}=ss(n,s,a,this.offset,this.width,this.length);e.unprojectFromScreen(h,C),l[0]=C[0],l[1]=C[1],l[2]=C[2],e.unprojectFromScreen(d,C),l[3]=C[0],l[4]=C[1],l[5]=C[2],t.geometryVertexAttributeUpdated(o,p.POSITION)}_updateVerticesDraped(e){let{view:{basemapTerrain:{overlayManager:t},state:{contentPixelRatio:r}}}=this,{location:s,width:n,length:a,offset:o}=this,l=Ls;l.spatialReference=t.renderer.spatialReference,l.x=s[0],l.y=s[1];let h=this.view.overlayPixelSizeInMapUnits(l)*r,d=n*h,u=a*h,m=o*h;this._updateVertexAttributesDraped(e[0],d,u,m,-1),this._updateVertexAttributesDraped(e[1],d,u,m,1)}_updateVertexAttributesDraped(e,t,r,s,n){let a=e.getMutableAttribute(p.POSITION)?.data;if(!a)return;let{location:o,direction:l}=this,{start:h,end:d}=ss(l,o,n,s,t,r);a[0]=h[0],a[1]=h[1],a[2]=de,a[3]=d[0],a[4]=d[1],a[5]=de,e.invalidateBoundingInfo()}};function is(i){return[ue(i,[c(),c()]),ue(i,[c(),c()])]}function ss(i,e,t,r,s,n){let a=rt(ns,Mr(ns,i[1]*t,i[0]*-t),r+s/2),o=Ie(Et,Ie(Et,Ie(Et,e,rt(Et,i,n/2)),a),a);return{start:o,end:Ie(as,o,rt(as,i,-n))}}function ws(i){i.geometries.length=0}function Ts(i){i.pixelRatioHandle.remove(),i.geometries=[]}var C=c(),ns=it(),Et=it(),as=it(),Pt=x(),Ve=x(),Ls=pt(0,0,void 0,null);var Ot=class extends J{constructor(e){super(e),this._resources=null,this._transform=I()}get object(){return this._resources!=null?this._resources.object:null}get transform(){return this._transform}set transform(e){tt(this._transform,e),this._resources!=null&&(this._resources.object.transformation=this._transform)}recreate(){this.attached&&this.createResources()}recreateGeometry(){if(this._resources==null)return;let e=this._resources.object,t=this.view._stage;t.removeMany(e.geometries),e.removeAllGeometries(),this.createGeometries(e),e.visible=this.visible,t.addMany(e.geometries)}createResources(){this.destroyResources();let e=this.view._stage;if(!e)return;let t=new Ae(e,{pickable:!1,updatePolicy:X.SYNC}),r=new xe({castShadow:!1});r.transformation=this._transform,this.createExternalResources(),this.createGeometries(r),e.addMany(r.geometries),this.forEachExternalMaterial(s=>e.add(s)),e.add(r),t.add(r),r.visible=this.visible,this._resources={layer:t,object:r}}destroyResources(){let e=this.view._stage;this._resources!=null&&e&&(e.remove(this._resources.object),this._resources.layer.destroy(),this.forEachExternalMaterial(t=>{e.remove(t)}),e.removeMany(this._resources.object.geometries),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}updateVisibility(e){this._resources!=null&&(this._resources.object.visible=e)}};var Qe=class extends Ot{constructor(e){super(e),this._material=null,this._texture=null,this._geometry=null,this._size=3,this._color=F(1,0,1,1),this._pixelSnappingEnabled=!0,this._primitive="square",this._outlineSize=1,this._outlineColor=F(1,1,1,1),this._elevationInfo=null,this.applyProperties(e)}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get size(){return this._size}set size(e){if(e!==this._size){let t=this._preferredTextureSize;this._size=e,t<this._preferredTextureSize?this.recreate():this._updateSizeAttribute()}}get color(){return this._color}set color(e){G(e,this._color)||(L(this._color,e),this._updateMaterial())}get pixelSnappingEnabled(){return this._pixelSnappingEnabled}set pixelSnappingEnabled(e){this._pixelSnappingEnabled!==e&&(this._pixelSnappingEnabled=e,this._updateMaterial())}get primitive(){return this._primitive}set primitive(e){this._primitive!==e&&(this._primitive=e,this.recreate())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){G(e,this._outlineColor)||(L(this._outlineColor,e),this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}_updateMaterial(){this._material&&this._material.setParameters(this._materialParameters)}_updateSizeAttribute(){let e=this.object;if(e==null)return;let t=e.geometries[0];if(t==null)return;let r=t.getMutableAttribute(p.SIZE).data,s=this._geometrySize;r[0]=s,r[1]=s,e.geometryVertexAttributeUpdated(e.geometries[0],p.SIZE)}get _materialParameters(){return{color:this._color,textureIsSignedDistanceField:!0,sampleSignedDistanceFieldTexelCenter:zi(this._primitive),distanceFieldBoundingBox:xs,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:this._texture?.id,polygonOffset:!1,shaderPolygonOffset:0,drawInSecondSlot:!0,depthEnabled:!1,pixelSnappingEnabled:this.pixelSnappingEnabled,isDecoration:this.isDecoration}}get _geometrySize(){return this._size/Ze}createExternalResources(){this._texture=qi(this._primitive,this._preferredTextureSize),this._material=new Yi(this._materialParameters);let e=this.view._stage;this._texture.load(e.renderView.renderingContext),e.add(this._texture)}destroyExternalResources(){this._texture&&(this.view._stage.remove(this._texture),this._texture.dispose(),this._texture=null),this._material=null}createGeometries(e){let t=this._createRenderGeometry();t!=null&&e.addGeometry(t)}forEachExternalMaterial(e){this._material&&e(this._material)}get _preferredTextureSize(){return vr(2*this._geometrySize,16,128)}calculateMapBounds(e){let t=this.object?.geometries[0];if(!t)return!1;let r=t.attributes.get(p.POSITION).data;return qe(r,this.view.renderCoordsHelper.spatialReference,os,this.view.spatialReference),Tr(e,os),!0}_createRenderGeometry(){let{geometry:e,_material:t}=this;if(e==null||t==null)return null;let{renderCoordsHelper:r,elevationProvider:s}=this.view,n=Bi(e,s,ki.fromElevationInfo(this.elevationInfo),r),a=D(y.get(),e.x,e.y,n),o=y.get();qe(a,e.spatialReference,o,r.spatialReference);let l=this._geometrySize;return Ui(t,null,o,null,[l,l],[0,0,0,1])}},Ze=Ii,xs=[Ze/2,Ze/2,1-Ze/2,1-Ze/2],os=c();var wt=class extends K{constructor(e){super(e),this._maxSize=0,this._position=c(),this._up=c(),this._right=c(),this._renderOccluded=b.OccludeAndTransparent,this._color=F(1,0,0,1),this._outlineColor=F(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=b.Opaque,this.applyProperties(e)}createObject3DResourceFactory(e){return{view:e,createResources:t=>this._createObject3DResources(t),destroyResources:()=>{},cameraChanged:()=>this._updateTransformObject3D()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:As}}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get color(){return this._color}set color(e){L(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){L(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){let t=this._outlineSize===0!=(e===0);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry({previous:e,center:t,next:r}){this._maxSize=Math.min(It(t,e),It(t,r))/3,O(this._up,v(this._up,e,t)),O(this._right,v(this._right,r,t)),g(this._position,t),this.recreateGeometry()}_createObject3DResources(e){let t=new Me(this._quadMaterialParameters),r=this._outlineSize===0?void 0:new H(this._outlineMaterialParameters);return this._createObject3DGeometries(e,t,r),{quadMaterial:t,outlineMaterial:r,forEach:s=>{s(t),r&&s(r)}}}_createObject3DGeometries(e,t,r){if(j(this._up,je)&&j(this._right,je))return;let s=this._createGeometries(t,r);for(let n of s)e.addGeometry(n);this._updateTransformObject3D(e)}_createDrapedResources(){let e=new Me(this._quadMaterialParameters),t=this._outlineSize===0?void 0:new H(this._outlineMaterialParameters),r=this._createGeometries(e,t).map(s=>new Ce(s));return this._setTransformDraped(r),{quadMaterial:e,outlineMaterial:t,geometries:r,pixelRatioHandle:k(()=>this.view.state.contentPixelRatio,()=>{this.drapedResources.recreateGeometry()})}}_createGeometries(e,t){let{up:r,right:s,corner:n}=this._getVertices(),a=Cs(r,s,n,e);return t?[a,ue(t,[r,n,s])]:[a]}_getVertices(){let e=this._up,t=this._right,r=P(y.get(),e,t);return this.isDraped&&(e=g(y.get(),e),t=g(y.get(),t),e[2]=0,t[2]=0,r[2]=0),{up:e,right:t,corner:r}}_updateTransform(){this.isDraped?this.drapedResources.recreateGeometry():this._updateTransformObject3D()}_updateTransformObject3D(e=this.object3dResources.object){if(!e)return;let t=this.view.state.camera,r=this._size*t.computeScreenPixelSizeAt(this._position),s=Math.min(this._maxSize,r);Ht(te,this._position),Nt(te,te,[s,s,s]),e.transformation=te}_setTransformDraped(e){if(e.length===0)return;let{view:{basemapTerrain:{overlayManager:t},state:{contentPixelRatio:r}}}=this,{_position:s,_size:n}=this,a=g(y.get(),s);a[2]=de;let o=Ms;o.spatialReference=t.renderer.spatialReference,o.x=a[0],o.y=a[1];let l=n*(this.view.overlayPixelSizeInMapUnits(o)*r),h=Math.min(this._maxSize,l);Ht(te,a),Nt(te,te,[h,h,1]);for(let d of e)d.transformation=te}get _quadMaterialParameters(){return{color:this._color,forceTransparentMode:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateQuadMaterial(){this.object3dResources.resources?.quadMaterial.setParameters(this._quadMaterialParameters),this.drapedResources.resources?.quadMaterial.setParameters(this._quadMaterialParameters)}get _outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded,isDecoration:this.isDecoration}}_updateOutlineMaterial(){this.object3dResources.resources?.outlineMaterial?.setParameters(this._outlineMaterialParameters),this.drapedResources.resources?.outlineMaterial?.setParameters(this._outlineMaterialParameters)}};function As(i){i.pixelRatioHandle.remove(),i.geometries=[]}function Cs(i,e,t,r){return new si(r,[[p.POSITION,new Xr([0,0,0,...e,...i,...t],[0,1,2,1,2,3],3,!0)]])}var te=I(),Ms=pt(0,0,void 0,null);var ls=class extends Oi{sortUniqueHints(e){return e.sort((t,r)=>(r instanceof $t?r.length:0)-(t instanceof $t?t.length:0))}visualizeIntersectionPoint(e,t){let{spatialReference:r,view:s}=t,n=Xe(t);return ye(new Qe({view:s,primitive:"circle",geometry:Kt(e.intersectionPoint,r),elevationInfo:e.isDraped?Qt:Zt,size:20,outlineSize:2,color:n.intersectionPointColor,outlineColor:n.intersectionPointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizePoint(e,t){let{view:r,spatialReference:s}=t,n=Xe(t),a=re(e.point,e.domain,t);return ye(new Qe({view:r,primitive:"circle",geometry:Kt(a,s),elevationInfo:Tt(e),size:20,outlineSize:2,color:n.pointColor,outlineColor:n.pointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizeLine(e,t){let{view:r,spatialReference:s}=t,n=Xe(t),a=re(e.lineStart,e.domain,t),o=re(e.lineEnd,e.domain,t);return ye(Vs(e.type,a,o,s,Tt(e),r,n,e.isDraped,e.fadeLeft,e.fadeRight))}visualizeParallelSign(e,t){let{view:r,spatialReference:s}=t,n=Xe(t),{isDraped:a}=e,o=Tt(e),l=re(e.lineStart,e.domain,t),h=re(e.lineEnd,e.domain,t),d=fe(l,s,o,r,a),u=fe(h,s,o,r,a),m=Rr(u,d,u,.5),f=new Dt({view:r,attached:!1,offset:w.parallelLineHintOffset,length:w.parallelLineHintLength,width:w.parallelLineHintWidth,color:n.parallelSignColor,location:m,renderOccluded:a?b.OccludeAndTransparent:b.Opaque,isDraped:a,renderGroup:he.SnappingHint,isDecoration:!0});return f.setDirectionFromPoints(d,m),f.attached=!0,ye(f)}visualizeRightAngleQuad(e,t){let{view:r,spatialReference:s}=t,n=Xe(t),a=Tt(e),{isDraped:o}=e,l=re(e.previousVertex,e.domain,t),h=re(e.centerVertex,e.domain,t),d=re(e.nextVertex,e.domain,t),u=fe(l,s,a,r,o),m=fe(h,s,a,r,o),f=fe(d,s,a,r,o);return ye(new wt({view:r,attached:!0,color:o?n.rightAngleColorDraped:n.rightAngleColor,renderOccluded:o?b.OccludeAndTransparent:b.Transparent,outlineRenderOccluded:o?b.OccludeAndTransparent:b.Opaque,outlineColor:n.rightAngleOutlineColor,outlineSize:w.rightAngleHintOutlineSize,size:w.rightAngleHintSize,isDraped:o,geometry:{previous:u,center:m,next:f},renderGroup:he.SnappingHint,isDecoration:!0}))}};function Xe(i){let{effectiveTheme:e}=i.view,t=Bt.toUnitRGBA(e.accentColor),r=[0,0,0,0];return{intersectionPointColor:r,intersectionPointOutlineColor:t,pointColor:r,pointOutlineColor:t,lineColor:t,lineOutlineColor:void 0,parallelSignColor:t,rightAngleColor:t,rightAngleColorDraped:Bt.toUnitRGBA(kr(e.accentColor,.5)),rightAngleOutlineColor:t}}function re(i,e,{selfSnappingZ:t,view:r,spatialReference:s}){return e&Pi.SELF&&Si(i)&&t!=null?Ei(i,t,r,s):i}function Tt(i){return i.isDraped?Qt:Zt}function Vs(i,e,t,r,s,n,a,o=!1,l=!0,h=!0){let d=fe(e,r,s,n,o),u=fe(t,r,s,n,o),m=new St({view:n,extensionType:T.FADED,start:d,end:u,isDraped:o,color:a.lineColor,renderOccluded:o?b.OccludeAndTransparent:b.Opaque,renderGroup:he.SnappingHint,isDecoration:!0});switch(i){case ft.TARGET:m.width=w.lineHintWidthTarget,m.fadedExtensions={start:0,end:w.lineHintFadedExtensions};break;case ft.REFERENCE_EXTENSION:m.width=w.lineHintWidthReference,m.fadedExtensions={start:0,end:0};break;case ft.REFERENCE:m.width=w.lineHintWidthReference,m.fadedExtensions={start:l?w.lineHintFadedExtensions:0,end:h?w.lineHintFadedExtensions:0}}return m.attached=!0,m}function fe(i,e,t,r,s){let n=c();if(s){let a=r.basemapTerrain.overlayManager.renderer.spatialReference;qe(i,e,n,a)}else Di(i,e,t,r,n);return n}function cs(i){return i?.operations?.data.geometry}function Nl(i,e,t=Q()){return ie(i,Z(e),t),O(t.direction,t.direction),t}function ie(i,e,t){return js(i,i.screenToRender(e,y.get()),t)}function js(i,e,t){let r=Wt(y.get(),e);if(r[2]=0,!i.unprojectFromRenderScreen(r,t.origin))return null;let s=Wt(y.get(),e);s[2]=1;let n=i.unprojectFromRenderScreen(s,y.get());return n==null?null:(v(t.direction,n,t.origin),t)}var hs=class{constructor(e){this.metadata=void 0,this._camera=new Fi,this._elevation={offset:0,override:null},this.collisionType={type:"point"},this.collisionPriority=0,this._renderObjects=new Array,this.autoScaleRenderObjects=!0,this._available=!0,this._noDisplayCount=0,this._radius=10,this._worldSized=!1,this.focusMultiplier=2,this.touchMultiplier=2.5,this.worldOriented=!1,this._modelTransform=I(),this._worldFrame=null,this._renderLocation=c(),this._renderLocationDirty=!0,this._location=new V({x:0,y:0,z:0}),this._elevationAlignedLocation=new V,this._elevationAlignedLocationDirty=!0,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.consumesClicks=!0,this.cursor=null,this.grabCursor=null,this._grabbing=!1,this.dragging=!1,this._hovering=!1,this._selected=!1,this._state=He.None,this._focused=!1,this.events=new mr.EventEmitter,this._screenLocation={screenPointArray:x(),renderScreenPointArray:Pr(),pixelSize:0},this._screenLocationDirty=!0,this._engineResourcesAddedToStage=!1,this._attached=!1,this._location.spatialReference=e.view.spatialReference,Object.assign(this,e);let t=this.view.state?.camera;t&&this._camera.copyFrom(t)}destroy(){this._applyObjectTransform=qs,this._removeResourcesFromStage(),this._engineResources=null,this.view=null,this._camera=null}get _stage(){return this.view?._stage}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this._elevationAlignedLocationDirty=!0,this._renderLocationDirty=!0,this._updateEngineObject()}get renderObjects(){return this._renderObjects}set renderObjects(e){this._removeResourcesFromStage(),this._engineResources=null,this._renderObjects=e.slice(),this._updateEngineObject()}set available(e){e!==this._available&&(this._available=e,this._updateEngineObject())}get available(){return this._available}disableDisplay(){return this._noDisplayCount++,this._noDisplayCount===1&&this._updateEngineObject(),ur(()=>{this._noDisplayCount--,this._noDisplayCount===0&&this._updateEngineObject()})}set radius(e){e!==this._radius&&(this._radius=e,this._updateEngineObject())}get radius(){return this._radius}set worldSized(e){e!==this._worldSized&&(this._worldSized=e,this._updateEngineObject())}get worldSized(){return this._worldSized}get modelTransform(){return this._modelTransform}set modelTransform(e){ds(e)&&(this._screenLocationDirty=!0),tt(this._modelTransform,e),this._updateEngineObject()}get renderLocation(){return this._renderLocationDirty&&(this._renderLocationDirty=!1,this.view.renderCoordsHelper.toRenderCoords(this.elevationAlignedLocation,this._renderLocation),this.worldOriented?(this._worldFrame||(this._worldFrame=I()),Gs(this.view,this._renderLocation,this._worldFrame)):this._worldFrame&&(this._worldFrame=null)),this._renderLocation}set renderLocation(e){this.view.renderCoordsHelper.fromRenderCoords(e,this._location),this.elevationAlignedLocation=this._location}get location(){return this._location}set location(e){er(e,this._location),this._notifyLocationChanged()}_notifyLocationChanged(){this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!0,this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}get elevationAlignedLocation(){return this._elevationAlignedLocationDirty?(this._evaluateElevationAlignment(),this._updateElevationAlignedLocation(),this._elevationAlignedLocation):this._elevationAlignedLocation}set elevationAlignedLocation(e){er(e,this._location),this._evaluateElevationAlignment(),this._location.z-=this._elevation.offset,this._updateElevationAlignedLocation(),this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}_updateElevationAlignedLocation(){let e=this._elevation.override!=null?this._elevation.override:this.location.z||0;this._elevationAlignedLocation.x=this.location.x,this._elevationAlignedLocation.y=this.location.y,this._elevationAlignedLocation.z=e+this._elevation.offset,this._elevationAlignedLocation.spatialReference=Ti(this.location.spatialReference),this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!1}grabbableForEvent(){return!0}get grabbing(){return this._grabbing}set grabbing(e){e!==this._grabbing&&(this._grabbing=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get hovering(){return this._hovering}set hovering(e){e!==this._hovering&&(this._hovering=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get selected(){return this._selected}set selected(e){e!==this._selected&&(this._selected=e,this._updateEngineObject(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._updateEngineObject())}updateStateEnabled(e,t){t?this.state|=e:this.state&=~e}_setFocused(e){e!==this._focused&&(this._focused=e,this.events.emit("focus-changed",{action:e===!0?"focus":"unfocus"}))}get focused(){return this._focused}get screenLocation(){return this._ensureScreenLocation(),this._screenLocation}_ensureScreenLocation(){if(!this._screenLocationDirty)return;this._screenLocation.pixelSize=this._camera.computeScreenPixelSizeAt(this.renderLocation),this._screenLocationDirty=!1;let e;if(ds(this._modelTransform)){let t=this._calculateModelTransformOffset(zs);e=P(t,t,this.renderLocation)}else e=this.renderLocation;this._camera.projectToRenderScreen(e,this._screenLocation.renderScreenPointArray),this._camera.renderToScreen(this._screenLocation.renderScreenPointArray,this._screenLocation.screenPointArray)}get applyObjectTransform(){return this._applyObjectTransform}set applyObjectTransform(e){this._applyObjectTransform=e,this._screenLocationDirty=!0,this._updateEngineObject()}get attached(){return this._attached}intersectionDistance(e,t){if(!this.available)return null;let r=Z(e,Fs),s=this._getCollisionRadius(t),n=-1*this.collisionPriority;switch(this.collisionType.type){case"point":if(jr(this.screenLocation.screenPointArray,r)<s*s)return this.screenLocation.renderScreenPointArray[2]+n;break;case"line":{let a=this.collisionType.paths,o=this._getWorldToScreenObjectScale(),l=this._calculateObjectTransform(o,Lt),h=s*this.screenLocation.pixelSize,d=ie(this._camera,r,ir);if(d==null)return null;for(let u of a){if(u.length===0)continue;let m=Y(Je,u[0],l);for(let f=1;f<u.length;f++){let E=Y(ms,u[f],l),U=$r(Ee(m,E,us),d);if(U!=null&&U<h*h){let B=P(y.get(),m,E);oe(B,B,.5);let ge=y.get();return this._camera.projectToRenderScreen(B,ge),ge[2]+n}g(m,E)}}break}case"disc":{let a=this.collisionType.direction,o=this.collisionType.offset??je,l=this._getWorldToScreenObjectScale(),h=this._calculateObjectTransform(l,Lt),d=s*this.screenLocation.pixelSize,u=ie(this._camera,r,ir);if(u==null)return null;let m=Ut(ps,h),f=zt(fs,a,m),E=Y(gs,o,h);ze(E,f,xt);let U=_s;if(ve(xt,u,U)&&gr(U,E)<d*d)return this.screenLocation.renderScreenPointArray[2]+n;break}case"ribbon":{let{paths:a,direction:o}=this.collisionType,l=this._getWorldToScreenObjectScale(),h=this._calculateObjectTransform(l,Lt),d=s*this._camera.computeScreenPixelSizeAt(this.renderLocation),u=ie(this._camera,r,ir);if(u==null)return null;let m=Ut(ps,h),f=zt(fs,o,m),E=this._calculateModelTransformPosition(gs);ze(E,f,xt);let U=_s;if(!ve(xt,u,U))break;for(let B of a){if(B.length===0)continue;let ge=Y(Je,B[0],h);for(let Ct=1;Ct<B.length;Ct++){let Mt=Y(ms,B[Ct],h),lr=Kr(Ee(ge,Mt,us),U);if(lr!=null&&lr<d*d){let Vt=P(y.get(),ge,Mt);oe(Vt,Vt,.5);let cr=y.get();return this._camera.projectToRenderScreen(Vt,cr),cr[2]+n}g(ge,Mt)}}break}default:this.collisionType}return null}attach(e={manipulator3D:{}}){let t=this._stage;if(!t)return;let r=e.manipulator3D;r.engineLayerId==null?(this._engineLayer=new Ae(t,{pickable:!1,updatePolicy:X.SYNC}),r.engineLayerId=this._engineLayer.id):t?.getObject&&(this._engineLayer=t.getObject(r.engineLayerId)),r.engineLayerReferences=(r.engineLayerReferences||0)+1,this._materialIdReferences=r.materialIdReferences,this._materialIdReferences==null&&(this._materialIdReferences=new Map,r.materialIdReferences=this._materialIdReferences),this._camera.copyFrom(this.view.state.camera),this._attached=!0,this._updateEngineObject(),Cr(this._location.spatialReference,this.view.spatialReference)||(this.location=new V({x:0,y:0,z:0,spatialReference:this.view.spatialReference}))}detach(e={manipulator3D:{}}){let t=e.manipulator3D;t.engineLayerReferences--;let r=t.engineLayerReferences===0;this._removeResourcesFromStage(),r&&(t.engineLayerId=null,hr(this._engineLayer)),this._engineResources=null,this._engineLayer=null,this._materialIdReferences=null,this._attached=!1}onViewChange(){this._camera.copyFrom(this.view.state.camera),this._screenLocationDirty=!0,this._updateEngineObject()}onElevationChange(e){Fe(this.location,ys,e.spatialReference)&&Sr(e.extent,ys)&&this._notifyLocationChanged()}_evaluateElevationAlignment(){if(this.elevationInfo==null)return;let e=null,t=0,r=ri(this.elevationInfo,this.location.spatialReference??this.view.elevationProvider.spatialReference);switch(this.elevationInfo.mode){case"on-the-ground":e=gt(this.view.elevationProvider,this.location,"ground")??0;break;case"relative-to-ground":t=(gt(this.view.elevationProvider,this.location,"ground")??0)+r;break;case"relative-to-scene":t=(gt(this.view.elevationProvider,this.location,"scene")??0)+r;break;case"absolute-height":t=r}return t!==this._elevation.offset||e!==this._elevation.override?(this._elevation.offset=t,void(this._elevation.override=e)):void 0}_updateEngineObject(){if(!this._attached)return;if(!this.available)return void this._removeResourcesFromStage();let e=this._getWorldToScreenObjectScale(),t=Lt;if(this.autoScaleRenderObjects===!0){let a=this._getFocusedSize(this._radius,this.focused)*e;this._calculateObjectTransform(a,t)}else this._calculateObjectTransform(e,t);let{objectsByState:r}=this._ensureEngineResources(),s=(this.focused?A.Focused:A.Unfocused)|(this.selected?A.Selected:A.Unselected),n=this._noDisplayCount>0;for(let{stateMask:a,objects:o}of r){if(n){for(let m of o)m.visible=!1;continue}let l=(a&A.All)!==A.None,h=(a&He.All)!==He.None,d=!l||(s&a)==(a&A.All),u=!h||(this.state&a)==(a&He.All);if(d&&u)for(let m of o)m.visible=!0,m.transformation=t;else for(let m of o)m.visible=!1}}_ensureEngineResources(){if(this._engineResources==null){let e=this._engineLayer,t=[],r=new Set;this.renderObjects.forEach(({geometry:{material:a}})=>{r.has(a)||(t.push(a),r.add(a))});let s=new Map;this._renderObjects.forEach(a=>{let o=new xe({castShadow:!1,geometries:[a.geometry]}),l=s.get(a.stateMask)||[];l.push(o),s.set(a.stateMask,l)});let n=[];s.forEach((a,o)=>n.push({stateMask:o,objects:a})),this._engineResources={objectsByState:n,layer:e,materials:t}}return this._addResourcesToStage(),this._engineResources}_addResourcesToStage(){let e=this._stage;if(this._engineResourcesAddedToStage||this._engineResources==null||!e)return;let{objectsByState:t,layer:r,materials:s}=this._engineResources;s.forEach(n=>{let a=this._materialIdReferences,o=a.get(n.id)||0;o===0&&e.add(n),a.set(n.id,o+1)}),t.forEach(({objects:n})=>{r.addMany(n),e.addMany(n)}),this._engineResourcesAddedToStage=!0}_removeResourcesFromStage(){let e=this._stage;if(!this._engineResourcesAddedToStage||this._engineResources==null||!e)return;let{objectsByState:t,layer:r,materials:s}=this._engineResources;t.forEach(({objects:n})=>{r.removeMany(n),e.removeMany(n)}),s.forEach(n=>{let a=this._materialIdReferences,o=a.get(n.id);o===1?(e.remove(n),a.delete(n.id)):a.set(n.id,o-1)}),this._engineResourcesAddedToStage=!1}_getCollisionRadius(e){return this._getFocusedSize(this.radius,!0)*(e==="touch"?this.touchMultiplier:1)}_getFocusedSize(e,t){return e*(t?this.focusMultiplier:1)}_getWorldToScreenObjectScale(){return this._worldSized?1:this.screenLocation.pixelSize}_calculateModelTransformPosition(e){let t=this._getWorldToScreenObjectScale(),r=this._calculateObjectTransform(t,Is);return D(e,r[12],r[13],r[14])}_calculateModelTransformOffset(e){let t=this._calculateModelTransformPosition(e);return v(e,t,this.renderLocation)}_calculateObjectTransform(e,t){return Dr(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1),this._worldFrame&&qt(t,t,this._worldFrame),qt(t,t,this._modelTransform),t[12]+=this.renderLocation[0],t[13]+=this.renderLocation[1],t[14]+=this.renderLocation[2],t[15]=1,this._applyObjectTransform!=null&&this._applyObjectTransform(t),t}get test(){}};function ds(i){return i[12]!==0||i[13]!==0||i[14]!==0}function Gs(i,e,t){switch(i.viewingMode){case"local":return Or(t),!0;case"global":{let r=fr(i.renderCoordsHelper.spatialReference);return Ar(e,0,Je,0,r.radius),Wr(Ge(Je[0]),Ge(Je[1]),t),!0}}}var Fs=x(),us=q(),ir=Q(),ps=Hr(),Is=I(),Lt=I(),xt=at(),Je=c(),ms=c(),_s=c(),fs=c(),gs=c(),zs=c(),ys=new V({x:0,y:0,z:0,spatialReference:null}),qs=()=>{};var Ke=class i extends Te{initializeProgram(e){return new Le(e.rctx,i.shader.get().build(this.configuration),sr)}_setPipelineState(e){let t=this.configuration,r=e===Ne.NONE,s=e===Ne.FrontFace;return Oe({blending:t.output===Pe.Color&&t.transparent?r?ui:pi(e):null,culling:hi(t.cullFace),depthTest:{func:s?nt.LESS:t.shadingEnabled?nt.LEQUAL:nt.LESS},depthWrite:r?t.writeDepth?di:null:mi(e),drawBuffers:fi(e),colorWrite:De,polygonOffset:r||s?null:_i})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};Ke.shader=new we(Zi,()=>import("./chunk-UXD4JVBM.js"));var S=class extends Ri{constructor(){super(...arguments),this.output=Pe.Color,this.cullFace=z.None,this.transparencyPassType=Ne.NONE,this.hasSlicePlane=!1,this.transparent=!1,this.writeDepth=!0,this.screenSizeEnabled=!0,this.shadingEnabled=!0,this.multipassEnabled=!1,this.cullAboveGround=!1}};_([R({count:Pe.COUNT})],S.prototype,"output",void 0),_([R({count:z.COUNT})],S.prototype,"cullFace",void 0),_([R({count:Ne.COUNT})],S.prototype,"transparencyPassType",void 0),_([R()],S.prototype,"hasSlicePlane",void 0),_([R()],S.prototype,"transparent",void 0),_([R()],S.prototype,"writeDepth",void 0),_([R()],S.prototype,"screenSizeEnabled",void 0),_([R()],S.prototype,"shadingEnabled",void 0),_([R()],S.prototype,"multipassEnabled",void 0),_([R()],S.prototype,"cullAboveGround",void 0),_([R({constValue:!1})],S.prototype,"occlusionPass",void 0);var sr=new Map([[p.POSITION,0],[p.NORMAL,1],[p.OFFSET,2]]);var At=class extends li{constructor(e){super(e,new ar),this.supportsEdges=!0,this.produces=new Map([[ce.OPAQUE_MATERIAL,t=>t===Pe.Highlight||mt(t)&&!this._isTransparent],[ce.TRANSPARENT_MATERIAL,t=>mt(t)&&this._isTransparent&&this.parameters.writeDepth],[ce.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,t=>mt(t)&&this._isTransparent&&!this.parameters.writeDepth]]),this._configuration=new S,this._vertexAttributeLocations=sr}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._isTransparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.screenSizeEnabled=this.parameters.screenSizeEnabled,this._configuration.shadingEnabled=this.parameters.shadingEnabled,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}intersect(e,t,r,s,n,a){if(this.parameters.screenSizeEnabled){let o=e.attributes.get(p.OFFSET);Xt(e,r,s,n,{applyToVertex:(h,d,u,m)=>{let f=D(bs,o.data[3*m],o.data[3*m+1],o.data[3*m+2]),E=D(Ns,h,d,u);return oe(f,f,this.parameters.screenSizeScale*r.camera.computeScreenPixelSizeAt(f)),P(E,E,f),[E[0],E[1],E[2]]},applyToAabb:h=>{let d=Lr(h,bs);return xr(h,this.parameters.screenSizeScale*r.camera.computeScreenPixelSizeAt(d))}},a)}else Xt(e,r,s,n,void 0,a)}createGLMaterial(e){return new nr(e)}createBufferWriter(){return new or(this.parameters.screenSizeEnabled)}get _isTransparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}},nr=class extends ni{beginSlot(e){return this.ensureTechnique(Ke,e)}},ar=class extends ci{constructor(){super(...arguments),this.color=F(1,1,1,1),this.shadingTint=F(0,0,0,.25),this.shadingDirection=O(c(),[.5,-.5,-.5]),this.screenSizeScale=14,this.forceTransparentMode=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=z.None,this.screenSizeEnabled=!1,this.shadingEnabled=!0}},or=class{constructor(e){this.screenSizeEnabled=e;let t=st().vec3f(p.POSITION).vec3f(p.NORMAL);this.screenSizeEnabled&&t.vec3f(p.OFFSET),this.vertexBufferLayout=t}elementCount(e){return e.attributes.get(p.POSITION).indices.length}write(e,t,r,s,n){if(yi(r,this.vertexBufferLayout,e,t,s,n),this.screenSizeEnabled){if(!r.attributes.has(p.OFFSET))throw new Error(`${p.OFFSET} vertex attribute required for screenSizeEnabled ShadedColorMaterial`);{let a=r.attributes.get(p.OFFSET);Ir(a.size===3);let o=s.getField(p.OFFSET,Fr);if(!o)throw new Error("unable to acquire view for "+p.OFFSET);gi(a,t,o,n)}}}},bs=c(),Ns=c();function _h(i,e=b.OccludeAndTransparent,t=!0){let r=kt(i),s=!(i[3]<1);return t?new At({color:r,writeDepth:s,cullFace:z.Back,renderOccluded:e,isDecoration:!0}):new Me({color:r,writeDepth:s,cullFace:z.Back,renderOccluded:e,isDecoration:!0})}function fh(i,e=b.OccludeAndTransparent){let t=kt(i);return new Me({color:t,writeDepth:!0,cullFace:z.Front,renderOccluded:e,isDecoration:!0})}var gh=Object.freeze({calloutLength:40,calloutWidth:1,discRadius:27,focusMultiplier:1.1}),yh=Object.freeze({autoScaleRenderObjects:!1,worldSized:!0});function bh(i,e,t,r){let s=v(y.get(),i,t),n=Hs(s,be(y.get(),r,s),t,Zr.get());wr(n,n);let a=Y(y.get(),e,n);return Math.atan2(a[1],a[0])}function Hs(i,e,t,r){let s=O(y.get(),i),n=O(y.get(),e),a=be(y.get(),s,n);return r[0]=s[0],r[1]=s[1],r[2]=s[2],r[3]=0,r[4]=n[0],r[5]=n[1],r[6]=n[2],r[7]=0,r[8]=a[0],r[9]=a[1],r[10]=a[2],r[11]=0,r[12]=t[0],r[13]=t[1],r[14]=t[2],r[15]=1,r}function Rh(i,e){let t=i.getViewForGraphic(e);return t!=null&&"computeAttachmentOrigin"in t?t.computeAttachmentOrigin(e,i.spatialReference):null}function vh(i,e){let t=e.origin;t==null?Ws(i,cs(e)):i.elevationAlignedLocation=t}function Ws(i,e){if(e==null)return;let t=e.type==="mesh"?e.anchor:Qi(e);t!=null&&(i.location=wi(t))}var Rs=class{constructor(e,t=A.None){this.geometry=e,this.stateMask=t}};function Us(i,e){return Ss(i,()=>e)}function Wh(i){return Ss(i,e=>e.plane)}function Ss(i,e){let t=c(),r=c(),s=!1;return n=>{let a=e(n);if(n.action==="start"){let h=Z(n.screenStart,Yt.get()),d=ie(i.state.camera,h,vs);d!=null&&(s=ve(a,d,t))}if(!s)return null;let o=Z(n.screenEnd,Yt.get()),l=ie(i.state.camera,o,vs);return l==null?null:ve(a,l,r)?ne(se({},n),{renderStart:t,renderEnd:r,plane:a,ray:l}):null}}function Bs(i,e,t=0,r=null,s=null){let n=null;return a=>{if(a.action==="start"&&(n=i.sceneIntersectionHelper.intersectElevationFromScreen(x(a.screenStart.x,a.screenStart.y),e,t,s),n!=null&&r!=null&&!Fe(n,n,r))||n==null)return null;let o=i.sceneIntersectionHelper.intersectElevationFromScreen(x(a.screenEnd.x,a.screenEnd.y),e,t,s);return o!=null&&(r==null||Fe(o,o,r))?ne(se({},a),{mapStart:n,mapEnd:o}):null}}function ks(i,e,t,r=null,s=null){return Bs(i,t,ii(e,i,t),r,s)}function Uh(i,e,t,r){let s=t.toMap(i.screenStart);return s!=null?ks(e,s,t.elevationInfo,r):null}function Ys(i,e){let t=Xs,r=Js,s=at();i.renderCoordsHelper.worldUpAtPosition(e,t);let n=be(s,t,v(r,e,i.state.camera.eye));return be(n,n,t),ze(e,n,s)}function Bh(i,e,t){let r=null,s=new Li;return s.next(Us(i,Ys(i,e))).next(Zs(i,e)).next(Qs(i,t)).next(n=>{n.mapEnd.x=n.mapStart.x,n.mapEnd.y=n.mapStart.y,r=n}),n=>(r=null,s.execute(n),r)}function Zs(i,e){let t=c(),r=Ft(e);i.renderCoordsHelper.worldUpAtPosition(e,t);let s=c(),n=c(),a=o=>(v(o,o,e),Yr(t,o,o),i.viewingMode==="global"&&Ft(o)*Math.sign(br(t,o))<.001-r&&v(o,oe(o,t,.001),e),P(o,o,e),o);return o=>(o.renderStart=a(g(s,o.renderStart)),o.renderEnd=a(g(n,o.renderEnd)),o)}function Qs(i,e){let t=i.renderCoordsHelper;return r=>{let s=t.fromRenderCoords(r.renderStart,new V({spatialReference:e})),n=t.fromRenderCoords(r.renderEnd,new V({spatialReference:e}));return s!=null&&n!=null?ne(se({},r),{mapStart:s,mapEnd:n}):null}}var $e;function kh(i){let e=null;return t=>{switch(t.action){case"start":e=i.disableDisplay();break;case"end":case"cancel":e!=null&&(e.remove(),e=null)}return t}}function Yh(i,e=null){let t=Wi(i.state.viewingMode);t.options.selectionMode=!0,t.options.store=Hi.MIN,t.options.hud=!1;let r=x(),s={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},n=c(),a=e??i.spatialReference,o=h=>{i.map.ground&&i.map.ground.opacity<1?s.exclude.add(Jt):s.exclude.delete(Jt),i.sceneIntersectionHelper.intersectIntersectorScreen(Z(h,r),t,s);let d=t.results.min,u;if(d.getIntersectionPoint(n))u=d.intersector===Ni.TERRAIN?$e.GROUND:$e.OTHER;else{if(!t.results.ground.getIntersectionPoint(n))return null;u=$e.GROUND}return{location:i.renderCoordsHelper.fromRenderCoords(n,new V({spatialReference:a})),surfaceType:u}},l;return h=>{if(h.action==="start"){let u=o(h.screenStart);l=u!=null?u.location:null}if(l==null)return null;let d=o(h.screenEnd);return d?.location!=null?ne(se({},h),{mapStart:l,mapEnd:d.location,surfaceType:d.surfaceType}):null}}(function(i){i[i.GROUND=0]="GROUND",i[i.OTHER=1]="OTHER"})($e||($e={}));var Xs=c(),Js=c(),vs=Q();export{K as a,vt as b,St as c,T as d,Ot as e,Qe as f,ls as g,At as h,cs as i,Nl as j,hs as k,Rs as l,Us as m,Wh as n,ks as o,Uh as p,Bh as q,Qs as r,$e as s,kh as t,Yh as u,_h as v,fh as w,gh as x,yh as y,bh as z,Hs as A,Rh as B,vh as C};
