import{a as V,b as D}from"./chunk-LRWXBUNE.js";import"./chunk-4DVWX6EY.js";import"./chunk-MVDBB2SU.js";import{a as h,b,c as m}from"./chunk-I6P2KBUF.js";import"./chunk-PRWNPZ5M.js";import{a as A}from"./chunk-4OC4J3KU.js";import"./chunk-AUUWEG54.js";import{q as E,s as C}from"./chunk-BY64D2AL.js";import"./chunk-GLDWQ77T.js";import"./chunk-R4SFVOZO.js";import"./chunk-BKLTKOZS.js";import"./chunk-YKUB35EI.js";import"./chunk-ZJHI7U3R.js";import{q as F}from"./chunk-VIK3ZB6O.js";import"./chunk-NIYDRLW4.js";import"./chunk-H3VY6XFU.js";import"./chunk-LNYBTIG7.js";import"./chunk-3JBDNTAW.js";import"./chunk-SJTQM4NH.js";import"./chunk-IFFYADB3.js";import"./chunk-L6VKPRBR.js";import"./chunk-I7FAWQNR.js";import"./chunk-E2G5DGVE.js";import"./chunk-CP4KE5S6.js";import"./chunk-4X6XTGI2.js";import"./chunk-VXJKEPDS.js";import"./chunk-VOTZUGKK.js";import"./chunk-7JD62GP7.js";import"./chunk-CJYUOBHK.js";import"./chunk-KRMYHUR3.js";import"./chunk-PDBA6QOJ.js";import"./chunk-ALWV3RJ2.js";import"./chunk-7C6Z24SS.js";import"./chunk-QWLQUMDY.js";import"./chunk-2ETHV3H2.js";import{a as u,c as _,g as c}from"./chunk-4XUOIGFO.js";import"./chunk-R2HWUZ3L.js";import"./chunk-ORM3VHG6.js";import"./chunk-FVDACA4R.js";import"./chunk-4HISZWR4.js";import"./chunk-SJW4NR3T.js";import"./chunk-TQAPQODA.js";import"./chunk-M2GLXRA2.js";import"./chunk-EBWCXIFH.js";import"./chunk-M76YZBV5.js";import"./chunk-HXQMOXFX.js";import"./chunk-BKKKVIAS.js";import"./chunk-BCREO4Q5.js";import"./chunk-ZVHU7VE3.js";import"./chunk-76YVRX2R.js";import"./chunk-OZF6BMOL.js";import"./chunk-GJP6PTKT.js";import"./chunk-RSDQHAJX.js";import"./chunk-XIMCHX2H.js";import"./chunk-SF6Z2K5H.js";import"./chunk-GBTN5LIS.js";import"./chunk-JOSG37QF.js";import"./chunk-SLMQFZE3.js";import"./chunk-BENVXA3L.js";import"./chunk-2KZICFRS.js";import"./chunk-D2RUV6O4.js";import"./chunk-4JWMB5SM.js";import"./chunk-VOYK3LZF.js";import"./chunk-HOJTYTYD.js";import"./chunk-XNEAL2YW.js";import"./chunk-J7M5V2SQ.js";import"./chunk-HRFJUMCP.js";import"./chunk-375OYO4P.js";import{L as r,O as w}from"./chunk-AUTL5LCV.js";import{S as f}from"./chunk-KUJG22IX.js";import"./chunk-OVHPPCBL.js";import{a}from"./chunk-W3WDPWBE.js";import{k as s,r as S}from"./chunk-GISCFF3Z.js";import"./chunk-MLSR6YE6.js";import"./chunk-SNFOAZZQ.js";import"./chunk-CPDJJRWA.js";import"./chunk-HQMV3KQV.js";import"./chunk-CRMMDK2Z.js";import{h as y}from"./chunk-EAH6BNBL.js";var o=class extends w{get availability(){return 1}get updating(){return this.layerSource.updating}get _snappingElevationAligner(){let{view:e}=this,{layer:t}=this.layerSource,i=e!=null&&e.type==="3d";if(!i||t.type==="subtype-group")return h();let n=(p,l)=>y(this,null,function*(){return(yield S(e.whenLayerView(t),l)).elevationAlignPointsInFeatures(p,l)});return h(i,{elevationInfo:t.elevationInfo,alignPointsInFeatures:n})}get _snappingElevationFilter(){let{view:e}=this,t=e!=null&&e.type==="3d"&&this.layerSource.layer.type!=="subtype-group";return b(t)}get _symbologySnappingFetcher(){let{view:e}=this,{layer:t}=this.layerSource;return e!=null&&e.type==="3d"&&t.type!=="subtype-group"?m(this._symbologySnappingSupported,(i,n)=>y(this,null,function*(){let p=yield e.whenLayerView(t);return s(n),p.queryForSymbologySnapping({candidates:i,spatialReference:e.spatialReference},n)})):m()}get _symbologySnappingSupported(){return this._layerView3D!=null&&this._layerView3D.symbologySnappingSupported}initialize(){let{view:e}=this,{layer:t}=this.layerSource;e!=null&&e.type==="3d"&&t.type!=="subtype-group"&&(e.whenLayerView(t).then(i=>this._layerView3D=i),this.addHandles([e.elevationProvider.on("elevation-change",({context:i})=>{let{elevationInfo:n}=t;F(i,n)&&this._snappingElevationAligner.notifyElevationSourceChange()}),u(()=>t.elevationInfo,()=>this._snappingElevationAligner.notifyElevationSourceChange(),c),u(()=>this._layerView3D!=null?this._layerView3D.layer?.renderer:null,()=>this._symbologySnappingFetcher.notifySymbologyChange(),c),_(()=>this._layerView3D?.layer,["edits","apply-edits","graphic-update"],()=>this._symbologySnappingFetcher.notifySymbologyChange())]))}constructor(e){super(e),this.view=null,this._layerView3D=null,this._memoizedMakeGetGroundElevation=A(D)}refresh(){}fetchCandidates(e,t){return y(this,null,function*(){let{layer:i}=this.layerSource,n=i.source;if(!n?.querySnapping)return[];let p=C(i),l=E(e,this.view?.type??"2d",p),I=yield n.querySnapping(l,{signal:t});s(t);let d=e.coordinateHelper.spatialReference,g=yield this._snappingElevationAligner.alignCandidates(I.candidates,d,t);s(t);let v=yield this._symbologySnappingFetcher.fetch(g,t);s(t);let G=v.length===0?g:[...g,...v],k=this._snappingElevationFilter.filter(l,G),x=this._memoizedMakeGetGroundElevation(this.view,d);return k.map(z=>V(z,x))})}};a([r({constructOnly:!0})],o.prototype,"layerSource",void 0),a([r({constructOnly:!0})],o.prototype,"view",void 0),a([r()],o.prototype,"_snappingElevationAligner",null),a([r()],o.prototype,"_snappingElevationFilter",null),a([r()],o.prototype,"_symbologySnappingFetcher",null),a([r()],o.prototype,"_layerView3D",void 0),a([r()],o.prototype,"_symbologySnappingSupported",null),o=a([f("esri.views.interactive.snapping.featureSources.FeatureCollectionSnappingSource")],o);export{o as FeatureCollectionSnappingSource};
